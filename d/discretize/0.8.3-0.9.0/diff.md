# Comparing `tmp/discretize-0.8.3.tar.gz` & `tmp/discretize-0.9.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "discretize-0.8.3.tar", last modified: Sat Jan 28 01:46:18 2023, max compression
+gzip compressed data, was "discretize-0.9.0.tar", last modified: Tue Jun  6 17:33:44 2023, max compression
```

## Comparing `discretize-0.8.3.tar` & `discretize-0.9.0.tar`

### file list

```diff
@@ -1,73 +1,73 @@
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.382610 discretize-0.8.3/
--rw-r--r--   0 vsts      (1001) docker     (123)     1721 2023-01-28 01:42:37.000000 discretize-0.8.3/.flake8
--rw-r--r--   0 vsts      (1001) docker     (123)      128 2023-01-28 01:42:37.000000 discretize-0.8.3/.pre-commit-config.yaml
--rw-r--r--   0 vsts      (1001) docker     (123)     1108 2023-01-28 01:42:37.000000 discretize-0.8.3/AUTHORS.rst
--rw-r--r--   0 vsts      (1001) docker     (123)      849 2023-01-28 01:42:37.000000 discretize-0.8.3/CITATION.rst
--rw-r--r--   0 vsts      (1001) docker     (123)     1089 2023-01-28 01:42:37.000000 discretize-0.8.3/LICENSE
--rw-r--r--   0 vsts      (1001) docker     (123)     4738 2023-01-28 01:46:18.382610 discretize-0.8.3/PKG-INFO
--rw-r--r--   0 vsts      (1001) docker     (123)     3664 2023-01-28 01:42:37.000000 discretize-0.8.3/README.rst
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.358610 discretize-0.8.3/discretize/
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.362610 discretize-0.8.3/discretize/Tests/
--rw-r--r--   0 vsts      (1001) docker     (123)      372 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/Tests/__init__.py
--rw-r--r--   0 vsts      (1001) docker     (123)      311 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/View.py
--rw-r--r--   0 vsts      (1001) docker     (123)     2582 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/__init__.py
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.374610 discretize-0.8.3/discretize/_extensions/
--rw-r--r--   0 vsts      (1001) docker     (123)        0 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/__init__.py
--rw-r--r--   0 vsts      (1001) docker     (123)  1265524 2023-01-28 01:45:06.000000 discretize-0.8.3/discretize/_extensions/interputils_cython.c
--rw-r--r--   0 vsts      (1001) docker     (123)      161 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/interputils_cython.pxd
--rw-r--r--   0 vsts      (1001) docker     (123)    10654 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/interputils_cython.pyx
--rw-r--r--   0 vsts      (1001) docker     (123)  2299110 2023-01-28 01:45:09.000000 discretize-0.8.3/discretize/_extensions/simplex_helpers.cpp
--rw-r--r--   0 vsts      (1001) docker     (123)    12987 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/simplex_helpers.pyx
--rw-r--r--   0 vsts      (1001) docker     (123)    78309 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/tree.cpp
--rw-r--r--   0 vsts      (1001) docker     (123)     6458 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/tree.h
--rw-r--r--   0 vsts      (1001) docker     (123)     2980 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/tree.pxd
--rw-r--r--   0 vsts      (1001) docker     (123)  5131366 2023-01-28 01:45:14.000000 discretize-0.8.3/discretize/_extensions/tree_ext.cpp
--rw-r--r--   0 vsts      (1001) docker     (123)   258322 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/tree_ext.pyx
--rw-r--r--   0 vsts      (1001) docker     (123)     1405 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/_extensions/triplet.h
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.378610 discretize-0.8.3/discretize/base/
--rw-r--r--   0 vsts      (1001) docker     (123)      571 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/base/__init__.py
--rw-r--r--   0 vsts      (1001) docker     (123)   148416 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/base/base_mesh.py
--rw-r--r--   0 vsts      (1001) docker     (123)    37837 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/base/base_regular_mesh.py
--rw-r--r--   0 vsts      (1001) docker     (123)    40131 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/base/base_tensor_mesh.py
--rw-r--r--   0 vsts      (1001) docker     (123)    28713 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/curvilinear_mesh.py
--rw-r--r--   0 vsts      (1001) docker     (123)    79701 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/cylindrical_mesh.py
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.378610 discretize-0.8.3/discretize/mixins/
--rw-r--r--   0 vsts      (1001) docker     (123)     1541 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/mixins/__init__.py
--rw-r--r--   0 vsts      (1001) docker     (123)    21893 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/mixins/mesh_io.py
--rw-r--r--   0 vsts      (1001) docker     (123)    96628 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/mixins/mpl_mod.py
--rw-r--r--   0 vsts      (1001) docker     (123)    11235 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/mixins/omf_mod.py
--rw-r--r--   0 vsts      (1001) docker     (123)    38437 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/mixins/vtk_mod.py
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.378610 discretize-0.8.3/discretize/operators/
--rw-r--r--   0 vsts      (1001) docker     (123)      591 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/operators/__init__.py
--rw-r--r--   0 vsts      (1001) docker     (123)   145905 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/operators/differential_operators.py
--rw-r--r--   0 vsts      (1001) docker     (123)    29194 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/operators/inner_products.py
--rw-r--r--   0 vsts      (1001) docker     (123)    23410 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/tensor_mesh.py
--rw-r--r--   0 vsts      (1001) docker     (123)    27123 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/tests.py
--rw-r--r--   0 vsts      (1001) docker     (123)    45890 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/tree_mesh.py
--rw-r--r--   0 vsts      (1001) docker     (123)    42543 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/unstructured_mesh.py
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.382610 discretize-0.8.3/discretize/utils/
--rw-r--r--   0 vsts      (1001) docker     (123)     3560 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/__init__.py
--rw-r--r--   0 vsts      (1001) docker     (123)     9680 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/code_utils.py
--rw-r--r--   0 vsts      (1001) docker     (123)      284 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/codeutils.py
--rw-r--r--   0 vsts      (1001) docker     (123)    10386 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/coordinate_utils.py
--rw-r--r--   0 vsts      (1001) docker     (123)      291 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/coordutils.py
--rw-r--r--   0 vsts      (1001) docker     (123)    18669 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/curvilinear_utils.py
--rw-r--r--   0 vsts      (1001) docker     (123)      291 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/curvutils.py
--rw-r--r--   0 vsts      (1001) docker     (123)    11110 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/interpolation_utils.py
--rw-r--r--   0 vsts      (1001) docker     (123)      295 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/interputils.py
--rw-r--r--   0 vsts      (1001) docker     (123)     3880 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/io_utils.py
--rw-r--r--   0 vsts      (1001) docker     (123)    58074 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/matrix_utils.py
--rw-r--r--   0 vsts      (1001) docker     (123)      285 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/matutils.py
--rw-r--r--   0 vsts      (1001) docker     (123)    43246 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/mesh_utils.py
--rw-r--r--   0 vsts      (1001) docker     (123)      284 2023-01-28 01:42:37.000000 discretize-0.8.3/discretize/utils/meshutils.py
--rw-r--r--   0 vsts      (1001) docker     (123)      160 2023-01-28 01:46:18.000000 discretize-0.8.3/discretize/version.py
-drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-01-28 01:46:18.362610 discretize-0.8.3/discretize.egg-info/
--rw-r--r--   0 vsts      (1001) docker     (123)     4738 2023-01-28 01:46:18.000000 discretize-0.8.3/discretize.egg-info/PKG-INFO
--rw-r--r--   0 vsts      (1001) docker     (123)     1855 2023-01-28 01:46:18.000000 discretize-0.8.3/discretize.egg-info/SOURCES.txt
--rw-r--r--   0 vsts      (1001) docker     (123)        1 2023-01-28 01:46:18.000000 discretize-0.8.3/discretize.egg-info/dependency_links.txt
--rw-r--r--   0 vsts      (1001) docker     (123)       23 2023-01-28 01:46:18.000000 discretize-0.8.3/discretize.egg-info/requires.txt
--rw-r--r--   0 vsts      (1001) docker     (123)       11 2023-01-28 01:46:18.000000 discretize-0.8.3/discretize.egg-info/top_level.txt
--rw-r--r--   0 vsts      (1001) docker     (123)      419 2023-01-28 01:42:37.000000 discretize-0.8.3/environment_test.yml
--rw-r--r--   0 vsts      (1001) docker     (123)      112 2023-01-28 01:42:37.000000 discretize-0.8.3/requirements_style.txt
--rw-r--r--   0 vsts      (1001) docker     (123)       38 2023-01-28 01:46:18.382610 discretize-0.8.3/setup.cfg
--rw-r--r--   0 vsts      (1001) docker     (123)     3279 2023-01-28 01:42:37.000000 discretize-0.8.3/setup.py
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.582658 discretize-0.9.0/
+-rw-r--r--   0 vsts      (1001) docker     (123)     1683 2023-06-06 17:31:08.000000 discretize-0.9.0/.flake8
+-rw-r--r--   0 vsts      (1001) docker     (123)      381 2023-06-06 17:31:08.000000 discretize-0.9.0/.pre-commit-config.yaml
+-rw-r--r--   0 vsts      (1001) docker     (123)     1108 2023-06-06 17:31:08.000000 discretize-0.9.0/AUTHORS.rst
+-rw-r--r--   0 vsts      (1001) docker     (123)      849 2023-06-06 17:31:08.000000 discretize-0.9.0/CITATION.rst
+-rw-r--r--   0 vsts      (1001) docker     (123)     1089 2023-06-06 17:31:08.000000 discretize-0.9.0/LICENSE
+-rw-r--r--   0 vsts      (1001) docker     (123)     4738 2023-06-06 17:33:44.582658 discretize-0.9.0/PKG-INFO
+-rw-r--r--   0 vsts      (1001) docker     (123)     3664 2023-06-06 17:31:08.000000 discretize-0.9.0/README.rst
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.558658 discretize-0.9.0/discretize/
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.558658 discretize-0.9.0/discretize/Tests/
+-rw-r--r--   0 vsts      (1001) docker     (123)      366 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/Tests/__init__.py
+-rw-r--r--   0 vsts      (1001) docker     (123)      305 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/View.py
+-rw-r--r--   0 vsts      (1001) docker     (123)     2582 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/__init__.py
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.570658 discretize-0.9.0/discretize/_extensions/
+-rw-r--r--   0 vsts      (1001) docker     (123)        0 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/__init__.py
+-rw-r--r--   0 vsts      (1001) docker     (123)  1267994 2023-06-06 17:32:50.000000 discretize-0.9.0/discretize/_extensions/interputils_cython.c
+-rw-r--r--   0 vsts      (1001) docker     (123)      161 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/interputils_cython.pxd
+-rw-r--r--   0 vsts      (1001) docker     (123)    10654 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/interputils_cython.pyx
+-rw-r--r--   0 vsts      (1001) docker     (123)  2301798 2023-06-06 17:32:52.000000 discretize-0.9.0/discretize/_extensions/simplex_helpers.cpp
+-rw-r--r--   0 vsts      (1001) docker     (123)    12987 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/simplex_helpers.pyx
+-rw-r--r--   0 vsts      (1001) docker     (123)    78420 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/tree.cpp
+-rw-r--r--   0 vsts      (1001) docker     (123)     6458 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/tree.h
+-rw-r--r--   0 vsts      (1001) docker     (123)     2980 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/tree.pxd
+-rw-r--r--   0 vsts      (1001) docker     (123)  5133881 2023-06-06 17:32:56.000000 discretize-0.9.0/discretize/_extensions/tree_ext.cpp
+-rw-r--r--   0 vsts      (1001) docker     (123)   258022 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/tree_ext.pyx
+-rw-r--r--   0 vsts      (1001) docker     (123)     1405 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/_extensions/triplet.h
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.574658 discretize-0.9.0/discretize/base/
+-rw-r--r--   0 vsts      (1001) docker     (123)      571 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/base/__init__.py
+-rw-r--r--   0 vsts      (1001) docker     (123)   143881 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/base/base_mesh.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    36403 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/base/base_regular_mesh.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    39765 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/base/base_tensor_mesh.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    32683 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/curvilinear_mesh.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    85752 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/cylindrical_mesh.py
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.574658 discretize-0.9.0/discretize/mixins/
+-rw-r--r--   0 vsts      (1001) docker     (123)     1541 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/mixins/__init__.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    21693 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/mixins/mesh_io.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    97765 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/mixins/mpl_mod.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    11038 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/mixins/omf_mod.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    39175 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/mixins/vtk_mod.py
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.578658 discretize-0.9.0/discretize/operators/
+-rw-r--r--   0 vsts      (1001) docker     (123)      591 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/operators/__init__.py
+-rw-r--r--   0 vsts      (1001) docker     (123)   142488 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/operators/differential_operators.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    28092 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/operators/inner_products.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    23362 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/tensor_mesh.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    30440 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/tests.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    46069 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/tree_mesh.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    45811 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/unstructured_mesh.py
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.582658 discretize-0.9.0/discretize/utils/
+-rw-r--r--   0 vsts      (1001) docker     (123)     3560 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/__init__.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    11524 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/code_utils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)      254 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/codeutils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    10374 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/coordinate_utils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)      261 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/coordutils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    18186 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/curvilinear_utils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)      261 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/curvutils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    10882 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/interpolation_utils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)      265 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/interputils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)     3880 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/io_utils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    57732 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/matrix_utils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)      255 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/matutils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)    43172 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/mesh_utils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)      254 2023-06-06 17:31:08.000000 discretize-0.9.0/discretize/utils/meshutils.py
+-rw-r--r--   0 vsts      (1001) docker     (123)      160 2023-06-06 17:33:44.000000 discretize-0.9.0/discretize/version.py
+drwxr-xr-x   0 vsts      (1001) docker     (123)        0 2023-06-06 17:33:44.558658 discretize-0.9.0/discretize.egg-info/
+-rw-r--r--   0 vsts      (1001) docker     (123)     4738 2023-06-06 17:33:44.000000 discretize-0.9.0/discretize.egg-info/PKG-INFO
+-rw-r--r--   0 vsts      (1001) docker     (123)     1855 2023-06-06 17:33:44.000000 discretize-0.9.0/discretize.egg-info/SOURCES.txt
+-rw-r--r--   0 vsts      (1001) docker     (123)        1 2023-06-06 17:33:44.000000 discretize-0.9.0/discretize.egg-info/dependency_links.txt
+-rw-r--r--   0 vsts      (1001) docker     (123)       23 2023-06-06 17:33:44.000000 discretize-0.9.0/discretize.egg-info/requires.txt
+-rw-r--r--   0 vsts      (1001) docker     (123)       11 2023-06-06 17:33:44.000000 discretize-0.9.0/discretize.egg-info/top_level.txt
+-rw-r--r--   0 vsts      (1001) docker     (123)      375 2023-06-06 17:31:08.000000 discretize-0.9.0/environment_test.yml
+-rw-r--r--   0 vsts      (1001) docker     (123)      112 2023-06-06 17:31:08.000000 discretize-0.9.0/requirements_style.txt
+-rw-r--r--   0 vsts      (1001) docker     (123)       38 2023-06-06 17:33:44.582658 discretize-0.9.0/setup.cfg
+-rw-r--r--   0 vsts      (1001) docker     (123)     4194 2023-06-06 17:31:08.000000 discretize-0.9.0/setup.py
```

### Comparing `discretize-0.8.3/.flake8` & `discretize-0.9.0/.flake8`

 * *Files 4% similar despite different names*

```diff
@@ -55,11 +55,10 @@
     func,
     mod,
     meth,
     ref,
     data,
     # Python programming language:
     py:func,py:mod,py:attr,py:meth,
-    # Collapse functionality
 rst-directives =
     # These are sorted alphabetically - but that does not matter
-    autosummary,currentmodule,deprecated,collapse,
+    autosummary,currentmodule,deprecated,
```

### Comparing `discretize-0.8.3/AUTHORS.rst` & `discretize-0.9.0/AUTHORS.rst`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/CITATION.rst` & `discretize-0.9.0/CITATION.rst`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/LICENSE` & `discretize-0.9.0/LICENSE`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/PKG-INFO` & `discretize-0.9.0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: discretize
-Version: 0.8.3
+Version: 0.9.0
 Summary: Discretization tools for finite volume and inverse problems
 Home-page: http://simpeg.xyz/
 Download-URL: http://github.com/simpeg/discretize
 Author: SimPEG developers
 Author-email: rowanc1@gmail.com
 License: MIT
 Keywords: finite volume,discretization,pde,ode
```

### Comparing `discretize-0.8.3/README.rst` & `discretize-0.9.0/README.rst`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/__init__.py` & `discretize-0.9.0/discretize/__init__.py`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/_extensions/interputils_cython.c` & `discretize-0.9.0/discretize/_extensions/interputils_cython.c`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.35 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "/home/vsts/conda/envs/discretize-test/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
             "/home/vsts/conda/envs/discretize-test/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
@@ -27,16 +27,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
+#define CYTHON_ABI "0_29_35"
+#define CYTHON_HEX_VERSION 0x001D23F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -96,16 +96,20 @@
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
@@ -221,15 +225,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -260,15 +264,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -2304,22 +2308,30 @@
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
+#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_35
+#define __PYX_HAVE_RT_ImportType_proto_0_29_35
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_0_29_35 {
+   __Pyx_ImportType_CheckSize_Error_0_29_35 = 0,
+   __Pyx_ImportType_CheckSize_Warn_0_29_35 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_0_29_35 = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size);
 #endif
 
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
 #define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
 #else
 static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
@@ -24231,15 +24243,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_MemviewEnum_obj *p;
   PyObject *o;
@@ -24353,15 +24365,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_memoryview __pyx_vtable_memoryview;
 
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryview_obj *p;
@@ -24617,15 +24629,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct__memoryviewslice __pyx_vtable__memoryviewslice;
 
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryviewslice_obj *p;
@@ -24766,15 +24778,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
@@ -25521,55 +25533,39 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_35(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -28539,28 +28535,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -29464,61 +29460,79 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-  #ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+  #ifndef __PYX_HAVE_RT_ImportType_0_29_35
+#define __PYX_HAVE_RT_ImportType_0_29_35
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_35 && (size_t)basicsize != size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_35 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -30712,15 +30726,15 @@
                         } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                             return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -30984,15 +30998,15 @@
                         } else if (8 * sizeof(npy_int32) >= 4 * PyLong_SHIFT) {
                             return (npy_int32) (((((((((npy_int32)digits[3]) << PyLong_SHIFT) | (npy_int32)digits[2]) << PyLong_SHIFT) | (npy_int32)digits[1]) << PyLong_SHIFT) | (npy_int32)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -31218,15 +31232,15 @@
                         } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                             return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -31414,15 +31428,15 @@
                         } else if (8 * sizeof(char) >= 4 * PyLong_SHIFT) {
                             return (char) (((((((((char)digits[3]) << PyLong_SHIFT) | (char)digits[2]) << PyLong_SHIFT) | (char)digits[1]) << PyLong_SHIFT) | (char)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
```

### Comparing `discretize-0.8.3/discretize/_extensions/interputils_cython.pyx` & `discretize-0.9.0/discretize/_extensions/interputils_cython.pyx`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/_extensions/simplex_helpers.cpp` & `discretize-0.9.0/discretize/_extensions/simplex_helpers.cpp`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.35 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "/home/vsts/conda/envs/discretize-test/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
             "/home/vsts/conda/envs/discretize-test/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
@@ -30,16 +30,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
+#define CYTHON_ABI "0_29_35"
+#define CYTHON_HEX_VERSION 0x001D23F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -99,16 +99,20 @@
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
@@ -224,15 +228,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -263,15 +267,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -2520,22 +2524,30 @@
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
+#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_35
+#define __PYX_HAVE_RT_ImportType_proto_0_29_35
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_0_29_35 {
+   __Pyx_ImportType_CheckSize_Error_0_29_35 = 0,
+   __Pyx_ImportType_CheckSize_Warn_0_29_35 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_0_29_35 = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size);
 #endif
 
 /* FetchCommonType.proto */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
 
 /* CythonFunctionShared.proto */
 #define __Pyx_CyFunction_USED 1
@@ -45435,15 +45447,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_MemviewEnum_obj *p;
   PyObject *o;
@@ -45557,15 +45569,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_memoryview __pyx_vtable_memoryview;
 
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryview_obj *p;
@@ -45821,15 +45833,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct__memoryviewslice __pyx_vtable__memoryviewslice;
 
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryviewslice_obj *p;
@@ -45970,15 +45982,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
@@ -46752,55 +46764,39 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_35(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(1, 770, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_number) __PYX_ERR(1, 772, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(1, 774, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(1, 776, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(1, 778, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(1, 780, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(1, 782, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(1, 784, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(1, 786, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_character) __PYX_ERR(1, 788, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 826, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -48783,28 +48779,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -50636,61 +50632,79 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+#ifndef __PYX_HAVE_RT_ImportType_0_29_35
+#define __PYX_HAVE_RT_ImportType_0_29_35
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_35 && (size_t)basicsize != size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_35 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -51314,15 +51328,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
@@ -51697,15 +51714,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_FusedFunction_init(void) {
     __pyx_FusedFunctionType_type.tp_base = __pyx_CyFunctionType;
     __pyx_FusedFunctionType = __Pyx_FetchCommonType(&__pyx_FusedFunctionType_type);
     if (__pyx_FusedFunctionType == NULL) {
@@ -53547,15 +53567,15 @@
                         } else if (8 * sizeof(size_t) >= 4 * PyLong_SHIFT) {
                             return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -53781,15 +53801,15 @@
                         } else if (8 * sizeof(npy_int32) >= 4 * PyLong_SHIFT) {
                             return (npy_int32) (((((((((npy_int32)digits[3]) << PyLong_SHIFT) | (npy_int32)digits[2]) << PyLong_SHIFT) | (npy_int32)digits[1]) << PyLong_SHIFT) | (npy_int32)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -53977,15 +53997,15 @@
                         } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                             return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -54211,15 +54231,15 @@
                         } else if (8 * sizeof(npy_int64) >= 4 * PyLong_SHIFT) {
                             return (npy_int64) (((((((((npy_int64)digits[3]) << PyLong_SHIFT) | (npy_int64)digits[2]) << PyLong_SHIFT) | (npy_int64)digits[1]) << PyLong_SHIFT) | (npy_int64)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -54445,15 +54465,15 @@
                         } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                             return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -54667,15 +54687,15 @@
                         } else if (8 * sizeof(char) >= 4 * PyLong_SHIFT) {
                             return (char) (((((((((char)digits[3]) << PyLong_SHIFT) | (char)digits[2]) << PyLong_SHIFT) | (char)digits[1]) << PyLong_SHIFT) | (char)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
```

### Comparing `discretize-0.8.3/discretize/_extensions/simplex_helpers.pyx` & `discretize-0.9.0/discretize/_extensions/simplex_helpers.pyx`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/_extensions/tree.cpp` & `discretize-0.9.0/discretize/_extensions/tree.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -133,56 +133,47 @@
     edges[2] = NULL;
     edges[3] = NULL;
 }
 
 Node * set_default_node(node_map_t& nodes, int_t x, int_t y, int_t z,
                         double *xs, double *ys, double *zs){
   int_t key = key_func(x, y, z);
-  Node * point;
-  if(nodes.count(key) == 0){
-    point = new Node(x, y, z, xs, ys, zs);
-    nodes[key] = point;
+  auto [it, inserted] = nodes.try_emplace(key, nullptr);
+  if(inserted){
+        // construct a new item at the emplaced location
+        it->second = new Node(x, y, z, xs, ys, zs);
   }
-  else{
-    point = nodes[key];
-  }
-  return point;
+  return it->second;
 }
 
 Edge * set_default_edge(edge_map_t& edges, Node& p1, Node& p2){
   int_t xC = (p1.location_ind[0]+p2.location_ind[0])/2;
   int_t yC = (p1.location_ind[1]+p2.location_ind[1])/2;
   int_t zC = (p1.location_ind[2]+p2.location_ind[2])/2;
   int_t key = key_func(xC, yC, zC);
-  Edge * edge;
-  if(edges.count(key) == 0){
-    edge = new Edge(p1, p2);
-    edges[key] = edge;
-  }
-  else{
-    edge = edges[key];
+  auto [it, inserted] = edges.try_emplace(key, nullptr);
+  if(inserted){
+        // construct a new item at the emplaced location
+        it->second = new Edge(p1, p2);
   }
-  return edge;
+  return it->second;
 };
 
 Face * set_default_face(face_map_t& faces, Node& p1, Node& p2, Node& p3, Node& p4){
     int_t x, y, z, key;
     x = (p1.location_ind[0]+p2.location_ind[0]+p3.location_ind[0]+p4.location_ind[0])/4;
     y = (p1.location_ind[1]+p2.location_ind[1]+p3.location_ind[1]+p4.location_ind[1])/4;
     z = (p1.location_ind[2]+p2.location_ind[2]+p3.location_ind[2]+p4.location_ind[2])/4;
     key = key_func(x, y, z);
-    Face * face;
-    if(faces.count(key) == 0){
-        face = new Face(p1, p2, p3, p4);
-        faces[key] = face;
-    }
-    else{
-        face = faces[key];
+    auto [it, inserted] = faces.try_emplace(key, nullptr);
+    if(inserted){
+        // construct a new item at the emplaced location
+        it->second = new Face(p1, p2, p3, p4);
     }
-    return face;
+    return it->second;
 }
 
 Cell::Cell(Node *pts[8], int_t ndim, int_t maxlevel){
     n_dim = ndim;
     int_t n_points = 1<<n_dim;
     for(int_t i = 0; i < n_points; ++i)
         points[i] = pts[i];
```

### Comparing `discretize-0.8.3/discretize/_extensions/tree.h` & `discretize-0.9.0/discretize/_extensions/tree.h`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/_extensions/tree.pxd` & `discretize-0.9.0/discretize/_extensions/tree.pxd`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/_extensions/tree_ext.cpp` & `discretize-0.9.0/discretize/_extensions/tree_ext.cpp`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.33 */
+/* Generated by Cython 0.29.35 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "/home/vsts/conda/envs/discretize-test/lib/python3.10/site-packages/numpy/core/include/numpy/arrayobject.h",
             "/home/vsts/conda/envs/discretize-test/lib/python3.10/site-packages/numpy/core/include/numpy/arrayscalars.h",
@@ -32,16 +32,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_33"
-#define CYTHON_HEX_VERSION 0x001D21F0
+#define CYTHON_ABI "0_29_35"
+#define CYTHON_HEX_VERSION 0x001D23F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -101,16 +101,20 @@
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
   #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
@@ -226,15 +230,15 @@
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
   #if PY_VERSION_HEX < 0x02070000
     #undef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 0
   #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
-    #define CYTHON_USE_PYLONG_INTERNALS 1
+    #define CYTHON_USE_PYLONG_INTERNALS (PY_VERSION_HEX < 0x030C00A5)
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
@@ -265,15 +269,15 @@
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
   #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+    #define CYTHON_USE_DICT_VERSIONS ((PY_VERSION_HEX >= 0x030600B1) && (PY_VERSION_HEX < 0x030C00A5))
   #endif
   #if PY_VERSION_HEX >= 0x030B00A4
     #undef CYTHON_USE_EXC_INFO_STACK
     #define CYTHON_USE_EXC_INFO_STACK 0
   #elif !defined(CYTHON_USE_EXC_INFO_STACK)
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
@@ -1522,54 +1526,54 @@
  */
 struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine {
   PyObject_HEAD
   PyObject *__pyx_v_level;
 };
 
 
-/* "discretize/_extensions/tree_ext.pyx":5280
+/* "discretize/_extensions/tree_ext.pyx":5275
  *         return P*Rf
  * 
  *     def _getFacePxx(self):             # <<<<<<<<<<<<<<
  *         def Pxx(xFace, yFace):
  *             return self._getFaceP(xFace, yFace, None)
  */
 struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx {
   PyObject_HEAD
   struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self;
 };
 
 
-/* "discretize/_extensions/tree_ext.pyx":5285
+/* "discretize/_extensions/tree_ext.pyx":5280
  *         return Pxx
  * 
  *     def _getFacePxxx(self):             # <<<<<<<<<<<<<<
  *         def Pxxx(xFace, yFace, zFace):
  *             return self._getFaceP(xFace, yFace, zFace)
  */
 struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx {
   PyObject_HEAD
   struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self;
 };
 
 
-/* "discretize/_extensions/tree_ext.pyx":5336
+/* "discretize/_extensions/tree_ext.pyx":5331
  *         return P*Rf
  * 
  *     def _getEdgePxx(self):             # <<<<<<<<<<<<<<
  *         def Pxx(xEdge, yEdge):
  *             return self._getEdgeP(xEdge, yEdge, None)
  */
 struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx {
   PyObject_HEAD
   struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self;
 };
 
 
-/* "discretize/_extensions/tree_ext.pyx":5341
+/* "discretize/_extensions/tree_ext.pyx":5336
  *         return Pxx
  * 
  *     def _getEdgePxxx(self):             # <<<<<<<<<<<<<<
  *         def Pxxx(xEdge, yEdge, zEdge):
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  */
 struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx {
@@ -2700,22 +2704,30 @@
 /* PyObjectGetAttrStrNoError.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
 /* SetupReduce.proto */
 static int __Pyx_setup_reduce(PyObject* type_obj);
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
+#ifndef __PYX_HAVE_RT_ImportType_proto_0_29_35
+#define __PYX_HAVE_RT_ImportType_proto_0_29_35
+#if __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_0_29_35(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_0_29_35 {
+   __Pyx_ImportType_CheckSize_Error_0_29_35 = 0,
+   __Pyx_ImportType_CheckSize_Warn_0_29_35 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_0_29_35 = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size);
 #endif
 
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
 #define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
 #else
 static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
@@ -3032,15 +3044,15 @@
 /* CIntFromPy.proto */
 static CYTHON_INLINE char __Pyx_PyInt_As_char(PyObject *);
 
 /* CheckBinaryVersion.proto */
 static int __Pyx_check_binary_version(void);
 
 /* FunctionImport.proto */
-static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig);
+static int __Pyx_ImportFunction_0_29_35(PyObject *module, const char *funcname, void (**f)(void), const char *sig);
 
 /* InitStrings.proto */
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 
 static void __pyx_f_10discretize_11_extensions_8tree_ext_8TreeCell__set(struct __pyx_obj_10discretize_11_extensions_8tree_ext_TreeCell *__pyx_v_self, Cell *__pyx_v_cell); /* proto*/
 static PyObject *__pyx_array_get_memview(struct __pyx_array_obj *__pyx_v_self); /* proto*/
 static char *__pyx_memoryview_get_item_pointer(struct __pyx_memoryview_obj *__pyx_v_self, PyObject *__pyx_v_index); /* proto*/
@@ -3377,24 +3389,24 @@
 static const char __pyx_k_face_normals[] = "face_normals";
 static const char __pyx_k_in_tens_mesh[] = "in_tens_mesh";
 static const char __pyx_k_insert_cells[] = "insert_cells";
 static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
 static const char __pyx_k_requirements[] = "requirements";
 static const char __pyx_k_scipy_sparse[] = "scipy.sparse";
 static const char __pyx_k_stringsource[] = "stringsource";
-static const char __pyx_k_zerosOutside[] = "zerosOutside";
 static const char __pyx_k_deflate_edges[] = "_deflate_edges";
 static const char __pyx_k_deflate_faces[] = "_deflate_faces";
 static const char __pyx_k_deflate_nodes[] = "_deflate_nodes";
 static const char __pyx_k_n_total_edges[] = "n_total_edges";
 static const char __pyx_k_n_total_faces[] = "n_total_faces";
 static const char __pyx_k_n_total_nodes[] = "n_total_nodes";
 static const char __pyx_k_out_tens_mesh[] = "out_tens_mesh";
 static const char __pyx_k_pyx_getbuffer[] = "__pyx_getbuffer";
 static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
+static const char __pyx_k_zeros_outside[] = "zeros_outside";
 static const char __pyx_k_Path_not_found[] = "Path not found";
 static const char __pyx_k_View_MemoryView[] = "View.MemoryView";
 static const char __pyx_k_allocate_buffer[] = "allocate_buffer";
 static const char __pyx_k_deflate_edges_x[] = "_deflate_edges_x";
 static const char __pyx_k_deflate_edges_y[] = "_deflate_edges_y";
 static const char __pyx_k_deflate_edges_z[] = "_deflate_edges_z";
 static const char __pyx_k_deflate_faces_x[] = "_deflate_faces_x";
@@ -3426,14 +3438,15 @@
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_face_divergence_2D[] = "_face_divergence_2D";
 static const char __pyx_k_face_divergence_3D[] = "_face_divergence_3D";
 static const char __pyx_k_strided_and_direct[] = "<strided and direct>";
 static const char __pyx_k_NotImplementedError[] = "NotImplementedError";
 static const char __pyx_k_x0s_array_must_be_N[] = "x0s array must be (N, ";
 static const char __pyx_k_x1s_array_must_be_N[] = "x1s array must be (N, ";
+static const char __pyx_k_average_edge_to_face[] = "_average_edge_to_face";
 static const char __pyx_k_refine_locals_lambda[] = "refine.<locals>.<lambda>";
 static const char __pyx_k_strided_and_indirect[] = "<strided and indirect>";
 static const char __pyx_k_Invalid_argument_type[] = "Invalid argument type.";
 static const char __pyx_k_cell_boundary_indices[] = "cell_boundary_indices";
 static const char __pyx_k_contiguous_and_direct[] = "<contiguous and direct>";
 static const char __pyx_k_getEdgePxx_locals_Pxx[] = "_getEdgePxx.<locals>.Pxx";
 static const char __pyx_k_getFacePxx_locals_Pxx[] = "_getFacePxx.<locals>.Pxx";
@@ -3465,15 +3478,14 @@
 static const char __pyx_k_Cannot_index_with_type_s[] = "Cannot index with type '%s'";
 static const char __pyx_k_TreeMesh_refine_line_448[] = "_TreeMesh.refine (line 448)";
 static const char __pyx_k_Invalid_shape_in_axis_d_d[] = "Invalid shape in axis %d: %d.";
 static const char __pyx_k_There_are_no_z_edges_in_2D[] = "There are no z-edges in 2D";
 static const char __pyx_k_There_are_no_z_faces_in_2D[] = "There are no z-faces in 2D";
 static const char __pyx_k_line_nodes_array_must_be_N[] = "line_nodes array must be (N, ";
 static const char __pyx_k_triangle_array_must_be_N_3[] = "triangle array must be (N, 3, ";
-static const char __pyx_k_average_edge_to_face_vector[] = "_average_edge_to_face_vector";
 static const char __pyx_k_get_containing_cell_indexes[] = "_get_containing_cell_indexes";
 static const char __pyx_k_itemsize_0_for_cython_array[] = "itemsize <= 0 for cython.array";
 static const char __pyx_k_All_heights_must_be_positive[] = "All heights must be positive.";
 static const char __pyx_k_TreeMesh_refine_box_line_601[] = "_TreeMesh.refine_box (line 601)";
 static const char __pyx_k_The_index_0_d_is_out_of_range[] = "The index ({0:d}) is out of range.";
 static const char __pyx_k_TreeMesh_has_no_z_edges_in_2D[] = "TreeMesh has no z-edges in 2D";
 static const char __pyx_k_TreeMesh_has_no_z_faces_in_2D[] = "TreeMesh has no z faces in 2D";
@@ -3520,15 +3532,15 @@
 static const char __pyx_k_self__cell_cannot_be_converted_t[] = "self._cell cannot be converted to a Python object for pickling";
 static const char __pyx_k_unable_to_allocate_shape_and_str[] = "unable to allocate shape and strides.";
 static const char __pyx_k_x0s_and_x1s_must_have_the_same_l[] = "x0s and x1s must have the same length";
 static const char __pyx_k_discretize__extensions_tree_ext_2[] = "discretize._extensions.tree_ext";
 static const char __pyx_k_Refine_class_discretize_TreeMesh_2[] = "Refine :class:`~discretize.TreeMesh` using radial distance (ball) and refinement level for a cluster of points.\n\n        For each point in the array `points`, this method refines the tree mesh\n        based on the radial distance (ball) and refinement level supplied. The method\n        accomplishes this by determining which cells intersect ball(s) and refining them\n        to the prescribed level(s) of refinement.\n\n        Parameters\n        ----------\n        points : (N, dim) array_like\n            The centers of the refinement balls\n        radii : float or (N) array_like of float\n            A 1D array defining the radius for each ball\n        levels : int or (N) array_like of int\n            A 1D array defining the maximum refinement level for each ball\n        finalize : bool, optional\n            Whether to finalize after refining\n        diagonal_balance : bool or None, optional\n            Whether to balance cells diagonally in the refinement, `None` implies using\n            the same setting used to instantiate the TreeMesh`.\n\n        Examples\n        --------\n        We create a simple mesh and refine the tree mesh such that all cells that\n        intersect the spherical balls are at the given levels.\n\n        >>> import discretize\n        >>> import matplotlib.pyplot as plt\n        >>> import matplotlib.patches as patches\n        >>> tree_mesh = discretize.TreeMesh([32, 32])\n        >>> tree_mesh.max_level\n        5\n\n        Next we define the center and radius of the two spheres, as well as the level\n        we want to refine them to, and refine the mesh.\n\n        >>> centers = [[0.1, 0.3], [0.6, 0.8]]\n        >>> radii = [0.2, 0.3]\n        >>> levels = [4, 5]\n        >>> tree_mesh.refine_ball(centers, radii, levels)\n\n        Now lets look at the mesh, and overlay the balls on it to ensure it refined\n        where we wanted it to.\n\n        >>> ax = tree_mesh.plot_grid()\n        >>> circ = patches.Circle(cente""rs[0], radii[0], facecolor='none', edgecolor='r', linewidth=3)\n        >>> ax.add_patch(circ)\n        >>> circ = patches.Circle(centers[1], radii[1], facecolor='none', edgecolor='k', linewidth=3)\n        >>> ax.add_patch(circ)\n        >>> plt.show()\n        ";
 static const char __pyx_k_Refine_the_class_discretize_Tree_2[] = "Refine the :class:`~discretize.TreeMesh` along the line segment to the desired level.\n\n        Refines the TreeMesh by determining if a cell intersects the given line segment(s)\n        to the prescribed level(s).\n\n        Parameters\n        ----------\n        path : (N+1, dim) array_like\n            The nodes of the line segment(s).\n            i.e. `[[x0, y0, z0], [x1, y1, z1], [x2, y2, z2]]` would be two segments.\n        levels : int or (N) array_like of int\n            The level to refine intersecting cells to.\n        finalize : bool, optional\n            Whether to finalize after refining\n        diagonal_balance : bool or None, optional\n            Whether to balance cells diagonally in the refinement, `None` implies using\n            the same setting used to instantiate the TreeMesh`.\n\n        Examples\n        --------\n        We create a simple mesh and refine the TreeMesh such that all cells that\n        intersect the line segment path are at the given levels.\n\n        >>> import discretize\n        >>> import matplotlib.pyplot as plt\n        >>> import matplotlib.patches as patches\n        >>> tree_mesh = discretize.TreeMesh([32, 32])\n        >>> tree_mesh.max_level\n        5\n\n        Next we define the points along the line and the level we want to refine to,\n        and refine the mesh.\n\n        >>> segments = np.array([[0.1, 0.3], [0.3, 0.9], [0.8, 0.9]])\n        >>> levels = 5\n        >>> tree_mesh.refine_line(segments, levels)\n\n        Now lets look at the mesh, and overlay the line on it to ensure it refined\n        where we wanted it to.\n\n        >>> ax = tree_mesh.plot_grid()\n        >>> ax.plot(*segments.T, color='C1')\n        >>> plt.show()\n\n        ";
 static const char __pyx_k_Refine_the_class_discretize_Tree_3[] = "Refine the :class:`~discretize.TreeMesh` along the triangle to the desired level.\n\n        Refines the TreeMesh by determining if a cell intersects the given triangle(s)\n        to the prescribed level(s).\n\n        Parameters\n        ----------\n        triangle : (N, 3, dim) array_like\n            The nodes of the triangle(s).\n        levels : int or (N) array_like of int\n            The level to refine intersecting cells to.\n        finalize : bool, optional\n            Whether to finalize after refining\n        diagonal_balance : bool or None, optional\n            Whether to balance cells diagonally in the refinement, `None` implies using\n            the same setting used to instantiate the TreeMesh`.\n\n        Examples\n        --------\n        We create a simple mesh and refine the TreeMesh such that all cells that\n        intersect the line segment path are at the given levels.\n\n        >>> import discretize\n        >>> import matplotlib.pyplot as plt\n        >>> import matplotlib.patches as patches\n        >>> tree_mesh = discretize.TreeMesh([32, 32])\n        >>> tree_mesh.max_level\n        5\n\n        Next we define the points along the line and the level we want to refine to,\n        and refine the mesh.\n\n        >>> triangle = [[0.14, 0.31], [0.32, 0.96], [0.23, 0.87]]\n        >>> levels = 5\n        >>> tree_mesh.refine_triangle(triangle, levels)\n\n        Now lets look at the mesh, and overlay the line on it to ensure it refined\n        where we wanted it to.\n\n        >>> ax = tree_mesh.plot_grid()\n        >>> tri = patches.Polygon(triangle, fill=False)\n        >>> ax.add_patch(tri)\n        >>> plt.show()\n\n        ";
-static const char __pyx_k_Refine_the_class_discretize_Tree_4[] = "Refine the :class:`~discretize.TreeMesh` along the trianglular prism to the desired level.\n\n        Refines the TreeMesh by determining if a cell intersects the given trianglular prism(s)\n        to the prescribed level(s).\n\n        Parameters\n        ----------\n        triangle : (N, 3, dim) array_like\n            The nodes of the bottom triangle(s).\n        h : (N) array_like\n            The height of the prism(s).\n        levels : int or (N) array_like of int\n            The level to refine intersecting cells to.\n        finalize : bool, optional\n            Whether to finalize after refining\n        diagonal_balance : bool or None, optional\n            Whether to balance cells diagonally in the refinement, `None` implies using\n            the same setting used to instantiate the TreeMesh`.\n\n        See Also\n        --------\n        refine_surface\n\n        Examples\n        --------\n        We create a simple mesh and refine the TreeMesh such that all cells that\n        intersect the line segment path are at the given levels.\n\n        >>> import discretize\n        >>> import matplotlib.pyplot as plt\n        >>> import matplotlib.patches as patches\n        >>> tree_mesh = discretize.TreeMesh([32, 32, 32])\n        >>> tree_mesh.max_level\n        5\n\n        Next we define the bottom points of the prism, its heights, and the level we\n        want to refine to, then refine the mesh.\n\n        >>> triangle = [[0.14, 0.31, 0.21], [0.32, 0.96, 0.34], [0.87, 0.23, 0.12]]\n        >>> height = 0.35\n        >>> levels = 5\n        >>> mesh.refine_vertical_trianglular_prism(triangle, height, levels)\n\n        Now lets look at the mesh.\n\n        >>> v = mesh.cell_levels_by_index(np.arange(mesh.n_cells))\n        >>> fig, axs = plt.subplots(1, 3, figsize=(12,4))\n        >>> mesh.plot_slice(v, ax=axs[0], normal='x', grid=True, clim=[2, 5])\n        >>> mesh.plot_slice(v, ax=axs[1], normal='y', grid=True, clim=[2, 5])\n        >>> mesh.pl""ot_slice(v, ax=axs[2], normal='z', grid=True, clim=[2, 5])\n        >>> plt.show()\n\n        ";
+static const char __pyx_k_Refine_the_class_discretize_Tree_4[] = "Refine the :class:`~discretize.TreeMesh` along the trianglular prism to the desired level.\n\n        Refines the TreeMesh by determining if a cell intersects the given trianglular prism(s)\n        to the prescribed level(s).\n\n        Parameters\n        ----------\n        triangle : (N, 3, dim) array_like\n            The nodes of the bottom triangle(s).\n        h : (N) array_like\n            The height of the prism(s).\n        levels : int or (N) array_like of int\n            The level to refine intersecting cells to.\n        finalize : bool, optional\n            Whether to finalize after refining\n        diagonal_balance : bool or None, optional\n            Whether to balance cells diagonally in the refinement, `None` implies using\n            the same setting used to instantiate the TreeMesh`.\n\n        See Also\n        --------\n        refine_surface\n\n        Examples\n        --------\n        We create a simple mesh and refine the TreeMesh such that all cells that\n        intersect the line segment path are at the given levels.\n\n        >>> import discretize\n        >>> import matplotlib.pyplot as plt\n        >>> import matplotlib.patches as patches\n        >>> mesh = discretize.TreeMesh([32, 32, 32])\n        >>> mesh.max_level\n        5\n\n        Next we define the bottom points of the prism, its heights, and the level we\n        want to refine to, then refine the mesh.\n\n        >>> triangle = [[0.14, 0.31, 0.21], [0.32, 0.96, 0.34], [0.87, 0.23, 0.12]]\n        >>> height = 0.35\n        >>> levels = 5\n        >>> tree_mesh.refine_vertical_trianglular_prism(triangle, height, levels)\n\n        Now lets look at the mesh.\n\n        >>> v = tree_mesh.cell_levels_by_index(np.arange(tree_mesh.n_cells))\n        >>> fig, axs = plt.subplots(1, 3, figsize=(12,4))\n        >>> tree_mesh.plot_slice(v, ax=axs[0], normal='x', grid=True, clim=[2, 5])\n        >>> tree_mesh.plot_slice(v, ax=axs[1], normal='y', grid=True, clim=[2, 5])\n    ""    >>> tree_mesh.plot_slice(v, ax=axs[2], normal='z', grid=True, clim=[2, 5])\n        >>> plt.show()\n\n        ";
 static const char __pyx_k_Refine_the_class_discretize_Tree_5[] = "Refine the :class:`~discretize.TreeMesh` along the tetrahedron to the desired level.\n\n        Refines the TreeMesh by determining if a cell intersects the given triangle(s)\n        to the prescribed level(s).\n\n        Parameters\n        ----------\n        tetra : (N, dim+1, dim) array_like\n            The nodes of the tetrahedron(s).\n        levels : int or (N) array_like of int\n            The level to refine intersecting cells to.\n        finalize : bool, optional\n            Whether to finalize after refining\n        diagonal_balance : bool or None, optional\n            Whether to balance cells diagonally in the refinement, `None` implies using\n            the same setting used to instantiate the TreeMesh`.\n\n        Examples\n        --------\n        We create a simple mesh and refine the TreeMesh such that all cells that\n        intersect the line segment path are at the given levels.\n\n        >>> import discretize\n        >>> import matplotlib.pyplot as plt\n        >>> import matplotlib.patches as patches\n        >>> tree_mesh = discretize.TreeMesh([32, 32, 32])\n        >>> tree_mesh.max_level\n        5\n\n        Next we define the points along the line and the level we want to refine to,\n        and refine the mesh.\n\n        >>> tetra = [\n        ...     [0.32, 0.21, 0.15],\n        ...     [0.82, 0.19, 0.34],\n        ...     [0.14, 0.82, 0.29],\n        ...     [0.32, 0.27, 0.83],\n        ... ]\n        >>> levels = 5\n        >>> tree_mesh.refine_tetrahedron(tetra, levels)\n\n        Now lets look at the mesh, checking how the refine function proceeded.\n\n        >>> levels = tree_mesh.cell_levels_by_index(np.arange(tree_mesh.n_cells))\n        >>> ax = plt.gca()\n        >>> tree_mesh.plot_slice(levels, normal='z', slice_loc=0.2, grid=True, ax=ax)\n        >>> plt.show()\n\n        ";
 static const char __pyx_k_Returns_the_indices_of_the_x_y_a_2[] = "Returns the indices of the x, y (and z) boundary faces.\n\n        This property returns the indices of the faces on the x, y (and z)\n        boundaries, respectively. Note that each axis direction will\n        have both a lower and upper boundary. The property will\n        return the indices corresponding to the lower and upper\n        boundaries separately.\n\n        E.g. for a 2D domain, there are 2 x-boundaries and 2 y-boundaries (4 in total).\n        In this case, the return is a list of length 4 organized\n        [ind_Bx1, ind_Bx2, ind_By1, ind_By2]::\n\n                       By2\n                + ------------- +\n                |               |\n                |               |\n            Bx1 |               | Bx2\n                |               |\n                |               |\n                + ------------- +\n                       By1\n\n\n        Returns\n        -------\n        ind_bx1 ind_bx2, ind_by1, ind_by2 : numpy.ndarray of int\n            The length of each array in the list is equal to the number of faces\n            on that particular boundary.\n        ind_bz1, ind_bz2 : numpy.ndarray of int, optional\n\n        Examples\n        --------\n        Here, we construct a small 2D tree mesh and return the indices\n        of the x and y-boundary faces.\n\n        >>> from discretize import TreeMesh\n        >>> import numpy as np\n        >>> import matplotlib.pyplot as plt\n\n        >>> hx = np.ones(16)\n        >>> hy = np.ones(16)\n        >>> mesh = TreeMesh([hx, hy])\n        >>> mesh.refine_ball([4.0,4.0], [4.0], [4])\n        >>> ind_Bx1, ind_Bx2, ind_By1, ind_By2 = mesh.face_boundary_indices\n\n        >>> ax = plt.subplot(111)\n        >>> mesh.plot_grid(ax=ax)\n        >>> ax.scatter(*mesh.faces_x[ind_Bx1].T)\n        >>> plt.show()\n        ";
 static PyObject *__pyx_n_s_ASCII;
 static PyObject *__pyx_kp_u_All_heights_must_be_positive;
 static PyObject *__pyx_kp_s_Buffer_view_does_not_expose_stri;
 static PyObject *__pyx_n_u_C;
 static PyObject *__pyx_kp_s_Can_only_create_a_buffer_that_is;
@@ -3604,15 +3616,15 @@
 static PyObject *__pyx_n_s_asarray;
 static PyObject *__pyx_n_s_atleast_1d;
 static PyObject *__pyx_n_s_atleast_2d;
 static PyObject *__pyx_n_s_aveFy2CC;
 static PyObject *__pyx_n_s_average_cell_to_face_x;
 static PyObject *__pyx_n_s_average_cell_to_face_y;
 static PyObject *__pyx_n_s_average_cell_to_face_z;
-static PyObject *__pyx_n_s_average_edge_to_face_vector;
+static PyObject *__pyx_n_s_average_edge_to_face;
 static PyObject *__pyx_n_s_average_edge_x_to_cell;
 static PyObject *__pyx_n_s_average_edge_y_to_cell;
 static PyObject *__pyx_n_s_average_edge_z_to_cell;
 static PyObject *__pyx_n_s_average_face_x_to_cell;
 static PyObject *__pyx_n_s_average_face_z_to_cell;
 static PyObject *__pyx_n_s_average_node_to_edge_x;
 static PyObject *__pyx_n_s_average_node_to_edge_y;
@@ -3861,15 +3873,15 @@
 static PyObject *__pyx_n_u_yd;
 static PyObject *__pyx_n_u_yu;
 static PyObject *__pyx_n_u_z;
 static PyObject *__pyx_n_s_zEdge;
 static PyObject *__pyx_n_s_zFace;
 static PyObject *__pyx_n_u_zd;
 static PyObject *__pyx_n_s_zeros;
-static PyObject *__pyx_n_s_zerosOutside;
+static PyObject *__pyx_n_s_zeros_outside;
 static PyObject *__pyx_n_u_zu;
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_8TreeCell_5nodes___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext_TreeCell *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_8TreeCell_5edges___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext_TreeCell *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_8TreeCell_5faces___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext_TreeCell *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_8TreeCell_6center___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext_TreeCell *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_8TreeCell_6origin___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext_TreeCell *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_8TreeCell_2x0___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext_TreeCell *__pyx_v_self); /* proto */
@@ -3978,15 +3990,15 @@
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_56_deflate_faces_z(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_58_deflate_nodes(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_22average_edge_x_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_22average_edge_y_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_22average_edge_z_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_edge_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_edge_to_cell_vector___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_edge_to_face_vector___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_edge_to_face___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_22average_face_x_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_22average_face_y_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_22average_face_z_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_face_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_face_to_cell_vector___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_node_to_cell___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_22average_node_to_edge_x___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
@@ -4015,18 +4027,18 @@
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_12_getFacePxxx_Pxxx(PyObject *__pyx_self, PyObject *__pyx_v_xFace, PyObject *__pyx_v_yFace, PyObject *__pyx_v_zFace); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_72_getFacePxxx(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_74_getEdgeP(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_xEdge, PyObject *__pyx_v_yEdge, PyObject *__pyx_v_zEdge); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_11_getEdgePxx_Pxx(PyObject *__pyx_self, PyObject *__pyx_v_xEdge, PyObject *__pyx_v_yEdge); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_76_getEdgePxx(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_12_getEdgePxxx_Pxxx(PyObject *__pyx_self, PyObject *__pyx_v_xEdge, PyObject *__pyx_v_yEdge, PyObject *__pyx_v_zEdge); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_78_getEdgePxxx(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_80_getEdgeIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zerosOutside, PyObject *__pyx_v_direction); /* proto */
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_82_getFaceIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zerosOutside, PyObject *__pyx_v_direction); /* proto */
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_84_getNodeIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zerosOutside); /* proto */
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_86_getCellIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zerosOutside); /* proto */
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_80_getEdgeIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zeros_outside, PyObject *__pyx_v_direction); /* proto */
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_82_getFaceIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zeros_outside, PyObject *__pyx_v_direction); /* proto */
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_84_getNodeIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zeros_outside); /* proto */
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_86_getCellIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zeros_outside); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_10cell_nodes___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_10edge_nodes___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_88__getstate__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_90__setstate__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_state); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_92__getitem__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_key); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_11_ubc_indArr___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
 static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_10_ubc_order___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self); /* proto */
@@ -4087,16 +4099,16 @@
 static PyObject *__pyx_tp_new_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_array(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_float_0_0;
-static PyObject *__pyx_float_0_5;
 static PyObject *__pyx_float_1_0;
+static PyObject *__pyx_float_0_25;
 static PyObject *__pyx_int_0;
 static PyObject *__pyx_int_1;
 static PyObject *__pyx_int_2;
 static PyObject *__pyx_int_3;
 static PyObject *__pyx_int_4;
 static PyObject *__pyx_int_5;
 static PyObject *__pyx_int_6;
@@ -8961,49 +8973,49 @@
   __pyx_v_self->_average_edge_z_to_cell = Py_None;
 
   /* "discretize/_extensions/tree_ext.pyx":427
  *         self._average_edge_y_to_cell = None
  *         self._average_edge_z_to_cell = None
  *         self._average_edge_to_cell = None             # <<<<<<<<<<<<<<
  *         self._average_edge_to_cell_vector = None
- *         self._average_edge_to_face_vector = None
+ *         self._average_edge_to_face = None
  */
   __Pyx_TraceLine(427,0,__PYX_ERR(0, 427, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   __Pyx_GOTREF(__pyx_v_self->_average_edge_to_cell);
   __Pyx_DECREF(__pyx_v_self->_average_edge_to_cell);
   __pyx_v_self->_average_edge_to_cell = Py_None;
 
   /* "discretize/_extensions/tree_ext.pyx":428
  *         self._average_edge_z_to_cell = None
  *         self._average_edge_to_cell = None
  *         self._average_edge_to_cell_vector = None             # <<<<<<<<<<<<<<
- *         self._average_edge_to_face_vector = None
+ *         self._average_edge_to_face = None
  * 
  */
   __Pyx_TraceLine(428,0,__PYX_ERR(0, 428, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   __Pyx_GOTREF(__pyx_v_self->_average_edge_to_cell_vector);
   __Pyx_DECREF(__pyx_v_self->_average_edge_to_cell_vector);
   __pyx_v_self->_average_edge_to_cell_vector = Py_None;
 
   /* "discretize/_extensions/tree_ext.pyx":429
  *         self._average_edge_to_cell = None
  *         self._average_edge_to_cell_vector = None
- *         self._average_edge_to_face_vector = None             # <<<<<<<<<<<<<<
+ *         self._average_edge_to_face = None             # <<<<<<<<<<<<<<
  * 
  *         self._average_node_to_cell = None
  */
   __Pyx_TraceLine(429,0,__PYX_ERR(0, 429, __pyx_L1_error))
-  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face_vector, Py_None) < 0) __PYX_ERR(0, 429, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face, Py_None) < 0) __PYX_ERR(0, 429, __pyx_L1_error)
 
   /* "discretize/_extensions/tree_ext.pyx":431
- *         self._average_edge_to_face_vector = None
+ *         self._average_edge_to_face = None
  * 
  *         self._average_node_to_cell = None             # <<<<<<<<<<<<<<
  *         self._average_node_to_edge = None
  *         self._average_node_to_face = None
  */
   __Pyx_TraceLine(431,0,__PYX_ERR(0, 431, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
@@ -13073,15 +13085,15 @@
  *     def refine_vertical_trianglular_prism(self, triangle, h, levels, finalize=True, diagonal_balance=None):             # <<<<<<<<<<<<<<
  *         """Refine the :class:`~discretize.TreeMesh` along the trianglular prism to the desired level.
  * 
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_17refine_vertical_trianglular_prism(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_16refine_vertical_trianglular_prism[] = "_TreeMesh.refine_vertical_trianglular_prism(self, triangle, h, levels, finalize=True, diagonal_balance=None)\nRefine the :class:`~discretize.TreeMesh` along the trianglular prism to the desired level.\n\n        Refines the TreeMesh by determining if a cell intersects the given trianglular prism(s)\n        to the prescribed level(s).\n\n        Parameters\n        ----------\n        triangle : (N, 3, dim) array_like\n            The nodes of the bottom triangle(s).\n        h : (N) array_like\n            The height of the prism(s).\n        levels : int or (N) array_like of int\n            The level to refine intersecting cells to.\n        finalize : bool, optional\n            Whether to finalize after refining\n        diagonal_balance : bool or None, optional\n            Whether to balance cells diagonally in the refinement, `None` implies using\n            the same setting used to instantiate the TreeMesh`.\n\n        See Also\n        --------\n        refine_surface\n\n        Examples\n        --------\n        We create a simple mesh and refine the TreeMesh such that all cells that\n        intersect the line segment path are at the given levels.\n\n        >>> import discretize\n        >>> import matplotlib.pyplot as plt\n        >>> import matplotlib.patches as patches\n        >>> tree_mesh = discretize.TreeMesh([32, 32, 32])\n        >>> tree_mesh.max_level\n        5\n\n        Next we define the bottom points of the prism, its heights, and the level we\n        want to refine to, then refine the mesh.\n\n        >>> triangle = [[0.14, 0.31, 0.21], [0.32, 0.96, 0.34], [0.87, 0.23, 0.12]]\n        >>> height = 0.35\n        >>> levels = 5\n        >>> mesh.refine_vertical_trianglular_prism(triangle, height, levels)\n\n        Now lets look at the mesh.\n\n        >>> v = mesh.cell_levels_by_index(np.arange(mesh.n_cells))\n        >>> fig, axs = plt.subplots(1, 3, figsize=(12,4))\n        >>> mesh.plot_slice(v, ax=axs[0], normal='x', grid=True, cl""im=[2, 5])\n        >>> mesh.plot_slice(v, ax=axs[1], normal='y', grid=True, clim=[2, 5])\n        >>> mesh.plot_slice(v, ax=axs[2], normal='z', grid=True, clim=[2, 5])\n        >>> plt.show()\n\n        ";
+static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_16refine_vertical_trianglular_prism[] = "_TreeMesh.refine_vertical_trianglular_prism(self, triangle, h, levels, finalize=True, diagonal_balance=None)\nRefine the :class:`~discretize.TreeMesh` along the trianglular prism to the desired level.\n\n        Refines the TreeMesh by determining if a cell intersects the given trianglular prism(s)\n        to the prescribed level(s).\n\n        Parameters\n        ----------\n        triangle : (N, 3, dim) array_like\n            The nodes of the bottom triangle(s).\n        h : (N) array_like\n            The height of the prism(s).\n        levels : int or (N) array_like of int\n            The level to refine intersecting cells to.\n        finalize : bool, optional\n            Whether to finalize after refining\n        diagonal_balance : bool or None, optional\n            Whether to balance cells diagonally in the refinement, `None` implies using\n            the same setting used to instantiate the TreeMesh`.\n\n        See Also\n        --------\n        refine_surface\n\n        Examples\n        --------\n        We create a simple mesh and refine the TreeMesh such that all cells that\n        intersect the line segment path are at the given levels.\n\n        >>> import discretize\n        >>> import matplotlib.pyplot as plt\n        >>> import matplotlib.patches as patches\n        >>> mesh = discretize.TreeMesh([32, 32, 32])\n        >>> mesh.max_level\n        5\n\n        Next we define the bottom points of the prism, its heights, and the level we\n        want to refine to, then refine the mesh.\n\n        >>> triangle = [[0.14, 0.31, 0.21], [0.32, 0.96, 0.34], [0.87, 0.23, 0.12]]\n        >>> height = 0.35\n        >>> levels = 5\n        >>> tree_mesh.refine_vertical_trianglular_prism(triangle, height, levels)\n\n        Now lets look at the mesh.\n\n        >>> v = tree_mesh.cell_levels_by_index(np.arange(tree_mesh.n_cells))\n        >>> fig, axs = plt.subplots(1, 3, figsize=(12,4))\n        >>> tree_mesh.plot_slice(v, ax=axs[0], normal='x', gri""d=True, clim=[2, 5])\n        >>> tree_mesh.plot_slice(v, ax=axs[1], normal='y', grid=True, clim=[2, 5])\n        >>> tree_mesh.plot_slice(v, ax=axs[2], normal='z', grid=True, clim=[2, 5])\n        >>> plt.show()\n\n        ";
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_17refine_vertical_trianglular_prism(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_triangle = 0;
   PyObject *__pyx_v_h = 0;
   PyObject *__pyx_v_levels = 0;
   PyObject *__pyx_v_finalize = 0;
   PyObject *__pyx_v_diagonal_balance = 0;
   int __pyx_lineno = 0;
@@ -46735,33 +46747,33 @@
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "discretize/_extensions/tree_ext.pyx":3915
  * 
  *     @property
- *     def average_edge_to_face_vector(self):             # <<<<<<<<<<<<<<
- *         """Averaging operator from edges to faces (vector quantities).
+ *     def average_edge_to_face(self):             # <<<<<<<<<<<<<<
+ *         r"""Averaging operator from edges to faces.
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_edge_to_face_vector_1__get__(PyObject *__pyx_v_self); /*proto*/
-static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_edge_to_face_vector_1__get__(PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_edge_to_face_1__get__(PyObject *__pyx_v_self); /*proto*/
+static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_edge_to_face_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__get__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_edge_to_face_vector___get__(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self));
+  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_edge_to_face___get__(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_edge_to_face_vector___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self) {
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_edge_to_face___get__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self) {
   CYTHON_UNUSED int_t __pyx_v_dim;
   __Pyx_memviewslice __pyx_v_I = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_J = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_V = { 0, 0, { 0 }, { 0 }, { 0 } };
   Face *__pyx_v_face;
   int_t __pyx_v_ii;
   int_t __pyx_v_face_offset_y;
@@ -46793,481 +46805,481 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
   __Pyx_TraceCall("__get__", __pyx_f[0], 3915, 0, __PYX_ERR(0, 3915, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":3949
- *         defined on x-faces.
+  /* "discretize/_extensions/tree_ext.pyx":3944
+ *         where :math:`\mathbf{u_f}` is a quantity defined on the respective faces.
  *         """
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             return sp.diags(
  *                 [1, 1],
  */
-  __Pyx_TraceLine(3949,0,__PYX_ERR(0, 3949, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3949, __pyx_L1_error)
+  __Pyx_TraceLine(3944,0,__PYX_ERR(0, 3944, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3944, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3949, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3944, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3949, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 3944, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (__pyx_t_3) {
 
-    /* "discretize/_extensions/tree_ext.pyx":3950
+    /* "discretize/_extensions/tree_ext.pyx":3945
  *         """
  *         if self.dim == 2:
  *             return sp.diags(             # <<<<<<<<<<<<<<
  *                 [1, 1],
  *                 [-self.n_faces_x, self.n_faces_y],
  */
-    __Pyx_TraceLine(3950,0,__PYX_ERR(0, 3950, __pyx_L1_error))
+    __Pyx_TraceLine(3945,0,__PYX_ERR(0, 3945, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sp); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3950, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sp); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_diags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3950, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_diags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":3951
+    /* "discretize/_extensions/tree_ext.pyx":3946
  *         if self.dim == 2:
  *             return sp.diags(
  *                 [1, 1],             # <<<<<<<<<<<<<<
  *                 [-self.n_faces_x, self.n_faces_y],
  *                 shape=(self.n_faces, self.n_edges)
  */
-    __Pyx_TraceLine(3951,0,__PYX_ERR(0, 3951, __pyx_L1_error))
-    __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3951, __pyx_L1_error)
+    __Pyx_TraceLine(3946,0,__PYX_ERR(0, 3946, __pyx_L1_error))
+    __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3946, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_int_1);
     __Pyx_GIVEREF(__pyx_int_1);
     PyList_SET_ITEM(__pyx_t_2, 0, __pyx_int_1);
     __Pyx_INCREF(__pyx_int_1);
     __Pyx_GIVEREF(__pyx_int_1);
     PyList_SET_ITEM(__pyx_t_2, 1, __pyx_int_1);
 
-    /* "discretize/_extensions/tree_ext.pyx":3952
+    /* "discretize/_extensions/tree_ext.pyx":3947
  *             return sp.diags(
  *                 [1, 1],
  *                 [-self.n_faces_x, self.n_faces_y],             # <<<<<<<<<<<<<<
  *                 shape=(self.n_faces, self.n_edges)
  *             )
  */
-    __Pyx_TraceLine(3952,0,__PYX_ERR(0, 3952, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3952, __pyx_L1_error)
+    __Pyx_TraceLine(3947,0,__PYX_ERR(0, 3947, __pyx_L1_error))
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3947, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyNumber_Negative(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3952, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Negative(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3947, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3952, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3947, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_6 = PyList_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3952, __pyx_L1_error)
+    __pyx_t_6 = PyList_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3947, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_5);
     PyList_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_4);
     PyList_SET_ITEM(__pyx_t_6, 1, __pyx_t_4);
     __pyx_t_5 = 0;
     __pyx_t_4 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":3950
+    /* "discretize/_extensions/tree_ext.pyx":3945
  *         """
  *         if self.dim == 2:
  *             return sp.diags(             # <<<<<<<<<<<<<<
  *                 [1, 1],
  *                 [-self.n_faces_x, self.n_faces_y],
  */
-    __Pyx_TraceLine(3950,0,__PYX_ERR(0, 3950, __pyx_L1_error))
-    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3950, __pyx_L1_error)
+    __Pyx_TraceLine(3945,0,__PYX_ERR(0, 3945, __pyx_L1_error))
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_2);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_6);
     __pyx_t_2 = 0;
     __pyx_t_6 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":3953
+    /* "discretize/_extensions/tree_ext.pyx":3948
  *                 [1, 1],
  *                 [-self.n_faces_x, self.n_faces_y],
  *                 shape=(self.n_faces, self.n_edges)             # <<<<<<<<<<<<<<
  *             )
  * 
  */
-    __Pyx_TraceLine(3953,0,__PYX_ERR(0, 3953, __pyx_L1_error))
-    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3953, __pyx_L1_error)
+    __Pyx_TraceLine(3948,0,__PYX_ERR(0, 3948, __pyx_L1_error))
+    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3948, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3953, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3948, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3953, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3948, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3953, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3948, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_2);
     PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_5);
     __pyx_t_2 = 0;
     __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 3953, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 3948, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":3950
+    /* "discretize/_extensions/tree_ext.pyx":3945
  *         """
  *         if self.dim == 2:
  *             return sp.diags(             # <<<<<<<<<<<<<<
  *                 [1, 1],
  *                 [-self.n_faces_x, self.n_faces_y],
  */
-    __Pyx_TraceLine(3950,0,__PYX_ERR(0, 3950, __pyx_L1_error))
-    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3950, __pyx_L1_error)
+    __Pyx_TraceLine(3945,0,__PYX_ERR(0, 3945, __pyx_L1_error))
+    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3945, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_r = __pyx_t_7;
     __pyx_t_7 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":3949
- *         defined on x-faces.
+    /* "discretize/_extensions/tree_ext.pyx":3944
+ *         where :math:`\mathbf{u_f}` is a quantity defined on the respective faces.
  *         """
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             return sp.diags(
  *                 [1, 1],
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":3956
+  /* "discretize/_extensions/tree_ext.pyx":3951
  *             )
  * 
- *         if self._average_edge_to_face_vector is not None:             # <<<<<<<<<<<<<<
- *             return self._average_edge_to_face_vector
+ *         if self._average_edge_to_face is not None:             # <<<<<<<<<<<<<<
+ *             return self._average_edge_to_face
  *         cdef:
  */
-  __Pyx_TraceLine(3956,0,__PYX_ERR(0, 3956, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face_vector); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3956, __pyx_L1_error)
+  __Pyx_TraceLine(3951,0,__PYX_ERR(0, 3951, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3951, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_3 = (__pyx_t_7 != Py_None);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_t_8 = (__pyx_t_3 != 0);
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":3957
+    /* "discretize/_extensions/tree_ext.pyx":3952
  * 
- *         if self._average_edge_to_face_vector is not None:
- *             return self._average_edge_to_face_vector             # <<<<<<<<<<<<<<
+ *         if self._average_edge_to_face is not None:
+ *             return self._average_edge_to_face             # <<<<<<<<<<<<<<
  *         cdef:
  *             int_t dim = self._dim
  */
-    __Pyx_TraceLine(3957,0,__PYX_ERR(0, 3957, __pyx_L1_error))
+    __Pyx_TraceLine(3952,0,__PYX_ERR(0, 3952, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face_vector); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3957, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3952, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __pyx_r = __pyx_t_7;
     __pyx_t_7 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":3956
+    /* "discretize/_extensions/tree_ext.pyx":3951
  *             )
  * 
- *         if self._average_edge_to_face_vector is not None:             # <<<<<<<<<<<<<<
- *             return self._average_edge_to_face_vector
+ *         if self._average_edge_to_face is not None:             # <<<<<<<<<<<<<<
+ *             return self._average_edge_to_face
  *         cdef:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":3959
- *             return self._average_edge_to_face_vector
+  /* "discretize/_extensions/tree_ext.pyx":3954
+ *             return self._average_edge_to_face
  *         cdef:
  *             int_t dim = self._dim             # <<<<<<<<<<<<<<
  *             np.int64_t[:] I = np.empty(4*self.n_faces, dtype=np.int64)
  *             np.int64_t[:] J = np.empty(4*self.n_faces, dtype=np.int64)
  */
-  __Pyx_TraceLine(3959,0,__PYX_ERR(0, 3959, __pyx_L1_error))
+  __Pyx_TraceLine(3954,0,__PYX_ERR(0, 3954, __pyx_L1_error))
   __pyx_t_9 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_9;
 
-  /* "discretize/_extensions/tree_ext.pyx":3960
+  /* "discretize/_extensions/tree_ext.pyx":3955
  *         cdef:
  *             int_t dim = self._dim
  *             np.int64_t[:] I = np.empty(4*self.n_faces, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.int64_t[:] J = np.empty(4*self.n_faces, dtype=np.int64)
- *             np.float64_t[:] V = np.full(4*self.n_faces, 0.5, dtype=np.float64)
+ *             np.float64_t[:] V = np.full(4*self.n_faces, 0.25, dtype=np.float64)
  */
-  __Pyx_TraceLine(3960,0,__PYX_ERR(0, 3960, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __Pyx_TraceLine(3955,0,__PYX_ERR(0, 3955, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = PyNumber_Multiply(__pyx_int_4, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Multiply(__pyx_int_4, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 3960, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 3960, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 3955, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_I = __pyx_t_10;
   __pyx_t_10.memview = NULL;
   __pyx_t_10.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":3961
+  /* "discretize/_extensions/tree_ext.pyx":3956
  *             int_t dim = self._dim
  *             np.int64_t[:] I = np.empty(4*self.n_faces, dtype=np.int64)
  *             np.int64_t[:] J = np.empty(4*self.n_faces, dtype=np.int64)             # <<<<<<<<<<<<<<
- *             np.float64_t[:] V = np.full(4*self.n_faces, 0.5, dtype=np.float64)
+ *             np.float64_t[:] V = np.full(4*self.n_faces, 0.25, dtype=np.float64)
  *             Face *face
  */
-  __Pyx_TraceLine(3961,0,__PYX_ERR(0, 3961, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __Pyx_TraceLine(3956,0,__PYX_ERR(0, 3956, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_int_4, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_int_4, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 3961, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 3961, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 3956, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_J = __pyx_t_10;
   __pyx_t_10.memview = NULL;
   __pyx_t_10.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":3962
+  /* "discretize/_extensions/tree_ext.pyx":3957
  *             np.int64_t[:] I = np.empty(4*self.n_faces, dtype=np.int64)
  *             np.int64_t[:] J = np.empty(4*self.n_faces, dtype=np.int64)
- *             np.float64_t[:] V = np.full(4*self.n_faces, 0.5, dtype=np.float64)             # <<<<<<<<<<<<<<
+ *             np.float64_t[:] V = np.full(4*self.n_faces, 0.25, dtype=np.float64)             # <<<<<<<<<<<<<<
  *             Face *face
  *             int_t ii
  */
-  __Pyx_TraceLine(3962,0,__PYX_ERR(0, 3962, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __Pyx_TraceLine(3957,0,__PYX_ERR(0, 3957, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_full); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_full); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_int_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_int_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
-  __Pyx_INCREF(__pyx_float_0_5);
-  __Pyx_GIVEREF(__pyx_float_0_5);
-  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_float_0_5);
+  __Pyx_INCREF(__pyx_float_0_25);
+  __Pyx_GIVEREF(__pyx_float_0_25);
+  PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_float_0_25);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 3962, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 3962, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 3957, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_V = __pyx_t_11;
   __pyx_t_11.memview = NULL;
   __pyx_t_11.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":3965
+  /* "discretize/_extensions/tree_ext.pyx":3960
  *             Face *face
  *             int_t ii
  *             int_t face_offset_y = self.n_faces_x             # <<<<<<<<<<<<<<
  *             int_t face_offset_z = self.n_faces_x + self.n_faces_y
  *             int_t edge_offset_y = self.n_total_edges_x
  */
-  __Pyx_TraceLine(3965,0,__PYX_ERR(0, 3965, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3965, __pyx_L1_error)
+  __Pyx_TraceLine(3960,0,__PYX_ERR(0, 3960, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3960, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_9 = __Pyx_PyInt_As_int_t(__pyx_t_6); if (unlikely((__pyx_t_9 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3965, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyInt_As_int_t(__pyx_t_6); if (unlikely((__pyx_t_9 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3960, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_face_offset_y = __pyx_t_9;
 
-  /* "discretize/_extensions/tree_ext.pyx":3966
+  /* "discretize/_extensions/tree_ext.pyx":3961
  *             int_t ii
  *             int_t face_offset_y = self.n_faces_x
  *             int_t face_offset_z = self.n_faces_x + self.n_faces_y             # <<<<<<<<<<<<<<
  *             int_t edge_offset_y = self.n_total_edges_x
  *             int_t edge_offset_z = self.n_total_edges_x + self.n_total_edges_y
  */
-  __Pyx_TraceLine(3966,0,__PYX_ERR(0, 3966, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3966, __pyx_L1_error)
+  __Pyx_TraceLine(3961,0,__PYX_ERR(0, 3961, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3966, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = PyNumber_Add(__pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3966, __pyx_L1_error)
+  __pyx_t_1 = PyNumber_Add(__pyx_t_6, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3961, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyInt_As_int_t(__pyx_t_1); if (unlikely((__pyx_t_9 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3966, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyInt_As_int_t(__pyx_t_1); if (unlikely((__pyx_t_9 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3961, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_face_offset_z = __pyx_t_9;
 
-  /* "discretize/_extensions/tree_ext.pyx":3967
+  /* "discretize/_extensions/tree_ext.pyx":3962
  *             int_t face_offset_y = self.n_faces_x
  *             int_t face_offset_z = self.n_faces_x + self.n_faces_y
  *             int_t edge_offset_y = self.n_total_edges_x             # <<<<<<<<<<<<<<
  *             int_t edge_offset_z = self.n_total_edges_x + self.n_total_edges_y
  *             double area
  */
-  __Pyx_TraceLine(3967,0,__PYX_ERR(0, 3967, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3967, __pyx_L1_error)
+  __Pyx_TraceLine(3962,0,__PYX_ERR(0, 3962, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3962, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_9 = __Pyx_PyInt_As_int_t(__pyx_t_1); if (unlikely((__pyx_t_9 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3967, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyInt_As_int_t(__pyx_t_1); if (unlikely((__pyx_t_9 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3962, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_edge_offset_y = __pyx_t_9;
 
-  /* "discretize/_extensions/tree_ext.pyx":3968
+  /* "discretize/_extensions/tree_ext.pyx":3963
  *             int_t face_offset_z = self.n_faces_x + self.n_faces_y
  *             int_t edge_offset_y = self.n_total_edges_x
  *             int_t edge_offset_z = self.n_total_edges_x + self.n_total_edges_y             # <<<<<<<<<<<<<<
  *             double area
  * 
  */
-  __Pyx_TraceLine(3968,0,__PYX_ERR(0, 3968, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3968, __pyx_L1_error)
+  __Pyx_TraceLine(3963,0,__PYX_ERR(0, 3963, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_y); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3968, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_y); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyNumber_Add(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3968, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Add(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3963, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_9 = __Pyx_PyInt_As_int_t(__pyx_t_6); if (unlikely((__pyx_t_9 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3968, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyInt_As_int_t(__pyx_t_6); if (unlikely((__pyx_t_9 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3963, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_edge_offset_z = __pyx_t_9;
 
-  /* "discretize/_extensions/tree_ext.pyx":3971
+  /* "discretize/_extensions/tree_ext.pyx":3966
  *             double area
  * 
  *         for it in self.tree.faces_x:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-  __Pyx_TraceLine(3971,0,__PYX_ERR(0, 3971, __pyx_L1_error))
+  __Pyx_TraceLine(3966,0,__PYX_ERR(0, 3966, __pyx_L1_error))
   __pyx_t_13 = &__pyx_v_self->tree->faces_x;
   __pyx_t_12 = __pyx_t_13->begin();
   for (;;) {
     if (!(__pyx_t_12 != __pyx_t_13->end())) break;
     __pyx_t_14 = *__pyx_t_12;
     ++__pyx_t_12;
     __pyx_v_it = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":3972
+    /* "discretize/_extensions/tree_ext.pyx":3967
  * 
  *         for it in self.tree.faces_x:
  *             face = it.second             # <<<<<<<<<<<<<<
  *             if face.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(3972,0,__PYX_ERR(0, 3972, __pyx_L1_error))
+    __Pyx_TraceLine(3967,0,__PYX_ERR(0, 3967, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_it.second;
     __pyx_v_face = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":3973
+    /* "discretize/_extensions/tree_ext.pyx":3968
  *         for it in self.tree.faces_x:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index
  */
-    __Pyx_TraceLine(3973,0,__PYX_ERR(0, 3973, __pyx_L1_error))
+    __Pyx_TraceLine(3968,0,__PYX_ERR(0, 3968, __pyx_L1_error))
     __pyx_t_8 = (__pyx_v_face->hanging != 0);
     if (__pyx_t_8) {
 
-      /* "discretize/_extensions/tree_ext.pyx":3974
+      /* "discretize/_extensions/tree_ext.pyx":3969
  *             face = it.second
  *             if face.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = face.index
  *             I[4*ii : 4*ii + 4] = ii
  */
-      __Pyx_TraceLine(3974,0,__PYX_ERR(0, 3974, __pyx_L1_error))
+      __Pyx_TraceLine(3969,0,__PYX_ERR(0, 3969, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":3973
+      /* "discretize/_extensions/tree_ext.pyx":3968
  *         for it in self.tree.faces_x:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":3975
+    /* "discretize/_extensions/tree_ext.pyx":3970
  *             if face.hanging:
  *                 continue
  *             ii = face.index             # <<<<<<<<<<<<<<
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z
  */
-    __Pyx_TraceLine(3975,0,__PYX_ERR(0, 3975, __pyx_L1_error))
+    __Pyx_TraceLine(3970,0,__PYX_ERR(0, 3970, __pyx_L1_error))
     __pyx_t_9 = __pyx_v_face->index;
     __pyx_v_ii = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":3976
+    /* "discretize/_extensions/tree_ext.pyx":3971
  *                 continue
  *             ii = face.index
  *             I[4*ii : 4*ii + 4] = ii             # <<<<<<<<<<<<<<
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z
  *             J[4*ii + 1] = face.edges[1].index + edge_offset_y
  */
-    __Pyx_TraceLine(3976,0,__PYX_ERR(0, 3976, __pyx_L1_error))
+    __Pyx_TraceLine(3971,0,__PYX_ERR(0, 3971, __pyx_L1_error))
     __pyx_t_10.data = __pyx_v_I.data;
     __pyx_t_10.memview = __pyx_v_I.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_10, 0);
     __pyx_t_16 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_10,
     __pyx_v_I.shape[0], __pyx_v_I.strides[0], __pyx_v_I.suboffsets[0],
@@ -47278,15 +47290,15 @@
     ((4 * __pyx_v_ii) + 4),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 3976, __pyx_L1_error)
+    __PYX_ERR(0, 3971, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_int64_t __pyx_temp_scalar = __pyx_v_ii;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_10.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_10.strides[0];
@@ -47299,180 +47311,180 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":3977
+    /* "discretize/_extensions/tree_ext.pyx":3972
  *             ii = face.index
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z             # <<<<<<<<<<<<<<
  *             J[4*ii + 1] = face.edges[1].index + edge_offset_y
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_z
  */
-    __Pyx_TraceLine(3977,0,__PYX_ERR(0, 3977, __pyx_L1_error))
+    __Pyx_TraceLine(3972,0,__PYX_ERR(0, 3972, __pyx_L1_error))
     __pyx_t_17 = (4 * __pyx_v_ii);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3977, __pyx_L1_error)
+      __PYX_ERR(0, 3972, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = ((__pyx_v_face->edges[0])->index + __pyx_v_edge_offset_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":3978
+    /* "discretize/_extensions/tree_ext.pyx":3973
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z
  *             J[4*ii + 1] = face.edges[1].index + edge_offset_y             # <<<<<<<<<<<<<<
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_z
  *             J[4*ii + 3] = face.edges[3].index + edge_offset_y
  */
-    __Pyx_TraceLine(3978,0,__PYX_ERR(0, 3978, __pyx_L1_error))
+    __Pyx_TraceLine(3973,0,__PYX_ERR(0, 3973, __pyx_L1_error))
     __pyx_t_17 = ((4 * __pyx_v_ii) + 1);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3978, __pyx_L1_error)
+      __PYX_ERR(0, 3973, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = ((__pyx_v_face->edges[1])->index + __pyx_v_edge_offset_y);
 
-    /* "discretize/_extensions/tree_ext.pyx":3979
+    /* "discretize/_extensions/tree_ext.pyx":3974
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z
  *             J[4*ii + 1] = face.edges[1].index + edge_offset_y
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_z             # <<<<<<<<<<<<<<
  *             J[4*ii + 3] = face.edges[3].index + edge_offset_y
  * 
  */
-    __Pyx_TraceLine(3979,0,__PYX_ERR(0, 3979, __pyx_L1_error))
+    __Pyx_TraceLine(3974,0,__PYX_ERR(0, 3974, __pyx_L1_error))
     __pyx_t_17 = ((4 * __pyx_v_ii) + 2);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3979, __pyx_L1_error)
+      __PYX_ERR(0, 3974, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = ((__pyx_v_face->edges[2])->index + __pyx_v_edge_offset_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":3980
+    /* "discretize/_extensions/tree_ext.pyx":3975
  *             J[4*ii + 1] = face.edges[1].index + edge_offset_y
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_z
  *             J[4*ii + 3] = face.edges[3].index + edge_offset_y             # <<<<<<<<<<<<<<
  * 
  *         for it in self.tree.faces_y:
  */
-    __Pyx_TraceLine(3980,0,__PYX_ERR(0, 3980, __pyx_L1_error))
+    __Pyx_TraceLine(3975,0,__PYX_ERR(0, 3975, __pyx_L1_error))
     __pyx_t_17 = ((4 * __pyx_v_ii) + 3);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3980, __pyx_L1_error)
+      __PYX_ERR(0, 3975, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = ((__pyx_v_face->edges[3])->index + __pyx_v_edge_offset_y);
 
-    /* "discretize/_extensions/tree_ext.pyx":3971
+    /* "discretize/_extensions/tree_ext.pyx":3966
  *             double area
  * 
  *         for it in self.tree.faces_x:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-    __Pyx_TraceLine(3971,0,__PYX_ERR(0, 3971, __pyx_L1_error))
+    __Pyx_TraceLine(3966,0,__PYX_ERR(0, 3966, __pyx_L1_error))
     __pyx_L5_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":3982
+  /* "discretize/_extensions/tree_ext.pyx":3977
  *             J[4*ii + 3] = face.edges[3].index + edge_offset_y
  * 
  *         for it in self.tree.faces_y:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-  __Pyx_TraceLine(3982,0,__PYX_ERR(0, 3982, __pyx_L1_error))
+  __Pyx_TraceLine(3977,0,__PYX_ERR(0, 3977, __pyx_L1_error))
   __pyx_t_13 = &__pyx_v_self->tree->faces_y;
   __pyx_t_12 = __pyx_t_13->begin();
   for (;;) {
     if (!(__pyx_t_12 != __pyx_t_13->end())) break;
     __pyx_t_14 = *__pyx_t_12;
     ++__pyx_t_12;
     __pyx_v_it = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":3983
+    /* "discretize/_extensions/tree_ext.pyx":3978
  * 
  *         for it in self.tree.faces_y:
  *             face = it.second             # <<<<<<<<<<<<<<
  *             if face.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(3983,0,__PYX_ERR(0, 3983, __pyx_L1_error))
+    __Pyx_TraceLine(3978,0,__PYX_ERR(0, 3978, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_it.second;
     __pyx_v_face = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":3984
+    /* "discretize/_extensions/tree_ext.pyx":3979
  *         for it in self.tree.faces_y:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index + face_offset_y
  */
-    __Pyx_TraceLine(3984,0,__PYX_ERR(0, 3984, __pyx_L1_error))
+    __Pyx_TraceLine(3979,0,__PYX_ERR(0, 3979, __pyx_L1_error))
     __pyx_t_8 = (__pyx_v_face->hanging != 0);
     if (__pyx_t_8) {
 
-      /* "discretize/_extensions/tree_ext.pyx":3985
+      /* "discretize/_extensions/tree_ext.pyx":3980
  *             face = it.second
  *             if face.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = face.index + face_offset_y
  *             I[4*ii : 4*ii + 4] = ii
  */
-      __Pyx_TraceLine(3985,0,__PYX_ERR(0, 3985, __pyx_L1_error))
+      __Pyx_TraceLine(3980,0,__PYX_ERR(0, 3980, __pyx_L1_error))
       goto __pyx_L8_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":3984
+      /* "discretize/_extensions/tree_ext.pyx":3979
  *         for it in self.tree.faces_y:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index + face_offset_y
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":3986
+    /* "discretize/_extensions/tree_ext.pyx":3981
  *             if face.hanging:
  *                 continue
  *             ii = face.index + face_offset_y             # <<<<<<<<<<<<<<
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z
  */
-    __Pyx_TraceLine(3986,0,__PYX_ERR(0, 3986, __pyx_L1_error))
+    __Pyx_TraceLine(3981,0,__PYX_ERR(0, 3981, __pyx_L1_error))
     __pyx_v_ii = (__pyx_v_face->index + __pyx_v_face_offset_y);
 
-    /* "discretize/_extensions/tree_ext.pyx":3987
+    /* "discretize/_extensions/tree_ext.pyx":3982
  *                 continue
  *             ii = face.index + face_offset_y
  *             I[4*ii : 4*ii + 4] = ii             # <<<<<<<<<<<<<<
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z
  *             J[4*ii + 1] = face.edges[1].index
  */
-    __Pyx_TraceLine(3987,0,__PYX_ERR(0, 3987, __pyx_L1_error))
+    __Pyx_TraceLine(3982,0,__PYX_ERR(0, 3982, __pyx_L1_error))
     __pyx_t_10.data = __pyx_v_I.data;
     __pyx_t_10.memview = __pyx_v_I.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_10, 0);
     __pyx_t_16 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_10,
     __pyx_v_I.shape[0], __pyx_v_I.strides[0], __pyx_v_I.suboffsets[0],
@@ -47483,15 +47495,15 @@
     ((4 * __pyx_v_ii) + 4),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 3987, __pyx_L1_error)
+    __PYX_ERR(0, 3982, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_int64_t __pyx_temp_scalar = __pyx_v_ii;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_10.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_10.strides[0];
@@ -47504,182 +47516,182 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":3988
+    /* "discretize/_extensions/tree_ext.pyx":3983
  *             ii = face.index + face_offset_y
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z             # <<<<<<<<<<<<<<
  *             J[4*ii + 1] = face.edges[1].index
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_z
  */
-    __Pyx_TraceLine(3988,0,__PYX_ERR(0, 3988, __pyx_L1_error))
+    __Pyx_TraceLine(3983,0,__PYX_ERR(0, 3983, __pyx_L1_error))
     __pyx_t_17 = (4 * __pyx_v_ii);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3988, __pyx_L1_error)
+      __PYX_ERR(0, 3983, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = ((__pyx_v_face->edges[0])->index + __pyx_v_edge_offset_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":3989
+    /* "discretize/_extensions/tree_ext.pyx":3984
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z
  *             J[4*ii + 1] = face.edges[1].index             # <<<<<<<<<<<<<<
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_z
  *             J[4*ii + 3] = face.edges[3].index
  */
-    __Pyx_TraceLine(3989,0,__PYX_ERR(0, 3989, __pyx_L1_error))
+    __Pyx_TraceLine(3984,0,__PYX_ERR(0, 3984, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_face->edges[1])->index;
     __pyx_t_17 = ((4 * __pyx_v_ii) + 1);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3989, __pyx_L1_error)
+      __PYX_ERR(0, 3984, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":3990
+    /* "discretize/_extensions/tree_ext.pyx":3985
  *             J[4*ii    ] = face.edges[0].index + edge_offset_z
  *             J[4*ii + 1] = face.edges[1].index
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_z             # <<<<<<<<<<<<<<
  *             J[4*ii + 3] = face.edges[3].index
  * 
  */
-    __Pyx_TraceLine(3990,0,__PYX_ERR(0, 3990, __pyx_L1_error))
+    __Pyx_TraceLine(3985,0,__PYX_ERR(0, 3985, __pyx_L1_error))
     __pyx_t_17 = ((4 * __pyx_v_ii) + 2);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3990, __pyx_L1_error)
+      __PYX_ERR(0, 3985, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = ((__pyx_v_face->edges[2])->index + __pyx_v_edge_offset_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":3991
+    /* "discretize/_extensions/tree_ext.pyx":3986
  *             J[4*ii + 1] = face.edges[1].index
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_z
  *             J[4*ii + 3] = face.edges[3].index             # <<<<<<<<<<<<<<
  * 
  *         for it in self.tree.faces_z:
  */
-    __Pyx_TraceLine(3991,0,__PYX_ERR(0, 3991, __pyx_L1_error))
+    __Pyx_TraceLine(3986,0,__PYX_ERR(0, 3986, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_face->edges[3])->index;
     __pyx_t_17 = ((4 * __pyx_v_ii) + 3);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3991, __pyx_L1_error)
+      __PYX_ERR(0, 3986, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":3982
+    /* "discretize/_extensions/tree_ext.pyx":3977
  *             J[4*ii + 3] = face.edges[3].index + edge_offset_y
  * 
  *         for it in self.tree.faces_y:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-    __Pyx_TraceLine(3982,0,__PYX_ERR(0, 3982, __pyx_L1_error))
+    __Pyx_TraceLine(3977,0,__PYX_ERR(0, 3977, __pyx_L1_error))
     __pyx_L8_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":3993
+  /* "discretize/_extensions/tree_ext.pyx":3988
  *             J[4*ii + 3] = face.edges[3].index
  * 
  *         for it in self.tree.faces_z:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-  __Pyx_TraceLine(3993,0,__PYX_ERR(0, 3993, __pyx_L1_error))
+  __Pyx_TraceLine(3988,0,__PYX_ERR(0, 3988, __pyx_L1_error))
   __pyx_t_13 = &__pyx_v_self->tree->faces_z;
   __pyx_t_12 = __pyx_t_13->begin();
   for (;;) {
     if (!(__pyx_t_12 != __pyx_t_13->end())) break;
     __pyx_t_14 = *__pyx_t_12;
     ++__pyx_t_12;
     __pyx_v_it = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":3994
+    /* "discretize/_extensions/tree_ext.pyx":3989
  * 
  *         for it in self.tree.faces_z:
  *             face = it.second             # <<<<<<<<<<<<<<
  *             if face.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(3994,0,__PYX_ERR(0, 3994, __pyx_L1_error))
+    __Pyx_TraceLine(3989,0,__PYX_ERR(0, 3989, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_it.second;
     __pyx_v_face = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":3995
+    /* "discretize/_extensions/tree_ext.pyx":3990
  *         for it in self.tree.faces_z:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index + face_offset_z
  */
-    __Pyx_TraceLine(3995,0,__PYX_ERR(0, 3995, __pyx_L1_error))
+    __Pyx_TraceLine(3990,0,__PYX_ERR(0, 3990, __pyx_L1_error))
     __pyx_t_8 = (__pyx_v_face->hanging != 0);
     if (__pyx_t_8) {
 
-      /* "discretize/_extensions/tree_ext.pyx":3996
+      /* "discretize/_extensions/tree_ext.pyx":3991
  *             face = it.second
  *             if face.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = face.index + face_offset_z
  *             I[4*ii : 4*ii + 4] = ii
  */
-      __Pyx_TraceLine(3996,0,__PYX_ERR(0, 3996, __pyx_L1_error))
+      __Pyx_TraceLine(3991,0,__PYX_ERR(0, 3991, __pyx_L1_error))
       goto __pyx_L11_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":3995
+      /* "discretize/_extensions/tree_ext.pyx":3990
  *         for it in self.tree.faces_z:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index + face_offset_z
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":3997
+    /* "discretize/_extensions/tree_ext.pyx":3992
  *             if face.hanging:
  *                 continue
  *             ii = face.index + face_offset_z             # <<<<<<<<<<<<<<
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_y
  */
-    __Pyx_TraceLine(3997,0,__PYX_ERR(0, 3997, __pyx_L1_error))
+    __Pyx_TraceLine(3992,0,__PYX_ERR(0, 3992, __pyx_L1_error))
     __pyx_v_ii = (__pyx_v_face->index + __pyx_v_face_offset_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":3998
+    /* "discretize/_extensions/tree_ext.pyx":3993
  *                 continue
  *             ii = face.index + face_offset_z
  *             I[4*ii : 4*ii + 4] = ii             # <<<<<<<<<<<<<<
  *             J[4*ii    ] = face.edges[0].index + edge_offset_y
  *             J[4*ii + 1] = face.edges[1].index
  */
-    __Pyx_TraceLine(3998,0,__PYX_ERR(0, 3998, __pyx_L1_error))
+    __Pyx_TraceLine(3993,0,__PYX_ERR(0, 3993, __pyx_L1_error))
     __pyx_t_10.data = __pyx_v_I.data;
     __pyx_t_10.memview = __pyx_v_I.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_10, 0);
     __pyx_t_16 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_10,
     __pyx_v_I.shape[0], __pyx_v_I.strides[0], __pyx_v_I.suboffsets[0],
@@ -47690,15 +47702,15 @@
     ((4 * __pyx_v_ii) + 4),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 3998, __pyx_L1_error)
+    __PYX_ERR(0, 3993, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_int64_t __pyx_temp_scalar = __pyx_v_ii;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_10.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_10.strides[0];
@@ -47711,260 +47723,260 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":3999
+    /* "discretize/_extensions/tree_ext.pyx":3994
  *             ii = face.index + face_offset_z
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_y             # <<<<<<<<<<<<<<
  *             J[4*ii + 1] = face.edges[1].index
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_y
  */
-    __Pyx_TraceLine(3999,0,__PYX_ERR(0, 3999, __pyx_L1_error))
+    __Pyx_TraceLine(3994,0,__PYX_ERR(0, 3994, __pyx_L1_error))
     __pyx_t_17 = (4 * __pyx_v_ii);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 3999, __pyx_L1_error)
+      __PYX_ERR(0, 3994, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = ((__pyx_v_face->edges[0])->index + __pyx_v_edge_offset_y);
 
-    /* "discretize/_extensions/tree_ext.pyx":4000
+    /* "discretize/_extensions/tree_ext.pyx":3995
  *             I[4*ii : 4*ii + 4] = ii
  *             J[4*ii    ] = face.edges[0].index + edge_offset_y
  *             J[4*ii + 1] = face.edges[1].index             # <<<<<<<<<<<<<<
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_y
  *             J[4*ii + 3] = face.edges[3].index
  */
-    __Pyx_TraceLine(4000,0,__PYX_ERR(0, 4000, __pyx_L1_error))
+    __Pyx_TraceLine(3995,0,__PYX_ERR(0, 3995, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_face->edges[1])->index;
     __pyx_t_17 = ((4 * __pyx_v_ii) + 1);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 4000, __pyx_L1_error)
+      __PYX_ERR(0, 3995, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":4001
+    /* "discretize/_extensions/tree_ext.pyx":3996
  *             J[4*ii    ] = face.edges[0].index + edge_offset_y
  *             J[4*ii + 1] = face.edges[1].index
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_y             # <<<<<<<<<<<<<<
  *             J[4*ii + 3] = face.edges[3].index
  * 
  */
-    __Pyx_TraceLine(4001,0,__PYX_ERR(0, 4001, __pyx_L1_error))
+    __Pyx_TraceLine(3996,0,__PYX_ERR(0, 3996, __pyx_L1_error))
     __pyx_t_17 = ((4 * __pyx_v_ii) + 2);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 4001, __pyx_L1_error)
+      __PYX_ERR(0, 3996, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = ((__pyx_v_face->edges[2])->index + __pyx_v_edge_offset_y);
 
-    /* "discretize/_extensions/tree_ext.pyx":4002
+    /* "discretize/_extensions/tree_ext.pyx":3997
  *             J[4*ii + 1] = face.edges[1].index
  *             J[4*ii + 2] = face.edges[2].index + edge_offset_y
  *             J[4*ii + 3] = face.edges[3].index             # <<<<<<<<<<<<<<
  * 
  *         Av = sp.csr_matrix((V, (I, J)),shape=(self.n_faces, self.n_total_edges))
  */
-    __Pyx_TraceLine(4002,0,__PYX_ERR(0, 4002, __pyx_L1_error))
+    __Pyx_TraceLine(3997,0,__PYX_ERR(0, 3997, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_face->edges[3])->index;
     __pyx_t_17 = ((4 * __pyx_v_ii) + 3);
     __pyx_t_16 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_J.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_16 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_J.shape[0])) __pyx_t_16 = 0;
     if (unlikely(__pyx_t_16 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_16);
-      __PYX_ERR(0, 4002, __pyx_L1_error)
+      __PYX_ERR(0, 3997, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":3993
+    /* "discretize/_extensions/tree_ext.pyx":3988
  *             J[4*ii + 3] = face.edges[3].index
  * 
  *         for it in self.tree.faces_z:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-    __Pyx_TraceLine(3993,0,__PYX_ERR(0, 3993, __pyx_L1_error))
+    __Pyx_TraceLine(3988,0,__PYX_ERR(0, 3988, __pyx_L1_error))
     __pyx_L11_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4004
+  /* "discretize/_extensions/tree_ext.pyx":3999
  *             J[4*ii + 3] = face.edges[3].index
  * 
  *         Av = sp.csr_matrix((V, (I, J)),shape=(self.n_faces, self.n_total_edges))             # <<<<<<<<<<<<<<
  *         R = self._deflate_edges()
  * 
  */
-  __Pyx_TraceLine(4004,0,__PYX_ERR(0, 4004, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __Pyx_TraceLine(3999,0,__PYX_ERR(0, 3999, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_7);
   __pyx_t_1 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_4);
   __pyx_t_6 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
   __pyx_t_6 = 0;
   __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_shape, __pyx_t_2) < 0) __PYX_ERR(0, 4004, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_shape, __pyx_t_2) < 0) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4004, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3999, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Av = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4005
+  /* "discretize/_extensions/tree_ext.pyx":4000
  * 
  *         Av = sp.csr_matrix((V, (I, J)),shape=(self.n_faces, self.n_total_edges))
  *         R = self._deflate_edges()             # <<<<<<<<<<<<<<
  * 
- *         self._average_edge_to_face_vector = Av @ R
+ *         self._average_edge_to_face = Av @ R
  */
-  __Pyx_TraceLine(4005,0,__PYX_ERR(0, 4005, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_edges); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4005, __pyx_L1_error)
+  __Pyx_TraceLine(4000,0,__PYX_ERR(0, 4000, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_edges); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4000, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4005, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4000, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_R = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4007
+  /* "discretize/_extensions/tree_ext.pyx":4002
  *         R = self._deflate_edges()
  * 
- *         self._average_edge_to_face_vector = Av @ R             # <<<<<<<<<<<<<<
- *         return self._average_edge_to_face_vector
+ *         self._average_edge_to_face = Av @ R             # <<<<<<<<<<<<<<
+ *         return self._average_edge_to_face
  * 
  */
-  __Pyx_TraceLine(4007,0,__PYX_ERR(0, 4007, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyNumber_MatrixMultiply(__pyx_v_Av, __pyx_v_R); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4007, __pyx_L1_error)
+  __Pyx_TraceLine(4002,0,__PYX_ERR(0, 4002, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyNumber_MatrixMultiply(__pyx_v_Av, __pyx_v_R); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4002, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face_vector, __pyx_t_2) < 0) __PYX_ERR(0, 4007, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face, __pyx_t_2) < 0) __PYX_ERR(0, 4002, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4008
+  /* "discretize/_extensions/tree_ext.pyx":4003
  * 
- *         self._average_edge_to_face_vector = Av @ R
- *         return self._average_edge_to_face_vector             # <<<<<<<<<<<<<<
+ *         self._average_edge_to_face = Av @ R
+ *         return self._average_edge_to_face             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4008,0,__PYX_ERR(0, 4008, __pyx_L1_error))
+  __Pyx_TraceLine(4003,0,__PYX_ERR(0, 4003, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face_vector); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4008, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_to_face); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4003, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* "discretize/_extensions/tree_ext.pyx":3915
  * 
  *     @property
- *     def average_edge_to_face_vector(self):             # <<<<<<<<<<<<<<
- *         """Averaging operator from edges to faces (vector quantities).
+ *     def average_edge_to_face(self):             # <<<<<<<<<<<<<<
+ *         r"""Averaging operator from edges to faces.
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
   __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_t_11, 1);
-  __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh.average_edge_to_face_vector.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh.average_edge_to_face.__get__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __PYX_XDEC_MEMVIEW(&__pyx_v_I, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_J, 1);
   __PYX_XDEC_MEMVIEW(&__pyx_v_V, 1);
   __Pyx_XDECREF(__pyx_v_Av);
   __Pyx_XDECREF(__pyx_v_R);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4012
+/* "discretize/_extensions/tree_ext.pyx":4007
  *     @property
  *     @cython.boundscheck(False)
  *     def average_face_x_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from x-faces to cell centers (scalar quantities).
  * 
  */
 
@@ -48010,269 +48022,269 @@
   int_t __pyx_t_15;
   __pyx_t_5numpy_int64_t __pyx_t_16;
   PyObject *__pyx_t_17 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4012, 0, __PYX_ERR(0, 4012, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4007, 0, __PYX_ERR(0, 4007, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4043
+  /* "discretize/_extensions/tree_ext.pyx":4038
  *             phi_c = Axc @ phi_x
  *         """
  *         if self._average_face_x_to_cell is not None:             # <<<<<<<<<<<<<<
  *             return self._average_face_x_to_cell
  *         if self._dim == 2:
  */
-  __Pyx_TraceLine(4043,0,__PYX_ERR(0, 4043, __pyx_L1_error))
+  __Pyx_TraceLine(4038,0,__PYX_ERR(0, 4038, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_face_x_to_cell != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4044
+    /* "discretize/_extensions/tree_ext.pyx":4039
  *         """
  *         if self._average_face_x_to_cell is not None:
  *             return self._average_face_x_to_cell             # <<<<<<<<<<<<<<
  *         if self._dim == 2:
  *             return self.average_edge_y_to_cell
  */
-    __Pyx_TraceLine(4044,0,__PYX_ERR(0, 4044, __pyx_L1_error))
+    __Pyx_TraceLine(4039,0,__PYX_ERR(0, 4039, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_face_x_to_cell);
     __pyx_r = __pyx_v_self->_average_face_x_to_cell;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4043
+    /* "discretize/_extensions/tree_ext.pyx":4038
  *             phi_c = Axc @ phi_x
  *         """
  *         if self._average_face_x_to_cell is not None:             # <<<<<<<<<<<<<<
  *             return self._average_face_x_to_cell
  *         if self._dim == 2:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4045
+  /* "discretize/_extensions/tree_ext.pyx":4040
  *         if self._average_face_x_to_cell is not None:
  *             return self._average_face_x_to_cell
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             return self.average_edge_y_to_cell
  * 
  */
-  __Pyx_TraceLine(4045,0,__PYX_ERR(0, 4045, __pyx_L1_error))
+  __Pyx_TraceLine(4040,0,__PYX_ERR(0, 4040, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_self->_dim == 2) != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4046
+    /* "discretize/_extensions/tree_ext.pyx":4041
  *             return self._average_face_x_to_cell
  *         if self._dim == 2:
  *             return self.average_edge_y_to_cell             # <<<<<<<<<<<<<<
  * 
  *         cdef np.int64_t[:] I,J
  */
-    __Pyx_TraceLine(4046,0,__PYX_ERR(0, 4046, __pyx_L1_error))
+    __Pyx_TraceLine(4041,0,__PYX_ERR(0, 4041, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_y_to_cell); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4046, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_y_to_cell); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4041, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4045
+    /* "discretize/_extensions/tree_ext.pyx":4040
  *         if self._average_face_x_to_cell is not None:
  *             return self._average_face_x_to_cell
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             return self.average_edge_y_to_cell
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4053
+  /* "discretize/_extensions/tree_ext.pyx":4048
  *         cdef Face *face2
  *         cdef np.int64_t ii
  *         I = np.empty(self.n_cells*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_cells*2, dtype=np.int64)
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  */
-  __Pyx_TraceLine(4053,0,__PYX_ERR(0, 4053, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __Pyx_TraceLine(4048,0,__PYX_ERR(0, 4048, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4053, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4053, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4048, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4054
+  /* "discretize/_extensions/tree_ext.pyx":4049
  *         cdef np.int64_t ii
  *         I = np.empty(self.n_cells*2, dtype=np.int64)
  *         J = np.empty(self.n_cells*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4054,0,__PYX_ERR(0, 4054, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __Pyx_TraceLine(4049,0,__PYX_ERR(0, 4049, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4054, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4054, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4049, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4055
+  /* "discretize/_extensions/tree_ext.pyx":4050
  *         I = np.empty(self.n_cells*2, dtype=np.int64)
  *         J = np.empty(self.n_cells*2, dtype=np.int64)
  *         V = np.empty(self.n_cells*2, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for cell in self.tree.cells:
  */
-  __Pyx_TraceLine(4055,0,__PYX_ERR(0, 4055, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __Pyx_TraceLine(4050,0,__PYX_ERR(0, 4050, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4055, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4055, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4050, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4057
+  /* "discretize/_extensions/tree_ext.pyx":4052
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             face1 = cell.faces[0] # x face
  *             face2 = cell.faces[1] # x face
  */
-  __Pyx_TraceLine(4057,0,__PYX_ERR(0, 4057, __pyx_L1_error))
+  __Pyx_TraceLine(4052,0,__PYX_ERR(0, 4052, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->cells;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_cell = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4058
+    /* "discretize/_extensions/tree_ext.pyx":4053
  * 
  *         for cell in self.tree.cells:
  *             face1 = cell.faces[0] # x face             # <<<<<<<<<<<<<<
  *             face2 = cell.faces[1] # x face
  *             ii = cell.index
  */
-    __Pyx_TraceLine(4058,0,__PYX_ERR(0, 4058, __pyx_L1_error))
+    __Pyx_TraceLine(4053,0,__PYX_ERR(0, 4053, __pyx_L1_error))
     __pyx_v_face1 = (__pyx_v_cell->faces[0]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4059
+    /* "discretize/_extensions/tree_ext.pyx":4054
  *         for cell in self.tree.cells:
  *             face1 = cell.faces[0] # x face
  *             face2 = cell.faces[1] # x face             # <<<<<<<<<<<<<<
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii
  */
-    __Pyx_TraceLine(4059,0,__PYX_ERR(0, 4059, __pyx_L1_error))
+    __Pyx_TraceLine(4054,0,__PYX_ERR(0, 4054, __pyx_L1_error))
     __pyx_v_face2 = (__pyx_v_cell->faces[1]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4060
+    /* "discretize/_extensions/tree_ext.pyx":4055
  *             face1 = cell.faces[0] # x face
  *             face2 = cell.faces[1] # x face
  *             ii = cell.index             # <<<<<<<<<<<<<<
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index
  */
-    __Pyx_TraceLine(4060,0,__PYX_ERR(0, 4060, __pyx_L1_error))
+    __Pyx_TraceLine(4055,0,__PYX_ERR(0, 4055, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_cell->index;
     __pyx_v_ii = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4061
+    /* "discretize/_extensions/tree_ext.pyx":4056
  *             face2 = cell.faces[1] # x face
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii             # <<<<<<<<<<<<<<
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index
  */
-    __Pyx_TraceLine(4061,0,__PYX_ERR(0, 4061, __pyx_L1_error))
+    __Pyx_TraceLine(4056,0,__PYX_ERR(0, 4056, __pyx_L1_error))
     __pyx_t_8.data = __pyx_v_I.data;
     __pyx_t_8.memview = __pyx_v_I.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_8, 0);
     __pyx_t_14 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_8,
     __pyx_v_I.shape[0], __pyx_v_I.strides[0], __pyx_v_I.suboffsets[0],
@@ -48283,15 +48295,15 @@
     ((__pyx_v_ii * 2) + 2),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 4061, __pyx_L1_error)
+    __PYX_ERR(0, 4056, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_int64_t __pyx_temp_scalar = __pyx_v_ii;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_8.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_8.strides[0];
@@ -48304,48 +48316,48 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4062
+    /* "discretize/_extensions/tree_ext.pyx":4057
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index             # <<<<<<<<<<<<<<
  *             J[ii*2 + 1] = face2.index
  *             V[ii*2 : ii*2 + 2] = 0.5
  */
-    __Pyx_TraceLine(4062,0,__PYX_ERR(0, 4062, __pyx_L1_error))
+    __Pyx_TraceLine(4057,0,__PYX_ERR(0, 4057, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_face1->index;
     __pyx_t_16 = (__pyx_v_ii * 2);
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_J.shape[0];
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":4063
+    /* "discretize/_extensions/tree_ext.pyx":4058
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index             # <<<<<<<<<<<<<<
  *             V[ii*2 : ii*2 + 2] = 0.5
  * 
  */
-    __Pyx_TraceLine(4063,0,__PYX_ERR(0, 4063, __pyx_L1_error))
+    __Pyx_TraceLine(4058,0,__PYX_ERR(0, 4058, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_face2->index;
     __pyx_t_16 = ((__pyx_v_ii * 2) + 1);
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_J.shape[0];
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":4064
+    /* "discretize/_extensions/tree_ext.pyx":4059
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index
  *             V[ii*2 : ii*2 + 2] = 0.5             # <<<<<<<<<<<<<<
  * 
  *         Rfx = self._deflate_faces_x()
  */
-    __Pyx_TraceLine(4064,0,__PYX_ERR(0, 4064, __pyx_L1_error))
+    __Pyx_TraceLine(4059,0,__PYX_ERR(0, 4059, __pyx_L1_error))
     __pyx_t_9.data = __pyx_v_V.data;
     __pyx_t_9.memview = __pyx_v_V.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_9, 0);
     __pyx_t_14 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_9,
     __pyx_v_V.shape[0], __pyx_v_V.strides[0], __pyx_v_V.suboffsets[0],
@@ -48356,15 +48368,15 @@
     ((__pyx_v_ii * 2) + 2),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 4064, __pyx_L1_error)
+    __PYX_ERR(0, 4059, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.5;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_9.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_9.strides[0];
@@ -48377,80 +48389,80 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
     __pyx_t_9.memview = NULL;
     __pyx_t_9.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4057
+    /* "discretize/_extensions/tree_ext.pyx":4052
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             face1 = cell.faces[0] # x face
  *             face2 = cell.faces[1] # x face
  */
-    __Pyx_TraceLine(4057,0,__PYX_ERR(0, 4057, __pyx_L1_error))
+    __Pyx_TraceLine(4052,0,__PYX_ERR(0, 4052, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4066
+  /* "discretize/_extensions/tree_ext.pyx":4061
  *             V[ii*2 : ii*2 + 2] = 0.5
  * 
  *         Rfx = self._deflate_faces_x()             # <<<<<<<<<<<<<<
  *         self._average_face_x_to_cell = sp.csr_matrix((V, (I, J)))*Rfx
  *         return self._average_face_x_to_cell
  */
-  __Pyx_TraceLine(4066,0,__PYX_ERR(0, 4066, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4066, __pyx_L1_error)
+  __Pyx_TraceLine(4061,0,__PYX_ERR(0, 4061, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4061, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4066, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4061, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rfx = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4067
+  /* "discretize/_extensions/tree_ext.pyx":4062
  * 
  *         Rfx = self._deflate_faces_x()
  *         self._average_face_x_to_cell = sp.csr_matrix((V, (I, J)))*Rfx             # <<<<<<<<<<<<<<
  *         return self._average_face_x_to_cell
  * 
  */
-  __Pyx_TraceLine(4067,0,__PYX_ERR(0, 4067, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  __Pyx_TraceLine(4062,0,__PYX_ERR(0, 4062, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_17 = PyTuple_New(2); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  __pyx_t_17 = PyTuple_New(2); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_17, 1, __pyx_t_5);
   __pyx_t_3 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_17);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_17);
   __pyx_t_7 = 0;
   __pyx_t_17 = 0;
@@ -48463,40 +48475,40 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_4 = (__pyx_t_17) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_17, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Multiply(__pyx_t_4, __pyx_v_Rfx); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4067, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Multiply(__pyx_t_4, __pyx_v_Rfx); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4062, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_GIVEREF(__pyx_t_6);
   __Pyx_GOTREF(__pyx_v_self->_average_face_x_to_cell);
   __Pyx_DECREF(__pyx_v_self->_average_face_x_to_cell);
   __pyx_v_self->_average_face_x_to_cell = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4068
+  /* "discretize/_extensions/tree_ext.pyx":4063
  *         Rfx = self._deflate_faces_x()
  *         self._average_face_x_to_cell = sp.csr_matrix((V, (I, J)))*Rfx
  *         return self._average_face_x_to_cell             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4068,0,__PYX_ERR(0, 4068, __pyx_L1_error))
+  __Pyx_TraceLine(4063,0,__PYX_ERR(0, 4063, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_face_x_to_cell);
   __pyx_r = __pyx_v_self->_average_face_x_to_cell;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4012
+  /* "discretize/_extensions/tree_ext.pyx":4007
  *     @property
  *     @cython.boundscheck(False)
  *     def average_face_x_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from x-faces to cell centers (scalar quantities).
  * 
  */
 
@@ -48519,15 +48531,15 @@
   __Pyx_XDECREF(__pyx_v_Rfx);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4072
+/* "discretize/_extensions/tree_ext.pyx":4067
  *     @property
  *     @cython.boundscheck(False)
  *     def average_face_y_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from y-faces to cell centers (scalar quantities).
  * 
  */
 
@@ -48573,269 +48585,269 @@
   int_t __pyx_t_15;
   __pyx_t_5numpy_int64_t __pyx_t_16;
   PyObject *__pyx_t_17 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4072, 0, __PYX_ERR(0, 4072, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4067, 0, __PYX_ERR(0, 4067, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4103
+  /* "discretize/_extensions/tree_ext.pyx":4098
  *             phi_c = Ayc @ phi_y
  *         """
  *         if self._average_face_y_to_cell is not None:             # <<<<<<<<<<<<<<
  *             return self._average_face_y_to_cell
  *         if self._dim == 2:
  */
-  __Pyx_TraceLine(4103,0,__PYX_ERR(0, 4103, __pyx_L1_error))
+  __Pyx_TraceLine(4098,0,__PYX_ERR(0, 4098, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_face_y_to_cell != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4104
+    /* "discretize/_extensions/tree_ext.pyx":4099
  *         """
  *         if self._average_face_y_to_cell is not None:
  *             return self._average_face_y_to_cell             # <<<<<<<<<<<<<<
  *         if self._dim == 2:
  *             return self.average_edge_x_to_cell
  */
-    __Pyx_TraceLine(4104,0,__PYX_ERR(0, 4104, __pyx_L1_error))
+    __Pyx_TraceLine(4099,0,__PYX_ERR(0, 4099, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_face_y_to_cell);
     __pyx_r = __pyx_v_self->_average_face_y_to_cell;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4103
+    /* "discretize/_extensions/tree_ext.pyx":4098
  *             phi_c = Ayc @ phi_y
  *         """
  *         if self._average_face_y_to_cell is not None:             # <<<<<<<<<<<<<<
  *             return self._average_face_y_to_cell
  *         if self._dim == 2:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4105
+  /* "discretize/_extensions/tree_ext.pyx":4100
  *         if self._average_face_y_to_cell is not None:
  *             return self._average_face_y_to_cell
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             return self.average_edge_x_to_cell
  * 
  */
-  __Pyx_TraceLine(4105,0,__PYX_ERR(0, 4105, __pyx_L1_error))
+  __Pyx_TraceLine(4100,0,__PYX_ERR(0, 4100, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_self->_dim == 2) != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4106
+    /* "discretize/_extensions/tree_ext.pyx":4101
  *             return self._average_face_y_to_cell
  *         if self._dim == 2:
  *             return self.average_edge_x_to_cell             # <<<<<<<<<<<<<<
  * 
  *         cdef np.int64_t[:] I,J
  */
-    __Pyx_TraceLine(4106,0,__PYX_ERR(0, 4106, __pyx_L1_error))
+    __Pyx_TraceLine(4101,0,__PYX_ERR(0, 4101, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_x_to_cell); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4106, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_edge_x_to_cell); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4101, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4105
+    /* "discretize/_extensions/tree_ext.pyx":4100
  *         if self._average_face_y_to_cell is not None:
  *             return self._average_face_y_to_cell
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             return self.average_edge_x_to_cell
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4113
+  /* "discretize/_extensions/tree_ext.pyx":4108
  *         cdef Face *face2
  *         cdef np.int64_t ii
  *         I = np.empty(self.n_cells*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_cells*2, dtype=np.int64)
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  */
-  __Pyx_TraceLine(4113,0,__PYX_ERR(0, 4113, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __Pyx_TraceLine(4108,0,__PYX_ERR(0, 4108, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4113, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4113, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4114
+  /* "discretize/_extensions/tree_ext.pyx":4109
  *         cdef np.int64_t ii
  *         I = np.empty(self.n_cells*2, dtype=np.int64)
  *         J = np.empty(self.n_cells*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4114,0,__PYX_ERR(0, 4114, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __Pyx_TraceLine(4109,0,__PYX_ERR(0, 4109, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4114, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4114, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4115
+  /* "discretize/_extensions/tree_ext.pyx":4110
  *         I = np.empty(self.n_cells*2, dtype=np.int64)
  *         J = np.empty(self.n_cells*2, dtype=np.int64)
  *         V = np.empty(self.n_cells*2, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for cell in self.tree.cells:
  */
-  __Pyx_TraceLine(4115,0,__PYX_ERR(0, 4115, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __Pyx_TraceLine(4110,0,__PYX_ERR(0, 4110, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4115, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4115, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4110, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4117
+  /* "discretize/_extensions/tree_ext.pyx":4112
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             face1 = cell.faces[2] # y face
  *             face2 = cell.faces[3] # y face
  */
-  __Pyx_TraceLine(4117,0,__PYX_ERR(0, 4117, __pyx_L1_error))
+  __Pyx_TraceLine(4112,0,__PYX_ERR(0, 4112, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->cells;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_cell = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4118
+    /* "discretize/_extensions/tree_ext.pyx":4113
  * 
  *         for cell in self.tree.cells:
  *             face1 = cell.faces[2] # y face             # <<<<<<<<<<<<<<
  *             face2 = cell.faces[3] # y face
  *             ii = cell.index
  */
-    __Pyx_TraceLine(4118,0,__PYX_ERR(0, 4118, __pyx_L1_error))
+    __Pyx_TraceLine(4113,0,__PYX_ERR(0, 4113, __pyx_L1_error))
     __pyx_v_face1 = (__pyx_v_cell->faces[2]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4119
+    /* "discretize/_extensions/tree_ext.pyx":4114
  *         for cell in self.tree.cells:
  *             face1 = cell.faces[2] # y face
  *             face2 = cell.faces[3] # y face             # <<<<<<<<<<<<<<
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii
  */
-    __Pyx_TraceLine(4119,0,__PYX_ERR(0, 4119, __pyx_L1_error))
+    __Pyx_TraceLine(4114,0,__PYX_ERR(0, 4114, __pyx_L1_error))
     __pyx_v_face2 = (__pyx_v_cell->faces[3]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4120
+    /* "discretize/_extensions/tree_ext.pyx":4115
  *             face1 = cell.faces[2] # y face
  *             face2 = cell.faces[3] # y face
  *             ii = cell.index             # <<<<<<<<<<<<<<
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index
  */
-    __Pyx_TraceLine(4120,0,__PYX_ERR(0, 4120, __pyx_L1_error))
+    __Pyx_TraceLine(4115,0,__PYX_ERR(0, 4115, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_cell->index;
     __pyx_v_ii = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4121
+    /* "discretize/_extensions/tree_ext.pyx":4116
  *             face2 = cell.faces[3] # y face
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii             # <<<<<<<<<<<<<<
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index
  */
-    __Pyx_TraceLine(4121,0,__PYX_ERR(0, 4121, __pyx_L1_error))
+    __Pyx_TraceLine(4116,0,__PYX_ERR(0, 4116, __pyx_L1_error))
     __pyx_t_8.data = __pyx_v_I.data;
     __pyx_t_8.memview = __pyx_v_I.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_8, 0);
     __pyx_t_14 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_8,
     __pyx_v_I.shape[0], __pyx_v_I.strides[0], __pyx_v_I.suboffsets[0],
@@ -48846,15 +48858,15 @@
     ((__pyx_v_ii * 2) + 2),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 4121, __pyx_L1_error)
+    __PYX_ERR(0, 4116, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_int64_t __pyx_temp_scalar = __pyx_v_ii;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_8.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_8.strides[0];
@@ -48867,48 +48879,48 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4122
+    /* "discretize/_extensions/tree_ext.pyx":4117
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index             # <<<<<<<<<<<<<<
  *             J[ii*2 + 1] = face2.index
  *             V[ii*2 : ii*2 + 2] = 0.5
  */
-    __Pyx_TraceLine(4122,0,__PYX_ERR(0, 4122, __pyx_L1_error))
+    __Pyx_TraceLine(4117,0,__PYX_ERR(0, 4117, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_face1->index;
     __pyx_t_16 = (__pyx_v_ii * 2);
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_J.shape[0];
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":4123
+    /* "discretize/_extensions/tree_ext.pyx":4118
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index             # <<<<<<<<<<<<<<
  *             V[ii*2 : ii*2 + 2] = 0.5
  * 
  */
-    __Pyx_TraceLine(4123,0,__PYX_ERR(0, 4123, __pyx_L1_error))
+    __Pyx_TraceLine(4118,0,__PYX_ERR(0, 4118, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_face2->index;
     __pyx_t_16 = ((__pyx_v_ii * 2) + 1);
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_J.shape[0];
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":4124
+    /* "discretize/_extensions/tree_ext.pyx":4119
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index
  *             V[ii*2 : ii*2 + 2] = 0.5             # <<<<<<<<<<<<<<
  * 
  *         Rfy = self._deflate_faces_y()
  */
-    __Pyx_TraceLine(4124,0,__PYX_ERR(0, 4124, __pyx_L1_error))
+    __Pyx_TraceLine(4119,0,__PYX_ERR(0, 4119, __pyx_L1_error))
     __pyx_t_9.data = __pyx_v_V.data;
     __pyx_t_9.memview = __pyx_v_V.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_9, 0);
     __pyx_t_14 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_9,
     __pyx_v_V.shape[0], __pyx_v_V.strides[0], __pyx_v_V.suboffsets[0],
@@ -48919,15 +48931,15 @@
     ((__pyx_v_ii * 2) + 2),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 4124, __pyx_L1_error)
+    __PYX_ERR(0, 4119, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.5;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_9.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_9.strides[0];
@@ -48940,80 +48952,80 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
     __pyx_t_9.memview = NULL;
     __pyx_t_9.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4117
+    /* "discretize/_extensions/tree_ext.pyx":4112
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             face1 = cell.faces[2] # y face
  *             face2 = cell.faces[3] # y face
  */
-    __Pyx_TraceLine(4117,0,__PYX_ERR(0, 4117, __pyx_L1_error))
+    __Pyx_TraceLine(4112,0,__PYX_ERR(0, 4112, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4126
+  /* "discretize/_extensions/tree_ext.pyx":4121
  *             V[ii*2 : ii*2 + 2] = 0.5
  * 
  *         Rfy = self._deflate_faces_y()             # <<<<<<<<<<<<<<
  *         self._average_face_y_to_cell = sp.csr_matrix((V, (I, J)))*Rfy
  *         return self._average_face_y_to_cell
  */
-  __Pyx_TraceLine(4126,0,__PYX_ERR(0, 4126, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4126, __pyx_L1_error)
+  __Pyx_TraceLine(4121,0,__PYX_ERR(0, 4121, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4126, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4121, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rfy = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4127
+  /* "discretize/_extensions/tree_ext.pyx":4122
  * 
  *         Rfy = self._deflate_faces_y()
  *         self._average_face_y_to_cell = sp.csr_matrix((V, (I, J)))*Rfy             # <<<<<<<<<<<<<<
  *         return self._average_face_y_to_cell
  * 
  */
-  __Pyx_TraceLine(4127,0,__PYX_ERR(0, 4127, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  __Pyx_TraceLine(4122,0,__PYX_ERR(0, 4122, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_17 = PyTuple_New(2); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  __pyx_t_17 = PyTuple_New(2); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_17, 1, __pyx_t_5);
   __pyx_t_3 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_17);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_17);
   __pyx_t_7 = 0;
   __pyx_t_17 = 0;
@@ -49026,40 +49038,40 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_4 = (__pyx_t_17) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_17, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Multiply(__pyx_t_4, __pyx_v_Rfy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4127, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Multiply(__pyx_t_4, __pyx_v_Rfy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_GIVEREF(__pyx_t_6);
   __Pyx_GOTREF(__pyx_v_self->_average_face_y_to_cell);
   __Pyx_DECREF(__pyx_v_self->_average_face_y_to_cell);
   __pyx_v_self->_average_face_y_to_cell = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4128
+  /* "discretize/_extensions/tree_ext.pyx":4123
  *         Rfy = self._deflate_faces_y()
  *         self._average_face_y_to_cell = sp.csr_matrix((V, (I, J)))*Rfy
  *         return self._average_face_y_to_cell             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4128,0,__PYX_ERR(0, 4128, __pyx_L1_error))
+  __Pyx_TraceLine(4123,0,__PYX_ERR(0, 4123, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_face_y_to_cell);
   __pyx_r = __pyx_v_self->_average_face_y_to_cell;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4072
+  /* "discretize/_extensions/tree_ext.pyx":4067
  *     @property
  *     @cython.boundscheck(False)
  *     def average_face_y_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from y-faces to cell centers (scalar quantities).
  * 
  */
 
@@ -49082,15 +49094,15 @@
   __Pyx_XDECREF(__pyx_v_Rfy);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4132
+/* "discretize/_extensions/tree_ext.pyx":4127
  *     @property
  *     @cython.boundscheck(False)
  *     def average_face_z_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from z-faces to cell centers (scalar quantities).
  * 
  */
 
@@ -49136,268 +49148,268 @@
   int_t __pyx_t_15;
   __pyx_t_5numpy_int64_t __pyx_t_16;
   PyObject *__pyx_t_17 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4132, 0, __PYX_ERR(0, 4132, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4127, 0, __PYX_ERR(0, 4127, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4163
+  /* "discretize/_extensions/tree_ext.pyx":4158
  *             phi_c = Azc @ phi_z
  *         """
  *         if self._average_face_z_to_cell is not None:             # <<<<<<<<<<<<<<
  *             return self._average_face_z_to_cell
  *         if self._dim == 2:
  */
-  __Pyx_TraceLine(4163,0,__PYX_ERR(0, 4163, __pyx_L1_error))
+  __Pyx_TraceLine(4158,0,__PYX_ERR(0, 4158, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_face_z_to_cell != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4164
+    /* "discretize/_extensions/tree_ext.pyx":4159
  *         """
  *         if self._average_face_z_to_cell is not None:
  *             return self._average_face_z_to_cell             # <<<<<<<<<<<<<<
  *         if self._dim == 2:
  *             raise Exception('There are no z-faces in 2D')
  */
-    __Pyx_TraceLine(4164,0,__PYX_ERR(0, 4164, __pyx_L1_error))
+    __Pyx_TraceLine(4159,0,__PYX_ERR(0, 4159, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_face_z_to_cell);
     __pyx_r = __pyx_v_self->_average_face_z_to_cell;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4163
+    /* "discretize/_extensions/tree_ext.pyx":4158
  *             phi_c = Azc @ phi_z
  *         """
  *         if self._average_face_z_to_cell is not None:             # <<<<<<<<<<<<<<
  *             return self._average_face_z_to_cell
  *         if self._dim == 2:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4165
+  /* "discretize/_extensions/tree_ext.pyx":4160
  *         if self._average_face_z_to_cell is not None:
  *             return self._average_face_z_to_cell
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             raise Exception('There are no z-faces in 2D')
  *         cdef np.int64_t[:] I,J
  */
-  __Pyx_TraceLine(4165,0,__PYX_ERR(0, 4165, __pyx_L1_error))
+  __Pyx_TraceLine(4160,0,__PYX_ERR(0, 4160, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_self->_dim == 2) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4166
+    /* "discretize/_extensions/tree_ext.pyx":4161
  *             return self._average_face_z_to_cell
  *         if self._dim == 2:
  *             raise Exception('There are no z-faces in 2D')             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I,J
  *         cdef np.float64_t[:] V
  */
-    __Pyx_TraceLine(4166,0,__PYX_ERR(0, 4166, __pyx_L1_error))
-    __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__27, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4166, __pyx_L1_error)
+    __Pyx_TraceLine(4161,0,__PYX_ERR(0, 4161, __pyx_L1_error))
+    __pyx_t_3 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__27, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4161, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 4166, __pyx_L1_error)
+    __PYX_ERR(0, 4161, __pyx_L1_error)
 
-    /* "discretize/_extensions/tree_ext.pyx":4165
+    /* "discretize/_extensions/tree_ext.pyx":4160
  *         if self._average_face_z_to_cell is not None:
  *             return self._average_face_z_to_cell
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             raise Exception('There are no z-faces in 2D')
  *         cdef np.int64_t[:] I,J
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4172
+  /* "discretize/_extensions/tree_ext.pyx":4167
  *         cdef Face *face2
  *         cdef np.int64_t ii
  *         I = np.empty(self.n_cells*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_cells*2, dtype=np.int64)
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  */
-  __Pyx_TraceLine(4172,0,__PYX_ERR(0, 4172, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __Pyx_TraceLine(4167,0,__PYX_ERR(0, 4167, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4172, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4172, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4167, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4173
+  /* "discretize/_extensions/tree_ext.pyx":4168
  *         cdef np.int64_t ii
  *         I = np.empty(self.n_cells*2, dtype=np.int64)
  *         J = np.empty(self.n_cells*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4173,0,__PYX_ERR(0, 4173, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __Pyx_TraceLine(4168,0,__PYX_ERR(0, 4168, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4173, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4173, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4168, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4174
+  /* "discretize/_extensions/tree_ext.pyx":4169
  *         I = np.empty(self.n_cells*2, dtype=np.int64)
  *         J = np.empty(self.n_cells*2, dtype=np.int64)
  *         V = np.empty(self.n_cells*2, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for cell in self.tree.cells:
  */
-  __Pyx_TraceLine(4174,0,__PYX_ERR(0, 4174, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __Pyx_TraceLine(4169,0,__PYX_ERR(0, 4169, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4174, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4174, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4169, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4176
+  /* "discretize/_extensions/tree_ext.pyx":4171
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             face1 = cell.faces[4]
  *             face2 = cell.faces[5]
  */
-  __Pyx_TraceLine(4176,0,__PYX_ERR(0, 4176, __pyx_L1_error))
+  __Pyx_TraceLine(4171,0,__PYX_ERR(0, 4171, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->cells;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_cell = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4177
+    /* "discretize/_extensions/tree_ext.pyx":4172
  * 
  *         for cell in self.tree.cells:
  *             face1 = cell.faces[4]             # <<<<<<<<<<<<<<
  *             face2 = cell.faces[5]
  *             ii = cell.index
  */
-    __Pyx_TraceLine(4177,0,__PYX_ERR(0, 4177, __pyx_L1_error))
+    __Pyx_TraceLine(4172,0,__PYX_ERR(0, 4172, __pyx_L1_error))
     __pyx_v_face1 = (__pyx_v_cell->faces[4]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4178
+    /* "discretize/_extensions/tree_ext.pyx":4173
  *         for cell in self.tree.cells:
  *             face1 = cell.faces[4]
  *             face2 = cell.faces[5]             # <<<<<<<<<<<<<<
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii
  */
-    __Pyx_TraceLine(4178,0,__PYX_ERR(0, 4178, __pyx_L1_error))
+    __Pyx_TraceLine(4173,0,__PYX_ERR(0, 4173, __pyx_L1_error))
     __pyx_v_face2 = (__pyx_v_cell->faces[5]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4179
+    /* "discretize/_extensions/tree_ext.pyx":4174
  *             face1 = cell.faces[4]
  *             face2 = cell.faces[5]
  *             ii = cell.index             # <<<<<<<<<<<<<<
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index
  */
-    __Pyx_TraceLine(4179,0,__PYX_ERR(0, 4179, __pyx_L1_error))
+    __Pyx_TraceLine(4174,0,__PYX_ERR(0, 4174, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_cell->index;
     __pyx_v_ii = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4180
+    /* "discretize/_extensions/tree_ext.pyx":4175
  *             face2 = cell.faces[5]
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii             # <<<<<<<<<<<<<<
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index
  */
-    __Pyx_TraceLine(4180,0,__PYX_ERR(0, 4180, __pyx_L1_error))
+    __Pyx_TraceLine(4175,0,__PYX_ERR(0, 4175, __pyx_L1_error))
     __pyx_t_8.data = __pyx_v_I.data;
     __pyx_t_8.memview = __pyx_v_I.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_8, 0);
     __pyx_t_14 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_8,
     __pyx_v_I.shape[0], __pyx_v_I.strides[0], __pyx_v_I.suboffsets[0],
@@ -49408,15 +49420,15 @@
     ((__pyx_v_ii * 2) + 2),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 4180, __pyx_L1_error)
+    __PYX_ERR(0, 4175, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_int64_t __pyx_temp_scalar = __pyx_v_ii;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_8.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_8.strides[0];
@@ -49429,48 +49441,48 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4181
+    /* "discretize/_extensions/tree_ext.pyx":4176
  *             ii = cell.index
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index             # <<<<<<<<<<<<<<
  *             J[ii*2 + 1] = face2.index
  *             V[ii*2 : ii*2 + 2] = 0.5
  */
-    __Pyx_TraceLine(4181,0,__PYX_ERR(0, 4181, __pyx_L1_error))
+    __Pyx_TraceLine(4176,0,__PYX_ERR(0, 4176, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_face1->index;
     __pyx_t_16 = (__pyx_v_ii * 2);
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_J.shape[0];
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":4182
+    /* "discretize/_extensions/tree_ext.pyx":4177
  *             I[ii*2 : ii*2 + 2] = ii
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index             # <<<<<<<<<<<<<<
  *             V[ii*2 : ii*2 + 2] = 0.5
  * 
  */
-    __Pyx_TraceLine(4182,0,__PYX_ERR(0, 4182, __pyx_L1_error))
+    __Pyx_TraceLine(4177,0,__PYX_ERR(0, 4177, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_face2->index;
     __pyx_t_16 = ((__pyx_v_ii * 2) + 1);
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_J.shape[0];
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":4183
+    /* "discretize/_extensions/tree_ext.pyx":4178
  *             J[ii*2    ] = face1.index
  *             J[ii*2 + 1] = face2.index
  *             V[ii*2 : ii*2 + 2] = 0.5             # <<<<<<<<<<<<<<
  * 
  *         Rfy = self._deflate_faces_z()
  */
-    __Pyx_TraceLine(4183,0,__PYX_ERR(0, 4183, __pyx_L1_error))
+    __Pyx_TraceLine(4178,0,__PYX_ERR(0, 4178, __pyx_L1_error))
     __pyx_t_9.data = __pyx_v_V.data;
     __pyx_t_9.memview = __pyx_v_V.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_9, 0);
     __pyx_t_14 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_9,
     __pyx_v_V.shape[0], __pyx_v_V.strides[0], __pyx_v_V.suboffsets[0],
@@ -49481,15 +49493,15 @@
     ((__pyx_v_ii * 2) + 2),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 4183, __pyx_L1_error)
+    __PYX_ERR(0, 4178, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.5;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_9.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_9.strides[0];
@@ -49502,80 +49514,80 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
     __pyx_t_9.memview = NULL;
     __pyx_t_9.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4176
+    /* "discretize/_extensions/tree_ext.pyx":4171
  *         V = np.empty(self.n_cells*2, dtype=np.float64)
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             face1 = cell.faces[4]
  *             face2 = cell.faces[5]
  */
-    __Pyx_TraceLine(4176,0,__PYX_ERR(0, 4176, __pyx_L1_error))
+    __Pyx_TraceLine(4171,0,__PYX_ERR(0, 4171, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4185
+  /* "discretize/_extensions/tree_ext.pyx":4180
  *             V[ii*2 : ii*2 + 2] = 0.5
  * 
  *         Rfy = self._deflate_faces_z()             # <<<<<<<<<<<<<<
  *         self._average_face_z_to_cell = sp.csr_matrix((V, (I, J)))*Rfy
  *         return self._average_face_z_to_cell
  */
-  __Pyx_TraceLine(4185,0,__PYX_ERR(0, 4185, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4185, __pyx_L1_error)
+  __Pyx_TraceLine(4180,0,__PYX_ERR(0, 4180, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4180, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4185, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4180, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rfy = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4186
+  /* "discretize/_extensions/tree_ext.pyx":4181
  * 
  *         Rfy = self._deflate_faces_z()
  *         self._average_face_z_to_cell = sp.csr_matrix((V, (I, J)))*Rfy             # <<<<<<<<<<<<<<
  *         return self._average_face_z_to_cell
  * 
  */
-  __Pyx_TraceLine(4186,0,__PYX_ERR(0, 4186, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  __Pyx_TraceLine(4181,0,__PYX_ERR(0, 4181, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_17 = PyTuple_New(2); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  __pyx_t_17 = PyTuple_New(2); if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_17);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_17, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_17, 1, __pyx_t_5);
   __pyx_t_3 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_17);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_17);
   __pyx_t_7 = 0;
   __pyx_t_17 = 0;
@@ -49588,40 +49600,40 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_4 = (__pyx_t_17) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_17, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Multiply(__pyx_t_4, __pyx_v_Rfy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4186, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Multiply(__pyx_t_4, __pyx_v_Rfy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4181, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_GIVEREF(__pyx_t_6);
   __Pyx_GOTREF(__pyx_v_self->_average_face_z_to_cell);
   __Pyx_DECREF(__pyx_v_self->_average_face_z_to_cell);
   __pyx_v_self->_average_face_z_to_cell = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4187
+  /* "discretize/_extensions/tree_ext.pyx":4182
  *         Rfy = self._deflate_faces_z()
  *         self._average_face_z_to_cell = sp.csr_matrix((V, (I, J)))*Rfy
  *         return self._average_face_z_to_cell             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4187,0,__PYX_ERR(0, 4187, __pyx_L1_error))
+  __Pyx_TraceLine(4182,0,__PYX_ERR(0, 4182, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_face_z_to_cell);
   __pyx_r = __pyx_v_self->_average_face_z_to_cell;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4132
+  /* "discretize/_extensions/tree_ext.pyx":4127
  *     @property
  *     @cython.boundscheck(False)
  *     def average_face_z_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from z-faces to cell centers (scalar quantities).
  * 
  */
 
@@ -49644,15 +49656,15 @@
   __Pyx_XDECREF(__pyx_v_Rfy);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4190
+/* "discretize/_extensions/tree_ext.pyx":4185
  * 
  *     @property
  *     def average_face_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from faces to cell centers (scalar quantities).
  * 
  */
 
@@ -49681,177 +49693,177 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4190, 0, __PYX_ERR(0, 4190, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4185, 0, __PYX_ERR(0, 4185, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4221
+  /* "discretize/_extensions/tree_ext.pyx":4216
  *             phi_c = Afc @ phi_f
  *         """
  *         if self._average_face_to_cell is None:             # <<<<<<<<<<<<<<
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:
  */
-  __Pyx_TraceLine(4221,0,__PYX_ERR(0, 4221, __pyx_L1_error))
+  __Pyx_TraceLine(4216,0,__PYX_ERR(0, 4216, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_face_to_cell == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4222
+    /* "discretize/_extensions/tree_ext.pyx":4217
  *         """
  *         if self._average_face_to_cell is None:
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]             # <<<<<<<<<<<<<<
  *             if self._dim == 3:
  *                 stacks += [self.average_face_z_to_cell]
  */
-    __Pyx_TraceLine(4222,0,__PYX_ERR(0, 4222, __pyx_L1_error))
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_face_x_to_cell); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4222, __pyx_L1_error)
+    __Pyx_TraceLine(4217,0,__PYX_ERR(0, 4217, __pyx_L1_error))
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_face_x_to_cell); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4217, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_aveFy2CC); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4222, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_aveFy2CC); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4217, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4222, __pyx_L1_error)
+    __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4217, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_3);
     PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_4);
     PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
     __pyx_t_3 = 0;
     __pyx_t_4 = 0;
     __pyx_v_stacks = ((PyObject*)__pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4223
+    /* "discretize/_extensions/tree_ext.pyx":4218
  *         if self._average_face_to_cell is None:
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:             # <<<<<<<<<<<<<<
  *                 stacks += [self.average_face_z_to_cell]
  *             self._average_face_to_cell = 1./self._dim*sp.hstack(stacks).tocsr()
  */
-    __Pyx_TraceLine(4223,0,__PYX_ERR(0, 4223, __pyx_L1_error))
+    __Pyx_TraceLine(4218,0,__PYX_ERR(0, 4218, __pyx_L1_error))
     __pyx_t_2 = ((__pyx_v_self->_dim == 3) != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4224
+      /* "discretize/_extensions/tree_ext.pyx":4219
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:
  *                 stacks += [self.average_face_z_to_cell]             # <<<<<<<<<<<<<<
  *             self._average_face_to_cell = 1./self._dim*sp.hstack(stacks).tocsr()
  *         return self._average_face_to_cell
  */
-      __Pyx_TraceLine(4224,0,__PYX_ERR(0, 4224, __pyx_L1_error))
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_face_z_to_cell); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4224, __pyx_L1_error)
+      __Pyx_TraceLine(4219,0,__PYX_ERR(0, 4219, __pyx_L1_error))
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_face_z_to_cell); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4219, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4224, __pyx_L1_error)
+      __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4219, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_GIVEREF(__pyx_t_5);
       PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
       __pyx_t_5 = 0;
-      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_stacks, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4224, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_stacks, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4219, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF_SET(__pyx_v_stacks, ((PyObject*)__pyx_t_5));
       __pyx_t_5 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":4223
+      /* "discretize/_extensions/tree_ext.pyx":4218
  *         if self._average_face_to_cell is None:
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:             # <<<<<<<<<<<<<<
  *                 stacks += [self.average_face_z_to_cell]
  *             self._average_face_to_cell = 1./self._dim*sp.hstack(stacks).tocsr()
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4225
+    /* "discretize/_extensions/tree_ext.pyx":4220
  *             if self._dim == 3:
  *                 stacks += [self.average_face_z_to_cell]
  *             self._average_face_to_cell = 1./self._dim*sp.hstack(stacks).tocsr()             # <<<<<<<<<<<<<<
  *         return self._average_face_to_cell
  * 
  */
-    __Pyx_TraceLine(4225,0,__PYX_ERR(0, 4225, __pyx_L1_error))
+    __Pyx_TraceLine(4220,0,__PYX_ERR(0, 4220, __pyx_L1_error))
     if (unlikely(__pyx_v_self->_dim == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 4225, __pyx_L1_error)
+      __PYX_ERR(0, 4220, __pyx_L1_error)
     }
-    __pyx_t_5 = PyFloat_FromDouble((1. / ((double)__pyx_v_self->_dim))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4225, __pyx_L1_error)
+    __pyx_t_5 = PyFloat_FromDouble((1. / ((double)__pyx_v_self->_dim))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4220, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4225, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4220, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_hstack); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4225, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_hstack); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4220, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_6 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_6);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_v_stacks) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_stacks);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4225, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4220, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4225, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4220, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4225, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4220, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyNumber_Multiply(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4225, __pyx_L1_error)
+    __pyx_t_7 = PyNumber_Multiply(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4220, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GIVEREF(__pyx_t_7);
     __Pyx_GOTREF(__pyx_v_self->_average_face_to_cell);
     __Pyx_DECREF(__pyx_v_self->_average_face_to_cell);
     __pyx_v_self->_average_face_to_cell = __pyx_t_7;
     __pyx_t_7 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4221
+    /* "discretize/_extensions/tree_ext.pyx":4216
  *             phi_c = Afc @ phi_f
  *         """
  *         if self._average_face_to_cell is None:             # <<<<<<<<<<<<<<
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4226
+  /* "discretize/_extensions/tree_ext.pyx":4221
  *                 stacks += [self.average_face_z_to_cell]
  *             self._average_face_to_cell = 1./self._dim*sp.hstack(stacks).tocsr()
  *         return self._average_face_to_cell             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4226,0,__PYX_ERR(0, 4226, __pyx_L1_error))
+  __Pyx_TraceLine(4221,0,__PYX_ERR(0, 4221, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_face_to_cell);
   __pyx_r = __pyx_v_self->_average_face_to_cell;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4190
+  /* "discretize/_extensions/tree_ext.pyx":4185
  * 
  *     @property
  *     def average_face_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from faces to cell centers (scalar quantities).
  * 
  */
 
@@ -49868,15 +49880,15 @@
   __Pyx_XDECREF(__pyx_v_stacks);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4229
+/* "discretize/_extensions/tree_ext.pyx":4224
  * 
  *     @property
  *     def average_face_to_cell_vector(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from faces to cell centers (vector quantities).
  * 
  */
 
@@ -49904,167 +49916,167 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4229, 0, __PYX_ERR(0, 4229, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4224, 0, __PYX_ERR(0, 4224, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4272
+  /* "discretize/_extensions/tree_ext.pyx":4267
  *         the cell's center.
  *         """
  *         if self._average_face_to_cell_vector is None:             # <<<<<<<<<<<<<<
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:
  */
-  __Pyx_TraceLine(4272,0,__PYX_ERR(0, 4272, __pyx_L1_error))
+  __Pyx_TraceLine(4267,0,__PYX_ERR(0, 4267, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_face_to_cell_vector == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4273
+    /* "discretize/_extensions/tree_ext.pyx":4268
  *         """
  *         if self._average_face_to_cell_vector is None:
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]             # <<<<<<<<<<<<<<
  *             if self._dim == 3:
  *                 stacks += [self.average_face_z_to_cell]
  */
-    __Pyx_TraceLine(4273,0,__PYX_ERR(0, 4273, __pyx_L1_error))
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_face_x_to_cell); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4273, __pyx_L1_error)
+    __Pyx_TraceLine(4268,0,__PYX_ERR(0, 4268, __pyx_L1_error))
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_face_x_to_cell); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_aveFy2CC); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4273, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_aveFy2CC); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4273, __pyx_L1_error)
+    __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_3);
     PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_4);
     PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
     __pyx_t_3 = 0;
     __pyx_t_4 = 0;
     __pyx_v_stacks = ((PyObject*)__pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4274
+    /* "discretize/_extensions/tree_ext.pyx":4269
  *         if self._average_face_to_cell_vector is None:
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:             # <<<<<<<<<<<<<<
  *                 stacks += [self.average_face_z_to_cell]
  *             self._average_face_to_cell_vector = sp.block_diag(stacks).tocsr()
  */
-    __Pyx_TraceLine(4274,0,__PYX_ERR(0, 4274, __pyx_L1_error))
+    __Pyx_TraceLine(4269,0,__PYX_ERR(0, 4269, __pyx_L1_error))
     __pyx_t_2 = ((__pyx_v_self->_dim == 3) != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4275
+      /* "discretize/_extensions/tree_ext.pyx":4270
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:
  *                 stacks += [self.average_face_z_to_cell]             # <<<<<<<<<<<<<<
  *             self._average_face_to_cell_vector = sp.block_diag(stacks).tocsr()
  *         return self._average_face_to_cell_vector
  */
-      __Pyx_TraceLine(4275,0,__PYX_ERR(0, 4275, __pyx_L1_error))
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_face_z_to_cell); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4275, __pyx_L1_error)
+      __Pyx_TraceLine(4270,0,__PYX_ERR(0, 4270, __pyx_L1_error))
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_face_z_to_cell); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4270, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4275, __pyx_L1_error)
+      __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4270, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_GIVEREF(__pyx_t_5);
       PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
       __pyx_t_5 = 0;
-      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_stacks, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4275, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_stacks, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4270, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF_SET(__pyx_v_stacks, ((PyObject*)__pyx_t_5));
       __pyx_t_5 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":4274
+      /* "discretize/_extensions/tree_ext.pyx":4269
  *         if self._average_face_to_cell_vector is None:
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:             # <<<<<<<<<<<<<<
  *                 stacks += [self.average_face_z_to_cell]
  *             self._average_face_to_cell_vector = sp.block_diag(stacks).tocsr()
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4276
+    /* "discretize/_extensions/tree_ext.pyx":4271
  *             if self._dim == 3:
  *                 stacks += [self.average_face_z_to_cell]
  *             self._average_face_to_cell_vector = sp.block_diag(stacks).tocsr()             # <<<<<<<<<<<<<<
  *         return self._average_face_to_cell_vector
  * 
  */
-    __Pyx_TraceLine(4276,0,__PYX_ERR(0, 4276, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4276, __pyx_L1_error)
+    __Pyx_TraceLine(4271,0,__PYX_ERR(0, 4271, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_block_diag); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4276, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_block_diag); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_3)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
         __Pyx_INCREF(__pyx_t_3);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_6, function);
       }
     }
     __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_v_stacks) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_stacks);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4276, __pyx_L1_error)
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4276, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_4 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
         __Pyx_INCREF(__pyx_t_4);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_6, function);
       }
     }
     __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4276, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4271, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_GIVEREF(__pyx_t_5);
     __Pyx_GOTREF(__pyx_v_self->_average_face_to_cell_vector);
     __Pyx_DECREF(__pyx_v_self->_average_face_to_cell_vector);
     __pyx_v_self->_average_face_to_cell_vector = __pyx_t_5;
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4272
+    /* "discretize/_extensions/tree_ext.pyx":4267
  *         the cell's center.
  *         """
  *         if self._average_face_to_cell_vector is None:             # <<<<<<<<<<<<<<
  *             stacks = [self.average_face_x_to_cell, self.aveFy2CC]
  *             if self._dim == 3:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4277
+  /* "discretize/_extensions/tree_ext.pyx":4272
  *                 stacks += [self.average_face_z_to_cell]
  *             self._average_face_to_cell_vector = sp.block_diag(stacks).tocsr()
  *         return self._average_face_to_cell_vector             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4277,0,__PYX_ERR(0, 4277, __pyx_L1_error))
+  __Pyx_TraceLine(4272,0,__PYX_ERR(0, 4272, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_face_to_cell_vector);
   __pyx_r = __pyx_v_self->_average_face_to_cell_vector;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4229
+  /* "discretize/_extensions/tree_ext.pyx":4224
  * 
  *     @property
  *     def average_face_to_cell_vector(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from faces to cell centers (vector quantities).
  * 
  */
 
@@ -50080,15 +50092,15 @@
   __Pyx_XDECREF(__pyx_v_stacks);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4281
+/* "discretize/_extensions/tree_ext.pyx":4276
  *     @property
  *     @cython.boundscheck(False)
  *     def average_node_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from nodes to cell centers (scalar quantities).
  * 
  */
 
@@ -50137,399 +50149,399 @@
   __pyx_t_5numpy_int64_t __pyx_t_17;
   int_t __pyx_t_18;
   PyObject *__pyx_t_19 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4281, 0, __PYX_ERR(0, 4281, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4276, 0, __PYX_ERR(0, 4276, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4316
+  /* "discretize/_extensions/tree_ext.pyx":4311
  *         cdef np.int64_t ii, id, n_ppc
  *         cdef double scale
  *         if self._average_node_to_cell is None:             # <<<<<<<<<<<<<<
  *             n_ppc = 1<<self._dim
  *             scale = 1.0/n_ppc
  */
-  __Pyx_TraceLine(4316,0,__PYX_ERR(0, 4316, __pyx_L1_error))
+  __Pyx_TraceLine(4311,0,__PYX_ERR(0, 4311, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_cell == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4317
+    /* "discretize/_extensions/tree_ext.pyx":4312
  *         cdef double scale
  *         if self._average_node_to_cell is None:
  *             n_ppc = 1<<self._dim             # <<<<<<<<<<<<<<
  *             scale = 1.0/n_ppc
  *             I = np.empty(self.n_cells*n_ppc, dtype=np.int64)
  */
-    __Pyx_TraceLine(4317,0,__PYX_ERR(0, 4317, __pyx_L1_error))
+    __Pyx_TraceLine(4312,0,__PYX_ERR(0, 4312, __pyx_L1_error))
     __pyx_v_n_ppc = (1 << __pyx_v_self->_dim);
 
-    /* "discretize/_extensions/tree_ext.pyx":4318
+    /* "discretize/_extensions/tree_ext.pyx":4313
  *         if self._average_node_to_cell is None:
  *             n_ppc = 1<<self._dim
  *             scale = 1.0/n_ppc             # <<<<<<<<<<<<<<
  *             I = np.empty(self.n_cells*n_ppc, dtype=np.int64)
  *             J = np.empty(self.n_cells*n_ppc, dtype=np.int64)
  */
-    __Pyx_TraceLine(4318,0,__PYX_ERR(0, 4318, __pyx_L1_error))
+    __Pyx_TraceLine(4313,0,__PYX_ERR(0, 4313, __pyx_L1_error))
     if (unlikely(__pyx_v_n_ppc == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 4318, __pyx_L1_error)
+      __PYX_ERR(0, 4313, __pyx_L1_error)
     }
     __pyx_v_scale = (1.0 / ((double)__pyx_v_n_ppc));
 
-    /* "discretize/_extensions/tree_ext.pyx":4319
+    /* "discretize/_extensions/tree_ext.pyx":4314
  *             n_ppc = 1<<self._dim
  *             scale = 1.0/n_ppc
  *             I = np.empty(self.n_cells*n_ppc, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             J = np.empty(self.n_cells*n_ppc, dtype=np.int64)
  *             V = np.empty(self.n_cells*n_ppc, dtype=np.float64)
  */
-    __Pyx_TraceLine(4319,0,__PYX_ERR(0, 4319, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __Pyx_TraceLine(4314,0,__PYX_ERR(0, 4314, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyInt_From_npy_int64(__pyx_v_n_ppc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_From_npy_int64(__pyx_v_n_ppc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = PyNumber_Multiply(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_6 = PyNumber_Multiply(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4319, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4319, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4314, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_v_I = __pyx_t_8;
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4320
+    /* "discretize/_extensions/tree_ext.pyx":4315
  *             scale = 1.0/n_ppc
  *             I = np.empty(self.n_cells*n_ppc, dtype=np.int64)
  *             J = np.empty(self.n_cells*n_ppc, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             V = np.empty(self.n_cells*n_ppc, dtype=np.float64)
  * 
  */
-    __Pyx_TraceLine(4320,0,__PYX_ERR(0, 4320, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __Pyx_TraceLine(4315,0,__PYX_ERR(0, 4315, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_5 = __Pyx_PyInt_From_npy_int64(__pyx_v_n_ppc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_From_npy_int64(__pyx_v_n_ppc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyNumber_Multiply(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Multiply(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 4320, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4320, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4315, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_J = __pyx_t_8;
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4321
+    /* "discretize/_extensions/tree_ext.pyx":4316
  *             I = np.empty(self.n_cells*n_ppc, dtype=np.int64)
  *             J = np.empty(self.n_cells*n_ppc, dtype=np.int64)
  *             V = np.empty(self.n_cells*n_ppc, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *             for cell in self.tree.cells:
  */
-    __Pyx_TraceLine(4321,0,__PYX_ERR(0, 4321, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __Pyx_TraceLine(4316,0,__PYX_ERR(0, 4316, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyInt_From_npy_int64(__pyx_v_n_ppc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_From_npy_int64(__pyx_v_n_ppc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = PyNumber_Multiply(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_6 = PyNumber_Multiply(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_float64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_float64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4321, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4321, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4316, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_v_V = __pyx_t_9;
     __pyx_t_9.memview = NULL;
     __pyx_t_9.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":4323
+    /* "discretize/_extensions/tree_ext.pyx":4318
  *             V = np.empty(self.n_cells*n_ppc, dtype=np.float64)
  * 
  *             for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *                 ii = cell.index
  *                 for id in range(n_ppc):
  */
-    __Pyx_TraceLine(4323,0,__PYX_ERR(0, 4323, __pyx_L1_error))
+    __Pyx_TraceLine(4318,0,__PYX_ERR(0, 4318, __pyx_L1_error))
     __pyx_t_11 = &__pyx_v_self->tree->cells;
     __pyx_t_10 = __pyx_t_11->begin();
     for (;;) {
       if (!(__pyx_t_10 != __pyx_t_11->end())) break;
       __pyx_t_12 = *__pyx_t_10;
       ++__pyx_t_10;
       __pyx_v_cell = __pyx_t_12;
 
-      /* "discretize/_extensions/tree_ext.pyx":4324
+      /* "discretize/_extensions/tree_ext.pyx":4319
  * 
  *             for cell in self.tree.cells:
  *                 ii = cell.index             # <<<<<<<<<<<<<<
  *                 for id in range(n_ppc):
  *                     I[ii*n_ppc + id] = ii
  */
-      __Pyx_TraceLine(4324,0,__PYX_ERR(0, 4324, __pyx_L1_error))
+      __Pyx_TraceLine(4319,0,__PYX_ERR(0, 4319, __pyx_L1_error))
       __pyx_t_13 = __pyx_v_cell->index;
       __pyx_v_ii = __pyx_t_13;
 
-      /* "discretize/_extensions/tree_ext.pyx":4325
+      /* "discretize/_extensions/tree_ext.pyx":4320
  *             for cell in self.tree.cells:
  *                 ii = cell.index
  *                 for id in range(n_ppc):             # <<<<<<<<<<<<<<
  *                     I[ii*n_ppc + id] = ii
  *                     J[ii*n_ppc + id] = cell.points[id].index
  */
-      __Pyx_TraceLine(4325,0,__PYX_ERR(0, 4325, __pyx_L1_error))
+      __Pyx_TraceLine(4320,0,__PYX_ERR(0, 4320, __pyx_L1_error))
       __pyx_t_14 = __pyx_v_n_ppc;
       __pyx_t_15 = __pyx_t_14;
       for (__pyx_t_16 = 0; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
         __pyx_v_id = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4326
+        /* "discretize/_extensions/tree_ext.pyx":4321
  *                 ii = cell.index
  *                 for id in range(n_ppc):
  *                     I[ii*n_ppc + id] = ii             # <<<<<<<<<<<<<<
  *                     J[ii*n_ppc + id] = cell.points[id].index
  *                     V[ii*n_ppc + id] = scale
  */
-        __Pyx_TraceLine(4326,0,__PYX_ERR(0, 4326, __pyx_L1_error))
+        __Pyx_TraceLine(4321,0,__PYX_ERR(0, 4321, __pyx_L1_error))
         __pyx_t_17 = ((__pyx_v_ii * __pyx_v_n_ppc) + __pyx_v_id);
         if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_I.shape[0];
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_17 * __pyx_v_I.strides[0]) )) = __pyx_v_ii;
 
-        /* "discretize/_extensions/tree_ext.pyx":4327
+        /* "discretize/_extensions/tree_ext.pyx":4322
  *                 for id in range(n_ppc):
  *                     I[ii*n_ppc + id] = ii
  *                     J[ii*n_ppc + id] = cell.points[id].index             # <<<<<<<<<<<<<<
  *                     V[ii*n_ppc + id] = scale
  * 
  */
-        __Pyx_TraceLine(4327,0,__PYX_ERR(0, 4327, __pyx_L1_error))
+        __Pyx_TraceLine(4322,0,__PYX_ERR(0, 4322, __pyx_L1_error))
         __pyx_t_18 = (__pyx_v_cell->points[__pyx_v_id])->index;
         __pyx_t_17 = ((__pyx_v_ii * __pyx_v_n_ppc) + __pyx_v_id);
         if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_J.shape[0];
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_17 * __pyx_v_J.strides[0]) )) = __pyx_t_18;
 
-        /* "discretize/_extensions/tree_ext.pyx":4328
+        /* "discretize/_extensions/tree_ext.pyx":4323
  *                     I[ii*n_ppc + id] = ii
  *                     J[ii*n_ppc + id] = cell.points[id].index
  *                     V[ii*n_ppc + id] = scale             # <<<<<<<<<<<<<<
  * 
  *             Rn = self._deflate_nodes()
  */
-        __Pyx_TraceLine(4328,0,__PYX_ERR(0, 4328, __pyx_L1_error))
+        __Pyx_TraceLine(4323,0,__PYX_ERR(0, 4323, __pyx_L1_error))
         __pyx_t_17 = ((__pyx_v_ii * __pyx_v_n_ppc) + __pyx_v_id);
         if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_V.shape[0];
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_17 * __pyx_v_V.strides[0]) )) = __pyx_v_scale;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4323
+      /* "discretize/_extensions/tree_ext.pyx":4318
  *             V = np.empty(self.n_cells*n_ppc, dtype=np.float64)
  * 
  *             for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *                 ii = cell.index
  *                 for id in range(n_ppc):
  */
-      __Pyx_TraceLine(4323,0,__PYX_ERR(0, 4323, __pyx_L1_error))
+      __Pyx_TraceLine(4318,0,__PYX_ERR(0, 4318, __pyx_L1_error))
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4330
+    /* "discretize/_extensions/tree_ext.pyx":4325
  *                     V[ii*n_ppc + id] = scale
  * 
  *             Rn = self._deflate_nodes()             # <<<<<<<<<<<<<<
  *             self._average_node_to_cell = sp.csr_matrix((V, (I, J)), shape=(self.n_cells, self.n_total_nodes))*Rn
  *         return self._average_node_to_cell
  */
-    __Pyx_TraceLine(4330,0,__PYX_ERR(0, 4330, __pyx_L1_error))
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4330, __pyx_L1_error)
+    __Pyx_TraceLine(4325,0,__PYX_ERR(0, 4325, __pyx_L1_error))
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4325, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_6, function);
       }
     }
     __pyx_t_7 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4330, __pyx_L1_error)
+    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4325, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_Rn = __pyx_t_7;
     __pyx_t_7 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4331
+    /* "discretize/_extensions/tree_ext.pyx":4326
  * 
  *             Rn = self._deflate_nodes()
  *             self._average_node_to_cell = sp.csr_matrix((V, (I, J)), shape=(self.n_cells, self.n_total_nodes))*Rn             # <<<<<<<<<<<<<<
  *         return self._average_node_to_cell
  * 
  */
-    __Pyx_TraceLine(4331,0,__PYX_ERR(0, 4331, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __Pyx_TraceLine(4326,0,__PYX_ERR(0, 4326, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_sp); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
     __pyx_t_5 = 0;
     __pyx_t_4 = 0;
-    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_3);
     __pyx_t_7 = 0;
     __pyx_t_3 = 0;
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_19 = PyTuple_New(2); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_19 = PyTuple_New(2); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_19);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_19, 0, __pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_19, 1, __pyx_t_5);
     __pyx_t_7 = 0;
     __pyx_t_5 = 0;
-    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_shape, __pyx_t_19) < 0) __PYX_ERR(0, 4331, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_shape, __pyx_t_19) < 0) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
-    __pyx_t_19 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_19 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_19);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_Multiply(__pyx_t_19, __pyx_v_Rn); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4331, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Multiply(__pyx_t_19, __pyx_v_Rn); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4326, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
     __Pyx_GIVEREF(__pyx_t_4);
     __Pyx_GOTREF(__pyx_v_self->_average_node_to_cell);
     __Pyx_DECREF(__pyx_v_self->_average_node_to_cell);
     __pyx_v_self->_average_node_to_cell = __pyx_t_4;
     __pyx_t_4 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4316
+    /* "discretize/_extensions/tree_ext.pyx":4311
  *         cdef np.int64_t ii, id, n_ppc
  *         cdef double scale
  *         if self._average_node_to_cell is None:             # <<<<<<<<<<<<<<
  *             n_ppc = 1<<self._dim
  *             scale = 1.0/n_ppc
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4332
+  /* "discretize/_extensions/tree_ext.pyx":4327
  *             Rn = self._deflate_nodes()
  *             self._average_node_to_cell = sp.csr_matrix((V, (I, J)), shape=(self.n_cells, self.n_total_nodes))*Rn
  *         return self._average_node_to_cell             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4332,0,__PYX_ERR(0, 4332, __pyx_L1_error))
+  __Pyx_TraceLine(4327,0,__PYX_ERR(0, 4327, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_cell);
   __pyx_r = __pyx_v_self->_average_node_to_cell;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4281
+  /* "discretize/_extensions/tree_ext.pyx":4276
  *     @property
  *     @cython.boundscheck(False)
  *     def average_node_to_cell(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from nodes to cell centers (scalar quantities).
  * 
  */
 
@@ -50552,15 +50564,15 @@
   __Pyx_XDECREF(__pyx_v_Rn);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4335
+/* "discretize/_extensions/tree_ext.pyx":4330
  * 
  *     @property
  *     def average_node_to_edge_x(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to x edges (scalar quantities).
  * 
  */
 
@@ -50607,443 +50619,443 @@
   __pyx_t_5numpy_int64_t __pyx_t_16;
   int __pyx_t_17;
   PyObject *__pyx_t_18 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4335, 0, __PYX_ERR(0, 4335, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4330, 0, __PYX_ERR(0, 4330, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4348
+  /* "discretize/_extensions/tree_ext.pyx":4343
  *             The scalar averaging operator from nodes to edges
  *         """
  *         if self._average_node_to_edge_x is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_edge_x
  *         cdef np.int64_t[:] I, J
  */
-  __Pyx_TraceLine(4348,0,__PYX_ERR(0, 4348, __pyx_L1_error))
+  __Pyx_TraceLine(4343,0,__PYX_ERR(0, 4343, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_edge_x != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4349
+    /* "discretize/_extensions/tree_ext.pyx":4344
  *         """
  *         if self._average_node_to_edge_x is not None:
  *             return self._average_node_to_edge_x             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I, J
  *         cdef np.float64_t[:] V
  */
-    __Pyx_TraceLine(4349,0,__PYX_ERR(0, 4349, __pyx_L1_error))
+    __Pyx_TraceLine(4344,0,__PYX_ERR(0, 4344, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_node_to_edge_x);
     __pyx_r = __pyx_v_self->_average_node_to_edge_x;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4348
+    /* "discretize/_extensions/tree_ext.pyx":4343
  *             The scalar averaging operator from nodes to edges
  *         """
  *         if self._average_node_to_edge_x is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_edge_x
  *         cdef np.int64_t[:] I, J
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4353
+  /* "discretize/_extensions/tree_ext.pyx":4348
  *         cdef np.float64_t[:] V
  *         cdef np.int64_t ii, id
  *         I = np.empty(self.n_edges_x*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_edges_x*2, dtype=np.int64)
  *         V = np.empty(self.n_edges_x*2, dtype=np.float64)
  */
-  __Pyx_TraceLine(4353,0,__PYX_ERR(0, 4353, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __Pyx_TraceLine(4348,0,__PYX_ERR(0, 4348, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4353, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4353, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4348, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4354
+  /* "discretize/_extensions/tree_ext.pyx":4349
  *         cdef np.int64_t ii, id
  *         I = np.empty(self.n_edges_x*2, dtype=np.int64)
  *         J = np.empty(self.n_edges_x*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_edges_x*2, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4354,0,__PYX_ERR(0, 4354, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __Pyx_TraceLine(4349,0,__PYX_ERR(0, 4349, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4354, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4354, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4349, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4355
+  /* "discretize/_extensions/tree_ext.pyx":4350
  *         I = np.empty(self.n_edges_x*2, dtype=np.int64)
  *         J = np.empty(self.n_edges_x*2, dtype=np.int64)
  *         V = np.empty(self.n_edges_x*2, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for it in self.tree.edges_x:
  */
-  __Pyx_TraceLine(4355,0,__PYX_ERR(0, 4355, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __Pyx_TraceLine(4350,0,__PYX_ERR(0, 4350, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4355, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4355, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4350, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4357
+  /* "discretize/_extensions/tree_ext.pyx":4352
  *         V = np.empty(self.n_edges_x*2, dtype=np.float64)
  * 
  *         for it in self.tree.edges_x:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             if edge.hanging:
  */
-  __Pyx_TraceLine(4357,0,__PYX_ERR(0, 4357, __pyx_L1_error))
+  __Pyx_TraceLine(4352,0,__PYX_ERR(0, 4352, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->edges_x;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_it = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4358
+    /* "discretize/_extensions/tree_ext.pyx":4353
  * 
  *         for it in self.tree.edges_x:
  *             edge = it.second             # <<<<<<<<<<<<<<
  *             if edge.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(4358,0,__PYX_ERR(0, 4358, __pyx_L1_error))
+    __Pyx_TraceLine(4353,0,__PYX_ERR(0, 4353, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_it.second;
     __pyx_v_edge = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4359
+    /* "discretize/_extensions/tree_ext.pyx":4354
  *         for it in self.tree.edges_x:
  *             edge = it.second
  *             if edge.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = edge.index
  */
-    __Pyx_TraceLine(4359,0,__PYX_ERR(0, 4359, __pyx_L1_error))
+    __Pyx_TraceLine(4354,0,__PYX_ERR(0, 4354, __pyx_L1_error))
     __pyx_t_2 = (__pyx_v_edge->hanging != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4360
+      /* "discretize/_extensions/tree_ext.pyx":4355
  *             edge = it.second
  *             if edge.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = edge.index
  *             for id in range(2):
  */
-      __Pyx_TraceLine(4360,0,__PYX_ERR(0, 4360, __pyx_L1_error))
+      __Pyx_TraceLine(4355,0,__PYX_ERR(0, 4355, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":4359
+      /* "discretize/_extensions/tree_ext.pyx":4354
  *         for it in self.tree.edges_x:
  *             edge = it.second
  *             if edge.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = edge.index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4361
+    /* "discretize/_extensions/tree_ext.pyx":4356
  *             if edge.hanging:
  *                 continue
  *             ii = edge.index             # <<<<<<<<<<<<<<
  *             for id in range(2):
  *                 I[ii*2 + id] = ii
  */
-    __Pyx_TraceLine(4361,0,__PYX_ERR(0, 4361, __pyx_L1_error))
+    __Pyx_TraceLine(4356,0,__PYX_ERR(0, 4356, __pyx_L1_error))
     __pyx_t_14 = __pyx_v_edge->index;
     __pyx_v_ii = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":4362
+    /* "discretize/_extensions/tree_ext.pyx":4357
  *                 continue
  *             ii = edge.index
  *             for id in range(2):             # <<<<<<<<<<<<<<
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index
  */
-    __Pyx_TraceLine(4362,0,__PYX_ERR(0, 4362, __pyx_L1_error))
+    __Pyx_TraceLine(4357,0,__PYX_ERR(0, 4357, __pyx_L1_error))
     for (__pyx_t_15 = 0; __pyx_t_15 < 2; __pyx_t_15+=1) {
       __pyx_v_id = __pyx_t_15;
 
-      /* "discretize/_extensions/tree_ext.pyx":4363
+      /* "discretize/_extensions/tree_ext.pyx":4358
  *             ii = edge.index
  *             for id in range(2):
  *                 I[ii*2 + id] = ii             # <<<<<<<<<<<<<<
  *                 J[ii*2 + id] = edge.points[id].index
  *                 V[ii*2 + id] = 0.5
  */
-      __Pyx_TraceLine(4363,0,__PYX_ERR(0, 4363, __pyx_L1_error))
+      __Pyx_TraceLine(4358,0,__PYX_ERR(0, 4358, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_I.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4363, __pyx_L1_error)
+        __PYX_ERR(0, 4358, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_16 * __pyx_v_I.strides[0]) )) = __pyx_v_ii;
 
-      /* "discretize/_extensions/tree_ext.pyx":4364
+      /* "discretize/_extensions/tree_ext.pyx":4359
  *             for id in range(2):
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index             # <<<<<<<<<<<<<<
  *                 V[ii*2 + id] = 0.5
  * 
  */
-      __Pyx_TraceLine(4364,0,__PYX_ERR(0, 4364, __pyx_L1_error))
+      __Pyx_TraceLine(4359,0,__PYX_ERR(0, 4359, __pyx_L1_error))
       __pyx_t_14 = (__pyx_v_edge->points[__pyx_v_id])->index;
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4364, __pyx_L1_error)
+        __PYX_ERR(0, 4359, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_14;
 
-      /* "discretize/_extensions/tree_ext.pyx":4365
+      /* "discretize/_extensions/tree_ext.pyx":4360
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index
  *                 V[ii*2 + id] = 0.5             # <<<<<<<<<<<<<<
  * 
  *         Rn = self._deflate_nodes()
  */
-      __Pyx_TraceLine(4365,0,__PYX_ERR(0, 4365, __pyx_L1_error))
+      __Pyx_TraceLine(4360,0,__PYX_ERR(0, 4360, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_V.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4365, __pyx_L1_error)
+        __PYX_ERR(0, 4360, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_16 * __pyx_v_V.strides[0]) )) = 0.5;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4357
+    /* "discretize/_extensions/tree_ext.pyx":4352
  *         V = np.empty(self.n_edges_x*2, dtype=np.float64)
  * 
  *         for it in self.tree.edges_x:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             if edge.hanging:
  */
-    __Pyx_TraceLine(4357,0,__PYX_ERR(0, 4357, __pyx_L1_error))
+    __Pyx_TraceLine(4352,0,__PYX_ERR(0, 4352, __pyx_L1_error))
     __pyx_L4_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4367
+  /* "discretize/_extensions/tree_ext.pyx":4362
  *                 V[ii*2 + id] = 0.5
  * 
  *         Rn = self._deflate_nodes()             # <<<<<<<<<<<<<<
  *         self._average_node_to_edge_x = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_x, self.n_total_nodes))*Rn
  *         return self._average_node_to_edge_x
  */
-  __Pyx_TraceLine(4367,0,__PYX_ERR(0, 4367, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4367, __pyx_L1_error)
+  __Pyx_TraceLine(4362,0,__PYX_ERR(0, 4362, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4367, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4362, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rn = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4368
+  /* "discretize/_extensions/tree_ext.pyx":4363
  * 
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_edge_x = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_x, self.n_total_nodes))*Rn             # <<<<<<<<<<<<<<
  *         return self._average_node_to_edge_x
  * 
  */
-  __Pyx_TraceLine(4368,0,__PYX_ERR(0, 4368, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __Pyx_TraceLine(4363,0,__PYX_ERR(0, 4363, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
   __pyx_t_6 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_5);
   __pyx_t_4 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4368, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4368, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4363, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
   __Pyx_GIVEREF(__pyx_t_3);
   __Pyx_GOTREF(__pyx_v_self->_average_node_to_edge_x);
   __Pyx_DECREF(__pyx_v_self->_average_node_to_edge_x);
   __pyx_v_self->_average_node_to_edge_x = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4369
+  /* "discretize/_extensions/tree_ext.pyx":4364
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_edge_x = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_x, self.n_total_nodes))*Rn
  *         return self._average_node_to_edge_x             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4369,0,__PYX_ERR(0, 4369, __pyx_L1_error))
+  __Pyx_TraceLine(4364,0,__PYX_ERR(0, 4364, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_edge_x);
   __pyx_r = __pyx_v_self->_average_node_to_edge_x;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4335
+  /* "discretize/_extensions/tree_ext.pyx":4330
  * 
  *     @property
  *     def average_node_to_edge_x(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to x edges (scalar quantities).
  * 
  */
 
@@ -51066,15 +51078,15 @@
   __Pyx_XDECREF(__pyx_v_Rn);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4372
+/* "discretize/_extensions/tree_ext.pyx":4367
  * 
  *     @property
  *     def average_node_to_edge_y(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to y edges (scalar quantities).
  * 
  */
 
@@ -51121,443 +51133,443 @@
   __pyx_t_5numpy_int64_t __pyx_t_16;
   int __pyx_t_17;
   PyObject *__pyx_t_18 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4372, 0, __PYX_ERR(0, 4372, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4367, 0, __PYX_ERR(0, 4367, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4385
+  /* "discretize/_extensions/tree_ext.pyx":4380
  *             The scalar averaging operator from nodes to edges
  *         """
  *         if self._average_node_to_edge_y is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_edge_y
  *         cdef np.int64_t[:] I, J
  */
-  __Pyx_TraceLine(4385,0,__PYX_ERR(0, 4385, __pyx_L1_error))
+  __Pyx_TraceLine(4380,0,__PYX_ERR(0, 4380, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_edge_y != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4386
+    /* "discretize/_extensions/tree_ext.pyx":4381
  *         """
  *         if self._average_node_to_edge_y is not None:
  *             return self._average_node_to_edge_y             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I, J
  *         cdef np.float64_t[:] V
  */
-    __Pyx_TraceLine(4386,0,__PYX_ERR(0, 4386, __pyx_L1_error))
+    __Pyx_TraceLine(4381,0,__PYX_ERR(0, 4381, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_node_to_edge_y);
     __pyx_r = __pyx_v_self->_average_node_to_edge_y;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4385
+    /* "discretize/_extensions/tree_ext.pyx":4380
  *             The scalar averaging operator from nodes to edges
  *         """
  *         if self._average_node_to_edge_y is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_edge_y
  *         cdef np.int64_t[:] I, J
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4390
+  /* "discretize/_extensions/tree_ext.pyx":4385
  *         cdef np.float64_t[:] V
  *         cdef np.int64_t ii, id
  *         I = np.empty(self.n_edges_y*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_edges_y*2, dtype=np.int64)
  *         V = np.empty(self.n_edges_y*2, dtype=np.float64)
  */
-  __Pyx_TraceLine(4390,0,__PYX_ERR(0, 4390, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __Pyx_TraceLine(4385,0,__PYX_ERR(0, 4385, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4390, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4390, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4385, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4391
+  /* "discretize/_extensions/tree_ext.pyx":4386
  *         cdef np.int64_t ii, id
  *         I = np.empty(self.n_edges_y*2, dtype=np.int64)
  *         J = np.empty(self.n_edges_y*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_edges_y*2, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4391,0,__PYX_ERR(0, 4391, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __Pyx_TraceLine(4386,0,__PYX_ERR(0, 4386, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4391, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4391, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4386, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4392
+  /* "discretize/_extensions/tree_ext.pyx":4387
  *         I = np.empty(self.n_edges_y*2, dtype=np.int64)
  *         J = np.empty(self.n_edges_y*2, dtype=np.int64)
  *         V = np.empty(self.n_edges_y*2, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for it in self.tree.edges_y:
  */
-  __Pyx_TraceLine(4392,0,__PYX_ERR(0, 4392, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __Pyx_TraceLine(4387,0,__PYX_ERR(0, 4387, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_y); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_y); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4392, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4392, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4387, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4394
+  /* "discretize/_extensions/tree_ext.pyx":4389
  *         V = np.empty(self.n_edges_y*2, dtype=np.float64)
  * 
  *         for it in self.tree.edges_y:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             if edge.hanging:
  */
-  __Pyx_TraceLine(4394,0,__PYX_ERR(0, 4394, __pyx_L1_error))
+  __Pyx_TraceLine(4389,0,__PYX_ERR(0, 4389, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->edges_y;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_it = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4395
+    /* "discretize/_extensions/tree_ext.pyx":4390
  * 
  *         for it in self.tree.edges_y:
  *             edge = it.second             # <<<<<<<<<<<<<<
  *             if edge.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(4395,0,__PYX_ERR(0, 4395, __pyx_L1_error))
+    __Pyx_TraceLine(4390,0,__PYX_ERR(0, 4390, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_it.second;
     __pyx_v_edge = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4396
+    /* "discretize/_extensions/tree_ext.pyx":4391
  *         for it in self.tree.edges_y:
  *             edge = it.second
  *             if edge.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = edge.index
  */
-    __Pyx_TraceLine(4396,0,__PYX_ERR(0, 4396, __pyx_L1_error))
+    __Pyx_TraceLine(4391,0,__PYX_ERR(0, 4391, __pyx_L1_error))
     __pyx_t_2 = (__pyx_v_edge->hanging != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4397
+      /* "discretize/_extensions/tree_ext.pyx":4392
  *             edge = it.second
  *             if edge.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = edge.index
  *             for id in range(2):
  */
-      __Pyx_TraceLine(4397,0,__PYX_ERR(0, 4397, __pyx_L1_error))
+      __Pyx_TraceLine(4392,0,__PYX_ERR(0, 4392, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":4396
+      /* "discretize/_extensions/tree_ext.pyx":4391
  *         for it in self.tree.edges_y:
  *             edge = it.second
  *             if edge.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = edge.index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4398
+    /* "discretize/_extensions/tree_ext.pyx":4393
  *             if edge.hanging:
  *                 continue
  *             ii = edge.index             # <<<<<<<<<<<<<<
  *             for id in range(2):
  *                 I[ii*2 + id] = ii
  */
-    __Pyx_TraceLine(4398,0,__PYX_ERR(0, 4398, __pyx_L1_error))
+    __Pyx_TraceLine(4393,0,__PYX_ERR(0, 4393, __pyx_L1_error))
     __pyx_t_14 = __pyx_v_edge->index;
     __pyx_v_ii = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":4399
+    /* "discretize/_extensions/tree_ext.pyx":4394
  *                 continue
  *             ii = edge.index
  *             for id in range(2):             # <<<<<<<<<<<<<<
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index
  */
-    __Pyx_TraceLine(4399,0,__PYX_ERR(0, 4399, __pyx_L1_error))
+    __Pyx_TraceLine(4394,0,__PYX_ERR(0, 4394, __pyx_L1_error))
     for (__pyx_t_15 = 0; __pyx_t_15 < 2; __pyx_t_15+=1) {
       __pyx_v_id = __pyx_t_15;
 
-      /* "discretize/_extensions/tree_ext.pyx":4400
+      /* "discretize/_extensions/tree_ext.pyx":4395
  *             ii = edge.index
  *             for id in range(2):
  *                 I[ii*2 + id] = ii             # <<<<<<<<<<<<<<
  *                 J[ii*2 + id] = edge.points[id].index
  *                 V[ii*2 + id] = 0.5
  */
-      __Pyx_TraceLine(4400,0,__PYX_ERR(0, 4400, __pyx_L1_error))
+      __Pyx_TraceLine(4395,0,__PYX_ERR(0, 4395, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_I.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4400, __pyx_L1_error)
+        __PYX_ERR(0, 4395, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_16 * __pyx_v_I.strides[0]) )) = __pyx_v_ii;
 
-      /* "discretize/_extensions/tree_ext.pyx":4401
+      /* "discretize/_extensions/tree_ext.pyx":4396
  *             for id in range(2):
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index             # <<<<<<<<<<<<<<
  *                 V[ii*2 + id] = 0.5
  * 
  */
-      __Pyx_TraceLine(4401,0,__PYX_ERR(0, 4401, __pyx_L1_error))
+      __Pyx_TraceLine(4396,0,__PYX_ERR(0, 4396, __pyx_L1_error))
       __pyx_t_14 = (__pyx_v_edge->points[__pyx_v_id])->index;
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4401, __pyx_L1_error)
+        __PYX_ERR(0, 4396, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_14;
 
-      /* "discretize/_extensions/tree_ext.pyx":4402
+      /* "discretize/_extensions/tree_ext.pyx":4397
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index
  *                 V[ii*2 + id] = 0.5             # <<<<<<<<<<<<<<
  * 
  *         Rn = self._deflate_nodes()
  */
-      __Pyx_TraceLine(4402,0,__PYX_ERR(0, 4402, __pyx_L1_error))
+      __Pyx_TraceLine(4397,0,__PYX_ERR(0, 4397, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_V.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4402, __pyx_L1_error)
+        __PYX_ERR(0, 4397, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_16 * __pyx_v_V.strides[0]) )) = 0.5;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4394
+    /* "discretize/_extensions/tree_ext.pyx":4389
  *         V = np.empty(self.n_edges_y*2, dtype=np.float64)
  * 
  *         for it in self.tree.edges_y:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             if edge.hanging:
  */
-    __Pyx_TraceLine(4394,0,__PYX_ERR(0, 4394, __pyx_L1_error))
+    __Pyx_TraceLine(4389,0,__PYX_ERR(0, 4389, __pyx_L1_error))
     __pyx_L4_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4404
+  /* "discretize/_extensions/tree_ext.pyx":4399
  *                 V[ii*2 + id] = 0.5
  * 
  *         Rn = self._deflate_nodes()             # <<<<<<<<<<<<<<
  *         self._average_node_to_edge_y = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_y, self.n_total_nodes))*Rn
  *         return self._average_node_to_edge_y
  */
-  __Pyx_TraceLine(4404,0,__PYX_ERR(0, 4404, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4404, __pyx_L1_error)
+  __Pyx_TraceLine(4399,0,__PYX_ERR(0, 4399, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4399, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4404, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4399, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rn = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4405
+  /* "discretize/_extensions/tree_ext.pyx":4400
  * 
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_edge_y = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_y, self.n_total_nodes))*Rn             # <<<<<<<<<<<<<<
  *         return self._average_node_to_edge_y
  * 
  */
-  __Pyx_TraceLine(4405,0,__PYX_ERR(0, 4405, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __Pyx_TraceLine(4400,0,__PYX_ERR(0, 4400, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
   __pyx_t_6 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_5);
   __pyx_t_4 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4405, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4405, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
   __Pyx_GIVEREF(__pyx_t_3);
   __Pyx_GOTREF(__pyx_v_self->_average_node_to_edge_y);
   __Pyx_DECREF(__pyx_v_self->_average_node_to_edge_y);
   __pyx_v_self->_average_node_to_edge_y = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4406
+  /* "discretize/_extensions/tree_ext.pyx":4401
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_edge_y = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_y, self.n_total_nodes))*Rn
  *         return self._average_node_to_edge_y             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4406,0,__PYX_ERR(0, 4406, __pyx_L1_error))
+  __Pyx_TraceLine(4401,0,__PYX_ERR(0, 4401, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_edge_y);
   __pyx_r = __pyx_v_self->_average_node_to_edge_y;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4372
+  /* "discretize/_extensions/tree_ext.pyx":4367
  * 
  *     @property
  *     def average_node_to_edge_y(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to y edges (scalar quantities).
  * 
  */
 
@@ -51580,15 +51592,15 @@
   __Pyx_XDECREF(__pyx_v_Rn);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4409
+/* "discretize/_extensions/tree_ext.pyx":4404
  * 
  *     @property
  *     def average_node_to_edge_z(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to z edges (scalar quantities).
  * 
  */
 
@@ -51635,477 +51647,477 @@
   __pyx_t_5numpy_int64_t __pyx_t_16;
   int __pyx_t_17;
   PyObject *__pyx_t_18 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4409, 0, __PYX_ERR(0, 4409, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4404, 0, __PYX_ERR(0, 4404, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4422
+  /* "discretize/_extensions/tree_ext.pyx":4417
  *             The scalar averaging operator from nodes to edges
  *         """
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             raise Exception('TreeMesh has no z-edges in 2D')
  *         if self._average_node_to_edge_z is not None:
  */
-  __Pyx_TraceLine(4422,0,__PYX_ERR(0, 4422, __pyx_L1_error))
+  __Pyx_TraceLine(4417,0,__PYX_ERR(0, 4417, __pyx_L1_error))
   __pyx_t_1 = ((__pyx_v_self->_dim == 2) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4423
+    /* "discretize/_extensions/tree_ext.pyx":4418
  *         """
  *         if self._dim == 2:
  *             raise Exception('TreeMesh has no z-edges in 2D')             # <<<<<<<<<<<<<<
  *         if self._average_node_to_edge_z is not None:
  *             return self._average_node_to_edge_z
  */
-    __Pyx_TraceLine(4423,0,__PYX_ERR(0, 4423, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4423, __pyx_L1_error)
+    __Pyx_TraceLine(4418,0,__PYX_ERR(0, 4418, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4418, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 4423, __pyx_L1_error)
+    __PYX_ERR(0, 4418, __pyx_L1_error)
 
-    /* "discretize/_extensions/tree_ext.pyx":4422
+    /* "discretize/_extensions/tree_ext.pyx":4417
  *             The scalar averaging operator from nodes to edges
  *         """
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             raise Exception('TreeMesh has no z-edges in 2D')
  *         if self._average_node_to_edge_z is not None:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4424
+  /* "discretize/_extensions/tree_ext.pyx":4419
  *         if self._dim == 2:
  *             raise Exception('TreeMesh has no z-edges in 2D')
  *         if self._average_node_to_edge_z is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_edge_z
  *         cdef np.int64_t[:] I, J
  */
-  __Pyx_TraceLine(4424,0,__PYX_ERR(0, 4424, __pyx_L1_error))
+  __Pyx_TraceLine(4419,0,__PYX_ERR(0, 4419, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_edge_z != Py_None);
   __pyx_t_3 = (__pyx_t_1 != 0);
   if (__pyx_t_3) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4425
+    /* "discretize/_extensions/tree_ext.pyx":4420
  *             raise Exception('TreeMesh has no z-edges in 2D')
  *         if self._average_node_to_edge_z is not None:
  *             return self._average_node_to_edge_z             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I, J
  *         cdef np.float64_t[:] V
  */
-    __Pyx_TraceLine(4425,0,__PYX_ERR(0, 4425, __pyx_L1_error))
+    __Pyx_TraceLine(4420,0,__PYX_ERR(0, 4420, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_node_to_edge_z);
     __pyx_r = __pyx_v_self->_average_node_to_edge_z;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4424
+    /* "discretize/_extensions/tree_ext.pyx":4419
  *         if self._dim == 2:
  *             raise Exception('TreeMesh has no z-edges in 2D')
  *         if self._average_node_to_edge_z is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_edge_z
  *         cdef np.int64_t[:] I, J
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4429
+  /* "discretize/_extensions/tree_ext.pyx":4424
  *         cdef np.float64_t[:] V
  *         cdef np.int64_t ii, id
  *         I = np.empty(self.n_edges_z*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_edges_z*2, dtype=np.int64)
  *         V = np.empty(self.n_edges_z*2, dtype=np.float64)
  */
-  __Pyx_TraceLine(4429,0,__PYX_ERR(0, 4429, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __Pyx_TraceLine(4424,0,__PYX_ERR(0, 4424, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_z); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_z); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_int_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4429, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4429, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4424, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4430
+  /* "discretize/_extensions/tree_ext.pyx":4425
  *         cdef np.int64_t ii, id
  *         I = np.empty(self.n_edges_z*2, dtype=np.int64)
  *         J = np.empty(self.n_edges_z*2, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_edges_z*2, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4430,0,__PYX_ERR(0, 4430, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __Pyx_TraceLine(4425,0,__PYX_ERR(0, 4425, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_2 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_t_7, __pyx_int_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4430, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4430, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4425, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4431
+  /* "discretize/_extensions/tree_ext.pyx":4426
  *         I = np.empty(self.n_edges_z*2, dtype=np.int64)
  *         J = np.empty(self.n_edges_z*2, dtype=np.int64)
  *         V = np.empty(self.n_edges_z*2, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for it in self.tree.edges_z:
  */
-  __Pyx_TraceLine(4431,0,__PYX_ERR(0, 4431, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __Pyx_TraceLine(4426,0,__PYX_ERR(0, 4426, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_z); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_z); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4431, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4431, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4426, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4433
+  /* "discretize/_extensions/tree_ext.pyx":4428
  *         V = np.empty(self.n_edges_z*2, dtype=np.float64)
  * 
  *         for it in self.tree.edges_z:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             if edge.hanging:
  */
-  __Pyx_TraceLine(4433,0,__PYX_ERR(0, 4433, __pyx_L1_error))
+  __Pyx_TraceLine(4428,0,__PYX_ERR(0, 4428, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->edges_z;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_it = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4434
+    /* "discretize/_extensions/tree_ext.pyx":4429
  * 
  *         for it in self.tree.edges_z:
  *             edge = it.second             # <<<<<<<<<<<<<<
  *             if edge.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(4434,0,__PYX_ERR(0, 4434, __pyx_L1_error))
+    __Pyx_TraceLine(4429,0,__PYX_ERR(0, 4429, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_it.second;
     __pyx_v_edge = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4435
+    /* "discretize/_extensions/tree_ext.pyx":4430
  *         for it in self.tree.edges_z:
  *             edge = it.second
  *             if edge.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = edge.index
  */
-    __Pyx_TraceLine(4435,0,__PYX_ERR(0, 4435, __pyx_L1_error))
+    __Pyx_TraceLine(4430,0,__PYX_ERR(0, 4430, __pyx_L1_error))
     __pyx_t_3 = (__pyx_v_edge->hanging != 0);
     if (__pyx_t_3) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4436
+      /* "discretize/_extensions/tree_ext.pyx":4431
  *             edge = it.second
  *             if edge.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = edge.index
  *             for id in range(2):
  */
-      __Pyx_TraceLine(4436,0,__PYX_ERR(0, 4436, __pyx_L1_error))
+      __Pyx_TraceLine(4431,0,__PYX_ERR(0, 4431, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":4435
+      /* "discretize/_extensions/tree_ext.pyx":4430
  *         for it in self.tree.edges_z:
  *             edge = it.second
  *             if edge.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = edge.index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4437
+    /* "discretize/_extensions/tree_ext.pyx":4432
  *             if edge.hanging:
  *                 continue
  *             ii = edge.index             # <<<<<<<<<<<<<<
  *             for id in range(2):
  *                 I[ii*2 + id] = ii
  */
-    __Pyx_TraceLine(4437,0,__PYX_ERR(0, 4437, __pyx_L1_error))
+    __Pyx_TraceLine(4432,0,__PYX_ERR(0, 4432, __pyx_L1_error))
     __pyx_t_14 = __pyx_v_edge->index;
     __pyx_v_ii = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":4438
+    /* "discretize/_extensions/tree_ext.pyx":4433
  *                 continue
  *             ii = edge.index
  *             for id in range(2):             # <<<<<<<<<<<<<<
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index
  */
-    __Pyx_TraceLine(4438,0,__PYX_ERR(0, 4438, __pyx_L1_error))
+    __Pyx_TraceLine(4433,0,__PYX_ERR(0, 4433, __pyx_L1_error))
     for (__pyx_t_15 = 0; __pyx_t_15 < 2; __pyx_t_15+=1) {
       __pyx_v_id = __pyx_t_15;
 
-      /* "discretize/_extensions/tree_ext.pyx":4439
+      /* "discretize/_extensions/tree_ext.pyx":4434
  *             ii = edge.index
  *             for id in range(2):
  *                 I[ii*2 + id] = ii             # <<<<<<<<<<<<<<
  *                 J[ii*2 + id] = edge.points[id].index
  *                 V[ii*2 + id] = 0.5
  */
-      __Pyx_TraceLine(4439,0,__PYX_ERR(0, 4439, __pyx_L1_error))
+      __Pyx_TraceLine(4434,0,__PYX_ERR(0, 4434, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_I.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4439, __pyx_L1_error)
+        __PYX_ERR(0, 4434, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_16 * __pyx_v_I.strides[0]) )) = __pyx_v_ii;
 
-      /* "discretize/_extensions/tree_ext.pyx":4440
+      /* "discretize/_extensions/tree_ext.pyx":4435
  *             for id in range(2):
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index             # <<<<<<<<<<<<<<
  *                 V[ii*2 + id] = 0.5
  * 
  */
-      __Pyx_TraceLine(4440,0,__PYX_ERR(0, 4440, __pyx_L1_error))
+      __Pyx_TraceLine(4435,0,__PYX_ERR(0, 4435, __pyx_L1_error))
       __pyx_t_14 = (__pyx_v_edge->points[__pyx_v_id])->index;
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4440, __pyx_L1_error)
+        __PYX_ERR(0, 4435, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_14;
 
-      /* "discretize/_extensions/tree_ext.pyx":4441
+      /* "discretize/_extensions/tree_ext.pyx":4436
  *                 I[ii*2 + id] = ii
  *                 J[ii*2 + id] = edge.points[id].index
  *                 V[ii*2 + id] = 0.5             # <<<<<<<<<<<<<<
  * 
  *         Rn = self._deflate_nodes()
  */
-      __Pyx_TraceLine(4441,0,__PYX_ERR(0, 4441, __pyx_L1_error))
+      __Pyx_TraceLine(4436,0,__PYX_ERR(0, 4436, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 2) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_V.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4441, __pyx_L1_error)
+        __PYX_ERR(0, 4436, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_16 * __pyx_v_V.strides[0]) )) = 0.5;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4433
+    /* "discretize/_extensions/tree_ext.pyx":4428
  *         V = np.empty(self.n_edges_z*2, dtype=np.float64)
  * 
  *         for it in self.tree.edges_z:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             if edge.hanging:
  */
-    __Pyx_TraceLine(4433,0,__PYX_ERR(0, 4433, __pyx_L1_error))
+    __Pyx_TraceLine(4428,0,__PYX_ERR(0, 4428, __pyx_L1_error))
     __pyx_L5_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4443
+  /* "discretize/_extensions/tree_ext.pyx":4438
  *                 V[ii*2 + id] = 0.5
  * 
  *         Rn = self._deflate_nodes()             # <<<<<<<<<<<<<<
  *         self._average_node_to_edge_z = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_z, self.n_total_nodes))*Rn
  *         return self._average_node_to_edge_z
  */
-  __Pyx_TraceLine(4443,0,__PYX_ERR(0, 4443, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4443, __pyx_L1_error)
+  __Pyx_TraceLine(4438,0,__PYX_ERR(0, 4438, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4438, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4443, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4438, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rn = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4444
+  /* "discretize/_extensions/tree_ext.pyx":4439
  * 
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_edge_z = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_z, self.n_total_nodes))*Rn             # <<<<<<<<<<<<<<
  *         return self._average_node_to_edge_z
  * 
  */
-  __Pyx_TraceLine(4444,0,__PYX_ERR(0, 4444, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __Pyx_TraceLine(4439,0,__PYX_ERR(0, 4439, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
   __pyx_t_6 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
   __pyx_t_4 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_z); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges_z); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4444, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4444, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
   __Pyx_GIVEREF(__pyx_t_2);
   __Pyx_GOTREF(__pyx_v_self->_average_node_to_edge_z);
   __Pyx_DECREF(__pyx_v_self->_average_node_to_edge_z);
   __pyx_v_self->_average_node_to_edge_z = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4445
+  /* "discretize/_extensions/tree_ext.pyx":4440
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_edge_z = sp.csr_matrix((V, (I, J)), shape=(self.n_edges_z, self.n_total_nodes))*Rn
  *         return self._average_node_to_edge_z             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4445,0,__PYX_ERR(0, 4445, __pyx_L1_error))
+  __Pyx_TraceLine(4440,0,__PYX_ERR(0, 4440, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_edge_z);
   __pyx_r = __pyx_v_self->_average_node_to_edge_z;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4409
+  /* "discretize/_extensions/tree_ext.pyx":4404
  * 
  *     @property
  *     def average_node_to_edge_z(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to z edges (scalar quantities).
  * 
  */
 
@@ -52128,15 +52140,15 @@
   __Pyx_XDECREF(__pyx_v_Rn);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4448
+/* "discretize/_extensions/tree_ext.pyx":4443
  * 
  *     @property
  *     def average_node_to_edge(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from nodes to edges (scalar quantities).
  * 
  */
 
@@ -52164,180 +52176,180 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4448, 0, __PYX_ERR(0, 4448, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4443, 0, __PYX_ERR(0, 4443, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4480
+  /* "discretize/_extensions/tree_ext.pyx":4475
  *             phi_e = Ane @ phi_n
  *         """
  *         if self._average_node_to_edge is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_edge
  * 
  */
-  __Pyx_TraceLine(4480,0,__PYX_ERR(0, 4480, __pyx_L1_error))
+  __Pyx_TraceLine(4475,0,__PYX_ERR(0, 4475, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_edge != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4481
+    /* "discretize/_extensions/tree_ext.pyx":4476
  *         """
  *         if self._average_node_to_edge is not None:
  *             return self._average_node_to_edge             # <<<<<<<<<<<<<<
  * 
  *         stacks = [self.average_node_to_edge_x, self.average_node_to_edge_y]
  */
-    __Pyx_TraceLine(4481,0,__PYX_ERR(0, 4481, __pyx_L1_error))
+    __Pyx_TraceLine(4476,0,__PYX_ERR(0, 4476, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_node_to_edge);
     __pyx_r = __pyx_v_self->_average_node_to_edge;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4480
+    /* "discretize/_extensions/tree_ext.pyx":4475
  *             phi_e = Ane @ phi_n
  *         """
  *         if self._average_node_to_edge is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_edge
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4483
+  /* "discretize/_extensions/tree_ext.pyx":4478
  *             return self._average_node_to_edge
  * 
  *         stacks = [self.average_node_to_edge_x, self.average_node_to_edge_y]             # <<<<<<<<<<<<<<
  *         if self._dim == 3:
  *             stacks += [self.average_node_to_edge_z]
  */
-  __Pyx_TraceLine(4483,0,__PYX_ERR(0, 4483, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4483, __pyx_L1_error)
+  __Pyx_TraceLine(4478,0,__PYX_ERR(0, 4478, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4478, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4483, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4478, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4483, __pyx_L1_error)
+  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4478, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
   __pyx_v_stacks = ((PyObject*)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4484
+  /* "discretize/_extensions/tree_ext.pyx":4479
  * 
  *         stacks = [self.average_node_to_edge_x, self.average_node_to_edge_y]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             stacks += [self.average_node_to_edge_z]
  *         self._average_node_to_edge = sp.vstack(stacks).tocsr()
  */
-  __Pyx_TraceLine(4484,0,__PYX_ERR(0, 4484, __pyx_L1_error))
+  __Pyx_TraceLine(4479,0,__PYX_ERR(0, 4479, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_self->_dim == 3) != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4485
+    /* "discretize/_extensions/tree_ext.pyx":4480
  *         stacks = [self.average_node_to_edge_x, self.average_node_to_edge_y]
  *         if self._dim == 3:
  *             stacks += [self.average_node_to_edge_z]             # <<<<<<<<<<<<<<
  *         self._average_node_to_edge = sp.vstack(stacks).tocsr()
  *         return self._average_node_to_edge
  */
-    __Pyx_TraceLine(4485,0,__PYX_ERR(0, 4485, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4485, __pyx_L1_error)
+    __Pyx_TraceLine(4480,0,__PYX_ERR(0, 4480, __pyx_L1_error))
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4480, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4485, __pyx_L1_error)
+    __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4480, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_5);
     PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
     __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_stacks, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4485, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_stacks, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4480, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_stacks, ((PyObject*)__pyx_t_5));
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4484
+    /* "discretize/_extensions/tree_ext.pyx":4479
  * 
  *         stacks = [self.average_node_to_edge_x, self.average_node_to_edge_y]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             stacks += [self.average_node_to_edge_z]
  *         self._average_node_to_edge = sp.vstack(stacks).tocsr()
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4486
+  /* "discretize/_extensions/tree_ext.pyx":4481
  *         if self._dim == 3:
  *             stacks += [self.average_node_to_edge_z]
  *         self._average_node_to_edge = sp.vstack(stacks).tocsr()             # <<<<<<<<<<<<<<
  *         return self._average_node_to_edge
  * 
  */
-  __Pyx_TraceLine(4486,0,__PYX_ERR(0, 4486, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4486, __pyx_L1_error)
+  __Pyx_TraceLine(4481,0,__PYX_ERR(0, 4481, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4481, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_vstack); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4486, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_vstack); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4481, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_v_stacks) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_stacks);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4486, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4481, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4486, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4481, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4486, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4481, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_GIVEREF(__pyx_t_5);
   __Pyx_GOTREF(__pyx_v_self->_average_node_to_edge);
   __Pyx_DECREF(__pyx_v_self->_average_node_to_edge);
   __pyx_v_self->_average_node_to_edge = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4487
+  /* "discretize/_extensions/tree_ext.pyx":4482
  *             stacks += [self.average_node_to_edge_z]
  *         self._average_node_to_edge = sp.vstack(stacks).tocsr()
  *         return self._average_node_to_edge             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4487,0,__PYX_ERR(0, 4487, __pyx_L1_error))
+  __Pyx_TraceLine(4482,0,__PYX_ERR(0, 4482, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_edge);
   __pyx_r = __pyx_v_self->_average_node_to_edge;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4448
+  /* "discretize/_extensions/tree_ext.pyx":4443
  * 
  *     @property
  *     def average_node_to_edge(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from nodes to edges (scalar quantities).
  * 
  */
 
@@ -52353,15 +52365,15 @@
   __Pyx_XDECREF(__pyx_v_stacks);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4490
+/* "discretize/_extensions/tree_ext.pyx":4485
  * 
  *     @property
  *     def average_node_to_face_x(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to x faces (scalar quantities).
  * 
  */
 
@@ -52408,478 +52420,478 @@
   __pyx_t_5numpy_int64_t __pyx_t_16;
   int __pyx_t_17;
   PyObject *__pyx_t_18 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4490, 0, __PYX_ERR(0, 4490, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4485, 0, __PYX_ERR(0, 4485, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4503
+  /* "discretize/_extensions/tree_ext.pyx":4498
  *             The scalar averaging operator from nodes to faces
  *         """
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             return self.average_node_to_edge_y
  *         if self._average_node_to_face_x is not None:
  */
-  __Pyx_TraceLine(4503,0,__PYX_ERR(0, 4503, __pyx_L1_error))
+  __Pyx_TraceLine(4498,0,__PYX_ERR(0, 4498, __pyx_L1_error))
   __pyx_t_1 = ((__pyx_v_self->_dim == 2) != 0);
   if (__pyx_t_1) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4504
+    /* "discretize/_extensions/tree_ext.pyx":4499
  *         """
  *         if self._dim == 2:
  *             return self.average_node_to_edge_y             # <<<<<<<<<<<<<<
  *         if self._average_node_to_face_x is not None:
  *             return self._average_node_to_face_x
  */
-    __Pyx_TraceLine(4504,0,__PYX_ERR(0, 4504, __pyx_L1_error))
+    __Pyx_TraceLine(4499,0,__PYX_ERR(0, 4499, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_y); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4504, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_y); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4499, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4503
+    /* "discretize/_extensions/tree_ext.pyx":4498
  *             The scalar averaging operator from nodes to faces
  *         """
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             return self.average_node_to_edge_y
  *         if self._average_node_to_face_x is not None:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4505
+  /* "discretize/_extensions/tree_ext.pyx":4500
  *         if self._dim == 2:
  *             return self.average_node_to_edge_y
  *         if self._average_node_to_face_x is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_face_x
  *         cdef np.int64_t[:] I, J
  */
-  __Pyx_TraceLine(4505,0,__PYX_ERR(0, 4505, __pyx_L1_error))
+  __Pyx_TraceLine(4500,0,__PYX_ERR(0, 4500, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_face_x != Py_None);
   __pyx_t_3 = (__pyx_t_1 != 0);
   if (__pyx_t_3) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4506
+    /* "discretize/_extensions/tree_ext.pyx":4501
  *             return self.average_node_to_edge_y
  *         if self._average_node_to_face_x is not None:
  *             return self._average_node_to_face_x             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I, J
  *         cdef np.float64_t[:] V
  */
-    __Pyx_TraceLine(4506,0,__PYX_ERR(0, 4506, __pyx_L1_error))
+    __Pyx_TraceLine(4501,0,__PYX_ERR(0, 4501, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_node_to_face_x);
     __pyx_r = __pyx_v_self->_average_node_to_face_x;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4505
+    /* "discretize/_extensions/tree_ext.pyx":4500
  *         if self._dim == 2:
  *             return self.average_node_to_edge_y
  *         if self._average_node_to_face_x is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_face_x
  *         cdef np.int64_t[:] I, J
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4510
+  /* "discretize/_extensions/tree_ext.pyx":4505
  *         cdef np.float64_t[:] V
  *         cdef np.int64_t ii, id
  *         I = np.empty(self.n_faces_x*4, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_faces_x*4, dtype=np.int64)
  *         V = np.empty(self.n_faces_x*4, dtype=np.float64)
  */
-  __Pyx_TraceLine(4510,0,__PYX_ERR(0, 4510, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __Pyx_TraceLine(4505,0,__PYX_ERR(0, 4505, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_int_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_int_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4510, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4510, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4505, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4511
+  /* "discretize/_extensions/tree_ext.pyx":4506
  *         cdef np.int64_t ii, id
  *         I = np.empty(self.n_faces_x*4, dtype=np.int64)
  *         J = np.empty(self.n_faces_x*4, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_faces_x*4, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4511,0,__PYX_ERR(0, 4511, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __Pyx_TraceLine(4506,0,__PYX_ERR(0, 4506, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_2 = PyNumber_Multiply(__pyx_t_7, __pyx_int_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_t_7, __pyx_int_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4511, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4511, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4506, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4512
+  /* "discretize/_extensions/tree_ext.pyx":4507
  *         I = np.empty(self.n_faces_x*4, dtype=np.int64)
  *         J = np.empty(self.n_faces_x*4, dtype=np.int64)
  *         V = np.empty(self.n_faces_x*4, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for it in self.tree.faces_x:
  */
-  __Pyx_TraceLine(4512,0,__PYX_ERR(0, 4512, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __Pyx_TraceLine(4507,0,__PYX_ERR(0, 4507, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4512, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4512, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4507, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4514
+  /* "discretize/_extensions/tree_ext.pyx":4509
  *         V = np.empty(self.n_faces_x*4, dtype=np.float64)
  * 
  *         for it in self.tree.faces_x:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-  __Pyx_TraceLine(4514,0,__PYX_ERR(0, 4514, __pyx_L1_error))
+  __Pyx_TraceLine(4509,0,__PYX_ERR(0, 4509, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->faces_x;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_it = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4515
+    /* "discretize/_extensions/tree_ext.pyx":4510
  * 
  *         for it in self.tree.faces_x:
  *             face = it.second             # <<<<<<<<<<<<<<
  *             if face.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(4515,0,__PYX_ERR(0, 4515, __pyx_L1_error))
+    __Pyx_TraceLine(4510,0,__PYX_ERR(0, 4510, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_it.second;
     __pyx_v_face = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4516
+    /* "discretize/_extensions/tree_ext.pyx":4511
  *         for it in self.tree.faces_x:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index
  */
-    __Pyx_TraceLine(4516,0,__PYX_ERR(0, 4516, __pyx_L1_error))
+    __Pyx_TraceLine(4511,0,__PYX_ERR(0, 4511, __pyx_L1_error))
     __pyx_t_3 = (__pyx_v_face->hanging != 0);
     if (__pyx_t_3) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4517
+      /* "discretize/_extensions/tree_ext.pyx":4512
  *             face = it.second
  *             if face.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = face.index
  *             for id in range(4):
  */
-      __Pyx_TraceLine(4517,0,__PYX_ERR(0, 4517, __pyx_L1_error))
+      __Pyx_TraceLine(4512,0,__PYX_ERR(0, 4512, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":4516
+      /* "discretize/_extensions/tree_ext.pyx":4511
  *         for it in self.tree.faces_x:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4518
+    /* "discretize/_extensions/tree_ext.pyx":4513
  *             if face.hanging:
  *                 continue
  *             ii = face.index             # <<<<<<<<<<<<<<
  *             for id in range(4):
  *                 I[ii*4 + id] = ii
  */
-    __Pyx_TraceLine(4518,0,__PYX_ERR(0, 4518, __pyx_L1_error))
+    __Pyx_TraceLine(4513,0,__PYX_ERR(0, 4513, __pyx_L1_error))
     __pyx_t_14 = __pyx_v_face->index;
     __pyx_v_ii = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":4519
+    /* "discretize/_extensions/tree_ext.pyx":4514
  *                 continue
  *             ii = face.index
  *             for id in range(4):             # <<<<<<<<<<<<<<
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index
  */
-    __Pyx_TraceLine(4519,0,__PYX_ERR(0, 4519, __pyx_L1_error))
+    __Pyx_TraceLine(4514,0,__PYX_ERR(0, 4514, __pyx_L1_error))
     for (__pyx_t_15 = 0; __pyx_t_15 < 4; __pyx_t_15+=1) {
       __pyx_v_id = __pyx_t_15;
 
-      /* "discretize/_extensions/tree_ext.pyx":4520
+      /* "discretize/_extensions/tree_ext.pyx":4515
  *             ii = face.index
  *             for id in range(4):
  *                 I[ii*4 + id] = ii             # <<<<<<<<<<<<<<
  *                 J[ii*4 + id] = face.points[id].index
  *                 V[ii*4 + id] = 0.25
  */
-      __Pyx_TraceLine(4520,0,__PYX_ERR(0, 4520, __pyx_L1_error))
+      __Pyx_TraceLine(4515,0,__PYX_ERR(0, 4515, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_I.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4520, __pyx_L1_error)
+        __PYX_ERR(0, 4515, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_16 * __pyx_v_I.strides[0]) )) = __pyx_v_ii;
 
-      /* "discretize/_extensions/tree_ext.pyx":4521
+      /* "discretize/_extensions/tree_ext.pyx":4516
  *             for id in range(4):
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index             # <<<<<<<<<<<<<<
  *                 V[ii*4 + id] = 0.25
  * 
  */
-      __Pyx_TraceLine(4521,0,__PYX_ERR(0, 4521, __pyx_L1_error))
+      __Pyx_TraceLine(4516,0,__PYX_ERR(0, 4516, __pyx_L1_error))
       __pyx_t_14 = (__pyx_v_face->points[__pyx_v_id])->index;
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4521, __pyx_L1_error)
+        __PYX_ERR(0, 4516, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_14;
 
-      /* "discretize/_extensions/tree_ext.pyx":4522
+      /* "discretize/_extensions/tree_ext.pyx":4517
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index
  *                 V[ii*4 + id] = 0.25             # <<<<<<<<<<<<<<
  * 
  *         Rn = self._deflate_nodes()
  */
-      __Pyx_TraceLine(4522,0,__PYX_ERR(0, 4522, __pyx_L1_error))
+      __Pyx_TraceLine(4517,0,__PYX_ERR(0, 4517, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_V.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4522, __pyx_L1_error)
+        __PYX_ERR(0, 4517, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_16 * __pyx_v_V.strides[0]) )) = 0.25;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4514
+    /* "discretize/_extensions/tree_ext.pyx":4509
  *         V = np.empty(self.n_faces_x*4, dtype=np.float64)
  * 
  *         for it in self.tree.faces_x:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-    __Pyx_TraceLine(4514,0,__PYX_ERR(0, 4514, __pyx_L1_error))
+    __Pyx_TraceLine(4509,0,__PYX_ERR(0, 4509, __pyx_L1_error))
     __pyx_L5_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4524
+  /* "discretize/_extensions/tree_ext.pyx":4519
  *                 V[ii*4 + id] = 0.25
  * 
  *         Rn = self._deflate_nodes()             # <<<<<<<<<<<<<<
  *         self._average_node_to_face_x = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_x, self.n_total_nodes))*Rn
  *         return self._average_node_to_face_x
  */
-  __Pyx_TraceLine(4524,0,__PYX_ERR(0, 4524, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4524, __pyx_L1_error)
+  __Pyx_TraceLine(4519,0,__PYX_ERR(0, 4519, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4519, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4524, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4519, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rn = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4525
+  /* "discretize/_extensions/tree_ext.pyx":4520
  * 
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_face_x = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_x, self.n_total_nodes))*Rn             # <<<<<<<<<<<<<<
  *         return self._average_node_to_face_x
  * 
  */
-  __Pyx_TraceLine(4525,0,__PYX_ERR(0, 4525, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __Pyx_TraceLine(4520,0,__PYX_ERR(0, 4520, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
   __pyx_t_6 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
   __pyx_t_4 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4525, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4525, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
   __Pyx_GIVEREF(__pyx_t_2);
   __Pyx_GOTREF(__pyx_v_self->_average_node_to_face_x);
   __Pyx_DECREF(__pyx_v_self->_average_node_to_face_x);
   __pyx_v_self->_average_node_to_face_x = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4526
+  /* "discretize/_extensions/tree_ext.pyx":4521
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_face_x = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_x, self.n_total_nodes))*Rn
  *         return self._average_node_to_face_x             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4526,0,__PYX_ERR(0, 4526, __pyx_L1_error))
+  __Pyx_TraceLine(4521,0,__PYX_ERR(0, 4521, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_face_x);
   __pyx_r = __pyx_v_self->_average_node_to_face_x;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4490
+  /* "discretize/_extensions/tree_ext.pyx":4485
  * 
  *     @property
  *     def average_node_to_face_x(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to x faces (scalar quantities).
  * 
  */
 
@@ -52902,15 +52914,15 @@
   __Pyx_XDECREF(__pyx_v_Rn);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4529
+/* "discretize/_extensions/tree_ext.pyx":4524
  * 
  *     @property
  *     def average_node_to_face_y(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to y faces (scalar quantities).
  * 
  */
 
@@ -52957,478 +52969,478 @@
   __pyx_t_5numpy_int64_t __pyx_t_16;
   int __pyx_t_17;
   PyObject *__pyx_t_18 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4529, 0, __PYX_ERR(0, 4529, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4524, 0, __PYX_ERR(0, 4524, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4542
+  /* "discretize/_extensions/tree_ext.pyx":4537
  *             The scalar averaging operator from nodes to faces
  *         """
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             return self.average_node_to_edge_x
  *         if self._average_node_to_face_y is not None:
  */
-  __Pyx_TraceLine(4542,0,__PYX_ERR(0, 4542, __pyx_L1_error))
+  __Pyx_TraceLine(4537,0,__PYX_ERR(0, 4537, __pyx_L1_error))
   __pyx_t_1 = ((__pyx_v_self->_dim == 2) != 0);
   if (__pyx_t_1) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4543
+    /* "discretize/_extensions/tree_ext.pyx":4538
  *         """
  *         if self._dim == 2:
  *             return self.average_node_to_edge_x             # <<<<<<<<<<<<<<
  *         if self._average_node_to_face_y is not None:
  *             return self._average_node_to_face_y
  */
-    __Pyx_TraceLine(4543,0,__PYX_ERR(0, 4543, __pyx_L1_error))
+    __Pyx_TraceLine(4538,0,__PYX_ERR(0, 4538, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4543, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_edge_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4538, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4542
+    /* "discretize/_extensions/tree_ext.pyx":4537
  *             The scalar averaging operator from nodes to faces
  *         """
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             return self.average_node_to_edge_x
  *         if self._average_node_to_face_y is not None:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4544
+  /* "discretize/_extensions/tree_ext.pyx":4539
  *         if self._dim == 2:
  *             return self.average_node_to_edge_x
  *         if self._average_node_to_face_y is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_face_y
  *         cdef np.int64_t[:] I, J
  */
-  __Pyx_TraceLine(4544,0,__PYX_ERR(0, 4544, __pyx_L1_error))
+  __Pyx_TraceLine(4539,0,__PYX_ERR(0, 4539, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_face_y != Py_None);
   __pyx_t_3 = (__pyx_t_1 != 0);
   if (__pyx_t_3) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4545
+    /* "discretize/_extensions/tree_ext.pyx":4540
  *             return self.average_node_to_edge_x
  *         if self._average_node_to_face_y is not None:
  *             return self._average_node_to_face_y             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I, J
  *         cdef np.float64_t[:] V
  */
-    __Pyx_TraceLine(4545,0,__PYX_ERR(0, 4545, __pyx_L1_error))
+    __Pyx_TraceLine(4540,0,__PYX_ERR(0, 4540, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_node_to_face_y);
     __pyx_r = __pyx_v_self->_average_node_to_face_y;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4544
+    /* "discretize/_extensions/tree_ext.pyx":4539
  *         if self._dim == 2:
  *             return self.average_node_to_edge_x
  *         if self._average_node_to_face_y is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_face_y
  *         cdef np.int64_t[:] I, J
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4550
+  /* "discretize/_extensions/tree_ext.pyx":4545
  *         cdef np.int64_t ii, id
  * 
  *         I = np.empty(self.n_faces_y*4, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_faces_y*4, dtype=np.int64)
  *         V = np.empty(self.n_faces_y*4, dtype=np.float64)
  */
-  __Pyx_TraceLine(4550,0,__PYX_ERR(0, 4550, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __Pyx_TraceLine(4545,0,__PYX_ERR(0, 4545, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_int_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_int_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4550, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4550, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4545, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4551
+  /* "discretize/_extensions/tree_ext.pyx":4546
  * 
  *         I = np.empty(self.n_faces_y*4, dtype=np.int64)
  *         J = np.empty(self.n_faces_y*4, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_faces_y*4, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4551,0,__PYX_ERR(0, 4551, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __Pyx_TraceLine(4546,0,__PYX_ERR(0, 4546, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_2 = PyNumber_Multiply(__pyx_t_7, __pyx_int_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_t_7, __pyx_int_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4551, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4551, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4546, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4552
+  /* "discretize/_extensions/tree_ext.pyx":4547
  *         I = np.empty(self.n_faces_y*4, dtype=np.int64)
  *         J = np.empty(self.n_faces_y*4, dtype=np.int64)
  *         V = np.empty(self.n_faces_y*4, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for it in self.tree.faces_y:
  */
-  __Pyx_TraceLine(4552,0,__PYX_ERR(0, 4552, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __Pyx_TraceLine(4547,0,__PYX_ERR(0, 4547, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4552, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4552, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4547, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4554
+  /* "discretize/_extensions/tree_ext.pyx":4549
  *         V = np.empty(self.n_faces_y*4, dtype=np.float64)
  * 
  *         for it in self.tree.faces_y:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-  __Pyx_TraceLine(4554,0,__PYX_ERR(0, 4554, __pyx_L1_error))
+  __Pyx_TraceLine(4549,0,__PYX_ERR(0, 4549, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->faces_y;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_it = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4555
+    /* "discretize/_extensions/tree_ext.pyx":4550
  * 
  *         for it in self.tree.faces_y:
  *             face = it.second             # <<<<<<<<<<<<<<
  *             if face.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(4555,0,__PYX_ERR(0, 4555, __pyx_L1_error))
+    __Pyx_TraceLine(4550,0,__PYX_ERR(0, 4550, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_it.second;
     __pyx_v_face = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4556
+    /* "discretize/_extensions/tree_ext.pyx":4551
  *         for it in self.tree.faces_y:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index
  */
-    __Pyx_TraceLine(4556,0,__PYX_ERR(0, 4556, __pyx_L1_error))
+    __Pyx_TraceLine(4551,0,__PYX_ERR(0, 4551, __pyx_L1_error))
     __pyx_t_3 = (__pyx_v_face->hanging != 0);
     if (__pyx_t_3) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4557
+      /* "discretize/_extensions/tree_ext.pyx":4552
  *             face = it.second
  *             if face.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = face.index
  *             for id in range(4):
  */
-      __Pyx_TraceLine(4557,0,__PYX_ERR(0, 4557, __pyx_L1_error))
+      __Pyx_TraceLine(4552,0,__PYX_ERR(0, 4552, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":4556
+      /* "discretize/_extensions/tree_ext.pyx":4551
  *         for it in self.tree.faces_y:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4558
+    /* "discretize/_extensions/tree_ext.pyx":4553
  *             if face.hanging:
  *                 continue
  *             ii = face.index             # <<<<<<<<<<<<<<
  *             for id in range(4):
  *                 I[ii*4 + id] = ii
  */
-    __Pyx_TraceLine(4558,0,__PYX_ERR(0, 4558, __pyx_L1_error))
+    __Pyx_TraceLine(4553,0,__PYX_ERR(0, 4553, __pyx_L1_error))
     __pyx_t_14 = __pyx_v_face->index;
     __pyx_v_ii = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":4559
+    /* "discretize/_extensions/tree_ext.pyx":4554
  *                 continue
  *             ii = face.index
  *             for id in range(4):             # <<<<<<<<<<<<<<
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index
  */
-    __Pyx_TraceLine(4559,0,__PYX_ERR(0, 4559, __pyx_L1_error))
+    __Pyx_TraceLine(4554,0,__PYX_ERR(0, 4554, __pyx_L1_error))
     for (__pyx_t_15 = 0; __pyx_t_15 < 4; __pyx_t_15+=1) {
       __pyx_v_id = __pyx_t_15;
 
-      /* "discretize/_extensions/tree_ext.pyx":4560
+      /* "discretize/_extensions/tree_ext.pyx":4555
  *             ii = face.index
  *             for id in range(4):
  *                 I[ii*4 + id] = ii             # <<<<<<<<<<<<<<
  *                 J[ii*4 + id] = face.points[id].index
  *                 V[ii*4 + id] = 0.25
  */
-      __Pyx_TraceLine(4560,0,__PYX_ERR(0, 4560, __pyx_L1_error))
+      __Pyx_TraceLine(4555,0,__PYX_ERR(0, 4555, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_I.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4560, __pyx_L1_error)
+        __PYX_ERR(0, 4555, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_16 * __pyx_v_I.strides[0]) )) = __pyx_v_ii;
 
-      /* "discretize/_extensions/tree_ext.pyx":4561
+      /* "discretize/_extensions/tree_ext.pyx":4556
  *             for id in range(4):
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index             # <<<<<<<<<<<<<<
  *                 V[ii*4 + id] = 0.25
  * 
  */
-      __Pyx_TraceLine(4561,0,__PYX_ERR(0, 4561, __pyx_L1_error))
+      __Pyx_TraceLine(4556,0,__PYX_ERR(0, 4556, __pyx_L1_error))
       __pyx_t_14 = (__pyx_v_face->points[__pyx_v_id])->index;
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4561, __pyx_L1_error)
+        __PYX_ERR(0, 4556, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_14;
 
-      /* "discretize/_extensions/tree_ext.pyx":4562
+      /* "discretize/_extensions/tree_ext.pyx":4557
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index
  *                 V[ii*4 + id] = 0.25             # <<<<<<<<<<<<<<
  * 
  *         Rn = self._deflate_nodes()
  */
-      __Pyx_TraceLine(4562,0,__PYX_ERR(0, 4562, __pyx_L1_error))
+      __Pyx_TraceLine(4557,0,__PYX_ERR(0, 4557, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_V.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4562, __pyx_L1_error)
+        __PYX_ERR(0, 4557, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_16 * __pyx_v_V.strides[0]) )) = 0.25;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4554
+    /* "discretize/_extensions/tree_ext.pyx":4549
  *         V = np.empty(self.n_faces_y*4, dtype=np.float64)
  * 
  *         for it in self.tree.faces_y:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-    __Pyx_TraceLine(4554,0,__PYX_ERR(0, 4554, __pyx_L1_error))
+    __Pyx_TraceLine(4549,0,__PYX_ERR(0, 4549, __pyx_L1_error))
     __pyx_L5_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4564
+  /* "discretize/_extensions/tree_ext.pyx":4559
  *                 V[ii*4 + id] = 0.25
  * 
  *         Rn = self._deflate_nodes()             # <<<<<<<<<<<<<<
  *         self._average_node_to_face_y = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_y, self.n_total_nodes))*Rn
  *         return self._average_node_to_face_y
  */
-  __Pyx_TraceLine(4564,0,__PYX_ERR(0, 4564, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4564, __pyx_L1_error)
+  __Pyx_TraceLine(4559,0,__PYX_ERR(0, 4559, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4559, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4564, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4559, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rn = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4565
+  /* "discretize/_extensions/tree_ext.pyx":4560
  * 
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_face_y = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_y, self.n_total_nodes))*Rn             # <<<<<<<<<<<<<<
  *         return self._average_node_to_face_y
  * 
  */
-  __Pyx_TraceLine(4565,0,__PYX_ERR(0, 4565, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __Pyx_TraceLine(4560,0,__PYX_ERR(0, 4560, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
   __pyx_t_6 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
   __pyx_t_4 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4565, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4565, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4560, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
   __Pyx_GIVEREF(__pyx_t_2);
   __Pyx_GOTREF(__pyx_v_self->_average_node_to_face_y);
   __Pyx_DECREF(__pyx_v_self->_average_node_to_face_y);
   __pyx_v_self->_average_node_to_face_y = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4566
+  /* "discretize/_extensions/tree_ext.pyx":4561
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_face_y = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_y, self.n_total_nodes))*Rn
  *         return self._average_node_to_face_y             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4566,0,__PYX_ERR(0, 4566, __pyx_L1_error))
+  __Pyx_TraceLine(4561,0,__PYX_ERR(0, 4561, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_face_y);
   __pyx_r = __pyx_v_self->_average_node_to_face_y;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4529
+  /* "discretize/_extensions/tree_ext.pyx":4524
  * 
  *     @property
  *     def average_node_to_face_y(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to y faces (scalar quantities).
  * 
  */
 
@@ -53451,15 +53463,15 @@
   __Pyx_XDECREF(__pyx_v_Rn);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4569
+/* "discretize/_extensions/tree_ext.pyx":4564
  * 
  *     @property
  *     def average_node_to_face_z(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to z faces (scalar quantities).
  * 
  */
 
@@ -53506,477 +53518,477 @@
   __pyx_t_5numpy_int64_t __pyx_t_16;
   int __pyx_t_17;
   PyObject *__pyx_t_18 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4569, 0, __PYX_ERR(0, 4569, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4564, 0, __PYX_ERR(0, 4564, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4582
+  /* "discretize/_extensions/tree_ext.pyx":4577
  *             The scalar averaging operator from nodes to faces
  *         """
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             raise Exception('TreeMesh has no z faces in 2D')
  *         cdef np.int64_t[:] I, J
  */
-  __Pyx_TraceLine(4582,0,__PYX_ERR(0, 4582, __pyx_L1_error))
+  __Pyx_TraceLine(4577,0,__PYX_ERR(0, 4577, __pyx_L1_error))
   __pyx_t_1 = ((__pyx_v_self->_dim == 2) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4583
+    /* "discretize/_extensions/tree_ext.pyx":4578
  *         """
  *         if self._dim == 2:
  *             raise Exception('TreeMesh has no z faces in 2D')             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I, J
  *         cdef np.float64_t[:] V
  */
-    __Pyx_TraceLine(4583,0,__PYX_ERR(0, 4583, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4583, __pyx_L1_error)
+    __Pyx_TraceLine(4578,0,__PYX_ERR(0, 4578, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4578, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 4583, __pyx_L1_error)
+    __PYX_ERR(0, 4578, __pyx_L1_error)
 
-    /* "discretize/_extensions/tree_ext.pyx":4582
+    /* "discretize/_extensions/tree_ext.pyx":4577
  *             The scalar averaging operator from nodes to faces
  *         """
  *         if self._dim == 2:             # <<<<<<<<<<<<<<
  *             raise Exception('TreeMesh has no z faces in 2D')
  *         cdef np.int64_t[:] I, J
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4587
+  /* "discretize/_extensions/tree_ext.pyx":4582
  *         cdef np.float64_t[:] V
  *         cdef np.int64_t ii, id,
  *         if self._average_node_to_face_z is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_face_z
  * 
  */
-  __Pyx_TraceLine(4587,0,__PYX_ERR(0, 4587, __pyx_L1_error))
+  __Pyx_TraceLine(4582,0,__PYX_ERR(0, 4582, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_face_z != Py_None);
   __pyx_t_3 = (__pyx_t_1 != 0);
   if (__pyx_t_3) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4588
+    /* "discretize/_extensions/tree_ext.pyx":4583
  *         cdef np.int64_t ii, id,
  *         if self._average_node_to_face_z is not None:
  *             return self._average_node_to_face_z             # <<<<<<<<<<<<<<
  * 
  *         I = np.empty(self.n_faces_z*4, dtype=np.int64)
  */
-    __Pyx_TraceLine(4588,0,__PYX_ERR(0, 4588, __pyx_L1_error))
+    __Pyx_TraceLine(4583,0,__PYX_ERR(0, 4583, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_node_to_face_z);
     __pyx_r = __pyx_v_self->_average_node_to_face_z;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4587
+    /* "discretize/_extensions/tree_ext.pyx":4582
  *         cdef np.float64_t[:] V
  *         cdef np.int64_t ii, id,
  *         if self._average_node_to_face_z is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_face_z
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4590
+  /* "discretize/_extensions/tree_ext.pyx":4585
  *             return self._average_node_to_face_z
  * 
  *         I = np.empty(self.n_faces_z*4, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J = np.empty(self.n_faces_z*4, dtype=np.int64)
  *         V = np.empty(self.n_faces_z*4, dtype=np.float64)
  */
-  __Pyx_TraceLine(4590,0,__PYX_ERR(0, 4590, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __Pyx_TraceLine(4585,0,__PYX_ERR(0, 4585, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_int_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_int_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4590, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4590, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4585, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4591
+  /* "discretize/_extensions/tree_ext.pyx":4586
  * 
  *         I = np.empty(self.n_faces_z*4, dtype=np.int64)
  *         J = np.empty(self.n_faces_z*4, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         V = np.empty(self.n_faces_z*4, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(4591,0,__PYX_ERR(0, 4591, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __Pyx_TraceLine(4586,0,__PYX_ERR(0, 4586, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_2 = PyNumber_Multiply(__pyx_t_7, __pyx_int_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_t_7, __pyx_int_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4591, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4591, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4586, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4592
+  /* "discretize/_extensions/tree_ext.pyx":4587
  *         I = np.empty(self.n_faces_z*4, dtype=np.int64)
  *         J = np.empty(self.n_faces_z*4, dtype=np.int64)
  *         V = np.empty(self.n_faces_z*4, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         for it in self.tree.faces_z:
  */
-  __Pyx_TraceLine(4592,0,__PYX_ERR(0, 4592, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __Pyx_TraceLine(4587,0,__PYX_ERR(0, 4587, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_6, __pyx_int_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4592, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4592, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4587, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4594
+  /* "discretize/_extensions/tree_ext.pyx":4589
  *         V = np.empty(self.n_faces_z*4, dtype=np.float64)
  * 
  *         for it in self.tree.faces_z:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-  __Pyx_TraceLine(4594,0,__PYX_ERR(0, 4594, __pyx_L1_error))
+  __Pyx_TraceLine(4589,0,__PYX_ERR(0, 4589, __pyx_L1_error))
   __pyx_t_11 = &__pyx_v_self->tree->faces_z;
   __pyx_t_10 = __pyx_t_11->begin();
   for (;;) {
     if (!(__pyx_t_10 != __pyx_t_11->end())) break;
     __pyx_t_12 = *__pyx_t_10;
     ++__pyx_t_10;
     __pyx_v_it = __pyx_t_12;
 
-    /* "discretize/_extensions/tree_ext.pyx":4595
+    /* "discretize/_extensions/tree_ext.pyx":4590
  * 
  *         for it in self.tree.faces_z:
  *             face = it.second             # <<<<<<<<<<<<<<
  *             if face.hanging:
  *                 continue
  */
-    __Pyx_TraceLine(4595,0,__PYX_ERR(0, 4595, __pyx_L1_error))
+    __Pyx_TraceLine(4590,0,__PYX_ERR(0, 4590, __pyx_L1_error))
     __pyx_t_13 = __pyx_v_it.second;
     __pyx_v_face = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4596
+    /* "discretize/_extensions/tree_ext.pyx":4591
  *         for it in self.tree.faces_z:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index
  */
-    __Pyx_TraceLine(4596,0,__PYX_ERR(0, 4596, __pyx_L1_error))
+    __Pyx_TraceLine(4591,0,__PYX_ERR(0, 4591, __pyx_L1_error))
     __pyx_t_3 = (__pyx_v_face->hanging != 0);
     if (__pyx_t_3) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4597
+      /* "discretize/_extensions/tree_ext.pyx":4592
  *             face = it.second
  *             if face.hanging:
  *                 continue             # <<<<<<<<<<<<<<
  *             ii = face.index
  *             for id in range(4):
  */
-      __Pyx_TraceLine(4597,0,__PYX_ERR(0, 4597, __pyx_L1_error))
+      __Pyx_TraceLine(4592,0,__PYX_ERR(0, 4592, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":4596
+      /* "discretize/_extensions/tree_ext.pyx":4591
  *         for it in self.tree.faces_z:
  *             face = it.second
  *             if face.hanging:             # <<<<<<<<<<<<<<
  *                 continue
  *             ii = face.index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4598
+    /* "discretize/_extensions/tree_ext.pyx":4593
  *             if face.hanging:
  *                 continue
  *             ii = face.index             # <<<<<<<<<<<<<<
  *             for id in range(4):
  *                 I[ii*4 + id] = ii
  */
-    __Pyx_TraceLine(4598,0,__PYX_ERR(0, 4598, __pyx_L1_error))
+    __Pyx_TraceLine(4593,0,__PYX_ERR(0, 4593, __pyx_L1_error))
     __pyx_t_14 = __pyx_v_face->index;
     __pyx_v_ii = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":4599
+    /* "discretize/_extensions/tree_ext.pyx":4594
  *                 continue
  *             ii = face.index
  *             for id in range(4):             # <<<<<<<<<<<<<<
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index
  */
-    __Pyx_TraceLine(4599,0,__PYX_ERR(0, 4599, __pyx_L1_error))
+    __Pyx_TraceLine(4594,0,__PYX_ERR(0, 4594, __pyx_L1_error))
     for (__pyx_t_15 = 0; __pyx_t_15 < 4; __pyx_t_15+=1) {
       __pyx_v_id = __pyx_t_15;
 
-      /* "discretize/_extensions/tree_ext.pyx":4600
+      /* "discretize/_extensions/tree_ext.pyx":4595
  *             ii = face.index
  *             for id in range(4):
  *                 I[ii*4 + id] = ii             # <<<<<<<<<<<<<<
  *                 J[ii*4 + id] = face.points[id].index
  *                 V[ii*4 + id] = 0.25
  */
-      __Pyx_TraceLine(4600,0,__PYX_ERR(0, 4600, __pyx_L1_error))
+      __Pyx_TraceLine(4595,0,__PYX_ERR(0, 4595, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_I.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4600, __pyx_L1_error)
+        __PYX_ERR(0, 4595, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_16 * __pyx_v_I.strides[0]) )) = __pyx_v_ii;
 
-      /* "discretize/_extensions/tree_ext.pyx":4601
+      /* "discretize/_extensions/tree_ext.pyx":4596
  *             for id in range(4):
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index             # <<<<<<<<<<<<<<
  *                 V[ii*4 + id] = 0.25
  * 
  */
-      __Pyx_TraceLine(4601,0,__PYX_ERR(0, 4601, __pyx_L1_error))
+      __Pyx_TraceLine(4596,0,__PYX_ERR(0, 4596, __pyx_L1_error))
       __pyx_t_14 = (__pyx_v_face->points[__pyx_v_id])->index;
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4601, __pyx_L1_error)
+        __PYX_ERR(0, 4596, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_16 * __pyx_v_J.strides[0]) )) = __pyx_t_14;
 
-      /* "discretize/_extensions/tree_ext.pyx":4602
+      /* "discretize/_extensions/tree_ext.pyx":4597
  *                 I[ii*4 + id] = ii
  *                 J[ii*4 + id] = face.points[id].index
  *                 V[ii*4 + id] = 0.25             # <<<<<<<<<<<<<<
  * 
  *         Rn = self._deflate_nodes()
  */
-      __Pyx_TraceLine(4602,0,__PYX_ERR(0, 4602, __pyx_L1_error))
+      __Pyx_TraceLine(4597,0,__PYX_ERR(0, 4597, __pyx_L1_error))
       __pyx_t_16 = ((__pyx_v_ii * 4) + __pyx_v_id);
       __pyx_t_17 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_V.shape[0])) __pyx_t_17 = 0;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 4602, __pyx_L1_error)
+        __PYX_ERR(0, 4597, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_16 * __pyx_v_V.strides[0]) )) = 0.25;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4594
+    /* "discretize/_extensions/tree_ext.pyx":4589
  *         V = np.empty(self.n_faces_z*4, dtype=np.float64)
  * 
  *         for it in self.tree.faces_z:             # <<<<<<<<<<<<<<
  *             face = it.second
  *             if face.hanging:
  */
-    __Pyx_TraceLine(4594,0,__PYX_ERR(0, 4594, __pyx_L1_error))
+    __Pyx_TraceLine(4589,0,__PYX_ERR(0, 4589, __pyx_L1_error))
     __pyx_L5_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4604
+  /* "discretize/_extensions/tree_ext.pyx":4599
  *                 V[ii*4 + id] = 0.25
  * 
  *         Rn = self._deflate_nodes()             # <<<<<<<<<<<<<<
  *         self._average_node_to_face_z = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_z, self.n_total_nodes))*Rn
  *         return self._average_node_to_face_z
  */
-  __Pyx_TraceLine(4604,0,__PYX_ERR(0, 4604, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4604, __pyx_L1_error)
+  __Pyx_TraceLine(4599,0,__PYX_ERR(0, 4599, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4604, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4599, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_Rn = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4605
+  /* "discretize/_extensions/tree_ext.pyx":4600
  * 
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_face_z = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_z, self.n_total_nodes))*Rn             # <<<<<<<<<<<<<<
  *         return self._average_node_to_face_z
  * 
  */
-  __Pyx_TraceLine(4605,0,__PYX_ERR(0, 4605, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __Pyx_TraceLine(4600,0,__PYX_ERR(0, 4600, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
   __pyx_t_6 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
   __pyx_t_4 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_18 = PyTuple_New(2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_18, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_18, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4605, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_18) < 0) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
-  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4605, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_t_18, __pyx_v_Rn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
   __Pyx_GIVEREF(__pyx_t_2);
   __Pyx_GOTREF(__pyx_v_self->_average_node_to_face_z);
   __Pyx_DECREF(__pyx_v_self->_average_node_to_face_z);
   __pyx_v_self->_average_node_to_face_z = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4606
+  /* "discretize/_extensions/tree_ext.pyx":4601
  *         Rn = self._deflate_nodes()
  *         self._average_node_to_face_z = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_z, self.n_total_nodes))*Rn
  *         return self._average_node_to_face_z             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4606,0,__PYX_ERR(0, 4606, __pyx_L1_error))
+  __Pyx_TraceLine(4601,0,__PYX_ERR(0, 4601, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_face_z);
   __pyx_r = __pyx_v_self->_average_node_to_face_z;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4569
+  /* "discretize/_extensions/tree_ext.pyx":4564
  * 
  *     @property
  *     def average_node_to_face_z(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from nodes to z faces (scalar quantities).
  * 
  */
 
@@ -53999,15 +54011,15 @@
   __Pyx_XDECREF(__pyx_v_Rn);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4609
+/* "discretize/_extensions/tree_ext.pyx":4604
  * 
  *     @property
  *     def average_node_to_face(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from nodes to faces (scalar quantities).
  * 
  */
 
@@ -54035,180 +54047,180 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4609, 0, __PYX_ERR(0, 4609, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4604, 0, __PYX_ERR(0, 4604, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4641
+  /* "discretize/_extensions/tree_ext.pyx":4636
  *             phi_f = Anf @ phi_n
  *         """
  *         if self._average_node_to_face is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_face
  * 
  */
-  __Pyx_TraceLine(4641,0,__PYX_ERR(0, 4641, __pyx_L1_error))
+  __Pyx_TraceLine(4636,0,__PYX_ERR(0, 4636, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_node_to_face != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4642
+    /* "discretize/_extensions/tree_ext.pyx":4637
  *         """
  *         if self._average_node_to_face is not None:
  *             return self._average_node_to_face             # <<<<<<<<<<<<<<
  * 
  *         stacks = [self.average_node_to_face_x, self.average_node_to_face_y]
  */
-    __Pyx_TraceLine(4642,0,__PYX_ERR(0, 4642, __pyx_L1_error))
+    __Pyx_TraceLine(4637,0,__PYX_ERR(0, 4637, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_node_to_face);
     __pyx_r = __pyx_v_self->_average_node_to_face;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4641
+    /* "discretize/_extensions/tree_ext.pyx":4636
  *             phi_f = Anf @ phi_n
  *         """
  *         if self._average_node_to_face is not None:             # <<<<<<<<<<<<<<
  *             return self._average_node_to_face
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4644
+  /* "discretize/_extensions/tree_ext.pyx":4639
  *             return self._average_node_to_face
  * 
  *         stacks = [self.average_node_to_face_x, self.average_node_to_face_y]             # <<<<<<<<<<<<<<
  *         if self._dim == 3:
  *             stacks += [self.average_node_to_face_z]
  */
-  __Pyx_TraceLine(4644,0,__PYX_ERR(0, 4644, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_face_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4644, __pyx_L1_error)
+  __Pyx_TraceLine(4639,0,__PYX_ERR(0, 4639, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_face_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4639, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_face_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4644, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_face_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4639, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4644, __pyx_L1_error)
+  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4639, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
   __pyx_v_stacks = ((PyObject*)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4645
+  /* "discretize/_extensions/tree_ext.pyx":4640
  * 
  *         stacks = [self.average_node_to_face_x, self.average_node_to_face_y]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             stacks += [self.average_node_to_face_z]
  *         self._average_node_to_face = sp.vstack(stacks).tocsr()
  */
-  __Pyx_TraceLine(4645,0,__PYX_ERR(0, 4645, __pyx_L1_error))
+  __Pyx_TraceLine(4640,0,__PYX_ERR(0, 4640, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_self->_dim == 3) != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4646
+    /* "discretize/_extensions/tree_ext.pyx":4641
  *         stacks = [self.average_node_to_face_x, self.average_node_to_face_y]
  *         if self._dim == 3:
  *             stacks += [self.average_node_to_face_z]             # <<<<<<<<<<<<<<
  *         self._average_node_to_face = sp.vstack(stacks).tocsr()
  *         return self._average_node_to_face
  */
-    __Pyx_TraceLine(4646,0,__PYX_ERR(0, 4646, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_face_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4646, __pyx_L1_error)
+    __Pyx_TraceLine(4641,0,__PYX_ERR(0, 4641, __pyx_L1_error))
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_node_to_face_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4646, __pyx_L1_error)
+    __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_5);
     PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
     __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_stacks, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4646, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_stacks, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_stacks, ((PyObject*)__pyx_t_5));
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4645
+    /* "discretize/_extensions/tree_ext.pyx":4640
  * 
  *         stacks = [self.average_node_to_face_x, self.average_node_to_face_y]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             stacks += [self.average_node_to_face_z]
  *         self._average_node_to_face = sp.vstack(stacks).tocsr()
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4647
+  /* "discretize/_extensions/tree_ext.pyx":4642
  *         if self._dim == 3:
  *             stacks += [self.average_node_to_face_z]
  *         self._average_node_to_face = sp.vstack(stacks).tocsr()             # <<<<<<<<<<<<<<
  *         return self._average_node_to_face
  * 
  */
-  __Pyx_TraceLine(4647,0,__PYX_ERR(0, 4647, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4647, __pyx_L1_error)
+  __Pyx_TraceLine(4642,0,__PYX_ERR(0, 4642, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_vstack); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4647, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_vstack); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_3, __pyx_v_stacks) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_v_stacks);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4647, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4647, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4647, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_GIVEREF(__pyx_t_5);
   __Pyx_GOTREF(__pyx_v_self->_average_node_to_face);
   __Pyx_DECREF(__pyx_v_self->_average_node_to_face);
   __pyx_v_self->_average_node_to_face = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4648
+  /* "discretize/_extensions/tree_ext.pyx":4643
  *             stacks += [self.average_node_to_face_z]
  *         self._average_node_to_face = sp.vstack(stacks).tocsr()
  *         return self._average_node_to_face             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4648,0,__PYX_ERR(0, 4648, __pyx_L1_error))
+  __Pyx_TraceLine(4643,0,__PYX_ERR(0, 4643, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_node_to_face);
   __pyx_r = __pyx_v_self->_average_node_to_face;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4609
+  /* "discretize/_extensions/tree_ext.pyx":4604
  * 
  *     @property
  *     def average_node_to_face(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from nodes to faces (scalar quantities).
  * 
  */
 
@@ -54224,15 +54236,15 @@
   __Pyx_XDECREF(__pyx_v_stacks);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4651
+/* "discretize/_extensions/tree_ext.pyx":4646
  * 
  *     @property
  *     def average_cell_to_face(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from cell centers to faces (scalar quantities).
  * 
  */
 
@@ -54261,172 +54273,172 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4651, 0, __PYX_ERR(0, 4651, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4646, 0, __PYX_ERR(0, 4646, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4690
+  /* "discretize/_extensions/tree_ext.pyx":4685
  *             phi_f = Acf @ phi_c
  *         """
  *         if self._average_cell_to_face is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  */
-  __Pyx_TraceLine(4690,0,__PYX_ERR(0, 4690, __pyx_L1_error))
+  __Pyx_TraceLine(4685,0,__PYX_ERR(0, 4685, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_cell_to_face != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4691
+    /* "discretize/_extensions/tree_ext.pyx":4686
  *         """
  *         if self._average_cell_to_face is not None:
  *             return self._average_cell_to_face             # <<<<<<<<<<<<<<
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  *         if self._dim == 3:
  */
-    __Pyx_TraceLine(4691,0,__PYX_ERR(0, 4691, __pyx_L1_error))
+    __Pyx_TraceLine(4686,0,__PYX_ERR(0, 4686, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_cell_to_face);
     __pyx_r = __pyx_v_self->_average_cell_to_face;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4690
+    /* "discretize/_extensions/tree_ext.pyx":4685
  *             phi_f = Acf @ phi_c
  *         """
  *         if self._average_cell_to_face is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4692
+  /* "discretize/_extensions/tree_ext.pyx":4687
  *         if self._average_cell_to_face is not None:
  *             return self._average_cell_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]             # <<<<<<<<<<<<<<
  *         if self._dim == 3:
  *             stacks.append(self.average_cell_to_face_z)
  */
-  __Pyx_TraceLine(4692,0,__PYX_ERR(0, 4692, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4692, __pyx_L1_error)
+  __Pyx_TraceLine(4687,0,__PYX_ERR(0, 4687, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4687, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4692, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4687, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4692, __pyx_L1_error)
+  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4687, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
   __pyx_v_stacks = ((PyObject*)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4693
+  /* "discretize/_extensions/tree_ext.pyx":4688
  *             return self._average_cell_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             stacks.append(self.average_cell_to_face_z)
  * 
  */
-  __Pyx_TraceLine(4693,0,__PYX_ERR(0, 4693, __pyx_L1_error))
+  __Pyx_TraceLine(4688,0,__PYX_ERR(0, 4688, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_self->_dim == 3) != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4694
+    /* "discretize/_extensions/tree_ext.pyx":4689
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  *         if self._dim == 3:
  *             stacks.append(self.average_cell_to_face_z)             # <<<<<<<<<<<<<<
  * 
  *         self._average_cell_to_face = sp.vstack(stacks).tocsr()
  */
-    __Pyx_TraceLine(4694,0,__PYX_ERR(0, 4694, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4694, __pyx_L1_error)
+    __Pyx_TraceLine(4689,0,__PYX_ERR(0, 4689, __pyx_L1_error))
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4689, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_stacks, __pyx_t_5); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 4694, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_stacks, __pyx_t_5); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 4689, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4693
+    /* "discretize/_extensions/tree_ext.pyx":4688
  *             return self._average_cell_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             stacks.append(self.average_cell_to_face_z)
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4696
+  /* "discretize/_extensions/tree_ext.pyx":4691
  *             stacks.append(self.average_cell_to_face_z)
  * 
  *         self._average_cell_to_face = sp.vstack(stacks).tocsr()             # <<<<<<<<<<<<<<
  *         return self._average_cell_to_face
  * 
  */
-  __Pyx_TraceLine(4696,0,__PYX_ERR(0, 4696, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4696, __pyx_L1_error)
+  __Pyx_TraceLine(4691,0,__PYX_ERR(0, 4691, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_vstack); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4696, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_vstack); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_3, __pyx_v_stacks) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_stacks);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4696, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4696, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4696, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4691, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_GIVEREF(__pyx_t_5);
   __Pyx_GOTREF(__pyx_v_self->_average_cell_to_face);
   __Pyx_DECREF(__pyx_v_self->_average_cell_to_face);
   __pyx_v_self->_average_cell_to_face = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4697
+  /* "discretize/_extensions/tree_ext.pyx":4692
  * 
  *         self._average_cell_to_face = sp.vstack(stacks).tocsr()
  *         return self._average_cell_to_face             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4697,0,__PYX_ERR(0, 4697, __pyx_L1_error))
+  __Pyx_TraceLine(4692,0,__PYX_ERR(0, 4692, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_cell_to_face);
   __pyx_r = __pyx_v_self->_average_cell_to_face;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4651
+  /* "discretize/_extensions/tree_ext.pyx":4646
  * 
  *     @property
  *     def average_cell_to_face(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from cell centers to faces (scalar quantities).
  * 
  */
 
@@ -54442,15 +54454,15 @@
   __Pyx_XDECREF(__pyx_v_stacks);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4700
+/* "discretize/_extensions/tree_ext.pyx":4695
  * 
  *     @property
  *     def average_cell_vector_to_face(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from cell centers to faces (vector quantities).
  * 
  */
 
@@ -54479,172 +54491,172 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4700, 0, __PYX_ERR(0, 4700, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4695, 0, __PYX_ERR(0, 4695, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4750
+  /* "discretize/_extensions/tree_ext.pyx":4745
  *         the values.
  *         """
  *         if self._average_cell_vector_to_face is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_vector_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  */
-  __Pyx_TraceLine(4750,0,__PYX_ERR(0, 4750, __pyx_L1_error))
+  __Pyx_TraceLine(4745,0,__PYX_ERR(0, 4745, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_cell_vector_to_face != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4751
+    /* "discretize/_extensions/tree_ext.pyx":4746
  *         """
  *         if self._average_cell_vector_to_face is not None:
  *             return self._average_cell_vector_to_face             # <<<<<<<<<<<<<<
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  *         if self._dim == 3:
  */
-    __Pyx_TraceLine(4751,0,__PYX_ERR(0, 4751, __pyx_L1_error))
+    __Pyx_TraceLine(4746,0,__PYX_ERR(0, 4746, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_cell_vector_to_face);
     __pyx_r = __pyx_v_self->_average_cell_vector_to_face;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4750
+    /* "discretize/_extensions/tree_ext.pyx":4745
  *         the values.
  *         """
  *         if self._average_cell_vector_to_face is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_vector_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4752
+  /* "discretize/_extensions/tree_ext.pyx":4747
  *         if self._average_cell_vector_to_face is not None:
  *             return self._average_cell_vector_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]             # <<<<<<<<<<<<<<
  *         if self._dim == 3:
  *             stacks.append(self.average_cell_to_face_z)
  */
-  __Pyx_TraceLine(4752,0,__PYX_ERR(0, 4752, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4752, __pyx_L1_error)
+  __Pyx_TraceLine(4747,0,__PYX_ERR(0, 4747, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4752, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4752, __pyx_L1_error)
+  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
   __pyx_v_stacks = ((PyObject*)__pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4753
+  /* "discretize/_extensions/tree_ext.pyx":4748
  *             return self._average_cell_vector_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             stacks.append(self.average_cell_to_face_z)
  * 
  */
-  __Pyx_TraceLine(4753,0,__PYX_ERR(0, 4753, __pyx_L1_error))
+  __Pyx_TraceLine(4748,0,__PYX_ERR(0, 4748, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_self->_dim == 3) != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4754
+    /* "discretize/_extensions/tree_ext.pyx":4749
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  *         if self._dim == 3:
  *             stacks.append(self.average_cell_to_face_z)             # <<<<<<<<<<<<<<
  * 
  *         self._average_cell_vector_to_face = sp.block_diag(stacks).tocsr()
  */
-    __Pyx_TraceLine(4754,0,__PYX_ERR(0, 4754, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4754, __pyx_L1_error)
+    __Pyx_TraceLine(4749,0,__PYX_ERR(0, 4749, __pyx_L1_error))
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_average_cell_to_face_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4749, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_stacks, __pyx_t_5); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 4754, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyList_Append(__pyx_v_stacks, __pyx_t_5); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 4749, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4753
+    /* "discretize/_extensions/tree_ext.pyx":4748
  *             return self._average_cell_vector_to_face
  *         stacks = [self.average_cell_to_face_x, self.average_cell_to_face_y]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             stacks.append(self.average_cell_to_face_z)
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4756
+  /* "discretize/_extensions/tree_ext.pyx":4751
  *             stacks.append(self.average_cell_to_face_z)
  * 
  *         self._average_cell_vector_to_face = sp.block_diag(stacks).tocsr()             # <<<<<<<<<<<<<<
  *         return self._average_cell_vector_to_face
  * 
  */
-  __Pyx_TraceLine(4756,0,__PYX_ERR(0, 4756, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4756, __pyx_L1_error)
+  __Pyx_TraceLine(4751,0,__PYX_ERR(0, 4751, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4751, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_block_diag); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4756, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_block_diag); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4751, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_4 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_3, __pyx_v_stacks) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_v_stacks);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4756, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4751, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4756, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tocsr); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4751, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_4 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_4)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_4);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_5 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4756, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4751, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_GIVEREF(__pyx_t_5);
   __Pyx_GOTREF(__pyx_v_self->_average_cell_vector_to_face);
   __Pyx_DECREF(__pyx_v_self->_average_cell_vector_to_face);
   __pyx_v_self->_average_cell_vector_to_face = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4757
+  /* "discretize/_extensions/tree_ext.pyx":4752
  * 
  *         self._average_cell_vector_to_face = sp.block_diag(stacks).tocsr()
  *         return self._average_cell_vector_to_face             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4757,0,__PYX_ERR(0, 4757, __pyx_L1_error))
+  __Pyx_TraceLine(4752,0,__PYX_ERR(0, 4752, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_cell_vector_to_face);
   __pyx_r = __pyx_v_self->_average_cell_vector_to_face;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4700
+  /* "discretize/_extensions/tree_ext.pyx":4695
  * 
  *     @property
  *     def average_cell_vector_to_face(self):             # <<<<<<<<<<<<<<
  *         r"""Averaging operator from cell centers to faces (vector quantities).
  * 
  */
 
@@ -54660,15 +54672,15 @@
   __Pyx_XDECREF(__pyx_v_stacks);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4760
+/* "discretize/_extensions/tree_ext.pyx":4755
  * 
  *     @property
  *     def average_cell_to_face_x(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from cell centers to x faces (scalar quantities).
  * 
  */
 
@@ -54723,1599 +54735,1599 @@
   long __pyx_t_19;
   Py_ssize_t __pyx_t_20;
   PyObject *__pyx_t_21 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4760, 0, __PYX_ERR(0, 4760, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4755, 0, __PYX_ERR(0, 4755, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4773
+  /* "discretize/_extensions/tree_ext.pyx":4768
  *             The scalar averaging operator from cell centers to x faces
  *         """
  *         if self._average_cell_to_face_x is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_to_face_x
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  */
-  __Pyx_TraceLine(4773,0,__PYX_ERR(0, 4773, __pyx_L1_error))
+  __Pyx_TraceLine(4768,0,__PYX_ERR(0, 4768, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_cell_to_face_x != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4774
+    /* "discretize/_extensions/tree_ext.pyx":4769
  *         """
  *         if self._average_cell_to_face_x is not None:
  *             return self._average_cell_to_face_x             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  */
-    __Pyx_TraceLine(4774,0,__PYX_ERR(0, 4774, __pyx_L1_error))
+    __Pyx_TraceLine(4769,0,__PYX_ERR(0, 4769, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_cell_to_face_x);
     __pyx_r = __pyx_v_self->_average_cell_to_face_x;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4773
+    /* "discretize/_extensions/tree_ext.pyx":4768
  *             The scalar averaging operator from cell centers to x faces
  *         """
  *         if self._average_cell_to_face_x is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_to_face_x
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4775
+  /* "discretize/_extensions/tree_ext.pyx":4770
  *         if self._average_cell_to_face_x is not None:
  *             return self._average_cell_to_face_x
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_x, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_x, dtype=np.float64)
  */
-  __Pyx_TraceLine(4775,0,__PYX_ERR(0, 4775, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __Pyx_TraceLine(4770,0,__PYX_ERR(0, 4770, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_int_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_int_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4775, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4775, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4770, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4776
+  /* "discretize/_extensions/tree_ext.pyx":4771
  *             return self._average_cell_to_face_x
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_x, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_x, dtype=np.float64)
  *         cdef int dim = self._dim
  */
-  __Pyx_TraceLine(4776,0,__PYX_ERR(0, 4776, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __Pyx_TraceLine(4771,0,__PYX_ERR(0, 4771, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = PyNumber_Multiply(__pyx_int_2, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_int_2, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4776, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4776, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4771, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4777
+  /* "discretize/_extensions/tree_ext.pyx":4772
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_x, dtype=np.float64)             # <<<<<<<<<<<<<<
  *         cdef int dim = self._dim
  *         cdef int_t ind, ind_parent
  */
-  __Pyx_TraceLine(4777,0,__PYX_ERR(0, 4777, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __Pyx_TraceLine(4772,0,__PYX_ERR(0, 4772, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_int_2, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_int_2, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4777, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4777, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4772, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4778
+  /* "discretize/_extensions/tree_ext.pyx":4773
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_x, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_x, dtype=np.float64)
  *         cdef int dim = self._dim             # <<<<<<<<<<<<<<
  *         cdef int_t ind, ind_parent
  *         cdef int_t children_per_parent = (dim-1)*2
  */
-  __Pyx_TraceLine(4778,0,__PYX_ERR(0, 4778, __pyx_L1_error))
+  __Pyx_TraceLine(4773,0,__PYX_ERR(0, 4773, __pyx_L1_error))
   __pyx_t_10 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_10;
 
-  /* "discretize/_extensions/tree_ext.pyx":4780
+  /* "discretize/_extensions/tree_ext.pyx":4775
  *         cdef int dim = self._dim
  *         cdef int_t ind, ind_parent
  *         cdef int_t children_per_parent = (dim-1)*2             # <<<<<<<<<<<<<<
  *         cdef c_Cell* child
  *         cdef c_Cell* next_cell
  */
-  __Pyx_TraceLine(4780,0,__PYX_ERR(0, 4780, __pyx_L1_error))
+  __Pyx_TraceLine(4775,0,__PYX_ERR(0, 4775, __pyx_L1_error))
   __pyx_v_children_per_parent = ((__pyx_v_dim - 1) * 2);
 
-  /* "discretize/_extensions/tree_ext.pyx":4786
+  /* "discretize/_extensions/tree_ext.pyx":4781
  *         cdef double w
  * 
  *         for cell in self.tree.cells :             # <<<<<<<<<<<<<<
  *             next_cell = cell.neighbors[1]
  *             prev_cell = cell.neighbors[0]
  */
-  __Pyx_TraceLine(4786,0,__PYX_ERR(0, 4786, __pyx_L1_error))
+  __Pyx_TraceLine(4781,0,__PYX_ERR(0, 4781, __pyx_L1_error))
   __pyx_t_12 = &__pyx_v_self->tree->cells;
   __pyx_t_11 = __pyx_t_12->begin();
   for (;;) {
     if (!(__pyx_t_11 != __pyx_t_12->end())) break;
     __pyx_t_13 = *__pyx_t_11;
     ++__pyx_t_11;
     __pyx_v_cell = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4787
+    /* "discretize/_extensions/tree_ext.pyx":4782
  * 
  *         for cell in self.tree.cells :
  *             next_cell = cell.neighbors[1]             # <<<<<<<<<<<<<<
  *             prev_cell = cell.neighbors[0]
  *             # handle extrapolation to boundary faces
  */
-    __Pyx_TraceLine(4787,0,__PYX_ERR(0, 4787, __pyx_L1_error))
+    __Pyx_TraceLine(4782,0,__PYX_ERR(0, 4782, __pyx_L1_error))
     __pyx_v_next_cell = (__pyx_v_cell->neighbors[1]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4788
+    /* "discretize/_extensions/tree_ext.pyx":4783
  *         for cell in self.tree.cells :
  *             next_cell = cell.neighbors[1]
  *             prev_cell = cell.neighbors[0]             # <<<<<<<<<<<<<<
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:
  */
-    __Pyx_TraceLine(4788,0,__PYX_ERR(0, 4788, __pyx_L1_error))
+    __Pyx_TraceLine(4783,0,__PYX_ERR(0, 4783, __pyx_L1_error))
     __pyx_v_prev_cell = (__pyx_v_cell->neighbors[0]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4790
+    /* "discretize/_extensions/tree_ext.pyx":4785
  *             prev_cell = cell.neighbors[0]
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:             # <<<<<<<<<<<<<<
  *                 if dim == 2:
  *                     ind = cell.edges[3].index # +x face
  */
-    __Pyx_TraceLine(4790,0,__PYX_ERR(0, 4790, __pyx_L1_error))
+    __Pyx_TraceLine(4785,0,__PYX_ERR(0, 4785, __pyx_L1_error))
     __pyx_t_2 = ((__pyx_v_next_cell == NULL) != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4791
+      /* "discretize/_extensions/tree_ext.pyx":4786
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind = cell.edges[3].index # +x face
  *                 else:
  */
-      __Pyx_TraceLine(4791,0,__PYX_ERR(0, 4791, __pyx_L1_error))
+      __Pyx_TraceLine(4786,0,__PYX_ERR(0, 4786, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
       if (__pyx_t_2) {
 
-        /* "discretize/_extensions/tree_ext.pyx":4792
+        /* "discretize/_extensions/tree_ext.pyx":4787
  *             if next_cell == NULL:
  *                 if dim == 2:
  *                     ind = cell.edges[3].index # +x face             # <<<<<<<<<<<<<<
  *                 else:
  *                     ind = cell.faces[1].index # +x face
  */
-        __Pyx_TraceLine(4792,0,__PYX_ERR(0, 4792, __pyx_L1_error))
+        __Pyx_TraceLine(4787,0,__PYX_ERR(0, 4787, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_cell->edges[3])->index;
         __pyx_v_ind = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":4791
+        /* "discretize/_extensions/tree_ext.pyx":4786
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind = cell.edges[3].index # +x face
  *                 else:
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4794
+      /* "discretize/_extensions/tree_ext.pyx":4789
  *                     ind = cell.edges[3].index # +x face
  *                 else:
  *                     ind = cell.faces[1].index # +x face             # <<<<<<<<<<<<<<
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  */
-      __Pyx_TraceLine(4794,0,__PYX_ERR(0, 4794, __pyx_L1_error))
+      __Pyx_TraceLine(4789,0,__PYX_ERR(0, 4789, __pyx_L1_error))
       /*else*/ {
         __pyx_t_10 = (__pyx_v_cell->faces[1])->index;
         __pyx_v_ind = __pyx_t_10;
       }
       __pyx_L7:;
 
-      /* "discretize/_extensions/tree_ext.pyx":4795
+      /* "discretize/_extensions/tree_ext.pyx":4790
  *                 else:
  *                     ind = cell.faces[1].index # +x face
  *                 I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  */
-      __Pyx_TraceLine(4795,0,__PYX_ERR(0, 4795, __pyx_L1_error))
+      __Pyx_TraceLine(4790,0,__PYX_ERR(0, 4790, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4795, __pyx_L1_error)
+        __PYX_ERR(0, 4790, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-      /* "discretize/_extensions/tree_ext.pyx":4796
+      /* "discretize/_extensions/tree_ext.pyx":4791
  *                     ind = cell.faces[1].index # +x face
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                 V[2*ind  ] = 1.0
  *                 continue
  */
-      __Pyx_TraceLine(4796,0,__PYX_ERR(0, 4796, __pyx_L1_error))
+      __Pyx_TraceLine(4791,0,__PYX_ERR(0, 4791, __pyx_L1_error))
       __pyx_t_16 = __pyx_v_cell->index;
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4796, __pyx_L1_error)
+        __PYX_ERR(0, 4791, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-      /* "discretize/_extensions/tree_ext.pyx":4797
+      /* "discretize/_extensions/tree_ext.pyx":4792
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0             # <<<<<<<<<<<<<<
  *                 continue
  *             if prev_cell == NULL:
  */
-      __Pyx_TraceLine(4797,0,__PYX_ERR(0, 4797, __pyx_L1_error))
+      __Pyx_TraceLine(4792,0,__PYX_ERR(0, 4792, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4797, __pyx_L1_error)
+        __PYX_ERR(0, 4792, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = 1.0;
 
-      /* "discretize/_extensions/tree_ext.pyx":4798
+      /* "discretize/_extensions/tree_ext.pyx":4793
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  *                 continue             # <<<<<<<<<<<<<<
  *             if prev_cell == NULL:
  *                 if dim == 2:
  */
-      __Pyx_TraceLine(4798,0,__PYX_ERR(0, 4798, __pyx_L1_error))
+      __Pyx_TraceLine(4793,0,__PYX_ERR(0, 4793, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":4790
+      /* "discretize/_extensions/tree_ext.pyx":4785
  *             prev_cell = cell.neighbors[0]
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:             # <<<<<<<<<<<<<<
  *                 if dim == 2:
  *                     ind = cell.edges[3].index # +x face
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4799
+    /* "discretize/_extensions/tree_ext.pyx":4794
  *                 V[2*ind  ] = 1.0
  *                 continue
  *             if prev_cell == NULL:             # <<<<<<<<<<<<<<
  *                 if dim == 2:
  *                     ind = cell.edges[2].index # -x face
  */
-    __Pyx_TraceLine(4799,0,__PYX_ERR(0, 4799, __pyx_L1_error))
+    __Pyx_TraceLine(4794,0,__PYX_ERR(0, 4794, __pyx_L1_error))
     __pyx_t_2 = ((__pyx_v_prev_cell == NULL) != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4800
+      /* "discretize/_extensions/tree_ext.pyx":4795
  *                 continue
  *             if prev_cell == NULL:
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind = cell.edges[2].index # -x face
  *                 else:
  */
-      __Pyx_TraceLine(4800,0,__PYX_ERR(0, 4800, __pyx_L1_error))
+      __Pyx_TraceLine(4795,0,__PYX_ERR(0, 4795, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
       if (__pyx_t_2) {
 
-        /* "discretize/_extensions/tree_ext.pyx":4801
+        /* "discretize/_extensions/tree_ext.pyx":4796
  *             if prev_cell == NULL:
  *                 if dim == 2:
  *                     ind = cell.edges[2].index # -x face             # <<<<<<<<<<<<<<
  *                 else:
  *                     ind = cell.faces[0].index # -x face
  */
-        __Pyx_TraceLine(4801,0,__PYX_ERR(0, 4801, __pyx_L1_error))
+        __Pyx_TraceLine(4796,0,__PYX_ERR(0, 4796, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_cell->edges[2])->index;
         __pyx_v_ind = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":4800
+        /* "discretize/_extensions/tree_ext.pyx":4795
  *                 continue
  *             if prev_cell == NULL:
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind = cell.edges[2].index # -x face
  *                 else:
  */
         goto __pyx_L9;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4803
+      /* "discretize/_extensions/tree_ext.pyx":4798
  *                     ind = cell.edges[2].index # -x face
  *                 else:
  *                     ind = cell.faces[0].index # -x face             # <<<<<<<<<<<<<<
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  */
-      __Pyx_TraceLine(4803,0,__PYX_ERR(0, 4803, __pyx_L1_error))
+      __Pyx_TraceLine(4798,0,__PYX_ERR(0, 4798, __pyx_L1_error))
       /*else*/ {
         __pyx_t_10 = (__pyx_v_cell->faces[0])->index;
         __pyx_v_ind = __pyx_t_10;
       }
       __pyx_L9:;
 
-      /* "discretize/_extensions/tree_ext.pyx":4804
+      /* "discretize/_extensions/tree_ext.pyx":4799
  *                 else:
  *                     ind = cell.faces[0].index # -x face
  *                 I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  */
-      __Pyx_TraceLine(4804,0,__PYX_ERR(0, 4804, __pyx_L1_error))
+      __Pyx_TraceLine(4799,0,__PYX_ERR(0, 4799, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4804, __pyx_L1_error)
+        __PYX_ERR(0, 4799, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-      /* "discretize/_extensions/tree_ext.pyx":4805
+      /* "discretize/_extensions/tree_ext.pyx":4800
  *                     ind = cell.faces[0].index # -x face
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                 V[2*ind  ] = 1.0
  * 
  */
-      __Pyx_TraceLine(4805,0,__PYX_ERR(0, 4805, __pyx_L1_error))
+      __Pyx_TraceLine(4800,0,__PYX_ERR(0, 4800, __pyx_L1_error))
       __pyx_t_16 = __pyx_v_cell->index;
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4805, __pyx_L1_error)
+        __PYX_ERR(0, 4800, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-      /* "discretize/_extensions/tree_ext.pyx":4806
+      /* "discretize/_extensions/tree_ext.pyx":4801
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0             # <<<<<<<<<<<<<<
  * 
  *             if next_cell.is_leaf():
  */
-      __Pyx_TraceLine(4806,0,__PYX_ERR(0, 4806, __pyx_L1_error))
+      __Pyx_TraceLine(4801,0,__PYX_ERR(0, 4801, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4806, __pyx_L1_error)
+        __PYX_ERR(0, 4801, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = 1.0;
 
-      /* "discretize/_extensions/tree_ext.pyx":4799
+      /* "discretize/_extensions/tree_ext.pyx":4794
  *                 V[2*ind  ] = 1.0
  *                 continue
  *             if prev_cell == NULL:             # <<<<<<<<<<<<<<
  *                 if dim == 2:
  *                     ind = cell.edges[2].index # -x face
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4808
+    /* "discretize/_extensions/tree_ext.pyx":4803
  *                 V[2*ind  ] = 1.0
  * 
  *             if next_cell.is_leaf():             # <<<<<<<<<<<<<<
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  */
-    __Pyx_TraceLine(4808,0,__PYX_ERR(0, 4808, __pyx_L1_error))
+    __Pyx_TraceLine(4803,0,__PYX_ERR(0, 4803, __pyx_L1_error))
     __pyx_t_2 = (__pyx_v_next_cell->is_leaf() != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4809
+      /* "discretize/_extensions/tree_ext.pyx":4804
  * 
  *             if next_cell.is_leaf():
  *                 if next_cell.level == cell.level:             # <<<<<<<<<<<<<<
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:
  */
-      __Pyx_TraceLine(4809,0,__PYX_ERR(0, 4809, __pyx_L1_error))
+      __Pyx_TraceLine(4804,0,__PYX_ERR(0, 4804, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_v_next_cell->level == __pyx_v_cell->level) != 0);
       if (__pyx_t_2) {
 
-        /* "discretize/_extensions/tree_ext.pyx":4811
+        /* "discretize/_extensions/tree_ext.pyx":4806
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:             # <<<<<<<<<<<<<<
  *                         ind = cell.edges[3].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(
  */
-        __Pyx_TraceLine(4811,0,__PYX_ERR(0, 4811, __pyx_L1_error))
+        __Pyx_TraceLine(4806,0,__PYX_ERR(0, 4806, __pyx_L1_error))
         __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
         if (__pyx_t_2) {
 
-          /* "discretize/_extensions/tree_ext.pyx":4812
+          /* "discretize/_extensions/tree_ext.pyx":4807
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:
  *                         ind = cell.edges[3].index             # <<<<<<<<<<<<<<
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(
  *                              next_cell.location[0] - cell.location[0])
  */
-          __Pyx_TraceLine(4812,0,__PYX_ERR(0, 4812, __pyx_L1_error))
+          __Pyx_TraceLine(4807,0,__PYX_ERR(0, 4807, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_cell->edges[3])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4813
+          /* "discretize/_extensions/tree_ext.pyx":4808
  *                     if dim == 2:
  *                         ind = cell.edges[3].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[0] - cell.location[0])
  *                     else:
  */
-          __Pyx_TraceLine(4813,0,__PYX_ERR(0, 4813, __pyx_L1_error))
+          __Pyx_TraceLine(4808,0,__PYX_ERR(0, 4808, __pyx_L1_error))
           __pyx_t_17 = ((__pyx_v_next_cell->location[0]) - ((__pyx_v_cell->edges[3])->location[0]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4814
+          /* "discretize/_extensions/tree_ext.pyx":4809
  *                         ind = cell.edges[3].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(
  *                              next_cell.location[0] - cell.location[0])             # <<<<<<<<<<<<<<
  *                     else:
  *                         ind = cell.faces[1].index
  */
-          __Pyx_TraceLine(4814,0,__PYX_ERR(0, 4814, __pyx_L1_error))
+          __Pyx_TraceLine(4809,0,__PYX_ERR(0, 4809, __pyx_L1_error))
           __pyx_t_18 = ((__pyx_v_next_cell->location[0]) - (__pyx_v_cell->location[0]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4813
+          /* "discretize/_extensions/tree_ext.pyx":4808
  *                     if dim == 2:
  *                         ind = cell.edges[3].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[0] - cell.location[0])
  *                     else:
  */
-          __Pyx_TraceLine(4813,0,__PYX_ERR(0, 4813, __pyx_L1_error))
+          __Pyx_TraceLine(4808,0,__PYX_ERR(0, 4808, __pyx_L1_error))
           if (unlikely(__pyx_t_18 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4813, __pyx_L1_error)
+            __PYX_ERR(0, 4808, __pyx_L1_error)
           }
           __pyx_v_w = (__pyx_t_17 / __pyx_t_18);
 
-          /* "discretize/_extensions/tree_ext.pyx":4811
+          /* "discretize/_extensions/tree_ext.pyx":4806
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:             # <<<<<<<<<<<<<<
  *                         ind = cell.edges[3].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(
  */
           goto __pyx_L12;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":4816
+        /* "discretize/_extensions/tree_ext.pyx":4811
  *                              next_cell.location[0] - cell.location[0])
  *                     else:
  *                         ind = cell.faces[1].index             # <<<<<<<<<<<<<<
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(
  *                              next_cell.location[0] - cell.location[0])
  */
-        __Pyx_TraceLine(4816,0,__PYX_ERR(0, 4816, __pyx_L1_error))
+        __Pyx_TraceLine(4811,0,__PYX_ERR(0, 4811, __pyx_L1_error))
         /*else*/ {
           __pyx_t_10 = (__pyx_v_cell->faces[1])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4817
+          /* "discretize/_extensions/tree_ext.pyx":4812
  *                     else:
  *                         ind = cell.faces[1].index
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[0] - cell.location[0])
  *                     I[2*ind  ] = ind
  */
-          __Pyx_TraceLine(4817,0,__PYX_ERR(0, 4817, __pyx_L1_error))
+          __Pyx_TraceLine(4812,0,__PYX_ERR(0, 4812, __pyx_L1_error))
           __pyx_t_18 = ((__pyx_v_next_cell->location[0]) - ((__pyx_v_cell->faces[1])->location[0]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4818
+          /* "discretize/_extensions/tree_ext.pyx":4813
  *                         ind = cell.faces[1].index
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(
  *                              next_cell.location[0] - cell.location[0])             # <<<<<<<<<<<<<<
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind
  */
-          __Pyx_TraceLine(4818,0,__PYX_ERR(0, 4818, __pyx_L1_error))
+          __Pyx_TraceLine(4813,0,__PYX_ERR(0, 4813, __pyx_L1_error))
           __pyx_t_17 = ((__pyx_v_next_cell->location[0]) - (__pyx_v_cell->location[0]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4817
+          /* "discretize/_extensions/tree_ext.pyx":4812
  *                     else:
  *                         ind = cell.faces[1].index
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[0] - cell.location[0])
  *                     I[2*ind  ] = ind
  */
-          __Pyx_TraceLine(4817,0,__PYX_ERR(0, 4817, __pyx_L1_error))
+          __Pyx_TraceLine(4812,0,__PYX_ERR(0, 4812, __pyx_L1_error))
           if (unlikely(__pyx_t_17 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4817, __pyx_L1_error)
+            __PYX_ERR(0, 4812, __pyx_L1_error)
           }
           __pyx_v_w = (__pyx_t_18 / __pyx_t_17);
         }
         __pyx_L12:;
 
-        /* "discretize/_extensions/tree_ext.pyx":4819
+        /* "discretize/_extensions/tree_ext.pyx":4814
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(
  *                              next_cell.location[0] - cell.location[0])
  *                     I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index
  */
-        __Pyx_TraceLine(4819,0,__PYX_ERR(0, 4819, __pyx_L1_error))
+        __Pyx_TraceLine(4814,0,__PYX_ERR(0, 4814, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4819, __pyx_L1_error)
+          __PYX_ERR(0, 4814, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-        /* "discretize/_extensions/tree_ext.pyx":4820
+        /* "discretize/_extensions/tree_ext.pyx":4815
  *                              next_cell.location[0] - cell.location[0])
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind             # <<<<<<<<<<<<<<
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  */
-        __Pyx_TraceLine(4820,0,__PYX_ERR(0, 4820, __pyx_L1_error))
+        __Pyx_TraceLine(4815,0,__PYX_ERR(0, 4815, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4820, __pyx_L1_error)
+          __PYX_ERR(0, 4815, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-        /* "discretize/_extensions/tree_ext.pyx":4821
+        /* "discretize/_extensions/tree_ext.pyx":4816
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w
  */
-        __Pyx_TraceLine(4821,0,__PYX_ERR(0, 4821, __pyx_L1_error))
+        __Pyx_TraceLine(4816,0,__PYX_ERR(0, 4816, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_cell->index;
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4821, __pyx_L1_error)
+          __PYX_ERR(0, 4816, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4822
+        /* "discretize/_extensions/tree_ext.pyx":4817
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index             # <<<<<<<<<<<<<<
  *                     V[2*ind  ] = w
  *                     V[2*ind+1] = (1.0-w)
  */
-        __Pyx_TraceLine(4822,0,__PYX_ERR(0, 4822, __pyx_L1_error))
+        __Pyx_TraceLine(4817,0,__PYX_ERR(0, 4817, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_next_cell->index;
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4822, __pyx_L1_error)
+          __PYX_ERR(0, 4817, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4823
+        /* "discretize/_extensions/tree_ext.pyx":4818
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w             # <<<<<<<<<<<<<<
  *                     V[2*ind+1] = (1.0-w)
  *                 else:
  */
-        __Pyx_TraceLine(4823,0,__PYX_ERR(0, 4823, __pyx_L1_error))
+        __Pyx_TraceLine(4818,0,__PYX_ERR(0, 4818, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4823, __pyx_L1_error)
+          __PYX_ERR(0, 4818, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = __pyx_v_w;
 
-        /* "discretize/_extensions/tree_ext.pyx":4824
+        /* "discretize/_extensions/tree_ext.pyx":4819
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w
  *                     V[2*ind+1] = (1.0-w)             # <<<<<<<<<<<<<<
  *                 else:
  *                     # if next cell is a level larger than i am, then i need to accumulate into w
  */
-        __Pyx_TraceLine(4824,0,__PYX_ERR(0, 4824, __pyx_L1_error))
+        __Pyx_TraceLine(4819,0,__PYX_ERR(0, 4819, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4824, __pyx_L1_error)
+          __PYX_ERR(0, 4819, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (1.0 - __pyx_v_w);
 
-        /* "discretize/_extensions/tree_ext.pyx":4809
+        /* "discretize/_extensions/tree_ext.pyx":4804
  * 
  *             if next_cell.is_leaf():
  *                 if next_cell.level == cell.level:             # <<<<<<<<<<<<<<
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:
  */
         goto __pyx_L11;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4827
+      /* "discretize/_extensions/tree_ext.pyx":4822
  *                 else:
  *                     # if next cell is a level larger than i am, then i need to accumulate into w
  *                     if dim == 2:             # <<<<<<<<<<<<<<
  *                         ind = cell.edges[3].index
  *                         ind_parent = cell.edges[3].parents[0].index
  */
-      __Pyx_TraceLine(4827,0,__PYX_ERR(0, 4827, __pyx_L1_error))
+      __Pyx_TraceLine(4822,0,__PYX_ERR(0, 4822, __pyx_L1_error))
       /*else*/ {
         __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
         if (__pyx_t_2) {
 
-          /* "discretize/_extensions/tree_ext.pyx":4828
+          /* "discretize/_extensions/tree_ext.pyx":4823
  *                     # if next cell is a level larger than i am, then i need to accumulate into w
  *                     if dim == 2:
  *                         ind = cell.edges[3].index             # <<<<<<<<<<<<<<
  *                         ind_parent = cell.edges[3].parents[0].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(
  */
-          __Pyx_TraceLine(4828,0,__PYX_ERR(0, 4828, __pyx_L1_error))
+          __Pyx_TraceLine(4823,0,__PYX_ERR(0, 4823, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_cell->edges[3])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4829
+          /* "discretize/_extensions/tree_ext.pyx":4824
  *                     if dim == 2:
  *                         ind = cell.edges[3].index
  *                         ind_parent = cell.edges[3].parents[0].index             # <<<<<<<<<<<<<<
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(
  *                              next_cell.location[0] - cell.location[0])
  */
-          __Pyx_TraceLine(4829,0,__PYX_ERR(0, 4829, __pyx_L1_error))
+          __Pyx_TraceLine(4824,0,__PYX_ERR(0, 4824, __pyx_L1_error))
           __pyx_t_10 = ((__pyx_v_cell->edges[3])->parents[0])->index;
           __pyx_v_ind_parent = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4830
+          /* "discretize/_extensions/tree_ext.pyx":4825
  *                         ind = cell.edges[3].index
  *                         ind_parent = cell.edges[3].parents[0].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[0] - cell.location[0])
  *                     else:
  */
-          __Pyx_TraceLine(4830,0,__PYX_ERR(0, 4830, __pyx_L1_error))
+          __Pyx_TraceLine(4825,0,__PYX_ERR(0, 4825, __pyx_L1_error))
           __pyx_t_17 = ((__pyx_v_next_cell->location[0]) - ((__pyx_v_cell->edges[3])->location[0]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4831
+          /* "discretize/_extensions/tree_ext.pyx":4826
  *                         ind_parent = cell.edges[3].parents[0].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(
  *                              next_cell.location[0] - cell.location[0])             # <<<<<<<<<<<<<<
  *                     else:
  *                         ind = cell.faces[1].index
  */
-          __Pyx_TraceLine(4831,0,__PYX_ERR(0, 4831, __pyx_L1_error))
+          __Pyx_TraceLine(4826,0,__PYX_ERR(0, 4826, __pyx_L1_error))
           __pyx_t_18 = ((__pyx_v_next_cell->location[0]) - (__pyx_v_cell->location[0]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4830
+          /* "discretize/_extensions/tree_ext.pyx":4825
  *                         ind = cell.edges[3].index
  *                         ind_parent = cell.edges[3].parents[0].index
  *                         w = (next_cell.location[0] - cell.edges[3].location[0])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[0] - cell.location[0])
  *                     else:
  */
-          __Pyx_TraceLine(4830,0,__PYX_ERR(0, 4830, __pyx_L1_error))
+          __Pyx_TraceLine(4825,0,__PYX_ERR(0, 4825, __pyx_L1_error))
           if (unlikely(__pyx_t_18 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4830, __pyx_L1_error)
+            __PYX_ERR(0, 4825, __pyx_L1_error)
           }
           __pyx_v_w = (__pyx_t_17 / __pyx_t_18);
 
-          /* "discretize/_extensions/tree_ext.pyx":4827
+          /* "discretize/_extensions/tree_ext.pyx":4822
  *                 else:
  *                     # if next cell is a level larger than i am, then i need to accumulate into w
  *                     if dim == 2:             # <<<<<<<<<<<<<<
  *                         ind = cell.edges[3].index
  *                         ind_parent = cell.edges[3].parents[0].index
  */
           goto __pyx_L13;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":4833
+        /* "discretize/_extensions/tree_ext.pyx":4828
  *                              next_cell.location[0] - cell.location[0])
  *                     else:
  *                         ind = cell.faces[1].index             # <<<<<<<<<<<<<<
  *                         ind_parent = cell.faces[1].parent.index
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(
  */
-        __Pyx_TraceLine(4833,0,__PYX_ERR(0, 4833, __pyx_L1_error))
+        __Pyx_TraceLine(4828,0,__PYX_ERR(0, 4828, __pyx_L1_error))
         /*else*/ {
           __pyx_t_10 = (__pyx_v_cell->faces[1])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4834
+          /* "discretize/_extensions/tree_ext.pyx":4829
  *                     else:
  *                         ind = cell.faces[1].index
  *                         ind_parent = cell.faces[1].parent.index             # <<<<<<<<<<<<<<
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(
  *                              next_cell.location[0] - cell.location[0])
  */
-          __Pyx_TraceLine(4834,0,__PYX_ERR(0, 4834, __pyx_L1_error))
+          __Pyx_TraceLine(4829,0,__PYX_ERR(0, 4829, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_cell->faces[1])->parent->index;
           __pyx_v_ind_parent = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4835
+          /* "discretize/_extensions/tree_ext.pyx":4830
  *                         ind = cell.faces[1].index
  *                         ind_parent = cell.faces[1].parent.index
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[0] - cell.location[0])
  *                     I[2*ind  ] = ind_parent
  */
-          __Pyx_TraceLine(4835,0,__PYX_ERR(0, 4835, __pyx_L1_error))
+          __Pyx_TraceLine(4830,0,__PYX_ERR(0, 4830, __pyx_L1_error))
           __pyx_t_18 = ((__pyx_v_next_cell->location[0]) - ((__pyx_v_cell->faces[1])->location[0]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4836
+          /* "discretize/_extensions/tree_ext.pyx":4831
  *                         ind_parent = cell.faces[1].parent.index
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(
  *                              next_cell.location[0] - cell.location[0])             # <<<<<<<<<<<<<<
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent
  */
-          __Pyx_TraceLine(4836,0,__PYX_ERR(0, 4836, __pyx_L1_error))
+          __Pyx_TraceLine(4831,0,__PYX_ERR(0, 4831, __pyx_L1_error))
           __pyx_t_17 = ((__pyx_v_next_cell->location[0]) - (__pyx_v_cell->location[0]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4835
+          /* "discretize/_extensions/tree_ext.pyx":4830
  *                         ind = cell.faces[1].index
  *                         ind_parent = cell.faces[1].parent.index
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[0] - cell.location[0])
  *                     I[2*ind  ] = ind_parent
  */
-          __Pyx_TraceLine(4835,0,__PYX_ERR(0, 4835, __pyx_L1_error))
+          __Pyx_TraceLine(4830,0,__PYX_ERR(0, 4830, __pyx_L1_error))
           if (unlikely(__pyx_t_17 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4835, __pyx_L1_error)
+            __PYX_ERR(0, 4830, __pyx_L1_error)
           }
           __pyx_v_w = (__pyx_t_18 / __pyx_t_17);
         }
         __pyx_L13:;
 
-        /* "discretize/_extensions/tree_ext.pyx":4837
+        /* "discretize/_extensions/tree_ext.pyx":4832
  *                         w = (next_cell.location[0] - cell.faces[1].location[0])/(
  *                              next_cell.location[0] - cell.location[0])
  *                     I[2*ind  ] = ind_parent             # <<<<<<<<<<<<<<
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index
  */
-        __Pyx_TraceLine(4837,0,__PYX_ERR(0, 4837, __pyx_L1_error))
+        __Pyx_TraceLine(4832,0,__PYX_ERR(0, 4832, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4837, __pyx_L1_error)
+          __PYX_ERR(0, 4832, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-        /* "discretize/_extensions/tree_ext.pyx":4838
+        /* "discretize/_extensions/tree_ext.pyx":4833
  *                              next_cell.location[0] - cell.location[0])
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent             # <<<<<<<<<<<<<<
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  */
-        __Pyx_TraceLine(4838,0,__PYX_ERR(0, 4838, __pyx_L1_error))
+        __Pyx_TraceLine(4833,0,__PYX_ERR(0, 4833, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4838, __pyx_L1_error)
+          __PYX_ERR(0, 4833, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-        /* "discretize/_extensions/tree_ext.pyx":4839
+        /* "discretize/_extensions/tree_ext.pyx":4834
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent
  */
-        __Pyx_TraceLine(4839,0,__PYX_ERR(0, 4839, __pyx_L1_error))
+        __Pyx_TraceLine(4834,0,__PYX_ERR(0, 4834, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_cell->index;
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4839, __pyx_L1_error)
+          __PYX_ERR(0, 4834, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4840
+        /* "discretize/_extensions/tree_ext.pyx":4835
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index             # <<<<<<<<<<<<<<
  *                     V[2*ind  ] = w/children_per_parent
  *                     V[2*ind+1] = (1.0-w)/children_per_parent
  */
-        __Pyx_TraceLine(4840,0,__PYX_ERR(0, 4840, __pyx_L1_error))
+        __Pyx_TraceLine(4835,0,__PYX_ERR(0, 4835, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_next_cell->index;
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4840, __pyx_L1_error)
+          __PYX_ERR(0, 4835, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4841
+        /* "discretize/_extensions/tree_ext.pyx":4836
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent             # <<<<<<<<<<<<<<
  *                     V[2*ind+1] = (1.0-w)/children_per_parent
  *             else:
  */
-        __Pyx_TraceLine(4841,0,__PYX_ERR(0, 4841, __pyx_L1_error))
+        __Pyx_TraceLine(4836,0,__PYX_ERR(0, 4836, __pyx_L1_error))
         if (unlikely(__pyx_v_children_per_parent == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 4841, __pyx_L1_error)
+          __PYX_ERR(0, 4836, __pyx_L1_error)
         }
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4841, __pyx_L1_error)
+          __PYX_ERR(0, 4836, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_v_w / ((double)__pyx_v_children_per_parent));
 
-        /* "discretize/_extensions/tree_ext.pyx":4842
+        /* "discretize/_extensions/tree_ext.pyx":4837
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent
  *                     V[2*ind+1] = (1.0-w)/children_per_parent             # <<<<<<<<<<<<<<
  *             else:
  *                 #should mean next cell is not a leaf so need to loop over children
  */
-        __Pyx_TraceLine(4842,0,__PYX_ERR(0, 4842, __pyx_L1_error))
+        __Pyx_TraceLine(4837,0,__PYX_ERR(0, 4837, __pyx_L1_error))
         __pyx_t_17 = (1.0 - __pyx_v_w);
         if (unlikely(__pyx_v_children_per_parent == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 4842, __pyx_L1_error)
+          __PYX_ERR(0, 4837, __pyx_L1_error)
         }
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4842, __pyx_L1_error)
+          __PYX_ERR(0, 4837, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_t_17 / ((double)__pyx_v_children_per_parent));
       }
       __pyx_L11:;
 
-      /* "discretize/_extensions/tree_ext.pyx":4808
+      /* "discretize/_extensions/tree_ext.pyx":4803
  *                 V[2*ind  ] = 1.0
  * 
  *             if next_cell.is_leaf():             # <<<<<<<<<<<<<<
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  */
       goto __pyx_L10;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4845
+    /* "discretize/_extensions/tree_ext.pyx":4840
  *             else:
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind_parent = cell.edges[3].index
  *                     w = (next_cell.children[0].location[0] - cell.edges[3].location[0])/(
  */
-    __Pyx_TraceLine(4845,0,__PYX_ERR(0, 4845, __pyx_L1_error))
+    __Pyx_TraceLine(4840,0,__PYX_ERR(0, 4840, __pyx_L1_error))
     /*else*/ {
       __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
       if (__pyx_t_2) {
 
-        /* "discretize/_extensions/tree_ext.pyx":4846
+        /* "discretize/_extensions/tree_ext.pyx":4841
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 if dim == 2:
  *                     ind_parent = cell.edges[3].index             # <<<<<<<<<<<<<<
  *                     w = (next_cell.children[0].location[0] - cell.edges[3].location[0])/(
  *                          next_cell.children[0].location[0] - cell.location[0])
  */
-        __Pyx_TraceLine(4846,0,__PYX_ERR(0, 4846, __pyx_L1_error))
+        __Pyx_TraceLine(4841,0,__PYX_ERR(0, 4841, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_cell->edges[3])->index;
         __pyx_v_ind_parent = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":4847
+        /* "discretize/_extensions/tree_ext.pyx":4842
  *                 if dim == 2:
  *                     ind_parent = cell.edges[3].index
  *                     w = (next_cell.children[0].location[0] - cell.edges[3].location[0])/(             # <<<<<<<<<<<<<<
  *                          next_cell.children[0].location[0] - cell.location[0])
  *                     for i in range(2):
  */
-        __Pyx_TraceLine(4847,0,__PYX_ERR(0, 4847, __pyx_L1_error))
+        __Pyx_TraceLine(4842,0,__PYX_ERR(0, 4842, __pyx_L1_error))
         __pyx_t_17 = (((__pyx_v_next_cell->children[0])->location[0]) - ((__pyx_v_cell->edges[3])->location[0]));
 
-        /* "discretize/_extensions/tree_ext.pyx":4848
+        /* "discretize/_extensions/tree_ext.pyx":4843
  *                     ind_parent = cell.edges[3].index
  *                     w = (next_cell.children[0].location[0] - cell.edges[3].location[0])/(
  *                          next_cell.children[0].location[0] - cell.location[0])             # <<<<<<<<<<<<<<
  *                     for i in range(2):
  *                         child = next_cell.children[2*i]
  */
-        __Pyx_TraceLine(4848,0,__PYX_ERR(0, 4848, __pyx_L1_error))
+        __Pyx_TraceLine(4843,0,__PYX_ERR(0, 4843, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_next_cell->children[0])->location[0]) - (__pyx_v_cell->location[0]));
 
-        /* "discretize/_extensions/tree_ext.pyx":4847
+        /* "discretize/_extensions/tree_ext.pyx":4842
  *                 if dim == 2:
  *                     ind_parent = cell.edges[3].index
  *                     w = (next_cell.children[0].location[0] - cell.edges[3].location[0])/(             # <<<<<<<<<<<<<<
  *                          next_cell.children[0].location[0] - cell.location[0])
  *                     for i in range(2):
  */
-        __Pyx_TraceLine(4847,0,__PYX_ERR(0, 4847, __pyx_L1_error))
+        __Pyx_TraceLine(4842,0,__PYX_ERR(0, 4842, __pyx_L1_error))
         if (unlikely(__pyx_t_18 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 4847, __pyx_L1_error)
+          __PYX_ERR(0, 4842, __pyx_L1_error)
         }
         __pyx_v_w = (__pyx_t_17 / __pyx_t_18);
 
-        /* "discretize/_extensions/tree_ext.pyx":4849
+        /* "discretize/_extensions/tree_ext.pyx":4844
  *                     w = (next_cell.children[0].location[0] - cell.edges[3].location[0])/(
  *                          next_cell.children[0].location[0] - cell.location[0])
  *                     for i in range(2):             # <<<<<<<<<<<<<<
  *                         child = next_cell.children[2*i]
  *                         ind = child.edges[2].index
  */
-        __Pyx_TraceLine(4849,0,__PYX_ERR(0, 4849, __pyx_L1_error))
+        __Pyx_TraceLine(4844,0,__PYX_ERR(0, 4844, __pyx_L1_error))
         for (__pyx_t_19 = 0; __pyx_t_19 < 2; __pyx_t_19+=1) {
-          __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_19); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4849, __pyx_L1_error)
+          __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_19); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4844, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_4);
           __pyx_t_4 = 0;
 
-          /* "discretize/_extensions/tree_ext.pyx":4850
+          /* "discretize/_extensions/tree_ext.pyx":4845
  *                          next_cell.children[0].location[0] - cell.location[0])
  *                     for i in range(2):
  *                         child = next_cell.children[2*i]             # <<<<<<<<<<<<<<
  *                         ind = child.edges[2].index
  *                         I[2*ind    ] = ind_parent
  */
-          __Pyx_TraceLine(4850,0,__PYX_ERR(0, 4850, __pyx_L1_error))
-          __pyx_t_4 = PyNumber_Multiply(__pyx_int_2, __pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4850, __pyx_L1_error)
+          __Pyx_TraceLine(4845,0,__PYX_ERR(0, 4845, __pyx_L1_error))
+          __pyx_t_4 = PyNumber_Multiply(__pyx_int_2, __pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4845, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_20 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_20 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 4850, __pyx_L1_error)
+          __pyx_t_20 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_20 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 4845, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_v_child = (__pyx_v_next_cell->children[__pyx_t_20]);
 
-          /* "discretize/_extensions/tree_ext.pyx":4851
+          /* "discretize/_extensions/tree_ext.pyx":4846
  *                     for i in range(2):
  *                         child = next_cell.children[2*i]
  *                         ind = child.edges[2].index             # <<<<<<<<<<<<<<
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent
  */
-          __Pyx_TraceLine(4851,0,__PYX_ERR(0, 4851, __pyx_L1_error))
+          __Pyx_TraceLine(4846,0,__PYX_ERR(0, 4846, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_child->edges[2])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4852
+          /* "discretize/_extensions/tree_ext.pyx":4847
  *                         child = next_cell.children[2*i]
  *                         ind = child.edges[2].index
  *                         I[2*ind    ] = ind_parent             # <<<<<<<<<<<<<<
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index
  */
-          __Pyx_TraceLine(4852,0,__PYX_ERR(0, 4852, __pyx_L1_error))
+          __Pyx_TraceLine(4847,0,__PYX_ERR(0, 4847, __pyx_L1_error))
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_I.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4852, __pyx_L1_error)
+            __PYX_ERR(0, 4847, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-          /* "discretize/_extensions/tree_ext.pyx":4853
+          /* "discretize/_extensions/tree_ext.pyx":4848
  *                         ind = child.edges[2].index
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent             # <<<<<<<<<<<<<<
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index
  */
-          __Pyx_TraceLine(4853,0,__PYX_ERR(0, 4853, __pyx_L1_error))
+          __Pyx_TraceLine(4848,0,__PYX_ERR(0, 4848, __pyx_L1_error))
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_I.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4853, __pyx_L1_error)
+            __PYX_ERR(0, 4848, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-          /* "discretize/_extensions/tree_ext.pyx":4854
+          /* "discretize/_extensions/tree_ext.pyx":4849
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index             # <<<<<<<<<<<<<<
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent
  */
-          __Pyx_TraceLine(4854,0,__PYX_ERR(0, 4854, __pyx_L1_error))
+          __Pyx_TraceLine(4849,0,__PYX_ERR(0, 4849, __pyx_L1_error))
           __pyx_t_16 = __pyx_v_cell->index;
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4854, __pyx_L1_error)
+            __PYX_ERR(0, 4849, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-          /* "discretize/_extensions/tree_ext.pyx":4855
+          /* "discretize/_extensions/tree_ext.pyx":4850
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index             # <<<<<<<<<<<<<<
  *                         V[2*ind    ] = w/children_per_parent
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  */
-          __Pyx_TraceLine(4855,0,__PYX_ERR(0, 4855, __pyx_L1_error))
+          __Pyx_TraceLine(4850,0,__PYX_ERR(0, 4850, __pyx_L1_error))
           __pyx_t_16 = __pyx_v_child->index;
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4855, __pyx_L1_error)
+            __PYX_ERR(0, 4850, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-          /* "discretize/_extensions/tree_ext.pyx":4856
+          /* "discretize/_extensions/tree_ext.pyx":4851
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent             # <<<<<<<<<<<<<<
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  *                 else:
  */
-          __Pyx_TraceLine(4856,0,__PYX_ERR(0, 4856, __pyx_L1_error))
+          __Pyx_TraceLine(4851,0,__PYX_ERR(0, 4851, __pyx_L1_error))
           if (unlikely(__pyx_v_children_per_parent == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4856, __pyx_L1_error)
+            __PYX_ERR(0, 4851, __pyx_L1_error)
           }
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4856, __pyx_L1_error)
+            __PYX_ERR(0, 4851, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_v_w / ((double)__pyx_v_children_per_parent));
 
-          /* "discretize/_extensions/tree_ext.pyx":4857
+          /* "discretize/_extensions/tree_ext.pyx":4852
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent             # <<<<<<<<<<<<<<
  *                 else:
  *                     ind_parent = cell.faces[1].index
  */
-          __Pyx_TraceLine(4857,0,__PYX_ERR(0, 4857, __pyx_L1_error))
+          __Pyx_TraceLine(4852,0,__PYX_ERR(0, 4852, __pyx_L1_error))
           __pyx_t_18 = (1.0 - __pyx_v_w);
           if (unlikely(__pyx_v_children_per_parent == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4857, __pyx_L1_error)
+            __PYX_ERR(0, 4852, __pyx_L1_error)
           }
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4857, __pyx_L1_error)
+            __PYX_ERR(0, 4852, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_t_18 / ((double)__pyx_v_children_per_parent));
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":4845
+        /* "discretize/_extensions/tree_ext.pyx":4840
  *             else:
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind_parent = cell.edges[3].index
  *                     w = (next_cell.children[0].location[0] - cell.edges[3].location[0])/(
  */
         goto __pyx_L14;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4859
+      /* "discretize/_extensions/tree_ext.pyx":4854
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  *                 else:
  *                     ind_parent = cell.faces[1].index             # <<<<<<<<<<<<<<
  *                     w = (next_cell.children[0].location[0] - cell.faces[1].location[0])/(
  *                          next_cell.children[0].location[0] - cell.location[0])
  */
-      __Pyx_TraceLine(4859,0,__PYX_ERR(0, 4859, __pyx_L1_error))
+      __Pyx_TraceLine(4854,0,__PYX_ERR(0, 4854, __pyx_L1_error))
       /*else*/ {
         __pyx_t_10 = (__pyx_v_cell->faces[1])->index;
         __pyx_v_ind_parent = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":4860
+        /* "discretize/_extensions/tree_ext.pyx":4855
  *                 else:
  *                     ind_parent = cell.faces[1].index
  *                     w = (next_cell.children[0].location[0] - cell.faces[1].location[0])/(             # <<<<<<<<<<<<<<
  *                          next_cell.children[0].location[0] - cell.location[0])
  *                     for i in range(4): # four neighbors in +x direction
  */
-        __Pyx_TraceLine(4860,0,__PYX_ERR(0, 4860, __pyx_L1_error))
+        __Pyx_TraceLine(4855,0,__PYX_ERR(0, 4855, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_next_cell->children[0])->location[0]) - ((__pyx_v_cell->faces[1])->location[0]));
 
-        /* "discretize/_extensions/tree_ext.pyx":4861
+        /* "discretize/_extensions/tree_ext.pyx":4856
  *                     ind_parent = cell.faces[1].index
  *                     w = (next_cell.children[0].location[0] - cell.faces[1].location[0])/(
  *                          next_cell.children[0].location[0] - cell.location[0])             # <<<<<<<<<<<<<<
  *                     for i in range(4): # four neighbors in +x direction
  *                         child = next_cell.children[2*i] #0 2 4 6
  */
-        __Pyx_TraceLine(4861,0,__PYX_ERR(0, 4861, __pyx_L1_error))
+        __Pyx_TraceLine(4856,0,__PYX_ERR(0, 4856, __pyx_L1_error))
         __pyx_t_17 = (((__pyx_v_next_cell->children[0])->location[0]) - (__pyx_v_cell->location[0]));
 
-        /* "discretize/_extensions/tree_ext.pyx":4860
+        /* "discretize/_extensions/tree_ext.pyx":4855
  *                 else:
  *                     ind_parent = cell.faces[1].index
  *                     w = (next_cell.children[0].location[0] - cell.faces[1].location[0])/(             # <<<<<<<<<<<<<<
  *                          next_cell.children[0].location[0] - cell.location[0])
  *                     for i in range(4): # four neighbors in +x direction
  */
-        __Pyx_TraceLine(4860,0,__PYX_ERR(0, 4860, __pyx_L1_error))
+        __Pyx_TraceLine(4855,0,__PYX_ERR(0, 4855, __pyx_L1_error))
         if (unlikely(__pyx_t_17 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 4860, __pyx_L1_error)
+          __PYX_ERR(0, 4855, __pyx_L1_error)
         }
         __pyx_v_w = (__pyx_t_18 / __pyx_t_17);
 
-        /* "discretize/_extensions/tree_ext.pyx":4862
+        /* "discretize/_extensions/tree_ext.pyx":4857
  *                     w = (next_cell.children[0].location[0] - cell.faces[1].location[0])/(
  *                          next_cell.children[0].location[0] - cell.location[0])
  *                     for i in range(4): # four neighbors in +x direction             # <<<<<<<<<<<<<<
  *                         child = next_cell.children[2*i] #0 2 4 6
  *                         ind = child.faces[0].index
  */
-        __Pyx_TraceLine(4862,0,__PYX_ERR(0, 4862, __pyx_L1_error))
+        __Pyx_TraceLine(4857,0,__PYX_ERR(0, 4857, __pyx_L1_error))
         for (__pyx_t_19 = 0; __pyx_t_19 < 4; __pyx_t_19+=1) {
-          __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_19); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4862, __pyx_L1_error)
+          __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_19); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4857, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_4);
           __pyx_t_4 = 0;
 
-          /* "discretize/_extensions/tree_ext.pyx":4863
+          /* "discretize/_extensions/tree_ext.pyx":4858
  *                          next_cell.children[0].location[0] - cell.location[0])
  *                     for i in range(4): # four neighbors in +x direction
  *                         child = next_cell.children[2*i] #0 2 4 6             # <<<<<<<<<<<<<<
  *                         ind = child.faces[0].index
  *                         I[2*ind    ] = ind_parent
  */
-          __Pyx_TraceLine(4863,0,__PYX_ERR(0, 4863, __pyx_L1_error))
-          __pyx_t_4 = PyNumber_Multiply(__pyx_int_2, __pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4863, __pyx_L1_error)
+          __Pyx_TraceLine(4858,0,__PYX_ERR(0, 4858, __pyx_L1_error))
+          __pyx_t_4 = PyNumber_Multiply(__pyx_int_2, __pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4858, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_20 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_20 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 4863, __pyx_L1_error)
+          __pyx_t_20 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_20 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 4858, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
           __pyx_v_child = (__pyx_v_next_cell->children[__pyx_t_20]);
 
-          /* "discretize/_extensions/tree_ext.pyx":4864
+          /* "discretize/_extensions/tree_ext.pyx":4859
  *                     for i in range(4): # four neighbors in +x direction
  *                         child = next_cell.children[2*i] #0 2 4 6
  *                         ind = child.faces[0].index             # <<<<<<<<<<<<<<
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent
  */
-          __Pyx_TraceLine(4864,0,__PYX_ERR(0, 4864, __pyx_L1_error))
+          __Pyx_TraceLine(4859,0,__PYX_ERR(0, 4859, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_child->faces[0])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4865
+          /* "discretize/_extensions/tree_ext.pyx":4860
  *                         child = next_cell.children[2*i] #0 2 4 6
  *                         ind = child.faces[0].index
  *                         I[2*ind    ] = ind_parent             # <<<<<<<<<<<<<<
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index
  */
-          __Pyx_TraceLine(4865,0,__PYX_ERR(0, 4865, __pyx_L1_error))
+          __Pyx_TraceLine(4860,0,__PYX_ERR(0, 4860, __pyx_L1_error))
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_I.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4865, __pyx_L1_error)
+            __PYX_ERR(0, 4860, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-          /* "discretize/_extensions/tree_ext.pyx":4866
+          /* "discretize/_extensions/tree_ext.pyx":4861
  *                         ind = child.faces[0].index
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent             # <<<<<<<<<<<<<<
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index
  */
-          __Pyx_TraceLine(4866,0,__PYX_ERR(0, 4866, __pyx_L1_error))
+          __Pyx_TraceLine(4861,0,__PYX_ERR(0, 4861, __pyx_L1_error))
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_I.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4866, __pyx_L1_error)
+            __PYX_ERR(0, 4861, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-          /* "discretize/_extensions/tree_ext.pyx":4867
+          /* "discretize/_extensions/tree_ext.pyx":4862
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index             # <<<<<<<<<<<<<<
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent
  */
-          __Pyx_TraceLine(4867,0,__PYX_ERR(0, 4867, __pyx_L1_error))
+          __Pyx_TraceLine(4862,0,__PYX_ERR(0, 4862, __pyx_L1_error))
           __pyx_t_16 = __pyx_v_cell->index;
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4867, __pyx_L1_error)
+            __PYX_ERR(0, 4862, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-          /* "discretize/_extensions/tree_ext.pyx":4868
+          /* "discretize/_extensions/tree_ext.pyx":4863
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index             # <<<<<<<<<<<<<<
  *                         V[2*ind    ] = w/children_per_parent
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  */
-          __Pyx_TraceLine(4868,0,__PYX_ERR(0, 4868, __pyx_L1_error))
+          __Pyx_TraceLine(4863,0,__PYX_ERR(0, 4863, __pyx_L1_error))
           __pyx_t_16 = __pyx_v_child->index;
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4868, __pyx_L1_error)
+            __PYX_ERR(0, 4863, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-          /* "discretize/_extensions/tree_ext.pyx":4869
+          /* "discretize/_extensions/tree_ext.pyx":4864
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent             # <<<<<<<<<<<<<<
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  * 
  */
-          __Pyx_TraceLine(4869,0,__PYX_ERR(0, 4869, __pyx_L1_error))
+          __Pyx_TraceLine(4864,0,__PYX_ERR(0, 4864, __pyx_L1_error))
           if (unlikely(__pyx_v_children_per_parent == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4869, __pyx_L1_error)
+            __PYX_ERR(0, 4864, __pyx_L1_error)
           }
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4869, __pyx_L1_error)
+            __PYX_ERR(0, 4864, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_v_w / ((double)__pyx_v_children_per_parent));
 
-          /* "discretize/_extensions/tree_ext.pyx":4870
+          /* "discretize/_extensions/tree_ext.pyx":4865
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent             # <<<<<<<<<<<<<<
  * 
  *         self._average_cell_to_face_x = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_x, self.n_cells))
  */
-          __Pyx_TraceLine(4870,0,__PYX_ERR(0, 4870, __pyx_L1_error))
+          __Pyx_TraceLine(4865,0,__PYX_ERR(0, 4865, __pyx_L1_error))
           __pyx_t_17 = (1.0 - __pyx_v_w);
           if (unlikely(__pyx_v_children_per_parent == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4870, __pyx_L1_error)
+            __PYX_ERR(0, 4865, __pyx_L1_error)
           }
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4870, __pyx_L1_error)
+            __PYX_ERR(0, 4865, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_t_17 / ((double)__pyx_v_children_per_parent));
         }
       }
       __pyx_L14:;
     }
     __pyx_L10:;
 
-    /* "discretize/_extensions/tree_ext.pyx":4786
+    /* "discretize/_extensions/tree_ext.pyx":4781
  *         cdef double w
  * 
  *         for cell in self.tree.cells :             # <<<<<<<<<<<<<<
  *             next_cell = cell.neighbors[1]
  *             prev_cell = cell.neighbors[0]
  */
-    __Pyx_TraceLine(4786,0,__PYX_ERR(0, 4786, __pyx_L1_error))
+    __Pyx_TraceLine(4781,0,__PYX_ERR(0, 4781, __pyx_L1_error))
     __pyx_L4_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4872
+  /* "discretize/_extensions/tree_ext.pyx":4867
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  * 
  *         self._average_cell_to_face_x = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_x, self.n_cells))             # <<<<<<<<<<<<<<
  *         return self._average_cell_to_face_x
  * 
  */
-  __Pyx_TraceLine(4872,0,__PYX_ERR(0, 4872, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __Pyx_TraceLine(4867,0,__PYX_ERR(0, 4867, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
   __pyx_t_6 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_5);
   __pyx_t_4 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_21 = PyTuple_New(2); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_21 = PyTuple_New(2); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_21);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_21, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_21, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_21) < 0) __PYX_ERR(0, 4872, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_21) < 0) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
-  __pyx_t_21 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 4872, __pyx_L1_error)
+  __pyx_t_21 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 4867, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_21);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_GIVEREF(__pyx_t_21);
   __Pyx_GOTREF(__pyx_v_self->_average_cell_to_face_x);
   __Pyx_DECREF(__pyx_v_self->_average_cell_to_face_x);
   __pyx_v_self->_average_cell_to_face_x = __pyx_t_21;
   __pyx_t_21 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4873
+  /* "discretize/_extensions/tree_ext.pyx":4868
  * 
  *         self._average_cell_to_face_x = sp.csr_matrix((V, (I, J)), shape=(self.n_faces_x, self.n_cells))
  *         return self._average_cell_to_face_x             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4873,0,__PYX_ERR(0, 4873, __pyx_L1_error))
+  __Pyx_TraceLine(4868,0,__PYX_ERR(0, 4868, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_cell_to_face_x);
   __pyx_r = __pyx_v_self->_average_cell_to_face_x;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4760
+  /* "discretize/_extensions/tree_ext.pyx":4755
  * 
  *     @property
  *     def average_cell_to_face_x(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from cell centers to x faces (scalar quantities).
  * 
  */
 
@@ -56338,15 +56350,15 @@
   __Pyx_XDECREF(__pyx_v_i);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4876
+/* "discretize/_extensions/tree_ext.pyx":4871
  * 
  *     @property
  *     def average_cell_to_face_y(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from cell centers to y faces (scalar quantities).
  * 
  */
 
@@ -56401,1605 +56413,1605 @@
   long __pyx_t_19;
   Py_ssize_t __pyx_t_20;
   PyObject *__pyx_t_21 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4876, 0, __PYX_ERR(0, 4876, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4871, 0, __PYX_ERR(0, 4871, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":4889
+  /* "discretize/_extensions/tree_ext.pyx":4884
  *             The scalar averaging operator from cell centers to y faces
  *         """
  *         if self._average_cell_to_face_y is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_to_face_y
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  */
-  __Pyx_TraceLine(4889,0,__PYX_ERR(0, 4889, __pyx_L1_error))
+  __Pyx_TraceLine(4884,0,__PYX_ERR(0, 4884, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->_average_cell_to_face_y != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":4890
+    /* "discretize/_extensions/tree_ext.pyx":4885
  *         """
  *         if self._average_cell_to_face_y is not None:
  *             return self._average_cell_to_face_y             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  */
-    __Pyx_TraceLine(4890,0,__PYX_ERR(0, 4890, __pyx_L1_error))
+    __Pyx_TraceLine(4885,0,__PYX_ERR(0, 4885, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_cell_to_face_y);
     __pyx_r = __pyx_v_self->_average_cell_to_face_y;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":4889
+    /* "discretize/_extensions/tree_ext.pyx":4884
  *             The scalar averaging operator from cell centers to y faces
  *         """
  *         if self._average_cell_to_face_y is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_to_face_y
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4891
+  /* "discretize/_extensions/tree_ext.pyx":4886
  *         if self._average_cell_to_face_y is not None:
  *             return self._average_cell_to_face_y
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_y, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_y, dtype=np.float64)
  */
-  __Pyx_TraceLine(4891,0,__PYX_ERR(0, 4891, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __Pyx_TraceLine(4886,0,__PYX_ERR(0, 4886, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_int_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_int_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4891, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4891, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4886, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4892
+  /* "discretize/_extensions/tree_ext.pyx":4887
  *             return self._average_cell_to_face_y
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_y, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_y, dtype=np.float64)
  *         cdef int dim = self._dim
  */
-  __Pyx_TraceLine(4892,0,__PYX_ERR(0, 4892, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __Pyx_TraceLine(4887,0,__PYX_ERR(0, 4887, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = PyNumber_Multiply(__pyx_int_2, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_int_2, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4892, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4892, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 4887, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4893
+  /* "discretize/_extensions/tree_ext.pyx":4888
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_y, dtype=np.float64)             # <<<<<<<<<<<<<<
  *         cdef int dim = self._dim
  *         cdef int_t ind, ind_parent
  */
-  __Pyx_TraceLine(4893,0,__PYX_ERR(0, 4893, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __Pyx_TraceLine(4888,0,__PYX_ERR(0, 4888, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_int_2, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_int_2, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4893, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4893, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 4888, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":4894
+  /* "discretize/_extensions/tree_ext.pyx":4889
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_y, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_y, dtype=np.float64)
  *         cdef int dim = self._dim             # <<<<<<<<<<<<<<
  *         cdef int_t ind, ind_parent
  *         cdef int_t children_per_parent = (dim-1)*2
  */
-  __Pyx_TraceLine(4894,0,__PYX_ERR(0, 4894, __pyx_L1_error))
+  __Pyx_TraceLine(4889,0,__PYX_ERR(0, 4889, __pyx_L1_error))
   __pyx_t_10 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_10;
 
-  /* "discretize/_extensions/tree_ext.pyx":4896
+  /* "discretize/_extensions/tree_ext.pyx":4891
  *         cdef int dim = self._dim
  *         cdef int_t ind, ind_parent
  *         cdef int_t children_per_parent = (dim-1)*2             # <<<<<<<<<<<<<<
  *         cdef c_Cell* child
  *         cdef c_Cell* next_cell
  */
-  __Pyx_TraceLine(4896,0,__PYX_ERR(0, 4896, __pyx_L1_error))
+  __Pyx_TraceLine(4891,0,__PYX_ERR(0, 4891, __pyx_L1_error))
   __pyx_v_children_per_parent = ((__pyx_v_dim - 1) * 2);
 
-  /* "discretize/_extensions/tree_ext.pyx":4902
+  /* "discretize/_extensions/tree_ext.pyx":4897
  *         cdef double w
  * 
  *         for cell in self.tree.cells :             # <<<<<<<<<<<<<<
  *             next_cell = cell.neighbors[3]
  *             prev_cell = cell.neighbors[2]
  */
-  __Pyx_TraceLine(4902,0,__PYX_ERR(0, 4902, __pyx_L1_error))
+  __Pyx_TraceLine(4897,0,__PYX_ERR(0, 4897, __pyx_L1_error))
   __pyx_t_12 = &__pyx_v_self->tree->cells;
   __pyx_t_11 = __pyx_t_12->begin();
   for (;;) {
     if (!(__pyx_t_11 != __pyx_t_12->end())) break;
     __pyx_t_13 = *__pyx_t_11;
     ++__pyx_t_11;
     __pyx_v_cell = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":4903
+    /* "discretize/_extensions/tree_ext.pyx":4898
  * 
  *         for cell in self.tree.cells :
  *             next_cell = cell.neighbors[3]             # <<<<<<<<<<<<<<
  *             prev_cell = cell.neighbors[2]
  *             # handle extrapolation to boundary faces
  */
-    __Pyx_TraceLine(4903,0,__PYX_ERR(0, 4903, __pyx_L1_error))
+    __Pyx_TraceLine(4898,0,__PYX_ERR(0, 4898, __pyx_L1_error))
     __pyx_v_next_cell = (__pyx_v_cell->neighbors[3]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4904
+    /* "discretize/_extensions/tree_ext.pyx":4899
  *         for cell in self.tree.cells :
  *             next_cell = cell.neighbors[3]
  *             prev_cell = cell.neighbors[2]             # <<<<<<<<<<<<<<
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:
  */
-    __Pyx_TraceLine(4904,0,__PYX_ERR(0, 4904, __pyx_L1_error))
+    __Pyx_TraceLine(4899,0,__PYX_ERR(0, 4899, __pyx_L1_error))
     __pyx_v_prev_cell = (__pyx_v_cell->neighbors[2]);
 
-    /* "discretize/_extensions/tree_ext.pyx":4906
+    /* "discretize/_extensions/tree_ext.pyx":4901
  *             prev_cell = cell.neighbors[2]
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:             # <<<<<<<<<<<<<<
  *                 if dim == 2:
  *                     ind = cell.edges[1].index
  */
-    __Pyx_TraceLine(4906,0,__PYX_ERR(0, 4906, __pyx_L1_error))
+    __Pyx_TraceLine(4901,0,__PYX_ERR(0, 4901, __pyx_L1_error))
     __pyx_t_2 = ((__pyx_v_next_cell == NULL) != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4907
+      /* "discretize/_extensions/tree_ext.pyx":4902
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind = cell.edges[1].index
  *                 else:
  */
-      __Pyx_TraceLine(4907,0,__PYX_ERR(0, 4907, __pyx_L1_error))
+      __Pyx_TraceLine(4902,0,__PYX_ERR(0, 4902, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
       if (__pyx_t_2) {
 
-        /* "discretize/_extensions/tree_ext.pyx":4908
+        /* "discretize/_extensions/tree_ext.pyx":4903
  *             if next_cell == NULL:
  *                 if dim == 2:
  *                     ind = cell.edges[1].index             # <<<<<<<<<<<<<<
  *                 else:
  *                     ind = cell.faces[3].index
  */
-        __Pyx_TraceLine(4908,0,__PYX_ERR(0, 4908, __pyx_L1_error))
+        __Pyx_TraceLine(4903,0,__PYX_ERR(0, 4903, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_cell->edges[1])->index;
         __pyx_v_ind = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":4907
+        /* "discretize/_extensions/tree_ext.pyx":4902
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind = cell.edges[1].index
  *                 else:
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4910
+      /* "discretize/_extensions/tree_ext.pyx":4905
  *                     ind = cell.edges[1].index
  *                 else:
  *                     ind = cell.faces[3].index             # <<<<<<<<<<<<<<
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  */
-      __Pyx_TraceLine(4910,0,__PYX_ERR(0, 4910, __pyx_L1_error))
+      __Pyx_TraceLine(4905,0,__PYX_ERR(0, 4905, __pyx_L1_error))
       /*else*/ {
         __pyx_t_10 = (__pyx_v_cell->faces[3])->index;
         __pyx_v_ind = __pyx_t_10;
       }
       __pyx_L7:;
 
-      /* "discretize/_extensions/tree_ext.pyx":4911
+      /* "discretize/_extensions/tree_ext.pyx":4906
  *                 else:
  *                     ind = cell.faces[3].index
  *                 I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  */
-      __Pyx_TraceLine(4911,0,__PYX_ERR(0, 4911, __pyx_L1_error))
+      __Pyx_TraceLine(4906,0,__PYX_ERR(0, 4906, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4911, __pyx_L1_error)
+        __PYX_ERR(0, 4906, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-      /* "discretize/_extensions/tree_ext.pyx":4912
+      /* "discretize/_extensions/tree_ext.pyx":4907
  *                     ind = cell.faces[3].index
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                 V[2*ind  ] = 1.0
  *                 continue
  */
-      __Pyx_TraceLine(4912,0,__PYX_ERR(0, 4912, __pyx_L1_error))
+      __Pyx_TraceLine(4907,0,__PYX_ERR(0, 4907, __pyx_L1_error))
       __pyx_t_16 = __pyx_v_cell->index;
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4912, __pyx_L1_error)
+        __PYX_ERR(0, 4907, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-      /* "discretize/_extensions/tree_ext.pyx":4913
+      /* "discretize/_extensions/tree_ext.pyx":4908
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0             # <<<<<<<<<<<<<<
  *                 continue
  *             if prev_cell == NULL:
  */
-      __Pyx_TraceLine(4913,0,__PYX_ERR(0, 4913, __pyx_L1_error))
+      __Pyx_TraceLine(4908,0,__PYX_ERR(0, 4908, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4913, __pyx_L1_error)
+        __PYX_ERR(0, 4908, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = 1.0;
 
-      /* "discretize/_extensions/tree_ext.pyx":4914
+      /* "discretize/_extensions/tree_ext.pyx":4909
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  *                 continue             # <<<<<<<<<<<<<<
  *             if prev_cell == NULL:
  *                 if dim == 2:
  */
-      __Pyx_TraceLine(4914,0,__PYX_ERR(0, 4914, __pyx_L1_error))
+      __Pyx_TraceLine(4909,0,__PYX_ERR(0, 4909, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":4906
+      /* "discretize/_extensions/tree_ext.pyx":4901
  *             prev_cell = cell.neighbors[2]
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:             # <<<<<<<<<<<<<<
  *                 if dim == 2:
  *                     ind = cell.edges[1].index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4915
+    /* "discretize/_extensions/tree_ext.pyx":4910
  *                 V[2*ind  ] = 1.0
  *                 continue
  *             if prev_cell == NULL:             # <<<<<<<<<<<<<<
  *                 if dim == 2:
  *                     ind = cell.edges[0].index
  */
-    __Pyx_TraceLine(4915,0,__PYX_ERR(0, 4915, __pyx_L1_error))
+    __Pyx_TraceLine(4910,0,__PYX_ERR(0, 4910, __pyx_L1_error))
     __pyx_t_2 = ((__pyx_v_prev_cell == NULL) != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4916
+      /* "discretize/_extensions/tree_ext.pyx":4911
  *                 continue
  *             if prev_cell == NULL:
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind = cell.edges[0].index
  *                 else:
  */
-      __Pyx_TraceLine(4916,0,__PYX_ERR(0, 4916, __pyx_L1_error))
+      __Pyx_TraceLine(4911,0,__PYX_ERR(0, 4911, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
       if (__pyx_t_2) {
 
-        /* "discretize/_extensions/tree_ext.pyx":4917
+        /* "discretize/_extensions/tree_ext.pyx":4912
  *             if prev_cell == NULL:
  *                 if dim == 2:
  *                     ind = cell.edges[0].index             # <<<<<<<<<<<<<<
  *                 else:
  *                     ind = cell.faces[2].index
  */
-        __Pyx_TraceLine(4917,0,__PYX_ERR(0, 4917, __pyx_L1_error))
+        __Pyx_TraceLine(4912,0,__PYX_ERR(0, 4912, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_cell->edges[0])->index;
         __pyx_v_ind = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":4916
+        /* "discretize/_extensions/tree_ext.pyx":4911
  *                 continue
  *             if prev_cell == NULL:
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind = cell.edges[0].index
  *                 else:
  */
         goto __pyx_L9;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4919
+      /* "discretize/_extensions/tree_ext.pyx":4914
  *                     ind = cell.edges[0].index
  *                 else:
  *                     ind = cell.faces[2].index             # <<<<<<<<<<<<<<
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  */
-      __Pyx_TraceLine(4919,0,__PYX_ERR(0, 4919, __pyx_L1_error))
+      __Pyx_TraceLine(4914,0,__PYX_ERR(0, 4914, __pyx_L1_error))
       /*else*/ {
         __pyx_t_10 = (__pyx_v_cell->faces[2])->index;
         __pyx_v_ind = __pyx_t_10;
       }
       __pyx_L9:;
 
-      /* "discretize/_extensions/tree_ext.pyx":4920
+      /* "discretize/_extensions/tree_ext.pyx":4915
  *                 else:
  *                     ind = cell.faces[2].index
  *                 I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  */
-      __Pyx_TraceLine(4920,0,__PYX_ERR(0, 4920, __pyx_L1_error))
+      __Pyx_TraceLine(4915,0,__PYX_ERR(0, 4915, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4920, __pyx_L1_error)
+        __PYX_ERR(0, 4915, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-      /* "discretize/_extensions/tree_ext.pyx":4921
+      /* "discretize/_extensions/tree_ext.pyx":4916
  *                     ind = cell.faces[2].index
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                 V[2*ind  ] = 1.0
  * 
  */
-      __Pyx_TraceLine(4921,0,__PYX_ERR(0, 4921, __pyx_L1_error))
+      __Pyx_TraceLine(4916,0,__PYX_ERR(0, 4916, __pyx_L1_error))
       __pyx_t_16 = __pyx_v_cell->index;
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4921, __pyx_L1_error)
+        __PYX_ERR(0, 4916, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-      /* "discretize/_extensions/tree_ext.pyx":4922
+      /* "discretize/_extensions/tree_ext.pyx":4917
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0             # <<<<<<<<<<<<<<
  * 
  *             if next_cell.is_leaf():
  */
-      __Pyx_TraceLine(4922,0,__PYX_ERR(0, 4922, __pyx_L1_error))
+      __Pyx_TraceLine(4917,0,__PYX_ERR(0, 4917, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 4922, __pyx_L1_error)
+        __PYX_ERR(0, 4917, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = 1.0;
 
-      /* "discretize/_extensions/tree_ext.pyx":4915
+      /* "discretize/_extensions/tree_ext.pyx":4910
  *                 V[2*ind  ] = 1.0
  *                 continue
  *             if prev_cell == NULL:             # <<<<<<<<<<<<<<
  *                 if dim == 2:
  *                     ind = cell.edges[0].index
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4924
+    /* "discretize/_extensions/tree_ext.pyx":4919
  *                 V[2*ind  ] = 1.0
  * 
  *             if next_cell.is_leaf():             # <<<<<<<<<<<<<<
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  */
-    __Pyx_TraceLine(4924,0,__PYX_ERR(0, 4924, __pyx_L1_error))
+    __Pyx_TraceLine(4919,0,__PYX_ERR(0, 4919, __pyx_L1_error))
     __pyx_t_2 = (__pyx_v_next_cell->is_leaf() != 0);
     if (__pyx_t_2) {
 
-      /* "discretize/_extensions/tree_ext.pyx":4925
+      /* "discretize/_extensions/tree_ext.pyx":4920
  * 
  *             if next_cell.is_leaf():
  *                 if next_cell.level == cell.level:             # <<<<<<<<<<<<<<
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:
  */
-      __Pyx_TraceLine(4925,0,__PYX_ERR(0, 4925, __pyx_L1_error))
+      __Pyx_TraceLine(4920,0,__PYX_ERR(0, 4920, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_v_next_cell->level == __pyx_v_cell->level) != 0);
       if (__pyx_t_2) {
 
-        /* "discretize/_extensions/tree_ext.pyx":4927
+        /* "discretize/_extensions/tree_ext.pyx":4922
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:             # <<<<<<<<<<<<<<
  *                         ind = cell.edges[1].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(
  */
-        __Pyx_TraceLine(4927,0,__PYX_ERR(0, 4927, __pyx_L1_error))
+        __Pyx_TraceLine(4922,0,__PYX_ERR(0, 4922, __pyx_L1_error))
         __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
         if (__pyx_t_2) {
 
-          /* "discretize/_extensions/tree_ext.pyx":4928
+          /* "discretize/_extensions/tree_ext.pyx":4923
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:
  *                         ind = cell.edges[1].index             # <<<<<<<<<<<<<<
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(
  *                              next_cell.location[1] - cell.location[1])
  */
-          __Pyx_TraceLine(4928,0,__PYX_ERR(0, 4928, __pyx_L1_error))
+          __Pyx_TraceLine(4923,0,__PYX_ERR(0, 4923, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_cell->edges[1])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4929
+          /* "discretize/_extensions/tree_ext.pyx":4924
  *                     if dim == 2:
  *                         ind = cell.edges[1].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[1] - cell.location[1])
  *                     else:
  */
-          __Pyx_TraceLine(4929,0,__PYX_ERR(0, 4929, __pyx_L1_error))
+          __Pyx_TraceLine(4924,0,__PYX_ERR(0, 4924, __pyx_L1_error))
           __pyx_t_17 = ((__pyx_v_next_cell->location[1]) - ((__pyx_v_cell->edges[1])->location[1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4930
+          /* "discretize/_extensions/tree_ext.pyx":4925
  *                         ind = cell.edges[1].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(
  *                              next_cell.location[1] - cell.location[1])             # <<<<<<<<<<<<<<
  *                     else:
  *                         ind = cell.faces[3].index
  */
-          __Pyx_TraceLine(4930,0,__PYX_ERR(0, 4930, __pyx_L1_error))
+          __Pyx_TraceLine(4925,0,__PYX_ERR(0, 4925, __pyx_L1_error))
           __pyx_t_18 = ((__pyx_v_next_cell->location[1]) - (__pyx_v_cell->location[1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4929
+          /* "discretize/_extensions/tree_ext.pyx":4924
  *                     if dim == 2:
  *                         ind = cell.edges[1].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[1] - cell.location[1])
  *                     else:
  */
-          __Pyx_TraceLine(4929,0,__PYX_ERR(0, 4929, __pyx_L1_error))
+          __Pyx_TraceLine(4924,0,__PYX_ERR(0, 4924, __pyx_L1_error))
           if (unlikely(__pyx_t_18 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4929, __pyx_L1_error)
+            __PYX_ERR(0, 4924, __pyx_L1_error)
           }
           __pyx_v_w = (__pyx_t_17 / __pyx_t_18);
 
-          /* "discretize/_extensions/tree_ext.pyx":4927
+          /* "discretize/_extensions/tree_ext.pyx":4922
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:             # <<<<<<<<<<<<<<
  *                         ind = cell.edges[1].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(
  */
           goto __pyx_L12;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":4932
+        /* "discretize/_extensions/tree_ext.pyx":4927
  *                              next_cell.location[1] - cell.location[1])
  *                     else:
  *                         ind = cell.faces[3].index             # <<<<<<<<<<<<<<
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(
  *                              next_cell.location[1] - cell.location[1])
  */
-        __Pyx_TraceLine(4932,0,__PYX_ERR(0, 4932, __pyx_L1_error))
+        __Pyx_TraceLine(4927,0,__PYX_ERR(0, 4927, __pyx_L1_error))
         /*else*/ {
           __pyx_t_10 = (__pyx_v_cell->faces[3])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4933
+          /* "discretize/_extensions/tree_ext.pyx":4928
  *                     else:
  *                         ind = cell.faces[3].index
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[1] - cell.location[1])
  *                     I[2*ind  ] = ind
  */
-          __Pyx_TraceLine(4933,0,__PYX_ERR(0, 4933, __pyx_L1_error))
+          __Pyx_TraceLine(4928,0,__PYX_ERR(0, 4928, __pyx_L1_error))
           __pyx_t_18 = ((__pyx_v_next_cell->location[1]) - ((__pyx_v_cell->faces[3])->location[1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4934
+          /* "discretize/_extensions/tree_ext.pyx":4929
  *                         ind = cell.faces[3].index
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(
  *                              next_cell.location[1] - cell.location[1])             # <<<<<<<<<<<<<<
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind
  */
-          __Pyx_TraceLine(4934,0,__PYX_ERR(0, 4934, __pyx_L1_error))
+          __Pyx_TraceLine(4929,0,__PYX_ERR(0, 4929, __pyx_L1_error))
           __pyx_t_17 = ((__pyx_v_next_cell->location[1]) - (__pyx_v_cell->location[1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4933
+          /* "discretize/_extensions/tree_ext.pyx":4928
  *                     else:
  *                         ind = cell.faces[3].index
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[1] - cell.location[1])
  *                     I[2*ind  ] = ind
  */
-          __Pyx_TraceLine(4933,0,__PYX_ERR(0, 4933, __pyx_L1_error))
+          __Pyx_TraceLine(4928,0,__PYX_ERR(0, 4928, __pyx_L1_error))
           if (unlikely(__pyx_t_17 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4933, __pyx_L1_error)
+            __PYX_ERR(0, 4928, __pyx_L1_error)
           }
           __pyx_v_w = (__pyx_t_18 / __pyx_t_17);
         }
         __pyx_L12:;
 
-        /* "discretize/_extensions/tree_ext.pyx":4935
+        /* "discretize/_extensions/tree_ext.pyx":4930
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(
  *                              next_cell.location[1] - cell.location[1])
  *                     I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index
  */
-        __Pyx_TraceLine(4935,0,__PYX_ERR(0, 4935, __pyx_L1_error))
+        __Pyx_TraceLine(4930,0,__PYX_ERR(0, 4930, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4935, __pyx_L1_error)
+          __PYX_ERR(0, 4930, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-        /* "discretize/_extensions/tree_ext.pyx":4936
+        /* "discretize/_extensions/tree_ext.pyx":4931
  *                              next_cell.location[1] - cell.location[1])
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind             # <<<<<<<<<<<<<<
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  */
-        __Pyx_TraceLine(4936,0,__PYX_ERR(0, 4936, __pyx_L1_error))
+        __Pyx_TraceLine(4931,0,__PYX_ERR(0, 4931, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4936, __pyx_L1_error)
+          __PYX_ERR(0, 4931, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-        /* "discretize/_extensions/tree_ext.pyx":4937
+        /* "discretize/_extensions/tree_ext.pyx":4932
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w
  */
-        __Pyx_TraceLine(4937,0,__PYX_ERR(0, 4937, __pyx_L1_error))
+        __Pyx_TraceLine(4932,0,__PYX_ERR(0, 4932, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_cell->index;
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4937, __pyx_L1_error)
+          __PYX_ERR(0, 4932, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4938
+        /* "discretize/_extensions/tree_ext.pyx":4933
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index             # <<<<<<<<<<<<<<
  *                     V[2*ind  ] = w
  *                     V[2*ind+1] = (1.0-w)
  */
-        __Pyx_TraceLine(4938,0,__PYX_ERR(0, 4938, __pyx_L1_error))
+        __Pyx_TraceLine(4933,0,__PYX_ERR(0, 4933, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_next_cell->index;
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4938, __pyx_L1_error)
+          __PYX_ERR(0, 4933, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4939
+        /* "discretize/_extensions/tree_ext.pyx":4934
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w             # <<<<<<<<<<<<<<
  *                     V[2*ind+1] = (1.0-w)
  *                 else:
  */
-        __Pyx_TraceLine(4939,0,__PYX_ERR(0, 4939, __pyx_L1_error))
+        __Pyx_TraceLine(4934,0,__PYX_ERR(0, 4934, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4939, __pyx_L1_error)
+          __PYX_ERR(0, 4934, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = __pyx_v_w;
 
-        /* "discretize/_extensions/tree_ext.pyx":4940
+        /* "discretize/_extensions/tree_ext.pyx":4935
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w
  *                     V[2*ind+1] = (1.0-w)             # <<<<<<<<<<<<<<
  *                 else:
  *                     # if next cell is a level larger than i am
  */
-        __Pyx_TraceLine(4940,0,__PYX_ERR(0, 4940, __pyx_L1_error))
+        __Pyx_TraceLine(4935,0,__PYX_ERR(0, 4935, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4940, __pyx_L1_error)
+          __PYX_ERR(0, 4935, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (1.0 - __pyx_v_w);
 
-        /* "discretize/_extensions/tree_ext.pyx":4925
+        /* "discretize/_extensions/tree_ext.pyx":4920
  * 
  *             if next_cell.is_leaf():
  *                 if next_cell.level == cell.level:             # <<<<<<<<<<<<<<
  *                     #I am on the same level and easy to interpolate
  *                     if dim == 2:
  */
         goto __pyx_L11;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4943
+      /* "discretize/_extensions/tree_ext.pyx":4938
  *                 else:
  *                     # if next cell is a level larger than i am
  *                     if dim == 2:             # <<<<<<<<<<<<<<
  *                         ind = cell.edges[1].index
  *                         ind_parent = cell.edges[1].parents[0].index
  */
-      __Pyx_TraceLine(4943,0,__PYX_ERR(0, 4943, __pyx_L1_error))
+      __Pyx_TraceLine(4938,0,__PYX_ERR(0, 4938, __pyx_L1_error))
       /*else*/ {
         __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
         if (__pyx_t_2) {
 
-          /* "discretize/_extensions/tree_ext.pyx":4944
+          /* "discretize/_extensions/tree_ext.pyx":4939
  *                     # if next cell is a level larger than i am
  *                     if dim == 2:
  *                         ind = cell.edges[1].index             # <<<<<<<<<<<<<<
  *                         ind_parent = cell.edges[1].parents[0].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(
  */
-          __Pyx_TraceLine(4944,0,__PYX_ERR(0, 4944, __pyx_L1_error))
+          __Pyx_TraceLine(4939,0,__PYX_ERR(0, 4939, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_cell->edges[1])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4945
+          /* "discretize/_extensions/tree_ext.pyx":4940
  *                     if dim == 2:
  *                         ind = cell.edges[1].index
  *                         ind_parent = cell.edges[1].parents[0].index             # <<<<<<<<<<<<<<
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(
  *                              next_cell.location[1] - cell.location[1])
  */
-          __Pyx_TraceLine(4945,0,__PYX_ERR(0, 4945, __pyx_L1_error))
+          __Pyx_TraceLine(4940,0,__PYX_ERR(0, 4940, __pyx_L1_error))
           __pyx_t_10 = ((__pyx_v_cell->edges[1])->parents[0])->index;
           __pyx_v_ind_parent = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4946
+          /* "discretize/_extensions/tree_ext.pyx":4941
  *                         ind = cell.edges[1].index
  *                         ind_parent = cell.edges[1].parents[0].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[1] - cell.location[1])
  *                     else:
  */
-          __Pyx_TraceLine(4946,0,__PYX_ERR(0, 4946, __pyx_L1_error))
+          __Pyx_TraceLine(4941,0,__PYX_ERR(0, 4941, __pyx_L1_error))
           __pyx_t_17 = ((__pyx_v_next_cell->location[1]) - ((__pyx_v_cell->edges[1])->location[1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4947
+          /* "discretize/_extensions/tree_ext.pyx":4942
  *                         ind_parent = cell.edges[1].parents[0].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(
  *                              next_cell.location[1] - cell.location[1])             # <<<<<<<<<<<<<<
  *                     else:
  *                         ind = cell.faces[3].index
  */
-          __Pyx_TraceLine(4947,0,__PYX_ERR(0, 4947, __pyx_L1_error))
+          __Pyx_TraceLine(4942,0,__PYX_ERR(0, 4942, __pyx_L1_error))
           __pyx_t_18 = ((__pyx_v_next_cell->location[1]) - (__pyx_v_cell->location[1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4946
+          /* "discretize/_extensions/tree_ext.pyx":4941
  *                         ind = cell.edges[1].index
  *                         ind_parent = cell.edges[1].parents[0].index
  *                         w = (next_cell.location[1] - cell.edges[1].location[1])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[1] - cell.location[1])
  *                     else:
  */
-          __Pyx_TraceLine(4946,0,__PYX_ERR(0, 4946, __pyx_L1_error))
+          __Pyx_TraceLine(4941,0,__PYX_ERR(0, 4941, __pyx_L1_error))
           if (unlikely(__pyx_t_18 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4946, __pyx_L1_error)
+            __PYX_ERR(0, 4941, __pyx_L1_error)
           }
           __pyx_v_w = (__pyx_t_17 / __pyx_t_18);
 
-          /* "discretize/_extensions/tree_ext.pyx":4943
+          /* "discretize/_extensions/tree_ext.pyx":4938
  *                 else:
  *                     # if next cell is a level larger than i am
  *                     if dim == 2:             # <<<<<<<<<<<<<<
  *                         ind = cell.edges[1].index
  *                         ind_parent = cell.edges[1].parents[0].index
  */
           goto __pyx_L13;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":4949
+        /* "discretize/_extensions/tree_ext.pyx":4944
  *                              next_cell.location[1] - cell.location[1])
  *                     else:
  *                         ind = cell.faces[3].index             # <<<<<<<<<<<<<<
  *                         ind_parent = cell.faces[3].parent.index
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(
  */
-        __Pyx_TraceLine(4949,0,__PYX_ERR(0, 4949, __pyx_L1_error))
+        __Pyx_TraceLine(4944,0,__PYX_ERR(0, 4944, __pyx_L1_error))
         /*else*/ {
           __pyx_t_10 = (__pyx_v_cell->faces[3])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4950
+          /* "discretize/_extensions/tree_ext.pyx":4945
  *                     else:
  *                         ind = cell.faces[3].index
  *                         ind_parent = cell.faces[3].parent.index             # <<<<<<<<<<<<<<
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(
  *                              next_cell.location[1] - cell.location[1])
  */
-          __Pyx_TraceLine(4950,0,__PYX_ERR(0, 4950, __pyx_L1_error))
+          __Pyx_TraceLine(4945,0,__PYX_ERR(0, 4945, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_cell->faces[3])->parent->index;
           __pyx_v_ind_parent = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4951
+          /* "discretize/_extensions/tree_ext.pyx":4946
  *                         ind = cell.faces[3].index
  *                         ind_parent = cell.faces[3].parent.index
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[1] - cell.location[1])
  *                     I[2*ind  ] = ind_parent
  */
-          __Pyx_TraceLine(4951,0,__PYX_ERR(0, 4951, __pyx_L1_error))
+          __Pyx_TraceLine(4946,0,__PYX_ERR(0, 4946, __pyx_L1_error))
           __pyx_t_18 = ((__pyx_v_next_cell->location[1]) - ((__pyx_v_cell->faces[3])->location[1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4952
+          /* "discretize/_extensions/tree_ext.pyx":4947
  *                         ind_parent = cell.faces[3].parent.index
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(
  *                              next_cell.location[1] - cell.location[1])             # <<<<<<<<<<<<<<
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent
  */
-          __Pyx_TraceLine(4952,0,__PYX_ERR(0, 4952, __pyx_L1_error))
+          __Pyx_TraceLine(4947,0,__PYX_ERR(0, 4947, __pyx_L1_error))
           __pyx_t_17 = ((__pyx_v_next_cell->location[1]) - (__pyx_v_cell->location[1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":4951
+          /* "discretize/_extensions/tree_ext.pyx":4946
  *                         ind = cell.faces[3].index
  *                         ind_parent = cell.faces[3].parent.index
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(             # <<<<<<<<<<<<<<
  *                              next_cell.location[1] - cell.location[1])
  *                     I[2*ind  ] = ind_parent
  */
-          __Pyx_TraceLine(4951,0,__PYX_ERR(0, 4951, __pyx_L1_error))
+          __Pyx_TraceLine(4946,0,__PYX_ERR(0, 4946, __pyx_L1_error))
           if (unlikely(__pyx_t_17 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4951, __pyx_L1_error)
+            __PYX_ERR(0, 4946, __pyx_L1_error)
           }
           __pyx_v_w = (__pyx_t_18 / __pyx_t_17);
         }
         __pyx_L13:;
 
-        /* "discretize/_extensions/tree_ext.pyx":4953
+        /* "discretize/_extensions/tree_ext.pyx":4948
  *                         w = (next_cell.location[1] - cell.faces[3].location[1])/(
  *                              next_cell.location[1] - cell.location[1])
  *                     I[2*ind  ] = ind_parent             # <<<<<<<<<<<<<<
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index
  */
-        __Pyx_TraceLine(4953,0,__PYX_ERR(0, 4953, __pyx_L1_error))
+        __Pyx_TraceLine(4948,0,__PYX_ERR(0, 4948, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4953, __pyx_L1_error)
+          __PYX_ERR(0, 4948, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-        /* "discretize/_extensions/tree_ext.pyx":4954
+        /* "discretize/_extensions/tree_ext.pyx":4949
  *                              next_cell.location[1] - cell.location[1])
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent             # <<<<<<<<<<<<<<
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  */
-        __Pyx_TraceLine(4954,0,__PYX_ERR(0, 4954, __pyx_L1_error))
+        __Pyx_TraceLine(4949,0,__PYX_ERR(0, 4949, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4954, __pyx_L1_error)
+          __PYX_ERR(0, 4949, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-        /* "discretize/_extensions/tree_ext.pyx":4955
+        /* "discretize/_extensions/tree_ext.pyx":4950
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent
  */
-        __Pyx_TraceLine(4955,0,__PYX_ERR(0, 4955, __pyx_L1_error))
+        __Pyx_TraceLine(4950,0,__PYX_ERR(0, 4950, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_cell->index;
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4955, __pyx_L1_error)
+          __PYX_ERR(0, 4950, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4956
+        /* "discretize/_extensions/tree_ext.pyx":4951
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index             # <<<<<<<<<<<<<<
  *                     V[2*ind  ] = w/children_per_parent
  *                     V[2*ind+1] = (1.0-w)/children_per_parent
  */
-        __Pyx_TraceLine(4956,0,__PYX_ERR(0, 4956, __pyx_L1_error))
+        __Pyx_TraceLine(4951,0,__PYX_ERR(0, 4951, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_next_cell->index;
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4956, __pyx_L1_error)
+          __PYX_ERR(0, 4951, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":4957
+        /* "discretize/_extensions/tree_ext.pyx":4952
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent             # <<<<<<<<<<<<<<
  *                     V[2*ind+1] = (1.0-w)/children_per_parent
  *             else:
  */
-        __Pyx_TraceLine(4957,0,__PYX_ERR(0, 4957, __pyx_L1_error))
+        __Pyx_TraceLine(4952,0,__PYX_ERR(0, 4952, __pyx_L1_error))
         if (unlikely(__pyx_v_children_per_parent == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 4957, __pyx_L1_error)
+          __PYX_ERR(0, 4952, __pyx_L1_error)
         }
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4957, __pyx_L1_error)
+          __PYX_ERR(0, 4952, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_v_w / ((double)__pyx_v_children_per_parent));
 
-        /* "discretize/_extensions/tree_ext.pyx":4958
+        /* "discretize/_extensions/tree_ext.pyx":4953
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent
  *                     V[2*ind+1] = (1.0-w)/children_per_parent             # <<<<<<<<<<<<<<
  *             else:
  *                 #should mean next cell is not a leaf so need to loop over children
  */
-        __Pyx_TraceLine(4958,0,__PYX_ERR(0, 4958, __pyx_L1_error))
+        __Pyx_TraceLine(4953,0,__PYX_ERR(0, 4953, __pyx_L1_error))
         __pyx_t_17 = (1.0 - __pyx_v_w);
         if (unlikely(__pyx_v_children_per_parent == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 4958, __pyx_L1_error)
+          __PYX_ERR(0, 4953, __pyx_L1_error)
         }
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 4958, __pyx_L1_error)
+          __PYX_ERR(0, 4953, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_t_17 / ((double)__pyx_v_children_per_parent));
       }
       __pyx_L11:;
 
-      /* "discretize/_extensions/tree_ext.pyx":4924
+      /* "discretize/_extensions/tree_ext.pyx":4919
  *                 V[2*ind  ] = 1.0
  * 
  *             if next_cell.is_leaf():             # <<<<<<<<<<<<<<
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  */
       goto __pyx_L10;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":4961
+    /* "discretize/_extensions/tree_ext.pyx":4956
  *             else:
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind_parent = cell.edges[1].index
  *                     w = (next_cell.children[0].location[1] - cell.edges[1].location[1])/(
  */
-    __Pyx_TraceLine(4961,0,__PYX_ERR(0, 4961, __pyx_L1_error))
+    __Pyx_TraceLine(4956,0,__PYX_ERR(0, 4956, __pyx_L1_error))
     /*else*/ {
       __pyx_t_2 = ((__pyx_v_dim == 2) != 0);
       if (__pyx_t_2) {
 
-        /* "discretize/_extensions/tree_ext.pyx":4962
+        /* "discretize/_extensions/tree_ext.pyx":4957
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 if dim == 2:
  *                     ind_parent = cell.edges[1].index             # <<<<<<<<<<<<<<
  *                     w = (next_cell.children[0].location[1] - cell.edges[1].location[1])/(
  *                          next_cell.children[0].location[1] - cell.location[1])
  */
-        __Pyx_TraceLine(4962,0,__PYX_ERR(0, 4962, __pyx_L1_error))
+        __Pyx_TraceLine(4957,0,__PYX_ERR(0, 4957, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_cell->edges[1])->index;
         __pyx_v_ind_parent = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":4963
+        /* "discretize/_extensions/tree_ext.pyx":4958
  *                 if dim == 2:
  *                     ind_parent = cell.edges[1].index
  *                     w = (next_cell.children[0].location[1] - cell.edges[1].location[1])/(             # <<<<<<<<<<<<<<
  *                          next_cell.children[0].location[1] - cell.location[1])
  *                     for i in range(2):
  */
-        __Pyx_TraceLine(4963,0,__PYX_ERR(0, 4963, __pyx_L1_error))
+        __Pyx_TraceLine(4958,0,__PYX_ERR(0, 4958, __pyx_L1_error))
         __pyx_t_17 = (((__pyx_v_next_cell->children[0])->location[1]) - ((__pyx_v_cell->edges[1])->location[1]));
 
-        /* "discretize/_extensions/tree_ext.pyx":4964
+        /* "discretize/_extensions/tree_ext.pyx":4959
  *                     ind_parent = cell.edges[1].index
  *                     w = (next_cell.children[0].location[1] - cell.edges[1].location[1])/(
  *                          next_cell.children[0].location[1] - cell.location[1])             # <<<<<<<<<<<<<<
  *                     for i in range(2):
  *                         child = next_cell.children[i]
  */
-        __Pyx_TraceLine(4964,0,__PYX_ERR(0, 4964, __pyx_L1_error))
+        __Pyx_TraceLine(4959,0,__PYX_ERR(0, 4959, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_next_cell->children[0])->location[1]) - (__pyx_v_cell->location[1]));
 
-        /* "discretize/_extensions/tree_ext.pyx":4963
+        /* "discretize/_extensions/tree_ext.pyx":4958
  *                 if dim == 2:
  *                     ind_parent = cell.edges[1].index
  *                     w = (next_cell.children[0].location[1] - cell.edges[1].location[1])/(             # <<<<<<<<<<<<<<
  *                          next_cell.children[0].location[1] - cell.location[1])
  *                     for i in range(2):
  */
-        __Pyx_TraceLine(4963,0,__PYX_ERR(0, 4963, __pyx_L1_error))
+        __Pyx_TraceLine(4958,0,__PYX_ERR(0, 4958, __pyx_L1_error))
         if (unlikely(__pyx_t_18 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 4963, __pyx_L1_error)
+          __PYX_ERR(0, 4958, __pyx_L1_error)
         }
         __pyx_v_w = (__pyx_t_17 / __pyx_t_18);
 
-        /* "discretize/_extensions/tree_ext.pyx":4965
+        /* "discretize/_extensions/tree_ext.pyx":4960
  *                     w = (next_cell.children[0].location[1] - cell.edges[1].location[1])/(
  *                          next_cell.children[0].location[1] - cell.location[1])
  *                     for i in range(2):             # <<<<<<<<<<<<<<
  *                         child = next_cell.children[i]
  *                         ind = child.edges[0].index
  */
-        __Pyx_TraceLine(4965,0,__PYX_ERR(0, 4965, __pyx_L1_error))
+        __Pyx_TraceLine(4960,0,__PYX_ERR(0, 4960, __pyx_L1_error))
         for (__pyx_t_19 = 0; __pyx_t_19 < 2; __pyx_t_19+=1) {
-          __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_19); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4965, __pyx_L1_error)
+          __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_19); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4960, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_4);
           __pyx_t_4 = 0;
 
-          /* "discretize/_extensions/tree_ext.pyx":4966
+          /* "discretize/_extensions/tree_ext.pyx":4961
  *                          next_cell.children[0].location[1] - cell.location[1])
  *                     for i in range(2):
  *                         child = next_cell.children[i]             # <<<<<<<<<<<<<<
  *                         ind = child.edges[0].index
  *                         I[2*ind    ] = ind_parent
  */
-          __Pyx_TraceLine(4966,0,__PYX_ERR(0, 4966, __pyx_L1_error))
-          __pyx_t_20 = __Pyx_PyIndex_AsSsize_t(__pyx_v_i); if (unlikely((__pyx_t_20 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 4966, __pyx_L1_error)
+          __Pyx_TraceLine(4961,0,__PYX_ERR(0, 4961, __pyx_L1_error))
+          __pyx_t_20 = __Pyx_PyIndex_AsSsize_t(__pyx_v_i); if (unlikely((__pyx_t_20 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 4961, __pyx_L1_error)
           __pyx_v_child = (__pyx_v_next_cell->children[__pyx_t_20]);
 
-          /* "discretize/_extensions/tree_ext.pyx":4967
+          /* "discretize/_extensions/tree_ext.pyx":4962
  *                     for i in range(2):
  *                         child = next_cell.children[i]
  *                         ind = child.edges[0].index             # <<<<<<<<<<<<<<
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent
  */
-          __Pyx_TraceLine(4967,0,__PYX_ERR(0, 4967, __pyx_L1_error))
+          __Pyx_TraceLine(4962,0,__PYX_ERR(0, 4962, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_child->edges[0])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4968
+          /* "discretize/_extensions/tree_ext.pyx":4963
  *                         child = next_cell.children[i]
  *                         ind = child.edges[0].index
  *                         I[2*ind    ] = ind_parent             # <<<<<<<<<<<<<<
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index
  */
-          __Pyx_TraceLine(4968,0,__PYX_ERR(0, 4968, __pyx_L1_error))
+          __Pyx_TraceLine(4963,0,__PYX_ERR(0, 4963, __pyx_L1_error))
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_I.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4968, __pyx_L1_error)
+            __PYX_ERR(0, 4963, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-          /* "discretize/_extensions/tree_ext.pyx":4969
+          /* "discretize/_extensions/tree_ext.pyx":4964
  *                         ind = child.edges[0].index
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent             # <<<<<<<<<<<<<<
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index
  */
-          __Pyx_TraceLine(4969,0,__PYX_ERR(0, 4969, __pyx_L1_error))
+          __Pyx_TraceLine(4964,0,__PYX_ERR(0, 4964, __pyx_L1_error))
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_I.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4969, __pyx_L1_error)
+            __PYX_ERR(0, 4964, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-          /* "discretize/_extensions/tree_ext.pyx":4970
+          /* "discretize/_extensions/tree_ext.pyx":4965
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index             # <<<<<<<<<<<<<<
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent
  */
-          __Pyx_TraceLine(4970,0,__PYX_ERR(0, 4970, __pyx_L1_error))
+          __Pyx_TraceLine(4965,0,__PYX_ERR(0, 4965, __pyx_L1_error))
           __pyx_t_16 = __pyx_v_cell->index;
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4970, __pyx_L1_error)
+            __PYX_ERR(0, 4965, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-          /* "discretize/_extensions/tree_ext.pyx":4971
+          /* "discretize/_extensions/tree_ext.pyx":4966
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index             # <<<<<<<<<<<<<<
  *                         V[2*ind    ] = w/children_per_parent
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  */
-          __Pyx_TraceLine(4971,0,__PYX_ERR(0, 4971, __pyx_L1_error))
+          __Pyx_TraceLine(4966,0,__PYX_ERR(0, 4966, __pyx_L1_error))
           __pyx_t_16 = __pyx_v_child->index;
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4971, __pyx_L1_error)
+            __PYX_ERR(0, 4966, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-          /* "discretize/_extensions/tree_ext.pyx":4972
+          /* "discretize/_extensions/tree_ext.pyx":4967
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent             # <<<<<<<<<<<<<<
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  *                 else:
  */
-          __Pyx_TraceLine(4972,0,__PYX_ERR(0, 4972, __pyx_L1_error))
+          __Pyx_TraceLine(4967,0,__PYX_ERR(0, 4967, __pyx_L1_error))
           if (unlikely(__pyx_v_children_per_parent == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4972, __pyx_L1_error)
+            __PYX_ERR(0, 4967, __pyx_L1_error)
           }
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4972, __pyx_L1_error)
+            __PYX_ERR(0, 4967, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_v_w / ((double)__pyx_v_children_per_parent));
 
-          /* "discretize/_extensions/tree_ext.pyx":4973
+          /* "discretize/_extensions/tree_ext.pyx":4968
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent             # <<<<<<<<<<<<<<
  *                 else:
  *                     ind_parent = cell.faces[3].index
  */
-          __Pyx_TraceLine(4973,0,__PYX_ERR(0, 4973, __pyx_L1_error))
+          __Pyx_TraceLine(4968,0,__PYX_ERR(0, 4968, __pyx_L1_error))
           __pyx_t_18 = (1.0 - __pyx_v_w);
           if (unlikely(__pyx_v_children_per_parent == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4973, __pyx_L1_error)
+            __PYX_ERR(0, 4968, __pyx_L1_error)
           }
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4973, __pyx_L1_error)
+            __PYX_ERR(0, 4968, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_t_18 / ((double)__pyx_v_children_per_parent));
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":4961
+        /* "discretize/_extensions/tree_ext.pyx":4956
  *             else:
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 if dim == 2:             # <<<<<<<<<<<<<<
  *                     ind_parent = cell.edges[1].index
  *                     w = (next_cell.children[0].location[1] - cell.edges[1].location[1])/(
  */
         goto __pyx_L14;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":4975
+      /* "discretize/_extensions/tree_ext.pyx":4970
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  *                 else:
  *                     ind_parent = cell.faces[3].index             # <<<<<<<<<<<<<<
  *                     w = (next_cell.children[0].location[1] - cell.faces[3].location[1])/(
  *                          next_cell.children[0].location[1] - cell.location[1])
  */
-      __Pyx_TraceLine(4975,0,__PYX_ERR(0, 4975, __pyx_L1_error))
+      __Pyx_TraceLine(4970,0,__PYX_ERR(0, 4970, __pyx_L1_error))
       /*else*/ {
         __pyx_t_10 = (__pyx_v_cell->faces[3])->index;
         __pyx_v_ind_parent = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":4976
+        /* "discretize/_extensions/tree_ext.pyx":4971
  *                 else:
  *                     ind_parent = cell.faces[3].index
  *                     w = (next_cell.children[0].location[1] - cell.faces[3].location[1])/(             # <<<<<<<<<<<<<<
  *                          next_cell.children[0].location[1] - cell.location[1])
  *                     for i in range(4): # four neighbors in +y direction
  */
-        __Pyx_TraceLine(4976,0,__PYX_ERR(0, 4976, __pyx_L1_error))
+        __Pyx_TraceLine(4971,0,__PYX_ERR(0, 4971, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_next_cell->children[0])->location[1]) - ((__pyx_v_cell->faces[3])->location[1]));
 
-        /* "discretize/_extensions/tree_ext.pyx":4977
+        /* "discretize/_extensions/tree_ext.pyx":4972
  *                     ind_parent = cell.faces[3].index
  *                     w = (next_cell.children[0].location[1] - cell.faces[3].location[1])/(
  *                          next_cell.children[0].location[1] - cell.location[1])             # <<<<<<<<<<<<<<
  *                     for i in range(4): # four neighbors in +y direction
  *                         child = next_cell.children[(i>>1)*4 + i%2] #0 1 4 5
  */
-        __Pyx_TraceLine(4977,0,__PYX_ERR(0, 4977, __pyx_L1_error))
+        __Pyx_TraceLine(4972,0,__PYX_ERR(0, 4972, __pyx_L1_error))
         __pyx_t_17 = (((__pyx_v_next_cell->children[0])->location[1]) - (__pyx_v_cell->location[1]));
 
-        /* "discretize/_extensions/tree_ext.pyx":4976
+        /* "discretize/_extensions/tree_ext.pyx":4971
  *                 else:
  *                     ind_parent = cell.faces[3].index
  *                     w = (next_cell.children[0].location[1] - cell.faces[3].location[1])/(             # <<<<<<<<<<<<<<
  *                          next_cell.children[0].location[1] - cell.location[1])
  *                     for i in range(4): # four neighbors in +y direction
  */
-        __Pyx_TraceLine(4976,0,__PYX_ERR(0, 4976, __pyx_L1_error))
+        __Pyx_TraceLine(4971,0,__PYX_ERR(0, 4971, __pyx_L1_error))
         if (unlikely(__pyx_t_17 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 4976, __pyx_L1_error)
+          __PYX_ERR(0, 4971, __pyx_L1_error)
         }
         __pyx_v_w = (__pyx_t_18 / __pyx_t_17);
 
-        /* "discretize/_extensions/tree_ext.pyx":4978
+        /* "discretize/_extensions/tree_ext.pyx":4973
  *                     w = (next_cell.children[0].location[1] - cell.faces[3].location[1])/(
  *                          next_cell.children[0].location[1] - cell.location[1])
  *                     for i in range(4): # four neighbors in +y direction             # <<<<<<<<<<<<<<
  *                         child = next_cell.children[(i>>1)*4 + i%2] #0 1 4 5
  *                         ind = child.faces[2].index
  */
-        __Pyx_TraceLine(4978,0,__PYX_ERR(0, 4978, __pyx_L1_error))
+        __Pyx_TraceLine(4973,0,__PYX_ERR(0, 4973, __pyx_L1_error))
         for (__pyx_t_19 = 0; __pyx_t_19 < 4; __pyx_t_19+=1) {
-          __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_19); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4978, __pyx_L1_error)
+          __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_19); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4973, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
           __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_4);
           __pyx_t_4 = 0;
 
-          /* "discretize/_extensions/tree_ext.pyx":4979
+          /* "discretize/_extensions/tree_ext.pyx":4974
  *                          next_cell.children[0].location[1] - cell.location[1])
  *                     for i in range(4): # four neighbors in +y direction
  *                         child = next_cell.children[(i>>1)*4 + i%2] #0 1 4 5             # <<<<<<<<<<<<<<
  *                         ind = child.faces[2].index
  *                         I[2*ind    ] = ind_parent
  */
-          __Pyx_TraceLine(4979,0,__PYX_ERR(0, 4979, __pyx_L1_error))
-          __pyx_t_4 = __Pyx_PyInt_RshiftObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4979, __pyx_L1_error)
+          __Pyx_TraceLine(4974,0,__PYX_ERR(0, 4974, __pyx_L1_error))
+          __pyx_t_4 = __Pyx_PyInt_RshiftObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4974, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_7 = PyNumber_Multiply(__pyx_t_4, __pyx_int_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4979, __pyx_L1_error)
+          __pyx_t_7 = PyNumber_Multiply(__pyx_t_4, __pyx_int_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4974, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          __pyx_t_4 = __Pyx_PyInt_RemainderObjC(__pyx_v_i, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4979, __pyx_L1_error)
+          __pyx_t_4 = __Pyx_PyInt_RemainderObjC(__pyx_v_i, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4974, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_4);
-          __pyx_t_6 = PyNumber_Add(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4979, __pyx_L1_error)
+          __pyx_t_6 = PyNumber_Add(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4974, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
           __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-          __pyx_t_20 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_20 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 4979, __pyx_L1_error)
+          __pyx_t_20 = __Pyx_PyIndex_AsSsize_t(__pyx_t_6); if (unlikely((__pyx_t_20 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 4974, __pyx_L1_error)
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
           __pyx_v_child = (__pyx_v_next_cell->children[__pyx_t_20]);
 
-          /* "discretize/_extensions/tree_ext.pyx":4980
+          /* "discretize/_extensions/tree_ext.pyx":4975
  *                     for i in range(4): # four neighbors in +y direction
  *                         child = next_cell.children[(i>>1)*4 + i%2] #0 1 4 5
  *                         ind = child.faces[2].index             # <<<<<<<<<<<<<<
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent
  */
-          __Pyx_TraceLine(4980,0,__PYX_ERR(0, 4980, __pyx_L1_error))
+          __Pyx_TraceLine(4975,0,__PYX_ERR(0, 4975, __pyx_L1_error))
           __pyx_t_10 = (__pyx_v_child->faces[2])->index;
           __pyx_v_ind = __pyx_t_10;
 
-          /* "discretize/_extensions/tree_ext.pyx":4981
+          /* "discretize/_extensions/tree_ext.pyx":4976
  *                         child = next_cell.children[(i>>1)*4 + i%2] #0 1 4 5
  *                         ind = child.faces[2].index
  *                         I[2*ind    ] = ind_parent             # <<<<<<<<<<<<<<
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index
  */
-          __Pyx_TraceLine(4981,0,__PYX_ERR(0, 4981, __pyx_L1_error))
+          __Pyx_TraceLine(4976,0,__PYX_ERR(0, 4976, __pyx_L1_error))
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_I.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4981, __pyx_L1_error)
+            __PYX_ERR(0, 4976, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-          /* "discretize/_extensions/tree_ext.pyx":4982
+          /* "discretize/_extensions/tree_ext.pyx":4977
  *                         ind = child.faces[2].index
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent             # <<<<<<<<<<<<<<
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index
  */
-          __Pyx_TraceLine(4982,0,__PYX_ERR(0, 4982, __pyx_L1_error))
+          __Pyx_TraceLine(4977,0,__PYX_ERR(0, 4977, __pyx_L1_error))
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_I.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4982, __pyx_L1_error)
+            __PYX_ERR(0, 4977, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-          /* "discretize/_extensions/tree_ext.pyx":4983
+          /* "discretize/_extensions/tree_ext.pyx":4978
  *                         I[2*ind    ] = ind_parent
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index             # <<<<<<<<<<<<<<
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent
  */
-          __Pyx_TraceLine(4983,0,__PYX_ERR(0, 4983, __pyx_L1_error))
+          __Pyx_TraceLine(4978,0,__PYX_ERR(0, 4978, __pyx_L1_error))
           __pyx_t_16 = __pyx_v_cell->index;
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4983, __pyx_L1_error)
+            __PYX_ERR(0, 4978, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-          /* "discretize/_extensions/tree_ext.pyx":4984
+          /* "discretize/_extensions/tree_ext.pyx":4979
  *                         I[2*ind + 1] = ind_parent
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index             # <<<<<<<<<<<<<<
  *                         V[2*ind    ] = w/children_per_parent
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  */
-          __Pyx_TraceLine(4984,0,__PYX_ERR(0, 4984, __pyx_L1_error))
+          __Pyx_TraceLine(4979,0,__PYX_ERR(0, 4979, __pyx_L1_error))
           __pyx_t_16 = __pyx_v_child->index;
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4984, __pyx_L1_error)
+            __PYX_ERR(0, 4979, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-          /* "discretize/_extensions/tree_ext.pyx":4985
+          /* "discretize/_extensions/tree_ext.pyx":4980
  *                         J[2*ind    ] = cell.index
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent             # <<<<<<<<<<<<<<
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  * 
  */
-          __Pyx_TraceLine(4985,0,__PYX_ERR(0, 4985, __pyx_L1_error))
+          __Pyx_TraceLine(4980,0,__PYX_ERR(0, 4980, __pyx_L1_error))
           if (unlikely(__pyx_v_children_per_parent == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4985, __pyx_L1_error)
+            __PYX_ERR(0, 4980, __pyx_L1_error)
           }
           __pyx_t_14 = (2 * __pyx_v_ind);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4985, __pyx_L1_error)
+            __PYX_ERR(0, 4980, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_v_w / ((double)__pyx_v_children_per_parent));
 
-          /* "discretize/_extensions/tree_ext.pyx":4986
+          /* "discretize/_extensions/tree_ext.pyx":4981
  *                         J[2*ind + 1] = child.index
  *                         V[2*ind    ] = w/children_per_parent
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent             # <<<<<<<<<<<<<<
  * 
  *         self._average_cell_to_face_y = sp.csr_matrix((V, (I,J)), shape=(self.n_faces_y, self.n_cells))
  */
-          __Pyx_TraceLine(4986,0,__PYX_ERR(0, 4986, __pyx_L1_error))
+          __Pyx_TraceLine(4981,0,__PYX_ERR(0, 4981, __pyx_L1_error))
           __pyx_t_17 = (1.0 - __pyx_v_w);
           if (unlikely(__pyx_v_children_per_parent == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 4986, __pyx_L1_error)
+            __PYX_ERR(0, 4981, __pyx_L1_error)
           }
           __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
           __pyx_t_15 = -1;
           if (__pyx_t_14 < 0) {
             __pyx_t_14 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
           } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
           if (unlikely(__pyx_t_15 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_15);
-            __PYX_ERR(0, 4986, __pyx_L1_error)
+            __PYX_ERR(0, 4981, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_t_17 / ((double)__pyx_v_children_per_parent));
         }
       }
       __pyx_L14:;
     }
     __pyx_L10:;
 
-    /* "discretize/_extensions/tree_ext.pyx":4902
+    /* "discretize/_extensions/tree_ext.pyx":4897
  *         cdef double w
  * 
  *         for cell in self.tree.cells :             # <<<<<<<<<<<<<<
  *             next_cell = cell.neighbors[3]
  *             prev_cell = cell.neighbors[2]
  */
-    __Pyx_TraceLine(4902,0,__PYX_ERR(0, 4902, __pyx_L1_error))
+    __Pyx_TraceLine(4897,0,__PYX_ERR(0, 4897, __pyx_L1_error))
     __pyx_L4_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":4988
+  /* "discretize/_extensions/tree_ext.pyx":4983
  *                         V[2*ind + 1] = (1.0-w)/children_per_parent
  * 
  *         self._average_cell_to_face_y = sp.csr_matrix((V, (I,J)), shape=(self.n_faces_y, self.n_cells))             # <<<<<<<<<<<<<<
  *         return self._average_cell_to_face_y
  * 
  */
-  __Pyx_TraceLine(4988,0,__PYX_ERR(0, 4988, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __Pyx_TraceLine(4983,0,__PYX_ERR(0, 4983, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_3);
   __pyx_t_7 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_5);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_y); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_21 = PyTuple_New(2); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_21 = PyTuple_New(2); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_21);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_21, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_21, 1, __pyx_t_7);
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_21) < 0) __PYX_ERR(0, 4988, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_21) < 0) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_21); __pyx_t_21 = 0;
-  __pyx_t_21 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 4988, __pyx_L1_error)
+  __pyx_t_21 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 4983, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_21);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_GIVEREF(__pyx_t_21);
   __Pyx_GOTREF(__pyx_v_self->_average_cell_to_face_y);
   __Pyx_DECREF(__pyx_v_self->_average_cell_to_face_y);
   __pyx_v_self->_average_cell_to_face_y = __pyx_t_21;
   __pyx_t_21 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4989
+  /* "discretize/_extensions/tree_ext.pyx":4984
  * 
  *         self._average_cell_to_face_y = sp.csr_matrix((V, (I,J)), shape=(self.n_faces_y, self.n_cells))
  *         return self._average_cell_to_face_y             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(4989,0,__PYX_ERR(0, 4989, __pyx_L1_error))
+  __Pyx_TraceLine(4984,0,__PYX_ERR(0, 4984, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_cell_to_face_y);
   __pyx_r = __pyx_v_self->_average_cell_to_face_y;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4876
+  /* "discretize/_extensions/tree_ext.pyx":4871
  * 
  *     @property
  *     def average_cell_to_face_y(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from cell centers to y faces (scalar quantities).
  * 
  */
 
@@ -58022,15 +58034,15 @@
   __Pyx_XDECREF(__pyx_v_i);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":4992
+/* "discretize/_extensions/tree_ext.pyx":4987
  * 
  *     @property
  *     def average_cell_to_face_z(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from cell centers to z faces (scalar quantities).
  * 
  */
 
@@ -58084,1173 +58096,1173 @@
   double __pyx_t_18;
   long __pyx_t_19;
   PyObject *__pyx_t_20 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 4992, 0, __PYX_ERR(0, 4992, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 4987, 0, __PYX_ERR(0, 4987, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5005
+  /* "discretize/_extensions/tree_ext.pyx":5000
  *             The scalar averaging operator from cell centers to z faces
  *         """
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             raise Exception('TreeMesh has no z-faces in 2D')
  *         if self._average_cell_to_face_z is not None:
  */
-  __Pyx_TraceLine(5005,0,__PYX_ERR(0, 5005, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5005, __pyx_L1_error)
+  __Pyx_TraceLine(5000,0,__PYX_ERR(0, 5000, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5000, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5005, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5000, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 5005, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 5000, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (unlikely(__pyx_t_3)) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5006
+    /* "discretize/_extensions/tree_ext.pyx":5001
  *         """
  *         if self.dim == 2:
  *             raise Exception('TreeMesh has no z-faces in 2D')             # <<<<<<<<<<<<<<
  *         if self._average_cell_to_face_z is not None:
  *             return self._average_cell_to_face_z
  */
-    __Pyx_TraceLine(5006,0,__PYX_ERR(0, 5006, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__30, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5006, __pyx_L1_error)
+    __Pyx_TraceLine(5001,0,__PYX_ERR(0, 5001, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__30, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5001, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 5006, __pyx_L1_error)
+    __PYX_ERR(0, 5001, __pyx_L1_error)
 
-    /* "discretize/_extensions/tree_ext.pyx":5005
+    /* "discretize/_extensions/tree_ext.pyx":5000
  *             The scalar averaging operator from cell centers to z faces
  *         """
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             raise Exception('TreeMesh has no z-faces in 2D')
  *         if self._average_cell_to_face_z is not None:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5007
+  /* "discretize/_extensions/tree_ext.pyx":5002
  *         if self.dim == 2:
  *             raise Exception('TreeMesh has no z-faces in 2D')
  *         if self._average_cell_to_face_z is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_to_face_z
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  */
-  __Pyx_TraceLine(5007,0,__PYX_ERR(0, 5007, __pyx_L1_error))
+  __Pyx_TraceLine(5002,0,__PYX_ERR(0, 5002, __pyx_L1_error))
   __pyx_t_3 = (__pyx_v_self->_average_cell_to_face_z != Py_None);
   __pyx_t_4 = (__pyx_t_3 != 0);
   if (__pyx_t_4) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5008
+    /* "discretize/_extensions/tree_ext.pyx":5003
  *             raise Exception('TreeMesh has no z-faces in 2D')
  *         if self._average_cell_to_face_z is not None:
  *             return self._average_cell_to_face_z             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  */
-    __Pyx_TraceLine(5008,0,__PYX_ERR(0, 5008, __pyx_L1_error))
+    __Pyx_TraceLine(5003,0,__PYX_ERR(0, 5003, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->_average_cell_to_face_z);
     __pyx_r = __pyx_v_self->_average_cell_to_face_z;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5007
+    /* "discretize/_extensions/tree_ext.pyx":5002
  *         if self.dim == 2:
  *             raise Exception('TreeMesh has no z-faces in 2D')
  *         if self._average_cell_to_face_z is not None:             # <<<<<<<<<<<<<<
  *             return self._average_cell_to_face_z
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5009
+  /* "discretize/_extensions/tree_ext.pyx":5004
  *         if self._average_cell_to_face_z is not None:
  *             return self._average_cell_to_face_z
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_z, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_z, dtype=np.float64)
  */
-  __Pyx_TraceLine(5009,0,__PYX_ERR(0, 5009, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __Pyx_TraceLine(5004,0,__PYX_ERR(0, 5004, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_z); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_z); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_int_2, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_int_2, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 5009, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5009, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5004, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5010
+  /* "discretize/_extensions/tree_ext.pyx":5005
  *             return self._average_cell_to_face_z
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_z, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_z, dtype=np.float64)
  *         cdef int dim = self._dim
  */
-  __Pyx_TraceLine(5010,0,__PYX_ERR(0, 5010, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __Pyx_TraceLine(5005,0,__PYX_ERR(0, 5005, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_zeros); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_2 = PyNumber_Multiply(__pyx_int_2, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_int_2, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5010, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5010, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5005, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5011
+  /* "discretize/_extensions/tree_ext.pyx":5006
  *         cdef np.int64_t[:] I = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_z, dtype=np.float64)             # <<<<<<<<<<<<<<
  *         cdef int dim = self._dim
  *         cdef int_t ind, ind_parent
  */
-  __Pyx_TraceLine(5011,0,__PYX_ERR(0, 5011, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __Pyx_TraceLine(5006,0,__PYX_ERR(0, 5006, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_z); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_z); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_int_2, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_int_2, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 5011, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_1) < 0) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5011, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5006, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5012
+  /* "discretize/_extensions/tree_ext.pyx":5007
  *         cdef np.int64_t[:] J = np.zeros(2*self.n_total_faces_z, dtype=np.int64)
  *         cdef np.float64_t[:] V = np.zeros(2*self.n_total_faces_z, dtype=np.float64)
  *         cdef int dim = self._dim             # <<<<<<<<<<<<<<
  *         cdef int_t ind, ind_parent
  *         cdef int_t children_per_parent = (dim-1)*2
  */
-  __Pyx_TraceLine(5012,0,__PYX_ERR(0, 5012, __pyx_L1_error))
+  __Pyx_TraceLine(5007,0,__PYX_ERR(0, 5007, __pyx_L1_error))
   __pyx_t_10 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_10;
 
-  /* "discretize/_extensions/tree_ext.pyx":5014
+  /* "discretize/_extensions/tree_ext.pyx":5009
  *         cdef int dim = self._dim
  *         cdef int_t ind, ind_parent
  *         cdef int_t children_per_parent = (dim-1)*2             # <<<<<<<<<<<<<<
  *         cdef c_Cell* child
  *         cdef c_Cell* next_cell
  */
-  __Pyx_TraceLine(5014,0,__PYX_ERR(0, 5014, __pyx_L1_error))
+  __Pyx_TraceLine(5009,0,__PYX_ERR(0, 5009, __pyx_L1_error))
   __pyx_v_children_per_parent = ((__pyx_v_dim - 1) * 2);
 
-  /* "discretize/_extensions/tree_ext.pyx":5020
+  /* "discretize/_extensions/tree_ext.pyx":5015
  *         cdef double w
  * 
  *         for cell in self.tree.cells :             # <<<<<<<<<<<<<<
  *             next_cell = cell.neighbors[5]
  *             prev_cell = cell.neighbors[4]
  */
-  __Pyx_TraceLine(5020,0,__PYX_ERR(0, 5020, __pyx_L1_error))
+  __Pyx_TraceLine(5015,0,__PYX_ERR(0, 5015, __pyx_L1_error))
   __pyx_t_12 = &__pyx_v_self->tree->cells;
   __pyx_t_11 = __pyx_t_12->begin();
   for (;;) {
     if (!(__pyx_t_11 != __pyx_t_12->end())) break;
     __pyx_t_13 = *__pyx_t_11;
     ++__pyx_t_11;
     __pyx_v_cell = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":5021
+    /* "discretize/_extensions/tree_ext.pyx":5016
  * 
  *         for cell in self.tree.cells :
  *             next_cell = cell.neighbors[5]             # <<<<<<<<<<<<<<
  *             prev_cell = cell.neighbors[4]
  *             # handle extrapolation to boundary faces
  */
-    __Pyx_TraceLine(5021,0,__PYX_ERR(0, 5021, __pyx_L1_error))
+    __Pyx_TraceLine(5016,0,__PYX_ERR(0, 5016, __pyx_L1_error))
     __pyx_v_next_cell = (__pyx_v_cell->neighbors[5]);
 
-    /* "discretize/_extensions/tree_ext.pyx":5022
+    /* "discretize/_extensions/tree_ext.pyx":5017
  *         for cell in self.tree.cells :
  *             next_cell = cell.neighbors[5]
  *             prev_cell = cell.neighbors[4]             # <<<<<<<<<<<<<<
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:
  */
-    __Pyx_TraceLine(5022,0,__PYX_ERR(0, 5022, __pyx_L1_error))
+    __Pyx_TraceLine(5017,0,__PYX_ERR(0, 5017, __pyx_L1_error))
     __pyx_v_prev_cell = (__pyx_v_cell->neighbors[4]);
 
-    /* "discretize/_extensions/tree_ext.pyx":5024
+    /* "discretize/_extensions/tree_ext.pyx":5019
  *             prev_cell = cell.neighbors[4]
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:             # <<<<<<<<<<<<<<
  *                 ind = cell.faces[5].index # +z face
  *                 I[2*ind  ] = ind
  */
-    __Pyx_TraceLine(5024,0,__PYX_ERR(0, 5024, __pyx_L1_error))
+    __Pyx_TraceLine(5019,0,__PYX_ERR(0, 5019, __pyx_L1_error))
     __pyx_t_4 = ((__pyx_v_next_cell == NULL) != 0);
     if (__pyx_t_4) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5025
+      /* "discretize/_extensions/tree_ext.pyx":5020
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:
  *                 ind = cell.faces[5].index # +z face             # <<<<<<<<<<<<<<
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  */
-      __Pyx_TraceLine(5025,0,__PYX_ERR(0, 5025, __pyx_L1_error))
+      __Pyx_TraceLine(5020,0,__PYX_ERR(0, 5020, __pyx_L1_error))
       __pyx_t_10 = (__pyx_v_cell->faces[5])->index;
       __pyx_v_ind = __pyx_t_10;
 
-      /* "discretize/_extensions/tree_ext.pyx":5026
+      /* "discretize/_extensions/tree_ext.pyx":5021
  *             if next_cell == NULL:
  *                 ind = cell.faces[5].index # +z face
  *                 I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  */
-      __Pyx_TraceLine(5026,0,__PYX_ERR(0, 5026, __pyx_L1_error))
+      __Pyx_TraceLine(5021,0,__PYX_ERR(0, 5021, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 5026, __pyx_L1_error)
+        __PYX_ERR(0, 5021, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-      /* "discretize/_extensions/tree_ext.pyx":5027
+      /* "discretize/_extensions/tree_ext.pyx":5022
  *                 ind = cell.faces[5].index # +z face
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                 V[2*ind  ] = 1.0
  *                 continue
  */
-      __Pyx_TraceLine(5027,0,__PYX_ERR(0, 5027, __pyx_L1_error))
+      __Pyx_TraceLine(5022,0,__PYX_ERR(0, 5022, __pyx_L1_error))
       __pyx_t_16 = __pyx_v_cell->index;
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 5027, __pyx_L1_error)
+        __PYX_ERR(0, 5022, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-      /* "discretize/_extensions/tree_ext.pyx":5028
+      /* "discretize/_extensions/tree_ext.pyx":5023
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0             # <<<<<<<<<<<<<<
  *                 continue
  *             if prev_cell == NULL:
  */
-      __Pyx_TraceLine(5028,0,__PYX_ERR(0, 5028, __pyx_L1_error))
+      __Pyx_TraceLine(5023,0,__PYX_ERR(0, 5023, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 5028, __pyx_L1_error)
+        __PYX_ERR(0, 5023, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = 1.0;
 
-      /* "discretize/_extensions/tree_ext.pyx":5029
+      /* "discretize/_extensions/tree_ext.pyx":5024
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  *                 continue             # <<<<<<<<<<<<<<
  *             if prev_cell == NULL:
  *                 ind = cell.faces[4].index # -z face
  */
-      __Pyx_TraceLine(5029,0,__PYX_ERR(0, 5029, __pyx_L1_error))
+      __Pyx_TraceLine(5024,0,__PYX_ERR(0, 5024, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "discretize/_extensions/tree_ext.pyx":5024
+      /* "discretize/_extensions/tree_ext.pyx":5019
  *             prev_cell = cell.neighbors[4]
  *             # handle extrapolation to boundary faces
  *             if next_cell == NULL:             # <<<<<<<<<<<<<<
  *                 ind = cell.faces[5].index # +z face
  *                 I[2*ind  ] = ind
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5030
+    /* "discretize/_extensions/tree_ext.pyx":5025
  *                 V[2*ind  ] = 1.0
  *                 continue
  *             if prev_cell == NULL:             # <<<<<<<<<<<<<<
  *                 ind = cell.faces[4].index # -z face
  *                 I[2*ind  ] = ind
  */
-    __Pyx_TraceLine(5030,0,__PYX_ERR(0, 5030, __pyx_L1_error))
+    __Pyx_TraceLine(5025,0,__PYX_ERR(0, 5025, __pyx_L1_error))
     __pyx_t_4 = ((__pyx_v_prev_cell == NULL) != 0);
     if (__pyx_t_4) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5031
+      /* "discretize/_extensions/tree_ext.pyx":5026
  *                 continue
  *             if prev_cell == NULL:
  *                 ind = cell.faces[4].index # -z face             # <<<<<<<<<<<<<<
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  */
-      __Pyx_TraceLine(5031,0,__PYX_ERR(0, 5031, __pyx_L1_error))
+      __Pyx_TraceLine(5026,0,__PYX_ERR(0, 5026, __pyx_L1_error))
       __pyx_t_10 = (__pyx_v_cell->faces[4])->index;
       __pyx_v_ind = __pyx_t_10;
 
-      /* "discretize/_extensions/tree_ext.pyx":5032
+      /* "discretize/_extensions/tree_ext.pyx":5027
  *             if prev_cell == NULL:
  *                 ind = cell.faces[4].index # -z face
  *                 I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0
  */
-      __Pyx_TraceLine(5032,0,__PYX_ERR(0, 5032, __pyx_L1_error))
+      __Pyx_TraceLine(5027,0,__PYX_ERR(0, 5027, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_I.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 5032, __pyx_L1_error)
+        __PYX_ERR(0, 5027, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-      /* "discretize/_extensions/tree_ext.pyx":5033
+      /* "discretize/_extensions/tree_ext.pyx":5028
  *                 ind = cell.faces[4].index # -z face
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                 V[2*ind  ] = 1.0
  * 
  */
-      __Pyx_TraceLine(5033,0,__PYX_ERR(0, 5033, __pyx_L1_error))
+      __Pyx_TraceLine(5028,0,__PYX_ERR(0, 5028, __pyx_L1_error))
       __pyx_t_16 = __pyx_v_cell->index;
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 5033, __pyx_L1_error)
+        __PYX_ERR(0, 5028, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-      /* "discretize/_extensions/tree_ext.pyx":5034
+      /* "discretize/_extensions/tree_ext.pyx":5029
  *                 I[2*ind  ] = ind
  *                 J[2*ind  ] = cell.index
  *                 V[2*ind  ] = 1.0             # <<<<<<<<<<<<<<
  * 
  *             if next_cell.is_leaf():
  */
-      __Pyx_TraceLine(5034,0,__PYX_ERR(0, 5034, __pyx_L1_error))
+      __Pyx_TraceLine(5029,0,__PYX_ERR(0, 5029, __pyx_L1_error))
       __pyx_t_14 = (2 * __pyx_v_ind);
       __pyx_t_15 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
       if (unlikely(__pyx_t_15 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_15);
-        __PYX_ERR(0, 5034, __pyx_L1_error)
+        __PYX_ERR(0, 5029, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = 1.0;
 
-      /* "discretize/_extensions/tree_ext.pyx":5030
+      /* "discretize/_extensions/tree_ext.pyx":5025
  *                 V[2*ind  ] = 1.0
  *                 continue
  *             if prev_cell == NULL:             # <<<<<<<<<<<<<<
  *                 ind = cell.faces[4].index # -z face
  *                 I[2*ind  ] = ind
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5036
+    /* "discretize/_extensions/tree_ext.pyx":5031
  *                 V[2*ind  ] = 1.0
  * 
  *             if next_cell.is_leaf():             # <<<<<<<<<<<<<<
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  */
-    __Pyx_TraceLine(5036,0,__PYX_ERR(0, 5036, __pyx_L1_error))
+    __Pyx_TraceLine(5031,0,__PYX_ERR(0, 5031, __pyx_L1_error))
     __pyx_t_4 = (__pyx_v_next_cell->is_leaf() != 0);
     if (__pyx_t_4) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5037
+      /* "discretize/_extensions/tree_ext.pyx":5032
  * 
  *             if next_cell.is_leaf():
  *                 if next_cell.level == cell.level:             # <<<<<<<<<<<<<<
  *                     #I am on the same level and easy to interpolate
  *                     ind = cell.faces[5].index
  */
-      __Pyx_TraceLine(5037,0,__PYX_ERR(0, 5037, __pyx_L1_error))
+      __Pyx_TraceLine(5032,0,__PYX_ERR(0, 5032, __pyx_L1_error))
       __pyx_t_4 = ((__pyx_v_next_cell->level == __pyx_v_cell->level) != 0);
       if (__pyx_t_4) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5039
+        /* "discretize/_extensions/tree_ext.pyx":5034
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  *                     ind = cell.faces[5].index             # <<<<<<<<<<<<<<
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(
  *                          next_cell.location[2] - cell.location[2])
  */
-        __Pyx_TraceLine(5039,0,__PYX_ERR(0, 5039, __pyx_L1_error))
+        __Pyx_TraceLine(5034,0,__PYX_ERR(0, 5034, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_cell->faces[5])->index;
         __pyx_v_ind = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":5040
+        /* "discretize/_extensions/tree_ext.pyx":5035
  *                     #I am on the same level and easy to interpolate
  *                     ind = cell.faces[5].index
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(             # <<<<<<<<<<<<<<
  *                          next_cell.location[2] - cell.location[2])
  *                     I[2*ind  ] = ind
  */
-        __Pyx_TraceLine(5040,0,__PYX_ERR(0, 5040, __pyx_L1_error))
+        __Pyx_TraceLine(5035,0,__PYX_ERR(0, 5035, __pyx_L1_error))
         __pyx_t_17 = ((__pyx_v_next_cell->location[2]) - ((__pyx_v_cell->faces[5])->location[2]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5041
+        /* "discretize/_extensions/tree_ext.pyx":5036
  *                     ind = cell.faces[5].index
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(
  *                          next_cell.location[2] - cell.location[2])             # <<<<<<<<<<<<<<
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind
  */
-        __Pyx_TraceLine(5041,0,__PYX_ERR(0, 5041, __pyx_L1_error))
+        __Pyx_TraceLine(5036,0,__PYX_ERR(0, 5036, __pyx_L1_error))
         __pyx_t_18 = ((__pyx_v_next_cell->location[2]) - (__pyx_v_cell->location[2]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5040
+        /* "discretize/_extensions/tree_ext.pyx":5035
  *                     #I am on the same level and easy to interpolate
  *                     ind = cell.faces[5].index
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(             # <<<<<<<<<<<<<<
  *                          next_cell.location[2] - cell.location[2])
  *                     I[2*ind  ] = ind
  */
-        __Pyx_TraceLine(5040,0,__PYX_ERR(0, 5040, __pyx_L1_error))
+        __Pyx_TraceLine(5035,0,__PYX_ERR(0, 5035, __pyx_L1_error))
         if (unlikely(__pyx_t_18 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5040, __pyx_L1_error)
+          __PYX_ERR(0, 5035, __pyx_L1_error)
         }
         __pyx_v_w = (__pyx_t_17 / __pyx_t_18);
 
-        /* "discretize/_extensions/tree_ext.pyx":5042
+        /* "discretize/_extensions/tree_ext.pyx":5037
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(
  *                          next_cell.location[2] - cell.location[2])
  *                     I[2*ind  ] = ind             # <<<<<<<<<<<<<<
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index
  */
-        __Pyx_TraceLine(5042,0,__PYX_ERR(0, 5042, __pyx_L1_error))
+        __Pyx_TraceLine(5037,0,__PYX_ERR(0, 5037, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5042, __pyx_L1_error)
+          __PYX_ERR(0, 5037, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-        /* "discretize/_extensions/tree_ext.pyx":5043
+        /* "discretize/_extensions/tree_ext.pyx":5038
  *                          next_cell.location[2] - cell.location[2])
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind             # <<<<<<<<<<<<<<
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  */
-        __Pyx_TraceLine(5043,0,__PYX_ERR(0, 5043, __pyx_L1_error))
+        __Pyx_TraceLine(5038,0,__PYX_ERR(0, 5038, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5043, __pyx_L1_error)
+          __PYX_ERR(0, 5038, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind;
 
-        /* "discretize/_extensions/tree_ext.pyx":5044
+        /* "discretize/_extensions/tree_ext.pyx":5039
  *                     I[2*ind  ] = ind
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w
  */
-        __Pyx_TraceLine(5044,0,__PYX_ERR(0, 5044, __pyx_L1_error))
+        __Pyx_TraceLine(5039,0,__PYX_ERR(0, 5039, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_cell->index;
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5044, __pyx_L1_error)
+          __PYX_ERR(0, 5039, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":5045
+        /* "discretize/_extensions/tree_ext.pyx":5040
  *                     I[2*ind+1] = ind
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index             # <<<<<<<<<<<<<<
  *                     V[2*ind  ] = w
  *                     V[2*ind+1] = (1.0-w)
  */
-        __Pyx_TraceLine(5045,0,__PYX_ERR(0, 5045, __pyx_L1_error))
+        __Pyx_TraceLine(5040,0,__PYX_ERR(0, 5040, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_next_cell->index;
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5045, __pyx_L1_error)
+          __PYX_ERR(0, 5040, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":5046
+        /* "discretize/_extensions/tree_ext.pyx":5041
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w             # <<<<<<<<<<<<<<
  *                     V[2*ind+1] = (1.0-w)
  *                 else:
  */
-        __Pyx_TraceLine(5046,0,__PYX_ERR(0, 5046, __pyx_L1_error))
+        __Pyx_TraceLine(5041,0,__PYX_ERR(0, 5041, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5046, __pyx_L1_error)
+          __PYX_ERR(0, 5041, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = __pyx_v_w;
 
-        /* "discretize/_extensions/tree_ext.pyx":5047
+        /* "discretize/_extensions/tree_ext.pyx":5042
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w
  *                     V[2*ind+1] = (1.0-w)             # <<<<<<<<<<<<<<
  *                 else:
  *                     # if next cell is a level larger than i am
  */
-        __Pyx_TraceLine(5047,0,__PYX_ERR(0, 5047, __pyx_L1_error))
+        __Pyx_TraceLine(5042,0,__PYX_ERR(0, 5042, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5047, __pyx_L1_error)
+          __PYX_ERR(0, 5042, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (1.0 - __pyx_v_w);
 
-        /* "discretize/_extensions/tree_ext.pyx":5037
+        /* "discretize/_extensions/tree_ext.pyx":5032
  * 
  *             if next_cell.is_leaf():
  *                 if next_cell.level == cell.level:             # <<<<<<<<<<<<<<
  *                     #I am on the same level and easy to interpolate
  *                     ind = cell.faces[5].index
  */
         goto __pyx_L10;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5050
+      /* "discretize/_extensions/tree_ext.pyx":5045
  *                 else:
  *                     # if next cell is a level larger than i am
  *                     ind = cell.faces[5].index             # <<<<<<<<<<<<<<
  *                     ind_parent = cell.faces[5].parent.index
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(
  */
-      __Pyx_TraceLine(5050,0,__PYX_ERR(0, 5050, __pyx_L1_error))
+      __Pyx_TraceLine(5045,0,__PYX_ERR(0, 5045, __pyx_L1_error))
       /*else*/ {
         __pyx_t_10 = (__pyx_v_cell->faces[5])->index;
         __pyx_v_ind = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":5051
+        /* "discretize/_extensions/tree_ext.pyx":5046
  *                     # if next cell is a level larger than i am
  *                     ind = cell.faces[5].index
  *                     ind_parent = cell.faces[5].parent.index             # <<<<<<<<<<<<<<
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(
  *                          next_cell.location[2] - cell.location[2])
  */
-        __Pyx_TraceLine(5051,0,__PYX_ERR(0, 5051, __pyx_L1_error))
+        __Pyx_TraceLine(5046,0,__PYX_ERR(0, 5046, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_cell->faces[5])->parent->index;
         __pyx_v_ind_parent = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":5052
+        /* "discretize/_extensions/tree_ext.pyx":5047
  *                     ind = cell.faces[5].index
  *                     ind_parent = cell.faces[5].parent.index
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(             # <<<<<<<<<<<<<<
  *                          next_cell.location[2] - cell.location[2])
  *                     I[2*ind  ] = ind_parent
  */
-        __Pyx_TraceLine(5052,0,__PYX_ERR(0, 5052, __pyx_L1_error))
+        __Pyx_TraceLine(5047,0,__PYX_ERR(0, 5047, __pyx_L1_error))
         __pyx_t_18 = ((__pyx_v_next_cell->location[2]) - ((__pyx_v_cell->faces[5])->location[2]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5053
+        /* "discretize/_extensions/tree_ext.pyx":5048
  *                     ind_parent = cell.faces[5].parent.index
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(
  *                          next_cell.location[2] - cell.location[2])             # <<<<<<<<<<<<<<
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent
  */
-        __Pyx_TraceLine(5053,0,__PYX_ERR(0, 5053, __pyx_L1_error))
+        __Pyx_TraceLine(5048,0,__PYX_ERR(0, 5048, __pyx_L1_error))
         __pyx_t_17 = ((__pyx_v_next_cell->location[2]) - (__pyx_v_cell->location[2]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5052
+        /* "discretize/_extensions/tree_ext.pyx":5047
  *                     ind = cell.faces[5].index
  *                     ind_parent = cell.faces[5].parent.index
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(             # <<<<<<<<<<<<<<
  *                          next_cell.location[2] - cell.location[2])
  *                     I[2*ind  ] = ind_parent
  */
-        __Pyx_TraceLine(5052,0,__PYX_ERR(0, 5052, __pyx_L1_error))
+        __Pyx_TraceLine(5047,0,__PYX_ERR(0, 5047, __pyx_L1_error))
         if (unlikely(__pyx_t_17 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5052, __pyx_L1_error)
+          __PYX_ERR(0, 5047, __pyx_L1_error)
         }
         __pyx_v_w = (__pyx_t_18 / __pyx_t_17);
 
-        /* "discretize/_extensions/tree_ext.pyx":5054
+        /* "discretize/_extensions/tree_ext.pyx":5049
  *                     w = (next_cell.location[2] - cell.faces[5].location[2])/(
  *                          next_cell.location[2] - cell.location[2])
  *                     I[2*ind  ] = ind_parent             # <<<<<<<<<<<<<<
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index
  */
-        __Pyx_TraceLine(5054,0,__PYX_ERR(0, 5054, __pyx_L1_error))
+        __Pyx_TraceLine(5049,0,__PYX_ERR(0, 5049, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5054, __pyx_L1_error)
+          __PYX_ERR(0, 5049, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-        /* "discretize/_extensions/tree_ext.pyx":5055
+        /* "discretize/_extensions/tree_ext.pyx":5050
  *                          next_cell.location[2] - cell.location[2])
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent             # <<<<<<<<<<<<<<
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  */
-        __Pyx_TraceLine(5055,0,__PYX_ERR(0, 5055, __pyx_L1_error))
+        __Pyx_TraceLine(5050,0,__PYX_ERR(0, 5050, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5055, __pyx_L1_error)
+          __PYX_ERR(0, 5050, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-        /* "discretize/_extensions/tree_ext.pyx":5056
+        /* "discretize/_extensions/tree_ext.pyx":5051
  *                     I[2*ind  ] = ind_parent
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index             # <<<<<<<<<<<<<<
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent
  */
-        __Pyx_TraceLine(5056,0,__PYX_ERR(0, 5056, __pyx_L1_error))
+        __Pyx_TraceLine(5051,0,__PYX_ERR(0, 5051, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_cell->index;
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5056, __pyx_L1_error)
+          __PYX_ERR(0, 5051, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":5057
+        /* "discretize/_extensions/tree_ext.pyx":5052
  *                     I[2*ind+1] = ind_parent
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index             # <<<<<<<<<<<<<<
  *                     V[2*ind  ] = w/children_per_parent
  *                     V[2*ind+1] = (1.0-w)/children_per_parent
  */
-        __Pyx_TraceLine(5057,0,__PYX_ERR(0, 5057, __pyx_L1_error))
+        __Pyx_TraceLine(5052,0,__PYX_ERR(0, 5052, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_next_cell->index;
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5057, __pyx_L1_error)
+          __PYX_ERR(0, 5052, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":5058
+        /* "discretize/_extensions/tree_ext.pyx":5053
  *                     J[2*ind  ] = cell.index
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent             # <<<<<<<<<<<<<<
  *                     V[2*ind+1] = (1.0-w)/children_per_parent
  *             else:
  */
-        __Pyx_TraceLine(5058,0,__PYX_ERR(0, 5058, __pyx_L1_error))
+        __Pyx_TraceLine(5053,0,__PYX_ERR(0, 5053, __pyx_L1_error))
         if (unlikely(__pyx_v_children_per_parent == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5058, __pyx_L1_error)
+          __PYX_ERR(0, 5053, __pyx_L1_error)
         }
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5058, __pyx_L1_error)
+          __PYX_ERR(0, 5053, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_v_w / ((double)__pyx_v_children_per_parent));
 
-        /* "discretize/_extensions/tree_ext.pyx":5059
+        /* "discretize/_extensions/tree_ext.pyx":5054
  *                     J[2*ind+1] = next_cell.index
  *                     V[2*ind  ] = w/children_per_parent
  *                     V[2*ind+1] = (1.0-w)/children_per_parent             # <<<<<<<<<<<<<<
  *             else:
  *                 #should mean next cell is not a leaf so need to loop over children
  */
-        __Pyx_TraceLine(5059,0,__PYX_ERR(0, 5059, __pyx_L1_error))
+        __Pyx_TraceLine(5054,0,__PYX_ERR(0, 5054, __pyx_L1_error))
         __pyx_t_17 = (1.0 - __pyx_v_w);
         if (unlikely(__pyx_v_children_per_parent == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5059, __pyx_L1_error)
+          __PYX_ERR(0, 5054, __pyx_L1_error)
         }
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5059, __pyx_L1_error)
+          __PYX_ERR(0, 5054, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_t_17 / ((double)__pyx_v_children_per_parent));
       }
       __pyx_L10:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5036
+      /* "discretize/_extensions/tree_ext.pyx":5031
  *                 V[2*ind  ] = 1.0
  * 
  *             if next_cell.is_leaf():             # <<<<<<<<<<<<<<
  *                 if next_cell.level == cell.level:
  *                     #I am on the same level and easy to interpolate
  */
       goto __pyx_L9;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5062
+    /* "discretize/_extensions/tree_ext.pyx":5057
  *             else:
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 ind_parent = cell.faces[5].index             # <<<<<<<<<<<<<<
  *                 w = (next_cell.children[0].location[2] - cell.faces[5].location[2])/(
  *                      next_cell.children[0].location[2] - cell.location[2])
  */
-    __Pyx_TraceLine(5062,0,__PYX_ERR(0, 5062, __pyx_L1_error))
+    __Pyx_TraceLine(5057,0,__PYX_ERR(0, 5057, __pyx_L1_error))
     /*else*/ {
       __pyx_t_10 = (__pyx_v_cell->faces[5])->index;
       __pyx_v_ind_parent = __pyx_t_10;
 
-      /* "discretize/_extensions/tree_ext.pyx":5063
+      /* "discretize/_extensions/tree_ext.pyx":5058
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 ind_parent = cell.faces[5].index
  *                 w = (next_cell.children[0].location[2] - cell.faces[5].location[2])/(             # <<<<<<<<<<<<<<
  *                      next_cell.children[0].location[2] - cell.location[2])
  *                 for i in range(4): # four neighbors in +x direction
  */
-      __Pyx_TraceLine(5063,0,__PYX_ERR(0, 5063, __pyx_L1_error))
+      __Pyx_TraceLine(5058,0,__PYX_ERR(0, 5058, __pyx_L1_error))
       __pyx_t_17 = (((__pyx_v_next_cell->children[0])->location[2]) - ((__pyx_v_cell->faces[5])->location[2]));
 
-      /* "discretize/_extensions/tree_ext.pyx":5064
+      /* "discretize/_extensions/tree_ext.pyx":5059
  *                 ind_parent = cell.faces[5].index
  *                 w = (next_cell.children[0].location[2] - cell.faces[5].location[2])/(
  *                      next_cell.children[0].location[2] - cell.location[2])             # <<<<<<<<<<<<<<
  *                 for i in range(4): # four neighbors in +x direction
  *                     child = next_cell.children[i]
  */
-      __Pyx_TraceLine(5064,0,__PYX_ERR(0, 5064, __pyx_L1_error))
+      __Pyx_TraceLine(5059,0,__PYX_ERR(0, 5059, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_next_cell->children[0])->location[2]) - (__pyx_v_cell->location[2]));
 
-      /* "discretize/_extensions/tree_ext.pyx":5063
+      /* "discretize/_extensions/tree_ext.pyx":5058
  *                 #should mean next cell is not a leaf so need to loop over children
  *                 ind_parent = cell.faces[5].index
  *                 w = (next_cell.children[0].location[2] - cell.faces[5].location[2])/(             # <<<<<<<<<<<<<<
  *                      next_cell.children[0].location[2] - cell.location[2])
  *                 for i in range(4): # four neighbors in +x direction
  */
-      __Pyx_TraceLine(5063,0,__PYX_ERR(0, 5063, __pyx_L1_error))
+      __Pyx_TraceLine(5058,0,__PYX_ERR(0, 5058, __pyx_L1_error))
       if (unlikely(__pyx_t_18 == 0)) {
         PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-        __PYX_ERR(0, 5063, __pyx_L1_error)
+        __PYX_ERR(0, 5058, __pyx_L1_error)
       }
       __pyx_v_w = (__pyx_t_17 / __pyx_t_18);
 
-      /* "discretize/_extensions/tree_ext.pyx":5065
+      /* "discretize/_extensions/tree_ext.pyx":5060
  *                 w = (next_cell.children[0].location[2] - cell.faces[5].location[2])/(
  *                      next_cell.children[0].location[2] - cell.location[2])
  *                 for i in range(4): # four neighbors in +x direction             # <<<<<<<<<<<<<<
  *                     child = next_cell.children[i]
  *                     ind = child.faces[4].index #0 1 2 3
  */
-      __Pyx_TraceLine(5065,0,__PYX_ERR(0, 5065, __pyx_L1_error))
+      __Pyx_TraceLine(5060,0,__PYX_ERR(0, 5060, __pyx_L1_error))
       for (__pyx_t_19 = 0; __pyx_t_19 < 4; __pyx_t_19+=1) {
         __pyx_v_i = __pyx_t_19;
 
-        /* "discretize/_extensions/tree_ext.pyx":5066
+        /* "discretize/_extensions/tree_ext.pyx":5061
  *                      next_cell.children[0].location[2] - cell.location[2])
  *                 for i in range(4): # four neighbors in +x direction
  *                     child = next_cell.children[i]             # <<<<<<<<<<<<<<
  *                     ind = child.faces[4].index #0 1 2 3
  *                     I[2*ind    ] = ind_parent
  */
-        __Pyx_TraceLine(5066,0,__PYX_ERR(0, 5066, __pyx_L1_error))
+        __Pyx_TraceLine(5061,0,__PYX_ERR(0, 5061, __pyx_L1_error))
         __pyx_v_child = (__pyx_v_next_cell->children[__pyx_v_i]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5067
+        /* "discretize/_extensions/tree_ext.pyx":5062
  *                 for i in range(4): # four neighbors in +x direction
  *                     child = next_cell.children[i]
  *                     ind = child.faces[4].index #0 1 2 3             # <<<<<<<<<<<<<<
  *                     I[2*ind    ] = ind_parent
  *                     I[2*ind + 1] = ind_parent
  */
-        __Pyx_TraceLine(5067,0,__PYX_ERR(0, 5067, __pyx_L1_error))
+        __Pyx_TraceLine(5062,0,__PYX_ERR(0, 5062, __pyx_L1_error))
         __pyx_t_10 = (__pyx_v_child->faces[4])->index;
         __pyx_v_ind = __pyx_t_10;
 
-        /* "discretize/_extensions/tree_ext.pyx":5068
+        /* "discretize/_extensions/tree_ext.pyx":5063
  *                     child = next_cell.children[i]
  *                     ind = child.faces[4].index #0 1 2 3
  *                     I[2*ind    ] = ind_parent             # <<<<<<<<<<<<<<
  *                     I[2*ind + 1] = ind_parent
  *                     J[2*ind    ] = cell.index
  */
-        __Pyx_TraceLine(5068,0,__PYX_ERR(0, 5068, __pyx_L1_error))
+        __Pyx_TraceLine(5063,0,__PYX_ERR(0, 5063, __pyx_L1_error))
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5068, __pyx_L1_error)
+          __PYX_ERR(0, 5063, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-        /* "discretize/_extensions/tree_ext.pyx":5069
+        /* "discretize/_extensions/tree_ext.pyx":5064
  *                     ind = child.faces[4].index #0 1 2 3
  *                     I[2*ind    ] = ind_parent
  *                     I[2*ind + 1] = ind_parent             # <<<<<<<<<<<<<<
  *                     J[2*ind    ] = cell.index
  *                     J[2*ind + 1] = child.index
  */
-        __Pyx_TraceLine(5069,0,__PYX_ERR(0, 5069, __pyx_L1_error))
+        __Pyx_TraceLine(5064,0,__PYX_ERR(0, 5064, __pyx_L1_error))
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_I.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_I.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5069, __pyx_L1_error)
+          __PYX_ERR(0, 5064, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_I.data + __pyx_t_14 * __pyx_v_I.strides[0]) )) = __pyx_v_ind_parent;
 
-        /* "discretize/_extensions/tree_ext.pyx":5070
+        /* "discretize/_extensions/tree_ext.pyx":5065
  *                     I[2*ind    ] = ind_parent
  *                     I[2*ind + 1] = ind_parent
  *                     J[2*ind    ] = cell.index             # <<<<<<<<<<<<<<
  *                     J[2*ind + 1] = child.index
  *                     V[2*ind    ] = w/children_per_parent
  */
-        __Pyx_TraceLine(5070,0,__PYX_ERR(0, 5070, __pyx_L1_error))
+        __Pyx_TraceLine(5065,0,__PYX_ERR(0, 5065, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_cell->index;
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5070, __pyx_L1_error)
+          __PYX_ERR(0, 5065, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":5071
+        /* "discretize/_extensions/tree_ext.pyx":5066
  *                     I[2*ind + 1] = ind_parent
  *                     J[2*ind    ] = cell.index
  *                     J[2*ind + 1] = child.index             # <<<<<<<<<<<<<<
  *                     V[2*ind    ] = w/children_per_parent
  *                     V[2*ind + 1] = (1.0-w)/children_per_parent
  */
-        __Pyx_TraceLine(5071,0,__PYX_ERR(0, 5071, __pyx_L1_error))
+        __Pyx_TraceLine(5066,0,__PYX_ERR(0, 5066, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_child->index;
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_J.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_J.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5071, __pyx_L1_error)
+          __PYX_ERR(0, 5066, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_14 * __pyx_v_J.strides[0]) )) = __pyx_t_16;
 
-        /* "discretize/_extensions/tree_ext.pyx":5072
+        /* "discretize/_extensions/tree_ext.pyx":5067
  *                     J[2*ind    ] = cell.index
  *                     J[2*ind + 1] = child.index
  *                     V[2*ind    ] = w/children_per_parent             # <<<<<<<<<<<<<<
  *                     V[2*ind + 1] = (1.0-w)/children_per_parent
  * 
  */
-        __Pyx_TraceLine(5072,0,__PYX_ERR(0, 5072, __pyx_L1_error))
+        __Pyx_TraceLine(5067,0,__PYX_ERR(0, 5067, __pyx_L1_error))
         if (unlikely(__pyx_v_children_per_parent == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5072, __pyx_L1_error)
+          __PYX_ERR(0, 5067, __pyx_L1_error)
         }
         __pyx_t_14 = (2 * __pyx_v_ind);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5072, __pyx_L1_error)
+          __PYX_ERR(0, 5067, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_v_w / ((double)__pyx_v_children_per_parent));
 
-        /* "discretize/_extensions/tree_ext.pyx":5073
+        /* "discretize/_extensions/tree_ext.pyx":5068
  *                     J[2*ind + 1] = child.index
  *                     V[2*ind    ] = w/children_per_parent
  *                     V[2*ind + 1] = (1.0-w)/children_per_parent             # <<<<<<<<<<<<<<
  * 
  *         self._average_cell_to_face_z = sp.csr_matrix((V, (I,J)), shape=(self.n_faces_z, self.n_cells))
  */
-        __Pyx_TraceLine(5073,0,__PYX_ERR(0, 5073, __pyx_L1_error))
+        __Pyx_TraceLine(5068,0,__PYX_ERR(0, 5068, __pyx_L1_error))
         __pyx_t_18 = (1.0 - __pyx_v_w);
         if (unlikely(__pyx_v_children_per_parent == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5073, __pyx_L1_error)
+          __PYX_ERR(0, 5068, __pyx_L1_error)
         }
         __pyx_t_14 = ((2 * __pyx_v_ind) + 1);
         __pyx_t_15 = -1;
         if (__pyx_t_14 < 0) {
           __pyx_t_14 += __pyx_v_V.shape[0];
           if (unlikely(__pyx_t_14 < 0)) __pyx_t_15 = 0;
         } else if (unlikely(__pyx_t_14 >= __pyx_v_V.shape[0])) __pyx_t_15 = 0;
         if (unlikely(__pyx_t_15 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_15);
-          __PYX_ERR(0, 5073, __pyx_L1_error)
+          __PYX_ERR(0, 5068, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_14 * __pyx_v_V.strides[0]) )) = (__pyx_t_18 / ((double)__pyx_v_children_per_parent));
       }
     }
     __pyx_L9:;
 
-    /* "discretize/_extensions/tree_ext.pyx":5020
+    /* "discretize/_extensions/tree_ext.pyx":5015
  *         cdef double w
  * 
  *         for cell in self.tree.cells :             # <<<<<<<<<<<<<<
  *             next_cell = cell.neighbors[5]
  *             prev_cell = cell.neighbors[4]
  */
-    __Pyx_TraceLine(5020,0,__PYX_ERR(0, 5020, __pyx_L1_error))
+    __Pyx_TraceLine(5015,0,__PYX_ERR(0, 5015, __pyx_L1_error))
     __pyx_L5_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5075
+  /* "discretize/_extensions/tree_ext.pyx":5070
  *                     V[2*ind + 1] = (1.0-w)/children_per_parent
  * 
  *         self._average_cell_to_face_z = sp.csr_matrix((V, (I,J)), shape=(self.n_faces_z, self.n_cells))             # <<<<<<<<<<<<<<
  *         return self._average_cell_to_face_z
  * 
  */
-  __Pyx_TraceLine(5075,0,__PYX_ERR(0, 5075, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __Pyx_TraceLine(5070,0,__PYX_ERR(0, 5070, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_sp); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
   __pyx_t_6 = 0;
   __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
   __pyx_t_1 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces_z); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_20 = PyTuple_New(2); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_20 = PyTuple_New(2); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_20);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_20, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_20, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_20) < 0) __PYX_ERR(0, 5075, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shape, __pyx_t_20) < 0) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_20); __pyx_t_20 = 0;
-  __pyx_t_20 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 5075, __pyx_L1_error)
+  __pyx_t_20 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 5070, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_20);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_GIVEREF(__pyx_t_20);
   __Pyx_GOTREF(__pyx_v_self->_average_cell_to_face_z);
   __Pyx_DECREF(__pyx_v_self->_average_cell_to_face_z);
   __pyx_v_self->_average_cell_to_face_z = __pyx_t_20;
   __pyx_t_20 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5076
+  /* "discretize/_extensions/tree_ext.pyx":5071
  * 
  *         self._average_cell_to_face_z = sp.csr_matrix((V, (I,J)), shape=(self.n_faces_z, self.n_cells))
  *         return self._average_cell_to_face_z             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(5076,0,__PYX_ERR(0, 5076, __pyx_L1_error))
+  __Pyx_TraceLine(5071,0,__PYX_ERR(0, 5071, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->_average_cell_to_face_z);
   __pyx_r = __pyx_v_self->_average_cell_to_face_z;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":4992
+  /* "discretize/_extensions/tree_ext.pyx":4987
  * 
  *     @property
  *     def average_cell_to_face_z(self):             # <<<<<<<<<<<<<<
  *         """Averaging operator from cell centers to z faces (scalar quantities).
  * 
  */
 
@@ -59272,15 +59284,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_V, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5079
+/* "discretize/_extensions/tree_ext.pyx":5074
  * 
  *     @property
  *     def project_face_to_boundary_face(self):             # <<<<<<<<<<<<<<
  *         r"""Projection matrix from all faces to boundary faces.
  * 
  */
 
@@ -59319,372 +59331,372 @@
   PyObject *__pyx_t_6 = NULL;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 5079, 0, __PYX_ERR(0, 5079, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 5074, 0, __PYX_ERR(0, 5074, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5095
+  /* "discretize/_extensions/tree_ext.pyx":5090
  *             (n_boundary_faces, n_faces) Projection matrix with shape
  *         """
  *         faces_x = self.faces_x             # <<<<<<<<<<<<<<
  *         faces_y = self.faces_y
  * 
  */
-  __Pyx_TraceLine(5095,0,__PYX_ERR(0, 5095, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_faces_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5095, __pyx_L1_error)
+  __Pyx_TraceLine(5090,0,__PYX_ERR(0, 5090, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_faces_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5090, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_faces_x = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5096
+  /* "discretize/_extensions/tree_ext.pyx":5091
  *         """
  *         faces_x = self.faces_x
  *         faces_y = self.faces_y             # <<<<<<<<<<<<<<
  * 
  *         x0, xF = self._xs[0], self._xs[-1]
  */
-  __Pyx_TraceLine(5096,0,__PYX_ERR(0, 5096, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_faces_y); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5096, __pyx_L1_error)
+  __Pyx_TraceLine(5091,0,__PYX_ERR(0, 5091, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_faces_y); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5091, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_faces_y = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5098
+  /* "discretize/_extensions/tree_ext.pyx":5093
  *         faces_y = self.faces_y
  * 
  *         x0, xF = self._xs[0], self._xs[-1]             # <<<<<<<<<<<<<<
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_b = np.r_[
  */
-  __Pyx_TraceLine(5098,0,__PYX_ERR(0, 5098, __pyx_L1_error))
-  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5098, __pyx_L1_error)}
+  __Pyx_TraceLine(5093,0,__PYX_ERR(0, 5093, __pyx_L1_error))
+  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5093, __pyx_L1_error)}
   __pyx_t_2 = 0;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_xs.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_xs.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5098, __pyx_L1_error)
+    __PYX_ERR(0, 5093, __pyx_L1_error)
   }
-  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5098, __pyx_L1_error)
+  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5093, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5098, __pyx_L1_error)}
+  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5093, __pyx_L1_error)}
   __pyx_t_2 = -1L;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_xs.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_xs.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5098, __pyx_L1_error)
+    __PYX_ERR(0, 5093, __pyx_L1_error)
   }
-  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5098, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5093, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_v_x0 = __pyx_t_1;
   __pyx_t_1 = 0;
   __pyx_v_xF = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5099
+  /* "discretize/_extensions/tree_ext.pyx":5094
  * 
  *         x0, xF = self._xs[0], self._xs[-1]
  *         y0, yF = self._ys[0], self._ys[-1]             # <<<<<<<<<<<<<<
  *         is_b = np.r_[
  *             (faces_x[:, 0] == x0) | (faces_x[:, 0] == xF),
  */
-  __Pyx_TraceLine(5099,0,__PYX_ERR(0, 5099, __pyx_L1_error))
-  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5099, __pyx_L1_error)}
+  __Pyx_TraceLine(5094,0,__PYX_ERR(0, 5094, __pyx_L1_error))
+  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5094, __pyx_L1_error)}
   __pyx_t_2 = 0;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_ys.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_ys.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5099, __pyx_L1_error)
+    __PYX_ERR(0, 5094, __pyx_L1_error)
   }
-  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5099, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5094, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5099, __pyx_L1_error)}
+  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5094, __pyx_L1_error)}
   __pyx_t_2 = -1L;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_ys.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_ys.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5099, __pyx_L1_error)
+    __PYX_ERR(0, 5094, __pyx_L1_error)
   }
-  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5099, __pyx_L1_error)
+  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5094, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_y0 = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_v_yF = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5100
+  /* "discretize/_extensions/tree_ext.pyx":5095
  *         x0, xF = self._xs[0], self._xs[-1]
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_b = np.r_[             # <<<<<<<<<<<<<<
  *             (faces_x[:, 0] == x0) | (faces_x[:, 0] == xF),
  *             (faces_y[:, 1] == y0) | (faces_y[:, 1] == yF)
  */
-  __Pyx_TraceLine(5100,0,__PYX_ERR(0, 5100, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5100, __pyx_L1_error)
+  __Pyx_TraceLine(5095,0,__PYX_ERR(0, 5095, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5095, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_r); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5100, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_r); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5095, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5101
+  /* "discretize/_extensions/tree_ext.pyx":5096
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_b = np.r_[
  *             (faces_x[:, 0] == x0) | (faces_x[:, 0] == xF),             # <<<<<<<<<<<<<<
  *             (faces_y[:, 1] == y0) | (faces_y[:, 1] == yF)
  *         ]
  */
-  __Pyx_TraceLine(5101,0,__PYX_ERR(0, 5101, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_faces_x, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5101, __pyx_L1_error)
+  __Pyx_TraceLine(5096,0,__PYX_ERR(0, 5096, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_faces_x, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5096, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_x0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5101, __pyx_L1_error)
+  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_x0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5096, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_faces_x, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5101, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_faces_x, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5096, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, __pyx_v_xF, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5101, __pyx_L1_error)
+  __pyx_t_6 = PyObject_RichCompare(__pyx_t_1, __pyx_v_xF, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5096, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyNumber_Or(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5101, __pyx_L1_error)
+  __pyx_t_1 = PyNumber_Or(__pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5096, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5102
+  /* "discretize/_extensions/tree_ext.pyx":5097
  *         is_b = np.r_[
  *             (faces_x[:, 0] == x0) | (faces_x[:, 0] == xF),
  *             (faces_y[:, 1] == y0) | (faces_y[:, 1] == yF)             # <<<<<<<<<<<<<<
  *         ]
  *         if self.dim == 3:
  */
-  __Pyx_TraceLine(5102,0,__PYX_ERR(0, 5102, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_faces_y, __pyx_tuple__22); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5102, __pyx_L1_error)
+  __Pyx_TraceLine(5097,0,__PYX_ERR(0, 5097, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_faces_y, __pyx_tuple__22); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5097, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_v_y0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5102, __pyx_L1_error)
+  __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_v_y0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5097, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_faces_y, __pyx_tuple__22); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5102, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_faces_y, __pyx_tuple__22); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5097, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyObject_RichCompare(__pyx_t_6, __pyx_v_yF, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5102, __pyx_L1_error)
+  __pyx_t_7 = PyObject_RichCompare(__pyx_t_6, __pyx_v_yF, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5097, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Or(__pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5102, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Or(__pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5097, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5100
+  /* "discretize/_extensions/tree_ext.pyx":5095
  *         x0, xF = self._xs[0], self._xs[-1]
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_b = np.r_[             # <<<<<<<<<<<<<<
  *             (faces_x[:, 0] == x0) | (faces_x[:, 0] == xF),
  *             (faces_y[:, 1] == y0) | (faces_y[:, 1] == yF)
  */
-  __Pyx_TraceLine(5100,0,__PYX_ERR(0, 5100, __pyx_L1_error))
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5100, __pyx_L1_error)
+  __Pyx_TraceLine(5095,0,__PYX_ERR(0, 5095, __pyx_L1_error))
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5095, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_1 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5100, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5095, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_is_b = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5104
+  /* "discretize/_extensions/tree_ext.pyx":5099
  *             (faces_y[:, 1] == y0) | (faces_y[:, 1] == yF)
  *         ]
  *         if self.dim == 3:             # <<<<<<<<<<<<<<
  *             faces_z = self.faces_z
  *             z0, zF = self._zs[0], self._zs[-1]
  */
-  __Pyx_TraceLine(5104,0,__PYX_ERR(0, 5104, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5104, __pyx_L1_error)
+  __Pyx_TraceLine(5099,0,__PYX_ERR(0, 5099, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5099, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyInt_EqObjC(__pyx_t_6, __pyx_int_3, 3, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5104, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_EqObjC(__pyx_t_6, __pyx_int_3, 3, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5099, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 5104, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 5099, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5105
+    /* "discretize/_extensions/tree_ext.pyx":5100
  *         ]
  *         if self.dim == 3:
  *             faces_z = self.faces_z             # <<<<<<<<<<<<<<
  *             z0, zF = self._zs[0], self._zs[-1]
  *             is_b = np.r_[
  */
-    __Pyx_TraceLine(5105,0,__PYX_ERR(0, 5105, __pyx_L1_error))
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_faces_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5105, __pyx_L1_error)
+    __Pyx_TraceLine(5100,0,__PYX_ERR(0, 5100, __pyx_L1_error))
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_faces_z); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5100, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __pyx_v_faces_z = __pyx_t_7;
     __pyx_t_7 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5106
+    /* "discretize/_extensions/tree_ext.pyx":5101
  *         if self.dim == 3:
  *             faces_z = self.faces_z
  *             z0, zF = self._zs[0], self._zs[-1]             # <<<<<<<<<<<<<<
  *             is_b = np.r_[
  *                 is_b,
  */
-    __Pyx_TraceLine(5106,0,__PYX_ERR(0, 5106, __pyx_L1_error))
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5106, __pyx_L1_error)}
+    __Pyx_TraceLine(5101,0,__PYX_ERR(0, 5101, __pyx_L1_error))
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5101, __pyx_L1_error)}
     __pyx_t_2 = 0;
     __pyx_t_3 = -1;
     if (__pyx_t_2 < 0) {
       __pyx_t_2 += __pyx_v_self->_zs.shape[0];
       if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
     } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_zs.shape[0])) __pyx_t_3 = 0;
     if (unlikely(__pyx_t_3 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_3);
-      __PYX_ERR(0, 5106, __pyx_L1_error)
+      __PYX_ERR(0, 5101, __pyx_L1_error)
     }
-    __pyx_t_7 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5106, __pyx_L1_error)
+    __pyx_t_7 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5101, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5106, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5101, __pyx_L1_error)}
     __pyx_t_2 = -1L;
     __pyx_t_3 = -1;
     if (__pyx_t_2 < 0) {
       __pyx_t_2 += __pyx_v_self->_zs.shape[0];
       if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
     } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_zs.shape[0])) __pyx_t_3 = 0;
     if (unlikely(__pyx_t_3 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_3);
-      __PYX_ERR(0, 5106, __pyx_L1_error)
+      __PYX_ERR(0, 5101, __pyx_L1_error)
     }
-    __pyx_t_6 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5106, __pyx_L1_error)
+    __pyx_t_6 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5101, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_v_z0 = __pyx_t_7;
     __pyx_t_7 = 0;
     __pyx_v_zF = __pyx_t_6;
     __pyx_t_6 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5107
+    /* "discretize/_extensions/tree_ext.pyx":5102
  *             faces_z = self.faces_z
  *             z0, zF = self._zs[0], self._zs[-1]
  *             is_b = np.r_[             # <<<<<<<<<<<<<<
  *                 is_b,
  *                 (faces_z[:, 2] == z0) | (faces_z[:, 2] == zF)
  */
-    __Pyx_TraceLine(5107,0,__PYX_ERR(0, 5107, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5107, __pyx_L1_error)
+    __Pyx_TraceLine(5102,0,__PYX_ERR(0, 5102, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_r); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5107, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_r); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5109
+    /* "discretize/_extensions/tree_ext.pyx":5104
  *             is_b = np.r_[
  *                 is_b,
  *                 (faces_z[:, 2] == z0) | (faces_z[:, 2] == zF)             # <<<<<<<<<<<<<<
  *             ]
  *         return sp.eye(self.n_faces, format='csr')[is_b]
  */
-    __Pyx_TraceLine(5109,0,__PYX_ERR(0, 5109, __pyx_L1_error))
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_faces_z, __pyx_tuple__23); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5109, __pyx_L1_error)
+    __Pyx_TraceLine(5104,0,__PYX_ERR(0, 5104, __pyx_L1_error))
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_faces_z, __pyx_tuple__23); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5104, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_v_z0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5109, __pyx_L1_error)
+    __pyx_t_4 = PyObject_RichCompare(__pyx_t_6, __pyx_v_z0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5104, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_faces_z, __pyx_tuple__23); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5109, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_faces_z, __pyx_tuple__23); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5104, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_1 = PyObject_RichCompare(__pyx_t_6, __pyx_v_zF, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5109, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_t_6, __pyx_v_zF, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5104, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = PyNumber_Or(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5109, __pyx_L1_error)
+    __pyx_t_6 = PyNumber_Or(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5104, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5107
+    /* "discretize/_extensions/tree_ext.pyx":5102
  *             faces_z = self.faces_z
  *             z0, zF = self._zs[0], self._zs[-1]
  *             is_b = np.r_[             # <<<<<<<<<<<<<<
  *                 is_b,
  *                 (faces_z[:, 2] == z0) | (faces_z[:, 2] == zF)
  */
-    __Pyx_TraceLine(5107,0,__PYX_ERR(0, 5107, __pyx_L1_error))
-    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5107, __pyx_L1_error)
+    __Pyx_TraceLine(5102,0,__PYX_ERR(0, 5102, __pyx_L1_error))
+    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_v_is_b);
     __Pyx_GIVEREF(__pyx_v_is_b);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_is_b);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5107, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5102, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF_SET(__pyx_v_is_b, __pyx_t_6);
     __pyx_t_6 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5104
+    /* "discretize/_extensions/tree_ext.pyx":5099
  *             (faces_y[:, 1] == y0) | (faces_y[:, 1] == yF)
  *         ]
  *         if self.dim == 3:             # <<<<<<<<<<<<<<
  *             faces_z = self.faces_z
  *             z0, zF = self._zs[0], self._zs[-1]
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5111
+  /* "discretize/_extensions/tree_ext.pyx":5106
  *                 (faces_z[:, 2] == z0) | (faces_z[:, 2] == zF)
  *             ]
  *         return sp.eye(self.n_faces, format='csr')[is_b]             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(5111,0,__PYX_ERR(0, 5111, __pyx_L1_error))
+  __Pyx_TraceLine(5106,0,__PYX_ERR(0, 5106, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5111, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_eye); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5111, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_eye); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5111, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_faces); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5111, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5111, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_format, __pyx_n_u_csr) < 0) __PYX_ERR(0, 5111, __pyx_L1_error)
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5111, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_format, __pyx_n_u_csr) < 0) __PYX_ERR(0, 5106, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_is_b); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5111, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_is_b); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_6;
   __pyx_t_6 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5079
+  /* "discretize/_extensions/tree_ext.pyx":5074
  * 
  *     @property
  *     def project_face_to_boundary_face(self):             # <<<<<<<<<<<<<<
  *         r"""Projection matrix from all faces to boundary faces.
  * 
  */
 
@@ -59710,15 +59722,15 @@
   __Pyx_XDECREF(__pyx_v_zF);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5114
+/* "discretize/_extensions/tree_ext.pyx":5109
  * 
  *     @property
  *     def project_edge_to_boundary_edge(self):             # <<<<<<<<<<<<<<
  *         r"""Projection matrix from all edges to boundary edges.
  * 
  */
 
@@ -59759,462 +59771,462 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 5114, 0, __PYX_ERR(0, 5114, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 5109, 0, __PYX_ERR(0, 5109, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5130
+  /* "discretize/_extensions/tree_ext.pyx":5125
  *             Projection matrix with shape
  *         """
  *         edges_x = self.edges_x             # <<<<<<<<<<<<<<
  *         edges_y = self.edges_y
  * 
  */
-  __Pyx_TraceLine(5130,0,__PYX_ERR(0, 5130, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_edges_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5130, __pyx_L1_error)
+  __Pyx_TraceLine(5125,0,__PYX_ERR(0, 5125, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_edges_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5125, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_edges_x = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5131
+  /* "discretize/_extensions/tree_ext.pyx":5126
  *         """
  *         edges_x = self.edges_x
  *         edges_y = self.edges_y             # <<<<<<<<<<<<<<
  * 
  *         x0, xF = self._xs[0], self._xs[-1]
  */
-  __Pyx_TraceLine(5131,0,__PYX_ERR(0, 5131, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_edges_y); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5131, __pyx_L1_error)
+  __Pyx_TraceLine(5126,0,__PYX_ERR(0, 5126, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_edges_y); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5126, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_edges_y = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5133
+  /* "discretize/_extensions/tree_ext.pyx":5128
  *         edges_y = self.edges_y
  * 
  *         x0, xF = self._xs[0], self._xs[-1]             # <<<<<<<<<<<<<<
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_bx = (edges_x[:, 1] == y0) | (edges_x[:, 1] == yF)
  */
-  __Pyx_TraceLine(5133,0,__PYX_ERR(0, 5133, __pyx_L1_error))
-  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5133, __pyx_L1_error)}
+  __Pyx_TraceLine(5128,0,__PYX_ERR(0, 5128, __pyx_L1_error))
+  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5128, __pyx_L1_error)}
   __pyx_t_2 = 0;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_xs.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_xs.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5133, __pyx_L1_error)
+    __PYX_ERR(0, 5128, __pyx_L1_error)
   }
-  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5133, __pyx_L1_error)
+  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5128, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5133, __pyx_L1_error)}
+  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5128, __pyx_L1_error)}
   __pyx_t_2 = -1L;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_xs.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_xs.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5133, __pyx_L1_error)
+    __PYX_ERR(0, 5128, __pyx_L1_error)
   }
-  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5133, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5128, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_v_x0 = __pyx_t_1;
   __pyx_t_1 = 0;
   __pyx_v_xF = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5134
+  /* "discretize/_extensions/tree_ext.pyx":5129
  * 
  *         x0, xF = self._xs[0], self._xs[-1]
  *         y0, yF = self._ys[0], self._ys[-1]             # <<<<<<<<<<<<<<
  *         is_bx = (edges_x[:, 1] == y0) | (edges_x[:, 1] == yF)
  *         is_by = (edges_y[:, 0] == x0) | (edges_y[:, 0] == xF)
  */
-  __Pyx_TraceLine(5134,0,__PYX_ERR(0, 5134, __pyx_L1_error))
-  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5134, __pyx_L1_error)}
+  __Pyx_TraceLine(5129,0,__PYX_ERR(0, 5129, __pyx_L1_error))
+  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5129, __pyx_L1_error)}
   __pyx_t_2 = 0;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_ys.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_ys.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5134, __pyx_L1_error)
+    __PYX_ERR(0, 5129, __pyx_L1_error)
   }
-  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5134, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5129, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5134, __pyx_L1_error)}
+  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5129, __pyx_L1_error)}
   __pyx_t_2 = -1L;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_ys.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_ys.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5134, __pyx_L1_error)
+    __PYX_ERR(0, 5129, __pyx_L1_error)
   }
-  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5134, __pyx_L1_error)
+  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5129, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_y0 = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_v_yF = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5135
+  /* "discretize/_extensions/tree_ext.pyx":5130
  *         x0, xF = self._xs[0], self._xs[-1]
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_bx = (edges_x[:, 1] == y0) | (edges_x[:, 1] == yF)             # <<<<<<<<<<<<<<
  *         is_by = (edges_y[:, 0] == x0) | (edges_y[:, 0] == xF)
  *         if self.dim == 3:
  */
-  __Pyx_TraceLine(5135,0,__PYX_ERR(0, 5135, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_x, __pyx_tuple__22); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5135, __pyx_L1_error)
+  __Pyx_TraceLine(5130,0,__PYX_ERR(0, 5130, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_x, __pyx_tuple__22); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5130, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_y0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5135, __pyx_L1_error)
+  __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_y0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5130, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_x, __pyx_tuple__22); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5135, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_x, __pyx_tuple__22); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5130, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_yF, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5135, __pyx_L1_error)
+  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_yF, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5130, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5135, __pyx_L1_error)
+  __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5130, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_is_bx = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5136
+  /* "discretize/_extensions/tree_ext.pyx":5131
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_bx = (edges_x[:, 1] == y0) | (edges_x[:, 1] == yF)
  *         is_by = (edges_y[:, 0] == x0) | (edges_y[:, 0] == xF)             # <<<<<<<<<<<<<<
  *         if self.dim == 3:
  *             z0, zF = self._zs[0], self._zs[-1]
  */
-  __Pyx_TraceLine(5136,0,__PYX_ERR(0, 5136, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_y, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5136, __pyx_L1_error)
+  __Pyx_TraceLine(5131,0,__PYX_ERR(0, 5131, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_y, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5131, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_x0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5136, __pyx_L1_error)
+  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_x0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5131, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_y, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5136, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_y, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5131, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_xF, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5136, __pyx_L1_error)
+  __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_xF, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5131, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyNumber_Or(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5136, __pyx_L1_error)
+  __pyx_t_1 = PyNumber_Or(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5131, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_is_by = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5137
+  /* "discretize/_extensions/tree_ext.pyx":5132
  *         is_bx = (edges_x[:, 1] == y0) | (edges_x[:, 1] == yF)
  *         is_by = (edges_y[:, 0] == x0) | (edges_y[:, 0] == xF)
  *         if self.dim == 3:             # <<<<<<<<<<<<<<
  *             z0, zF = self._zs[0], self._zs[-1]
  *             edges_z = self.edges_z
  */
-  __Pyx_TraceLine(5137,0,__PYX_ERR(0, 5137, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5137, __pyx_L1_error)
+  __Pyx_TraceLine(5132,0,__PYX_ERR(0, 5132, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_3, 3, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5137, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_3, 3, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5132, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 5137, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 5132, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_6) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5138
+    /* "discretize/_extensions/tree_ext.pyx":5133
  *         is_by = (edges_y[:, 0] == x0) | (edges_y[:, 0] == xF)
  *         if self.dim == 3:
  *             z0, zF = self._zs[0], self._zs[-1]             # <<<<<<<<<<<<<<
  *             edges_z = self.edges_z
  * 
  */
-    __Pyx_TraceLine(5138,0,__PYX_ERR(0, 5138, __pyx_L1_error))
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5138, __pyx_L1_error)}
+    __Pyx_TraceLine(5133,0,__PYX_ERR(0, 5133, __pyx_L1_error))
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5133, __pyx_L1_error)}
     __pyx_t_2 = 0;
     __pyx_t_3 = -1;
     if (__pyx_t_2 < 0) {
       __pyx_t_2 += __pyx_v_self->_zs.shape[0];
       if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
     } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_zs.shape[0])) __pyx_t_3 = 0;
     if (unlikely(__pyx_t_3 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_3);
-      __PYX_ERR(0, 5138, __pyx_L1_error)
+      __PYX_ERR(0, 5133, __pyx_L1_error)
     }
-    __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5138, __pyx_L1_error)
+    __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5138, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5133, __pyx_L1_error)}
     __pyx_t_2 = -1L;
     __pyx_t_3 = -1;
     if (__pyx_t_2 < 0) {
       __pyx_t_2 += __pyx_v_self->_zs.shape[0];
       if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
     } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_zs.shape[0])) __pyx_t_3 = 0;
     if (unlikely(__pyx_t_3 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_3);
-      __PYX_ERR(0, 5138, __pyx_L1_error)
+      __PYX_ERR(0, 5133, __pyx_L1_error)
     }
-    __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5138, __pyx_L1_error)
+    __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5133, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_z0 = __pyx_t_4;
     __pyx_t_4 = 0;
     __pyx_v_zF = __pyx_t_1;
     __pyx_t_1 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5139
+    /* "discretize/_extensions/tree_ext.pyx":5134
  *         if self.dim == 3:
  *             z0, zF = self._zs[0], self._zs[-1]
  *             edges_z = self.edges_z             # <<<<<<<<<<<<<<
  * 
  *             is_bx |= (edges_x[:, 2] == z0) | (edges_x[:, 2] == zF)
  */
-    __Pyx_TraceLine(5139,0,__PYX_ERR(0, 5139, __pyx_L1_error))
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_edges_z); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5139, __pyx_L1_error)
+    __Pyx_TraceLine(5134,0,__PYX_ERR(0, 5134, __pyx_L1_error))
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_edges_z); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5134, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_v_edges_z = __pyx_t_1;
     __pyx_t_1 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5141
+    /* "discretize/_extensions/tree_ext.pyx":5136
  *             edges_z = self.edges_z
  * 
  *             is_bx |= (edges_x[:, 2] == z0) | (edges_x[:, 2] == zF)             # <<<<<<<<<<<<<<
  *             is_by |= (edges_y[:, 2] == z0) | (edges_y[:, 2] == zF)
  * 
  */
-    __Pyx_TraceLine(5141,0,__PYX_ERR(0, 5141, __pyx_L1_error))
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_x, __pyx_tuple__23); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5141, __pyx_L1_error)
+    __Pyx_TraceLine(5136,0,__PYX_ERR(0, 5136, __pyx_L1_error))
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_x, __pyx_tuple__23); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5136, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_z0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5141, __pyx_L1_error)
+    __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_z0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5136, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_x, __pyx_tuple__23); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5141, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_x, __pyx_tuple__23); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5136, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_zF, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5141, __pyx_L1_error)
+    __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_zF, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5136, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5141, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5136, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_InPlaceOr(__pyx_v_is_bx, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5141, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_InPlaceOr(__pyx_v_is_bx, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5136, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF_SET(__pyx_v_is_bx, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5142
+    /* "discretize/_extensions/tree_ext.pyx":5137
  * 
  *             is_bx |= (edges_x[:, 2] == z0) | (edges_x[:, 2] == zF)
  *             is_by |= (edges_y[:, 2] == z0) | (edges_y[:, 2] == zF)             # <<<<<<<<<<<<<<
  * 
  *             is_bz = (
  */
-    __Pyx_TraceLine(5142,0,__PYX_ERR(0, 5142, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_edges_y, __pyx_tuple__23); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5142, __pyx_L1_error)
+    __Pyx_TraceLine(5137,0,__PYX_ERR(0, 5137, __pyx_L1_error))
+    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_edges_y, __pyx_tuple__23); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_1 = PyObject_RichCompare(__pyx_t_5, __pyx_v_z0, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5142, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_t_5, __pyx_v_z0, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5137, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_edges_y, __pyx_tuple__23); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5142, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_edges_y, __pyx_tuple__23); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_v_zF, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5142, __pyx_L1_error)
+    __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_v_zF, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5137, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5142, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_InPlaceOr(__pyx_v_is_by, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5142, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_InPlaceOr(__pyx_v_is_by, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5137, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF_SET(__pyx_v_is_by, __pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5145
+    /* "discretize/_extensions/tree_ext.pyx":5140
  * 
  *             is_bz = (
  *                 (edges_z[:, 0] == x0)             # <<<<<<<<<<<<<<
  *                 | (edges_z[:, 0] == xF)
  *                 | (edges_z[:, 1] == y0)
  */
-    __Pyx_TraceLine(5145,0,__PYX_ERR(0, 5145, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_edges_z, __pyx_tuple__21); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5145, __pyx_L1_error)
+    __Pyx_TraceLine(5140,0,__PYX_ERR(0, 5140, __pyx_L1_error))
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_edges_z, __pyx_tuple__21); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5140, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_v_x0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5145, __pyx_L1_error)
+    __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_v_x0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5140, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5146
+    /* "discretize/_extensions/tree_ext.pyx":5141
  *             is_bz = (
  *                 (edges_z[:, 0] == x0)
  *                 | (edges_z[:, 0] == xF)             # <<<<<<<<<<<<<<
  *                 | (edges_z[:, 1] == y0)
  *                 | (edges_z[:, 1] == yF)
  */
-    __Pyx_TraceLine(5146,0,__PYX_ERR(0, 5146, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_edges_z, __pyx_tuple__21); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5146, __pyx_L1_error)
+    __Pyx_TraceLine(5141,0,__PYX_ERR(0, 5141, __pyx_L1_error))
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_edges_z, __pyx_tuple__21); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_xF, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5146, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_xF, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5141, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_Or(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5146, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Or(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5141, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5147
+    /* "discretize/_extensions/tree_ext.pyx":5142
  *                 (edges_z[:, 0] == x0)
  *                 | (edges_z[:, 0] == xF)
  *                 | (edges_z[:, 1] == y0)             # <<<<<<<<<<<<<<
  *                 | (edges_z[:, 1] == yF)
  *             )
  */
-    __Pyx_TraceLine(5147,0,__PYX_ERR(0, 5147, __pyx_L1_error))
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_z, __pyx_tuple__22); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5147, __pyx_L1_error)
+    __Pyx_TraceLine(5142,0,__PYX_ERR(0, 5142, __pyx_L1_error))
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_edges_z, __pyx_tuple__22); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_y0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5147, __pyx_L1_error)
+    __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_y0, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5142, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5147, __pyx_L1_error)
+    __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5148
+    /* "discretize/_extensions/tree_ext.pyx":5143
  *                 | (edges_z[:, 0] == xF)
  *                 | (edges_z[:, 1] == y0)
  *                 | (edges_z[:, 1] == yF)             # <<<<<<<<<<<<<<
  *             )
  *             is_b = np.r_[is_bx, is_by, is_bz]
  */
-    __Pyx_TraceLine(5148,0,__PYX_ERR(0, 5148, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_edges_z, __pyx_tuple__22); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5148, __pyx_L1_error)
+    __Pyx_TraceLine(5143,0,__PYX_ERR(0, 5143, __pyx_L1_error))
+    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_edges_z, __pyx_tuple__22); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5143, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_v_yF, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5148, __pyx_L1_error)
+    __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_v_yF, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5143, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5148, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5143, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_v_is_bz = __pyx_t_5;
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5150
+    /* "discretize/_extensions/tree_ext.pyx":5145
  *                 | (edges_z[:, 1] == yF)
  *             )
  *             is_b = np.r_[is_bx, is_by, is_bz]             # <<<<<<<<<<<<<<
  *         else:
  *             is_b = np.r_[is_bx, is_by]
  */
-    __Pyx_TraceLine(5150,0,__PYX_ERR(0, 5150, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5150, __pyx_L1_error)
+    __Pyx_TraceLine(5145,0,__PYX_ERR(0, 5145, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5145, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_r); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5150, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_r); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5145, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5150, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5145, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_INCREF(__pyx_v_is_bx);
     __Pyx_GIVEREF(__pyx_v_is_bx);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_is_bx);
     __Pyx_INCREF(__pyx_v_is_by);
     __Pyx_GIVEREF(__pyx_v_is_by);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_is_by);
     __Pyx_INCREF(__pyx_v_is_bz);
     __Pyx_GIVEREF(__pyx_v_is_bz);
     PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_v_is_bz);
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5150, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5145, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_v_is_b = __pyx_t_1;
     __pyx_t_1 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5137
+    /* "discretize/_extensions/tree_ext.pyx":5132
  *         is_bx = (edges_x[:, 1] == y0) | (edges_x[:, 1] == yF)
  *         is_by = (edges_y[:, 0] == x0) | (edges_y[:, 0] == xF)
  *         if self.dim == 3:             # <<<<<<<<<<<<<<
  *             z0, zF = self._zs[0], self._zs[-1]
  *             edges_z = self.edges_z
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5152
+  /* "discretize/_extensions/tree_ext.pyx":5147
  *             is_b = np.r_[is_bx, is_by, is_bz]
  *         else:
  *             is_b = np.r_[is_bx, is_by]             # <<<<<<<<<<<<<<
  *         return sp.eye(self.n_edges, format='csr')[is_b]
  * 
  */
-  __Pyx_TraceLine(5152,0,__PYX_ERR(0, 5152, __pyx_L1_error))
+  __Pyx_TraceLine(5147,0,__PYX_ERR(0, 5147, __pyx_L1_error))
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5152, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_r); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5152, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_r); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5152, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_v_is_bx);
     __Pyx_GIVEREF(__pyx_v_is_bx);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_is_bx);
     __Pyx_INCREF(__pyx_v_is_by);
     __Pyx_GIVEREF(__pyx_v_is_by);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_is_by);
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5152, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5147, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_v_is_b = __pyx_t_4;
     __pyx_t_4 = 0;
   }
   __pyx_L3:;
 
-  /* "discretize/_extensions/tree_ext.pyx":5153
+  /* "discretize/_extensions/tree_ext.pyx":5148
  *         else:
  *             is_b = np.r_[is_bx, is_by]
  *         return sp.eye(self.n_edges, format='csr')[is_b]             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(5153,0,__PYX_ERR(0, 5153, __pyx_L1_error))
+  __Pyx_TraceLine(5148,0,__PYX_ERR(0, 5148, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5153, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_eye); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5153, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_eye); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5153, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_edges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5153, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5153, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_format, __pyx_n_u_csr) < 0) __PYX_ERR(0, 5153, __pyx_L1_error)
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5153, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_format, __pyx_n_u_csr) < 0) __PYX_ERR(0, 5148, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_v_is_b); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5153, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_v_is_b); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5148, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5114
+  /* "discretize/_extensions/tree_ext.pyx":5109
  * 
  *     @property
  *     def project_edge_to_boundary_edge(self):             # <<<<<<<<<<<<<<
  *         r"""Projection matrix from all edges to boundary edges.
  * 
  */
 
@@ -60242,15 +60254,15 @@
   __Pyx_XDECREF(__pyx_v_is_b);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5156
+/* "discretize/_extensions/tree_ext.pyx":5151
  * 
  *     @property
  *     def project_node_to_boundary_node(self):             # <<<<<<<<<<<<<<
  *         r"""Projection matrix from all nodes to boundary nodes.
  * 
  */
 
@@ -60286,300 +60298,300 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 5156, 0, __PYX_ERR(0, 5156, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 5151, 0, __PYX_ERR(0, 5151, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5172
+  /* "discretize/_extensions/tree_ext.pyx":5167
  *             Projection matrix with shape
  *         """
  *         nodes = self.nodes             # <<<<<<<<<<<<<<
  *         x0, xF = self._xs[0], self._xs[-1]
  *         y0, yF = self._ys[0], self._ys[-1]
  */
-  __Pyx_TraceLine(5172,0,__PYX_ERR(0, 5172, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5172, __pyx_L1_error)
+  __Pyx_TraceLine(5167,0,__PYX_ERR(0, 5167, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5167, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_nodes = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5173
+  /* "discretize/_extensions/tree_ext.pyx":5168
  *         """
  *         nodes = self.nodes
  *         x0, xF = self._xs[0], self._xs[-1]             # <<<<<<<<<<<<<<
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_b = (
  */
-  __Pyx_TraceLine(5173,0,__PYX_ERR(0, 5173, __pyx_L1_error))
-  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5173, __pyx_L1_error)}
+  __Pyx_TraceLine(5168,0,__PYX_ERR(0, 5168, __pyx_L1_error))
+  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5168, __pyx_L1_error)}
   __pyx_t_2 = 0;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_xs.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_xs.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5173, __pyx_L1_error)
+    __PYX_ERR(0, 5168, __pyx_L1_error)
   }
-  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5173, __pyx_L1_error)
+  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5173, __pyx_L1_error)}
+  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5168, __pyx_L1_error)}
   __pyx_t_2 = -1L;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_xs.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_xs.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5173, __pyx_L1_error)
+    __PYX_ERR(0, 5168, __pyx_L1_error)
   }
-  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5173, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_2 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5168, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_v_x0 = __pyx_t_1;
   __pyx_t_1 = 0;
   __pyx_v_xF = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5174
+  /* "discretize/_extensions/tree_ext.pyx":5169
  *         nodes = self.nodes
  *         x0, xF = self._xs[0], self._xs[-1]
  *         y0, yF = self._ys[0], self._ys[-1]             # <<<<<<<<<<<<<<
  *         is_b = (
  *             (nodes[:, 0] == x0)
  */
-  __Pyx_TraceLine(5174,0,__PYX_ERR(0, 5174, __pyx_L1_error))
-  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5174, __pyx_L1_error)}
+  __Pyx_TraceLine(5169,0,__PYX_ERR(0, 5169, __pyx_L1_error))
+  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5169, __pyx_L1_error)}
   __pyx_t_2 = 0;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_ys.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_ys.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5174, __pyx_L1_error)
+    __PYX_ERR(0, 5169, __pyx_L1_error)
   }
-  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5174, __pyx_L1_error)
+  __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5174, __pyx_L1_error)}
+  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5169, __pyx_L1_error)}
   __pyx_t_2 = -1L;
   __pyx_t_3 = -1;
   if (__pyx_t_2 < 0) {
     __pyx_t_2 += __pyx_v_self->_ys.shape[0];
     if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
   } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_ys.shape[0])) __pyx_t_3 = 0;
   if (unlikely(__pyx_t_3 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_3);
-    __PYX_ERR(0, 5174, __pyx_L1_error)
+    __PYX_ERR(0, 5169, __pyx_L1_error)
   }
-  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5174, __pyx_L1_error)
+  __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_2 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5169, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_y0 = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_v_yF = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5176
+  /* "discretize/_extensions/tree_ext.pyx":5171
  *         y0, yF = self._ys[0], self._ys[-1]
  *         is_b = (
  *             (nodes[:, 0] == x0)             # <<<<<<<<<<<<<<
  *             | (nodes[:, 0] == xF)
  *             | (nodes[:, 1] == y0)
  */
-  __Pyx_TraceLine(5176,0,__PYX_ERR(0, 5176, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5176, __pyx_L1_error)
+  __Pyx_TraceLine(5171,0,__PYX_ERR(0, 5171, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5171, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_x0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5176, __pyx_L1_error)
+  __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_x0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5171, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5177
+  /* "discretize/_extensions/tree_ext.pyx":5172
  *         is_b = (
  *             (nodes[:, 0] == x0)
  *             | (nodes[:, 0] == xF)             # <<<<<<<<<<<<<<
  *             | (nodes[:, 1] == y0)
  *             | (nodes[:, 1] == yF)
  */
-  __Pyx_TraceLine(5177,0,__PYX_ERR(0, 5177, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5177, __pyx_L1_error)
+  __Pyx_TraceLine(5172,0,__PYX_ERR(0, 5172, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_xF, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5177, __pyx_L1_error)
+  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_v_xF, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5172, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5177, __pyx_L1_error)
+  __pyx_t_1 = PyNumber_Or(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5172, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5178
+  /* "discretize/_extensions/tree_ext.pyx":5173
  *             (nodes[:, 0] == x0)
  *             | (nodes[:, 0] == xF)
  *             | (nodes[:, 1] == y0)             # <<<<<<<<<<<<<<
  *             | (nodes[:, 1] == yF)
  *         )
  */
-  __Pyx_TraceLine(5178,0,__PYX_ERR(0, 5178, __pyx_L1_error))
-  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__22); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5178, __pyx_L1_error)
+  __Pyx_TraceLine(5173,0,__PYX_ERR(0, 5173, __pyx_L1_error))
+  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__22); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5173, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_v_y0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5178, __pyx_L1_error)
+  __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_v_y0, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5173, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5178, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Or(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5173, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5179
+  /* "discretize/_extensions/tree_ext.pyx":5174
  *             | (nodes[:, 0] == xF)
  *             | (nodes[:, 1] == y0)
  *             | (nodes[:, 1] == yF)             # <<<<<<<<<<<<<<
  *         )
  *         if self.dim > 2:
  */
-  __Pyx_TraceLine(5179,0,__PYX_ERR(0, 5179, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__22); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5179, __pyx_L1_error)
+  __Pyx_TraceLine(5174,0,__PYX_ERR(0, 5174, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__22); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5174, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_yF, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5179, __pyx_L1_error)
+  __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_yF, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5174, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyNumber_Or(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5179, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Or(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5174, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_is_b = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5181
+  /* "discretize/_extensions/tree_ext.pyx":5176
  *             | (nodes[:, 1] == yF)
  *         )
  *         if self.dim > 2:             # <<<<<<<<<<<<<<
  *             z0, zF = self._zs[0], self._zs[-1]
  *             is_b |= (nodes[:, 2] == z0) | (nodes[:, 2] == zF)
  */
-  __Pyx_TraceLine(5181,0,__PYX_ERR(0, 5181, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5181, __pyx_L1_error)
+  __Pyx_TraceLine(5176,0,__PYX_ERR(0, 5176, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5176, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_int_2, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5181, __pyx_L1_error)
+  __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_int_2, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5176, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 5181, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_6 < 0)) __PYX_ERR(0, 5176, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_6) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5182
+    /* "discretize/_extensions/tree_ext.pyx":5177
  *         )
  *         if self.dim > 2:
  *             z0, zF = self._zs[0], self._zs[-1]             # <<<<<<<<<<<<<<
  *             is_b |= (nodes[:, 2] == z0) | (nodes[:, 2] == zF)
  *         return sp.eye(self.n_nodes, format='csr')[is_b]
  */
-    __Pyx_TraceLine(5182,0,__PYX_ERR(0, 5182, __pyx_L1_error))
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5182, __pyx_L1_error)}
+    __Pyx_TraceLine(5177,0,__PYX_ERR(0, 5177, __pyx_L1_error))
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5177, __pyx_L1_error)}
     __pyx_t_2 = 0;
     __pyx_t_3 = -1;
     if (__pyx_t_2 < 0) {
       __pyx_t_2 += __pyx_v_self->_zs.shape[0];
       if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
     } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_zs.shape[0])) __pyx_t_3 = 0;
     if (unlikely(__pyx_t_3 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_3);
-      __PYX_ERR(0, 5182, __pyx_L1_error)
+      __PYX_ERR(0, 5177, __pyx_L1_error)
     }
-    __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5182, __pyx_L1_error)
+    __pyx_t_1 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5177, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5182, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 5177, __pyx_L1_error)}
     __pyx_t_2 = -1L;
     __pyx_t_3 = -1;
     if (__pyx_t_2 < 0) {
       __pyx_t_2 += __pyx_v_self->_zs.shape[0];
       if (unlikely(__pyx_t_2 < 0)) __pyx_t_3 = 0;
     } else if (unlikely(__pyx_t_2 >= __pyx_v_self->_zs.shape[0])) __pyx_t_3 = 0;
     if (unlikely(__pyx_t_3 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_3);
-      __PYX_ERR(0, 5182, __pyx_L1_error)
+      __PYX_ERR(0, 5177, __pyx_L1_error)
     }
-    __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5182, __pyx_L1_error)
+    __pyx_t_4 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_2 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5177, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_v_z0 = __pyx_t_1;
     __pyx_t_1 = 0;
     __pyx_v_zF = __pyx_t_4;
     __pyx_t_4 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5183
+    /* "discretize/_extensions/tree_ext.pyx":5178
  *         if self.dim > 2:
  *             z0, zF = self._zs[0], self._zs[-1]
  *             is_b |= (nodes[:, 2] == z0) | (nodes[:, 2] == zF)             # <<<<<<<<<<<<<<
  *         return sp.eye(self.n_nodes, format='csr')[is_b]
  * 
  */
-    __Pyx_TraceLine(5183,0,__PYX_ERR(0, 5183, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__23); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5183, __pyx_L1_error)
+    __Pyx_TraceLine(5178,0,__PYX_ERR(0, 5178, __pyx_L1_error))
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__23); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5178, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_z0, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5183, __pyx_L1_error)
+    __pyx_t_1 = PyObject_RichCompare(__pyx_t_4, __pyx_v_z0, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5178, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__23); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5183, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_nodes, __pyx_tuple__23); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5178, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_v_zF, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5183, __pyx_L1_error)
+    __pyx_t_5 = PyObject_RichCompare(__pyx_t_4, __pyx_v_zF, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5178, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = PyNumber_Or(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5183, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Or(__pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5178, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyNumber_InPlaceOr(__pyx_v_is_b, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5183, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_InPlaceOr(__pyx_v_is_b, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5178, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF_SET(__pyx_v_is_b, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5181
+    /* "discretize/_extensions/tree_ext.pyx":5176
  *             | (nodes[:, 1] == yF)
  *         )
  *         if self.dim > 2:             # <<<<<<<<<<<<<<
  *             z0, zF = self._zs[0], self._zs[-1]
  *             is_b |= (nodes[:, 2] == z0) | (nodes[:, 2] == zF)
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5184
+  /* "discretize/_extensions/tree_ext.pyx":5179
  *             z0, zF = self._zs[0], self._zs[-1]
  *             is_b |= (nodes[:, 2] == z0) | (nodes[:, 2] == zF)
  *         return sp.eye(self.n_nodes, format='csr')[is_b]             # <<<<<<<<<<<<<<
  * 
  *     def _get_containing_cell_index(self, loc):
  */
-  __Pyx_TraceLine(5184,0,__PYX_ERR(0, 5184, __pyx_L1_error))
+  __Pyx_TraceLine(5179,0,__PYX_ERR(0, 5179, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5184, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5179, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_eye); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5184, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_eye); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5179, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_nodes); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5184, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_nodes); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5179, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5184, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5179, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5184, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5179, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_format, __pyx_n_u_csr) < 0) __PYX_ERR(0, 5184, __pyx_L1_error)
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5184, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_format, __pyx_n_u_csr) < 0) __PYX_ERR(0, 5179, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5179, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_v_is_b); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5184, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_v_is_b); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5179, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5156
+  /* "discretize/_extensions/tree_ext.pyx":5151
  * 
  *     @property
  *     def project_node_to_boundary_node(self):             # <<<<<<<<<<<<<<
  *         r"""Projection matrix from all nodes to boundary nodes.
  * 
  */
 
@@ -60602,15 +60614,15 @@
   __Pyx_XDECREF(__pyx_v_zF);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5186
+/* "discretize/_extensions/tree_ext.pyx":5181
  *         return sp.eye(self.n_nodes, format='csr')[is_b]
  * 
  *     def _get_containing_cell_index(self, loc):             # <<<<<<<<<<<<<<
  *         cdef double x, y, z
  *         x = loc[0]
  */
 
@@ -60638,108 +60650,108 @@
   PyObject *__pyx_t_1 = NULL;
   double __pyx_t_2;
   int __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_containing_cell_index", 0);
-  __Pyx_TraceCall("_get_containing_cell_index", __pyx_f[0], 5186, 0, __PYX_ERR(0, 5186, __pyx_L1_error));
+  __Pyx_TraceCall("_get_containing_cell_index", __pyx_f[0], 5181, 0, __PYX_ERR(0, 5181, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5188
+  /* "discretize/_extensions/tree_ext.pyx":5183
  *     def _get_containing_cell_index(self, loc):
  *         cdef double x, y, z
  *         x = loc[0]             # <<<<<<<<<<<<<<
  *         y = loc[1]
  *         if self._dim == 3:
  */
-  __Pyx_TraceLine(5188,0,__PYX_ERR(0, 5188, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_loc, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5188, __pyx_L1_error)
+  __Pyx_TraceLine(5183,0,__PYX_ERR(0, 5183, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_loc, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5183, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5188, __pyx_L1_error)
+  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5183, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_x = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5189
+  /* "discretize/_extensions/tree_ext.pyx":5184
  *         cdef double x, y, z
  *         x = loc[0]
  *         y = loc[1]             # <<<<<<<<<<<<<<
  *         if self._dim == 3:
  *             z = loc[2]
  */
-  __Pyx_TraceLine(5189,0,__PYX_ERR(0, 5189, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_loc, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5189, __pyx_L1_error)
+  __Pyx_TraceLine(5184,0,__PYX_ERR(0, 5184, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_loc, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5184, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5189, __pyx_L1_error)
+  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5184, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_y = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5190
+  /* "discretize/_extensions/tree_ext.pyx":5185
  *         x = loc[0]
  *         y = loc[1]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             z = loc[2]
  *         else:
  */
-  __Pyx_TraceLine(5190,0,__PYX_ERR(0, 5190, __pyx_L1_error))
+  __Pyx_TraceLine(5185,0,__PYX_ERR(0, 5185, __pyx_L1_error))
   __pyx_t_3 = ((__pyx_v_self->_dim == 3) != 0);
   if (__pyx_t_3) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5191
+    /* "discretize/_extensions/tree_ext.pyx":5186
  *         y = loc[1]
  *         if self._dim == 3:
  *             z = loc[2]             # <<<<<<<<<<<<<<
  *         else:
  *             z = 0
  */
-    __Pyx_TraceLine(5191,0,__PYX_ERR(0, 5191, __pyx_L1_error))
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_loc, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5191, __pyx_L1_error)
+    __Pyx_TraceLine(5186,0,__PYX_ERR(0, 5186, __pyx_L1_error))
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_loc, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5186, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5191, __pyx_L1_error)
+    __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5186, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_v_z = __pyx_t_2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5190
+    /* "discretize/_extensions/tree_ext.pyx":5185
  *         x = loc[0]
  *         y = loc[1]
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             z = loc[2]
  *         else:
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5193
+  /* "discretize/_extensions/tree_ext.pyx":5188
  *             z = loc[2]
  *         else:
  *             z = 0             # <<<<<<<<<<<<<<
  *         return self.tree.containing_cell(x, y, z).index
  * 
  */
-  __Pyx_TraceLine(5193,0,__PYX_ERR(0, 5193, __pyx_L1_error))
+  __Pyx_TraceLine(5188,0,__PYX_ERR(0, 5188, __pyx_L1_error))
   /*else*/ {
     __pyx_v_z = 0.0;
   }
   __pyx_L3:;
 
-  /* "discretize/_extensions/tree_ext.pyx":5194
+  /* "discretize/_extensions/tree_ext.pyx":5189
  *         else:
  *             z = 0
  *         return self.tree.containing_cell(x, y, z).index             # <<<<<<<<<<<<<<
  * 
  *     def _get_containing_cell_indexes(self, locs):
  */
-  __Pyx_TraceLine(5194,0,__PYX_ERR(0, 5194, __pyx_L1_error))
+  __Pyx_TraceLine(5189,0,__PYX_ERR(0, 5189, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_self->tree->containing_cell(__pyx_v_x, __pyx_v_y, __pyx_v_z)->index); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5194, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_PY_LONG_LONG(__pyx_v_self->tree->containing_cell(__pyx_v_x, __pyx_v_y, __pyx_v_z)->index); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5186
+  /* "discretize/_extensions/tree_ext.pyx":5181
  *         return sp.eye(self.n_nodes, format='csr')[is_b]
  * 
  *     def _get_containing_cell_index(self, loc):             # <<<<<<<<<<<<<<
  *         cdef double x, y, z
  *         x = loc[0]
  */
 
@@ -60751,15 +60763,15 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5196
+/* "discretize/_extensions/tree_ext.pyx":5191
  *         return self.tree.containing_cell(x, y, z).index
  * 
  *     def _get_containing_cell_indexes(self, locs):             # <<<<<<<<<<<<<<
  *         locs = np.require(np.atleast_2d(locs), dtype=np.float64, requirements='C')
  *         cdef double[:,:] d_locs = locs
  */
 
@@ -60803,362 +60815,362 @@
   int __pyx_t_13;
   int __pyx_t_14;
   PY_LONG_LONG __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_get_containing_cell_indexes", 0);
-  __Pyx_TraceCall("_get_containing_cell_indexes", __pyx_f[0], 5196, 0, __PYX_ERR(0, 5196, __pyx_L1_error));
+  __Pyx_TraceCall("_get_containing_cell_indexes", __pyx_f[0], 5191, 0, __PYX_ERR(0, 5191, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_locs);
 
-  /* "discretize/_extensions/tree_ext.pyx":5197
+  /* "discretize/_extensions/tree_ext.pyx":5192
  * 
  *     def _get_containing_cell_indexes(self, locs):
  *         locs = np.require(np.atleast_2d(locs), dtype=np.float64, requirements='C')             # <<<<<<<<<<<<<<
  *         cdef double[:,:] d_locs = locs
  *         cdef int_t n_locs = d_locs.shape[0]
  */
-  __Pyx_TraceLine(5197,0,__PYX_ERR(0, 5197, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  __Pyx_TraceLine(5192,0,__PYX_ERR(0, 5192, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_require); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_require); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_atleast_2d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_atleast_2d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_locs) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_locs);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_float64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_float64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5197, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_requirements, __pyx_n_u_C) < 0) __PYX_ERR(0, 5197, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5197, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_requirements, __pyx_n_u_C) < 0) __PYX_ERR(0, 5192, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5192, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF_SET(__pyx_v_locs, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5198
+  /* "discretize/_extensions/tree_ext.pyx":5193
  *     def _get_containing_cell_indexes(self, locs):
  *         locs = np.require(np.atleast_2d(locs), dtype=np.float64, requirements='C')
  *         cdef double[:,:] d_locs = locs             # <<<<<<<<<<<<<<
  *         cdef int_t n_locs = d_locs.shape[0]
  *         cdef np.int64_t[:] indexes = np.empty(n_locs, dtype=np.int64)
  */
-  __Pyx_TraceLine(5198,0,__PYX_ERR(0, 5198, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5198, __pyx_L1_error)
+  __Pyx_TraceLine(5193,0,__PYX_ERR(0, 5193, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5193, __pyx_L1_error)
   __pyx_v_d_locs = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5199
+  /* "discretize/_extensions/tree_ext.pyx":5194
  *         locs = np.require(np.atleast_2d(locs), dtype=np.float64, requirements='C')
  *         cdef double[:,:] d_locs = locs
  *         cdef int_t n_locs = d_locs.shape[0]             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] indexes = np.empty(n_locs, dtype=np.int64)
  *         cdef double x, y, z
  */
-  __Pyx_TraceLine(5199,0,__PYX_ERR(0, 5199, __pyx_L1_error))
+  __Pyx_TraceLine(5194,0,__PYX_ERR(0, 5194, __pyx_L1_error))
   __pyx_v_n_locs = (__pyx_v_d_locs.shape[0]);
 
-  /* "discretize/_extensions/tree_ext.pyx":5200
+  /* "discretize/_extensions/tree_ext.pyx":5195
  *         cdef double[:,:] d_locs = locs
  *         cdef int_t n_locs = d_locs.shape[0]
  *         cdef np.int64_t[:] indexes = np.empty(n_locs, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef double x, y, z
  *         for i in range(n_locs):
  */
-  __Pyx_TraceLine(5200,0,__PYX_ERR(0, 5200, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __Pyx_TraceLine(5195,0,__PYX_ERR(0, 5195, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_n_locs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_n_locs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5200, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5200, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5195, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_indexes = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5202
+  /* "discretize/_extensions/tree_ext.pyx":5197
  *         cdef np.int64_t[:] indexes = np.empty(n_locs, dtype=np.int64)
  *         cdef double x, y, z
  *         for i in range(n_locs):             # <<<<<<<<<<<<<<
  *             x = d_locs[i, 0]
  *             y = d_locs[i, 1]
  */
-  __Pyx_TraceLine(5202,0,__PYX_ERR(0, 5202, __pyx_L1_error))
+  __Pyx_TraceLine(5197,0,__PYX_ERR(0, 5197, __pyx_L1_error))
   __pyx_t_8 = __pyx_v_n_locs;
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_i = __pyx_t_10;
 
-    /* "discretize/_extensions/tree_ext.pyx":5203
+    /* "discretize/_extensions/tree_ext.pyx":5198
  *         cdef double x, y, z
  *         for i in range(n_locs):
  *             x = d_locs[i, 0]             # <<<<<<<<<<<<<<
  *             y = d_locs[i, 1]
  *             if self._dim == 3:
  */
-    __Pyx_TraceLine(5203,0,__PYX_ERR(0, 5203, __pyx_L1_error))
+    __Pyx_TraceLine(5198,0,__PYX_ERR(0, 5198, __pyx_L1_error))
     __pyx_t_11 = __pyx_v_i;
     __pyx_t_12 = 0;
     __pyx_t_13 = -1;
     if (__pyx_t_11 < 0) {
       __pyx_t_11 += __pyx_v_d_locs.shape[0];
       if (unlikely(__pyx_t_11 < 0)) __pyx_t_13 = 0;
     } else if (unlikely(__pyx_t_11 >= __pyx_v_d_locs.shape[0])) __pyx_t_13 = 0;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_d_locs.shape[1];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 1;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_d_locs.shape[1])) __pyx_t_13 = 1;
     if (unlikely(__pyx_t_13 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_13);
-      __PYX_ERR(0, 5203, __pyx_L1_error)
+      __PYX_ERR(0, 5198, __pyx_L1_error)
     }
     __pyx_v_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_d_locs.data + __pyx_t_11 * __pyx_v_d_locs.strides[0]) ) + __pyx_t_12 * __pyx_v_d_locs.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5204
+    /* "discretize/_extensions/tree_ext.pyx":5199
  *         for i in range(n_locs):
  *             x = d_locs[i, 0]
  *             y = d_locs[i, 1]             # <<<<<<<<<<<<<<
  *             if self._dim == 3:
  *                 z = d_locs[i, 2]
  */
-    __Pyx_TraceLine(5204,0,__PYX_ERR(0, 5204, __pyx_L1_error))
+    __Pyx_TraceLine(5199,0,__PYX_ERR(0, 5199, __pyx_L1_error))
     __pyx_t_12 = __pyx_v_i;
     __pyx_t_11 = 1;
     __pyx_t_13 = -1;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_d_locs.shape[0];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_d_locs.shape[0])) __pyx_t_13 = 0;
     if (__pyx_t_11 < 0) {
       __pyx_t_11 += __pyx_v_d_locs.shape[1];
       if (unlikely(__pyx_t_11 < 0)) __pyx_t_13 = 1;
     } else if (unlikely(__pyx_t_11 >= __pyx_v_d_locs.shape[1])) __pyx_t_13 = 1;
     if (unlikely(__pyx_t_13 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_13);
-      __PYX_ERR(0, 5204, __pyx_L1_error)
+      __PYX_ERR(0, 5199, __pyx_L1_error)
     }
     __pyx_v_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_d_locs.data + __pyx_t_12 * __pyx_v_d_locs.strides[0]) ) + __pyx_t_11 * __pyx_v_d_locs.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5205
+    /* "discretize/_extensions/tree_ext.pyx":5200
  *             x = d_locs[i, 0]
  *             y = d_locs[i, 1]
  *             if self._dim == 3:             # <<<<<<<<<<<<<<
  *                 z = d_locs[i, 2]
  *             else:
  */
-    __Pyx_TraceLine(5205,0,__PYX_ERR(0, 5205, __pyx_L1_error))
+    __Pyx_TraceLine(5200,0,__PYX_ERR(0, 5200, __pyx_L1_error))
     __pyx_t_14 = ((__pyx_v_self->_dim == 3) != 0);
     if (__pyx_t_14) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5206
+      /* "discretize/_extensions/tree_ext.pyx":5201
  *             y = d_locs[i, 1]
  *             if self._dim == 3:
  *                 z = d_locs[i, 2]             # <<<<<<<<<<<<<<
  *             else:
  *                 z = 0
  */
-      __Pyx_TraceLine(5206,0,__PYX_ERR(0, 5206, __pyx_L1_error))
+      __Pyx_TraceLine(5201,0,__PYX_ERR(0, 5201, __pyx_L1_error))
       __pyx_t_11 = __pyx_v_i;
       __pyx_t_12 = 2;
       __pyx_t_13 = -1;
       if (__pyx_t_11 < 0) {
         __pyx_t_11 += __pyx_v_d_locs.shape[0];
         if (unlikely(__pyx_t_11 < 0)) __pyx_t_13 = 0;
       } else if (unlikely(__pyx_t_11 >= __pyx_v_d_locs.shape[0])) __pyx_t_13 = 0;
       if (__pyx_t_12 < 0) {
         __pyx_t_12 += __pyx_v_d_locs.shape[1];
         if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 1;
       } else if (unlikely(__pyx_t_12 >= __pyx_v_d_locs.shape[1])) __pyx_t_13 = 1;
       if (unlikely(__pyx_t_13 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_13);
-        __PYX_ERR(0, 5206, __pyx_L1_error)
+        __PYX_ERR(0, 5201, __pyx_L1_error)
       }
       __pyx_v_z = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_d_locs.data + __pyx_t_11 * __pyx_v_d_locs.strides[0]) ) + __pyx_t_12 * __pyx_v_d_locs.strides[1]) )));
 
-      /* "discretize/_extensions/tree_ext.pyx":5205
+      /* "discretize/_extensions/tree_ext.pyx":5200
  *             x = d_locs[i, 0]
  *             y = d_locs[i, 1]
  *             if self._dim == 3:             # <<<<<<<<<<<<<<
  *                 z = d_locs[i, 2]
  *             else:
  */
       goto __pyx_L5;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5208
+    /* "discretize/_extensions/tree_ext.pyx":5203
  *                 z = d_locs[i, 2]
  *             else:
  *                 z = 0             # <<<<<<<<<<<<<<
  *             indexes[i] = self.tree.containing_cell(x, y, z).index
  *         if n_locs==1:
  */
-    __Pyx_TraceLine(5208,0,__PYX_ERR(0, 5208, __pyx_L1_error))
+    __Pyx_TraceLine(5203,0,__PYX_ERR(0, 5203, __pyx_L1_error))
     /*else*/ {
       __pyx_v_z = 0.0;
     }
     __pyx_L5:;
 
-    /* "discretize/_extensions/tree_ext.pyx":5209
+    /* "discretize/_extensions/tree_ext.pyx":5204
  *             else:
  *                 z = 0
  *             indexes[i] = self.tree.containing_cell(x, y, z).index             # <<<<<<<<<<<<<<
  *         if n_locs==1:
  *             return indexes[0]
  */
-    __Pyx_TraceLine(5209,0,__PYX_ERR(0, 5209, __pyx_L1_error))
+    __Pyx_TraceLine(5204,0,__PYX_ERR(0, 5204, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_self->tree->containing_cell(__pyx_v_x, __pyx_v_y, __pyx_v_z)->index;
     __pyx_t_12 = __pyx_v_i;
     __pyx_t_13 = -1;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_indexes.shape[0];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_indexes.shape[0])) __pyx_t_13 = 0;
     if (unlikely(__pyx_t_13 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_13);
-      __PYX_ERR(0, 5209, __pyx_L1_error)
+      __PYX_ERR(0, 5204, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indexes.data + __pyx_t_12 * __pyx_v_indexes.strides[0]) )) = __pyx_t_15;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5210
+  /* "discretize/_extensions/tree_ext.pyx":5205
  *                 z = 0
  *             indexes[i] = self.tree.containing_cell(x, y, z).index
  *         if n_locs==1:             # <<<<<<<<<<<<<<
  *             return indexes[0]
  *         return np.array(indexes)
  */
-  __Pyx_TraceLine(5210,0,__PYX_ERR(0, 5210, __pyx_L1_error))
+  __Pyx_TraceLine(5205,0,__PYX_ERR(0, 5205, __pyx_L1_error))
   __pyx_t_14 = ((__pyx_v_n_locs == 1) != 0);
   if (__pyx_t_14) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5211
+    /* "discretize/_extensions/tree_ext.pyx":5206
  *             indexes[i] = self.tree.containing_cell(x, y, z).index
  *         if n_locs==1:
  *             return indexes[0]             # <<<<<<<<<<<<<<
  *         return np.array(indexes)
  * 
  */
-    __Pyx_TraceLine(5211,0,__PYX_ERR(0, 5211, __pyx_L1_error))
+    __Pyx_TraceLine(5206,0,__PYX_ERR(0, 5206, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __pyx_t_12 = 0;
     __pyx_t_13 = -1;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_indexes.shape[0];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_13 = 0;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_indexes.shape[0])) __pyx_t_13 = 0;
     if (unlikely(__pyx_t_13 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_13);
-      __PYX_ERR(0, 5211, __pyx_L1_error)
+      __PYX_ERR(0, 5206, __pyx_L1_error)
     }
-    __pyx_t_3 = __Pyx_PyInt_From_npy_int64((*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indexes.data + __pyx_t_12 * __pyx_v_indexes.strides[0]) )))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5211, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_From_npy_int64((*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indexes.data + __pyx_t_12 * __pyx_v_indexes.strides[0]) )))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5206, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5210
+    /* "discretize/_extensions/tree_ext.pyx":5205
  *                 z = 0
  *             indexes[i] = self.tree.containing_cell(x, y, z).index
  *         if n_locs==1:             # <<<<<<<<<<<<<<
  *             return indexes[0]
  *         return np.array(indexes)
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5212
+  /* "discretize/_extensions/tree_ext.pyx":5207
  *         if n_locs==1:
  *             return indexes[0]
  *         return np.array(indexes)             # <<<<<<<<<<<<<<
  * 
  *     def _count_cells_per_index(self):
  */
-  __Pyx_TraceLine(5212,0,__PYX_ERR(0, 5212, __pyx_L1_error))
+  __Pyx_TraceLine(5207,0,__PYX_ERR(0, 5207, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5212, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5207, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5212, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5207, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_indexes, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5212, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_indexes, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5207, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_1 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_1)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_1, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
   __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5212, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5207, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5196
+  /* "discretize/_extensions/tree_ext.pyx":5191
  *         return self.tree.containing_cell(x, y, z).index
  * 
  *     def _get_containing_cell_indexes(self, locs):             # <<<<<<<<<<<<<<
  *         locs = np.require(np.atleast_2d(locs), dtype=np.float64, requirements='C')
  *         cdef double[:,:] d_locs = locs
  */
 
@@ -61179,15 +61191,15 @@
   __Pyx_XDECREF(__pyx_v_locs);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5214
+/* "discretize/_extensions/tree_ext.pyx":5209
  *         return np.array(indexes)
  * 
  *     def _count_cells_per_index(self):             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] counts = np.zeros(self.max_level+1, dtype=np.int64)
  *         for cell in self.tree.cells:
  */
 
@@ -61222,142 +61234,142 @@
   Cell *__pyx_t_9;
   Py_ssize_t __pyx_t_10;
   int __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_count_cells_per_index", 0);
-  __Pyx_TraceCall("_count_cells_per_index", __pyx_f[0], 5214, 0, __PYX_ERR(0, 5214, __pyx_L1_error));
+  __Pyx_TraceCall("_count_cells_per_index", __pyx_f[0], 5209, 0, __PYX_ERR(0, 5209, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5215
+  /* "discretize/_extensions/tree_ext.pyx":5210
  * 
  *     def _count_cells_per_index(self):
  *         cdef np.int64_t[:] counts = np.zeros(self.max_level+1, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         for cell in self.tree.cells:
  *             counts[cell.level] += 1
  */
-  __Pyx_TraceLine(5215,0,__PYX_ERR(0, 5215, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __Pyx_TraceLine(5210,0,__PYX_ERR(0, 5210, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_max_level); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_max_level); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5215, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5215, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5210, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_counts = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5216
+  /* "discretize/_extensions/tree_ext.pyx":5211
  *     def _count_cells_per_index(self):
  *         cdef np.int64_t[:] counts = np.zeros(self.max_level+1, dtype=np.int64)
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             counts[cell.level] += 1
  *         return np.array(counts)
  */
-  __Pyx_TraceLine(5216,0,__PYX_ERR(0, 5216, __pyx_L1_error))
+  __Pyx_TraceLine(5211,0,__PYX_ERR(0, 5211, __pyx_L1_error))
   __pyx_t_8 = &__pyx_v_self->tree->cells;
   __pyx_t_7 = __pyx_t_8->begin();
   for (;;) {
     if (!(__pyx_t_7 != __pyx_t_8->end())) break;
     __pyx_t_9 = *__pyx_t_7;
     ++__pyx_t_7;
     __pyx_v_cell = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":5217
+    /* "discretize/_extensions/tree_ext.pyx":5212
  *         cdef np.int64_t[:] counts = np.zeros(self.max_level+1, dtype=np.int64)
  *         for cell in self.tree.cells:
  *             counts[cell.level] += 1             # <<<<<<<<<<<<<<
  *         return np.array(counts)
  * 
  */
-    __Pyx_TraceLine(5217,0,__PYX_ERR(0, 5217, __pyx_L1_error))
+    __Pyx_TraceLine(5212,0,__PYX_ERR(0, 5212, __pyx_L1_error))
     __pyx_t_10 = __pyx_v_cell->level;
     __pyx_t_11 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_counts.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_counts.shape[0])) __pyx_t_11 = 0;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5217, __pyx_L1_error)
+      __PYX_ERR(0, 5212, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_counts.data + __pyx_t_10 * __pyx_v_counts.strides[0]) )) += 1;
 
-    /* "discretize/_extensions/tree_ext.pyx":5216
+    /* "discretize/_extensions/tree_ext.pyx":5211
  *     def _count_cells_per_index(self):
  *         cdef np.int64_t[:] counts = np.zeros(self.max_level+1, dtype=np.int64)
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             counts[cell.level] += 1
  *         return np.array(counts)
  */
-    __Pyx_TraceLine(5216,0,__PYX_ERR(0, 5216, __pyx_L1_error))
+    __Pyx_TraceLine(5211,0,__PYX_ERR(0, 5211, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5218
+  /* "discretize/_extensions/tree_ext.pyx":5213
  *         for cell in self.tree.cells:
  *             counts[cell.level] += 1
  *         return np.array(counts)             # <<<<<<<<<<<<<<
  * 
  *     def _cell_levels_by_indexes(self, index):
  */
-  __Pyx_TraceLine(5218,0,__PYX_ERR(0, 5218, __pyx_L1_error))
+  __Pyx_TraceLine(5213,0,__PYX_ERR(0, 5213, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5218, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5213, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5218, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5213, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_counts, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5218, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_counts, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5213, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_5 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5218, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5213, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5214
+  /* "discretize/_extensions/tree_ext.pyx":5209
  *         return np.array(indexes)
  * 
  *     def _count_cells_per_index(self):             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] counts = np.zeros(self.max_level+1, dtype=np.int64)
  *         for cell in self.tree.cells:
  */
 
@@ -61375,15 +61387,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_counts, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5220
+/* "discretize/_extensions/tree_ext.pyx":5215
  *         return np.array(counts)
  * 
  *     def _cell_levels_by_indexes(self, index):             # <<<<<<<<<<<<<<
  *         index = np.require(np.atleast_1d(index), dtype=np.int64, requirements='C')
  *         cdef np.int64_t[:] inds = index
  */
 
@@ -61422,265 +61434,265 @@
   int __pyx_t_11;
   int_t __pyx_t_12;
   int __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_cell_levels_by_indexes", 0);
-  __Pyx_TraceCall("_cell_levels_by_indexes", __pyx_f[0], 5220, 0, __PYX_ERR(0, 5220, __pyx_L1_error));
+  __Pyx_TraceCall("_cell_levels_by_indexes", __pyx_f[0], 5215, 0, __PYX_ERR(0, 5215, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_index);
 
-  /* "discretize/_extensions/tree_ext.pyx":5221
+  /* "discretize/_extensions/tree_ext.pyx":5216
  * 
  *     def _cell_levels_by_indexes(self, index):
  *         index = np.require(np.atleast_1d(index), dtype=np.int64, requirements='C')             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] inds = index
  *         cdef int_t n_cells = inds.shape[0]
  */
-  __Pyx_TraceLine(5221,0,__PYX_ERR(0, 5221, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  __Pyx_TraceLine(5216,0,__PYX_ERR(0, 5216, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_require); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_require); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_atleast_1d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_atleast_1d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_v_index) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_v_index);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5221, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_requirements, __pyx_n_u_C) < 0) __PYX_ERR(0, 5221, __pyx_L1_error)
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5221, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_requirements, __pyx_n_u_C) < 0) __PYX_ERR(0, 5216, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5216, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF_SET(__pyx_v_index, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5222
+  /* "discretize/_extensions/tree_ext.pyx":5217
  *     def _cell_levels_by_indexes(self, index):
  *         index = np.require(np.atleast_1d(index), dtype=np.int64, requirements='C')
  *         cdef np.int64_t[:] inds = index             # <<<<<<<<<<<<<<
  *         cdef int_t n_cells = inds.shape[0]
  *         cdef np.int64_t[:] levels = np.empty(n_cells, dtype=np.int64)
  */
-  __Pyx_TraceLine(5222,0,__PYX_ERR(0, 5222, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_v_index, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5222, __pyx_L1_error)
+  __Pyx_TraceLine(5217,0,__PYX_ERR(0, 5217, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_v_index, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5217, __pyx_L1_error)
   __pyx_v_inds = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5223
+  /* "discretize/_extensions/tree_ext.pyx":5218
  *         index = np.require(np.atleast_1d(index), dtype=np.int64, requirements='C')
  *         cdef np.int64_t[:] inds = index
  *         cdef int_t n_cells = inds.shape[0]             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] levels = np.empty(n_cells, dtype=np.int64)
  *         for i in range(n_cells):
  */
-  __Pyx_TraceLine(5223,0,__PYX_ERR(0, 5223, __pyx_L1_error))
+  __Pyx_TraceLine(5218,0,__PYX_ERR(0, 5218, __pyx_L1_error))
   __pyx_v_n_cells = (__pyx_v_inds.shape[0]);
 
-  /* "discretize/_extensions/tree_ext.pyx":5224
+  /* "discretize/_extensions/tree_ext.pyx":5219
  *         cdef np.int64_t[:] inds = index
  *         cdef int_t n_cells = inds.shape[0]
  *         cdef np.int64_t[:] levels = np.empty(n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         for i in range(n_cells):
  *             levels[i] = self.tree.cells[inds[i]].level
  */
-  __Pyx_TraceLine(5224,0,__PYX_ERR(0, 5224, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __Pyx_TraceLine(5219,0,__PYX_ERR(0, 5219, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5224, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5224, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5219, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_levels = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5225
+  /* "discretize/_extensions/tree_ext.pyx":5220
  *         cdef int_t n_cells = inds.shape[0]
  *         cdef np.int64_t[:] levels = np.empty(n_cells, dtype=np.int64)
  *         for i in range(n_cells):             # <<<<<<<<<<<<<<
  *             levels[i] = self.tree.cells[inds[i]].level
  *         if n_cells == 1:
  */
-  __Pyx_TraceLine(5225,0,__PYX_ERR(0, 5225, __pyx_L1_error))
+  __Pyx_TraceLine(5220,0,__PYX_ERR(0, 5220, __pyx_L1_error))
   __pyx_t_7 = __pyx_v_n_cells;
   __pyx_t_8 = __pyx_t_7;
   for (__pyx_t_9 = 0; __pyx_t_9 < __pyx_t_8; __pyx_t_9+=1) {
     __pyx_v_i = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":5226
+    /* "discretize/_extensions/tree_ext.pyx":5221
  *         cdef np.int64_t[:] levels = np.empty(n_cells, dtype=np.int64)
  *         for i in range(n_cells):
  *             levels[i] = self.tree.cells[inds[i]].level             # <<<<<<<<<<<<<<
  *         if n_cells == 1:
  *             return levels[0]
  */
-    __Pyx_TraceLine(5226,0,__PYX_ERR(0, 5226, __pyx_L1_error))
+    __Pyx_TraceLine(5221,0,__PYX_ERR(0, 5221, __pyx_L1_error))
     __pyx_t_10 = __pyx_v_i;
     __pyx_t_11 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_inds.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_inds.shape[0])) __pyx_t_11 = 0;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5226, __pyx_L1_error)
+      __PYX_ERR(0, 5221, __pyx_L1_error)
     }
     __pyx_t_12 = (__pyx_v_self->tree->cells[(*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_inds.data + __pyx_t_10 * __pyx_v_inds.strides[0]) )))])->level;
     __pyx_t_10 = __pyx_v_i;
     __pyx_t_11 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_levels.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_levels.shape[0])) __pyx_t_11 = 0;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5226, __pyx_L1_error)
+      __PYX_ERR(0, 5221, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_levels.data + __pyx_t_10 * __pyx_v_levels.strides[0]) )) = __pyx_t_12;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5227
+  /* "discretize/_extensions/tree_ext.pyx":5222
  *         for i in range(n_cells):
  *             levels[i] = self.tree.cells[inds[i]].level
  *         if n_cells == 1:             # <<<<<<<<<<<<<<
  *             return levels[0]
  *         else:
  */
-  __Pyx_TraceLine(5227,0,__PYX_ERR(0, 5227, __pyx_L1_error))
+  __Pyx_TraceLine(5222,0,__PYX_ERR(0, 5222, __pyx_L1_error))
   __pyx_t_13 = ((__pyx_v_n_cells == 1) != 0);
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5228
+    /* "discretize/_extensions/tree_ext.pyx":5223
  *             levels[i] = self.tree.cells[inds[i]].level
  *         if n_cells == 1:
  *             return levels[0]             # <<<<<<<<<<<<<<
  *         else:
  *             return np.array(levels)
  */
-    __Pyx_TraceLine(5228,0,__PYX_ERR(0, 5228, __pyx_L1_error))
+    __Pyx_TraceLine(5223,0,__PYX_ERR(0, 5223, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __pyx_t_10 = 0;
     __pyx_t_11 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_levels.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_levels.shape[0])) __pyx_t_11 = 0;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5228, __pyx_L1_error)
+      __PYX_ERR(0, 5223, __pyx_L1_error)
     }
-    __pyx_t_3 = __Pyx_PyInt_From_npy_int64((*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_levels.data + __pyx_t_10 * __pyx_v_levels.strides[0]) )))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5228, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_From_npy_int64((*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_levels.data + __pyx_t_10 * __pyx_v_levels.strides[0]) )))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5223, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5227
+    /* "discretize/_extensions/tree_ext.pyx":5222
  *         for i in range(n_cells):
  *             levels[i] = self.tree.cells[inds[i]].level
  *         if n_cells == 1:             # <<<<<<<<<<<<<<
  *             return levels[0]
  *         else:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5230
+  /* "discretize/_extensions/tree_ext.pyx":5225
  *             return levels[0]
  *         else:
  *             return np.array(levels)             # <<<<<<<<<<<<<<
  * 
  *     def _getFaceP(self, xFace, yFace, zFace):
  */
-  __Pyx_TraceLine(5230,0,__PYX_ERR(0, 5230, __pyx_L1_error))
+  __Pyx_TraceLine(5225,0,__PYX_ERR(0, 5225, __pyx_L1_error))
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5230, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5230, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_levels, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5230, __pyx_L1_error)
+    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_levels, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_1 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
       __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
       if (likely(__pyx_t_1)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
         __Pyx_INCREF(__pyx_t_1);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_1, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5);
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5230, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5225, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5220
+  /* "discretize/_extensions/tree_ext.pyx":5215
  *         return np.array(counts)
  * 
  *     def _cell_levels_by_indexes(self, index):             # <<<<<<<<<<<<<<
  *         index = np.require(np.atleast_1d(index), dtype=np.int64, requirements='C')
  *         cdef np.int64_t[:] inds = index
  */
 
@@ -61700,15 +61712,15 @@
   __Pyx_XDECREF(__pyx_v_index);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5232
+/* "discretize/_extensions/tree_ext.pyx":5227
  *             return np.array(levels)
  * 
  *     def _getFaceP(self, xFace, yFace, zFace):             # <<<<<<<<<<<<<<
  *         cdef int dim = self._dim
  *         cdef int_t ind, id
  */
 
@@ -61746,40 +61758,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_xFace)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yFace)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getFaceP", 1, 3, 3, 1); __PYX_ERR(0, 5232, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getFaceP", 1, 3, 3, 1); __PYX_ERR(0, 5227, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zFace)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getFaceP", 1, 3, 3, 2); __PYX_ERR(0, 5232, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getFaceP", 1, 3, 3, 2); __PYX_ERR(0, 5227, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getFaceP") < 0)) __PYX_ERR(0, 5232, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getFaceP") < 0)) __PYX_ERR(0, 5227, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_xFace = values[0];
     __pyx_v_yFace = values[1];
     __pyx_v_zFace = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_getFaceP", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5232, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_getFaceP", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5227, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getFaceP", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_68_getFaceP(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_xFace, __pyx_v_yFace, __pyx_v_zFace);
 
@@ -61823,908 +61835,908 @@
   Py_ssize_t __pyx_t_16;
   __Pyx_memviewslice __pyx_t_17 = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_t_18 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getFaceP", 0);
-  __Pyx_TraceCall("_getFaceP", __pyx_f[0], 5232, 0, __PYX_ERR(0, 5232, __pyx_L1_error));
+  __Pyx_TraceCall("_getFaceP", __pyx_f[0], 5227, 0, __PYX_ERR(0, 5227, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5233
+  /* "discretize/_extensions/tree_ext.pyx":5228
  * 
  *     def _getFaceP(self, xFace, yFace, zFace):
  *         cdef int dim = self._dim             # <<<<<<<<<<<<<<
  *         cdef int_t ind, id
  * 
  */
-  __Pyx_TraceLine(5233,0,__PYX_ERR(0, 5233, __pyx_L1_error))
+  __Pyx_TraceLine(5228,0,__PYX_ERR(0, 5228, __pyx_L1_error))
   __pyx_t_1 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_1;
 
-  /* "discretize/_extensions/tree_ext.pyx":5239
+  /* "discretize/_extensions/tree_ext.pyx":5234
  *         cdef np.float64_t[:] V
  * 
  *         J1 = np.empty(self.n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J2 = np.empty(self.n_cells, dtype=np.int64)
  *         if dim==3:
  */
-  __Pyx_TraceLine(5239,0,__PYX_ERR(0, 5239, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __Pyx_TraceLine(5234,0,__PYX_ERR(0, 5234, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5239, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5239, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5234, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J1 = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5240
+  /* "discretize/_extensions/tree_ext.pyx":5235
  * 
  *         J1 = np.empty(self.n_cells, dtype=np.int64)
  *         J2 = np.empty(self.n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         if dim==3:
  *             J3 = np.empty(self.n_cells, dtype=np.int64)
  */
-  __Pyx_TraceLine(5240,0,__PYX_ERR(0, 5240, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __Pyx_TraceLine(5235,0,__PYX_ERR(0, 5235, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5240, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5240, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5235, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_J2 = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5241
+  /* "discretize/_extensions/tree_ext.pyx":5236
  *         J1 = np.empty(self.n_cells, dtype=np.int64)
  *         J2 = np.empty(self.n_cells, dtype=np.int64)
  *         if dim==3:             # <<<<<<<<<<<<<<
  *             J3 = np.empty(self.n_cells, dtype=np.int64)
  * 
  */
-  __Pyx_TraceLine(5241,0,__PYX_ERR(0, 5241, __pyx_L1_error))
+  __Pyx_TraceLine(5236,0,__PYX_ERR(0, 5236, __pyx_L1_error))
   __pyx_t_8 = ((__pyx_v_dim == 3) != 0);
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5242
+    /* "discretize/_extensions/tree_ext.pyx":5237
  *         J2 = np.empty(self.n_cells, dtype=np.int64)
  *         if dim==3:
  *             J3 = np.empty(self.n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  * 
  *         cdef int[3] faces
  */
-    __Pyx_TraceLine(5242,0,__PYX_ERR(0, 5242, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __Pyx_TraceLine(5237,0,__PYX_ERR(0, 5237, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
     __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5242, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5242, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5237, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_J3 = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5241
+    /* "discretize/_extensions/tree_ext.pyx":5236
  *         J1 = np.empty(self.n_cells, dtype=np.int64)
  *         J2 = np.empty(self.n_cells, dtype=np.int64)
  *         if dim==3:             # <<<<<<<<<<<<<<
  *             J3 = np.empty(self.n_cells, dtype=np.int64)
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5245
+  /* "discretize/_extensions/tree_ext.pyx":5240
  * 
  *         cdef int[3] faces
  *         cdef np.int64_t[:] offsets = np.empty(self._dim, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         faces[0] = (xFace == 'fXp')
  *         faces[1] = (yFace == 'fYp')
  */
-  __Pyx_TraceLine(5245,0,__PYX_ERR(0, 5245, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __Pyx_TraceLine(5240,0,__PYX_ERR(0, 5240, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_int_t(__pyx_v_self->_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int_t(__pyx_v_self->_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 5245, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5245, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5240, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_offsets = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5246
+  /* "discretize/_extensions/tree_ext.pyx":5241
  *         cdef int[3] faces
  *         cdef np.int64_t[:] offsets = np.empty(self._dim, dtype=np.int64)
  *         faces[0] = (xFace == 'fXp')             # <<<<<<<<<<<<<<
  *         faces[1] = (yFace == 'fYp')
  *         if dim == 3:
  */
-  __Pyx_TraceLine(5246,0,__PYX_ERR(0, 5246, __pyx_L1_error))
-  __pyx_t_2 = PyObject_RichCompare(__pyx_v_xFace, __pyx_n_u_fXp, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5246, __pyx_L1_error)
-  __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5246, __pyx_L1_error)
+  __Pyx_TraceLine(5241,0,__PYX_ERR(0, 5241, __pyx_L1_error))
+  __pyx_t_2 = PyObject_RichCompare(__pyx_v_xFace, __pyx_n_u_fXp, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5241, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5241, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   (__pyx_v_faces[0]) = __pyx_t_9;
 
-  /* "discretize/_extensions/tree_ext.pyx":5247
+  /* "discretize/_extensions/tree_ext.pyx":5242
  *         cdef np.int64_t[:] offsets = np.empty(self._dim, dtype=np.int64)
  *         faces[0] = (xFace == 'fXp')
  *         faces[1] = (yFace == 'fYp')             # <<<<<<<<<<<<<<
  *         if dim == 3:
  *             faces[2] = (zFace == 'fZp')
  */
-  __Pyx_TraceLine(5247,0,__PYX_ERR(0, 5247, __pyx_L1_error))
-  __pyx_t_2 = PyObject_RichCompare(__pyx_v_yFace, __pyx_n_u_fYp, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5247, __pyx_L1_error)
-  __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5247, __pyx_L1_error)
+  __Pyx_TraceLine(5242,0,__PYX_ERR(0, 5242, __pyx_L1_error))
+  __pyx_t_2 = PyObject_RichCompare(__pyx_v_yFace, __pyx_n_u_fYp, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5242, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5242, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   (__pyx_v_faces[1]) = __pyx_t_9;
 
-  /* "discretize/_extensions/tree_ext.pyx":5248
+  /* "discretize/_extensions/tree_ext.pyx":5243
  *         faces[0] = (xFace == 'fXp')
  *         faces[1] = (yFace == 'fYp')
  *         if dim == 3:             # <<<<<<<<<<<<<<
  *             faces[2] = (zFace == 'fZp')
  * 
  */
-  __Pyx_TraceLine(5248,0,__PYX_ERR(0, 5248, __pyx_L1_error))
+  __Pyx_TraceLine(5243,0,__PYX_ERR(0, 5243, __pyx_L1_error))
   __pyx_t_8 = ((__pyx_v_dim == 3) != 0);
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5249
+    /* "discretize/_extensions/tree_ext.pyx":5244
  *         faces[1] = (yFace == 'fYp')
  *         if dim == 3:
  *             faces[2] = (zFace == 'fZp')             # <<<<<<<<<<<<<<
  * 
  *         if dim == 2:
  */
-    __Pyx_TraceLine(5249,0,__PYX_ERR(0, 5249, __pyx_L1_error))
-    __pyx_t_2 = PyObject_RichCompare(__pyx_v_zFace, __pyx_n_u_fZp, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5249, __pyx_L1_error)
-    __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5249, __pyx_L1_error)
+    __Pyx_TraceLine(5244,0,__PYX_ERR(0, 5244, __pyx_L1_error))
+    __pyx_t_2 = PyObject_RichCompare(__pyx_v_zFace, __pyx_n_u_fZp, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5244, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5244, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     (__pyx_v_faces[2]) = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":5248
+    /* "discretize/_extensions/tree_ext.pyx":5243
  *         faces[0] = (xFace == 'fXp')
  *         faces[1] = (yFace == 'fYp')
  *         if dim == 3:             # <<<<<<<<<<<<<<
  *             faces[2] = (zFace == 'fZp')
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5251
+  /* "discretize/_extensions/tree_ext.pyx":5246
  *             faces[2] = (zFace == 'fZp')
  * 
  *         if dim == 2:             # <<<<<<<<<<<<<<
  *             offsets[0] = 0
  *             offsets[1] = self.n_total_faces_x
  */
-  __Pyx_TraceLine(5251,0,__PYX_ERR(0, 5251, __pyx_L1_error))
+  __Pyx_TraceLine(5246,0,__PYX_ERR(0, 5246, __pyx_L1_error))
   __pyx_t_8 = ((__pyx_v_dim == 2) != 0);
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5252
+    /* "discretize/_extensions/tree_ext.pyx":5247
  * 
  *         if dim == 2:
  *             offsets[0] = 0             # <<<<<<<<<<<<<<
  *             offsets[1] = self.n_total_faces_x
  *         else:
  */
-    __Pyx_TraceLine(5252,0,__PYX_ERR(0, 5252, __pyx_L1_error))
+    __Pyx_TraceLine(5247,0,__PYX_ERR(0, 5247, __pyx_L1_error))
     __pyx_t_10 = 0;
     __pyx_t_9 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_offsets.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_offsets.shape[0])) __pyx_t_9 = 0;
     if (unlikely(__pyx_t_9 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_9);
-      __PYX_ERR(0, 5252, __pyx_L1_error)
+      __PYX_ERR(0, 5247, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_10 * __pyx_v_offsets.strides[0]) )) = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5253
+    /* "discretize/_extensions/tree_ext.pyx":5248
  *         if dim == 2:
  *             offsets[0] = 0
  *             offsets[1] = self.n_total_faces_x             # <<<<<<<<<<<<<<
  *         else:
  *             offsets[0] = 0
  */
-    __Pyx_TraceLine(5253,0,__PYX_ERR(0, 5253, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5253, __pyx_L1_error)
+    __Pyx_TraceLine(5248,0,__PYX_ERR(0, 5248, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_11 = __Pyx_PyInt_As_npy_int64(__pyx_t_2); if (unlikely((__pyx_t_11 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5253, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_As_npy_int64(__pyx_t_2); if (unlikely((__pyx_t_11 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5248, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_10 = 1;
     __pyx_t_9 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_offsets.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_offsets.shape[0])) __pyx_t_9 = 0;
     if (unlikely(__pyx_t_9 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_9);
-      __PYX_ERR(0, 5253, __pyx_L1_error)
+      __PYX_ERR(0, 5248, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_10 * __pyx_v_offsets.strides[0]) )) = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":5251
+    /* "discretize/_extensions/tree_ext.pyx":5246
  *             faces[2] = (zFace == 'fZp')
  * 
  *         if dim == 2:             # <<<<<<<<<<<<<<
  *             offsets[0] = 0
  *             offsets[1] = self.n_total_faces_x
  */
     goto __pyx_L5;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5255
+  /* "discretize/_extensions/tree_ext.pyx":5250
  *             offsets[1] = self.n_total_faces_x
  *         else:
  *             offsets[0] = 0             # <<<<<<<<<<<<<<
  *             offsets[1] = self.n_total_faces_x
  *             offsets[2] = self.n_total_faces_x + self.n_total_faces_y
  */
-  __Pyx_TraceLine(5255,0,__PYX_ERR(0, 5255, __pyx_L1_error))
+  __Pyx_TraceLine(5250,0,__PYX_ERR(0, 5250, __pyx_L1_error))
   /*else*/ {
     __pyx_t_10 = 0;
     __pyx_t_9 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_offsets.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_offsets.shape[0])) __pyx_t_9 = 0;
     if (unlikely(__pyx_t_9 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_9);
-      __PYX_ERR(0, 5255, __pyx_L1_error)
+      __PYX_ERR(0, 5250, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_10 * __pyx_v_offsets.strides[0]) )) = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5256
+    /* "discretize/_extensions/tree_ext.pyx":5251
  *         else:
  *             offsets[0] = 0
  *             offsets[1] = self.n_total_faces_x             # <<<<<<<<<<<<<<
  *             offsets[2] = self.n_total_faces_x + self.n_total_faces_y
  * 
  */
-    __Pyx_TraceLine(5256,0,__PYX_ERR(0, 5256, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5256, __pyx_L1_error)
+    __Pyx_TraceLine(5251,0,__PYX_ERR(0, 5251, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5251, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_11 = __Pyx_PyInt_As_npy_int64(__pyx_t_2); if (unlikely((__pyx_t_11 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5256, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_As_npy_int64(__pyx_t_2); if (unlikely((__pyx_t_11 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5251, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_10 = 1;
     __pyx_t_9 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_offsets.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_offsets.shape[0])) __pyx_t_9 = 0;
     if (unlikely(__pyx_t_9 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_9);
-      __PYX_ERR(0, 5256, __pyx_L1_error)
+      __PYX_ERR(0, 5251, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_10 * __pyx_v_offsets.strides[0]) )) = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":5257
+    /* "discretize/_extensions/tree_ext.pyx":5252
  *             offsets[0] = 0
  *             offsets[1] = self.n_total_faces_x
  *             offsets[2] = self.n_total_faces_x + self.n_total_faces_y             # <<<<<<<<<<<<<<
  * 
  *         for cell in self.tree.cells:
  */
-    __Pyx_TraceLine(5257,0,__PYX_ERR(0, 5257, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5257, __pyx_L1_error)
+    __Pyx_TraceLine(5252,0,__PYX_ERR(0, 5252, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5257, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5257, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Add(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5252, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_11 = __Pyx_PyInt_As_npy_int64(__pyx_t_4); if (unlikely((__pyx_t_11 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5257, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_As_npy_int64(__pyx_t_4); if (unlikely((__pyx_t_11 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5252, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_10 = 2;
     __pyx_t_9 = -1;
     if (__pyx_t_10 < 0) {
       __pyx_t_10 += __pyx_v_offsets.shape[0];
       if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
     } else if (unlikely(__pyx_t_10 >= __pyx_v_offsets.shape[0])) __pyx_t_9 = 0;
     if (unlikely(__pyx_t_9 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_9);
-      __PYX_ERR(0, 5257, __pyx_L1_error)
+      __PYX_ERR(0, 5252, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_10 * __pyx_v_offsets.strides[0]) )) = __pyx_t_11;
   }
   __pyx_L5:;
 
-  /* "discretize/_extensions/tree_ext.pyx":5259
+  /* "discretize/_extensions/tree_ext.pyx":5254
  *             offsets[2] = self.n_total_faces_x + self.n_total_faces_y
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             ind = cell.index
  *             if dim==2:
  */
-  __Pyx_TraceLine(5259,0,__PYX_ERR(0, 5259, __pyx_L1_error))
+  __Pyx_TraceLine(5254,0,__PYX_ERR(0, 5254, __pyx_L1_error))
   __pyx_t_13 = &__pyx_v_self->tree->cells;
   __pyx_t_12 = __pyx_t_13->begin();
   for (;;) {
     if (!(__pyx_t_12 != __pyx_t_13->end())) break;
     __pyx_t_14 = *__pyx_t_12;
     ++__pyx_t_12;
     __pyx_v_cell = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":5260
+    /* "discretize/_extensions/tree_ext.pyx":5255
  * 
  *         for cell in self.tree.cells:
  *             ind = cell.index             # <<<<<<<<<<<<<<
  *             if dim==2:
  *                 J1[ind] = cell.edges[2 + faces[0]].index
  */
-    __Pyx_TraceLine(5260,0,__PYX_ERR(0, 5260, __pyx_L1_error))
+    __Pyx_TraceLine(5255,0,__PYX_ERR(0, 5255, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_cell->index;
     __pyx_v_ind = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":5261
+    /* "discretize/_extensions/tree_ext.pyx":5256
  *         for cell in self.tree.cells:
  *             ind = cell.index
  *             if dim==2:             # <<<<<<<<<<<<<<
  *                 J1[ind] = cell.edges[2 + faces[0]].index
  *                 J2[ind] = cell.edges[    faces[1]].index + offsets[1]
  */
-    __Pyx_TraceLine(5261,0,__PYX_ERR(0, 5261, __pyx_L1_error))
+    __Pyx_TraceLine(5256,0,__PYX_ERR(0, 5256, __pyx_L1_error))
     __pyx_t_8 = ((__pyx_v_dim == 2) != 0);
     if (__pyx_t_8) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5262
+      /* "discretize/_extensions/tree_ext.pyx":5257
  *             ind = cell.index
  *             if dim==2:
  *                 J1[ind] = cell.edges[2 + faces[0]].index             # <<<<<<<<<<<<<<
  *                 J2[ind] = cell.edges[    faces[1]].index + offsets[1]
  *             else:
  */
-      __Pyx_TraceLine(5262,0,__PYX_ERR(0, 5262, __pyx_L1_error))
+      __Pyx_TraceLine(5257,0,__PYX_ERR(0, 5257, __pyx_L1_error))
       __pyx_t_1 = (__pyx_v_cell->edges[(2 + (__pyx_v_faces[0]))])->index;
       __pyx_t_10 = __pyx_v_ind;
       __pyx_t_9 = -1;
       if (__pyx_t_10 < 0) {
         __pyx_t_10 += __pyx_v_J1.shape[0];
         if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
       } else if (unlikely(__pyx_t_10 >= __pyx_v_J1.shape[0])) __pyx_t_9 = 0;
       if (unlikely(__pyx_t_9 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        __PYX_ERR(0, 5262, __pyx_L1_error)
+        __PYX_ERR(0, 5257, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J1.data + __pyx_t_10 * __pyx_v_J1.strides[0]) )) = __pyx_t_1;
 
-      /* "discretize/_extensions/tree_ext.pyx":5263
+      /* "discretize/_extensions/tree_ext.pyx":5258
  *             if dim==2:
  *                 J1[ind] = cell.edges[2 + faces[0]].index
  *                 J2[ind] = cell.edges[    faces[1]].index + offsets[1]             # <<<<<<<<<<<<<<
  *             else:
  *                 J1[ind] = cell.faces[    faces[0]].index
  */
-      __Pyx_TraceLine(5263,0,__PYX_ERR(0, 5263, __pyx_L1_error))
+      __Pyx_TraceLine(5258,0,__PYX_ERR(0, 5258, __pyx_L1_error))
       __pyx_t_10 = 1;
       __pyx_t_9 = -1;
       if (__pyx_t_10 < 0) {
         __pyx_t_10 += __pyx_v_offsets.shape[0];
         if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
       } else if (unlikely(__pyx_t_10 >= __pyx_v_offsets.shape[0])) __pyx_t_9 = 0;
       if (unlikely(__pyx_t_9 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        __PYX_ERR(0, 5263, __pyx_L1_error)
+        __PYX_ERR(0, 5258, __pyx_L1_error)
       }
       __pyx_t_16 = __pyx_v_ind;
       __pyx_t_9 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J2.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_9 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J2.shape[0])) __pyx_t_9 = 0;
       if (unlikely(__pyx_t_9 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        __PYX_ERR(0, 5263, __pyx_L1_error)
+        __PYX_ERR(0, 5258, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J2.data + __pyx_t_16 * __pyx_v_J2.strides[0]) )) = ((__pyx_v_cell->edges[(__pyx_v_faces[1])])->index + (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_10 * __pyx_v_offsets.strides[0]) ))));
 
-      /* "discretize/_extensions/tree_ext.pyx":5261
+      /* "discretize/_extensions/tree_ext.pyx":5256
  *         for cell in self.tree.cells:
  *             ind = cell.index
  *             if dim==2:             # <<<<<<<<<<<<<<
  *                 J1[ind] = cell.edges[2 + faces[0]].index
  *                 J2[ind] = cell.edges[    faces[1]].index + offsets[1]
  */
       goto __pyx_L8;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5265
+    /* "discretize/_extensions/tree_ext.pyx":5260
  *                 J2[ind] = cell.edges[    faces[1]].index + offsets[1]
  *             else:
  *                 J1[ind] = cell.faces[    faces[0]].index             # <<<<<<<<<<<<<<
  *                 J2[ind] = cell.faces[2 + faces[1]].index + offsets[1]
  *                 J3[ind] = cell.faces[4 + faces[2]].index + offsets[2]
  */
-    __Pyx_TraceLine(5265,0,__PYX_ERR(0, 5265, __pyx_L1_error))
+    __Pyx_TraceLine(5260,0,__PYX_ERR(0, 5260, __pyx_L1_error))
     /*else*/ {
       __pyx_t_1 = (__pyx_v_cell->faces[(__pyx_v_faces[0])])->index;
       __pyx_t_10 = __pyx_v_ind;
       __pyx_t_9 = -1;
       if (__pyx_t_10 < 0) {
         __pyx_t_10 += __pyx_v_J1.shape[0];
         if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
       } else if (unlikely(__pyx_t_10 >= __pyx_v_J1.shape[0])) __pyx_t_9 = 0;
       if (unlikely(__pyx_t_9 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        __PYX_ERR(0, 5265, __pyx_L1_error)
+        __PYX_ERR(0, 5260, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J1.data + __pyx_t_10 * __pyx_v_J1.strides[0]) )) = __pyx_t_1;
 
-      /* "discretize/_extensions/tree_ext.pyx":5266
+      /* "discretize/_extensions/tree_ext.pyx":5261
  *             else:
  *                 J1[ind] = cell.faces[    faces[0]].index
  *                 J2[ind] = cell.faces[2 + faces[1]].index + offsets[1]             # <<<<<<<<<<<<<<
  *                 J3[ind] = cell.faces[4 + faces[2]].index + offsets[2]
  * 
  */
-      __Pyx_TraceLine(5266,0,__PYX_ERR(0, 5266, __pyx_L1_error))
+      __Pyx_TraceLine(5261,0,__PYX_ERR(0, 5261, __pyx_L1_error))
       __pyx_t_10 = 1;
       __pyx_t_9 = -1;
       if (__pyx_t_10 < 0) {
         __pyx_t_10 += __pyx_v_offsets.shape[0];
         if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
       } else if (unlikely(__pyx_t_10 >= __pyx_v_offsets.shape[0])) __pyx_t_9 = 0;
       if (unlikely(__pyx_t_9 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        __PYX_ERR(0, 5266, __pyx_L1_error)
+        __PYX_ERR(0, 5261, __pyx_L1_error)
       }
       __pyx_t_16 = __pyx_v_ind;
       __pyx_t_9 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J2.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_9 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J2.shape[0])) __pyx_t_9 = 0;
       if (unlikely(__pyx_t_9 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        __PYX_ERR(0, 5266, __pyx_L1_error)
+        __PYX_ERR(0, 5261, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J2.data + __pyx_t_16 * __pyx_v_J2.strides[0]) )) = ((__pyx_v_cell->faces[(2 + (__pyx_v_faces[1]))])->index + (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_10 * __pyx_v_offsets.strides[0]) ))));
 
-      /* "discretize/_extensions/tree_ext.pyx":5267
+      /* "discretize/_extensions/tree_ext.pyx":5262
  *                 J1[ind] = cell.faces[    faces[0]].index
  *                 J2[ind] = cell.faces[2 + faces[1]].index + offsets[1]
  *                 J3[ind] = cell.faces[4 + faces[2]].index + offsets[2]             # <<<<<<<<<<<<<<
  * 
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)
  */
-      __Pyx_TraceLine(5267,0,__PYX_ERR(0, 5267, __pyx_L1_error))
+      __Pyx_TraceLine(5262,0,__PYX_ERR(0, 5262, __pyx_L1_error))
       __pyx_t_10 = 2;
       __pyx_t_9 = -1;
       if (__pyx_t_10 < 0) {
         __pyx_t_10 += __pyx_v_offsets.shape[0];
         if (unlikely(__pyx_t_10 < 0)) __pyx_t_9 = 0;
       } else if (unlikely(__pyx_t_10 >= __pyx_v_offsets.shape[0])) __pyx_t_9 = 0;
       if (unlikely(__pyx_t_9 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        __PYX_ERR(0, 5267, __pyx_L1_error)
+        __PYX_ERR(0, 5262, __pyx_L1_error)
       }
-      if (unlikely(!__pyx_v_J3.memview)) { __Pyx_RaiseUnboundLocalError("J3"); __PYX_ERR(0, 5267, __pyx_L1_error) }
+      if (unlikely(!__pyx_v_J3.memview)) { __Pyx_RaiseUnboundLocalError("J3"); __PYX_ERR(0, 5262, __pyx_L1_error) }
       __pyx_t_16 = __pyx_v_ind;
       __pyx_t_9 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_J3.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_9 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_J3.shape[0])) __pyx_t_9 = 0;
       if (unlikely(__pyx_t_9 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_9);
-        __PYX_ERR(0, 5267, __pyx_L1_error)
+        __PYX_ERR(0, 5262, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J3.data + __pyx_t_16 * __pyx_v_J3.strides[0]) )) = ((__pyx_v_cell->faces[(4 + (__pyx_v_faces[2]))])->index + (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_10 * __pyx_v_offsets.strides[0]) ))));
     }
     __pyx_L8:;
 
-    /* "discretize/_extensions/tree_ext.pyx":5259
+    /* "discretize/_extensions/tree_ext.pyx":5254
  *             offsets[2] = self.n_total_faces_x + self.n_total_faces_y
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             ind = cell.index
  *             if dim==2:
  */
-    __Pyx_TraceLine(5259,0,__PYX_ERR(0, 5259, __pyx_L1_error))
+    __Pyx_TraceLine(5254,0,__PYX_ERR(0, 5254, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5269
+  /* "discretize/_extensions/tree_ext.pyx":5264
  *                 J3[ind] = cell.faces[4 + faces[2]].index + offsets[2]
  * 
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         if dim==2:
  *             J = np.r_[J1, J2]
  */
-  __Pyx_TraceLine(5269,0,__PYX_ERR(0, 5269, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __Pyx_TraceLine(5264,0,__PYX_ERR(0, 5264, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5269, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5269, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5264, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_I = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5270
+  /* "discretize/_extensions/tree_ext.pyx":5265
  * 
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)
  *         if dim==2:             # <<<<<<<<<<<<<<
  *             J = np.r_[J1, J2]
  *         else:
  */
-  __Pyx_TraceLine(5270,0,__PYX_ERR(0, 5270, __pyx_L1_error))
+  __Pyx_TraceLine(5265,0,__PYX_ERR(0, 5265, __pyx_L1_error))
   __pyx_t_8 = ((__pyx_v_dim == 2) != 0);
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5271
+    /* "discretize/_extensions/tree_ext.pyx":5266
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)
  *         if dim==2:
  *             J = np.r_[J1, J2]             # <<<<<<<<<<<<<<
  *         else:
  *             J = np.r_[J1, J2, J3]
  */
-    __Pyx_TraceLine(5271,0,__PYX_ERR(0, 5271, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5271, __pyx_L1_error)
+    __Pyx_TraceLine(5266,0,__PYX_ERR(0, 5266, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_r); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5271, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_r); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_J1, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5271, __pyx_L1_error)
+    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_J1, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J2, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5271, __pyx_L1_error)
+    __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J2, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5271, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_2);
     PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2);
     __pyx_t_6 = 0;
     __pyx_t_2 = 0;
-    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5271, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5266, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5271, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5266, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_v_J = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5270
+    /* "discretize/_extensions/tree_ext.pyx":5265
  * 
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)
  *         if dim==2:             # <<<<<<<<<<<<<<
  *             J = np.r_[J1, J2]
  *         else:
  */
     goto __pyx_L9;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5273
+  /* "discretize/_extensions/tree_ext.pyx":5268
  *             J = np.r_[J1, J2]
  *         else:
  *             J = np.r_[J1, J2, J3]             # <<<<<<<<<<<<<<
  *         V = np.ones(self.n_cells*dim, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(5273,0,__PYX_ERR(0, 5273, __pyx_L1_error))
+  __Pyx_TraceLine(5268,0,__PYX_ERR(0, 5268, __pyx_L1_error))
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5273, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_r); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5273, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_r); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J1, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5273, __pyx_L1_error)
+    __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_J1, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J2, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5273, __pyx_L1_error)
+    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J2, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    if (unlikely(!__pyx_v_J3.memview)) { __Pyx_RaiseUnboundLocalError("J3"); __PYX_ERR(0, 5273, __pyx_L1_error) }
-    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_J3, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5273, __pyx_L1_error)
+    if (unlikely(!__pyx_v_J3.memview)) { __Pyx_RaiseUnboundLocalError("J3"); __PYX_ERR(0, 5268, __pyx_L1_error) }
+    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_J3, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5273, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_2);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_6);
     __pyx_t_2 = 0;
     __pyx_t_5 = 0;
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5273, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5268, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5273, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5268, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_J = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
   }
   __pyx_L9:;
 
-  /* "discretize/_extensions/tree_ext.pyx":5274
+  /* "discretize/_extensions/tree_ext.pyx":5269
  *         else:
  *             J = np.r_[J1, J2, J3]
  *         V = np.ones(self.n_cells*dim, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         P = sp.csr_matrix((V, (I, J)), shape=(self._dim*self.n_cells, self.n_total_faces))
  */
-  __Pyx_TraceLine(5274,0,__PYX_ERR(0, 5274, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __Pyx_TraceLine(5269,0,__PYX_ERR(0, 5269, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_float64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_float64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 5274, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 5274, __pyx_L1_error)
+  __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 5269, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_V = __pyx_t_17;
   __pyx_t_17.memview = NULL;
   __pyx_t_17.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5276
+  /* "discretize/_extensions/tree_ext.pyx":5271
  *         V = np.ones(self.n_cells*dim, dtype=np.float64)
  * 
  *         P = sp.csr_matrix((V, (I, J)), shape=(self._dim*self.n_cells, self.n_total_faces))             # <<<<<<<<<<<<<<
  *         Rf = self._deflate_faces()
  *         return P*Rf
  */
-  __Pyx_TraceLine(5276,0,__PYX_ERR(0, 5276, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sp); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __Pyx_TraceLine(5271,0,__PYX_ERR(0, 5271, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_sp); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_4);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_6);
   __pyx_t_2 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyInt_From_int_t(__pyx_v_self->_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int_t(__pyx_v_self->_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_18 = PyNumber_Multiply(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_18 = PyNumber_Multiply(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_18);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_18);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_18);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
   __pyx_t_18 = 0;
   __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_shape, __pyx_t_2) < 0) __PYX_ERR(0, 5276, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_shape, __pyx_t_2) < 0) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5276, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5271, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_P = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5277
+  /* "discretize/_extensions/tree_ext.pyx":5272
  * 
  *         P = sp.csr_matrix((V, (I, J)), shape=(self._dim*self.n_cells, self.n_total_faces))
  *         Rf = self._deflate_faces()             # <<<<<<<<<<<<<<
  *         return P*Rf
  * 
  */
-  __Pyx_TraceLine(5277,0,__PYX_ERR(0, 5277, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5277, __pyx_L1_error)
+  __Pyx_TraceLine(5272,0,__PYX_ERR(0, 5272, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5272, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5277, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5272, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_Rf = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5278
+  /* "discretize/_extensions/tree_ext.pyx":5273
  *         P = sp.csr_matrix((V, (I, J)), shape=(self._dim*self.n_cells, self.n_total_faces))
  *         Rf = self._deflate_faces()
  *         return P*Rf             # <<<<<<<<<<<<<<
  * 
  *     def _getFacePxx(self):
  */
-  __Pyx_TraceLine(5278,0,__PYX_ERR(0, 5278, __pyx_L1_error))
+  __Pyx_TraceLine(5273,0,__PYX_ERR(0, 5273, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = PyNumber_Multiply(__pyx_v_P, __pyx_v_Rf); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5278, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Multiply(__pyx_v_P, __pyx_v_Rf); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5273, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5232
+  /* "discretize/_extensions/tree_ext.pyx":5227
  *             return np.array(levels)
  * 
  *     def _getFaceP(self, xFace, yFace, zFace):             # <<<<<<<<<<<<<<
  *         cdef int dim = self._dim
  *         cdef int_t ind, id
  */
 
@@ -62752,15 +62764,15 @@
   __Pyx_XDECREF(__pyx_v_Rf);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5280
+/* "discretize/_extensions/tree_ext.pyx":5275
  *         return P*Rf
  * 
  *     def _getFacePxx(self):             # <<<<<<<<<<<<<<
  *         def Pxx(xFace, yFace):
  *             return self._getFaceP(xFace, yFace, None)
  */
 
@@ -62774,15 +62786,15 @@
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_70_getFacePxx(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5281
+/* "discretize/_extensions/tree_ext.pyx":5276
  * 
  *     def _getFacePxx(self):
  *         def Pxx(xFace, yFace):             # <<<<<<<<<<<<<<
  *             return self._getFaceP(xFace, yFace, None)
  *         return Pxx
  */
 
@@ -62817,32 +62829,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_xFace)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yFace)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("Pxx", 1, 2, 2, 1); __PYX_ERR(0, 5281, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("Pxx", 1, 2, 2, 1); __PYX_ERR(0, 5276, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "Pxx") < 0)) __PYX_ERR(0, 5281, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "Pxx") < 0)) __PYX_ERR(0, 5276, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_xFace = values[0];
     __pyx_v_yFace = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("Pxx", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5281, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("Pxx", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5276, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getFacePxx.Pxx", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_11_getFacePxx_Pxx(__pyx_self, __pyx_v_xFace, __pyx_v_yFace);
 
@@ -62864,27 +62876,27 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("Pxx", 0);
   __pyx_outer_scope = (struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
-  __Pyx_TraceCall("Pxx", __pyx_f[0], 5281, 0, __PYX_ERR(0, 5281, __pyx_L1_error));
+  __Pyx_TraceCall("Pxx", __pyx_f[0], 5276, 0, __PYX_ERR(0, 5276, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5282
+  /* "discretize/_extensions/tree_ext.pyx":5277
  *     def _getFacePxx(self):
  *         def Pxx(xFace, yFace):
  *             return self._getFaceP(xFace, yFace, None)             # <<<<<<<<<<<<<<
  *         return Pxx
  * 
  */
-  __Pyx_TraceLine(5282,0,__PYX_ERR(0, 5282, __pyx_L1_error))
+  __Pyx_TraceLine(5277,0,__PYX_ERR(0, 5277, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 5282, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_getFaceP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5282, __pyx_L1_error)
+  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 5277, __pyx_L1_error) }
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_getFaceP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5277, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -62893,52 +62905,52 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_xFace, __pyx_v_yFace, Py_None};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5282, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5277, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_xFace, __pyx_v_yFace, Py_None};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5282, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5277, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5282, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5277, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_xFace);
     __Pyx_GIVEREF(__pyx_v_xFace);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_xFace);
     __Pyx_INCREF(__pyx_v_yFace);
     __Pyx_GIVEREF(__pyx_v_yFace);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_yFace);
     __Pyx_INCREF(Py_None);
     __Pyx_GIVEREF(Py_None);
     PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, Py_None);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5282, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5277, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5281
+  /* "discretize/_extensions/tree_ext.pyx":5276
  * 
  *     def _getFacePxx(self):
  *         def Pxx(xFace, yFace):             # <<<<<<<<<<<<<<
  *             return self._getFaceP(xFace, yFace, None)
  *         return Pxx
  */
 
@@ -62953,15 +62965,15 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5280
+/* "discretize/_extensions/tree_ext.pyx":5275
  *         return P*Rf
  * 
  *     def _getFacePxx(self):             # <<<<<<<<<<<<<<
  *         def Pxx(xFace, yFace):
  *             return self._getFaceP(xFace, yFace, None)
  */
 
@@ -62976,50 +62988,50 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getFacePxx", 0);
   __pyx_cur_scope = (struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx *)__pyx_tp_new_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx(__pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 5280, __pyx_L1_error)
+    __PYX_ERR(0, 5275, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
-  __Pyx_TraceCall("_getFacePxx", __pyx_f[0], 5280, 0, __PYX_ERR(0, 5280, __pyx_L1_error));
+  __Pyx_TraceCall("_getFacePxx", __pyx_f[0], 5275, 0, __PYX_ERR(0, 5275, __pyx_L1_error));
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
 
-  /* "discretize/_extensions/tree_ext.pyx":5281
+  /* "discretize/_extensions/tree_ext.pyx":5276
  * 
  *     def _getFacePxx(self):
  *         def Pxx(xFace, yFace):             # <<<<<<<<<<<<<<
  *             return self._getFaceP(xFace, yFace, None)
  *         return Pxx
  */
-  __Pyx_TraceLine(5281,0,__PYX_ERR(0, 5281, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_10discretize_11_extensions_8tree_ext_9_TreeMesh_11_getFacePxx_1Pxx, 0, __pyx_n_s_getFacePxx_locals_Pxx, ((PyObject*)__pyx_cur_scope), __pyx_n_s_discretize__extensions_tree_ext_2, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5281, __pyx_L1_error)
+  __Pyx_TraceLine(5276,0,__PYX_ERR(0, 5276, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_10discretize_11_extensions_8tree_ext_9_TreeMesh_11_getFacePxx_1Pxx, 0, __pyx_n_s_getFacePxx_locals_Pxx, ((PyObject*)__pyx_cur_scope), __pyx_n_s_discretize__extensions_tree_ext_2, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_Pxx = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5283
+  /* "discretize/_extensions/tree_ext.pyx":5278
  *         def Pxx(xFace, yFace):
  *             return self._getFaceP(xFace, yFace, None)
  *         return Pxx             # <<<<<<<<<<<<<<
  * 
  *     def _getFacePxxx(self):
  */
-  __Pyx_TraceLine(5283,0,__PYX_ERR(0, 5283, __pyx_L1_error))
+  __Pyx_TraceLine(5278,0,__PYX_ERR(0, 5278, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_Pxx);
   __pyx_r = __pyx_v_Pxx;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5280
+  /* "discretize/_extensions/tree_ext.pyx":5275
  *         return P*Rf
  * 
  *     def _getFacePxx(self):             # <<<<<<<<<<<<<<
  *         def Pxx(xFace, yFace):
  *             return self._getFaceP(xFace, yFace, None)
  */
 
@@ -63033,15 +63045,15 @@
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5285
+/* "discretize/_extensions/tree_ext.pyx":5280
  *         return Pxx
  * 
  *     def _getFacePxxx(self):             # <<<<<<<<<<<<<<
  *         def Pxxx(xFace, yFace, zFace):
  *             return self._getFaceP(xFace, yFace, zFace)
  */
 
@@ -63055,15 +63067,15 @@
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_72_getFacePxxx(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5286
+/* "discretize/_extensions/tree_ext.pyx":5281
  * 
  *     def _getFacePxxx(self):
  *         def Pxxx(xFace, yFace, zFace):             # <<<<<<<<<<<<<<
  *             return self._getFaceP(xFace, yFace, zFace)
  *         return Pxxx
  */
 
@@ -63101,40 +63113,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_xFace)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yFace)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, 1); __PYX_ERR(0, 5286, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, 1); __PYX_ERR(0, 5281, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zFace)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, 2); __PYX_ERR(0, 5286, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, 2); __PYX_ERR(0, 5281, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "Pxxx") < 0)) __PYX_ERR(0, 5286, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "Pxxx") < 0)) __PYX_ERR(0, 5281, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_xFace = values[0];
     __pyx_v_yFace = values[1];
     __pyx_v_zFace = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5286, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5281, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getFacePxxx.Pxxx", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_12_getFacePxxx_Pxxx(__pyx_self, __pyx_v_xFace, __pyx_v_yFace, __pyx_v_zFace);
 
@@ -63156,27 +63168,27 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("Pxxx", 0);
   __pyx_outer_scope = (struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
-  __Pyx_TraceCall("Pxxx", __pyx_f[0], 5286, 0, __PYX_ERR(0, 5286, __pyx_L1_error));
+  __Pyx_TraceCall("Pxxx", __pyx_f[0], 5281, 0, __PYX_ERR(0, 5281, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5287
+  /* "discretize/_extensions/tree_ext.pyx":5282
  *     def _getFacePxxx(self):
  *         def Pxxx(xFace, yFace, zFace):
  *             return self._getFaceP(xFace, yFace, zFace)             # <<<<<<<<<<<<<<
  *         return Pxxx
  * 
  */
-  __Pyx_TraceLine(5287,0,__PYX_ERR(0, 5287, __pyx_L1_error))
+  __Pyx_TraceLine(5282,0,__PYX_ERR(0, 5282, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 5287, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_getFaceP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5287, __pyx_L1_error)
+  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 5282, __pyx_L1_error) }
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_getFaceP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5282, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -63185,52 +63197,52 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_xFace, __pyx_v_yFace, __pyx_v_zFace};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5287, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5282, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_xFace, __pyx_v_yFace, __pyx_v_zFace};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5287, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5282, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5287, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5282, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_xFace);
     __Pyx_GIVEREF(__pyx_v_xFace);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_xFace);
     __Pyx_INCREF(__pyx_v_yFace);
     __Pyx_GIVEREF(__pyx_v_yFace);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_yFace);
     __Pyx_INCREF(__pyx_v_zFace);
     __Pyx_GIVEREF(__pyx_v_zFace);
     PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, __pyx_v_zFace);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5287, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5282, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5286
+  /* "discretize/_extensions/tree_ext.pyx":5281
  * 
  *     def _getFacePxxx(self):
  *         def Pxxx(xFace, yFace, zFace):             # <<<<<<<<<<<<<<
  *             return self._getFaceP(xFace, yFace, zFace)
  *         return Pxxx
  */
 
@@ -63245,15 +63257,15 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5285
+/* "discretize/_extensions/tree_ext.pyx":5280
  *         return Pxx
  * 
  *     def _getFacePxxx(self):             # <<<<<<<<<<<<<<
  *         def Pxxx(xFace, yFace, zFace):
  *             return self._getFaceP(xFace, yFace, zFace)
  */
 
@@ -63268,50 +63280,50 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getFacePxxx", 0);
   __pyx_cur_scope = (struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx *)__pyx_tp_new_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx(__pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 5285, __pyx_L1_error)
+    __PYX_ERR(0, 5280, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
-  __Pyx_TraceCall("_getFacePxxx", __pyx_f[0], 5285, 0, __PYX_ERR(0, 5285, __pyx_L1_error));
+  __Pyx_TraceCall("_getFacePxxx", __pyx_f[0], 5280, 0, __PYX_ERR(0, 5280, __pyx_L1_error));
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
 
-  /* "discretize/_extensions/tree_ext.pyx":5286
+  /* "discretize/_extensions/tree_ext.pyx":5281
  * 
  *     def _getFacePxxx(self):
  *         def Pxxx(xFace, yFace, zFace):             # <<<<<<<<<<<<<<
  *             return self._getFaceP(xFace, yFace, zFace)
  *         return Pxxx
  */
-  __Pyx_TraceLine(5286,0,__PYX_ERR(0, 5286, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_10discretize_11_extensions_8tree_ext_9_TreeMesh_12_getFacePxxx_1Pxxx, 0, __pyx_n_s_getFacePxxx_locals_Pxxx, ((PyObject*)__pyx_cur_scope), __pyx_n_s_discretize__extensions_tree_ext_2, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5286, __pyx_L1_error)
+  __Pyx_TraceLine(5281,0,__PYX_ERR(0, 5281, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_10discretize_11_extensions_8tree_ext_9_TreeMesh_12_getFacePxxx_1Pxxx, 0, __pyx_n_s_getFacePxxx_locals_Pxxx, ((PyObject*)__pyx_cur_scope), __pyx_n_s_discretize__extensions_tree_ext_2, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5281, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_Pxxx = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5288
+  /* "discretize/_extensions/tree_ext.pyx":5283
  *         def Pxxx(xFace, yFace, zFace):
  *             return self._getFaceP(xFace, yFace, zFace)
  *         return Pxxx             # <<<<<<<<<<<<<<
  * 
  *     def _getEdgeP(self, xEdge, yEdge, zEdge):
  */
-  __Pyx_TraceLine(5288,0,__PYX_ERR(0, 5288, __pyx_L1_error))
+  __Pyx_TraceLine(5283,0,__PYX_ERR(0, 5283, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_Pxxx);
   __pyx_r = __pyx_v_Pxxx;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5285
+  /* "discretize/_extensions/tree_ext.pyx":5280
  *         return Pxx
  * 
  *     def _getFacePxxx(self):             # <<<<<<<<<<<<<<
  *         def Pxxx(xFace, yFace, zFace):
  *             return self._getFaceP(xFace, yFace, zFace)
  */
 
@@ -63325,15 +63337,15 @@
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5290
+/* "discretize/_extensions/tree_ext.pyx":5285
  *         return Pxxx
  * 
  *     def _getEdgeP(self, xEdge, yEdge, zEdge):             # <<<<<<<<<<<<<<
  *         cdef int dim = self._dim
  *         cdef int_t ind, id
  */
 
@@ -63371,40 +63383,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_xEdge)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yEdge)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getEdgeP", 1, 3, 3, 1); __PYX_ERR(0, 5290, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getEdgeP", 1, 3, 3, 1); __PYX_ERR(0, 5285, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zEdge)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getEdgeP", 1, 3, 3, 2); __PYX_ERR(0, 5290, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getEdgeP", 1, 3, 3, 2); __PYX_ERR(0, 5285, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getEdgeP") < 0)) __PYX_ERR(0, 5290, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getEdgeP") < 0)) __PYX_ERR(0, 5285, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_xEdge = values[0];
     __pyx_v_yEdge = values[1];
     __pyx_v_zEdge = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_getEdgeP", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5290, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_getEdgeP", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5285, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getEdgeP", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_74_getEdgeP(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_xEdge, __pyx_v_yEdge, __pyx_v_zEdge);
 
@@ -63452,306 +63464,306 @@
   Py_ssize_t __pyx_t_19;
   __Pyx_memviewslice __pyx_t_20 = { 0, 0, { 0 }, { 0 }, { 0 } };
   PyObject *__pyx_t_21 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getEdgeP", 0);
-  __Pyx_TraceCall("_getEdgeP", __pyx_f[0], 5290, 0, __PYX_ERR(0, 5290, __pyx_L1_error));
+  __Pyx_TraceCall("_getEdgeP", __pyx_f[0], 5285, 0, __PYX_ERR(0, 5285, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5291
+  /* "discretize/_extensions/tree_ext.pyx":5286
  * 
  *     def _getEdgeP(self, xEdge, yEdge, zEdge):
  *         cdef int dim = self._dim             # <<<<<<<<<<<<<<
  *         cdef int_t ind, id
  *         cdef int epc = 1<<(dim-1) #edges per cell 2/4
  */
-  __Pyx_TraceLine(5291,0,__PYX_ERR(0, 5291, __pyx_L1_error))
+  __Pyx_TraceLine(5286,0,__PYX_ERR(0, 5286, __pyx_L1_error))
   __pyx_t_1 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_1;
 
-  /* "discretize/_extensions/tree_ext.pyx":5293
+  /* "discretize/_extensions/tree_ext.pyx":5288
  *         cdef int dim = self._dim
  *         cdef int_t ind, id
  *         cdef int epc = 1<<(dim-1) #edges per cell 2/4             # <<<<<<<<<<<<<<
  * 
  *         cdef np.int64_t[:] I, J, J1, J2, J3
  */
-  __Pyx_TraceLine(5293,0,__PYX_ERR(0, 5293, __pyx_L1_error))
+  __Pyx_TraceLine(5288,0,__PYX_ERR(0, 5288, __pyx_L1_error))
   __pyx_v_epc = (1 << (__pyx_v_dim - 1));
 
-  /* "discretize/_extensions/tree_ext.pyx":5298
+  /* "discretize/_extensions/tree_ext.pyx":5293
  *         cdef np.float64_t[:] V
  * 
  *         J1 = np.empty(self.n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         J2 = np.empty(self.n_cells, dtype=np.int64)
  *         if dim == 3:
  */
-  __Pyx_TraceLine(5298,0,__PYX_ERR(0, 5298, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __Pyx_TraceLine(5293,0,__PYX_ERR(0, 5293, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2);
   __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5298, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5298, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5293, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J1 = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5299
+  /* "discretize/_extensions/tree_ext.pyx":5294
  * 
  *         J1 = np.empty(self.n_cells, dtype=np.int64)
  *         J2 = np.empty(self.n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         if dim == 3:
  *             J3 = np.empty(self.n_cells, dtype=np.int64)
  */
-  __Pyx_TraceLine(5299,0,__PYX_ERR(0, 5299, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __Pyx_TraceLine(5294,0,__PYX_ERR(0, 5294, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5299, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5299, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5294, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_J2 = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5300
+  /* "discretize/_extensions/tree_ext.pyx":5295
  *         J1 = np.empty(self.n_cells, dtype=np.int64)
  *         J2 = np.empty(self.n_cells, dtype=np.int64)
  *         if dim == 3:             # <<<<<<<<<<<<<<
  *             J3 = np.empty(self.n_cells, dtype=np.int64)
  * 
  */
-  __Pyx_TraceLine(5300,0,__PYX_ERR(0, 5300, __pyx_L1_error))
+  __Pyx_TraceLine(5295,0,__PYX_ERR(0, 5295, __pyx_L1_error))
   __pyx_t_8 = ((__pyx_v_dim == 3) != 0);
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5301
+    /* "discretize/_extensions/tree_ext.pyx":5296
  *         J2 = np.empty(self.n_cells, dtype=np.int64)
  *         if dim == 3:
  *             J3 = np.empty(self.n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  * 
  *         cdef int[3] edges
  */
-    __Pyx_TraceLine(5301,0,__PYX_ERR(0, 5301, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __Pyx_TraceLine(5296,0,__PYX_ERR(0, 5296, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
     __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5301, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5301, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5296, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_J3 = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5300
+    /* "discretize/_extensions/tree_ext.pyx":5295
  *         J1 = np.empty(self.n_cells, dtype=np.int64)
  *         J2 = np.empty(self.n_cells, dtype=np.int64)
  *         if dim == 3:             # <<<<<<<<<<<<<<
  *             J3 = np.empty(self.n_cells, dtype=np.int64)
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5304
+  /* "discretize/_extensions/tree_ext.pyx":5299
  * 
  *         cdef int[3] edges
  *         cdef np.int64_t[:] offsets = np.empty(self._dim, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         try:
  *             edges[0] = int(xEdge[-1]) #0, 1, 2, 3
  */
-  __Pyx_TraceLine(5304,0,__PYX_ERR(0, 5304, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __Pyx_TraceLine(5299,0,__PYX_ERR(0, 5299, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_int_t(__pyx_v_self->_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int_t(__pyx_v_self->_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 5304, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5304, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_2, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5299, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_v_offsets = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5305
+  /* "discretize/_extensions/tree_ext.pyx":5300
  *         cdef int[3] edges
  *         cdef np.int64_t[:] offsets = np.empty(self._dim, dtype=np.int64)
  *         try:             # <<<<<<<<<<<<<<
  *             edges[0] = int(xEdge[-1]) #0, 1, 2, 3
  *             edges[1] = int(yEdge[-1]) #0, 1, 2, 3
  */
-  __Pyx_TraceLine(5305,0,__PYX_ERR(0, 5305, __pyx_L1_error))
+  __Pyx_TraceLine(5300,0,__PYX_ERR(0, 5300, __pyx_L1_error))
   {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
     __Pyx_XGOTREF(__pyx_t_9);
     __Pyx_XGOTREF(__pyx_t_10);
     __Pyx_XGOTREF(__pyx_t_11);
     /*try:*/ {
 
-      /* "discretize/_extensions/tree_ext.pyx":5306
+      /* "discretize/_extensions/tree_ext.pyx":5301
  *         cdef np.int64_t[:] offsets = np.empty(self._dim, dtype=np.int64)
  *         try:
  *             edges[0] = int(xEdge[-1]) #0, 1, 2, 3             # <<<<<<<<<<<<<<
  *             edges[1] = int(yEdge[-1]) #0, 1, 2, 3
  *             if dim == 3:
  */
-      __Pyx_TraceLine(5306,0,__PYX_ERR(0, 5306, __pyx_L4_error))
-      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_xEdge, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5306, __pyx_L4_error)
+      __Pyx_TraceLine(5301,0,__PYX_ERR(0, 5301, __pyx_L4_error))
+      __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_xEdge, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5301, __pyx_L4_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5306, __pyx_L4_error)
+      __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5301, __pyx_L4_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5306, __pyx_L4_error)
+      __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5301, __pyx_L4_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       (__pyx_v_edges[0]) = __pyx_t_12;
 
-      /* "discretize/_extensions/tree_ext.pyx":5307
+      /* "discretize/_extensions/tree_ext.pyx":5302
  *         try:
  *             edges[0] = int(xEdge[-1]) #0, 1, 2, 3
  *             edges[1] = int(yEdge[-1]) #0, 1, 2, 3             # <<<<<<<<<<<<<<
  *             if dim == 3:
  *                 edges[2] = int(zEdge[-1]) #0, 1, 2, 3
  */
-      __Pyx_TraceLine(5307,0,__PYX_ERR(0, 5307, __pyx_L4_error))
-      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_yEdge, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5307, __pyx_L4_error)
+      __Pyx_TraceLine(5302,0,__PYX_ERR(0, 5302, __pyx_L4_error))
+      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_yEdge, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5302, __pyx_L4_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5307, __pyx_L4_error)
+      __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5302, __pyx_L4_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5307, __pyx_L4_error)
+      __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_2); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5302, __pyx_L4_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       (__pyx_v_edges[1]) = __pyx_t_12;
 
-      /* "discretize/_extensions/tree_ext.pyx":5308
+      /* "discretize/_extensions/tree_ext.pyx":5303
  *             edges[0] = int(xEdge[-1]) #0, 1, 2, 3
  *             edges[1] = int(yEdge[-1]) #0, 1, 2, 3
  *             if dim == 3:             # <<<<<<<<<<<<<<
  *                 edges[2] = int(zEdge[-1]) #0, 1, 2, 3
  *         except ValueError:
  */
-      __Pyx_TraceLine(5308,0,__PYX_ERR(0, 5308, __pyx_L4_error))
+      __Pyx_TraceLine(5303,0,__PYX_ERR(0, 5303, __pyx_L4_error))
       __pyx_t_8 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_8) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5309
+        /* "discretize/_extensions/tree_ext.pyx":5304
  *             edges[1] = int(yEdge[-1]) #0, 1, 2, 3
  *             if dim == 3:
  *                 edges[2] = int(zEdge[-1]) #0, 1, 2, 3             # <<<<<<<<<<<<<<
  *         except ValueError:
  *             raise Exception('Last character of edge string must be 0, 1, 2, or 3')
  */
-        __Pyx_TraceLine(5309,0,__PYX_ERR(0, 5309, __pyx_L4_error))
-        __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_zEdge, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5309, __pyx_L4_error)
+        __Pyx_TraceLine(5304,0,__PYX_ERR(0, 5304, __pyx_L4_error))
+        __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_zEdge, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5304, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_2);
-        __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5309, __pyx_L4_error)
+        __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5304, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5309, __pyx_L4_error)
+        __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_t_3); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5304, __pyx_L4_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         (__pyx_v_edges[2]) = __pyx_t_12;
 
-        /* "discretize/_extensions/tree_ext.pyx":5308
+        /* "discretize/_extensions/tree_ext.pyx":5303
  *             edges[0] = int(xEdge[-1]) #0, 1, 2, 3
  *             edges[1] = int(yEdge[-1]) #0, 1, 2, 3
  *             if dim == 3:             # <<<<<<<<<<<<<<
  *                 edges[2] = int(zEdge[-1]) #0, 1, 2, 3
  *         except ValueError:
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5305
+      /* "discretize/_extensions/tree_ext.pyx":5300
  *         cdef int[3] edges
  *         cdef np.int64_t[:] offsets = np.empty(self._dim, dtype=np.int64)
  *         try:             # <<<<<<<<<<<<<<
  *             edges[0] = int(xEdge[-1]) #0, 1, 2, 3
  *             edges[1] = int(yEdge[-1]) #0, 1, 2, 3
  */
     }
@@ -63763,610 +63775,610 @@
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_t_7, 1);
 
-    /* "discretize/_extensions/tree_ext.pyx":5310
+    /* "discretize/_extensions/tree_ext.pyx":5305
  *             if dim == 3:
  *                 edges[2] = int(zEdge[-1]) #0, 1, 2, 3
  *         except ValueError:             # <<<<<<<<<<<<<<
  *             raise Exception('Last character of edge string must be 0, 1, 2, or 3')
  * 
  */
-    __Pyx_TraceLine(5310,0,__PYX_ERR(0, 5310, __pyx_L6_except_error))
+    __Pyx_TraceLine(5305,0,__PYX_ERR(0, 5305, __pyx_L6_except_error))
     __pyx_t_12 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ValueError);
     if (__pyx_t_12) {
       __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getEdgeP", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_2, &__pyx_t_4) < 0) __PYX_ERR(0, 5310, __pyx_L6_except_error)
+      if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_2, &__pyx_t_4) < 0) __PYX_ERR(0, 5305, __pyx_L6_except_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_GOTREF(__pyx_t_4);
 
-      /* "discretize/_extensions/tree_ext.pyx":5311
+      /* "discretize/_extensions/tree_ext.pyx":5306
  *                 edges[2] = int(zEdge[-1]) #0, 1, 2, 3
  *         except ValueError:
  *             raise Exception('Last character of edge string must be 0, 1, 2, or 3')             # <<<<<<<<<<<<<<
  * 
  *         offsets[0] = 0
  */
-      __Pyx_TraceLine(5311,0,__PYX_ERR(0, 5311, __pyx_L6_except_error))
-      __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__35, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5311, __pyx_L6_except_error)
+      __Pyx_TraceLine(5306,0,__PYX_ERR(0, 5306, __pyx_L6_except_error))
+      __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__35, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5306, __pyx_L6_except_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_Raise(__pyx_t_5, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __PYX_ERR(0, 5311, __pyx_L6_except_error)
+      __PYX_ERR(0, 5306, __pyx_L6_except_error)
     }
     goto __pyx_L6_except_error;
     __pyx_L6_except_error:;
 
-    /* "discretize/_extensions/tree_ext.pyx":5305
+    /* "discretize/_extensions/tree_ext.pyx":5300
  *         cdef int[3] edges
  *         cdef np.int64_t[:] offsets = np.empty(self._dim, dtype=np.int64)
  *         try:             # <<<<<<<<<<<<<<
  *             edges[0] = int(xEdge[-1]) #0, 1, 2, 3
  *             edges[1] = int(yEdge[-1]) #0, 1, 2, 3
  */
     __Pyx_XGIVEREF(__pyx_t_9);
     __Pyx_XGIVEREF(__pyx_t_10);
     __Pyx_XGIVEREF(__pyx_t_11);
     __Pyx_ExceptionReset(__pyx_t_9, __pyx_t_10, __pyx_t_11);
     goto __pyx_L1_error;
     __pyx_L9_try_end:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5313
+  /* "discretize/_extensions/tree_ext.pyx":5308
  *             raise Exception('Last character of edge string must be 0, 1, 2, or 3')
  * 
  *         offsets[0] = 0             # <<<<<<<<<<<<<<
  *         offsets[1] = self.n_total_edges_x
  *         if dim==3:
  */
-  __Pyx_TraceLine(5313,0,__PYX_ERR(0, 5313, __pyx_L1_error))
+  __Pyx_TraceLine(5308,0,__PYX_ERR(0, 5308, __pyx_L1_error))
   __pyx_t_13 = 0;
   __pyx_t_12 = -1;
   if (__pyx_t_13 < 0) {
     __pyx_t_13 += __pyx_v_offsets.shape[0];
     if (unlikely(__pyx_t_13 < 0)) __pyx_t_12 = 0;
   } else if (unlikely(__pyx_t_13 >= __pyx_v_offsets.shape[0])) __pyx_t_12 = 0;
   if (unlikely(__pyx_t_12 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_12);
-    __PYX_ERR(0, 5313, __pyx_L1_error)
+    __PYX_ERR(0, 5308, __pyx_L1_error)
   }
   *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_13 * __pyx_v_offsets.strides[0]) )) = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5314
+  /* "discretize/_extensions/tree_ext.pyx":5309
  * 
  *         offsets[0] = 0
  *         offsets[1] = self.n_total_edges_x             # <<<<<<<<<<<<<<
  *         if dim==3:
  *             offsets[2] = self.n_total_edges_x + self.n_total_edges_y
  */
-  __Pyx_TraceLine(5314,0,__PYX_ERR(0, 5314, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5314, __pyx_L1_error)
+  __Pyx_TraceLine(5309,0,__PYX_ERR(0, 5309, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5309, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_14 = __Pyx_PyInt_As_npy_int64(__pyx_t_4); if (unlikely((__pyx_t_14 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5314, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyInt_As_npy_int64(__pyx_t_4); if (unlikely((__pyx_t_14 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5309, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_13 = 1;
   __pyx_t_12 = -1;
   if (__pyx_t_13 < 0) {
     __pyx_t_13 += __pyx_v_offsets.shape[0];
     if (unlikely(__pyx_t_13 < 0)) __pyx_t_12 = 0;
   } else if (unlikely(__pyx_t_13 >= __pyx_v_offsets.shape[0])) __pyx_t_12 = 0;
   if (unlikely(__pyx_t_12 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_12);
-    __PYX_ERR(0, 5314, __pyx_L1_error)
+    __PYX_ERR(0, 5309, __pyx_L1_error)
   }
   *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_13 * __pyx_v_offsets.strides[0]) )) = __pyx_t_14;
 
-  /* "discretize/_extensions/tree_ext.pyx":5315
+  /* "discretize/_extensions/tree_ext.pyx":5310
  *         offsets[0] = 0
  *         offsets[1] = self.n_total_edges_x
  *         if dim==3:             # <<<<<<<<<<<<<<
  *             offsets[2] = self.n_total_edges_x + self.n_total_edges_y
  * 
  */
-  __Pyx_TraceLine(5315,0,__PYX_ERR(0, 5315, __pyx_L1_error))
+  __Pyx_TraceLine(5310,0,__PYX_ERR(0, 5310, __pyx_L1_error))
   __pyx_t_8 = ((__pyx_v_dim == 3) != 0);
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5316
+    /* "discretize/_extensions/tree_ext.pyx":5311
  *         offsets[1] = self.n_total_edges_x
  *         if dim==3:
  *             offsets[2] = self.n_total_edges_x + self.n_total_edges_y             # <<<<<<<<<<<<<<
  * 
  *         for cell in self.tree.cells:
  */
-    __Pyx_TraceLine(5316,0,__PYX_ERR(0, 5316, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5316, __pyx_L1_error)
+    __Pyx_TraceLine(5311,0,__PYX_ERR(0, 5311, __pyx_L1_error))
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5311, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_y); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5316, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_y); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5311, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_3 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5316, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5311, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_14 = __Pyx_PyInt_As_npy_int64(__pyx_t_3); if (unlikely((__pyx_t_14 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5316, __pyx_L1_error)
+    __pyx_t_14 = __Pyx_PyInt_As_npy_int64(__pyx_t_3); if (unlikely((__pyx_t_14 == ((npy_int64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5311, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_13 = 2;
     __pyx_t_12 = -1;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_offsets.shape[0];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_offsets.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5316, __pyx_L1_error)
+      __PYX_ERR(0, 5311, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_13 * __pyx_v_offsets.strides[0]) )) = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":5315
+    /* "discretize/_extensions/tree_ext.pyx":5310
  *         offsets[0] = 0
  *         offsets[1] = self.n_total_edges_x
  *         if dim==3:             # <<<<<<<<<<<<<<
  *             offsets[2] = self.n_total_edges_x + self.n_total_edges_y
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5318
+  /* "discretize/_extensions/tree_ext.pyx":5313
  *             offsets[2] = self.n_total_edges_x + self.n_total_edges_y
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             ind = cell.index
  *             J1[ind] = cell.edges[0*epc + edges[0]].index + offsets[0]
  */
-  __Pyx_TraceLine(5318,0,__PYX_ERR(0, 5318, __pyx_L1_error))
+  __Pyx_TraceLine(5313,0,__PYX_ERR(0, 5313, __pyx_L1_error))
   __pyx_t_16 = &__pyx_v_self->tree->cells;
   __pyx_t_15 = __pyx_t_16->begin();
   for (;;) {
     if (!(__pyx_t_15 != __pyx_t_16->end())) break;
     __pyx_t_17 = *__pyx_t_15;
     ++__pyx_t_15;
     __pyx_v_cell = __pyx_t_17;
 
-    /* "discretize/_extensions/tree_ext.pyx":5319
+    /* "discretize/_extensions/tree_ext.pyx":5314
  * 
  *         for cell in self.tree.cells:
  *             ind = cell.index             # <<<<<<<<<<<<<<
  *             J1[ind] = cell.edges[0*epc + edges[0]].index + offsets[0]
  *             J2[ind] = cell.edges[1*epc + edges[1]].index + offsets[1]
  */
-    __Pyx_TraceLine(5319,0,__PYX_ERR(0, 5319, __pyx_L1_error))
+    __Pyx_TraceLine(5314,0,__PYX_ERR(0, 5314, __pyx_L1_error))
     __pyx_t_18 = __pyx_v_cell->index;
     __pyx_v_ind = __pyx_t_18;
 
-    /* "discretize/_extensions/tree_ext.pyx":5320
+    /* "discretize/_extensions/tree_ext.pyx":5315
  *         for cell in self.tree.cells:
  *             ind = cell.index
  *             J1[ind] = cell.edges[0*epc + edges[0]].index + offsets[0]             # <<<<<<<<<<<<<<
  *             J2[ind] = cell.edges[1*epc + edges[1]].index + offsets[1]
  *             if dim==3:
  */
-    __Pyx_TraceLine(5320,0,__PYX_ERR(0, 5320, __pyx_L1_error))
+    __Pyx_TraceLine(5315,0,__PYX_ERR(0, 5315, __pyx_L1_error))
     __pyx_t_13 = 0;
     __pyx_t_12 = -1;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_offsets.shape[0];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_offsets.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5320, __pyx_L1_error)
+      __PYX_ERR(0, 5315, __pyx_L1_error)
     }
     __pyx_t_19 = __pyx_v_ind;
     __pyx_t_12 = -1;
     if (__pyx_t_19 < 0) {
       __pyx_t_19 += __pyx_v_J1.shape[0];
       if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_19 >= __pyx_v_J1.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5320, __pyx_L1_error)
+      __PYX_ERR(0, 5315, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J1.data + __pyx_t_19 * __pyx_v_J1.strides[0]) )) = ((__pyx_v_cell->edges[((0 * __pyx_v_epc) + (__pyx_v_edges[0]))])->index + (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_13 * __pyx_v_offsets.strides[0]) ))));
 
-    /* "discretize/_extensions/tree_ext.pyx":5321
+    /* "discretize/_extensions/tree_ext.pyx":5316
  *             ind = cell.index
  *             J1[ind] = cell.edges[0*epc + edges[0]].index + offsets[0]
  *             J2[ind] = cell.edges[1*epc + edges[1]].index + offsets[1]             # <<<<<<<<<<<<<<
  *             if dim==3:
  *                 J3[ind] = cell.edges[2*epc + edges[2]].index + offsets[2]
  */
-    __Pyx_TraceLine(5321,0,__PYX_ERR(0, 5321, __pyx_L1_error))
+    __Pyx_TraceLine(5316,0,__PYX_ERR(0, 5316, __pyx_L1_error))
     __pyx_t_13 = 1;
     __pyx_t_12 = -1;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_offsets.shape[0];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_offsets.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5321, __pyx_L1_error)
+      __PYX_ERR(0, 5316, __pyx_L1_error)
     }
     __pyx_t_19 = __pyx_v_ind;
     __pyx_t_12 = -1;
     if (__pyx_t_19 < 0) {
       __pyx_t_19 += __pyx_v_J2.shape[0];
       if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_19 >= __pyx_v_J2.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5321, __pyx_L1_error)
+      __PYX_ERR(0, 5316, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J2.data + __pyx_t_19 * __pyx_v_J2.strides[0]) )) = ((__pyx_v_cell->edges[((1 * __pyx_v_epc) + (__pyx_v_edges[1]))])->index + (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_13 * __pyx_v_offsets.strides[0]) ))));
 
-    /* "discretize/_extensions/tree_ext.pyx":5322
+    /* "discretize/_extensions/tree_ext.pyx":5317
  *             J1[ind] = cell.edges[0*epc + edges[0]].index + offsets[0]
  *             J2[ind] = cell.edges[1*epc + edges[1]].index + offsets[1]
  *             if dim==3:             # <<<<<<<<<<<<<<
  *                 J3[ind] = cell.edges[2*epc + edges[2]].index + offsets[2]
  * 
  */
-    __Pyx_TraceLine(5322,0,__PYX_ERR(0, 5322, __pyx_L1_error))
+    __Pyx_TraceLine(5317,0,__PYX_ERR(0, 5317, __pyx_L1_error))
     __pyx_t_8 = ((__pyx_v_dim == 3) != 0);
     if (__pyx_t_8) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5323
+      /* "discretize/_extensions/tree_ext.pyx":5318
  *             J2[ind] = cell.edges[1*epc + edges[1]].index + offsets[1]
  *             if dim==3:
  *                 J3[ind] = cell.edges[2*epc + edges[2]].index + offsets[2]             # <<<<<<<<<<<<<<
  * 
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)
  */
-      __Pyx_TraceLine(5323,0,__PYX_ERR(0, 5323, __pyx_L1_error))
+      __Pyx_TraceLine(5318,0,__PYX_ERR(0, 5318, __pyx_L1_error))
       __pyx_t_13 = 2;
       __pyx_t_12 = -1;
       if (__pyx_t_13 < 0) {
         __pyx_t_13 += __pyx_v_offsets.shape[0];
         if (unlikely(__pyx_t_13 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_13 >= __pyx_v_offsets.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5323, __pyx_L1_error)
+        __PYX_ERR(0, 5318, __pyx_L1_error)
       }
-      if (unlikely(!__pyx_v_J3.memview)) { __Pyx_RaiseUnboundLocalError("J3"); __PYX_ERR(0, 5323, __pyx_L1_error) }
+      if (unlikely(!__pyx_v_J3.memview)) { __Pyx_RaiseUnboundLocalError("J3"); __PYX_ERR(0, 5318, __pyx_L1_error) }
       __pyx_t_19 = __pyx_v_ind;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_J3.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_J3.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5323, __pyx_L1_error)
+        __PYX_ERR(0, 5318, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J3.data + __pyx_t_19 * __pyx_v_J3.strides[0]) )) = ((__pyx_v_cell->edges[((2 * __pyx_v_epc) + (__pyx_v_edges[2]))])->index + (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_offsets.data + __pyx_t_13 * __pyx_v_offsets.strides[0]) ))));
 
-      /* "discretize/_extensions/tree_ext.pyx":5322
+      /* "discretize/_extensions/tree_ext.pyx":5317
  *             J1[ind] = cell.edges[0*epc + edges[0]].index + offsets[0]
  *             J2[ind] = cell.edges[1*epc + edges[1]].index + offsets[1]
  *             if dim==3:             # <<<<<<<<<<<<<<
  *                 J3[ind] = cell.edges[2*epc + edges[2]].index + offsets[2]
  * 
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5318
+    /* "discretize/_extensions/tree_ext.pyx":5313
  *             offsets[2] = self.n_total_edges_x + self.n_total_edges_y
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             ind = cell.index
  *             J1[ind] = cell.edges[0*epc + edges[0]].index + offsets[0]
  */
-    __Pyx_TraceLine(5318,0,__PYX_ERR(0, 5318, __pyx_L1_error))
+    __Pyx_TraceLine(5313,0,__PYX_ERR(0, 5313, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5325
+  /* "discretize/_extensions/tree_ext.pyx":5320
  *                 J3[ind] = cell.edges[2*epc + edges[2]].index + offsets[2]
  * 
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         if dim==2:
  *             J = np.r_[J1, J2]
  */
-  __Pyx_TraceLine(5325,0,__PYX_ERR(0, 5325, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __Pyx_TraceLine(5320,0,__PYX_ERR(0, 5320, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5325, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5325, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5320, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_I = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5326
+  /* "discretize/_extensions/tree_ext.pyx":5321
  * 
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)
  *         if dim==2:             # <<<<<<<<<<<<<<
  *             J = np.r_[J1, J2]
  *         else:
  */
-  __Pyx_TraceLine(5326,0,__PYX_ERR(0, 5326, __pyx_L1_error))
+  __Pyx_TraceLine(5321,0,__PYX_ERR(0, 5321, __pyx_L1_error))
   __pyx_t_8 = ((__pyx_v_dim == 2) != 0);
   if (__pyx_t_8) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5327
+    /* "discretize/_extensions/tree_ext.pyx":5322
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)
  *         if dim==2:
  *             J = np.r_[J1, J2]             # <<<<<<<<<<<<<<
  *         else:
  *             J = np.r_[J1, J2, J3]
  */
-    __Pyx_TraceLine(5327,0,__PYX_ERR(0, 5327, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5327, __pyx_L1_error)
+    __Pyx_TraceLine(5322,0,__PYX_ERR(0, 5322, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5322, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_r); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5327, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_r); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5322, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_J1, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5327, __pyx_L1_error)
+    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_J1, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5322, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_J2, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5327, __pyx_L1_error)
+    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_J2, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5322, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5327, __pyx_L1_error)
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5322, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_4);
     __pyx_t_6 = 0;
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5327, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_5, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5322, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5327, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5322, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_v_J = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5326
+    /* "discretize/_extensions/tree_ext.pyx":5321
  * 
  *         I = np.arange(dim*self.n_cells, dtype=np.int64)
  *         if dim==2:             # <<<<<<<<<<<<<<
  *             J = np.r_[J1, J2]
  *         else:
  */
     goto __pyx_L17;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5329
+  /* "discretize/_extensions/tree_ext.pyx":5324
  *             J = np.r_[J1, J2]
  *         else:
  *             J = np.r_[J1, J2, J3]             # <<<<<<<<<<<<<<
  *         V = np.ones(self.n_cells*dim, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(5329,0,__PYX_ERR(0, 5329, __pyx_L1_error))
+  __Pyx_TraceLine(5324,0,__PYX_ERR(0, 5324, __pyx_L1_error))
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5329, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5324, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_r); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5329, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_r); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5324, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_J1, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5329, __pyx_L1_error)
+    __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_J1, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5324, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J2, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5329, __pyx_L1_error)
+    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_J2, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5324, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    if (unlikely(!__pyx_v_J3.memview)) { __Pyx_RaiseUnboundLocalError("J3"); __PYX_ERR(0, 5329, __pyx_L1_error) }
-    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_J3, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5329, __pyx_L1_error)
+    if (unlikely(!__pyx_v_J3.memview)) { __Pyx_RaiseUnboundLocalError("J3"); __PYX_ERR(0, 5324, __pyx_L1_error) }
+    __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_J3, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5324, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5329, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5324, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_6);
     __pyx_t_4 = 0;
     __pyx_t_5 = 0;
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5329, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5324, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5329, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 5324, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_J = __pyx_t_7;
     __pyx_t_7.memview = NULL;
     __pyx_t_7.data = NULL;
   }
   __pyx_L17:;
 
-  /* "discretize/_extensions/tree_ext.pyx":5330
+  /* "discretize/_extensions/tree_ext.pyx":5325
  *         else:
  *             J = np.r_[J1, J2, J3]
  *         V = np.ones(self.n_cells*dim, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *         P = sp.csr_matrix((V, (I, J)), shape=(self._dim*self.n_cells, self.n_total_edges))
  */
-  __Pyx_TraceLine(5330,0,__PYX_ERR(0, 5330, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __Pyx_TraceLine(5325,0,__PYX_ERR(0, 5325, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 5330, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_20 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_20.memview)) __PYX_ERR(0, 5330, __pyx_L1_error)
+  __pyx_t_20 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_20.memview)) __PYX_ERR(0, 5325, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_V = __pyx_t_20;
   __pyx_t_20.memview = NULL;
   __pyx_t_20.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5332
+  /* "discretize/_extensions/tree_ext.pyx":5327
  *         V = np.ones(self.n_cells*dim, dtype=np.float64)
  * 
  *         P = sp.csr_matrix((V, (I, J)), shape=(self._dim*self.n_cells, self.n_total_edges))             # <<<<<<<<<<<<<<
  *         Rf = self._deflate_edges()
  *         return P*Rf
  */
-  __Pyx_TraceLine(5332,0,__PYX_ERR(0, 5332, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __Pyx_TraceLine(5327,0,__PYX_ERR(0, 5327, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_sp); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_3);
   __pyx_t_2 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyInt_From_int_t(__pyx_v_self->_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int_t(__pyx_v_self->_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_21 = PyNumber_Multiply(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_21 = PyNumber_Multiply(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_21);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_21);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_21);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2);
   __pyx_t_21 = 0;
   __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_4) < 0) __PYX_ERR(0, 5332, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shape, __pyx_t_4) < 0) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5332, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5327, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_P = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5333
+  /* "discretize/_extensions/tree_ext.pyx":5328
  * 
  *         P = sp.csr_matrix((V, (I, J)), shape=(self._dim*self.n_cells, self.n_total_edges))
  *         Rf = self._deflate_edges()             # <<<<<<<<<<<<<<
  *         return P*Rf
  * 
  */
-  __Pyx_TraceLine(5333,0,__PYX_ERR(0, 5333, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_edges); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5333, __pyx_L1_error)
+  __Pyx_TraceLine(5328,0,__PYX_ERR(0, 5328, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_edges); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5328, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_4 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5333, __pyx_L1_error)
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5328, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_Rf = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5334
+  /* "discretize/_extensions/tree_ext.pyx":5329
  *         P = sp.csr_matrix((V, (I, J)), shape=(self._dim*self.n_cells, self.n_total_edges))
  *         Rf = self._deflate_edges()
  *         return P*Rf             # <<<<<<<<<<<<<<
  * 
  *     def _getEdgePxx(self):
  */
-  __Pyx_TraceLine(5334,0,__PYX_ERR(0, 5334, __pyx_L1_error))
+  __Pyx_TraceLine(5329,0,__PYX_ERR(0, 5329, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = PyNumber_Multiply(__pyx_v_P, __pyx_v_Rf); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5334, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Multiply(__pyx_v_P, __pyx_v_Rf); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5329, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5290
+  /* "discretize/_extensions/tree_ext.pyx":5285
  *         return Pxxx
  * 
  *     def _getEdgeP(self, xEdge, yEdge, zEdge):             # <<<<<<<<<<<<<<
  *         cdef int dim = self._dim
  *         cdef int_t ind, id
  */
 
@@ -64394,15 +64406,15 @@
   __Pyx_XDECREF(__pyx_v_Rf);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5336
+/* "discretize/_extensions/tree_ext.pyx":5331
  *         return P*Rf
  * 
  *     def _getEdgePxx(self):             # <<<<<<<<<<<<<<
  *         def Pxx(xEdge, yEdge):
  *             return self._getEdgeP(xEdge, yEdge, None)
  */
 
@@ -64416,15 +64428,15 @@
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_76_getEdgePxx(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5337
+/* "discretize/_extensions/tree_ext.pyx":5332
  * 
  *     def _getEdgePxx(self):
  *         def Pxx(xEdge, yEdge):             # <<<<<<<<<<<<<<
  *             return self._getEdgeP(xEdge, yEdge, None)
  *         return Pxx
  */
 
@@ -64459,32 +64471,32 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_xEdge)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yEdge)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("Pxx", 1, 2, 2, 1); __PYX_ERR(0, 5337, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("Pxx", 1, 2, 2, 1); __PYX_ERR(0, 5332, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "Pxx") < 0)) __PYX_ERR(0, 5337, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "Pxx") < 0)) __PYX_ERR(0, 5332, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_xEdge = values[0];
     __pyx_v_yEdge = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("Pxx", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5337, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("Pxx", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5332, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getEdgePxx.Pxx", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_11_getEdgePxx_Pxx(__pyx_self, __pyx_v_xEdge, __pyx_v_yEdge);
 
@@ -64506,27 +64518,27 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("Pxx", 0);
   __pyx_outer_scope = (struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
-  __Pyx_TraceCall("Pxx", __pyx_f[0], 5337, 0, __PYX_ERR(0, 5337, __pyx_L1_error));
+  __Pyx_TraceCall("Pxx", __pyx_f[0], 5332, 0, __PYX_ERR(0, 5332, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5338
+  /* "discretize/_extensions/tree_ext.pyx":5333
  *     def _getEdgePxx(self):
  *         def Pxx(xEdge, yEdge):
  *             return self._getEdgeP(xEdge, yEdge, None)             # <<<<<<<<<<<<<<
  *         return Pxx
  * 
  */
-  __Pyx_TraceLine(5338,0,__PYX_ERR(0, 5338, __pyx_L1_error))
+  __Pyx_TraceLine(5333,0,__PYX_ERR(0, 5333, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 5338, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_getEdgeP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5338, __pyx_L1_error)
+  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 5333, __pyx_L1_error) }
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_getEdgeP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5333, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -64535,52 +64547,52 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_xEdge, __pyx_v_yEdge, Py_None};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5338, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5333, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_xEdge, __pyx_v_yEdge, Py_None};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5338, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5333, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5338, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5333, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_xEdge);
     __Pyx_GIVEREF(__pyx_v_xEdge);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_xEdge);
     __Pyx_INCREF(__pyx_v_yEdge);
     __Pyx_GIVEREF(__pyx_v_yEdge);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_yEdge);
     __Pyx_INCREF(Py_None);
     __Pyx_GIVEREF(Py_None);
     PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, Py_None);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5338, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5333, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5337
+  /* "discretize/_extensions/tree_ext.pyx":5332
  * 
  *     def _getEdgePxx(self):
  *         def Pxx(xEdge, yEdge):             # <<<<<<<<<<<<<<
  *             return self._getEdgeP(xEdge, yEdge, None)
  *         return Pxx
  */
 
@@ -64595,15 +64607,15 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5336
+/* "discretize/_extensions/tree_ext.pyx":5331
  *         return P*Rf
  * 
  *     def _getEdgePxx(self):             # <<<<<<<<<<<<<<
  *         def Pxx(xEdge, yEdge):
  *             return self._getEdgeP(xEdge, yEdge, None)
  */
 
@@ -64618,50 +64630,50 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getEdgePxx", 0);
   __pyx_cur_scope = (struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx *)__pyx_tp_new_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx(__pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 5336, __pyx_L1_error)
+    __PYX_ERR(0, 5331, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
-  __Pyx_TraceCall("_getEdgePxx", __pyx_f[0], 5336, 0, __PYX_ERR(0, 5336, __pyx_L1_error));
+  __Pyx_TraceCall("_getEdgePxx", __pyx_f[0], 5331, 0, __PYX_ERR(0, 5331, __pyx_L1_error));
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
 
-  /* "discretize/_extensions/tree_ext.pyx":5337
+  /* "discretize/_extensions/tree_ext.pyx":5332
  * 
  *     def _getEdgePxx(self):
  *         def Pxx(xEdge, yEdge):             # <<<<<<<<<<<<<<
  *             return self._getEdgeP(xEdge, yEdge, None)
  *         return Pxx
  */
-  __Pyx_TraceLine(5337,0,__PYX_ERR(0, 5337, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_10discretize_11_extensions_8tree_ext_9_TreeMesh_11_getEdgePxx_1Pxx, 0, __pyx_n_s_getEdgePxx_locals_Pxx, ((PyObject*)__pyx_cur_scope), __pyx_n_s_discretize__extensions_tree_ext_2, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5337, __pyx_L1_error)
+  __Pyx_TraceLine(5332,0,__PYX_ERR(0, 5332, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_10discretize_11_extensions_8tree_ext_9_TreeMesh_11_getEdgePxx_1Pxx, 0, __pyx_n_s_getEdgePxx_locals_Pxx, ((PyObject*)__pyx_cur_scope), __pyx_n_s_discretize__extensions_tree_ext_2, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5332, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_Pxx = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5339
+  /* "discretize/_extensions/tree_ext.pyx":5334
  *         def Pxx(xEdge, yEdge):
  *             return self._getEdgeP(xEdge, yEdge, None)
  *         return Pxx             # <<<<<<<<<<<<<<
  * 
  *     def _getEdgePxxx(self):
  */
-  __Pyx_TraceLine(5339,0,__PYX_ERR(0, 5339, __pyx_L1_error))
+  __Pyx_TraceLine(5334,0,__PYX_ERR(0, 5334, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_Pxx);
   __pyx_r = __pyx_v_Pxx;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5336
+  /* "discretize/_extensions/tree_ext.pyx":5331
  *         return P*Rf
  * 
  *     def _getEdgePxx(self):             # <<<<<<<<<<<<<<
  *         def Pxx(xEdge, yEdge):
  *             return self._getEdgeP(xEdge, yEdge, None)
  */
 
@@ -64675,15 +64687,15 @@
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5341
+/* "discretize/_extensions/tree_ext.pyx":5336
  *         return Pxx
  * 
  *     def _getEdgePxxx(self):             # <<<<<<<<<<<<<<
  *         def Pxxx(xEdge, yEdge, zEdge):
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  */
 
@@ -64697,15 +64709,15 @@
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_78_getEdgePxxx(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self));
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5342
+/* "discretize/_extensions/tree_ext.pyx":5337
  * 
  *     def _getEdgePxxx(self):
  *         def Pxxx(xEdge, yEdge, zEdge):             # <<<<<<<<<<<<<<
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  *         return Pxxx
  */
 
@@ -64743,40 +64755,40 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_xEdge)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_yEdge)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, 1); __PYX_ERR(0, 5342, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, 1); __PYX_ERR(0, 5337, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zEdge)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, 2); __PYX_ERR(0, 5342, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, 2); __PYX_ERR(0, 5337, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "Pxxx") < 0)) __PYX_ERR(0, 5342, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "Pxxx") < 0)) __PYX_ERR(0, 5337, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_xEdge = values[0];
     __pyx_v_yEdge = values[1];
     __pyx_v_zEdge = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5342, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("Pxxx", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5337, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getEdgePxxx.Pxxx", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_12_getEdgePxxx_Pxxx(__pyx_self, __pyx_v_xEdge, __pyx_v_yEdge, __pyx_v_zEdge);
 
@@ -64798,27 +64810,27 @@
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("Pxxx", 0);
   __pyx_outer_scope = (struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __pyx_cur_scope = __pyx_outer_scope;
-  __Pyx_TraceCall("Pxxx", __pyx_f[0], 5342, 0, __PYX_ERR(0, 5342, __pyx_L1_error));
+  __Pyx_TraceCall("Pxxx", __pyx_f[0], 5337, 0, __PYX_ERR(0, 5337, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5343
+  /* "discretize/_extensions/tree_ext.pyx":5338
  *     def _getEdgePxxx(self):
  *         def Pxxx(xEdge, yEdge, zEdge):
  *             return self._getEdgeP(xEdge, yEdge, zEdge)             # <<<<<<<<<<<<<<
  *         return Pxxx
  * 
  */
-  __Pyx_TraceLine(5343,0,__PYX_ERR(0, 5343, __pyx_L1_error))
+  __Pyx_TraceLine(5338,0,__PYX_ERR(0, 5338, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 5343, __pyx_L1_error) }
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_getEdgeP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5343, __pyx_L1_error)
+  if (unlikely(!__pyx_cur_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 5338, __pyx_L1_error) }
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_getEdgeP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5338, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   __pyx_t_4 = 0;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -64827,52 +64839,52 @@
       __Pyx_DECREF_SET(__pyx_t_2, function);
       __pyx_t_4 = 1;
     }
   }
   #if CYTHON_FAST_PYCALL
   if (PyFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_xEdge, __pyx_v_yEdge, __pyx_v_zEdge};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5343, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5338, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   #if CYTHON_FAST_PYCCALL
   if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
     PyObject *__pyx_temp[4] = {__pyx_t_3, __pyx_v_xEdge, __pyx_v_yEdge, __pyx_v_zEdge};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5343, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 3+__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5338, __pyx_L1_error)
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GOTREF(__pyx_t_1);
   } else
   #endif
   {
-    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5343, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(3+__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     if (__pyx_t_3) {
       __Pyx_GIVEREF(__pyx_t_3); PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
     }
     __Pyx_INCREF(__pyx_v_xEdge);
     __Pyx_GIVEREF(__pyx_v_xEdge);
     PyTuple_SET_ITEM(__pyx_t_5, 0+__pyx_t_4, __pyx_v_xEdge);
     __Pyx_INCREF(__pyx_v_yEdge);
     __Pyx_GIVEREF(__pyx_v_yEdge);
     PyTuple_SET_ITEM(__pyx_t_5, 1+__pyx_t_4, __pyx_v_yEdge);
     __Pyx_INCREF(__pyx_v_zEdge);
     __Pyx_GIVEREF(__pyx_v_zEdge);
     PyTuple_SET_ITEM(__pyx_t_5, 2+__pyx_t_4, __pyx_v_zEdge);
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5343, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5342
+  /* "discretize/_extensions/tree_ext.pyx":5337
  * 
  *     def _getEdgePxxx(self):
  *         def Pxxx(xEdge, yEdge, zEdge):             # <<<<<<<<<<<<<<
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  *         return Pxxx
  */
 
@@ -64887,15 +64899,15 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5341
+/* "discretize/_extensions/tree_ext.pyx":5336
  *         return Pxx
  * 
  *     def _getEdgePxxx(self):             # <<<<<<<<<<<<<<
  *         def Pxxx(xEdge, yEdge, zEdge):
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  */
 
@@ -64910,50 +64922,50 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getEdgePxxx", 0);
   __pyx_cur_scope = (struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx *)__pyx_tp_new_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx(__pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 5341, __pyx_L1_error)
+    __PYX_ERR(0, 5336, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
-  __Pyx_TraceCall("_getEdgePxxx", __pyx_f[0], 5341, 0, __PYX_ERR(0, 5341, __pyx_L1_error));
+  __Pyx_TraceCall("_getEdgePxxx", __pyx_f[0], 5336, 0, __PYX_ERR(0, 5336, __pyx_L1_error));
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
 
-  /* "discretize/_extensions/tree_ext.pyx":5342
+  /* "discretize/_extensions/tree_ext.pyx":5337
  * 
  *     def _getEdgePxxx(self):
  *         def Pxxx(xEdge, yEdge, zEdge):             # <<<<<<<<<<<<<<
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  *         return Pxxx
  */
-  __Pyx_TraceLine(5342,0,__PYX_ERR(0, 5342, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_10discretize_11_extensions_8tree_ext_9_TreeMesh_12_getEdgePxxx_1Pxxx, 0, __pyx_n_s_getEdgePxxx_locals_Pxxx, ((PyObject*)__pyx_cur_scope), __pyx_n_s_discretize__extensions_tree_ext_2, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5342, __pyx_L1_error)
+  __Pyx_TraceLine(5337,0,__PYX_ERR(0, 5337, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_10discretize_11_extensions_8tree_ext_9_TreeMesh_12_getEdgePxxx_1Pxxx, 0, __pyx_n_s_getEdgePxxx_locals_Pxxx, ((PyObject*)__pyx_cur_scope), __pyx_n_s_discretize__extensions_tree_ext_2, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5337, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_Pxxx = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5344
+  /* "discretize/_extensions/tree_ext.pyx":5339
  *         def Pxxx(xEdge, yEdge, zEdge):
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  *         return Pxxx             # <<<<<<<<<<<<<<
  * 
- *     def _getEdgeIntMat(self, locs, zerosOutside, direction):
+ *     def _getEdgeIntMat(self, locs, zeros_outside, direction):
  */
-  __Pyx_TraceLine(5344,0,__PYX_ERR(0, 5344, __pyx_L1_error))
+  __Pyx_TraceLine(5339,0,__PYX_ERR(0, 5339, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_Pxxx);
   __pyx_r = __pyx_v_Pxxx;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5341
+  /* "discretize/_extensions/tree_ext.pyx":5336
  *         return Pxx
  * 
  *     def _getEdgePxxx(self):             # <<<<<<<<<<<<<<
  *         def Pxxx(xEdge, yEdge, zEdge):
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  */
 
@@ -64967,37 +64979,37 @@
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5346
+/* "discretize/_extensions/tree_ext.pyx":5341
  *         return Pxxx
  * 
- *     def _getEdgeIntMat(self, locs, zerosOutside, direction):             # <<<<<<<<<<<<<<
+ *     def _getEdgeIntMat(self, locs, zeros_outside, direction):             # <<<<<<<<<<<<<<
  *         cdef:
  *             double[:, :] locations = locs
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_81_getEdgeIntMat(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_80_getEdgeIntMat[] = "_TreeMesh._getEdgeIntMat(self, locs, zerosOutside, direction)";
+static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_80_getEdgeIntMat[] = "_TreeMesh._getEdgeIntMat(self, locs, zeros_outside, direction)";
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_81_getEdgeIntMat(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_locs = 0;
-  PyObject *__pyx_v_zerosOutside = 0;
+  PyObject *__pyx_v_zeros_outside = 0;
   PyObject *__pyx_v_direction = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_getEdgeIntMat (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_locs,&__pyx_n_s_zerosOutside,&__pyx_n_s_direction,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_locs,&__pyx_n_s_zeros_outside,&__pyx_n_s_direction,0};
     PyObject* values[3] = {0,0,0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -65011,55 +65023,55 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_locs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zerosOutside)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zeros_outside)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getEdgeIntMat", 1, 3, 3, 1); __PYX_ERR(0, 5346, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getEdgeIntMat", 1, 3, 3, 1); __PYX_ERR(0, 5341, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_direction)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getEdgeIntMat", 1, 3, 3, 2); __PYX_ERR(0, 5346, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getEdgeIntMat", 1, 3, 3, 2); __PYX_ERR(0, 5341, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getEdgeIntMat") < 0)) __PYX_ERR(0, 5346, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getEdgeIntMat") < 0)) __PYX_ERR(0, 5341, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_locs = values[0];
-    __pyx_v_zerosOutside = values[1];
+    __pyx_v_zeros_outside = values[1];
     __pyx_v_direction = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_getEdgeIntMat", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5346, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_getEdgeIntMat", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5341, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getEdgeIntMat", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_80_getEdgeIntMat(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_locs, __pyx_v_zerosOutside, __pyx_v_direction);
+  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_80_getEdgeIntMat(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_locs, __pyx_v_zeros_outside, __pyx_v_direction);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_80_getEdgeIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zerosOutside, PyObject *__pyx_v_direction) {
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_80_getEdgeIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zeros_outside, PyObject *__pyx_v_direction) {
   __Pyx_memviewslice __pyx_v_locations = { 0, 0, { 0 }, { 0 }, { 0 } };
   int_t __pyx_v_dir;
   int_t __pyx_v_dir1;
   int_t __pyx_v_dir2;
   int_t __pyx_v_dim;
   int_t __pyx_v_n_loc;
   int_t __pyx_v_n_edges;
@@ -65113,546 +65125,546 @@
   Py_ssize_t __pyx_t_17;
   int __pyx_t_18;
   double __pyx_t_19;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getEdgeIntMat", 0);
-  __Pyx_TraceCall("_getEdgeIntMat", __pyx_f[0], 5346, 0, __PYX_ERR(0, 5346, __pyx_L1_error));
+  __Pyx_TraceCall("_getEdgeIntMat", __pyx_f[0], 5341, 0, __PYX_ERR(0, 5341, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5348
- *     def _getEdgeIntMat(self, locs, zerosOutside, direction):
+  /* "discretize/_extensions/tree_ext.pyx":5343
+ *     def _getEdgeIntMat(self, locs, zeros_outside, direction):
  *         cdef:
  *             double[:, :] locations = locs             # <<<<<<<<<<<<<<
  *             int_t dir, dir1, dir2
  *             int_t dim = self._dim
  */
-  __Pyx_TraceLine(5348,0,__PYX_ERR(0, 5348, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 5348, __pyx_L1_error)
+  __Pyx_TraceLine(5343,0,__PYX_ERR(0, 5343, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 5343, __pyx_L1_error)
   __pyx_v_locations = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5350
+  /* "discretize/_extensions/tree_ext.pyx":5345
  *             double[:, :] locations = locs
  *             int_t dir, dir1, dir2
  *             int_t dim = self._dim             # <<<<<<<<<<<<<<
  *             int_t n_loc = locs.shape[0]
  *             int_t n_edges = 2 if self._dim == 2 else 4
  */
-  __Pyx_TraceLine(5350,0,__PYX_ERR(0, 5350, __pyx_L1_error))
+  __Pyx_TraceLine(5345,0,__PYX_ERR(0, 5345, __pyx_L1_error))
   __pyx_t_2 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5351
+  /* "discretize/_extensions/tree_ext.pyx":5346
  *             int_t dir, dir1, dir2
  *             int_t dim = self._dim
  *             int_t n_loc = locs.shape[0]             # <<<<<<<<<<<<<<
  *             int_t n_edges = 2 if self._dim == 2 else 4
  *             np.int64_t[:] indptr = 2 * n_edges * np.arange(n_loc+1, dtype=np.int64)
  */
-  __Pyx_TraceLine(5351,0,__PYX_ERR(0, 5351, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5351, __pyx_L1_error)
+  __Pyx_TraceLine(5346,0,__PYX_ERR(0, 5346, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5346, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5351, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5346, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_4); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5351, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_4); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5346, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_n_loc = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5352
+  /* "discretize/_extensions/tree_ext.pyx":5347
  *             int_t dim = self._dim
  *             int_t n_loc = locs.shape[0]
  *             int_t n_edges = 2 if self._dim == 2 else 4             # <<<<<<<<<<<<<<
  *             np.int64_t[:] indptr = 2 * n_edges * np.arange(n_loc+1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_loc * 2 * n_edges, dtype=np.int64)
  */
-  __Pyx_TraceLine(5352,0,__PYX_ERR(0, 5352, __pyx_L1_error))
+  __Pyx_TraceLine(5347,0,__PYX_ERR(0, 5347, __pyx_L1_error))
   if (((__pyx_v_self->_dim == 2) != 0)) {
     __pyx_t_2 = 2;
   } else {
     __pyx_t_2 = 4;
   }
   __pyx_v_n_edges = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5353
+  /* "discretize/_extensions/tree_ext.pyx":5348
  *             int_t n_loc = locs.shape[0]
  *             int_t n_edges = 2 if self._dim == 2 else 4
  *             np.int64_t[:] indptr = 2 * n_edges * np.arange(n_loc+1, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.int64_t[:] indices = np.empty(n_loc * 2 * n_edges, dtype=np.int64)
  *             np.float64_t[:] data = np.empty(n_loc * 2 * n_edges, dtype=np.float64)
  */
-  __Pyx_TraceLine(5353,0,__PYX_ERR(0, 5353, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyInt_From_long((2 * __pyx_v_n_edges)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __Pyx_TraceLine(5348,0,__PYX_ERR(0, 5348, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyInt_From_long((2 * __pyx_v_n_edges)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_long((__pyx_v_n_loc + 1)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_long((__pyx_v_n_loc + 1)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 5353, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5353, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5348, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_indptr = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5354
+  /* "discretize/_extensions/tree_ext.pyx":5349
  *             int_t n_edges = 2 if self._dim == 2 else 4
  *             np.int64_t[:] indptr = 2 * n_edges * np.arange(n_loc+1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_loc * 2 * n_edges, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.float64_t[:] data = np.empty(n_loc * 2 * n_edges, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(5354,0,__PYX_ERR(0, 5354, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __Pyx_TraceLine(5349,0,__PYX_ERR(0, 5349, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_long(((__pyx_v_n_loc * 2) * __pyx_v_n_edges)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_long(((__pyx_v_n_loc * 2) * __pyx_v_n_edges)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5354, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5354, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5349, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_indices = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5355
+  /* "discretize/_extensions/tree_ext.pyx":5350
  *             np.int64_t[:] indptr = 2 * n_edges * np.arange(n_loc+1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_loc * 2 * n_edges, dtype=np.int64)
  *             np.float64_t[:] data = np.empty(n_loc * 2 * n_edges, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *             np.int64_t[:] row_inds
  */
-  __Pyx_TraceLine(5355,0,__PYX_ERR(0, 5355, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __Pyx_TraceLine(5350,0,__PYX_ERR(0, 5350, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyInt_From_long(((__pyx_v_n_loc * 2) * __pyx_v_n_edges)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_From_long(((__pyx_v_n_loc * 2) * __pyx_v_n_edges)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5355, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 5355, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 5350, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_data = __pyx_t_10;
   __pyx_t_10.memview = NULL;
   __pyx_t_10.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5366
+  /* "discretize/_extensions/tree_ext.pyx":5361
  *             double x, y, z
  *             double w1, w2, w3
  *             double eps = 100*np.finfo(float).eps             # <<<<<<<<<<<<<<
- *             int zeros_out = zerosOutside
+ *             int zeros_out = zeros_outside
  * 
  */
-  __Pyx_TraceLine(5366,0,__PYX_ERR(0, 5366, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5366, __pyx_L1_error)
+  __Pyx_TraceLine(5361,0,__PYX_ERR(0, 5361, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_finfo); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5366, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_finfo); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, ((PyObject *)(&PyFloat_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)(&PyFloat_Type)));
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5366, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_eps); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5366, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_eps); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Multiply(__pyx_int_100, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5366, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Multiply(__pyx_int_100, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5361, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5366, __pyx_L1_error)
+  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5361, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_eps = __pyx_t_11;
 
-  /* "discretize/_extensions/tree_ext.pyx":5367
+  /* "discretize/_extensions/tree_ext.pyx":5362
  *             double w1, w2, w3
  *             double eps = 100*np.finfo(float).eps
- *             int zeros_out = zerosOutside             # <<<<<<<<<<<<<<
+ *             int zeros_out = zeros_outside             # <<<<<<<<<<<<<<
  * 
  *         if direction == 'x':
  */
-  __Pyx_TraceLine(5367,0,__PYX_ERR(0, 5367, __pyx_L1_error))
-  __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_zerosOutside); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5367, __pyx_L1_error)
+  __Pyx_TraceLine(5362,0,__PYX_ERR(0, 5362, __pyx_L1_error))
+  __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_zeros_outside); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5362, __pyx_L1_error)
   __pyx_v_zeros_out = __pyx_t_12;
 
-  /* "discretize/_extensions/tree_ext.pyx":5369
- *             int zeros_out = zerosOutside
+  /* "discretize/_extensions/tree_ext.pyx":5364
+ *             int zeros_out = zeros_outside
  * 
  *         if direction == 'x':             # <<<<<<<<<<<<<<
  *             dir, dir1, dir2 = 0, 1, 2
  *             offset = 0
  */
-  __Pyx_TraceLine(5369,0,__PYX_ERR(0, 5369, __pyx_L1_error))
-  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_x, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5369, __pyx_L1_error)
+  __Pyx_TraceLine(5364,0,__PYX_ERR(0, 5364, __pyx_L1_error))
+  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_x, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5364, __pyx_L1_error)
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5370
+    /* "discretize/_extensions/tree_ext.pyx":5365
  * 
  *         if direction == 'x':
  *             dir, dir1, dir2 = 0, 1, 2             # <<<<<<<<<<<<<<
  *             offset = 0
  *         elif direction == 'y':
  */
-    __Pyx_TraceLine(5370,0,__PYX_ERR(0, 5370, __pyx_L1_error))
+    __Pyx_TraceLine(5365,0,__PYX_ERR(0, 5365, __pyx_L1_error))
     __pyx_t_2 = 0;
     __pyx_t_14 = 1;
     __pyx_t_15 = 2;
     __pyx_v_dir = __pyx_t_2;
     __pyx_v_dir1 = __pyx_t_14;
     __pyx_v_dir2 = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":5371
+    /* "discretize/_extensions/tree_ext.pyx":5366
  *         if direction == 'x':
  *             dir, dir1, dir2 = 0, 1, 2
  *             offset = 0             # <<<<<<<<<<<<<<
  *         elif direction == 'y':
  *             dir, dir1, dir2 = 1, 0, 2
  */
-    __Pyx_TraceLine(5371,0,__PYX_ERR(0, 5371, __pyx_L1_error))
+    __Pyx_TraceLine(5366,0,__PYX_ERR(0, 5366, __pyx_L1_error))
     __pyx_v_offset = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5369
- *             int zeros_out = zerosOutside
+    /* "discretize/_extensions/tree_ext.pyx":5364
+ *             int zeros_out = zeros_outside
  * 
  *         if direction == 'x':             # <<<<<<<<<<<<<<
  *             dir, dir1, dir2 = 0, 1, 2
  *             offset = 0
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5372
+  /* "discretize/_extensions/tree_ext.pyx":5367
  *             dir, dir1, dir2 = 0, 1, 2
  *             offset = 0
  *         elif direction == 'y':             # <<<<<<<<<<<<<<
  *             dir, dir1, dir2 = 1, 0, 2
  *             offset = self.n_total_edges_x
  */
-  __Pyx_TraceLine(5372,0,__PYX_ERR(0, 5372, __pyx_L1_error))
-  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_y, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5372, __pyx_L1_error)
+  __Pyx_TraceLine(5367,0,__PYX_ERR(0, 5367, __pyx_L1_error))
+  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_y, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5367, __pyx_L1_error)
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5373
+    /* "discretize/_extensions/tree_ext.pyx":5368
  *             offset = 0
  *         elif direction == 'y':
  *             dir, dir1, dir2 = 1, 0, 2             # <<<<<<<<<<<<<<
  *             offset = self.n_total_edges_x
  *         elif direction == 'z':
  */
-    __Pyx_TraceLine(5373,0,__PYX_ERR(0, 5373, __pyx_L1_error))
+    __Pyx_TraceLine(5368,0,__PYX_ERR(0, 5368, __pyx_L1_error))
     __pyx_t_15 = 1;
     __pyx_t_14 = 0;
     __pyx_t_2 = 2;
     __pyx_v_dir = __pyx_t_15;
     __pyx_v_dir1 = __pyx_t_14;
     __pyx_v_dir2 = __pyx_t_2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5374
+    /* "discretize/_extensions/tree_ext.pyx":5369
  *         elif direction == 'y':
  *             dir, dir1, dir2 = 1, 0, 2
  *             offset = self.n_total_edges_x             # <<<<<<<<<<<<<<
  *         elif direction == 'z':
  *             dir, dir1, dir2 = 2, 0, 1
  */
-    __Pyx_TraceLine(5374,0,__PYX_ERR(0, 5374, __pyx_L1_error))
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5374, __pyx_L1_error)
+    __Pyx_TraceLine(5369,0,__PYX_ERR(0, 5369, __pyx_L1_error))
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5369, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_6); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5374, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_6); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5369, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_offset = __pyx_t_2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5372
+    /* "discretize/_extensions/tree_ext.pyx":5367
  *             dir, dir1, dir2 = 0, 1, 2
  *             offset = 0
  *         elif direction == 'y':             # <<<<<<<<<<<<<<
  *             dir, dir1, dir2 = 1, 0, 2
  *             offset = self.n_total_edges_x
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5375
+  /* "discretize/_extensions/tree_ext.pyx":5370
  *             dir, dir1, dir2 = 1, 0, 2
  *             offset = self.n_total_edges_x
  *         elif direction == 'z':             # <<<<<<<<<<<<<<
  *             dir, dir1, dir2 = 2, 0, 1
  *             offset = self.n_total_edges_x + self.n_total_edges_y
  */
-  __Pyx_TraceLine(5375,0,__PYX_ERR(0, 5375, __pyx_L1_error))
-  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_z, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5375, __pyx_L1_error)
+  __Pyx_TraceLine(5370,0,__PYX_ERR(0, 5370, __pyx_L1_error))
+  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_z, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5370, __pyx_L1_error)
   if (likely(__pyx_t_13)) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5376
+    /* "discretize/_extensions/tree_ext.pyx":5371
  *             offset = self.n_total_edges_x
  *         elif direction == 'z':
  *             dir, dir1, dir2 = 2, 0, 1             # <<<<<<<<<<<<<<
  *             offset = self.n_total_edges_x + self.n_total_edges_y
  *         else:
  */
-    __Pyx_TraceLine(5376,0,__PYX_ERR(0, 5376, __pyx_L1_error))
+    __Pyx_TraceLine(5371,0,__PYX_ERR(0, 5371, __pyx_L1_error))
     __pyx_t_2 = 2;
     __pyx_t_14 = 0;
     __pyx_t_15 = 1;
     __pyx_v_dir = __pyx_t_2;
     __pyx_v_dir1 = __pyx_t_14;
     __pyx_v_dir2 = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":5377
+    /* "discretize/_extensions/tree_ext.pyx":5372
  *         elif direction == 'z':
  *             dir, dir1, dir2 = 2, 0, 1
  *             offset = self.n_total_edges_x + self.n_total_edges_y             # <<<<<<<<<<<<<<
  *         else:
  *             raise ValueError('Invalid direction, must be x, y, or z')
  */
-    __Pyx_TraceLine(5377,0,__PYX_ERR(0, 5377, __pyx_L1_error))
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5377, __pyx_L1_error)
+    __Pyx_TraceLine(5372,0,__PYX_ERR(0, 5372, __pyx_L1_error))
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5372, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5377, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5372, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyNumber_Add(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5377, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5372, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_15 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_15 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5377, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_15 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5372, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_v_offset = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":5375
+    /* "discretize/_extensions/tree_ext.pyx":5370
  *             dir, dir1, dir2 = 1, 0, 2
  *             offset = self.n_total_edges_x
  *         elif direction == 'z':             # <<<<<<<<<<<<<<
  *             dir, dir1, dir2 = 2, 0, 1
  *             offset = self.n_total_edges_x + self.n_total_edges_y
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5379
+  /* "discretize/_extensions/tree_ext.pyx":5374
  *             offset = self.n_total_edges_x + self.n_total_edges_y
  *         else:
  *             raise ValueError('Invalid direction, must be x, y, or z')             # <<<<<<<<<<<<<<
  * 
  *         for i in range(n_loc):
  */
-  __Pyx_TraceLine(5379,0,__PYX_ERR(0, 5379, __pyx_L1_error))
+  __Pyx_TraceLine(5374,0,__PYX_ERR(0, 5374, __pyx_L1_error))
   /*else*/ {
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5379, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5374, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_Raise(__pyx_t_5, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 5379, __pyx_L1_error)
+    __PYX_ERR(0, 5374, __pyx_L1_error)
   }
   __pyx_L3:;
 
-  /* "discretize/_extensions/tree_ext.pyx":5381
+  /* "discretize/_extensions/tree_ext.pyx":5376
  *             raise ValueError('Invalid direction, must be x, y, or z')
  * 
  *         for i in range(n_loc):             # <<<<<<<<<<<<<<
  *             x = locations[i, 0]
  *             y = locations[i, 1]
  */
-  __Pyx_TraceLine(5381,0,__PYX_ERR(0, 5381, __pyx_L1_error))
+  __Pyx_TraceLine(5376,0,__PYX_ERR(0, 5376, __pyx_L1_error))
   __pyx_t_15 = __pyx_v_n_loc;
   __pyx_t_14 = __pyx_t_15;
   for (__pyx_t_2 = 0; __pyx_t_2 < __pyx_t_14; __pyx_t_2+=1) {
     __pyx_v_i = __pyx_t_2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5382
+    /* "discretize/_extensions/tree_ext.pyx":5377
  * 
  *         for i in range(n_loc):
  *             x = locations[i, 0]             # <<<<<<<<<<<<<<
  *             y = locations[i, 1]
  *             z = locations[i, 2] if dim==3 else 0.0
  */
-    __Pyx_TraceLine(5382,0,__PYX_ERR(0, 5382, __pyx_L1_error))
+    __Pyx_TraceLine(5377,0,__PYX_ERR(0, 5377, __pyx_L1_error))
     __pyx_t_16 = __pyx_v_i;
     __pyx_t_17 = 0;
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_locations.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_locations.shape[1];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 1;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5382, __pyx_L1_error)
+      __PYX_ERR(0, 5377, __pyx_L1_error)
     }
     __pyx_v_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_17 * __pyx_v_locations.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5383
+    /* "discretize/_extensions/tree_ext.pyx":5378
  *         for i in range(n_loc):
  *             x = locations[i, 0]
  *             y = locations[i, 1]             # <<<<<<<<<<<<<<
  *             z = locations[i, 2] if dim==3 else 0.0
  *             # get containing (or closest) cell
  */
-    __Pyx_TraceLine(5383,0,__PYX_ERR(0, 5383, __pyx_L1_error))
+    __Pyx_TraceLine(5378,0,__PYX_ERR(0, 5378, __pyx_L1_error))
     __pyx_t_17 = __pyx_v_i;
     __pyx_t_16 = 1;
     __pyx_t_12 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_locations.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_locations.shape[1];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5383, __pyx_L1_error)
+      __PYX_ERR(0, 5378, __pyx_L1_error)
     }
     __pyx_v_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_17 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5384
+    /* "discretize/_extensions/tree_ext.pyx":5379
  *             x = locations[i, 0]
  *             y = locations[i, 1]
  *             z = locations[i, 2] if dim==3 else 0.0             # <<<<<<<<<<<<<<
  *             # get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)
  */
-    __Pyx_TraceLine(5384,0,__PYX_ERR(0, 5384, __pyx_L1_error))
+    __Pyx_TraceLine(5379,0,__PYX_ERR(0, 5379, __pyx_L1_error))
     if (((__pyx_v_dim == 3) != 0)) {
       __pyx_t_16 = __pyx_v_i;
       __pyx_t_17 = 2;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_17 < 0) {
         __pyx_t_17 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5384, __pyx_L1_error)
+        __PYX_ERR(0, 5379, __pyx_L1_error)
       }
       __pyx_t_11 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_17 * __pyx_v_locations.strides[1]) )));
     } else {
       __pyx_t_11 = 0.0;
     }
     __pyx_v_z = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":5386
+    /* "discretize/_extensions/tree_ext.pyx":5381
  *             z = locations[i, 2] if dim==3 else 0.0
  *             # get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)             # <<<<<<<<<<<<<<
  *             row_inds = indices[indptr[i]:indptr[i+1]]
  *             row_data = data[indptr[i]:indptr[i+1]]
  */
-    __Pyx_TraceLine(5386,0,__PYX_ERR(0, 5386, __pyx_L1_error))
+    __Pyx_TraceLine(5381,0,__PYX_ERR(0, 5381, __pyx_L1_error))
     __pyx_v_cell = __pyx_v_self->tree->containing_cell(__pyx_v_x, __pyx_v_y, __pyx_v_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":5387
+    /* "discretize/_extensions/tree_ext.pyx":5382
  *             # get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)
  *             row_inds = indices[indptr[i]:indptr[i+1]]             # <<<<<<<<<<<<<<
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:
  */
-    __Pyx_TraceLine(5387,0,__PYX_ERR(0, 5387, __pyx_L1_error))
+    __Pyx_TraceLine(5382,0,__PYX_ERR(0, 5382, __pyx_L1_error))
     __pyx_t_17 = __pyx_v_i;
     __pyx_t_12 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5387, __pyx_L1_error)
+      __PYX_ERR(0, 5382, __pyx_L1_error)
     }
     __pyx_t_16 = (__pyx_v_i + 1);
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5387, __pyx_L1_error)
+      __PYX_ERR(0, 5382, __pyx_L1_error)
     }
     __pyx_t_9.data = __pyx_v_indices.data;
     __pyx_t_9.memview = __pyx_v_indices.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_9, 0);
     __pyx_t_12 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_9,
@@ -65664,49 +65676,49 @@
     (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_16 * __pyx_v_indptr.strides[0]) ))),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 5387, __pyx_L1_error)
+    __PYX_ERR(0, 5382, __pyx_L1_error)
 }
 
 __PYX_XDEC_MEMVIEW(&__pyx_v_row_inds, 1);
     __pyx_v_row_inds = __pyx_t_9;
     __pyx_t_9.memview = NULL;
     __pyx_t_9.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5388
+    /* "discretize/_extensions/tree_ext.pyx":5383
  *             cell = self.tree.containing_cell(x, y, z)
  *             row_inds = indices[indptr[i]:indptr[i+1]]
  *             row_data = data[indptr[i]:indptr[i+1]]             # <<<<<<<<<<<<<<
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:
  */
-    __Pyx_TraceLine(5388,0,__PYX_ERR(0, 5388, __pyx_L1_error))
+    __Pyx_TraceLine(5383,0,__PYX_ERR(0, 5383, __pyx_L1_error))
     __pyx_t_16 = __pyx_v_i;
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5388, __pyx_L1_error)
+      __PYX_ERR(0, 5383, __pyx_L1_error)
     }
     __pyx_t_17 = (__pyx_v_i + 1);
     __pyx_t_12 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5388, __pyx_L1_error)
+      __PYX_ERR(0, 5383, __pyx_L1_error)
     }
     __pyx_t_10.data = __pyx_v_data.data;
     __pyx_t_10.memview = __pyx_v_data.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_10, 0);
     __pyx_t_12 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_10,
@@ -65718,52 +65730,52 @@
     (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_17 * __pyx_v_indptr.strides[0]) ))),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 5388, __pyx_L1_error)
+    __PYX_ERR(0, 5383, __pyx_L1_error)
 }
 
 __PYX_XDEC_MEMVIEW(&__pyx_v_row_data, 1);
     __pyx_v_row_data = __pyx_t_10;
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5389
+    /* "discretize/_extensions/tree_ext.pyx":5384
  *             row_inds = indices[indptr[i]:indptr[i+1]]
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:             # <<<<<<<<<<<<<<
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  */
-    __Pyx_TraceLine(5389,0,__PYX_ERR(0, 5389, __pyx_L1_error))
+    __Pyx_TraceLine(5384,0,__PYX_ERR(0, 5384, __pyx_L1_error))
     __pyx_t_13 = (__pyx_v_zeros_out != 0);
     if (__pyx_t_13) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5390
+      /* "discretize/_extensions/tree_ext.pyx":5385
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5390,0,__PYX_ERR(0, 5390, __pyx_L1_error))
+      __Pyx_TraceLine(5385,0,__PYX_ERR(0, 5385, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_x < (((__pyx_v_cell->points[0])->location[0]) - __pyx_v_eps)) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5391
+        /* "discretize/_extensions/tree_ext.pyx":5386
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:
  */
-        __Pyx_TraceLine(5391,0,__PYX_ERR(0, 5391, __pyx_L1_error))
+        __Pyx_TraceLine(5386,0,__PYX_ERR(0, 5386, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -65771,22 +65783,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5392
+        /* "discretize/_extensions/tree_ext.pyx":5387
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5392,0,__PYX_ERR(0, 5392, __pyx_L1_error))
+        __Pyx_TraceLine(5387,0,__PYX_ERR(0, 5387, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -65794,43 +65806,43 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5390
+        /* "discretize/_extensions/tree_ext.pyx":5385
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5393
+      /* "discretize/_extensions/tree_ext.pyx":5388
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5393,0,__PYX_ERR(0, 5393, __pyx_L1_error))
+      __Pyx_TraceLine(5388,0,__PYX_ERR(0, 5388, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_x > (((__pyx_v_cell->points[3])->location[0]) + __pyx_v_eps)) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5394
+        /* "discretize/_extensions/tree_ext.pyx":5389
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:
  */
-        __Pyx_TraceLine(5394,0,__PYX_ERR(0, 5394, __pyx_L1_error))
+        __Pyx_TraceLine(5389,0,__PYX_ERR(0, 5389, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -65838,22 +65850,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5395
+        /* "discretize/_extensions/tree_ext.pyx":5390
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5395,0,__PYX_ERR(0, 5395, __pyx_L1_error))
+        __Pyx_TraceLine(5390,0,__PYX_ERR(0, 5390, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -65861,43 +65873,43 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5393
+        /* "discretize/_extensions/tree_ext.pyx":5388
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5396
+      /* "discretize/_extensions/tree_ext.pyx":5391
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5396,0,__PYX_ERR(0, 5396, __pyx_L1_error))
+      __Pyx_TraceLine(5391,0,__PYX_ERR(0, 5391, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_y < (((__pyx_v_cell->points[0])->location[1]) - __pyx_v_eps)) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5397
+        /* "discretize/_extensions/tree_ext.pyx":5392
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:
  */
-        __Pyx_TraceLine(5397,0,__PYX_ERR(0, 5397, __pyx_L1_error))
+        __Pyx_TraceLine(5392,0,__PYX_ERR(0, 5392, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -65905,22 +65917,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5398
+        /* "discretize/_extensions/tree_ext.pyx":5393
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5398,0,__PYX_ERR(0, 5398, __pyx_L1_error))
+        __Pyx_TraceLine(5393,0,__PYX_ERR(0, 5393, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -65928,43 +65940,43 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5396
+        /* "discretize/_extensions/tree_ext.pyx":5391
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5399
+      /* "discretize/_extensions/tree_ext.pyx":5394
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5399,0,__PYX_ERR(0, 5399, __pyx_L1_error))
+      __Pyx_TraceLine(5394,0,__PYX_ERR(0, 5394, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_y > (((__pyx_v_cell->points[3])->location[1]) + __pyx_v_eps)) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5400
+        /* "discretize/_extensions/tree_ext.pyx":5395
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  */
-        __Pyx_TraceLine(5400,0,__PYX_ERR(0, 5400, __pyx_L1_error))
+        __Pyx_TraceLine(5395,0,__PYX_ERR(0, 5395, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -65972,22 +65984,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5401
+        /* "discretize/_extensions/tree_ext.pyx":5396
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5401,0,__PYX_ERR(0, 5401, __pyx_L1_error))
+        __Pyx_TraceLine(5396,0,__PYX_ERR(0, 5396, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -65995,51 +66007,51 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5399
+        /* "discretize/_extensions/tree_ext.pyx":5394
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5402
+      /* "discretize/_extensions/tree_ext.pyx":5397
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5402,0,__PYX_ERR(0, 5402, __pyx_L1_error))
+      __Pyx_TraceLine(5397,0,__PYX_ERR(0, 5397, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L8_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_z < (((__pyx_v_cell->points[0])->location[2]) - __pyx_v_eps)) != 0);
       __pyx_t_13 = __pyx_t_18;
       __pyx_L8_bool_binop_done:;
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5403
+        /* "discretize/_extensions/tree_ext.pyx":5398
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  */
-        __Pyx_TraceLine(5403,0,__PYX_ERR(0, 5403, __pyx_L1_error))
+        __Pyx_TraceLine(5398,0,__PYX_ERR(0, 5398, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -66047,22 +66059,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5404
+        /* "discretize/_extensions/tree_ext.pyx":5399
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5404,0,__PYX_ERR(0, 5404, __pyx_L1_error))
+        __Pyx_TraceLine(5399,0,__PYX_ERR(0, 5399, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -66070,51 +66082,51 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5402
+        /* "discretize/_extensions/tree_ext.pyx":5397
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5405
+      /* "discretize/_extensions/tree_ext.pyx":5400
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5405,0,__PYX_ERR(0, 5405, __pyx_L1_error))
+      __Pyx_TraceLine(5400,0,__PYX_ERR(0, 5400, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L10_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_z > (((__pyx_v_cell->points[7])->location[2]) + __pyx_v_eps)) != 0);
       __pyx_t_13 = __pyx_t_18;
       __pyx_L10_bool_binop_done:;
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5406
+        /* "discretize/_extensions/tree_ext.pyx":5401
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *             else:
  */
-        __Pyx_TraceLine(5406,0,__PYX_ERR(0, 5406, __pyx_L1_error))
+        __Pyx_TraceLine(5401,0,__PYX_ERR(0, 5401, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -66122,22 +66134,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5407
+        /* "discretize/_extensions/tree_ext.pyx":5402
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *             else:
  *                 # look + dir and - dir away
  */
-        __Pyx_TraceLine(5407,0,__PYX_ERR(0, 5407, __pyx_L1_error))
+        __Pyx_TraceLine(5402,0,__PYX_ERR(0, 5402, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -66145,1068 +66157,1068 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5405
+        /* "discretize/_extensions/tree_ext.pyx":5400
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
       }
       __pyx_L7:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5389
+      /* "discretize/_extensions/tree_ext.pyx":5384
  *             row_inds = indices[indptr[i]:indptr[i+1]]
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:             # <<<<<<<<<<<<<<
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  */
       goto __pyx_L6;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5410
+    /* "discretize/_extensions/tree_ext.pyx":5405
  *             else:
  *                 # look + dir and - dir away
  *                 if (             # <<<<<<<<<<<<<<
  *                     locations[i, dir] < cell.location[dir]
  *                     and cell.neighbors[2*dir] != NULL
  */
-    __Pyx_TraceLine(5410,0,__PYX_ERR(0, 5410, __pyx_L1_error))
+    __Pyx_TraceLine(5405,0,__PYX_ERR(0, 5405, __pyx_L1_error))
     /*else*/ {
 
-      /* "discretize/_extensions/tree_ext.pyx":5411
+      /* "discretize/_extensions/tree_ext.pyx":5406
  *                 # look + dir and - dir away
  *                 if (
  *                     locations[i, dir] < cell.location[dir]             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2*dir] != NULL
  *                     and cell.neighbors[2*dir].is_leaf()
  */
-      __Pyx_TraceLine(5411,0,__PYX_ERR(0, 5411, __pyx_L1_error))
+      __Pyx_TraceLine(5406,0,__PYX_ERR(0, 5406, __pyx_L1_error))
       __pyx_t_17 = __pyx_v_i;
       __pyx_t_16 = __pyx_v_dir;
       __pyx_t_12 = -1;
       if (__pyx_t_17 < 0) {
         __pyx_t_17 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5411, __pyx_L1_error)
+        __PYX_ERR(0, 5406, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_17 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) ))) < (__pyx_v_cell->location[__pyx_v_dir])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L13_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5412
+      /* "discretize/_extensions/tree_ext.pyx":5407
  *                 if (
  *                     locations[i, dir] < cell.location[dir]
  *                     and cell.neighbors[2*dir] != NULL             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2*dir].is_leaf()
  *                     and cell.neighbors[2*dir].level == cell.level
  */
-      __Pyx_TraceLine(5412,0,__PYX_ERR(0, 5412, __pyx_L1_error))
+      __Pyx_TraceLine(5407,0,__PYX_ERR(0, 5407, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[(2 * __pyx_v_dir)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L13_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5413
+      /* "discretize/_extensions/tree_ext.pyx":5408
  *                     locations[i, dir] < cell.location[dir]
  *                     and cell.neighbors[2*dir] != NULL
  *                     and cell.neighbors[2*dir].is_leaf()             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2*dir].level == cell.level
  *                 ):
  */
-      __Pyx_TraceLine(5413,0,__PYX_ERR(0, 5413, __pyx_L1_error))
+      __Pyx_TraceLine(5408,0,__PYX_ERR(0, 5408, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_cell->neighbors[(2 * __pyx_v_dir)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L13_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5414
+      /* "discretize/_extensions/tree_ext.pyx":5409
  *                     and cell.neighbors[2*dir] != NULL
  *                     and cell.neighbors[2*dir].is_leaf()
  *                     and cell.neighbors[2*dir].level == cell.level             # <<<<<<<<<<<<<<
  *                 ):
  *                     i0 = cell.neighbors[2*dir]
  */
-      __Pyx_TraceLine(5414,0,__PYX_ERR(0, 5414, __pyx_L1_error))
+      __Pyx_TraceLine(5409,0,__PYX_ERR(0, 5409, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[(2 * __pyx_v_dir)])->level == __pyx_v_cell->level) != 0);
       __pyx_t_13 = __pyx_t_18;
       __pyx_L13_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5410
+      /* "discretize/_extensions/tree_ext.pyx":5405
  *             else:
  *                 # look + dir and - dir away
  *                 if (             # <<<<<<<<<<<<<<
  *                     locations[i, dir] < cell.location[dir]
  *                     and cell.neighbors[2*dir] != NULL
  */
-      __Pyx_TraceLine(5410,0,__PYX_ERR(0, 5410, __pyx_L1_error))
+      __Pyx_TraceLine(5405,0,__PYX_ERR(0, 5405, __pyx_L1_error))
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5416
+        /* "discretize/_extensions/tree_ext.pyx":5411
  *                     and cell.neighbors[2*dir].level == cell.level
  *                 ):
  *                     i0 = cell.neighbors[2*dir]             # <<<<<<<<<<<<<<
  *                     i1 = cell
  *                 elif(
  */
-        __Pyx_TraceLine(5416,0,__PYX_ERR(0, 5416, __pyx_L1_error))
+        __Pyx_TraceLine(5411,0,__PYX_ERR(0, 5411, __pyx_L1_error))
         __pyx_v_i0 = (__pyx_v_cell->neighbors[(2 * __pyx_v_dir)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5417
+        /* "discretize/_extensions/tree_ext.pyx":5412
  *                 ):
  *                     i0 = cell.neighbors[2*dir]
  *                     i1 = cell             # <<<<<<<<<<<<<<
  *                 elif(
  *                     locations[i, dir] > cell.location[dir]
  */
-        __Pyx_TraceLine(5417,0,__PYX_ERR(0, 5417, __pyx_L1_error))
+        __Pyx_TraceLine(5412,0,__PYX_ERR(0, 5412, __pyx_L1_error))
         __pyx_v_i1 = __pyx_v_cell;
 
-        /* "discretize/_extensions/tree_ext.pyx":5410
+        /* "discretize/_extensions/tree_ext.pyx":5405
  *             else:
  *                 # look + dir and - dir away
  *                 if (             # <<<<<<<<<<<<<<
  *                     locations[i, dir] < cell.location[dir]
  *                     and cell.neighbors[2*dir] != NULL
  */
         goto __pyx_L12;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5419
+      /* "discretize/_extensions/tree_ext.pyx":5414
  *                     i1 = cell
  *                 elif(
  *                     locations[i, dir] > cell.location[dir]             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2*dir + 1] != NULL
  *                     and cell.neighbors[2*dir + 1].is_leaf()
  */
-      __Pyx_TraceLine(5419,0,__PYX_ERR(0, 5419, __pyx_L1_error))
+      __Pyx_TraceLine(5414,0,__PYX_ERR(0, 5414, __pyx_L1_error))
       __pyx_t_16 = __pyx_v_i;
       __pyx_t_17 = __pyx_v_dir;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_17 < 0) {
         __pyx_t_17 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5419, __pyx_L1_error)
+        __PYX_ERR(0, 5414, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_17 * __pyx_v_locations.strides[1]) ))) > (__pyx_v_cell->location[__pyx_v_dir])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L17_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5420
+      /* "discretize/_extensions/tree_ext.pyx":5415
  *                 elif(
  *                     locations[i, dir] > cell.location[dir]
  *                     and cell.neighbors[2*dir + 1] != NULL             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2*dir + 1].is_leaf()
  *                     and cell.neighbors[2*dir + 1].level == cell.level
  */
-      __Pyx_TraceLine(5420,0,__PYX_ERR(0, 5420, __pyx_L1_error))
+      __Pyx_TraceLine(5415,0,__PYX_ERR(0, 5415, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[((2 * __pyx_v_dir) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L17_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5421
+      /* "discretize/_extensions/tree_ext.pyx":5416
  *                     locations[i, dir] > cell.location[dir]
  *                     and cell.neighbors[2*dir + 1] != NULL
  *                     and cell.neighbors[2*dir + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2*dir + 1].level == cell.level
  *                 ):
  */
-      __Pyx_TraceLine(5421,0,__PYX_ERR(0, 5421, __pyx_L1_error))
+      __Pyx_TraceLine(5416,0,__PYX_ERR(0, 5416, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_cell->neighbors[((2 * __pyx_v_dir) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L17_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5422
+      /* "discretize/_extensions/tree_ext.pyx":5417
  *                     and cell.neighbors[2*dir + 1] != NULL
  *                     and cell.neighbors[2*dir + 1].is_leaf()
  *                     and cell.neighbors[2*dir + 1].level == cell.level             # <<<<<<<<<<<<<<
  *                 ):
  *                     i0 = cell
  */
-      __Pyx_TraceLine(5422,0,__PYX_ERR(0, 5422, __pyx_L1_error))
+      __Pyx_TraceLine(5417,0,__PYX_ERR(0, 5417, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[((2 * __pyx_v_dir) + 1)])->level == __pyx_v_cell->level) != 0);
       __pyx_t_13 = __pyx_t_18;
       __pyx_L17_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5418
+      /* "discretize/_extensions/tree_ext.pyx":5413
  *                     i0 = cell.neighbors[2*dir]
  *                     i1 = cell
  *                 elif(             # <<<<<<<<<<<<<<
  *                     locations[i, dir] > cell.location[dir]
  *                     and cell.neighbors[2*dir + 1] != NULL
  */
-      __Pyx_TraceLine(5418,0,__PYX_ERR(0, 5418, __pyx_L1_error))
+      __Pyx_TraceLine(5413,0,__PYX_ERR(0, 5413, __pyx_L1_error))
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5424
+        /* "discretize/_extensions/tree_ext.pyx":5419
  *                     and cell.neighbors[2*dir + 1].level == cell.level
  *                 ):
  *                     i0 = cell             # <<<<<<<<<<<<<<
  *                     i1 = cell.neighbors[2*dir + 1]
  *                 else:
  */
-        __Pyx_TraceLine(5424,0,__PYX_ERR(0, 5424, __pyx_L1_error))
+        __Pyx_TraceLine(5419,0,__PYX_ERR(0, 5419, __pyx_L1_error))
         __pyx_v_i0 = __pyx_v_cell;
 
-        /* "discretize/_extensions/tree_ext.pyx":5425
+        /* "discretize/_extensions/tree_ext.pyx":5420
  *                 ):
  *                     i0 = cell
  *                     i1 = cell.neighbors[2*dir + 1]             # <<<<<<<<<<<<<<
  *                 else:
  *                     i0 = cell
  */
-        __Pyx_TraceLine(5425,0,__PYX_ERR(0, 5425, __pyx_L1_error))
+        __Pyx_TraceLine(5420,0,__PYX_ERR(0, 5420, __pyx_L1_error))
         __pyx_v_i1 = (__pyx_v_cell->neighbors[((2 * __pyx_v_dir) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5418
+        /* "discretize/_extensions/tree_ext.pyx":5413
  *                     i0 = cell.neighbors[2*dir]
  *                     i1 = cell
  *                 elif(             # <<<<<<<<<<<<<<
  *                     locations[i, dir] > cell.location[dir]
  *                     and cell.neighbors[2*dir + 1] != NULL
  */
         goto __pyx_L12;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5427
+      /* "discretize/_extensions/tree_ext.pyx":5422
  *                     i1 = cell.neighbors[2*dir + 1]
  *                 else:
  *                     i0 = cell             # <<<<<<<<<<<<<<
  *                     i1 = cell
  * 
  */
-      __Pyx_TraceLine(5427,0,__PYX_ERR(0, 5427, __pyx_L1_error))
+      __Pyx_TraceLine(5422,0,__PYX_ERR(0, 5422, __pyx_L1_error))
       /*else*/ {
         __pyx_v_i0 = __pyx_v_cell;
 
-        /* "discretize/_extensions/tree_ext.pyx":5428
+        /* "discretize/_extensions/tree_ext.pyx":5423
  *                 else:
  *                     i0 = cell
  *                     i1 = cell             # <<<<<<<<<<<<<<
  * 
  *                 i000 = i0.edges[n_edges * dir]
  */
-        __Pyx_TraceLine(5428,0,__PYX_ERR(0, 5428, __pyx_L1_error))
+        __Pyx_TraceLine(5423,0,__PYX_ERR(0, 5423, __pyx_L1_error))
         __pyx_v_i1 = __pyx_v_cell;
       }
       __pyx_L12:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5430
+      /* "discretize/_extensions/tree_ext.pyx":5425
  *                     i1 = cell
  * 
  *                 i000 = i0.edges[n_edges * dir]             # <<<<<<<<<<<<<<
  *                 i001 = i0.edges[n_edges * dir + 1]
  *                 w1 = ((i001.location[dir1] - locations[i, dir1])/
  */
-      __Pyx_TraceLine(5430,0,__PYX_ERR(0, 5430, __pyx_L1_error))
+      __Pyx_TraceLine(5425,0,__PYX_ERR(0, 5425, __pyx_L1_error))
       __pyx_v_i000 = (__pyx_v_i0->edges[(__pyx_v_n_edges * __pyx_v_dir)]);
 
-      /* "discretize/_extensions/tree_ext.pyx":5431
+      /* "discretize/_extensions/tree_ext.pyx":5426
  * 
  *                 i000 = i0.edges[n_edges * dir]
  *                 i001 = i0.edges[n_edges * dir + 1]             # <<<<<<<<<<<<<<
  *                 w1 = ((i001.location[dir1] - locations[i, dir1])/
  *                       (i001.location[dir1] - i000.location[dir1]))
  */
-      __Pyx_TraceLine(5431,0,__PYX_ERR(0, 5431, __pyx_L1_error))
+      __Pyx_TraceLine(5426,0,__PYX_ERR(0, 5426, __pyx_L1_error))
       __pyx_v_i001 = (__pyx_v_i0->edges[((__pyx_v_n_edges * __pyx_v_dir) + 1)]);
 
-      /* "discretize/_extensions/tree_ext.pyx":5432
+      /* "discretize/_extensions/tree_ext.pyx":5427
  *                 i000 = i0.edges[n_edges * dir]
  *                 i001 = i0.edges[n_edges * dir + 1]
  *                 w1 = ((i001.location[dir1] - locations[i, dir1])/             # <<<<<<<<<<<<<<
  *                       (i001.location[dir1] - i000.location[dir1]))
  * 
  */
-      __Pyx_TraceLine(5432,0,__PYX_ERR(0, 5432, __pyx_L1_error))
+      __Pyx_TraceLine(5427,0,__PYX_ERR(0, 5427, __pyx_L1_error))
       __pyx_t_17 = __pyx_v_i;
       __pyx_t_16 = __pyx_v_dir1;
       __pyx_t_12 = -1;
       if (__pyx_t_17 < 0) {
         __pyx_t_17 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5432, __pyx_L1_error)
+        __PYX_ERR(0, 5427, __pyx_L1_error)
       }
       __pyx_t_11 = ((__pyx_v_i001->location[__pyx_v_dir1]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_17 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) ))));
 
-      /* "discretize/_extensions/tree_ext.pyx":5433
+      /* "discretize/_extensions/tree_ext.pyx":5428
  *                 i001 = i0.edges[n_edges * dir + 1]
  *                 w1 = ((i001.location[dir1] - locations[i, dir1])/
  *                       (i001.location[dir1] - i000.location[dir1]))             # <<<<<<<<<<<<<<
  * 
  *                 i010 = i1.edges[n_edges*dir]
  */
-      __Pyx_TraceLine(5433,0,__PYX_ERR(0, 5433, __pyx_L1_error))
+      __Pyx_TraceLine(5428,0,__PYX_ERR(0, 5428, __pyx_L1_error))
       __pyx_t_19 = ((__pyx_v_i001->location[__pyx_v_dir1]) - (__pyx_v_i000->location[__pyx_v_dir1]));
 
-      /* "discretize/_extensions/tree_ext.pyx":5432
+      /* "discretize/_extensions/tree_ext.pyx":5427
  *                 i000 = i0.edges[n_edges * dir]
  *                 i001 = i0.edges[n_edges * dir + 1]
  *                 w1 = ((i001.location[dir1] - locations[i, dir1])/             # <<<<<<<<<<<<<<
  *                       (i001.location[dir1] - i000.location[dir1]))
  * 
  */
-      __Pyx_TraceLine(5432,0,__PYX_ERR(0, 5432, __pyx_L1_error))
+      __Pyx_TraceLine(5427,0,__PYX_ERR(0, 5427, __pyx_L1_error))
       if (unlikely(__pyx_t_19 == 0)) {
         PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-        __PYX_ERR(0, 5432, __pyx_L1_error)
+        __PYX_ERR(0, 5427, __pyx_L1_error)
       }
       __pyx_v_w1 = (__pyx_t_11 / __pyx_t_19);
 
-      /* "discretize/_extensions/tree_ext.pyx":5435
+      /* "discretize/_extensions/tree_ext.pyx":5430
  *                       (i001.location[dir1] - i000.location[dir1]))
  * 
  *                 i010 = i1.edges[n_edges*dir]             # <<<<<<<<<<<<<<
  *                 i011 = i1.edges[n_edges*dir + 1]
  *                 if i0.index != i1.index:
  */
-      __Pyx_TraceLine(5435,0,__PYX_ERR(0, 5435, __pyx_L1_error))
+      __Pyx_TraceLine(5430,0,__PYX_ERR(0, 5430, __pyx_L1_error))
       __pyx_v_i010 = (__pyx_v_i1->edges[(__pyx_v_n_edges * __pyx_v_dir)]);
 
-      /* "discretize/_extensions/tree_ext.pyx":5436
+      /* "discretize/_extensions/tree_ext.pyx":5431
  * 
  *                 i010 = i1.edges[n_edges*dir]
  *                 i011 = i1.edges[n_edges*dir + 1]             # <<<<<<<<<<<<<<
  *                 if i0.index != i1.index:
  *                     w2 = ((i010.location[dir] - locations[i, dir])/
  */
-      __Pyx_TraceLine(5436,0,__PYX_ERR(0, 5436, __pyx_L1_error))
+      __Pyx_TraceLine(5431,0,__PYX_ERR(0, 5431, __pyx_L1_error))
       __pyx_v_i011 = (__pyx_v_i1->edges[((__pyx_v_n_edges * __pyx_v_dir) + 1)]);
 
-      /* "discretize/_extensions/tree_ext.pyx":5437
+      /* "discretize/_extensions/tree_ext.pyx":5432
  *                 i010 = i1.edges[n_edges*dir]
  *                 i011 = i1.edges[n_edges*dir + 1]
  *                 if i0.index != i1.index:             # <<<<<<<<<<<<<<
  *                     w2 = ((i010.location[dir] - locations[i, dir])/
  *                           (i010.location[dir] - i000.location[dir]))
  */
-      __Pyx_TraceLine(5437,0,__PYX_ERR(0, 5437, __pyx_L1_error))
+      __Pyx_TraceLine(5432,0,__PYX_ERR(0, 5432, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_i0->index != __pyx_v_i1->index) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5438
+        /* "discretize/_extensions/tree_ext.pyx":5433
  *                 i011 = i1.edges[n_edges*dir + 1]
  *                 if i0.index != i1.index:
  *                     w2 = ((i010.location[dir] - locations[i, dir])/             # <<<<<<<<<<<<<<
  *                           (i010.location[dir] - i000.location[dir]))
  *                 else:
  */
-        __Pyx_TraceLine(5438,0,__PYX_ERR(0, 5438, __pyx_L1_error))
+        __Pyx_TraceLine(5433,0,__PYX_ERR(0, 5433, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_i;
         __pyx_t_17 = __pyx_v_dir;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_17 < 0) {
           __pyx_t_17 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5438, __pyx_L1_error)
+          __PYX_ERR(0, 5433, __pyx_L1_error)
         }
         __pyx_t_19 = ((__pyx_v_i010->location[__pyx_v_dir]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_17 * __pyx_v_locations.strides[1]) ))));
 
-        /* "discretize/_extensions/tree_ext.pyx":5439
+        /* "discretize/_extensions/tree_ext.pyx":5434
  *                 if i0.index != i1.index:
  *                     w2 = ((i010.location[dir] - locations[i, dir])/
  *                           (i010.location[dir] - i000.location[dir]))             # <<<<<<<<<<<<<<
  *                 else:
  *                     w2 = 1.0
  */
-        __Pyx_TraceLine(5439,0,__PYX_ERR(0, 5439, __pyx_L1_error))
+        __Pyx_TraceLine(5434,0,__PYX_ERR(0, 5434, __pyx_L1_error))
         __pyx_t_11 = ((__pyx_v_i010->location[__pyx_v_dir]) - (__pyx_v_i000->location[__pyx_v_dir]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5438
+        /* "discretize/_extensions/tree_ext.pyx":5433
  *                 i011 = i1.edges[n_edges*dir + 1]
  *                 if i0.index != i1.index:
  *                     w2 = ((i010.location[dir] - locations[i, dir])/             # <<<<<<<<<<<<<<
  *                           (i010.location[dir] - i000.location[dir]))
  *                 else:
  */
-        __Pyx_TraceLine(5438,0,__PYX_ERR(0, 5438, __pyx_L1_error))
+        __Pyx_TraceLine(5433,0,__PYX_ERR(0, 5433, __pyx_L1_error))
         if (unlikely(__pyx_t_11 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5438, __pyx_L1_error)
+          __PYX_ERR(0, 5433, __pyx_L1_error)
         }
         __pyx_v_w2 = (__pyx_t_19 / __pyx_t_11);
 
-        /* "discretize/_extensions/tree_ext.pyx":5437
+        /* "discretize/_extensions/tree_ext.pyx":5432
  *                 i010 = i1.edges[n_edges*dir]
  *                 i011 = i1.edges[n_edges*dir + 1]
  *                 if i0.index != i1.index:             # <<<<<<<<<<<<<<
  *                     w2 = ((i010.location[dir] - locations[i, dir])/
  *                           (i010.location[dir] - i000.location[dir]))
  */
         goto __pyx_L21;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5441
+      /* "discretize/_extensions/tree_ext.pyx":5436
  *                           (i010.location[dir] - i000.location[dir]))
  *                 else:
  *                     w2 = 1.0             # <<<<<<<<<<<<<<
  * 
  *                 if dim == 3:
  */
-      __Pyx_TraceLine(5441,0,__PYX_ERR(0, 5441, __pyx_L1_error))
+      __Pyx_TraceLine(5436,0,__PYX_ERR(0, 5436, __pyx_L1_error))
       /*else*/ {
         __pyx_v_w2 = 1.0;
       }
       __pyx_L21:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5443
+      /* "discretize/_extensions/tree_ext.pyx":5438
  *                     w2 = 1.0
  * 
  *                 if dim == 3:             # <<<<<<<<<<<<<<
  *                     i100 = i0.edges[n_edges * dir + 2]
  *                     i101 = i0.edges[n_edges * dir + 3]
  */
-      __Pyx_TraceLine(5443,0,__PYX_ERR(0, 5443, __pyx_L1_error))
+      __Pyx_TraceLine(5438,0,__PYX_ERR(0, 5438, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5444
+        /* "discretize/_extensions/tree_ext.pyx":5439
  * 
  *                 if dim == 3:
  *                     i100 = i0.edges[n_edges * dir + 2]             # <<<<<<<<<<<<<<
  *                     i101 = i0.edges[n_edges * dir + 3]
  *                     i110 = i1.edges[n_edges * dir + 2]
  */
-        __Pyx_TraceLine(5444,0,__PYX_ERR(0, 5444, __pyx_L1_error))
+        __Pyx_TraceLine(5439,0,__PYX_ERR(0, 5439, __pyx_L1_error))
         __pyx_v_i100 = (__pyx_v_i0->edges[((__pyx_v_n_edges * __pyx_v_dir) + 2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5445
+        /* "discretize/_extensions/tree_ext.pyx":5440
  *                 if dim == 3:
  *                     i100 = i0.edges[n_edges * dir + 2]
  *                     i101 = i0.edges[n_edges * dir + 3]             # <<<<<<<<<<<<<<
  *                     i110 = i1.edges[n_edges * dir + 2]
  *                     i111 = i1.edges[n_edges * dir + 3]
  */
-        __Pyx_TraceLine(5445,0,__PYX_ERR(0, 5445, __pyx_L1_error))
+        __Pyx_TraceLine(5440,0,__PYX_ERR(0, 5440, __pyx_L1_error))
         __pyx_v_i101 = (__pyx_v_i0->edges[((__pyx_v_n_edges * __pyx_v_dir) + 3)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5446
+        /* "discretize/_extensions/tree_ext.pyx":5441
  *                     i100 = i0.edges[n_edges * dir + 2]
  *                     i101 = i0.edges[n_edges * dir + 3]
  *                     i110 = i1.edges[n_edges * dir + 2]             # <<<<<<<<<<<<<<
  *                     i111 = i1.edges[n_edges * dir + 3]
  * 
  */
-        __Pyx_TraceLine(5446,0,__PYX_ERR(0, 5446, __pyx_L1_error))
+        __Pyx_TraceLine(5441,0,__PYX_ERR(0, 5441, __pyx_L1_error))
         __pyx_v_i110 = (__pyx_v_i1->edges[((__pyx_v_n_edges * __pyx_v_dir) + 2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5447
+        /* "discretize/_extensions/tree_ext.pyx":5442
  *                     i101 = i0.edges[n_edges * dir + 3]
  *                     i110 = i1.edges[n_edges * dir + 2]
  *                     i111 = i1.edges[n_edges * dir + 3]             # <<<<<<<<<<<<<<
  * 
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/
  */
-        __Pyx_TraceLine(5447,0,__PYX_ERR(0, 5447, __pyx_L1_error))
+        __Pyx_TraceLine(5442,0,__PYX_ERR(0, 5442, __pyx_L1_error))
         __pyx_v_i111 = (__pyx_v_i1->edges[((__pyx_v_n_edges * __pyx_v_dir) + 3)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5449
+        /* "discretize/_extensions/tree_ext.pyx":5444
  *                     i111 = i1.edges[n_edges * dir + 3]
  * 
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/             # <<<<<<<<<<<<<<
  *                           (i100.location[dir2] - i000.location[dir2]))
  *                 else:
  */
-        __Pyx_TraceLine(5449,0,__PYX_ERR(0, 5449, __pyx_L1_error))
+        __Pyx_TraceLine(5444,0,__PYX_ERR(0, 5444, __pyx_L1_error))
         __pyx_t_17 = __pyx_v_i;
         __pyx_t_16 = __pyx_v_dir2;
         __pyx_t_12 = -1;
         if (__pyx_t_17 < 0) {
           __pyx_t_17 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5449, __pyx_L1_error)
+          __PYX_ERR(0, 5444, __pyx_L1_error)
         }
         __pyx_t_11 = ((__pyx_v_i100->location[__pyx_v_dir2]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_17 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) ))));
 
-        /* "discretize/_extensions/tree_ext.pyx":5450
+        /* "discretize/_extensions/tree_ext.pyx":5445
  * 
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/
  *                           (i100.location[dir2] - i000.location[dir2]))             # <<<<<<<<<<<<<<
  *                 else:
  *                     w3 = 1.0
  */
-        __Pyx_TraceLine(5450,0,__PYX_ERR(0, 5450, __pyx_L1_error))
+        __Pyx_TraceLine(5445,0,__PYX_ERR(0, 5445, __pyx_L1_error))
         __pyx_t_19 = ((__pyx_v_i100->location[__pyx_v_dir2]) - (__pyx_v_i000->location[__pyx_v_dir2]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5449
+        /* "discretize/_extensions/tree_ext.pyx":5444
  *                     i111 = i1.edges[n_edges * dir + 3]
  * 
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/             # <<<<<<<<<<<<<<
  *                           (i100.location[dir2] - i000.location[dir2]))
  *                 else:
  */
-        __Pyx_TraceLine(5449,0,__PYX_ERR(0, 5449, __pyx_L1_error))
+        __Pyx_TraceLine(5444,0,__PYX_ERR(0, 5444, __pyx_L1_error))
         if (unlikely(__pyx_t_19 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5449, __pyx_L1_error)
+          __PYX_ERR(0, 5444, __pyx_L1_error)
         }
         __pyx_v_w3 = (__pyx_t_11 / __pyx_t_19);
 
-        /* "discretize/_extensions/tree_ext.pyx":5443
+        /* "discretize/_extensions/tree_ext.pyx":5438
  *                     w2 = 1.0
  * 
  *                 if dim == 3:             # <<<<<<<<<<<<<<
  *                     i100 = i0.edges[n_edges * dir + 2]
  *                     i101 = i0.edges[n_edges * dir + 3]
  */
         goto __pyx_L22;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5452
+      /* "discretize/_extensions/tree_ext.pyx":5447
  *                           (i100.location[dir2] - i000.location[dir2]))
  *                 else:
  *                     w3 = 1.0             # <<<<<<<<<<<<<<
  * 
  *                 w1 = _clip01(w1)
  */
-      __Pyx_TraceLine(5452,0,__PYX_ERR(0, 5452, __pyx_L1_error))
+      __Pyx_TraceLine(5447,0,__PYX_ERR(0, 5447, __pyx_L1_error))
       /*else*/ {
         __pyx_v_w3 = 1.0;
       }
       __pyx_L22:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5454
+      /* "discretize/_extensions/tree_ext.pyx":5449
  *                     w3 = 1.0
  * 
  *                 w1 = _clip01(w1)             # <<<<<<<<<<<<<<
  *                 w2 = _clip01(w2)
  *                 w3 = _clip01(w3)
  */
-      __Pyx_TraceLine(5454,0,__PYX_ERR(0, 5454, __pyx_L1_error))
+      __Pyx_TraceLine(5449,0,__PYX_ERR(0, 5449, __pyx_L1_error))
       __pyx_v_w1 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w1);
 
-      /* "discretize/_extensions/tree_ext.pyx":5455
+      /* "discretize/_extensions/tree_ext.pyx":5450
  * 
  *                 w1 = _clip01(w1)
  *                 w2 = _clip01(w2)             # <<<<<<<<<<<<<<
  *                 w3 = _clip01(w3)
  * 
  */
-      __Pyx_TraceLine(5455,0,__PYX_ERR(0, 5455, __pyx_L1_error))
+      __Pyx_TraceLine(5450,0,__PYX_ERR(0, 5450, __pyx_L1_error))
       __pyx_v_w2 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w2);
 
-      /* "discretize/_extensions/tree_ext.pyx":5456
+      /* "discretize/_extensions/tree_ext.pyx":5451
  *                 w1 = _clip01(w1)
  *                 w2 = _clip01(w2)
  *                 w3 = _clip01(w3)             # <<<<<<<<<<<<<<
  * 
  *                 row_data[0] = w1 * w2 * w3
  */
-      __Pyx_TraceLine(5456,0,__PYX_ERR(0, 5456, __pyx_L1_error))
+      __Pyx_TraceLine(5451,0,__PYX_ERR(0, 5451, __pyx_L1_error))
       __pyx_v_w3 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w3);
 
-      /* "discretize/_extensions/tree_ext.pyx":5458
+      /* "discretize/_extensions/tree_ext.pyx":5453
  *                 w3 = _clip01(w3)
  * 
  *                 row_data[0] = w1 * w2 * w3             # <<<<<<<<<<<<<<
  *                 row_data[1] = (1 - w1) * w2 * w3
  *                 row_data[2] = w1 * (1 - w2) * w3
  */
-      __Pyx_TraceLine(5458,0,__PYX_ERR(0, 5458, __pyx_L1_error))
+      __Pyx_TraceLine(5453,0,__PYX_ERR(0, 5453, __pyx_L1_error))
       __pyx_t_16 = 0;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_row_data.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5458, __pyx_L1_error)
+        __PYX_ERR(0, 5453, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_16 * __pyx_v_row_data.strides[0]) )) = ((__pyx_v_w1 * __pyx_v_w2) * __pyx_v_w3);
 
-      /* "discretize/_extensions/tree_ext.pyx":5459
+      /* "discretize/_extensions/tree_ext.pyx":5454
  * 
  *                 row_data[0] = w1 * w2 * w3
  *                 row_data[1] = (1 - w1) * w2 * w3             # <<<<<<<<<<<<<<
  *                 row_data[2] = w1 * (1 - w2) * w3
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3
  */
-      __Pyx_TraceLine(5459,0,__PYX_ERR(0, 5459, __pyx_L1_error))
+      __Pyx_TraceLine(5454,0,__PYX_ERR(0, 5454, __pyx_L1_error))
       __pyx_t_16 = 1;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_row_data.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5459, __pyx_L1_error)
+        __PYX_ERR(0, 5454, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_16 * __pyx_v_row_data.strides[0]) )) = (((1.0 - __pyx_v_w1) * __pyx_v_w2) * __pyx_v_w3);
 
-      /* "discretize/_extensions/tree_ext.pyx":5460
+      /* "discretize/_extensions/tree_ext.pyx":5455
  *                 row_data[0] = w1 * w2 * w3
  *                 row_data[1] = (1 - w1) * w2 * w3
  *                 row_data[2] = w1 * (1 - w2) * w3             # <<<<<<<<<<<<<<
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3
  *                 row_inds[0] = i000.index + offset
  */
-      __Pyx_TraceLine(5460,0,__PYX_ERR(0, 5460, __pyx_L1_error))
+      __Pyx_TraceLine(5455,0,__PYX_ERR(0, 5455, __pyx_L1_error))
       __pyx_t_16 = 2;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_row_data.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5460, __pyx_L1_error)
+        __PYX_ERR(0, 5455, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_16 * __pyx_v_row_data.strides[0]) )) = ((__pyx_v_w1 * (1.0 - __pyx_v_w2)) * __pyx_v_w3);
 
-      /* "discretize/_extensions/tree_ext.pyx":5461
+      /* "discretize/_extensions/tree_ext.pyx":5456
  *                 row_data[1] = (1 - w1) * w2 * w3
  *                 row_data[2] = w1 * (1 - w2) * w3
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3             # <<<<<<<<<<<<<<
  *                 row_inds[0] = i000.index + offset
  *                 row_inds[1] = i001.index + offset
  */
-      __Pyx_TraceLine(5461,0,__PYX_ERR(0, 5461, __pyx_L1_error))
+      __Pyx_TraceLine(5456,0,__PYX_ERR(0, 5456, __pyx_L1_error))
       __pyx_t_16 = 3;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_row_data.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5461, __pyx_L1_error)
+        __PYX_ERR(0, 5456, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_16 * __pyx_v_row_data.strides[0]) )) = (((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2)) * __pyx_v_w3);
 
-      /* "discretize/_extensions/tree_ext.pyx":5462
+      /* "discretize/_extensions/tree_ext.pyx":5457
  *                 row_data[2] = w1 * (1 - w2) * w3
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3
  *                 row_inds[0] = i000.index + offset             # <<<<<<<<<<<<<<
  *                 row_inds[1] = i001.index + offset
  *                 row_inds[2] = i010.index + offset
  */
-      __Pyx_TraceLine(5462,0,__PYX_ERR(0, 5462, __pyx_L1_error))
+      __Pyx_TraceLine(5457,0,__PYX_ERR(0, 5457, __pyx_L1_error))
       __pyx_t_16 = 0;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_row_inds.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5462, __pyx_L1_error)
+        __PYX_ERR(0, 5457, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_16 * __pyx_v_row_inds.strides[0]) )) = (__pyx_v_i000->index + __pyx_v_offset);
 
-      /* "discretize/_extensions/tree_ext.pyx":5463
+      /* "discretize/_extensions/tree_ext.pyx":5458
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3
  *                 row_inds[0] = i000.index + offset
  *                 row_inds[1] = i001.index + offset             # <<<<<<<<<<<<<<
  *                 row_inds[2] = i010.index + offset
  *                 row_inds[3] = i011.index + offset
  */
-      __Pyx_TraceLine(5463,0,__PYX_ERR(0, 5463, __pyx_L1_error))
+      __Pyx_TraceLine(5458,0,__PYX_ERR(0, 5458, __pyx_L1_error))
       __pyx_t_16 = 1;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_row_inds.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5463, __pyx_L1_error)
+        __PYX_ERR(0, 5458, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_16 * __pyx_v_row_inds.strides[0]) )) = (__pyx_v_i001->index + __pyx_v_offset);
 
-      /* "discretize/_extensions/tree_ext.pyx":5464
+      /* "discretize/_extensions/tree_ext.pyx":5459
  *                 row_inds[0] = i000.index + offset
  *                 row_inds[1] = i001.index + offset
  *                 row_inds[2] = i010.index + offset             # <<<<<<<<<<<<<<
  *                 row_inds[3] = i011.index + offset
  *                 if dim==3:
  */
-      __Pyx_TraceLine(5464,0,__PYX_ERR(0, 5464, __pyx_L1_error))
+      __Pyx_TraceLine(5459,0,__PYX_ERR(0, 5459, __pyx_L1_error))
       __pyx_t_16 = 2;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_row_inds.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5464, __pyx_L1_error)
+        __PYX_ERR(0, 5459, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_16 * __pyx_v_row_inds.strides[0]) )) = (__pyx_v_i010->index + __pyx_v_offset);
 
-      /* "discretize/_extensions/tree_ext.pyx":5465
+      /* "discretize/_extensions/tree_ext.pyx":5460
  *                 row_inds[1] = i001.index + offset
  *                 row_inds[2] = i010.index + offset
  *                 row_inds[3] = i011.index + offset             # <<<<<<<<<<<<<<
  *                 if dim==3:
  *                     row_data[4] = w1 * w2 * (1 - w3)
  */
-      __Pyx_TraceLine(5465,0,__PYX_ERR(0, 5465, __pyx_L1_error))
+      __Pyx_TraceLine(5460,0,__PYX_ERR(0, 5460, __pyx_L1_error))
       __pyx_t_16 = 3;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_row_inds.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5465, __pyx_L1_error)
+        __PYX_ERR(0, 5460, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_16 * __pyx_v_row_inds.strides[0]) )) = (__pyx_v_i011->index + __pyx_v_offset);
 
-      /* "discretize/_extensions/tree_ext.pyx":5466
+      /* "discretize/_extensions/tree_ext.pyx":5461
  *                 row_inds[2] = i010.index + offset
  *                 row_inds[3] = i011.index + offset
  *                 if dim==3:             # <<<<<<<<<<<<<<
  *                     row_data[4] = w1 * w2 * (1 - w3)
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  */
-      __Pyx_TraceLine(5466,0,__PYX_ERR(0, 5466, __pyx_L1_error))
+      __Pyx_TraceLine(5461,0,__PYX_ERR(0, 5461, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5467
+        /* "discretize/_extensions/tree_ext.pyx":5462
  *                 row_inds[3] = i011.index + offset
  *                 if dim==3:
  *                     row_data[4] = w1 * w2 * (1 - w3)             # <<<<<<<<<<<<<<
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)
  */
-        __Pyx_TraceLine(5467,0,__PYX_ERR(0, 5467, __pyx_L1_error))
+        __Pyx_TraceLine(5462,0,__PYX_ERR(0, 5462, __pyx_L1_error))
         __pyx_t_16 = 4;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_row_data.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5467, __pyx_L1_error)
+          __PYX_ERR(0, 5462, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_16 * __pyx_v_row_data.strides[0]) )) = ((__pyx_v_w1 * __pyx_v_w2) * (1.0 - __pyx_v_w3));
 
-        /* "discretize/_extensions/tree_ext.pyx":5468
+        /* "discretize/_extensions/tree_ext.pyx":5463
  *                 if dim==3:
  *                     row_data[4] = w1 * w2 * (1 - w3)
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)             # <<<<<<<<<<<<<<
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  */
-        __Pyx_TraceLine(5468,0,__PYX_ERR(0, 5468, __pyx_L1_error))
+        __Pyx_TraceLine(5463,0,__PYX_ERR(0, 5463, __pyx_L1_error))
         __pyx_t_16 = 5;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_row_data.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5468, __pyx_L1_error)
+          __PYX_ERR(0, 5463, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_16 * __pyx_v_row_data.strides[0]) )) = (((1.0 - __pyx_v_w1) * __pyx_v_w2) * (1.0 - __pyx_v_w3));
 
-        /* "discretize/_extensions/tree_ext.pyx":5469
+        /* "discretize/_extensions/tree_ext.pyx":5464
  *                     row_data[4] = w1 * w2 * (1 - w3)
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)             # <<<<<<<<<<<<<<
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                     row_inds[4] = i100.index + offset
  */
-        __Pyx_TraceLine(5469,0,__PYX_ERR(0, 5469, __pyx_L1_error))
+        __Pyx_TraceLine(5464,0,__PYX_ERR(0, 5464, __pyx_L1_error))
         __pyx_t_16 = 6;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_row_data.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5469, __pyx_L1_error)
+          __PYX_ERR(0, 5464, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_16 * __pyx_v_row_data.strides[0]) )) = ((__pyx_v_w1 * (1.0 - __pyx_v_w2)) * (1.0 - __pyx_v_w3));
 
-        /* "discretize/_extensions/tree_ext.pyx":5470
+        /* "discretize/_extensions/tree_ext.pyx":5465
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)             # <<<<<<<<<<<<<<
  *                     row_inds[4] = i100.index + offset
  *                     row_inds[5] = i101.index + offset
  */
-        __Pyx_TraceLine(5470,0,__PYX_ERR(0, 5470, __pyx_L1_error))
+        __Pyx_TraceLine(5465,0,__PYX_ERR(0, 5465, __pyx_L1_error))
         __pyx_t_16 = 7;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_row_data.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5470, __pyx_L1_error)
+          __PYX_ERR(0, 5465, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_16 * __pyx_v_row_data.strides[0]) )) = (((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2)) * (1.0 - __pyx_v_w3));
 
-        /* "discretize/_extensions/tree_ext.pyx":5471
+        /* "discretize/_extensions/tree_ext.pyx":5466
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                     row_inds[4] = i100.index + offset             # <<<<<<<<<<<<<<
  *                     row_inds[5] = i101.index + offset
  *                     row_inds[6] = i110.index + offset
  */
-        __Pyx_TraceLine(5471,0,__PYX_ERR(0, 5471, __pyx_L1_error))
+        __Pyx_TraceLine(5466,0,__PYX_ERR(0, 5466, __pyx_L1_error))
         __pyx_t_16 = 4;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_row_inds.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5471, __pyx_L1_error)
+          __PYX_ERR(0, 5466, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_16 * __pyx_v_row_inds.strides[0]) )) = (__pyx_v_i100->index + __pyx_v_offset);
 
-        /* "discretize/_extensions/tree_ext.pyx":5472
+        /* "discretize/_extensions/tree_ext.pyx":5467
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                     row_inds[4] = i100.index + offset
  *                     row_inds[5] = i101.index + offset             # <<<<<<<<<<<<<<
  *                     row_inds[6] = i110.index + offset
  *                     row_inds[7] = i111.index + offset
  */
-        __Pyx_TraceLine(5472,0,__PYX_ERR(0, 5472, __pyx_L1_error))
+        __Pyx_TraceLine(5467,0,__PYX_ERR(0, 5467, __pyx_L1_error))
         __pyx_t_16 = 5;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_row_inds.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5472, __pyx_L1_error)
+          __PYX_ERR(0, 5467, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_16 * __pyx_v_row_inds.strides[0]) )) = (__pyx_v_i101->index + __pyx_v_offset);
 
-        /* "discretize/_extensions/tree_ext.pyx":5473
+        /* "discretize/_extensions/tree_ext.pyx":5468
  *                     row_inds[4] = i100.index + offset
  *                     row_inds[5] = i101.index + offset
  *                     row_inds[6] = i110.index + offset             # <<<<<<<<<<<<<<
  *                     row_inds[7] = i111.index + offset
  * 
  */
-        __Pyx_TraceLine(5473,0,__PYX_ERR(0, 5473, __pyx_L1_error))
+        __Pyx_TraceLine(5468,0,__PYX_ERR(0, 5468, __pyx_L1_error))
         __pyx_t_16 = 6;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_row_inds.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5473, __pyx_L1_error)
+          __PYX_ERR(0, 5468, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_16 * __pyx_v_row_inds.strides[0]) )) = (__pyx_v_i110->index + __pyx_v_offset);
 
-        /* "discretize/_extensions/tree_ext.pyx":5474
+        /* "discretize/_extensions/tree_ext.pyx":5469
  *                     row_inds[5] = i101.index + offset
  *                     row_inds[6] = i110.index + offset
  *                     row_inds[7] = i111.index + offset             # <<<<<<<<<<<<<<
  * 
  *         Re = self._deflate_edges()
  */
-        __Pyx_TraceLine(5474,0,__PYX_ERR(0, 5474, __pyx_L1_error))
+        __Pyx_TraceLine(5469,0,__PYX_ERR(0, 5469, __pyx_L1_error))
         __pyx_t_16 = 7;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_row_inds.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5474, __pyx_L1_error)
+          __PYX_ERR(0, 5469, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_16 * __pyx_v_row_inds.strides[0]) )) = (__pyx_v_i111->index + __pyx_v_offset);
 
-        /* "discretize/_extensions/tree_ext.pyx":5466
+        /* "discretize/_extensions/tree_ext.pyx":5461
  *                 row_inds[2] = i010.index + offset
  *                 row_inds[3] = i011.index + offset
  *                 if dim==3:             # <<<<<<<<<<<<<<
  *                     row_data[4] = w1 * w2 * (1 - w3)
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  */
       }
     }
     __pyx_L6:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5476
+  /* "discretize/_extensions/tree_ext.pyx":5471
  *                     row_inds[7] = i111.index + offset
  * 
  *         Re = self._deflate_edges()             # <<<<<<<<<<<<<<
  *         A = sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_edges))
  *         return A*Re
  */
-  __Pyx_TraceLine(5476,0,__PYX_ERR(0, 5476, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_edges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5476, __pyx_L1_error)
+  __Pyx_TraceLine(5471,0,__PYX_ERR(0, 5471, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_edges); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5471, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5476, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5471, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_Re = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5477
+  /* "discretize/_extensions/tree_ext.pyx":5472
  * 
  *         Re = self._deflate_edges()
  *         A = sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_edges))             # <<<<<<<<<<<<<<
  *         return A*Re
  * 
  */
-  __Pyx_TraceLine(5477,0,__PYX_ERR(0, 5477, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __Pyx_TraceLine(5472,0,__PYX_ERR(0, 5472, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_data, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_data, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_3);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_8);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_8);
   __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 5477, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5477, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5472, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_A = __pyx_t_7;
   __pyx_t_7 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5478
+  /* "discretize/_extensions/tree_ext.pyx":5473
  *         Re = self._deflate_edges()
  *         A = sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_edges))
  *         return A*Re             # <<<<<<<<<<<<<<
  * 
- *     def _getFaceIntMat(self, locs, zerosOutside, direction):
+ *     def _getFaceIntMat(self, locs, zeros_outside, direction):
  */
-  __Pyx_TraceLine(5478,0,__PYX_ERR(0, 5478, __pyx_L1_error))
+  __Pyx_TraceLine(5473,0,__PYX_ERR(0, 5473, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_7 = PyNumber_Multiply(__pyx_v_A, __pyx_v_Re); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5478, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_v_A, __pyx_v_Re); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5473, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_r = __pyx_t_7;
   __pyx_t_7 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5346
+  /* "discretize/_extensions/tree_ext.pyx":5341
  *         return Pxxx
  * 
- *     def _getEdgeIntMat(self, locs, zerosOutside, direction):             # <<<<<<<<<<<<<<
+ *     def _getEdgeIntMat(self, locs, zeros_outside, direction):             # <<<<<<<<<<<<<<
  *         cdef:
  *             double[:, :] locations = locs
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
@@ -67231,37 +67243,37 @@
   __Pyx_XDECREF(__pyx_v_A);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5480
+/* "discretize/_extensions/tree_ext.pyx":5475
  *         return A*Re
  * 
- *     def _getFaceIntMat(self, locs, zerosOutside, direction):             # <<<<<<<<<<<<<<
+ *     def _getFaceIntMat(self, locs, zeros_outside, direction):             # <<<<<<<<<<<<<<
  *         cdef:
  *             double[:, :] locations = locs
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_83_getFaceIntMat(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_82_getFaceIntMat[] = "_TreeMesh._getFaceIntMat(self, locs, zerosOutside, direction)";
+static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_82_getFaceIntMat[] = "_TreeMesh._getFaceIntMat(self, locs, zeros_outside, direction)";
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_83_getFaceIntMat(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_locs = 0;
-  PyObject *__pyx_v_zerosOutside = 0;
+  PyObject *__pyx_v_zeros_outside = 0;
   PyObject *__pyx_v_direction = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_getFaceIntMat (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_locs,&__pyx_n_s_zerosOutside,&__pyx_n_s_direction,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_locs,&__pyx_n_s_zeros_outside,&__pyx_n_s_direction,0};
     PyObject* values[3] = {0,0,0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
@@ -67275,55 +67287,55 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_locs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zerosOutside)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zeros_outside)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getFaceIntMat", 1, 3, 3, 1); __PYX_ERR(0, 5480, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getFaceIntMat", 1, 3, 3, 1); __PYX_ERR(0, 5475, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_direction)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getFaceIntMat", 1, 3, 3, 2); __PYX_ERR(0, 5480, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getFaceIntMat", 1, 3, 3, 2); __PYX_ERR(0, 5475, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getFaceIntMat") < 0)) __PYX_ERR(0, 5480, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getFaceIntMat") < 0)) __PYX_ERR(0, 5475, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 3) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
       values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
     }
     __pyx_v_locs = values[0];
-    __pyx_v_zerosOutside = values[1];
+    __pyx_v_zeros_outside = values[1];
     __pyx_v_direction = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_getFaceIntMat", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5480, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_getFaceIntMat", 1, 3, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5475, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getFaceIntMat", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_82_getFaceIntMat(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_locs, __pyx_v_zerosOutside, __pyx_v_direction);
+  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_82_getFaceIntMat(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_locs, __pyx_v_zeros_outside, __pyx_v_direction);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_82_getFaceIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zerosOutside, PyObject *__pyx_v_direction) {
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_82_getFaceIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zeros_outside, PyObject *__pyx_v_direction) {
   __Pyx_memviewslice __pyx_v_locations = { 0, 0, { 0 }, { 0 }, { 0 } };
   int_t __pyx_v_dir;
   int_t __pyx_v_dir1;
   int_t __pyx_v_dir2;
   int_t __pyx_v_temp;
   int_t __pyx_v_dim;
   int_t __pyx_v_n_loc;
@@ -67385,591 +67397,591 @@
   Py_ssize_t __pyx_t_19;
   Py_ssize_t __pyx_t_20;
   double __pyx_t_21;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getFaceIntMat", 0);
-  __Pyx_TraceCall("_getFaceIntMat", __pyx_f[0], 5480, 0, __PYX_ERR(0, 5480, __pyx_L1_error));
+  __Pyx_TraceCall("_getFaceIntMat", __pyx_f[0], 5475, 0, __PYX_ERR(0, 5475, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5482
- *     def _getFaceIntMat(self, locs, zerosOutside, direction):
+  /* "discretize/_extensions/tree_ext.pyx":5477
+ *     def _getFaceIntMat(self, locs, zeros_outside, direction):
  *         cdef:
  *             double[:, :] locations = locs             # <<<<<<<<<<<<<<
  *             int_t dir, dir1, dir2, temp
  *             int_t dim = self._dim
  */
-  __Pyx_TraceLine(5482,0,__PYX_ERR(0, 5482, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 5482, __pyx_L1_error)
+  __Pyx_TraceLine(5477,0,__PYX_ERR(0, 5477, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 5477, __pyx_L1_error)
   __pyx_v_locations = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5484
+  /* "discretize/_extensions/tree_ext.pyx":5479
  *             double[:, :] locations = locs
  *             int_t dir, dir1, dir2, temp
  *             int_t dim = self._dim             # <<<<<<<<<<<<<<
  *             int_t n_loc = locs.shape[0]
  *             int_t n_faces = 4 if dim == 2 else 8
  */
-  __Pyx_TraceLine(5484,0,__PYX_ERR(0, 5484, __pyx_L1_error))
+  __Pyx_TraceLine(5479,0,__PYX_ERR(0, 5479, __pyx_L1_error))
   __pyx_t_2 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5485
+  /* "discretize/_extensions/tree_ext.pyx":5480
  *             int_t dir, dir1, dir2, temp
  *             int_t dim = self._dim
  *             int_t n_loc = locs.shape[0]             # <<<<<<<<<<<<<<
  *             int_t n_faces = 4 if dim == 2 else 8
  *             np.int64_t[:] indptr = n_faces * np.arange(n_loc + 1, dtype=np.int64)
  */
-  __Pyx_TraceLine(5485,0,__PYX_ERR(0, 5485, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5485, __pyx_L1_error)
+  __Pyx_TraceLine(5480,0,__PYX_ERR(0, 5480, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5480, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5485, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5480, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_4); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5485, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_4); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5480, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_n_loc = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5486
+  /* "discretize/_extensions/tree_ext.pyx":5481
  *             int_t dim = self._dim
  *             int_t n_loc = locs.shape[0]
  *             int_t n_faces = 4 if dim == 2 else 8             # <<<<<<<<<<<<<<
  *             np.int64_t[:] indptr = n_faces * np.arange(n_loc + 1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_loc*n_faces, dtype=np.int64)
  */
-  __Pyx_TraceLine(5486,0,__PYX_ERR(0, 5486, __pyx_L1_error))
+  __Pyx_TraceLine(5481,0,__PYX_ERR(0, 5481, __pyx_L1_error))
   if (((__pyx_v_dim == 2) != 0)) {
     __pyx_t_2 = 4;
   } else {
     __pyx_t_2 = 8;
   }
   __pyx_v_n_faces = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5487
+  /* "discretize/_extensions/tree_ext.pyx":5482
  *             int_t n_loc = locs.shape[0]
  *             int_t n_faces = 4 if dim == 2 else 8
  *             np.int64_t[:] indptr = n_faces * np.arange(n_loc + 1, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.int64_t[:] indices = np.empty(n_loc*n_faces, dtype=np.int64)
  *             np.float64_t[:] data = np.empty(n_loc*n_faces, dtype=np.float64)
  */
-  __Pyx_TraceLine(5487,0,__PYX_ERR(0, 5487, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyInt_From_int_t(__pyx_v_n_faces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __Pyx_TraceLine(5482,0,__PYX_ERR(0, 5482, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyInt_From_int_t(__pyx_v_n_faces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_long((__pyx_v_n_loc + 1)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_long((__pyx_v_n_loc + 1)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 5487, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Multiply(__pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5487, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5482, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_indptr = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5488
+  /* "discretize/_extensions/tree_ext.pyx":5483
  *             int_t n_faces = 4 if dim == 2 else 8
  *             np.int64_t[:] indptr = n_faces * np.arange(n_loc + 1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_loc*n_faces, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.float64_t[:] data = np.empty(n_loc*n_faces, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(5488,0,__PYX_ERR(0, 5488, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __Pyx_TraceLine(5483,0,__PYX_ERR(0, 5483, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_faces)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_faces)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5488, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5488, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5483, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_indices = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5489
+  /* "discretize/_extensions/tree_ext.pyx":5484
  *             np.int64_t[:] indptr = n_faces * np.arange(n_loc + 1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_loc*n_faces, dtype=np.int64)
  *             np.float64_t[:] data = np.empty(n_loc*n_faces, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *             int_t ii, i, offset
  */
-  __Pyx_TraceLine(5489,0,__PYX_ERR(0, 5489, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __Pyx_TraceLine(5484,0,__PYX_ERR(0, 5484, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_faces)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_faces)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5489, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 5489, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 5484, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_data = __pyx_t_10;
   __pyx_t_10.memview = NULL;
   __pyx_t_10.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5498
+  /* "discretize/_extensions/tree_ext.pyx":5493
  *             double x, y, z
  *             double w1, w2, w3
  *             double eps = 100*np.finfo(float).eps             # <<<<<<<<<<<<<<
- *             int zeros_out = zerosOutside
+ *             int zeros_out = zeros_outside
  * 
  */
-  __Pyx_TraceLine(5498,0,__PYX_ERR(0, 5498, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5498, __pyx_L1_error)
+  __Pyx_TraceLine(5493,0,__PYX_ERR(0, 5493, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5493, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_finfo); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5498, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_finfo); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5493, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, ((PyObject *)(&PyFloat_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_4, ((PyObject *)(&PyFloat_Type)));
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5498, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5493, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_eps); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5498, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_eps); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5493, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Multiply(__pyx_int_100, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5498, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Multiply(__pyx_int_100, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5493, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5498, __pyx_L1_error)
+  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5493, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_eps = __pyx_t_11;
 
-  /* "discretize/_extensions/tree_ext.pyx":5499
+  /* "discretize/_extensions/tree_ext.pyx":5494
  *             double w1, w2, w3
  *             double eps = 100*np.finfo(float).eps
- *             int zeros_out = zerosOutside             # <<<<<<<<<<<<<<
+ *             int zeros_out = zeros_outside             # <<<<<<<<<<<<<<
  * 
  *         if direction == 'x':
  */
-  __Pyx_TraceLine(5499,0,__PYX_ERR(0, 5499, __pyx_L1_error))
-  __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_zerosOutside); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5499, __pyx_L1_error)
+  __Pyx_TraceLine(5494,0,__PYX_ERR(0, 5494, __pyx_L1_error))
+  __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_zeros_outside); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5494, __pyx_L1_error)
   __pyx_v_zeros_out = __pyx_t_12;
 
-  /* "discretize/_extensions/tree_ext.pyx":5501
- *             int zeros_out = zerosOutside
+  /* "discretize/_extensions/tree_ext.pyx":5496
+ *             int zeros_out = zeros_outside
  * 
  *         if direction == 'x':             # <<<<<<<<<<<<<<
  *             dir = 0
  *             dir1 = 1
  */
-  __Pyx_TraceLine(5501,0,__PYX_ERR(0, 5501, __pyx_L1_error))
-  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_x, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5501, __pyx_L1_error)
+  __Pyx_TraceLine(5496,0,__PYX_ERR(0, 5496, __pyx_L1_error))
+  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_x, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5496, __pyx_L1_error)
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5502
+    /* "discretize/_extensions/tree_ext.pyx":5497
  * 
  *         if direction == 'x':
  *             dir = 0             # <<<<<<<<<<<<<<
  *             dir1 = 1
  *             dir2 = 2
  */
-    __Pyx_TraceLine(5502,0,__PYX_ERR(0, 5502, __pyx_L1_error))
+    __Pyx_TraceLine(5497,0,__PYX_ERR(0, 5497, __pyx_L1_error))
     __pyx_v_dir = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5503
+    /* "discretize/_extensions/tree_ext.pyx":5498
  *         if direction == 'x':
  *             dir = 0
  *             dir1 = 1             # <<<<<<<<<<<<<<
  *             dir2 = 2
  *             offset = 0
  */
-    __Pyx_TraceLine(5503,0,__PYX_ERR(0, 5503, __pyx_L1_error))
+    __Pyx_TraceLine(5498,0,__PYX_ERR(0, 5498, __pyx_L1_error))
     __pyx_v_dir1 = 1;
 
-    /* "discretize/_extensions/tree_ext.pyx":5504
+    /* "discretize/_extensions/tree_ext.pyx":5499
  *             dir = 0
  *             dir1 = 1
  *             dir2 = 2             # <<<<<<<<<<<<<<
  *             offset = 0
  *         elif direction == 'y':
  */
-    __Pyx_TraceLine(5504,0,__PYX_ERR(0, 5504, __pyx_L1_error))
+    __Pyx_TraceLine(5499,0,__PYX_ERR(0, 5499, __pyx_L1_error))
     __pyx_v_dir2 = 2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5505
+    /* "discretize/_extensions/tree_ext.pyx":5500
  *             dir1 = 1
  *             dir2 = 2
  *             offset = 0             # <<<<<<<<<<<<<<
  *         elif direction == 'y':
  *             dir = 1
  */
-    __Pyx_TraceLine(5505,0,__PYX_ERR(0, 5505, __pyx_L1_error))
+    __Pyx_TraceLine(5500,0,__PYX_ERR(0, 5500, __pyx_L1_error))
     __pyx_v_offset = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5501
- *             int zeros_out = zerosOutside
+    /* "discretize/_extensions/tree_ext.pyx":5496
+ *             int zeros_out = zeros_outside
  * 
  *         if direction == 'x':             # <<<<<<<<<<<<<<
  *             dir = 0
  *             dir1 = 1
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5506
+  /* "discretize/_extensions/tree_ext.pyx":5501
  *             dir2 = 2
  *             offset = 0
  *         elif direction == 'y':             # <<<<<<<<<<<<<<
  *             dir = 1
  *             dir1 = 0
  */
-  __Pyx_TraceLine(5506,0,__PYX_ERR(0, 5506, __pyx_L1_error))
-  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_y, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5506, __pyx_L1_error)
+  __Pyx_TraceLine(5501,0,__PYX_ERR(0, 5501, __pyx_L1_error))
+  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_y, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5501, __pyx_L1_error)
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5507
+    /* "discretize/_extensions/tree_ext.pyx":5502
  *             offset = 0
  *         elif direction == 'y':
  *             dir = 1             # <<<<<<<<<<<<<<
  *             dir1 = 0
  *             dir2 = 2
  */
-    __Pyx_TraceLine(5507,0,__PYX_ERR(0, 5507, __pyx_L1_error))
+    __Pyx_TraceLine(5502,0,__PYX_ERR(0, 5502, __pyx_L1_error))
     __pyx_v_dir = 1;
 
-    /* "discretize/_extensions/tree_ext.pyx":5508
+    /* "discretize/_extensions/tree_ext.pyx":5503
  *         elif direction == 'y':
  *             dir = 1
  *             dir1 = 0             # <<<<<<<<<<<<<<
  *             dir2 = 2
  *             offset = self.n_total_faces_x
  */
-    __Pyx_TraceLine(5508,0,__PYX_ERR(0, 5508, __pyx_L1_error))
+    __Pyx_TraceLine(5503,0,__PYX_ERR(0, 5503, __pyx_L1_error))
     __pyx_v_dir1 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5509
+    /* "discretize/_extensions/tree_ext.pyx":5504
  *             dir = 1
  *             dir1 = 0
  *             dir2 = 2             # <<<<<<<<<<<<<<
  *             offset = self.n_total_faces_x
  *         elif direction == 'z':
  */
-    __Pyx_TraceLine(5509,0,__PYX_ERR(0, 5509, __pyx_L1_error))
+    __Pyx_TraceLine(5504,0,__PYX_ERR(0, 5504, __pyx_L1_error))
     __pyx_v_dir2 = 2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5510
+    /* "discretize/_extensions/tree_ext.pyx":5505
  *             dir1 = 0
  *             dir2 = 2
  *             offset = self.n_total_faces_x             # <<<<<<<<<<<<<<
  *         elif direction == 'z':
  *             dir = 2
  */
-    __Pyx_TraceLine(5510,0,__PYX_ERR(0, 5510, __pyx_L1_error))
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5510, __pyx_L1_error)
+    __Pyx_TraceLine(5505,0,__PYX_ERR(0, 5505, __pyx_L1_error))
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5505, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_6); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5510, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_6); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5505, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_v_offset = __pyx_t_2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5506
+    /* "discretize/_extensions/tree_ext.pyx":5501
  *             dir2 = 2
  *             offset = 0
  *         elif direction == 'y':             # <<<<<<<<<<<<<<
  *             dir = 1
  *             dir1 = 0
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5511
+  /* "discretize/_extensions/tree_ext.pyx":5506
  *             dir2 = 2
  *             offset = self.n_total_faces_x
  *         elif direction == 'z':             # <<<<<<<<<<<<<<
  *             dir = 2
  *             dir1 = 0
  */
-  __Pyx_TraceLine(5511,0,__PYX_ERR(0, 5511, __pyx_L1_error))
-  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_z, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5511, __pyx_L1_error)
+  __Pyx_TraceLine(5506,0,__PYX_ERR(0, 5506, __pyx_L1_error))
+  __pyx_t_13 = (__Pyx_PyUnicode_Equals(__pyx_v_direction, __pyx_n_u_z, Py_EQ)); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 5506, __pyx_L1_error)
   if (likely(__pyx_t_13)) {
 
-    /* "discretize/_extensions/tree_ext.pyx":5512
+    /* "discretize/_extensions/tree_ext.pyx":5507
  *             offset = self.n_total_faces_x
  *         elif direction == 'z':
  *             dir = 2             # <<<<<<<<<<<<<<
  *             dir1 = 0
  *             dir2 = 1
  */
-    __Pyx_TraceLine(5512,0,__PYX_ERR(0, 5512, __pyx_L1_error))
+    __Pyx_TraceLine(5507,0,__PYX_ERR(0, 5507, __pyx_L1_error))
     __pyx_v_dir = 2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5513
+    /* "discretize/_extensions/tree_ext.pyx":5508
  *         elif direction == 'z':
  *             dir = 2
  *             dir1 = 0             # <<<<<<<<<<<<<<
  *             dir2 = 1
  *             offset = self.n_total_faces_x + self.n_total_faces_y
  */
-    __Pyx_TraceLine(5513,0,__PYX_ERR(0, 5513, __pyx_L1_error))
+    __Pyx_TraceLine(5508,0,__PYX_ERR(0, 5508, __pyx_L1_error))
     __pyx_v_dir1 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5514
+    /* "discretize/_extensions/tree_ext.pyx":5509
  *             dir = 2
  *             dir1 = 0
  *             dir2 = 1             # <<<<<<<<<<<<<<
  *             offset = self.n_total_faces_x + self.n_total_faces_y
  *         else:
  */
-    __Pyx_TraceLine(5514,0,__PYX_ERR(0, 5514, __pyx_L1_error))
+    __Pyx_TraceLine(5509,0,__PYX_ERR(0, 5509, __pyx_L1_error))
     __pyx_v_dir2 = 1;
 
-    /* "discretize/_extensions/tree_ext.pyx":5515
+    /* "discretize/_extensions/tree_ext.pyx":5510
  *             dir1 = 0
  *             dir2 = 1
  *             offset = self.n_total_faces_x + self.n_total_faces_y             # <<<<<<<<<<<<<<
  *         else:
  *             raise ValueError('Invalid direction, must be x, y, or z')
  */
-    __Pyx_TraceLine(5515,0,__PYX_ERR(0, 5515, __pyx_L1_error))
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5515, __pyx_L1_error)
+    __Pyx_TraceLine(5510,0,__PYX_ERR(0, 5510, __pyx_L1_error))
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5510, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5515, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces_y); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5510, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyNumber_Add(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5515, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_Add(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5510, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5515, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5510, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_v_offset = __pyx_t_2;
 
-    /* "discretize/_extensions/tree_ext.pyx":5511
+    /* "discretize/_extensions/tree_ext.pyx":5506
  *             dir2 = 2
  *             offset = self.n_total_faces_x
  *         elif direction == 'z':             # <<<<<<<<<<<<<<
  *             dir = 2
  *             dir1 = 0
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5517
+  /* "discretize/_extensions/tree_ext.pyx":5512
  *             offset = self.n_total_faces_x + self.n_total_faces_y
  *         else:
  *             raise ValueError('Invalid direction, must be x, y, or z')             # <<<<<<<<<<<<<<
  * 
  *         for i in range(n_loc):
  */
-  __Pyx_TraceLine(5517,0,__PYX_ERR(0, 5517, __pyx_L1_error))
+  __Pyx_TraceLine(5512,0,__PYX_ERR(0, 5512, __pyx_L1_error))
   /*else*/ {
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5517, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5512, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_Raise(__pyx_t_5, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 5517, __pyx_L1_error)
+    __PYX_ERR(0, 5512, __pyx_L1_error)
   }
   __pyx_L3:;
 
-  /* "discretize/_extensions/tree_ext.pyx":5519
+  /* "discretize/_extensions/tree_ext.pyx":5514
  *             raise ValueError('Invalid direction, must be x, y, or z')
  * 
  *         for i in range(n_loc):             # <<<<<<<<<<<<<<
  *             x = locations[i, 0]
  *             y = locations[i, 1]
  */
-  __Pyx_TraceLine(5519,0,__PYX_ERR(0, 5519, __pyx_L1_error))
+  __Pyx_TraceLine(5514,0,__PYX_ERR(0, 5514, __pyx_L1_error))
   __pyx_t_2 = __pyx_v_n_loc;
   __pyx_t_14 = __pyx_t_2;
   for (__pyx_t_15 = 0; __pyx_t_15 < __pyx_t_14; __pyx_t_15+=1) {
     __pyx_v_i = __pyx_t_15;
 
-    /* "discretize/_extensions/tree_ext.pyx":5520
+    /* "discretize/_extensions/tree_ext.pyx":5515
  * 
  *         for i in range(n_loc):
  *             x = locations[i, 0]             # <<<<<<<<<<<<<<
  *             y = locations[i, 1]
  *             z = locations[i, 2] if dim==3 else 0.0
  */
-    __Pyx_TraceLine(5520,0,__PYX_ERR(0, 5520, __pyx_L1_error))
+    __Pyx_TraceLine(5515,0,__PYX_ERR(0, 5515, __pyx_L1_error))
     __pyx_t_16 = __pyx_v_i;
     __pyx_t_17 = 0;
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_locations.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_locations.shape[1];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 1;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5520, __pyx_L1_error)
+      __PYX_ERR(0, 5515, __pyx_L1_error)
     }
     __pyx_v_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_17 * __pyx_v_locations.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5521
+    /* "discretize/_extensions/tree_ext.pyx":5516
  *         for i in range(n_loc):
  *             x = locations[i, 0]
  *             y = locations[i, 1]             # <<<<<<<<<<<<<<
  *             z = locations[i, 2] if dim==3 else 0.0
  *             #get containing (or closest) cell
  */
-    __Pyx_TraceLine(5521,0,__PYX_ERR(0, 5521, __pyx_L1_error))
+    __Pyx_TraceLine(5516,0,__PYX_ERR(0, 5516, __pyx_L1_error))
     __pyx_t_17 = __pyx_v_i;
     __pyx_t_16 = 1;
     __pyx_t_12 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_locations.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_locations.shape[1];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5521, __pyx_L1_error)
+      __PYX_ERR(0, 5516, __pyx_L1_error)
     }
     __pyx_v_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_17 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5522
+    /* "discretize/_extensions/tree_ext.pyx":5517
  *             x = locations[i, 0]
  *             y = locations[i, 1]
  *             z = locations[i, 2] if dim==3 else 0.0             # <<<<<<<<<<<<<<
  *             #get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)
  */
-    __Pyx_TraceLine(5522,0,__PYX_ERR(0, 5522, __pyx_L1_error))
+    __Pyx_TraceLine(5517,0,__PYX_ERR(0, 5517, __pyx_L1_error))
     if (((__pyx_v_dim == 3) != 0)) {
       __pyx_t_16 = __pyx_v_i;
       __pyx_t_17 = 2;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_17 < 0) {
         __pyx_t_17 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5522, __pyx_L1_error)
+        __PYX_ERR(0, 5517, __pyx_L1_error)
       }
       __pyx_t_11 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_17 * __pyx_v_locations.strides[1]) )));
     } else {
       __pyx_t_11 = 0.0;
     }
     __pyx_v_z = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":5524
+    /* "discretize/_extensions/tree_ext.pyx":5519
  *             z = locations[i, 2] if dim==3 else 0.0
  *             #get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)             # <<<<<<<<<<<<<<
  *             row_inds = indices[indptr[i]:indptr[i+1]]
  *             row_data = data[indptr[i]:indptr[i+1]]
  */
-    __Pyx_TraceLine(5524,0,__PYX_ERR(0, 5524, __pyx_L1_error))
+    __Pyx_TraceLine(5519,0,__PYX_ERR(0, 5519, __pyx_L1_error))
     __pyx_v_cell = __pyx_v_self->tree->containing_cell(__pyx_v_x, __pyx_v_y, __pyx_v_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":5525
+    /* "discretize/_extensions/tree_ext.pyx":5520
  *             #get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)
  *             row_inds = indices[indptr[i]:indptr[i+1]]             # <<<<<<<<<<<<<<
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:
  */
-    __Pyx_TraceLine(5525,0,__PYX_ERR(0, 5525, __pyx_L1_error))
+    __Pyx_TraceLine(5520,0,__PYX_ERR(0, 5520, __pyx_L1_error))
     __pyx_t_17 = __pyx_v_i;
     __pyx_t_12 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5525, __pyx_L1_error)
+      __PYX_ERR(0, 5520, __pyx_L1_error)
     }
     __pyx_t_16 = (__pyx_v_i + 1);
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5525, __pyx_L1_error)
+      __PYX_ERR(0, 5520, __pyx_L1_error)
     }
     __pyx_t_9.data = __pyx_v_indices.data;
     __pyx_t_9.memview = __pyx_v_indices.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_9, 0);
     __pyx_t_12 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_9,
@@ -67981,52 +67993,52 @@
     (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_16 * __pyx_v_indptr.strides[0]) ))),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 5525, __pyx_L1_error)
+    __PYX_ERR(0, 5520, __pyx_L1_error)
 }
 
-__pyx_t_5 = __pyx_memoryview_fromslice(__pyx_t_9, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5525, __pyx_L1_error)
+__pyx_t_5 = __pyx_memoryview_fromslice(__pyx_t_9, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5520, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __PYX_XDEC_MEMVIEW(&__pyx_t_9, 1);
     __pyx_t_9.memview = NULL;
     __pyx_t_9.data = NULL;
     __Pyx_XDECREF_SET(__pyx_v_row_inds, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5526
+    /* "discretize/_extensions/tree_ext.pyx":5521
  *             cell = self.tree.containing_cell(x, y, z)
  *             row_inds = indices[indptr[i]:indptr[i+1]]
  *             row_data = data[indptr[i]:indptr[i+1]]             # <<<<<<<<<<<<<<
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:
  */
-    __Pyx_TraceLine(5526,0,__PYX_ERR(0, 5526, __pyx_L1_error))
+    __Pyx_TraceLine(5521,0,__PYX_ERR(0, 5521, __pyx_L1_error))
     __pyx_t_16 = __pyx_v_i;
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5526, __pyx_L1_error)
+      __PYX_ERR(0, 5521, __pyx_L1_error)
     }
     __pyx_t_17 = (__pyx_v_i + 1);
     __pyx_t_12 = -1;
     if (__pyx_t_17 < 0) {
       __pyx_t_17 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_17 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5526, __pyx_L1_error)
+      __PYX_ERR(0, 5521, __pyx_L1_error)
     }
     __pyx_t_10.data = __pyx_v_data.data;
     __pyx_t_10.memview = __pyx_v_data.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_10, 0);
     __pyx_t_12 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_10,
@@ -68038,1995 +68050,1995 @@
     (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_17 * __pyx_v_indptr.strides[0]) ))),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 5526, __pyx_L1_error)
+    __PYX_ERR(0, 5521, __pyx_L1_error)
 }
 
-__pyx_t_5 = __pyx_memoryview_fromslice(__pyx_t_10, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5526, __pyx_L1_error)
+__pyx_t_5 = __pyx_memoryview_fromslice(__pyx_t_10, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5521, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __PYX_XDEC_MEMVIEW(&__pyx_t_10, 1);
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
     __Pyx_XDECREF_SET(__pyx_v_row_data, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":5527
+    /* "discretize/_extensions/tree_ext.pyx":5522
  *             row_inds = indices[indptr[i]:indptr[i+1]]
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:             # <<<<<<<<<<<<<<
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  */
-    __Pyx_TraceLine(5527,0,__PYX_ERR(0, 5527, __pyx_L1_error))
+    __Pyx_TraceLine(5522,0,__PYX_ERR(0, 5522, __pyx_L1_error))
     __pyx_t_13 = (__pyx_v_zeros_out != 0);
     if (__pyx_t_13) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5528
+      /* "discretize/_extensions/tree_ext.pyx":5523
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5528,0,__PYX_ERR(0, 5528, __pyx_L1_error))
+      __Pyx_TraceLine(5523,0,__PYX_ERR(0, 5523, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_x < (((__pyx_v_cell->points[0])->location[0]) - __pyx_v_eps)) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5529
+        /* "discretize/_extensions/tree_ext.pyx":5524
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:
  */
-        __Pyx_TraceLine(5529,0,__PYX_ERR(0, 5529, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5529, __pyx_L1_error)
+        __Pyx_TraceLine(5524,0,__PYX_ERR(0, 5524, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5524, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5530
+        /* "discretize/_extensions/tree_ext.pyx":5525
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5530,0,__PYX_ERR(0, 5530, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5530, __pyx_L1_error)
+        __Pyx_TraceLine(5525,0,__PYX_ERR(0, 5525, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5525, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5528
+        /* "discretize/_extensions/tree_ext.pyx":5523
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5531
+      /* "discretize/_extensions/tree_ext.pyx":5526
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5531,0,__PYX_ERR(0, 5531, __pyx_L1_error))
+      __Pyx_TraceLine(5526,0,__PYX_ERR(0, 5526, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_x > (((__pyx_v_cell->points[3])->location[0]) + __pyx_v_eps)) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5532
+        /* "discretize/_extensions/tree_ext.pyx":5527
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:
  */
-        __Pyx_TraceLine(5532,0,__PYX_ERR(0, 5532, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5532, __pyx_L1_error)
+        __Pyx_TraceLine(5527,0,__PYX_ERR(0, 5527, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5527, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5533
+        /* "discretize/_extensions/tree_ext.pyx":5528
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5533,0,__PYX_ERR(0, 5533, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5533, __pyx_L1_error)
+        __Pyx_TraceLine(5528,0,__PYX_ERR(0, 5528, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5528, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5531
+        /* "discretize/_extensions/tree_ext.pyx":5526
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5534
+      /* "discretize/_extensions/tree_ext.pyx":5529
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5534,0,__PYX_ERR(0, 5534, __pyx_L1_error))
+      __Pyx_TraceLine(5529,0,__PYX_ERR(0, 5529, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_y < (((__pyx_v_cell->points[0])->location[1]) - __pyx_v_eps)) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5535
+        /* "discretize/_extensions/tree_ext.pyx":5530
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:
  */
-        __Pyx_TraceLine(5535,0,__PYX_ERR(0, 5535, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5535, __pyx_L1_error)
+        __Pyx_TraceLine(5530,0,__PYX_ERR(0, 5530, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5530, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5536
+        /* "discretize/_extensions/tree_ext.pyx":5531
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5536,0,__PYX_ERR(0, 5536, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5536, __pyx_L1_error)
+        __Pyx_TraceLine(5531,0,__PYX_ERR(0, 5531, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5531, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5534
+        /* "discretize/_extensions/tree_ext.pyx":5529
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5537
+      /* "discretize/_extensions/tree_ext.pyx":5532
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5537,0,__PYX_ERR(0, 5537, __pyx_L1_error))
+      __Pyx_TraceLine(5532,0,__PYX_ERR(0, 5532, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_y > (((__pyx_v_cell->points[3])->location[1]) + __pyx_v_eps)) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5538
+        /* "discretize/_extensions/tree_ext.pyx":5533
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  */
-        __Pyx_TraceLine(5538,0,__PYX_ERR(0, 5538, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5538, __pyx_L1_error)
+        __Pyx_TraceLine(5533,0,__PYX_ERR(0, 5533, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5533, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5539
+        /* "discretize/_extensions/tree_ext.pyx":5534
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5539,0,__PYX_ERR(0, 5539, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5539, __pyx_L1_error)
+        __Pyx_TraceLine(5534,0,__PYX_ERR(0, 5534, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5534, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5537
+        /* "discretize/_extensions/tree_ext.pyx":5532
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5540
+      /* "discretize/_extensions/tree_ext.pyx":5535
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5540,0,__PYX_ERR(0, 5540, __pyx_L1_error))
+      __Pyx_TraceLine(5535,0,__PYX_ERR(0, 5535, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L8_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_z < (((__pyx_v_cell->points[0])->location[2]) - __pyx_v_eps)) != 0);
       __pyx_t_13 = __pyx_t_18;
       __pyx_L8_bool_binop_done:;
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5541
+        /* "discretize/_extensions/tree_ext.pyx":5536
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  */
-        __Pyx_TraceLine(5541,0,__PYX_ERR(0, 5541, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5541, __pyx_L1_error)
+        __Pyx_TraceLine(5536,0,__PYX_ERR(0, 5536, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5536, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5542
+        /* "discretize/_extensions/tree_ext.pyx":5537
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5542,0,__PYX_ERR(0, 5542, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5542, __pyx_L1_error)
+        __Pyx_TraceLine(5537,0,__PYX_ERR(0, 5537, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5537, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5540
+        /* "discretize/_extensions/tree_ext.pyx":5535
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L7;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5543
+      /* "discretize/_extensions/tree_ext.pyx":5538
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5543,0,__PYX_ERR(0, 5543, __pyx_L1_error))
+      __Pyx_TraceLine(5538,0,__PYX_ERR(0, 5538, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L10_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_z > (((__pyx_v_cell->points[7])->location[2]) + __pyx_v_eps)) != 0);
       __pyx_t_13 = __pyx_t_18;
       __pyx_L10_bool_binop_done:;
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5544
+        /* "discretize/_extensions/tree_ext.pyx":5539
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *             else:
  */
-        __Pyx_TraceLine(5544,0,__PYX_ERR(0, 5544, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5544, __pyx_L1_error)
+        __Pyx_TraceLine(5539,0,__PYX_ERR(0, 5539, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_data, __pyx_float_0_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5539, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5545
+        /* "discretize/_extensions/tree_ext.pyx":5540
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *             else:
  *               # Find containing cells
  */
-        __Pyx_TraceLine(5545,0,__PYX_ERR(0, 5545, __pyx_L1_error))
-        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5545, __pyx_L1_error)
+        __Pyx_TraceLine(5540,0,__PYX_ERR(0, 5540, __pyx_L1_error))
+        if (__Pyx_PyObject_SetSlice(__pyx_v_row_inds, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 5540, __pyx_L1_error)
 
-        /* "discretize/_extensions/tree_ext.pyx":5543
+        /* "discretize/_extensions/tree_ext.pyx":5538
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
       }
       __pyx_L7:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5527
+      /* "discretize/_extensions/tree_ext.pyx":5522
  *             row_inds = indices[indptr[i]:indptr[i+1]]
  *             row_data = data[indptr[i]:indptr[i+1]]
  *             if zeros_out:             # <<<<<<<<<<<<<<
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  */
       goto __pyx_L6;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5549
+    /* "discretize/_extensions/tree_ext.pyx":5544
  *               # Find containing cells
  *               # Decide order to search based on which face it is closest to
  *               if dim == 3:             # <<<<<<<<<<<<<<
  *                   if (
  *                       abs(locations[i, dir1] - cell.location[dir1]) <
  */
-    __Pyx_TraceLine(5549,0,__PYX_ERR(0, 5549, __pyx_L1_error))
+    __Pyx_TraceLine(5544,0,__PYX_ERR(0, 5544, __pyx_L1_error))
     /*else*/ {
       __pyx_t_13 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5551
+        /* "discretize/_extensions/tree_ext.pyx":5546
  *               if dim == 3:
  *                   if (
  *                       abs(locations[i, dir1] - cell.location[dir1]) <             # <<<<<<<<<<<<<<
  *                       abs(locations[i, dir2] - cell.location[dir2])
  *                   ):
  */
-        __Pyx_TraceLine(5551,0,__PYX_ERR(0, 5551, __pyx_L1_error))
+        __Pyx_TraceLine(5546,0,__PYX_ERR(0, 5546, __pyx_L1_error))
         __pyx_t_17 = __pyx_v_i;
         __pyx_t_16 = __pyx_v_dir1;
         __pyx_t_12 = -1;
         if (__pyx_t_17 < 0) {
           __pyx_t_17 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_17 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_17 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5551, __pyx_L1_error)
+          __PYX_ERR(0, 5546, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5552
+        /* "discretize/_extensions/tree_ext.pyx":5547
  *                   if (
  *                       abs(locations[i, dir1] - cell.location[dir1]) <
  *                       abs(locations[i, dir2] - cell.location[dir2])             # <<<<<<<<<<<<<<
  *                   ):
  *                     temp = dir1
  */
-        __Pyx_TraceLine(5552,0,__PYX_ERR(0, 5552, __pyx_L1_error))
+        __Pyx_TraceLine(5547,0,__PYX_ERR(0, 5547, __pyx_L1_error))
         __pyx_t_19 = __pyx_v_i;
         __pyx_t_20 = __pyx_v_dir2;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5552, __pyx_L1_error)
+          __PYX_ERR(0, 5547, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5551
+        /* "discretize/_extensions/tree_ext.pyx":5546
  *               if dim == 3:
  *                   if (
  *                       abs(locations[i, dir1] - cell.location[dir1]) <             # <<<<<<<<<<<<<<
  *                       abs(locations[i, dir2] - cell.location[dir2])
  *                   ):
  */
-        __Pyx_TraceLine(5551,0,__PYX_ERR(0, 5551, __pyx_L1_error))
+        __Pyx_TraceLine(5546,0,__PYX_ERR(0, 5546, __pyx_L1_error))
         __pyx_t_13 = ((fabs(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_17 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) ))) - (__pyx_v_cell->location[__pyx_v_dir1]))) < fabs(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))) - (__pyx_v_cell->location[__pyx_v_dir2])))) != 0);
 
-        /* "discretize/_extensions/tree_ext.pyx":5550
+        /* "discretize/_extensions/tree_ext.pyx":5545
  *               # Decide order to search based on which face it is closest to
  *               if dim == 3:
  *                   if (             # <<<<<<<<<<<<<<
  *                       abs(locations[i, dir1] - cell.location[dir1]) <
  *                       abs(locations[i, dir2] - cell.location[dir2])
  */
-        __Pyx_TraceLine(5550,0,__PYX_ERR(0, 5550, __pyx_L1_error))
+        __Pyx_TraceLine(5545,0,__PYX_ERR(0, 5545, __pyx_L1_error))
         if (__pyx_t_13) {
 
-          /* "discretize/_extensions/tree_ext.pyx":5554
+          /* "discretize/_extensions/tree_ext.pyx":5549
  *                       abs(locations[i, dir2] - cell.location[dir2])
  *                   ):
  *                     temp = dir1             # <<<<<<<<<<<<<<
  *                     dir1 = dir2
  *                     dir2 = temp
  */
-          __Pyx_TraceLine(5554,0,__PYX_ERR(0, 5554, __pyx_L1_error))
+          __Pyx_TraceLine(5549,0,__PYX_ERR(0, 5549, __pyx_L1_error))
           __pyx_v_temp = __pyx_v_dir1;
 
-          /* "discretize/_extensions/tree_ext.pyx":5555
+          /* "discretize/_extensions/tree_ext.pyx":5550
  *                   ):
  *                     temp = dir1
  *                     dir1 = dir2             # <<<<<<<<<<<<<<
  *                     dir2 = temp
  *               # look in dir1 direction
  */
-          __Pyx_TraceLine(5555,0,__PYX_ERR(0, 5555, __pyx_L1_error))
+          __Pyx_TraceLine(5550,0,__PYX_ERR(0, 5550, __pyx_L1_error))
           __pyx_v_dir1 = __pyx_v_dir2;
 
-          /* "discretize/_extensions/tree_ext.pyx":5556
+          /* "discretize/_extensions/tree_ext.pyx":5551
  *                     temp = dir1
  *                     dir1 = dir2
  *                     dir2 = temp             # <<<<<<<<<<<<<<
  *               # look in dir1 direction
  *               if (
  */
-          __Pyx_TraceLine(5556,0,__PYX_ERR(0, 5556, __pyx_L1_error))
+          __Pyx_TraceLine(5551,0,__PYX_ERR(0, 5551, __pyx_L1_error))
           __pyx_v_dir2 = __pyx_v_temp;
 
-          /* "discretize/_extensions/tree_ext.pyx":5550
+          /* "discretize/_extensions/tree_ext.pyx":5545
  *               # Decide order to search based on which face it is closest to
  *               if dim == 3:
  *                   if (             # <<<<<<<<<<<<<<
  *                       abs(locations[i, dir1] - cell.location[dir1]) <
  *                       abs(locations[i, dir2] - cell.location[dir2])
  */
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5549
+        /* "discretize/_extensions/tree_ext.pyx":5544
  *               # Find containing cells
  *               # Decide order to search based on which face it is closest to
  *               if dim == 3:             # <<<<<<<<<<<<<<
  *                   if (
  *                       abs(locations[i, dir1] - cell.location[dir1]) <
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5559
+      /* "discretize/_extensions/tree_ext.pyx":5554
  *               # look in dir1 direction
  *               if (
  *                   locations[i, dir1] < cell.location[dir1]             # <<<<<<<<<<<<<<
  *                   and cell.neighbors[2*dir1] != NULL
  *                   and cell.neighbors[2*dir1].is_leaf()
  */
-      __Pyx_TraceLine(5559,0,__PYX_ERR(0, 5559, __pyx_L1_error))
+      __Pyx_TraceLine(5554,0,__PYX_ERR(0, 5554, __pyx_L1_error))
       __pyx_t_20 = __pyx_v_i;
       __pyx_t_19 = __pyx_v_dir1;
       __pyx_t_12 = -1;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5559, __pyx_L1_error)
+        __PYX_ERR(0, 5554, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))) < (__pyx_v_cell->location[__pyx_v_dir1])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L15_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5560
+      /* "discretize/_extensions/tree_ext.pyx":5555
  *               if (
  *                   locations[i, dir1] < cell.location[dir1]
  *                   and cell.neighbors[2*dir1] != NULL             # <<<<<<<<<<<<<<
  *                   and cell.neighbors[2*dir1].is_leaf()
  *                   and cell.neighbors[2*dir1].level == cell.level
  */
-      __Pyx_TraceLine(5560,0,__PYX_ERR(0, 5560, __pyx_L1_error))
+      __Pyx_TraceLine(5555,0,__PYX_ERR(0, 5555, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[(2 * __pyx_v_dir1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L15_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5561
+      /* "discretize/_extensions/tree_ext.pyx":5556
  *                   locations[i, dir1] < cell.location[dir1]
  *                   and cell.neighbors[2*dir1] != NULL
  *                   and cell.neighbors[2*dir1].is_leaf()             # <<<<<<<<<<<<<<
  *                   and cell.neighbors[2*dir1].level == cell.level
  *               ):
  */
-      __Pyx_TraceLine(5561,0,__PYX_ERR(0, 5561, __pyx_L1_error))
+      __Pyx_TraceLine(5556,0,__PYX_ERR(0, 5556, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_cell->neighbors[(2 * __pyx_v_dir1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L15_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5562
+      /* "discretize/_extensions/tree_ext.pyx":5557
  *                   and cell.neighbors[2*dir1] != NULL
  *                   and cell.neighbors[2*dir1].is_leaf()
  *                   and cell.neighbors[2*dir1].level == cell.level             # <<<<<<<<<<<<<<
  *               ):
  *                   i00 = cell.neighbors[2*dir1]
  */
-      __Pyx_TraceLine(5562,0,__PYX_ERR(0, 5562, __pyx_L1_error))
+      __Pyx_TraceLine(5557,0,__PYX_ERR(0, 5557, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[(2 * __pyx_v_dir1)])->level == __pyx_v_cell->level) != 0);
       __pyx_t_13 = __pyx_t_18;
       __pyx_L15_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5558
+      /* "discretize/_extensions/tree_ext.pyx":5553
  *                     dir2 = temp
  *               # look in dir1 direction
  *               if (             # <<<<<<<<<<<<<<
  *                   locations[i, dir1] < cell.location[dir1]
  *                   and cell.neighbors[2*dir1] != NULL
  */
-      __Pyx_TraceLine(5558,0,__PYX_ERR(0, 5558, __pyx_L1_error))
+      __Pyx_TraceLine(5553,0,__PYX_ERR(0, 5553, __pyx_L1_error))
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5564
+        /* "discretize/_extensions/tree_ext.pyx":5559
  *                   and cell.neighbors[2*dir1].level == cell.level
  *               ):
  *                   i00 = cell.neighbors[2*dir1]             # <<<<<<<<<<<<<<
  *                   i01 = cell
  *               elif (
  */
-        __Pyx_TraceLine(5564,0,__PYX_ERR(0, 5564, __pyx_L1_error))
+        __Pyx_TraceLine(5559,0,__PYX_ERR(0, 5559, __pyx_L1_error))
         __pyx_v_i00 = (__pyx_v_cell->neighbors[(2 * __pyx_v_dir1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5565
+        /* "discretize/_extensions/tree_ext.pyx":5560
  *               ):
  *                   i00 = cell.neighbors[2*dir1]
  *                   i01 = cell             # <<<<<<<<<<<<<<
  *               elif (
  *                   locations[i, dir1] > cell.location[dir1]
  */
-        __Pyx_TraceLine(5565,0,__PYX_ERR(0, 5565, __pyx_L1_error))
+        __Pyx_TraceLine(5560,0,__PYX_ERR(0, 5560, __pyx_L1_error))
         __pyx_v_i01 = __pyx_v_cell;
 
-        /* "discretize/_extensions/tree_ext.pyx":5558
+        /* "discretize/_extensions/tree_ext.pyx":5553
  *                     dir2 = temp
  *               # look in dir1 direction
  *               if (             # <<<<<<<<<<<<<<
  *                   locations[i, dir1] < cell.location[dir1]
  *                   and cell.neighbors[2*dir1] != NULL
  */
         goto __pyx_L14;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5567
+      /* "discretize/_extensions/tree_ext.pyx":5562
  *                   i01 = cell
  *               elif (
  *                   locations[i, dir1] > cell.location[dir1]             # <<<<<<<<<<<<<<
  *                   and cell.neighbors[2*dir1 + 1] != NULL
  *                   and cell.neighbors[2*dir1 + 1].is_leaf()
  */
-      __Pyx_TraceLine(5567,0,__PYX_ERR(0, 5567, __pyx_L1_error))
+      __Pyx_TraceLine(5562,0,__PYX_ERR(0, 5562, __pyx_L1_error))
       __pyx_t_19 = __pyx_v_i;
       __pyx_t_20 = __pyx_v_dir1;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5567, __pyx_L1_error)
+        __PYX_ERR(0, 5562, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))) > (__pyx_v_cell->location[__pyx_v_dir1])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L19_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5568
+      /* "discretize/_extensions/tree_ext.pyx":5563
  *               elif (
  *                   locations[i, dir1] > cell.location[dir1]
  *                   and cell.neighbors[2*dir1 + 1] != NULL             # <<<<<<<<<<<<<<
  *                   and cell.neighbors[2*dir1 + 1].is_leaf()
  *                   and cell.neighbors[2*dir1 + 1].level == cell.level
  */
-      __Pyx_TraceLine(5568,0,__PYX_ERR(0, 5568, __pyx_L1_error))
+      __Pyx_TraceLine(5563,0,__PYX_ERR(0, 5563, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[((2 * __pyx_v_dir1) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L19_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5569
+      /* "discretize/_extensions/tree_ext.pyx":5564
  *                   locations[i, dir1] > cell.location[dir1]
  *                   and cell.neighbors[2*dir1 + 1] != NULL
  *                   and cell.neighbors[2*dir1 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                   and cell.neighbors[2*dir1 + 1].level == cell.level
  *               ):
  */
-      __Pyx_TraceLine(5569,0,__PYX_ERR(0, 5569, __pyx_L1_error))
+      __Pyx_TraceLine(5564,0,__PYX_ERR(0, 5564, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_cell->neighbors[((2 * __pyx_v_dir1) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_13 = __pyx_t_18;
         goto __pyx_L19_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5570
+      /* "discretize/_extensions/tree_ext.pyx":5565
  *                   and cell.neighbors[2*dir1 + 1] != NULL
  *                   and cell.neighbors[2*dir1 + 1].is_leaf()
  *                   and cell.neighbors[2*dir1 + 1].level == cell.level             # <<<<<<<<<<<<<<
  *               ):
  *                   i00 = cell
  */
-      __Pyx_TraceLine(5570,0,__PYX_ERR(0, 5570, __pyx_L1_error))
+      __Pyx_TraceLine(5565,0,__PYX_ERR(0, 5565, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[((2 * __pyx_v_dir1) + 1)])->level == __pyx_v_cell->level) != 0);
       __pyx_t_13 = __pyx_t_18;
       __pyx_L19_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5566
+      /* "discretize/_extensions/tree_ext.pyx":5561
  *                   i00 = cell.neighbors[2*dir1]
  *                   i01 = cell
  *               elif (             # <<<<<<<<<<<<<<
  *                   locations[i, dir1] > cell.location[dir1]
  *                   and cell.neighbors[2*dir1 + 1] != NULL
  */
-      __Pyx_TraceLine(5566,0,__PYX_ERR(0, 5566, __pyx_L1_error))
+      __Pyx_TraceLine(5561,0,__PYX_ERR(0, 5561, __pyx_L1_error))
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5572
+        /* "discretize/_extensions/tree_ext.pyx":5567
  *                   and cell.neighbors[2*dir1 + 1].level == cell.level
  *               ):
  *                   i00 = cell             # <<<<<<<<<<<<<<
  *                   i01 = cell.neighbors[2*dir1 + 1]
  *               else:
  */
-        __Pyx_TraceLine(5572,0,__PYX_ERR(0, 5572, __pyx_L1_error))
+        __Pyx_TraceLine(5567,0,__PYX_ERR(0, 5567, __pyx_L1_error))
         __pyx_v_i00 = __pyx_v_cell;
 
-        /* "discretize/_extensions/tree_ext.pyx":5573
+        /* "discretize/_extensions/tree_ext.pyx":5568
  *               ):
  *                   i00 = cell
  *                   i01 = cell.neighbors[2*dir1 + 1]             # <<<<<<<<<<<<<<
  *               else:
  *                   i00 = i01 = cell
  */
-        __Pyx_TraceLine(5573,0,__PYX_ERR(0, 5573, __pyx_L1_error))
+        __Pyx_TraceLine(5568,0,__PYX_ERR(0, 5568, __pyx_L1_error))
         __pyx_v_i01 = (__pyx_v_cell->neighbors[((2 * __pyx_v_dir1) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5566
+        /* "discretize/_extensions/tree_ext.pyx":5561
  *                   i00 = cell.neighbors[2*dir1]
  *                   i01 = cell
  *               elif (             # <<<<<<<<<<<<<<
  *                   locations[i, dir1] > cell.location[dir1]
  *                   and cell.neighbors[2*dir1 + 1] != NULL
  */
         goto __pyx_L14;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5575
+      /* "discretize/_extensions/tree_ext.pyx":5570
  *                   i01 = cell.neighbors[2*dir1 + 1]
  *               else:
  *                   i00 = i01 = cell             # <<<<<<<<<<<<<<
  * 
  *               if dim == 2:
  */
-      __Pyx_TraceLine(5575,0,__PYX_ERR(0, 5575, __pyx_L1_error))
+      __Pyx_TraceLine(5570,0,__PYX_ERR(0, 5570, __pyx_L1_error))
       /*else*/ {
         __pyx_v_i00 = __pyx_v_cell;
         __pyx_v_i01 = __pyx_v_cell;
       }
       __pyx_L14:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5577
+      /* "discretize/_extensions/tree_ext.pyx":5572
  *                   i00 = i01 = cell
  * 
  *               if dim == 2:             # <<<<<<<<<<<<<<
  *                   e00 = i00.edges[2 * dir1]
  *                   e01 = i00.edges[2 * dir1 + 1]
  */
-      __Pyx_TraceLine(5577,0,__PYX_ERR(0, 5577, __pyx_L1_error))
+      __Pyx_TraceLine(5572,0,__PYX_ERR(0, 5572, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_dim == 2) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5578
+        /* "discretize/_extensions/tree_ext.pyx":5573
  * 
  *               if dim == 2:
  *                   e00 = i00.edges[2 * dir1]             # <<<<<<<<<<<<<<
  *                   e01 = i00.edges[2 * dir1 + 1]
  *                   e10 = i01.edges[2 * dir1]
  */
-        __Pyx_TraceLine(5578,0,__PYX_ERR(0, 5578, __pyx_L1_error))
+        __Pyx_TraceLine(5573,0,__PYX_ERR(0, 5573, __pyx_L1_error))
         __pyx_v_e00 = (__pyx_v_i00->edges[(2 * __pyx_v_dir1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5579
+        /* "discretize/_extensions/tree_ext.pyx":5574
  *               if dim == 2:
  *                   e00 = i00.edges[2 * dir1]
  *                   e01 = i00.edges[2 * dir1 + 1]             # <<<<<<<<<<<<<<
  *                   e10 = i01.edges[2 * dir1]
  *                   e11 = i01.edges[2 * dir1 + 1]
  */
-        __Pyx_TraceLine(5579,0,__PYX_ERR(0, 5579, __pyx_L1_error))
+        __Pyx_TraceLine(5574,0,__PYX_ERR(0, 5574, __pyx_L1_error))
         __pyx_v_e01 = (__pyx_v_i00->edges[((2 * __pyx_v_dir1) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5580
+        /* "discretize/_extensions/tree_ext.pyx":5575
  *                   e00 = i00.edges[2 * dir1]
  *                   e01 = i00.edges[2 * dir1 + 1]
  *                   e10 = i01.edges[2 * dir1]             # <<<<<<<<<<<<<<
  *                   e11 = i01.edges[2 * dir1 + 1]
  *                   w1 = ((e01.location[dir] - locations[i, dir])/
  */
-        __Pyx_TraceLine(5580,0,__PYX_ERR(0, 5580, __pyx_L1_error))
+        __Pyx_TraceLine(5575,0,__PYX_ERR(0, 5575, __pyx_L1_error))
         __pyx_v_e10 = (__pyx_v_i01->edges[(2 * __pyx_v_dir1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5581
+        /* "discretize/_extensions/tree_ext.pyx":5576
  *                   e01 = i00.edges[2 * dir1 + 1]
  *                   e10 = i01.edges[2 * dir1]
  *                   e11 = i01.edges[2 * dir1 + 1]             # <<<<<<<<<<<<<<
  *                   w1 = ((e01.location[dir] - locations[i, dir])/
  *                         (e01.location[dir] - e00.location[dir]))
  */
-        __Pyx_TraceLine(5581,0,__PYX_ERR(0, 5581, __pyx_L1_error))
+        __Pyx_TraceLine(5576,0,__PYX_ERR(0, 5576, __pyx_L1_error))
         __pyx_v_e11 = (__pyx_v_i01->edges[((2 * __pyx_v_dir1) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5582
+        /* "discretize/_extensions/tree_ext.pyx":5577
  *                   e10 = i01.edges[2 * dir1]
  *                   e11 = i01.edges[2 * dir1 + 1]
  *                   w1 = ((e01.location[dir] - locations[i, dir])/             # <<<<<<<<<<<<<<
  *                         (e01.location[dir] - e00.location[dir]))
  *                   if i00.index != i01.index:
  */
-        __Pyx_TraceLine(5582,0,__PYX_ERR(0, 5582, __pyx_L1_error))
+        __Pyx_TraceLine(5577,0,__PYX_ERR(0, 5577, __pyx_L1_error))
         __pyx_t_20 = __pyx_v_i;
         __pyx_t_19 = __pyx_v_dir;
         __pyx_t_12 = -1;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5582, __pyx_L1_error)
+          __PYX_ERR(0, 5577, __pyx_L1_error)
         }
         __pyx_t_11 = ((__pyx_v_e01->location[__pyx_v_dir]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))));
 
-        /* "discretize/_extensions/tree_ext.pyx":5583
+        /* "discretize/_extensions/tree_ext.pyx":5578
  *                   e11 = i01.edges[2 * dir1 + 1]
  *                   w1 = ((e01.location[dir] - locations[i, dir])/
  *                         (e01.location[dir] - e00.location[dir]))             # <<<<<<<<<<<<<<
  *                   if i00.index != i01.index:
  *                       w2 = ((e10.location[dir1] - locations[i, dir1])/
  */
-        __Pyx_TraceLine(5583,0,__PYX_ERR(0, 5583, __pyx_L1_error))
+        __Pyx_TraceLine(5578,0,__PYX_ERR(0, 5578, __pyx_L1_error))
         __pyx_t_21 = ((__pyx_v_e01->location[__pyx_v_dir]) - (__pyx_v_e00->location[__pyx_v_dir]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5582
+        /* "discretize/_extensions/tree_ext.pyx":5577
  *                   e10 = i01.edges[2 * dir1]
  *                   e11 = i01.edges[2 * dir1 + 1]
  *                   w1 = ((e01.location[dir] - locations[i, dir])/             # <<<<<<<<<<<<<<
  *                         (e01.location[dir] - e00.location[dir]))
  *                   if i00.index != i01.index:
  */
-        __Pyx_TraceLine(5582,0,__PYX_ERR(0, 5582, __pyx_L1_error))
+        __Pyx_TraceLine(5577,0,__PYX_ERR(0, 5577, __pyx_L1_error))
         if (unlikely(__pyx_t_21 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5582, __pyx_L1_error)
+          __PYX_ERR(0, 5577, __pyx_L1_error)
         }
         __pyx_v_w1 = (__pyx_t_11 / __pyx_t_21);
 
-        /* "discretize/_extensions/tree_ext.pyx":5584
+        /* "discretize/_extensions/tree_ext.pyx":5579
  *                   w1 = ((e01.location[dir] - locations[i, dir])/
  *                         (e01.location[dir] - e00.location[dir]))
  *                   if i00.index != i01.index:             # <<<<<<<<<<<<<<
  *                       w2 = ((e10.location[dir1] - locations[i, dir1])/
  *                             (e10.location[dir1] - e00.location[dir1]))
  */
-        __Pyx_TraceLine(5584,0,__PYX_ERR(0, 5584, __pyx_L1_error))
+        __Pyx_TraceLine(5579,0,__PYX_ERR(0, 5579, __pyx_L1_error))
         __pyx_t_13 = ((__pyx_v_i00->index != __pyx_v_i01->index) != 0);
         if (__pyx_t_13) {
 
-          /* "discretize/_extensions/tree_ext.pyx":5585
+          /* "discretize/_extensions/tree_ext.pyx":5580
  *                         (e01.location[dir] - e00.location[dir]))
  *                   if i00.index != i01.index:
  *                       w2 = ((e10.location[dir1] - locations[i, dir1])/             # <<<<<<<<<<<<<<
  *                             (e10.location[dir1] - e00.location[dir1]))
  *                   else:
  */
-          __Pyx_TraceLine(5585,0,__PYX_ERR(0, 5585, __pyx_L1_error))
+          __Pyx_TraceLine(5580,0,__PYX_ERR(0, 5580, __pyx_L1_error))
           __pyx_t_19 = __pyx_v_i;
           __pyx_t_20 = __pyx_v_dir1;
           __pyx_t_12 = -1;
           if (__pyx_t_19 < 0) {
             __pyx_t_19 += __pyx_v_locations.shape[0];
             if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
           } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
           if (__pyx_t_20 < 0) {
             __pyx_t_20 += __pyx_v_locations.shape[1];
             if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
           } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
           if (unlikely(__pyx_t_12 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_12);
-            __PYX_ERR(0, 5585, __pyx_L1_error)
+            __PYX_ERR(0, 5580, __pyx_L1_error)
           }
           __pyx_t_21 = ((__pyx_v_e10->location[__pyx_v_dir1]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))));
 
-          /* "discretize/_extensions/tree_ext.pyx":5586
+          /* "discretize/_extensions/tree_ext.pyx":5581
  *                   if i00.index != i01.index:
  *                       w2 = ((e10.location[dir1] - locations[i, dir1])/
  *                             (e10.location[dir1] - e00.location[dir1]))             # <<<<<<<<<<<<<<
  *                   else:
  *                       w2 = 1.0
  */
-          __Pyx_TraceLine(5586,0,__PYX_ERR(0, 5586, __pyx_L1_error))
+          __Pyx_TraceLine(5581,0,__PYX_ERR(0, 5581, __pyx_L1_error))
           __pyx_t_11 = ((__pyx_v_e10->location[__pyx_v_dir1]) - (__pyx_v_e00->location[__pyx_v_dir1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":5585
+          /* "discretize/_extensions/tree_ext.pyx":5580
  *                         (e01.location[dir] - e00.location[dir]))
  *                   if i00.index != i01.index:
  *                       w2 = ((e10.location[dir1] - locations[i, dir1])/             # <<<<<<<<<<<<<<
  *                             (e10.location[dir1] - e00.location[dir1]))
  *                   else:
  */
-          __Pyx_TraceLine(5585,0,__PYX_ERR(0, 5585, __pyx_L1_error))
+          __Pyx_TraceLine(5580,0,__PYX_ERR(0, 5580, __pyx_L1_error))
           if (unlikely(__pyx_t_11 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 5585, __pyx_L1_error)
+            __PYX_ERR(0, 5580, __pyx_L1_error)
           }
           __pyx_v_w2 = (__pyx_t_21 / __pyx_t_11);
 
-          /* "discretize/_extensions/tree_ext.pyx":5584
+          /* "discretize/_extensions/tree_ext.pyx":5579
  *                   w1 = ((e01.location[dir] - locations[i, dir])/
  *                         (e01.location[dir] - e00.location[dir]))
  *                   if i00.index != i01.index:             # <<<<<<<<<<<<<<
  *                       w2 = ((e10.location[dir1] - locations[i, dir1])/
  *                             (e10.location[dir1] - e00.location[dir1]))
  */
           goto __pyx_L24;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5588
+        /* "discretize/_extensions/tree_ext.pyx":5583
  *                             (e10.location[dir1] - e00.location[dir1]))
  *                   else:
  *                       w2 = 1.0             # <<<<<<<<<<<<<<
  * 
  *                   w1 = _clip01(w1)
  */
-        __Pyx_TraceLine(5588,0,__PYX_ERR(0, 5588, __pyx_L1_error))
+        __Pyx_TraceLine(5583,0,__PYX_ERR(0, 5583, __pyx_L1_error))
         /*else*/ {
           __pyx_v_w2 = 1.0;
         }
         __pyx_L24:;
 
-        /* "discretize/_extensions/tree_ext.pyx":5590
+        /* "discretize/_extensions/tree_ext.pyx":5585
  *                       w2 = 1.0
  * 
  *                   w1 = _clip01(w1)             # <<<<<<<<<<<<<<
  *                   w2 = _clip01(w2)
  *                   row_data[0] = w1 * w2
  */
-        __Pyx_TraceLine(5590,0,__PYX_ERR(0, 5590, __pyx_L1_error))
+        __Pyx_TraceLine(5585,0,__PYX_ERR(0, 5585, __pyx_L1_error))
         __pyx_v_w1 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w1);
 
-        /* "discretize/_extensions/tree_ext.pyx":5591
+        /* "discretize/_extensions/tree_ext.pyx":5586
  * 
  *                   w1 = _clip01(w1)
  *                   w2 = _clip01(w2)             # <<<<<<<<<<<<<<
  *                   row_data[0] = w1 * w2
  *                   row_data[1] = (1 - w1) * w2
  */
-        __Pyx_TraceLine(5591,0,__PYX_ERR(0, 5591, __pyx_L1_error))
+        __Pyx_TraceLine(5586,0,__PYX_ERR(0, 5586, __pyx_L1_error))
         __pyx_v_w2 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w2);
 
-        /* "discretize/_extensions/tree_ext.pyx":5592
+        /* "discretize/_extensions/tree_ext.pyx":5587
  *                   w1 = _clip01(w1)
  *                   w2 = _clip01(w2)
  *                   row_data[0] = w1 * w2             # <<<<<<<<<<<<<<
  *                   row_data[1] = (1 - w1) * w2
  *                   row_data[2] = w1 * (1 - w2)
  */
-        __Pyx_TraceLine(5592,0,__PYX_ERR(0, 5592, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble((__pyx_v_w1 * __pyx_v_w2)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5592, __pyx_L1_error)
+        __Pyx_TraceLine(5587,0,__PYX_ERR(0, 5587, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble((__pyx_v_w1 * __pyx_v_w2)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5587, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5592, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5587, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5593
+        /* "discretize/_extensions/tree_ext.pyx":5588
  *                   w2 = _clip01(w2)
  *                   row_data[0] = w1 * w2
  *                   row_data[1] = (1 - w1) * w2             # <<<<<<<<<<<<<<
  *                   row_data[2] = w1 * (1 - w2)
  *                   row_data[3] = (1 - w1) * (1 - w2)
  */
-        __Pyx_TraceLine(5593,0,__PYX_ERR(0, 5593, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * __pyx_v_w2)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5593, __pyx_L1_error)
+        __Pyx_TraceLine(5588,0,__PYX_ERR(0, 5588, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * __pyx_v_w2)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5588, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5593, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5588, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5594
+        /* "discretize/_extensions/tree_ext.pyx":5589
  *                   row_data[0] = w1 * w2
  *                   row_data[1] = (1 - w1) * w2
  *                   row_data[2] = w1 * (1 - w2)             # <<<<<<<<<<<<<<
  *                   row_data[3] = (1 - w1) * (1 - w2)
  *                   row_inds[0] = e00.index + offset
  */
-        __Pyx_TraceLine(5594,0,__PYX_ERR(0, 5594, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble((__pyx_v_w1 * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5594, __pyx_L1_error)
+        __Pyx_TraceLine(5589,0,__PYX_ERR(0, 5589, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble((__pyx_v_w1 * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5589, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 2, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5594, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 2, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5589, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5595
+        /* "discretize/_extensions/tree_ext.pyx":5590
  *                   row_data[1] = (1 - w1) * w2
  *                   row_data[2] = w1 * (1 - w2)
  *                   row_data[3] = (1 - w1) * (1 - w2)             # <<<<<<<<<<<<<<
  *                   row_inds[0] = e00.index + offset
  *                   row_inds[1] = e01.index + offset
  */
-        __Pyx_TraceLine(5595,0,__PYX_ERR(0, 5595, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5595, __pyx_L1_error)
+        __Pyx_TraceLine(5590,0,__PYX_ERR(0, 5590, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5590, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 3, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5595, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 3, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5590, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5596
+        /* "discretize/_extensions/tree_ext.pyx":5591
  *                   row_data[2] = w1 * (1 - w2)
  *                   row_data[3] = (1 - w1) * (1 - w2)
  *                   row_inds[0] = e00.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[1] = e01.index + offset
  *                   row_inds[2] = e10.index + offset
  */
-        __Pyx_TraceLine(5596,0,__PYX_ERR(0, 5596, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_e00->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5596, __pyx_L1_error)
+        __Pyx_TraceLine(5591,0,__PYX_ERR(0, 5591, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_e00->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5591, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5596, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5591, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5597
+        /* "discretize/_extensions/tree_ext.pyx":5592
  *                   row_data[3] = (1 - w1) * (1 - w2)
  *                   row_inds[0] = e00.index + offset
  *                   row_inds[1] = e01.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[2] = e10.index + offset
  *                   row_inds[3] = e11.index + offset
  */
-        __Pyx_TraceLine(5597,0,__PYX_ERR(0, 5597, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_e01->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5597, __pyx_L1_error)
+        __Pyx_TraceLine(5592,0,__PYX_ERR(0, 5592, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_e01->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5592, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5597, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5592, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5598
+        /* "discretize/_extensions/tree_ext.pyx":5593
  *                   row_inds[0] = e00.index + offset
  *                   row_inds[1] = e01.index + offset
  *                   row_inds[2] = e10.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[3] = e11.index + offset
  *               else:
  */
-        __Pyx_TraceLine(5598,0,__PYX_ERR(0, 5598, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_e10->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5598, __pyx_L1_error)
+        __Pyx_TraceLine(5593,0,__PYX_ERR(0, 5593, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_e10->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5593, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 2, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5598, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 2, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5593, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5599
+        /* "discretize/_extensions/tree_ext.pyx":5594
  *                   row_inds[1] = e01.index + offset
  *                   row_inds[2] = e10.index + offset
  *                   row_inds[3] = e11.index + offset             # <<<<<<<<<<<<<<
  *               else:
  *                   # Look dir2 from previous two cells
  */
-        __Pyx_TraceLine(5599,0,__PYX_ERR(0, 5599, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_e11->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5599, __pyx_L1_error)
+        __Pyx_TraceLine(5594,0,__PYX_ERR(0, 5594, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_e11->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5594, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 3, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5599, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 3, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5594, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5577
+        /* "discretize/_extensions/tree_ext.pyx":5572
  *                   i00 = i01 = cell
  * 
  *               if dim == 2:             # <<<<<<<<<<<<<<
  *                   e00 = i00.edges[2 * dir1]
  *                   e01 = i00.edges[2 * dir1 + 1]
  */
         goto __pyx_L23;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5602
+      /* "discretize/_extensions/tree_ext.pyx":5597
  *               else:
  *                   # Look dir2 from previous two cells
  *                   if (             # <<<<<<<<<<<<<<
  *                       locations[i, dir2] < cell.location[dir2]
  *                       and i00.neighbors[2*dir2] != NULL
  */
-      __Pyx_TraceLine(5602,0,__PYX_ERR(0, 5602, __pyx_L1_error))
+      __Pyx_TraceLine(5597,0,__PYX_ERR(0, 5597, __pyx_L1_error))
       /*else*/ {
 
-        /* "discretize/_extensions/tree_ext.pyx":5603
+        /* "discretize/_extensions/tree_ext.pyx":5598
  *                   # Look dir2 from previous two cells
  *                   if (
  *                       locations[i, dir2] < cell.location[dir2]             # <<<<<<<<<<<<<<
  *                       and i00.neighbors[2*dir2] != NULL
  *                       and i01.neighbors[2*dir2] != NULL
  */
-        __Pyx_TraceLine(5603,0,__PYX_ERR(0, 5603, __pyx_L1_error))
+        __Pyx_TraceLine(5598,0,__PYX_ERR(0, 5598, __pyx_L1_error))
         __pyx_t_20 = __pyx_v_i;
         __pyx_t_19 = __pyx_v_dir2;
         __pyx_t_12 = -1;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5603, __pyx_L1_error)
+          __PYX_ERR(0, 5598, __pyx_L1_error)
         }
         __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))) < (__pyx_v_cell->location[__pyx_v_dir2])) != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L26_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5604
+        /* "discretize/_extensions/tree_ext.pyx":5599
  *                   if (
  *                       locations[i, dir2] < cell.location[dir2]
  *                       and i00.neighbors[2*dir2] != NULL             # <<<<<<<<<<<<<<
  *                       and i01.neighbors[2*dir2] != NULL
  *                       and i00.neighbors[2*dir2].is_leaf()
  */
-        __Pyx_TraceLine(5604,0,__PYX_ERR(0, 5604, __pyx_L1_error))
+        __Pyx_TraceLine(5599,0,__PYX_ERR(0, 5599, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_i00->neighbors[(2 * __pyx_v_dir2)]) != NULL) != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L26_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5605
+        /* "discretize/_extensions/tree_ext.pyx":5600
  *                       locations[i, dir2] < cell.location[dir2]
  *                       and i00.neighbors[2*dir2] != NULL
  *                       and i01.neighbors[2*dir2] != NULL             # <<<<<<<<<<<<<<
  *                       and i00.neighbors[2*dir2].is_leaf()
  *                       and i01.neighbors[2*dir2].is_leaf()
  */
-        __Pyx_TraceLine(5605,0,__PYX_ERR(0, 5605, __pyx_L1_error))
+        __Pyx_TraceLine(5600,0,__PYX_ERR(0, 5600, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_i01->neighbors[(2 * __pyx_v_dir2)]) != NULL) != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L26_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5606
+        /* "discretize/_extensions/tree_ext.pyx":5601
  *                       and i00.neighbors[2*dir2] != NULL
  *                       and i01.neighbors[2*dir2] != NULL
  *                       and i00.neighbors[2*dir2].is_leaf()             # <<<<<<<<<<<<<<
  *                       and i01.neighbors[2*dir2].is_leaf()
  *                       and i00.neighbors[2*dir2].level == i00.level
  */
-        __Pyx_TraceLine(5606,0,__PYX_ERR(0, 5606, __pyx_L1_error))
+        __Pyx_TraceLine(5601,0,__PYX_ERR(0, 5601, __pyx_L1_error))
         __pyx_t_18 = ((__pyx_v_i00->neighbors[(2 * __pyx_v_dir2)])->is_leaf() != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L26_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5607
+        /* "discretize/_extensions/tree_ext.pyx":5602
  *                       and i01.neighbors[2*dir2] != NULL
  *                       and i00.neighbors[2*dir2].is_leaf()
  *                       and i01.neighbors[2*dir2].is_leaf()             # <<<<<<<<<<<<<<
  *                       and i00.neighbors[2*dir2].level == i00.level
  *                       and i01.neighbors[2*dir2].level == i01.level
  */
-        __Pyx_TraceLine(5607,0,__PYX_ERR(0, 5607, __pyx_L1_error))
+        __Pyx_TraceLine(5602,0,__PYX_ERR(0, 5602, __pyx_L1_error))
         __pyx_t_18 = ((__pyx_v_i01->neighbors[(2 * __pyx_v_dir2)])->is_leaf() != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L26_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5608
+        /* "discretize/_extensions/tree_ext.pyx":5603
  *                       and i00.neighbors[2*dir2].is_leaf()
  *                       and i01.neighbors[2*dir2].is_leaf()
  *                       and i00.neighbors[2*dir2].level == i00.level             # <<<<<<<<<<<<<<
  *                       and i01.neighbors[2*dir2].level == i01.level
  *                   ):
  */
-        __Pyx_TraceLine(5608,0,__PYX_ERR(0, 5608, __pyx_L1_error))
+        __Pyx_TraceLine(5603,0,__PYX_ERR(0, 5603, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_i00->neighbors[(2 * __pyx_v_dir2)])->level == __pyx_v_i00->level) != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L26_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5609
+        /* "discretize/_extensions/tree_ext.pyx":5604
  *                       and i01.neighbors[2*dir2].is_leaf()
  *                       and i00.neighbors[2*dir2].level == i00.level
  *                       and i01.neighbors[2*dir2].level == i01.level             # <<<<<<<<<<<<<<
  *                   ):
  *                       i10 = i00
  */
-        __Pyx_TraceLine(5609,0,__PYX_ERR(0, 5609, __pyx_L1_error))
+        __Pyx_TraceLine(5604,0,__PYX_ERR(0, 5604, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_i01->neighbors[(2 * __pyx_v_dir2)])->level == __pyx_v_i01->level) != 0);
         __pyx_t_13 = __pyx_t_18;
         __pyx_L26_bool_binop_done:;
 
-        /* "discretize/_extensions/tree_ext.pyx":5602
+        /* "discretize/_extensions/tree_ext.pyx":5597
  *               else:
  *                   # Look dir2 from previous two cells
  *                   if (             # <<<<<<<<<<<<<<
  *                       locations[i, dir2] < cell.location[dir2]
  *                       and i00.neighbors[2*dir2] != NULL
  */
-        __Pyx_TraceLine(5602,0,__PYX_ERR(0, 5602, __pyx_L1_error))
+        __Pyx_TraceLine(5597,0,__PYX_ERR(0, 5597, __pyx_L1_error))
         if (__pyx_t_13) {
 
-          /* "discretize/_extensions/tree_ext.pyx":5611
+          /* "discretize/_extensions/tree_ext.pyx":5606
  *                       and i01.neighbors[2*dir2].level == i01.level
  *                   ):
  *                       i10 = i00             # <<<<<<<<<<<<<<
  *                       i11 = i01
  *                       i00 = i00.neighbors[2*dir2]
  */
-          __Pyx_TraceLine(5611,0,__PYX_ERR(0, 5611, __pyx_L1_error))
+          __Pyx_TraceLine(5606,0,__PYX_ERR(0, 5606, __pyx_L1_error))
           __pyx_v_i10 = __pyx_v_i00;
 
-          /* "discretize/_extensions/tree_ext.pyx":5612
+          /* "discretize/_extensions/tree_ext.pyx":5607
  *                   ):
  *                       i10 = i00
  *                       i11 = i01             # <<<<<<<<<<<<<<
  *                       i00 = i00.neighbors[2*dir2]
  *                       i01 = i01.neighbors[2*dir2]
  */
-          __Pyx_TraceLine(5612,0,__PYX_ERR(0, 5612, __pyx_L1_error))
+          __Pyx_TraceLine(5607,0,__PYX_ERR(0, 5607, __pyx_L1_error))
           __pyx_v_i11 = __pyx_v_i01;
 
-          /* "discretize/_extensions/tree_ext.pyx":5613
+          /* "discretize/_extensions/tree_ext.pyx":5608
  *                       i10 = i00
  *                       i11 = i01
  *                       i00 = i00.neighbors[2*dir2]             # <<<<<<<<<<<<<<
  *                       i01 = i01.neighbors[2*dir2]
  *                   elif (
  */
-          __Pyx_TraceLine(5613,0,__PYX_ERR(0, 5613, __pyx_L1_error))
+          __Pyx_TraceLine(5608,0,__PYX_ERR(0, 5608, __pyx_L1_error))
           __pyx_v_i00 = (__pyx_v_i00->neighbors[(2 * __pyx_v_dir2)]);
 
-          /* "discretize/_extensions/tree_ext.pyx":5614
+          /* "discretize/_extensions/tree_ext.pyx":5609
  *                       i11 = i01
  *                       i00 = i00.neighbors[2*dir2]
  *                       i01 = i01.neighbors[2*dir2]             # <<<<<<<<<<<<<<
  *                   elif (
  *                       locations[i, dir2] > cell.location[dir2]
  */
-          __Pyx_TraceLine(5614,0,__PYX_ERR(0, 5614, __pyx_L1_error))
+          __Pyx_TraceLine(5609,0,__PYX_ERR(0, 5609, __pyx_L1_error))
           __pyx_v_i01 = (__pyx_v_i01->neighbors[(2 * __pyx_v_dir2)]);
 
-          /* "discretize/_extensions/tree_ext.pyx":5602
+          /* "discretize/_extensions/tree_ext.pyx":5597
  *               else:
  *                   # Look dir2 from previous two cells
  *                   if (             # <<<<<<<<<<<<<<
  *                       locations[i, dir2] < cell.location[dir2]
  *                       and i00.neighbors[2*dir2] != NULL
  */
           goto __pyx_L25;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5616
+        /* "discretize/_extensions/tree_ext.pyx":5611
  *                       i01 = i01.neighbors[2*dir2]
  *                   elif (
  *                       locations[i, dir2] > cell.location[dir2]             # <<<<<<<<<<<<<<
  *                       and i00.neighbors[2*dir2 + 1] != NULL
  *                       and i01.neighbors[2*dir2 + 1] != NULL
  */
-        __Pyx_TraceLine(5616,0,__PYX_ERR(0, 5616, __pyx_L1_error))
+        __Pyx_TraceLine(5611,0,__PYX_ERR(0, 5611, __pyx_L1_error))
         __pyx_t_19 = __pyx_v_i;
         __pyx_t_20 = __pyx_v_dir2;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5616, __pyx_L1_error)
+          __PYX_ERR(0, 5611, __pyx_L1_error)
         }
         __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))) > (__pyx_v_cell->location[__pyx_v_dir2])) != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L33_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5617
+        /* "discretize/_extensions/tree_ext.pyx":5612
  *                   elif (
  *                       locations[i, dir2] > cell.location[dir2]
  *                       and i00.neighbors[2*dir2 + 1] != NULL             # <<<<<<<<<<<<<<
  *                       and i01.neighbors[2*dir2 + 1] != NULL
  *                       and i00.neighbors[2*dir2 + 1].is_leaf()
  */
-        __Pyx_TraceLine(5617,0,__PYX_ERR(0, 5617, __pyx_L1_error))
+        __Pyx_TraceLine(5612,0,__PYX_ERR(0, 5612, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_i00->neighbors[((2 * __pyx_v_dir2) + 1)]) != NULL) != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L33_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5618
+        /* "discretize/_extensions/tree_ext.pyx":5613
  *                       locations[i, dir2] > cell.location[dir2]
  *                       and i00.neighbors[2*dir2 + 1] != NULL
  *                       and i01.neighbors[2*dir2 + 1] != NULL             # <<<<<<<<<<<<<<
  *                       and i00.neighbors[2*dir2 + 1].is_leaf()
  *                       and i01.neighbors[2*dir2 + 1].is_leaf()
  */
-        __Pyx_TraceLine(5618,0,__PYX_ERR(0, 5618, __pyx_L1_error))
+        __Pyx_TraceLine(5613,0,__PYX_ERR(0, 5613, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_i01->neighbors[((2 * __pyx_v_dir2) + 1)]) != NULL) != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L33_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5619
+        /* "discretize/_extensions/tree_ext.pyx":5614
  *                       and i00.neighbors[2*dir2 + 1] != NULL
  *                       and i01.neighbors[2*dir2 + 1] != NULL
  *                       and i00.neighbors[2*dir2 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                       and i01.neighbors[2*dir2 + 1].is_leaf()
  *                       and i00.neighbors[2*dir2 + 1].level == i00.level
  */
-        __Pyx_TraceLine(5619,0,__PYX_ERR(0, 5619, __pyx_L1_error))
+        __Pyx_TraceLine(5614,0,__PYX_ERR(0, 5614, __pyx_L1_error))
         __pyx_t_18 = ((__pyx_v_i00->neighbors[((2 * __pyx_v_dir2) + 1)])->is_leaf() != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L33_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5620
+        /* "discretize/_extensions/tree_ext.pyx":5615
  *                       and i01.neighbors[2*dir2 + 1] != NULL
  *                       and i00.neighbors[2*dir2 + 1].is_leaf()
  *                       and i01.neighbors[2*dir2 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                       and i00.neighbors[2*dir2 + 1].level == i00.level
  *                       and i01.neighbors[2*dir2 + 1].level == i01.level
  */
-        __Pyx_TraceLine(5620,0,__PYX_ERR(0, 5620, __pyx_L1_error))
+        __Pyx_TraceLine(5615,0,__PYX_ERR(0, 5615, __pyx_L1_error))
         __pyx_t_18 = ((__pyx_v_i01->neighbors[((2 * __pyx_v_dir2) + 1)])->is_leaf() != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L33_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5621
+        /* "discretize/_extensions/tree_ext.pyx":5616
  *                       and i00.neighbors[2*dir2 + 1].is_leaf()
  *                       and i01.neighbors[2*dir2 + 1].is_leaf()
  *                       and i00.neighbors[2*dir2 + 1].level == i00.level             # <<<<<<<<<<<<<<
  *                       and i01.neighbors[2*dir2 + 1].level == i01.level
  *                   ):
  */
-        __Pyx_TraceLine(5621,0,__PYX_ERR(0, 5621, __pyx_L1_error))
+        __Pyx_TraceLine(5616,0,__PYX_ERR(0, 5616, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_i00->neighbors[((2 * __pyx_v_dir2) + 1)])->level == __pyx_v_i00->level) != 0);
         if (__pyx_t_18) {
         } else {
           __pyx_t_13 = __pyx_t_18;
           goto __pyx_L33_bool_binop_done;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5622
+        /* "discretize/_extensions/tree_ext.pyx":5617
  *                       and i01.neighbors[2*dir2 + 1].is_leaf()
  *                       and i00.neighbors[2*dir2 + 1].level == i00.level
  *                       and i01.neighbors[2*dir2 + 1].level == i01.level             # <<<<<<<<<<<<<<
  *                   ):
  *                       i10 = i00.neighbors[2*dir2 + 1]
  */
-        __Pyx_TraceLine(5622,0,__PYX_ERR(0, 5622, __pyx_L1_error))
+        __Pyx_TraceLine(5617,0,__PYX_ERR(0, 5617, __pyx_L1_error))
         __pyx_t_18 = (((__pyx_v_i01->neighbors[((2 * __pyx_v_dir2) + 1)])->level == __pyx_v_i01->level) != 0);
         __pyx_t_13 = __pyx_t_18;
         __pyx_L33_bool_binop_done:;
 
-        /* "discretize/_extensions/tree_ext.pyx":5615
+        /* "discretize/_extensions/tree_ext.pyx":5610
  *                       i00 = i00.neighbors[2*dir2]
  *                       i01 = i01.neighbors[2*dir2]
  *                   elif (             # <<<<<<<<<<<<<<
  *                       locations[i, dir2] > cell.location[dir2]
  *                       and i00.neighbors[2*dir2 + 1] != NULL
  */
-        __Pyx_TraceLine(5615,0,__PYX_ERR(0, 5615, __pyx_L1_error))
+        __Pyx_TraceLine(5610,0,__PYX_ERR(0, 5610, __pyx_L1_error))
         if (__pyx_t_13) {
 
-          /* "discretize/_extensions/tree_ext.pyx":5624
+          /* "discretize/_extensions/tree_ext.pyx":5619
  *                       and i01.neighbors[2*dir2 + 1].level == i01.level
  *                   ):
  *                       i10 = i00.neighbors[2*dir2 + 1]             # <<<<<<<<<<<<<<
  *                       i11 = i01.neighbors[2*dir2 + 1]
  *                   else:
  */
-          __Pyx_TraceLine(5624,0,__PYX_ERR(0, 5624, __pyx_L1_error))
+          __Pyx_TraceLine(5619,0,__PYX_ERR(0, 5619, __pyx_L1_error))
           __pyx_v_i10 = (__pyx_v_i00->neighbors[((2 * __pyx_v_dir2) + 1)]);
 
-          /* "discretize/_extensions/tree_ext.pyx":5625
+          /* "discretize/_extensions/tree_ext.pyx":5620
  *                   ):
  *                       i10 = i00.neighbors[2*dir2 + 1]
  *                       i11 = i01.neighbors[2*dir2 + 1]             # <<<<<<<<<<<<<<
  *                   else:
  *                       i10 = i00
  */
-          __Pyx_TraceLine(5625,0,__PYX_ERR(0, 5625, __pyx_L1_error))
+          __Pyx_TraceLine(5620,0,__PYX_ERR(0, 5620, __pyx_L1_error))
           __pyx_v_i11 = (__pyx_v_i01->neighbors[((2 * __pyx_v_dir2) + 1)]);
 
-          /* "discretize/_extensions/tree_ext.pyx":5615
+          /* "discretize/_extensions/tree_ext.pyx":5610
  *                       i00 = i00.neighbors[2*dir2]
  *                       i01 = i01.neighbors[2*dir2]
  *                   elif (             # <<<<<<<<<<<<<<
  *                       locations[i, dir2] > cell.location[dir2]
  *                       and i00.neighbors[2*dir2 + 1] != NULL
  */
           goto __pyx_L25;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5627
+        /* "discretize/_extensions/tree_ext.pyx":5622
  *                       i11 = i01.neighbors[2*dir2 + 1]
  *                   else:
  *                       i10 = i00             # <<<<<<<<<<<<<<
  *                       i11 = i01
  * 
  */
-        __Pyx_TraceLine(5627,0,__PYX_ERR(0, 5627, __pyx_L1_error))
+        __Pyx_TraceLine(5622,0,__PYX_ERR(0, 5622, __pyx_L1_error))
         /*else*/ {
           __pyx_v_i10 = __pyx_v_i00;
 
-          /* "discretize/_extensions/tree_ext.pyx":5628
+          /* "discretize/_extensions/tree_ext.pyx":5623
  *                   else:
  *                       i10 = i00
  *                       i11 = i01             # <<<<<<<<<<<<<<
  * 
  *                   f000 = i00.faces[dir * 2]
  */
-          __Pyx_TraceLine(5628,0,__PYX_ERR(0, 5628, __pyx_L1_error))
+          __Pyx_TraceLine(5623,0,__PYX_ERR(0, 5623, __pyx_L1_error))
           __pyx_v_i11 = __pyx_v_i01;
         }
         __pyx_L25:;
 
-        /* "discretize/_extensions/tree_ext.pyx":5630
+        /* "discretize/_extensions/tree_ext.pyx":5625
  *                       i11 = i01
  * 
  *                   f000 = i00.faces[dir * 2]             # <<<<<<<<<<<<<<
  *                   f001 = i00.faces[dir * 2 + 1]
  *                   f010 = i01.faces[dir * 2]
  */
-        __Pyx_TraceLine(5630,0,__PYX_ERR(0, 5630, __pyx_L1_error))
+        __Pyx_TraceLine(5625,0,__PYX_ERR(0, 5625, __pyx_L1_error))
         __pyx_v_f000 = (__pyx_v_i00->faces[(__pyx_v_dir * 2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5631
+        /* "discretize/_extensions/tree_ext.pyx":5626
  * 
  *                   f000 = i00.faces[dir * 2]
  *                   f001 = i00.faces[dir * 2 + 1]             # <<<<<<<<<<<<<<
  *                   f010 = i01.faces[dir * 2]
  *                   f011 = i01.faces[dir * 2 + 1]
  */
-        __Pyx_TraceLine(5631,0,__PYX_ERR(0, 5631, __pyx_L1_error))
+        __Pyx_TraceLine(5626,0,__PYX_ERR(0, 5626, __pyx_L1_error))
         __pyx_v_f001 = (__pyx_v_i00->faces[((__pyx_v_dir * 2) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5632
+        /* "discretize/_extensions/tree_ext.pyx":5627
  *                   f000 = i00.faces[dir * 2]
  *                   f001 = i00.faces[dir * 2 + 1]
  *                   f010 = i01.faces[dir * 2]             # <<<<<<<<<<<<<<
  *                   f011 = i01.faces[dir * 2 + 1]
  *                   f100 = i10.faces[dir * 2]
  */
-        __Pyx_TraceLine(5632,0,__PYX_ERR(0, 5632, __pyx_L1_error))
+        __Pyx_TraceLine(5627,0,__PYX_ERR(0, 5627, __pyx_L1_error))
         __pyx_v_f010 = (__pyx_v_i01->faces[(__pyx_v_dir * 2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5633
+        /* "discretize/_extensions/tree_ext.pyx":5628
  *                   f001 = i00.faces[dir * 2 + 1]
  *                   f010 = i01.faces[dir * 2]
  *                   f011 = i01.faces[dir * 2 + 1]             # <<<<<<<<<<<<<<
  *                   f100 = i10.faces[dir * 2]
  *                   f101 = i10.faces[dir * 2 + 1]
  */
-        __Pyx_TraceLine(5633,0,__PYX_ERR(0, 5633, __pyx_L1_error))
+        __Pyx_TraceLine(5628,0,__PYX_ERR(0, 5628, __pyx_L1_error))
         __pyx_v_f011 = (__pyx_v_i01->faces[((__pyx_v_dir * 2) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5634
+        /* "discretize/_extensions/tree_ext.pyx":5629
  *                   f010 = i01.faces[dir * 2]
  *                   f011 = i01.faces[dir * 2 + 1]
  *                   f100 = i10.faces[dir * 2]             # <<<<<<<<<<<<<<
  *                   f101 = i10.faces[dir * 2 + 1]
  *                   f110 = i11.faces[dir * 2]
  */
-        __Pyx_TraceLine(5634,0,__PYX_ERR(0, 5634, __pyx_L1_error))
+        __Pyx_TraceLine(5629,0,__PYX_ERR(0, 5629, __pyx_L1_error))
         __pyx_v_f100 = (__pyx_v_i10->faces[(__pyx_v_dir * 2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5635
+        /* "discretize/_extensions/tree_ext.pyx":5630
  *                   f011 = i01.faces[dir * 2 + 1]
  *                   f100 = i10.faces[dir * 2]
  *                   f101 = i10.faces[dir * 2 + 1]             # <<<<<<<<<<<<<<
  *                   f110 = i11.faces[dir * 2]
  *                   f111 = i11.faces[dir * 2 + 1]
  */
-        __Pyx_TraceLine(5635,0,__PYX_ERR(0, 5635, __pyx_L1_error))
+        __Pyx_TraceLine(5630,0,__PYX_ERR(0, 5630, __pyx_L1_error))
         __pyx_v_f101 = (__pyx_v_i10->faces[((__pyx_v_dir * 2) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5636
+        /* "discretize/_extensions/tree_ext.pyx":5631
  *                   f100 = i10.faces[dir * 2]
  *                   f101 = i10.faces[dir * 2 + 1]
  *                   f110 = i11.faces[dir * 2]             # <<<<<<<<<<<<<<
  *                   f111 = i11.faces[dir * 2 + 1]
  * 
  */
-        __Pyx_TraceLine(5636,0,__PYX_ERR(0, 5636, __pyx_L1_error))
+        __Pyx_TraceLine(5631,0,__PYX_ERR(0, 5631, __pyx_L1_error))
         __pyx_v_f110 = (__pyx_v_i11->faces[(__pyx_v_dir * 2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5637
+        /* "discretize/_extensions/tree_ext.pyx":5632
  *                   f101 = i10.faces[dir * 2 + 1]
  *                   f110 = i11.faces[dir * 2]
  *                   f111 = i11.faces[dir * 2 + 1]             # <<<<<<<<<<<<<<
  * 
  *                   w1 = ((f001.location[dir] - locations[i, dir])/
  */
-        __Pyx_TraceLine(5637,0,__PYX_ERR(0, 5637, __pyx_L1_error))
+        __Pyx_TraceLine(5632,0,__PYX_ERR(0, 5632, __pyx_L1_error))
         __pyx_v_f111 = (__pyx_v_i11->faces[((__pyx_v_dir * 2) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5639
+        /* "discretize/_extensions/tree_ext.pyx":5634
  *                   f111 = i11.faces[dir * 2 + 1]
  * 
  *                   w1 = ((f001.location[dir] - locations[i, dir])/             # <<<<<<<<<<<<<<
  *                         (f001.location[dir] - f000.location[dir]))
  *                   if i00.index != i01.index:
  */
-        __Pyx_TraceLine(5639,0,__PYX_ERR(0, 5639, __pyx_L1_error))
+        __Pyx_TraceLine(5634,0,__PYX_ERR(0, 5634, __pyx_L1_error))
         __pyx_t_20 = __pyx_v_i;
         __pyx_t_19 = __pyx_v_dir;
         __pyx_t_12 = -1;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5639, __pyx_L1_error)
+          __PYX_ERR(0, 5634, __pyx_L1_error)
         }
         __pyx_t_11 = ((__pyx_v_f001->location[__pyx_v_dir]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))));
 
-        /* "discretize/_extensions/tree_ext.pyx":5640
+        /* "discretize/_extensions/tree_ext.pyx":5635
  * 
  *                   w1 = ((f001.location[dir] - locations[i, dir])/
  *                         (f001.location[dir] - f000.location[dir]))             # <<<<<<<<<<<<<<
  *                   if i00.index != i01.index:
  *                       w2 = ((f010.location[dir1] - locations[i, dir1])/
  */
-        __Pyx_TraceLine(5640,0,__PYX_ERR(0, 5640, __pyx_L1_error))
+        __Pyx_TraceLine(5635,0,__PYX_ERR(0, 5635, __pyx_L1_error))
         __pyx_t_21 = ((__pyx_v_f001->location[__pyx_v_dir]) - (__pyx_v_f000->location[__pyx_v_dir]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5639
+        /* "discretize/_extensions/tree_ext.pyx":5634
  *                   f111 = i11.faces[dir * 2 + 1]
  * 
  *                   w1 = ((f001.location[dir] - locations[i, dir])/             # <<<<<<<<<<<<<<
  *                         (f001.location[dir] - f000.location[dir]))
  *                   if i00.index != i01.index:
  */
-        __Pyx_TraceLine(5639,0,__PYX_ERR(0, 5639, __pyx_L1_error))
+        __Pyx_TraceLine(5634,0,__PYX_ERR(0, 5634, __pyx_L1_error))
         if (unlikely(__pyx_t_21 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5639, __pyx_L1_error)
+          __PYX_ERR(0, 5634, __pyx_L1_error)
         }
         __pyx_v_w1 = (__pyx_t_11 / __pyx_t_21);
 
-        /* "discretize/_extensions/tree_ext.pyx":5641
+        /* "discretize/_extensions/tree_ext.pyx":5636
  *                   w1 = ((f001.location[dir] - locations[i, dir])/
  *                         (f001.location[dir] - f000.location[dir]))
  *                   if i00.index != i01.index:             # <<<<<<<<<<<<<<
  *                       w2 = ((f010.location[dir1] - locations[i, dir1])/
  *                             (f010.location[dir1] - f000.location[dir1]))
  */
-        __Pyx_TraceLine(5641,0,__PYX_ERR(0, 5641, __pyx_L1_error))
+        __Pyx_TraceLine(5636,0,__PYX_ERR(0, 5636, __pyx_L1_error))
         __pyx_t_13 = ((__pyx_v_i00->index != __pyx_v_i01->index) != 0);
         if (__pyx_t_13) {
 
-          /* "discretize/_extensions/tree_ext.pyx":5642
+          /* "discretize/_extensions/tree_ext.pyx":5637
  *                         (f001.location[dir] - f000.location[dir]))
  *                   if i00.index != i01.index:
  *                       w2 = ((f010.location[dir1] - locations[i, dir1])/             # <<<<<<<<<<<<<<
  *                             (f010.location[dir1] - f000.location[dir1]))
  *                   else:
  */
-          __Pyx_TraceLine(5642,0,__PYX_ERR(0, 5642, __pyx_L1_error))
+          __Pyx_TraceLine(5637,0,__PYX_ERR(0, 5637, __pyx_L1_error))
           __pyx_t_19 = __pyx_v_i;
           __pyx_t_20 = __pyx_v_dir1;
           __pyx_t_12 = -1;
           if (__pyx_t_19 < 0) {
             __pyx_t_19 += __pyx_v_locations.shape[0];
             if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
           } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
           if (__pyx_t_20 < 0) {
             __pyx_t_20 += __pyx_v_locations.shape[1];
             if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
           } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
           if (unlikely(__pyx_t_12 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_12);
-            __PYX_ERR(0, 5642, __pyx_L1_error)
+            __PYX_ERR(0, 5637, __pyx_L1_error)
           }
           __pyx_t_21 = ((__pyx_v_f010->location[__pyx_v_dir1]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))));
 
-          /* "discretize/_extensions/tree_ext.pyx":5643
+          /* "discretize/_extensions/tree_ext.pyx":5638
  *                   if i00.index != i01.index:
  *                       w2 = ((f010.location[dir1] - locations[i, dir1])/
  *                             (f010.location[dir1] - f000.location[dir1]))             # <<<<<<<<<<<<<<
  *                   else:
  *                       w2 = 1.0
  */
-          __Pyx_TraceLine(5643,0,__PYX_ERR(0, 5643, __pyx_L1_error))
+          __Pyx_TraceLine(5638,0,__PYX_ERR(0, 5638, __pyx_L1_error))
           __pyx_t_11 = ((__pyx_v_f010->location[__pyx_v_dir1]) - (__pyx_v_f000->location[__pyx_v_dir1]));
 
-          /* "discretize/_extensions/tree_ext.pyx":5642
+          /* "discretize/_extensions/tree_ext.pyx":5637
  *                         (f001.location[dir] - f000.location[dir]))
  *                   if i00.index != i01.index:
  *                       w2 = ((f010.location[dir1] - locations[i, dir1])/             # <<<<<<<<<<<<<<
  *                             (f010.location[dir1] - f000.location[dir1]))
  *                   else:
  */
-          __Pyx_TraceLine(5642,0,__PYX_ERR(0, 5642, __pyx_L1_error))
+          __Pyx_TraceLine(5637,0,__PYX_ERR(0, 5637, __pyx_L1_error))
           if (unlikely(__pyx_t_11 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 5642, __pyx_L1_error)
+            __PYX_ERR(0, 5637, __pyx_L1_error)
           }
           __pyx_v_w2 = (__pyx_t_21 / __pyx_t_11);
 
-          /* "discretize/_extensions/tree_ext.pyx":5641
+          /* "discretize/_extensions/tree_ext.pyx":5636
  *                   w1 = ((f001.location[dir] - locations[i, dir])/
  *                         (f001.location[dir] - f000.location[dir]))
  *                   if i00.index != i01.index:             # <<<<<<<<<<<<<<
  *                       w2 = ((f010.location[dir1] - locations[i, dir1])/
  *                             (f010.location[dir1] - f000.location[dir1]))
  */
           goto __pyx_L40;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5645
+        /* "discretize/_extensions/tree_ext.pyx":5640
  *                             (f010.location[dir1] - f000.location[dir1]))
  *                   else:
  *                       w2 = 1.0             # <<<<<<<<<<<<<<
  *                   if i10.index != i00.index:
  *                       w3 = ((f100.location[dir2] - locations[i, dir2])/
  */
-        __Pyx_TraceLine(5645,0,__PYX_ERR(0, 5645, __pyx_L1_error))
+        __Pyx_TraceLine(5640,0,__PYX_ERR(0, 5640, __pyx_L1_error))
         /*else*/ {
           __pyx_v_w2 = 1.0;
         }
         __pyx_L40:;
 
-        /* "discretize/_extensions/tree_ext.pyx":5646
+        /* "discretize/_extensions/tree_ext.pyx":5641
  *                   else:
  *                       w2 = 1.0
  *                   if i10.index != i00.index:             # <<<<<<<<<<<<<<
  *                       w3 = ((f100.location[dir2] - locations[i, dir2])/
  *                             (f100.location[dir2] - f000.location[dir2]))
  */
-        __Pyx_TraceLine(5646,0,__PYX_ERR(0, 5646, __pyx_L1_error))
+        __Pyx_TraceLine(5641,0,__PYX_ERR(0, 5641, __pyx_L1_error))
         __pyx_t_13 = ((__pyx_v_i10->index != __pyx_v_i00->index) != 0);
         if (__pyx_t_13) {
 
-          /* "discretize/_extensions/tree_ext.pyx":5647
+          /* "discretize/_extensions/tree_ext.pyx":5642
  *                       w2 = 1.0
  *                   if i10.index != i00.index:
  *                       w3 = ((f100.location[dir2] - locations[i, dir2])/             # <<<<<<<<<<<<<<
  *                             (f100.location[dir2] - f000.location[dir2]))
  *                   else:
  */
-          __Pyx_TraceLine(5647,0,__PYX_ERR(0, 5647, __pyx_L1_error))
+          __Pyx_TraceLine(5642,0,__PYX_ERR(0, 5642, __pyx_L1_error))
           __pyx_t_20 = __pyx_v_i;
           __pyx_t_19 = __pyx_v_dir2;
           __pyx_t_12 = -1;
           if (__pyx_t_20 < 0) {
             __pyx_t_20 += __pyx_v_locations.shape[0];
             if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
           } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
           if (__pyx_t_19 < 0) {
             __pyx_t_19 += __pyx_v_locations.shape[1];
             if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
           } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
           if (unlikely(__pyx_t_12 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_12);
-            __PYX_ERR(0, 5647, __pyx_L1_error)
+            __PYX_ERR(0, 5642, __pyx_L1_error)
           }
           __pyx_t_11 = ((__pyx_v_f100->location[__pyx_v_dir2]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))));
 
-          /* "discretize/_extensions/tree_ext.pyx":5648
+          /* "discretize/_extensions/tree_ext.pyx":5643
  *                   if i10.index != i00.index:
  *                       w3 = ((f100.location[dir2] - locations[i, dir2])/
  *                             (f100.location[dir2] - f000.location[dir2]))             # <<<<<<<<<<<<<<
  *                   else:
  *                       w3 = 1.0
  */
-          __Pyx_TraceLine(5648,0,__PYX_ERR(0, 5648, __pyx_L1_error))
+          __Pyx_TraceLine(5643,0,__PYX_ERR(0, 5643, __pyx_L1_error))
           __pyx_t_21 = ((__pyx_v_f100->location[__pyx_v_dir2]) - (__pyx_v_f000->location[__pyx_v_dir2]));
 
-          /* "discretize/_extensions/tree_ext.pyx":5647
+          /* "discretize/_extensions/tree_ext.pyx":5642
  *                       w2 = 1.0
  *                   if i10.index != i00.index:
  *                       w3 = ((f100.location[dir2] - locations[i, dir2])/             # <<<<<<<<<<<<<<
  *                             (f100.location[dir2] - f000.location[dir2]))
  *                   else:
  */
-          __Pyx_TraceLine(5647,0,__PYX_ERR(0, 5647, __pyx_L1_error))
+          __Pyx_TraceLine(5642,0,__PYX_ERR(0, 5642, __pyx_L1_error))
           if (unlikely(__pyx_t_21 == 0)) {
             PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-            __PYX_ERR(0, 5647, __pyx_L1_error)
+            __PYX_ERR(0, 5642, __pyx_L1_error)
           }
           __pyx_v_w3 = (__pyx_t_11 / __pyx_t_21);
 
-          /* "discretize/_extensions/tree_ext.pyx":5646
+          /* "discretize/_extensions/tree_ext.pyx":5641
  *                   else:
  *                       w2 = 1.0
  *                   if i10.index != i00.index:             # <<<<<<<<<<<<<<
  *                       w3 = ((f100.location[dir2] - locations[i, dir2])/
  *                             (f100.location[dir2] - f000.location[dir2]))
  */
           goto __pyx_L41;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5650
+        /* "discretize/_extensions/tree_ext.pyx":5645
  *                             (f100.location[dir2] - f000.location[dir2]))
  *                   else:
  *                       w3 = 1.0             # <<<<<<<<<<<<<<
  * 
  *                   w1 = _clip01(w1)
  */
-        __Pyx_TraceLine(5650,0,__PYX_ERR(0, 5650, __pyx_L1_error))
+        __Pyx_TraceLine(5645,0,__PYX_ERR(0, 5645, __pyx_L1_error))
         /*else*/ {
           __pyx_v_w3 = 1.0;
         }
         __pyx_L41:;
 
-        /* "discretize/_extensions/tree_ext.pyx":5652
+        /* "discretize/_extensions/tree_ext.pyx":5647
  *                       w3 = 1.0
  * 
  *                   w1 = _clip01(w1)             # <<<<<<<<<<<<<<
  *                   w2 = _clip01(w2)
  *                   w3 = _clip01(w3)
  */
-        __Pyx_TraceLine(5652,0,__PYX_ERR(0, 5652, __pyx_L1_error))
+        __Pyx_TraceLine(5647,0,__PYX_ERR(0, 5647, __pyx_L1_error))
         __pyx_v_w1 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w1);
 
-        /* "discretize/_extensions/tree_ext.pyx":5653
+        /* "discretize/_extensions/tree_ext.pyx":5648
  * 
  *                   w1 = _clip01(w1)
  *                   w2 = _clip01(w2)             # <<<<<<<<<<<<<<
  *                   w3 = _clip01(w3)
  * 
  */
-        __Pyx_TraceLine(5653,0,__PYX_ERR(0, 5653, __pyx_L1_error))
+        __Pyx_TraceLine(5648,0,__PYX_ERR(0, 5648, __pyx_L1_error))
         __pyx_v_w2 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w2);
 
-        /* "discretize/_extensions/tree_ext.pyx":5654
+        /* "discretize/_extensions/tree_ext.pyx":5649
  *                   w1 = _clip01(w1)
  *                   w2 = _clip01(w2)
  *                   w3 = _clip01(w3)             # <<<<<<<<<<<<<<
  * 
  *                   row_data[0] = w1 * w2 * w3
  */
-        __Pyx_TraceLine(5654,0,__PYX_ERR(0, 5654, __pyx_L1_error))
+        __Pyx_TraceLine(5649,0,__PYX_ERR(0, 5649, __pyx_L1_error))
         __pyx_v_w3 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w3);
 
-        /* "discretize/_extensions/tree_ext.pyx":5656
+        /* "discretize/_extensions/tree_ext.pyx":5651
  *                   w3 = _clip01(w3)
  * 
  *                   row_data[0] = w1 * w2 * w3             # <<<<<<<<<<<<<<
  *                   row_data[1] = (1 - w1) * w2 * w3
  *                   row_data[2] = w1 * (1 - w2) * w3
  */
-        __Pyx_TraceLine(5656,0,__PYX_ERR(0, 5656, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble(((__pyx_v_w1 * __pyx_v_w2) * __pyx_v_w3)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5656, __pyx_L1_error)
+        __Pyx_TraceLine(5651,0,__PYX_ERR(0, 5651, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble(((__pyx_v_w1 * __pyx_v_w2) * __pyx_v_w3)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5651, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5656, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5651, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5657
+        /* "discretize/_extensions/tree_ext.pyx":5652
  * 
  *                   row_data[0] = w1 * w2 * w3
  *                   row_data[1] = (1 - w1) * w2 * w3             # <<<<<<<<<<<<<<
  *                   row_data[2] = w1 * (1 - w2) * w3
  *                   row_data[3] = (1 - w1) * (1 - w2) * w3
  */
-        __Pyx_TraceLine(5657,0,__PYX_ERR(0, 5657, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble((((1.0 - __pyx_v_w1) * __pyx_v_w2) * __pyx_v_w3)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5657, __pyx_L1_error)
+        __Pyx_TraceLine(5652,0,__PYX_ERR(0, 5652, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble((((1.0 - __pyx_v_w1) * __pyx_v_w2) * __pyx_v_w3)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5652, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5657, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5652, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5658
+        /* "discretize/_extensions/tree_ext.pyx":5653
  *                   row_data[0] = w1 * w2 * w3
  *                   row_data[1] = (1 - w1) * w2 * w3
  *                   row_data[2] = w1 * (1 - w2) * w3             # <<<<<<<<<<<<<<
  *                   row_data[3] = (1 - w1) * (1 - w2) * w3
  *                   row_data[4] = w1 * w2 * (1 - w3)
  */
-        __Pyx_TraceLine(5658,0,__PYX_ERR(0, 5658, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble(((__pyx_v_w1 * (1.0 - __pyx_v_w2)) * __pyx_v_w3)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5658, __pyx_L1_error)
+        __Pyx_TraceLine(5653,0,__PYX_ERR(0, 5653, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble(((__pyx_v_w1 * (1.0 - __pyx_v_w2)) * __pyx_v_w3)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5653, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 2, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5658, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 2, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5653, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5659
+        /* "discretize/_extensions/tree_ext.pyx":5654
  *                   row_data[1] = (1 - w1) * w2 * w3
  *                   row_data[2] = w1 * (1 - w2) * w3
  *                   row_data[3] = (1 - w1) * (1 - w2) * w3             # <<<<<<<<<<<<<<
  *                   row_data[4] = w1 * w2 * (1 - w3)
  *                   row_data[5] = (1 - w1) * w2 * (1 - w3)
  */
-        __Pyx_TraceLine(5659,0,__PYX_ERR(0, 5659, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble((((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2)) * __pyx_v_w3)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5659, __pyx_L1_error)
+        __Pyx_TraceLine(5654,0,__PYX_ERR(0, 5654, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble((((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2)) * __pyx_v_w3)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5654, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 3, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5659, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 3, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5654, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5660
+        /* "discretize/_extensions/tree_ext.pyx":5655
  *                   row_data[2] = w1 * (1 - w2) * w3
  *                   row_data[3] = (1 - w1) * (1 - w2) * w3
  *                   row_data[4] = w1 * w2 * (1 - w3)             # <<<<<<<<<<<<<<
  *                   row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                   row_data[6] = w1 * (1 - w2) * (1 - w3)
  */
-        __Pyx_TraceLine(5660,0,__PYX_ERR(0, 5660, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble(((__pyx_v_w1 * __pyx_v_w2) * (1.0 - __pyx_v_w3))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5660, __pyx_L1_error)
+        __Pyx_TraceLine(5655,0,__PYX_ERR(0, 5655, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble(((__pyx_v_w1 * __pyx_v_w2) * (1.0 - __pyx_v_w3))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5655, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 4, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5660, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 4, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5655, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5661
+        /* "discretize/_extensions/tree_ext.pyx":5656
  *                   row_data[3] = (1 - w1) * (1 - w2) * w3
  *                   row_data[4] = w1 * w2 * (1 - w3)
  *                   row_data[5] = (1 - w1) * w2 * (1 - w3)             # <<<<<<<<<<<<<<
  *                   row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                   row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  */
-        __Pyx_TraceLine(5661,0,__PYX_ERR(0, 5661, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble((((1.0 - __pyx_v_w1) * __pyx_v_w2) * (1.0 - __pyx_v_w3))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5661, __pyx_L1_error)
+        __Pyx_TraceLine(5656,0,__PYX_ERR(0, 5656, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble((((1.0 - __pyx_v_w1) * __pyx_v_w2) * (1.0 - __pyx_v_w3))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5656, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 5, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5661, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 5, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5656, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5662
+        /* "discretize/_extensions/tree_ext.pyx":5657
  *                   row_data[4] = w1 * w2 * (1 - w3)
  *                   row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                   row_data[6] = w1 * (1 - w2) * (1 - w3)             # <<<<<<<<<<<<<<
  *                   row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                   row_inds[0] = f000.index + offset
  */
-        __Pyx_TraceLine(5662,0,__PYX_ERR(0, 5662, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble(((__pyx_v_w1 * (1.0 - __pyx_v_w2)) * (1.0 - __pyx_v_w3))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5662, __pyx_L1_error)
+        __Pyx_TraceLine(5657,0,__PYX_ERR(0, 5657, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble(((__pyx_v_w1 * (1.0 - __pyx_v_w2)) * (1.0 - __pyx_v_w3))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5657, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 6, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5662, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 6, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5657, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5663
+        /* "discretize/_extensions/tree_ext.pyx":5658
  *                   row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                   row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                   row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)             # <<<<<<<<<<<<<<
  *                   row_inds[0] = f000.index + offset
  *                   row_inds[1] = f001.index + offset
  */
-        __Pyx_TraceLine(5663,0,__PYX_ERR(0, 5663, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble((((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2)) * (1.0 - __pyx_v_w3))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5663, __pyx_L1_error)
+        __Pyx_TraceLine(5658,0,__PYX_ERR(0, 5658, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble((((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2)) * (1.0 - __pyx_v_w3))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5658, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 7, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5663, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_data, 7, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5658, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5664
+        /* "discretize/_extensions/tree_ext.pyx":5659
  *                   row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                   row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                   row_inds[0] = f000.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[1] = f001.index + offset
  *                   row_inds[2] = f010.index + offset
  */
-        __Pyx_TraceLine(5664,0,__PYX_ERR(0, 5664, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f000->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5664, __pyx_L1_error)
+        __Pyx_TraceLine(5659,0,__PYX_ERR(0, 5659, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f000->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5659, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5664, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 0, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5659, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5665
+        /* "discretize/_extensions/tree_ext.pyx":5660
  *                   row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                   row_inds[0] = f000.index + offset
  *                   row_inds[1] = f001.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[2] = f010.index + offset
  *                   row_inds[3] = f011.index + offset
  */
-        __Pyx_TraceLine(5665,0,__PYX_ERR(0, 5665, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f001->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5665, __pyx_L1_error)
+        __Pyx_TraceLine(5660,0,__PYX_ERR(0, 5660, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f001->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5660, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5665, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 1, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5660, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5666
+        /* "discretize/_extensions/tree_ext.pyx":5661
  *                   row_inds[0] = f000.index + offset
  *                   row_inds[1] = f001.index + offset
  *                   row_inds[2] = f010.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[3] = f011.index + offset
  *                   row_inds[4] = f100.index + offset
  */
-        __Pyx_TraceLine(5666,0,__PYX_ERR(0, 5666, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f010->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5666, __pyx_L1_error)
+        __Pyx_TraceLine(5661,0,__PYX_ERR(0, 5661, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f010->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5661, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 2, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5666, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 2, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5661, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5667
+        /* "discretize/_extensions/tree_ext.pyx":5662
  *                   row_inds[1] = f001.index + offset
  *                   row_inds[2] = f010.index + offset
  *                   row_inds[3] = f011.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[4] = f100.index + offset
  *                   row_inds[5] = f101.index + offset
  */
-        __Pyx_TraceLine(5667,0,__PYX_ERR(0, 5667, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f011->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5667, __pyx_L1_error)
+        __Pyx_TraceLine(5662,0,__PYX_ERR(0, 5662, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f011->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5662, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 3, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5667, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 3, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5662, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5668
+        /* "discretize/_extensions/tree_ext.pyx":5663
  *                   row_inds[2] = f010.index + offset
  *                   row_inds[3] = f011.index + offset
  *                   row_inds[4] = f100.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[5] = f101.index + offset
  *                   row_inds[6] = f110.index + offset
  */
-        __Pyx_TraceLine(5668,0,__PYX_ERR(0, 5668, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f100->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5668, __pyx_L1_error)
+        __Pyx_TraceLine(5663,0,__PYX_ERR(0, 5663, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f100->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5663, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 4, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5668, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 4, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5663, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5669
+        /* "discretize/_extensions/tree_ext.pyx":5664
  *                   row_inds[3] = f011.index + offset
  *                   row_inds[4] = f100.index + offset
  *                   row_inds[5] = f101.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[6] = f110.index + offset
  *                   row_inds[7] = f111.index + offset
  */
-        __Pyx_TraceLine(5669,0,__PYX_ERR(0, 5669, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f101->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5669, __pyx_L1_error)
+        __Pyx_TraceLine(5664,0,__PYX_ERR(0, 5664, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f101->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5664, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 5, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5669, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 5, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5664, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5670
+        /* "discretize/_extensions/tree_ext.pyx":5665
  *                   row_inds[4] = f100.index + offset
  *                   row_inds[5] = f101.index + offset
  *                   row_inds[6] = f110.index + offset             # <<<<<<<<<<<<<<
  *                   row_inds[7] = f111.index + offset
  * 
  */
-        __Pyx_TraceLine(5670,0,__PYX_ERR(0, 5670, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f110->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5670, __pyx_L1_error)
+        __Pyx_TraceLine(5665,0,__PYX_ERR(0, 5665, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f110->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5665, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 6, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5670, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 6, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5665, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5671
+        /* "discretize/_extensions/tree_ext.pyx":5666
  *                   row_inds[5] = f101.index + offset
  *                   row_inds[6] = f110.index + offset
  *                   row_inds[7] = f111.index + offset             # <<<<<<<<<<<<<<
  * 
  *         Rf = self._deflate_faces()
  */
-        __Pyx_TraceLine(5671,0,__PYX_ERR(0, 5671, __pyx_L1_error))
-        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f111->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5671, __pyx_L1_error)
+        __Pyx_TraceLine(5666,0,__PYX_ERR(0, 5666, __pyx_L1_error))
+        __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_f111->index + __pyx_v_offset)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5666, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 7, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5671, __pyx_L1_error)
+        if (unlikely(__Pyx_SetItemInt(__pyx_v_row_inds, 7, __pyx_t_5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0)) __PYX_ERR(0, 5666, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       }
       __pyx_L23:;
     }
     __pyx_L6:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5673
+  /* "discretize/_extensions/tree_ext.pyx":5668
  *                   row_inds[7] = f111.index + offset
  * 
  *         Rf = self._deflate_faces()             # <<<<<<<<<<<<<<
  *         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_faces))*Rf
  * 
  */
-  __Pyx_TraceLine(5673,0,__PYX_ERR(0, 5673, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5673, __pyx_L1_error)
+  __Pyx_TraceLine(5668,0,__PYX_ERR(0, 5668, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_faces); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5668, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5673, __pyx_L1_error)
+  if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5668, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_Rf = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5674
+  /* "discretize/_extensions/tree_ext.pyx":5669
  * 
  *         Rf = self._deflate_faces()
  *         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_faces))*Rf             # <<<<<<<<<<<<<<
  * 
- *     def _getNodeIntMat(self, locs, zerosOutside):
+ *     def _getNodeIntMat(self, locs, zeros_outside):
  */
-  __Pyx_TraceLine(5674,0,__PYX_ERR(0, 5674, __pyx_L1_error))
+  __Pyx_TraceLine(5669,0,__PYX_ERR(0, 5669, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_data, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_data, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_3);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
   __pyx_t_3 = 0;
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_8);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_8);
   __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_faces); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 5674, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = PyNumber_Multiply(__pyx_t_7, __pyx_v_Rf); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5674, __pyx_L1_error)
+  __pyx_t_8 = PyNumber_Multiply(__pyx_t_7, __pyx_v_Rf); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5669, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_r = __pyx_t_8;
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5480
+  /* "discretize/_extensions/tree_ext.pyx":5475
  *         return A*Re
  * 
- *     def _getFaceIntMat(self, locs, zerosOutside, direction):             # <<<<<<<<<<<<<<
+ *     def _getFaceIntMat(self, locs, zeros_outside, direction):             # <<<<<<<<<<<<<<
  *         cdef:
  *             double[:, :] locations = locs
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
@@ -70050,36 +70062,36 @@
   __Pyx_XDECREF(__pyx_v_Rf);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5676
+/* "discretize/_extensions/tree_ext.pyx":5671
  *         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_faces))*Rf
  * 
- *     def _getNodeIntMat(self, locs, zerosOutside):             # <<<<<<<<<<<<<<
+ *     def _getNodeIntMat(self, locs, zeros_outside):             # <<<<<<<<<<<<<<
  *         cdef:
  *             double[:, :] locations = locs
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_85_getNodeIntMat(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_84_getNodeIntMat[] = "_TreeMesh._getNodeIntMat(self, locs, zerosOutside)";
+static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_84_getNodeIntMat[] = "_TreeMesh._getNodeIntMat(self, locs, zeros_outside)";
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_85_getNodeIntMat(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_locs = 0;
-  PyObject *__pyx_v_zerosOutside = 0;
+  PyObject *__pyx_v_zeros_outside = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_getNodeIntMat (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_locs,&__pyx_n_s_zerosOutside,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_locs,&__pyx_n_s_zeros_outside,0};
     PyObject* values[2] = {0,0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -70091,47 +70103,47 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_locs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zerosOutside)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zeros_outside)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getNodeIntMat", 1, 2, 2, 1); __PYX_ERR(0, 5676, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getNodeIntMat", 1, 2, 2, 1); __PYX_ERR(0, 5671, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getNodeIntMat") < 0)) __PYX_ERR(0, 5676, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getNodeIntMat") < 0)) __PYX_ERR(0, 5671, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_locs = values[0];
-    __pyx_v_zerosOutside = values[1];
+    __pyx_v_zeros_outside = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_getNodeIntMat", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5676, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_getNodeIntMat", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5671, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getNodeIntMat", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_84_getNodeIntMat(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_locs, __pyx_v_zerosOutside);
+  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_84_getNodeIntMat(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_locs, __pyx_v_zeros_outside);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_84_getNodeIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zerosOutside) {
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_84_getNodeIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zeros_outside) {
   __Pyx_memviewslice __pyx_v_locations = { 0, 0, { 0 }, { 0 }, { 0 } };
   int_t __pyx_v_dim;
   int_t __pyx_v_n_loc;
   int_t __pyx_v_n_nodes;
   __Pyx_memviewslice __pyx_v_I = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_J = { 0, 0, { 0 }, { 0 }, { 0 } };
   __Pyx_memviewslice __pyx_v_V = { 0, 0, { 0 }, { 0 }, { 0 } };
@@ -70173,483 +70185,483 @@
   int_t __pyx_t_21;
   int_t __pyx_t_22;
   PyObject *__pyx_t_23 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getNodeIntMat", 0);
-  __Pyx_TraceCall("_getNodeIntMat", __pyx_f[0], 5676, 0, __PYX_ERR(0, 5676, __pyx_L1_error));
+  __Pyx_TraceCall("_getNodeIntMat", __pyx_f[0], 5671, 0, __PYX_ERR(0, 5671, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5678
- *     def _getNodeIntMat(self, locs, zerosOutside):
+  /* "discretize/_extensions/tree_ext.pyx":5673
+ *     def _getNodeIntMat(self, locs, zeros_outside):
  *         cdef:
  *             double[:, :] locations = locs             # <<<<<<<<<<<<<<
  *             int_t dim = self._dim
  *             int_t n_loc = locs.shape[0]
  */
-  __Pyx_TraceLine(5678,0,__PYX_ERR(0, 5678, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 5678, __pyx_L1_error)
+  __Pyx_TraceLine(5673,0,__PYX_ERR(0, 5673, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 5673, __pyx_L1_error)
   __pyx_v_locations = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5679
+  /* "discretize/_extensions/tree_ext.pyx":5674
  *         cdef:
  *             double[:, :] locations = locs
  *             int_t dim = self._dim             # <<<<<<<<<<<<<<
  *             int_t n_loc = locs.shape[0]
  *             int_t n_nodes = 1<<dim
  */
-  __Pyx_TraceLine(5679,0,__PYX_ERR(0, 5679, __pyx_L1_error))
+  __Pyx_TraceLine(5674,0,__PYX_ERR(0, 5674, __pyx_L1_error))
   __pyx_t_2 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5680
+  /* "discretize/_extensions/tree_ext.pyx":5675
  *             double[:, :] locations = locs
  *             int_t dim = self._dim
  *             int_t n_loc = locs.shape[0]             # <<<<<<<<<<<<<<
  *             int_t n_nodes = 1<<dim
  *             np.int64_t[:] I = np.empty(n_loc*n_nodes, dtype=np.int64)
  */
-  __Pyx_TraceLine(5680,0,__PYX_ERR(0, 5680, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5680, __pyx_L1_error)
+  __Pyx_TraceLine(5675,0,__PYX_ERR(0, 5675, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5675, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5680, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5675, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_4); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5680, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_As_int_t(__pyx_t_4); if (unlikely((__pyx_t_2 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5675, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_n_loc = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5681
+  /* "discretize/_extensions/tree_ext.pyx":5676
  *             int_t dim = self._dim
  *             int_t n_loc = locs.shape[0]
  *             int_t n_nodes = 1<<dim             # <<<<<<<<<<<<<<
  *             np.int64_t[:] I = np.empty(n_loc*n_nodes, dtype=np.int64)
  *             np.int64_t[:] J = np.empty(n_loc*n_nodes, dtype=np.int64)
  */
-  __Pyx_TraceLine(5681,0,__PYX_ERR(0, 5681, __pyx_L1_error))
+  __Pyx_TraceLine(5676,0,__PYX_ERR(0, 5676, __pyx_L1_error))
   __pyx_v_n_nodes = (1 << __pyx_v_dim);
 
-  /* "discretize/_extensions/tree_ext.pyx":5682
+  /* "discretize/_extensions/tree_ext.pyx":5677
  *             int_t n_loc = locs.shape[0]
  *             int_t n_nodes = 1<<dim
  *             np.int64_t[:] I = np.empty(n_loc*n_nodes, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.int64_t[:] J = np.empty(n_loc*n_nodes, dtype=np.int64)
  *             np.float64_t[:] V = np.empty(n_loc*n_nodes, dtype=np.float64)
  */
-  __Pyx_TraceLine(5682,0,__PYX_ERR(0, 5682, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __Pyx_TraceLine(5677,0,__PYX_ERR(0, 5677, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_nodes)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_nodes)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 5682, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5682, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5677, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_I = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5683
+  /* "discretize/_extensions/tree_ext.pyx":5678
  *             int_t n_nodes = 1<<dim
  *             np.int64_t[:] I = np.empty(n_loc*n_nodes, dtype=np.int64)
  *             np.int64_t[:] J = np.empty(n_loc*n_nodes, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.float64_t[:] V = np.empty(n_loc*n_nodes, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(5683,0,__PYX_ERR(0, 5683, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __Pyx_TraceLine(5678,0,__PYX_ERR(0, 5678, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_nodes)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_nodes)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5683, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5683, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5678, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_J = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5684
+  /* "discretize/_extensions/tree_ext.pyx":5679
  *             np.int64_t[:] I = np.empty(n_loc*n_nodes, dtype=np.int64)
  *             np.int64_t[:] J = np.empty(n_loc*n_nodes, dtype=np.int64)
  *             np.float64_t[:] V = np.empty(n_loc*n_nodes, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *             int_t ii, i
  */
-  __Pyx_TraceLine(5684,0,__PYX_ERR(0, 5684, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __Pyx_TraceLine(5679,0,__PYX_ERR(0, 5679, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_nodes)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyInt_From_int_t((__pyx_v_n_loc * __pyx_v_n_nodes)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_float64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_float64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5684, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_3) < 0) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5684, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5679, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_V = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5690
+  /* "discretize/_extensions/tree_ext.pyx":5685
  *             double x, y, z
  *             double wx, wy, wz
  *             double eps = 100*np.finfo(float).eps             # <<<<<<<<<<<<<<
- *             int zeros_out = zerosOutside
+ *             int zeros_out = zeros_outside
  * 
  */
-  __Pyx_TraceLine(5690,0,__PYX_ERR(0, 5690, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5690, __pyx_L1_error)
+  __Pyx_TraceLine(5685,0,__PYX_ERR(0, 5685, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5685, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_finfo); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5690, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_finfo); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5685, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, ((PyObject *)(&PyFloat_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_5, ((PyObject *)(&PyFloat_Type)));
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5690, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5685, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_eps); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5690, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_eps); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5685, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = PyNumber_Multiply(__pyx_int_100, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5690, __pyx_L1_error)
+  __pyx_t_3 = PyNumber_Multiply(__pyx_int_100, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5685, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_10 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5690, __pyx_L1_error)
+  __pyx_t_10 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_10 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5685, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_eps = __pyx_t_10;
 
-  /* "discretize/_extensions/tree_ext.pyx":5691
+  /* "discretize/_extensions/tree_ext.pyx":5686
  *             double wx, wy, wz
  *             double eps = 100*np.finfo(float).eps
- *             int zeros_out = zerosOutside             # <<<<<<<<<<<<<<
+ *             int zeros_out = zeros_outside             # <<<<<<<<<<<<<<
  * 
  *         for i in range(n_loc):
  */
-  __Pyx_TraceLine(5691,0,__PYX_ERR(0, 5691, __pyx_L1_error))
-  __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_zerosOutside); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5691, __pyx_L1_error)
+  __Pyx_TraceLine(5686,0,__PYX_ERR(0, 5686, __pyx_L1_error))
+  __pyx_t_11 = __Pyx_PyInt_As_int(__pyx_v_zeros_outside); if (unlikely((__pyx_t_11 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5686, __pyx_L1_error)
   __pyx_v_zeros_out = __pyx_t_11;
 
-  /* "discretize/_extensions/tree_ext.pyx":5693
- *             int zeros_out = zerosOutside
+  /* "discretize/_extensions/tree_ext.pyx":5688
+ *             int zeros_out = zeros_outside
  * 
  *         for i in range(n_loc):             # <<<<<<<<<<<<<<
  *             x = locations[i, 0]
  *             y = locations[i, 1]
  */
-  __Pyx_TraceLine(5693,0,__PYX_ERR(0, 5693, __pyx_L1_error))
+  __Pyx_TraceLine(5688,0,__PYX_ERR(0, 5688, __pyx_L1_error))
   __pyx_t_2 = __pyx_v_n_loc;
   __pyx_t_12 = __pyx_t_2;
   for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
     __pyx_v_i = __pyx_t_13;
 
-    /* "discretize/_extensions/tree_ext.pyx":5694
+    /* "discretize/_extensions/tree_ext.pyx":5689
  * 
  *         for i in range(n_loc):
  *             x = locations[i, 0]             # <<<<<<<<<<<<<<
  *             y = locations[i, 1]
  *             z = locations[i, 2] if dim==3 else 0.0
  */
-    __Pyx_TraceLine(5694,0,__PYX_ERR(0, 5694, __pyx_L1_error))
+    __Pyx_TraceLine(5689,0,__PYX_ERR(0, 5689, __pyx_L1_error))
     __pyx_t_14 = __pyx_v_i;
     __pyx_t_15 = 0;
     __pyx_t_11 = -1;
     if (__pyx_t_14 < 0) {
       __pyx_t_14 += __pyx_v_locations.shape[0];
       if (unlikely(__pyx_t_14 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_14 >= __pyx_v_locations.shape[0])) __pyx_t_11 = 0;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_locations.shape[1];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 1;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[1])) __pyx_t_11 = 1;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5694, __pyx_L1_error)
+      __PYX_ERR(0, 5689, __pyx_L1_error)
     }
     __pyx_v_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_14 * __pyx_v_locations.strides[0]) ) + __pyx_t_15 * __pyx_v_locations.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5695
+    /* "discretize/_extensions/tree_ext.pyx":5690
  *         for i in range(n_loc):
  *             x = locations[i, 0]
  *             y = locations[i, 1]             # <<<<<<<<<<<<<<
  *             z = locations[i, 2] if dim==3 else 0.0
  *             #get containing (or closest) cell
  */
-    __Pyx_TraceLine(5695,0,__PYX_ERR(0, 5695, __pyx_L1_error))
+    __Pyx_TraceLine(5690,0,__PYX_ERR(0, 5690, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_i;
     __pyx_t_14 = 1;
     __pyx_t_11 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_locations.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[0])) __pyx_t_11 = 0;
     if (__pyx_t_14 < 0) {
       __pyx_t_14 += __pyx_v_locations.shape[1];
       if (unlikely(__pyx_t_14 < 0)) __pyx_t_11 = 1;
     } else if (unlikely(__pyx_t_14 >= __pyx_v_locations.shape[1])) __pyx_t_11 = 1;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5695, __pyx_L1_error)
+      __PYX_ERR(0, 5690, __pyx_L1_error)
     }
     __pyx_v_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_15 * __pyx_v_locations.strides[0]) ) + __pyx_t_14 * __pyx_v_locations.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5696
+    /* "discretize/_extensions/tree_ext.pyx":5691
  *             x = locations[i, 0]
  *             y = locations[i, 1]
  *             z = locations[i, 2] if dim==3 else 0.0             # <<<<<<<<<<<<<<
  *             #get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)
  */
-    __Pyx_TraceLine(5696,0,__PYX_ERR(0, 5696, __pyx_L1_error))
+    __Pyx_TraceLine(5691,0,__PYX_ERR(0, 5691, __pyx_L1_error))
     if (((__pyx_v_dim == 3) != 0)) {
       __pyx_t_14 = __pyx_v_i;
       __pyx_t_15 = 2;
       __pyx_t_11 = -1;
       if (__pyx_t_14 < 0) {
         __pyx_t_14 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_14 < 0)) __pyx_t_11 = 0;
       } else if (unlikely(__pyx_t_14 >= __pyx_v_locations.shape[0])) __pyx_t_11 = 0;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 1;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[1])) __pyx_t_11 = 1;
       if (unlikely(__pyx_t_11 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        __PYX_ERR(0, 5696, __pyx_L1_error)
+        __PYX_ERR(0, 5691, __pyx_L1_error)
       }
       __pyx_t_10 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_14 * __pyx_v_locations.strides[0]) ) + __pyx_t_15 * __pyx_v_locations.strides[1]) )));
     } else {
       __pyx_t_10 = 0.0;
     }
     __pyx_v_z = __pyx_t_10;
 
-    /* "discretize/_extensions/tree_ext.pyx":5698
+    /* "discretize/_extensions/tree_ext.pyx":5693
  *             z = locations[i, 2] if dim==3 else 0.0
  *             #get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)             # <<<<<<<<<<<<<<
  *             #calculate weights
  *             wx = ((cell.points[3].location[0] - x)/
  */
-    __Pyx_TraceLine(5698,0,__PYX_ERR(0, 5698, __pyx_L1_error))
+    __Pyx_TraceLine(5693,0,__PYX_ERR(0, 5693, __pyx_L1_error))
     __pyx_v_cell = __pyx_v_self->tree->containing_cell(__pyx_v_x, __pyx_v_y, __pyx_v_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":5700
+    /* "discretize/_extensions/tree_ext.pyx":5695
  *             cell = self.tree.containing_cell(x, y, z)
  *             #calculate weights
  *             wx = ((cell.points[3].location[0] - x)/             # <<<<<<<<<<<<<<
  *                   (cell.points[3].location[0] - cell.points[0].location[0]))
  *             wy = ((cell.points[3].location[1] - y)/
  */
-    __Pyx_TraceLine(5700,0,__PYX_ERR(0, 5700, __pyx_L1_error))
+    __Pyx_TraceLine(5695,0,__PYX_ERR(0, 5695, __pyx_L1_error))
     __pyx_t_10 = (((__pyx_v_cell->points[3])->location[0]) - __pyx_v_x);
 
-    /* "discretize/_extensions/tree_ext.pyx":5701
+    /* "discretize/_extensions/tree_ext.pyx":5696
  *             #calculate weights
  *             wx = ((cell.points[3].location[0] - x)/
  *                   (cell.points[3].location[0] - cell.points[0].location[0]))             # <<<<<<<<<<<<<<
  *             wy = ((cell.points[3].location[1] - y)/
  *                   (cell.points[3].location[1] - cell.points[0].location[1]))
  */
-    __Pyx_TraceLine(5701,0,__PYX_ERR(0, 5701, __pyx_L1_error))
+    __Pyx_TraceLine(5696,0,__PYX_ERR(0, 5696, __pyx_L1_error))
     __pyx_t_16 = (((__pyx_v_cell->points[3])->location[0]) - ((__pyx_v_cell->points[0])->location[0]));
 
-    /* "discretize/_extensions/tree_ext.pyx":5700
+    /* "discretize/_extensions/tree_ext.pyx":5695
  *             cell = self.tree.containing_cell(x, y, z)
  *             #calculate weights
  *             wx = ((cell.points[3].location[0] - x)/             # <<<<<<<<<<<<<<
  *                   (cell.points[3].location[0] - cell.points[0].location[0]))
  *             wy = ((cell.points[3].location[1] - y)/
  */
-    __Pyx_TraceLine(5700,0,__PYX_ERR(0, 5700, __pyx_L1_error))
+    __Pyx_TraceLine(5695,0,__PYX_ERR(0, 5695, __pyx_L1_error))
     if (unlikely(__pyx_t_16 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 5700, __pyx_L1_error)
+      __PYX_ERR(0, 5695, __pyx_L1_error)
     }
     __pyx_v_wx = (__pyx_t_10 / __pyx_t_16);
 
-    /* "discretize/_extensions/tree_ext.pyx":5702
+    /* "discretize/_extensions/tree_ext.pyx":5697
  *             wx = ((cell.points[3].location[0] - x)/
  *                   (cell.points[3].location[0] - cell.points[0].location[0]))
  *             wy = ((cell.points[3].location[1] - y)/             # <<<<<<<<<<<<<<
  *                   (cell.points[3].location[1] - cell.points[0].location[1]))
  *             if dim == 3:
  */
-    __Pyx_TraceLine(5702,0,__PYX_ERR(0, 5702, __pyx_L1_error))
+    __Pyx_TraceLine(5697,0,__PYX_ERR(0, 5697, __pyx_L1_error))
     __pyx_t_16 = (((__pyx_v_cell->points[3])->location[1]) - __pyx_v_y);
 
-    /* "discretize/_extensions/tree_ext.pyx":5703
+    /* "discretize/_extensions/tree_ext.pyx":5698
  *                   (cell.points[3].location[0] - cell.points[0].location[0]))
  *             wy = ((cell.points[3].location[1] - y)/
  *                   (cell.points[3].location[1] - cell.points[0].location[1]))             # <<<<<<<<<<<<<<
  *             if dim == 3:
  *                 wz = ((cell.points[7].location[2] - z)/
  */
-    __Pyx_TraceLine(5703,0,__PYX_ERR(0, 5703, __pyx_L1_error))
+    __Pyx_TraceLine(5698,0,__PYX_ERR(0, 5698, __pyx_L1_error))
     __pyx_t_10 = (((__pyx_v_cell->points[3])->location[1]) - ((__pyx_v_cell->points[0])->location[1]));
 
-    /* "discretize/_extensions/tree_ext.pyx":5702
+    /* "discretize/_extensions/tree_ext.pyx":5697
  *             wx = ((cell.points[3].location[0] - x)/
  *                   (cell.points[3].location[0] - cell.points[0].location[0]))
  *             wy = ((cell.points[3].location[1] - y)/             # <<<<<<<<<<<<<<
  *                   (cell.points[3].location[1] - cell.points[0].location[1]))
  *             if dim == 3:
  */
-    __Pyx_TraceLine(5702,0,__PYX_ERR(0, 5702, __pyx_L1_error))
+    __Pyx_TraceLine(5697,0,__PYX_ERR(0, 5697, __pyx_L1_error))
     if (unlikely(__pyx_t_10 == 0)) {
       PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-      __PYX_ERR(0, 5702, __pyx_L1_error)
+      __PYX_ERR(0, 5697, __pyx_L1_error)
     }
     __pyx_v_wy = (__pyx_t_16 / __pyx_t_10);
 
-    /* "discretize/_extensions/tree_ext.pyx":5704
+    /* "discretize/_extensions/tree_ext.pyx":5699
  *             wy = ((cell.points[3].location[1] - y)/
  *                   (cell.points[3].location[1] - cell.points[0].location[1]))
  *             if dim == 3:             # <<<<<<<<<<<<<<
  *                 wz = ((cell.points[7].location[2] - z)/
  *                       (cell.points[7].location[2] - cell.points[0].location[2]))
  */
-    __Pyx_TraceLine(5704,0,__PYX_ERR(0, 5704, __pyx_L1_error))
+    __Pyx_TraceLine(5699,0,__PYX_ERR(0, 5699, __pyx_L1_error))
     __pyx_t_17 = ((__pyx_v_dim == 3) != 0);
     if (__pyx_t_17) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5705
+      /* "discretize/_extensions/tree_ext.pyx":5700
  *                   (cell.points[3].location[1] - cell.points[0].location[1]))
  *             if dim == 3:
  *                 wz = ((cell.points[7].location[2] - z)/             # <<<<<<<<<<<<<<
  *                       (cell.points[7].location[2] - cell.points[0].location[2]))
  *             else:
  */
-      __Pyx_TraceLine(5705,0,__PYX_ERR(0, 5705, __pyx_L1_error))
+      __Pyx_TraceLine(5700,0,__PYX_ERR(0, 5700, __pyx_L1_error))
       __pyx_t_10 = (((__pyx_v_cell->points[7])->location[2]) - __pyx_v_z);
 
-      /* "discretize/_extensions/tree_ext.pyx":5706
+      /* "discretize/_extensions/tree_ext.pyx":5701
  *             if dim == 3:
  *                 wz = ((cell.points[7].location[2] - z)/
  *                       (cell.points[7].location[2] - cell.points[0].location[2]))             # <<<<<<<<<<<<<<
  *             else:
  *                 wz = 1.0
  */
-      __Pyx_TraceLine(5706,0,__PYX_ERR(0, 5706, __pyx_L1_error))
+      __Pyx_TraceLine(5701,0,__PYX_ERR(0, 5701, __pyx_L1_error))
       __pyx_t_16 = (((__pyx_v_cell->points[7])->location[2]) - ((__pyx_v_cell->points[0])->location[2]));
 
-      /* "discretize/_extensions/tree_ext.pyx":5705
+      /* "discretize/_extensions/tree_ext.pyx":5700
  *                   (cell.points[3].location[1] - cell.points[0].location[1]))
  *             if dim == 3:
  *                 wz = ((cell.points[7].location[2] - z)/             # <<<<<<<<<<<<<<
  *                       (cell.points[7].location[2] - cell.points[0].location[2]))
  *             else:
  */
-      __Pyx_TraceLine(5705,0,__PYX_ERR(0, 5705, __pyx_L1_error))
+      __Pyx_TraceLine(5700,0,__PYX_ERR(0, 5700, __pyx_L1_error))
       if (unlikely(__pyx_t_16 == 0)) {
         PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-        __PYX_ERR(0, 5705, __pyx_L1_error)
+        __PYX_ERR(0, 5700, __pyx_L1_error)
       }
       __pyx_v_wz = (__pyx_t_10 / __pyx_t_16);
 
-      /* "discretize/_extensions/tree_ext.pyx":5704
+      /* "discretize/_extensions/tree_ext.pyx":5699
  *             wy = ((cell.points[3].location[1] - y)/
  *                   (cell.points[3].location[1] - cell.points[0].location[1]))
  *             if dim == 3:             # <<<<<<<<<<<<<<
  *                 wz = ((cell.points[7].location[2] - z)/
  *                       (cell.points[7].location[2] - cell.points[0].location[2]))
  */
       goto __pyx_L5;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5708
+    /* "discretize/_extensions/tree_ext.pyx":5703
  *                       (cell.points[7].location[2] - cell.points[0].location[2]))
  *             else:
  *                 wz = 1.0             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __Pyx_TraceLine(5708,0,__PYX_ERR(0, 5708, __pyx_L1_error))
+    __Pyx_TraceLine(5703,0,__PYX_ERR(0, 5703, __pyx_L1_error))
     /*else*/ {
       __pyx_v_wz = 1.0;
     }
     __pyx_L5:;
 
-    /* "discretize/_extensions/tree_ext.pyx":5711
+    /* "discretize/_extensions/tree_ext.pyx":5706
  * 
  * 
  *             I[n_nodes*i:n_nodes*i + n_nodes] = i             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __Pyx_TraceLine(5711,0,__PYX_ERR(0, 5711, __pyx_L1_error))
+    __Pyx_TraceLine(5706,0,__PYX_ERR(0, 5706, __pyx_L1_error))
     __pyx_t_8.data = __pyx_v_I.data;
     __pyx_t_8.memview = __pyx_v_I.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_8, 0);
     __pyx_t_11 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_8,
     __pyx_v_I.shape[0], __pyx_v_I.strides[0], __pyx_v_I.suboffsets[0],
@@ -70660,15 +70672,15 @@
     ((__pyx_v_n_nodes * __pyx_v_i) + __pyx_v_n_nodes),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 5711, __pyx_L1_error)
+    __PYX_ERR(0, 5706, __pyx_L1_error)
 }
 
 {
         __pyx_t_5numpy_int64_t __pyx_temp_scalar = __pyx_v_i;
         {
             Py_ssize_t __pyx_temp_extent_0 = __pyx_t_8.shape[0];
             Py_ssize_t __pyx_temp_stride_0 = __pyx_t_8.strides[0];
@@ -70681,33 +70693,33 @@
             }
         }
     }
     __PYX_XDEC_MEMVIEW(&__pyx_t_8, 1);
     __pyx_t_8.memview = NULL;
     __pyx_t_8.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5714
+    /* "discretize/_extensions/tree_ext.pyx":5709
  * 
  * 
  *             if zeros_out:             # <<<<<<<<<<<<<<
  *                 if (wx < -eps or wy < -eps or wz < -eps or
  *                     wx>1 + eps or wy > 1 + eps or wz > 1 + eps):
  */
-    __Pyx_TraceLine(5714,0,__PYX_ERR(0, 5714, __pyx_L1_error))
+    __Pyx_TraceLine(5709,0,__PYX_ERR(0, 5709, __pyx_L1_error))
     __pyx_t_17 = (__pyx_v_zeros_out != 0);
     if (__pyx_t_17) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5715
+      /* "discretize/_extensions/tree_ext.pyx":5710
  * 
  *             if zeros_out:
  *                 if (wx < -eps or wy < -eps or wz < -eps or             # <<<<<<<<<<<<<<
  *                     wx>1 + eps or wy > 1 + eps or wz > 1 + eps):
  *                     for ii in range(n_nodes):
  */
-      __Pyx_TraceLine(5715,0,__PYX_ERR(0, 5715, __pyx_L1_error))
+      __Pyx_TraceLine(5710,0,__PYX_ERR(0, 5710, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_wx < (-__pyx_v_eps)) != 0);
       if (!__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L8_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_wy < (-__pyx_v_eps)) != 0);
@@ -70719,22 +70731,22 @@
       __pyx_t_18 = ((__pyx_v_wz < (-__pyx_v_eps)) != 0);
       if (!__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L8_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5716
+      /* "discretize/_extensions/tree_ext.pyx":5711
  *             if zeros_out:
  *                 if (wx < -eps or wy < -eps or wz < -eps or
  *                     wx>1 + eps or wy > 1 + eps or wz > 1 + eps):             # <<<<<<<<<<<<<<
  *                     for ii in range(n_nodes):
  *                         J[n_nodes*i + ii] = 0
  */
-      __Pyx_TraceLine(5716,0,__PYX_ERR(0, 5716, __pyx_L1_error))
+      __Pyx_TraceLine(5711,0,__PYX_ERR(0, 5711, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_wx > (1.0 + __pyx_v_eps)) != 0);
       if (!__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L8_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_wy > (1.0 + __pyx_v_eps)) != 0);
@@ -70743,457 +70755,457 @@
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L8_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_wz > (1.0 + __pyx_v_eps)) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L8_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5715
+      /* "discretize/_extensions/tree_ext.pyx":5710
  * 
  *             if zeros_out:
  *                 if (wx < -eps or wy < -eps or wz < -eps or             # <<<<<<<<<<<<<<
  *                     wx>1 + eps or wy > 1 + eps or wz > 1 + eps):
  *                     for ii in range(n_nodes):
  */
-      __Pyx_TraceLine(5715,0,__PYX_ERR(0, 5715, __pyx_L1_error))
+      __Pyx_TraceLine(5710,0,__PYX_ERR(0, 5710, __pyx_L1_error))
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5717
+        /* "discretize/_extensions/tree_ext.pyx":5712
  *                 if (wx < -eps or wy < -eps or wz < -eps or
  *                     wx>1 + eps or wy > 1 + eps or wz > 1 + eps):
  *                     for ii in range(n_nodes):             # <<<<<<<<<<<<<<
  *                         J[n_nodes*i + ii] = 0
  *                         V[n_nodes*i + ii] = 0.0
  */
-        __Pyx_TraceLine(5717,0,__PYX_ERR(0, 5717, __pyx_L1_error))
+        __Pyx_TraceLine(5712,0,__PYX_ERR(0, 5712, __pyx_L1_error))
         __pyx_t_19 = __pyx_v_n_nodes;
         __pyx_t_20 = __pyx_t_19;
         for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
           __pyx_v_ii = __pyx_t_21;
 
-          /* "discretize/_extensions/tree_ext.pyx":5718
+          /* "discretize/_extensions/tree_ext.pyx":5713
  *                     wx>1 + eps or wy > 1 + eps or wz > 1 + eps):
  *                     for ii in range(n_nodes):
  *                         J[n_nodes*i + ii] = 0             # <<<<<<<<<<<<<<
  *                         V[n_nodes*i + ii] = 0.0
  *                     continue
  */
-          __Pyx_TraceLine(5718,0,__PYX_ERR(0, 5718, __pyx_L1_error))
+          __Pyx_TraceLine(5713,0,__PYX_ERR(0, 5713, __pyx_L1_error))
           __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + __pyx_v_ii);
           __pyx_t_11 = -1;
           if (__pyx_t_15 < 0) {
             __pyx_t_15 += __pyx_v_J.shape[0];
             if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
           } else if (unlikely(__pyx_t_15 >= __pyx_v_J.shape[0])) __pyx_t_11 = 0;
           if (unlikely(__pyx_t_11 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_11);
-            __PYX_ERR(0, 5718, __pyx_L1_error)
+            __PYX_ERR(0, 5713, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_15 * __pyx_v_J.strides[0]) )) = 0;
 
-          /* "discretize/_extensions/tree_ext.pyx":5719
+          /* "discretize/_extensions/tree_ext.pyx":5714
  *                     for ii in range(n_nodes):
  *                         J[n_nodes*i + ii] = 0
  *                         V[n_nodes*i + ii] = 0.0             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
-          __Pyx_TraceLine(5719,0,__PYX_ERR(0, 5719, __pyx_L1_error))
+          __Pyx_TraceLine(5714,0,__PYX_ERR(0, 5714, __pyx_L1_error))
           __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + __pyx_v_ii);
           __pyx_t_11 = -1;
           if (__pyx_t_15 < 0) {
             __pyx_t_15 += __pyx_v_V.shape[0];
             if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
           } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
           if (unlikely(__pyx_t_11 != -1)) {
             __Pyx_RaiseBufferIndexError(__pyx_t_11);
-            __PYX_ERR(0, 5719, __pyx_L1_error)
+            __PYX_ERR(0, 5714, __pyx_L1_error)
           }
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = 0.0;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5720
+        /* "discretize/_extensions/tree_ext.pyx":5715
  *                         J[n_nodes*i + ii] = 0
  *                         V[n_nodes*i + ii] = 0.0
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *             wx = _clip01(wx)
  */
-        __Pyx_TraceLine(5720,0,__PYX_ERR(0, 5720, __pyx_L1_error))
+        __Pyx_TraceLine(5715,0,__PYX_ERR(0, 5715, __pyx_L1_error))
         goto __pyx_L3_continue;
 
-        /* "discretize/_extensions/tree_ext.pyx":5715
+        /* "discretize/_extensions/tree_ext.pyx":5710
  * 
  *             if zeros_out:
  *                 if (wx < -eps or wy < -eps or wz < -eps or             # <<<<<<<<<<<<<<
  *                     wx>1 + eps or wy > 1 + eps or wz > 1 + eps):
  *                     for ii in range(n_nodes):
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5714
+      /* "discretize/_extensions/tree_ext.pyx":5709
  * 
  * 
  *             if zeros_out:             # <<<<<<<<<<<<<<
  *                 if (wx < -eps or wy < -eps or wz < -eps or
  *                     wx>1 + eps or wy > 1 + eps or wz > 1 + eps):
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5722
+    /* "discretize/_extensions/tree_ext.pyx":5717
  *                     continue
  * 
  *             wx = _clip01(wx)             # <<<<<<<<<<<<<<
  *             wy = _clip01(wy)
  *             wz = _clip01(wz)
  */
-    __Pyx_TraceLine(5722,0,__PYX_ERR(0, 5722, __pyx_L1_error))
+    __Pyx_TraceLine(5717,0,__PYX_ERR(0, 5717, __pyx_L1_error))
     __pyx_v_wx = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_wx);
 
-    /* "discretize/_extensions/tree_ext.pyx":5723
+    /* "discretize/_extensions/tree_ext.pyx":5718
  * 
  *             wx = _clip01(wx)
  *             wy = _clip01(wy)             # <<<<<<<<<<<<<<
  *             wz = _clip01(wz)
  *             for ii in range(n_nodes):
  */
-    __Pyx_TraceLine(5723,0,__PYX_ERR(0, 5723, __pyx_L1_error))
+    __Pyx_TraceLine(5718,0,__PYX_ERR(0, 5718, __pyx_L1_error))
     __pyx_v_wy = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_wy);
 
-    /* "discretize/_extensions/tree_ext.pyx":5724
+    /* "discretize/_extensions/tree_ext.pyx":5719
  *             wx = _clip01(wx)
  *             wy = _clip01(wy)
  *             wz = _clip01(wz)             # <<<<<<<<<<<<<<
  *             for ii in range(n_nodes):
  *                 J[n_nodes*i + ii] = cell.points[ii].index
  */
-    __Pyx_TraceLine(5724,0,__PYX_ERR(0, 5724, __pyx_L1_error))
+    __Pyx_TraceLine(5719,0,__PYX_ERR(0, 5719, __pyx_L1_error))
     __pyx_v_wz = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_wz);
 
-    /* "discretize/_extensions/tree_ext.pyx":5725
+    /* "discretize/_extensions/tree_ext.pyx":5720
  *             wy = _clip01(wy)
  *             wz = _clip01(wz)
  *             for ii in range(n_nodes):             # <<<<<<<<<<<<<<
  *                 J[n_nodes*i + ii] = cell.points[ii].index
  * 
  */
-    __Pyx_TraceLine(5725,0,__PYX_ERR(0, 5725, __pyx_L1_error))
+    __Pyx_TraceLine(5720,0,__PYX_ERR(0, 5720, __pyx_L1_error))
     __pyx_t_19 = __pyx_v_n_nodes;
     __pyx_t_20 = __pyx_t_19;
     for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
       __pyx_v_ii = __pyx_t_21;
 
-      /* "discretize/_extensions/tree_ext.pyx":5726
+      /* "discretize/_extensions/tree_ext.pyx":5721
  *             wz = _clip01(wz)
  *             for ii in range(n_nodes):
  *                 J[n_nodes*i + ii] = cell.points[ii].index             # <<<<<<<<<<<<<<
  * 
  *             V[n_nodes*i    ] = wx*wy*wz
  */
-      __Pyx_TraceLine(5726,0,__PYX_ERR(0, 5726, __pyx_L1_error))
+      __Pyx_TraceLine(5721,0,__PYX_ERR(0, 5721, __pyx_L1_error))
       __pyx_t_22 = (__pyx_v_cell->points[__pyx_v_ii])->index;
       __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + __pyx_v_ii);
       __pyx_t_11 = -1;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_J.shape[0];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_J.shape[0])) __pyx_t_11 = 0;
       if (unlikely(__pyx_t_11 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        __PYX_ERR(0, 5726, __pyx_L1_error)
+        __PYX_ERR(0, 5721, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_J.data + __pyx_t_15 * __pyx_v_J.strides[0]) )) = __pyx_t_22;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5728
+    /* "discretize/_extensions/tree_ext.pyx":5723
  *                 J[n_nodes*i + ii] = cell.points[ii].index
  * 
  *             V[n_nodes*i    ] = wx*wy*wz             # <<<<<<<<<<<<<<
  *             V[n_nodes*i + 1] = (1 - wx)*wy*wz
  *             V[n_nodes*i + 2] = wx*(1 - wy)*wz
  */
-    __Pyx_TraceLine(5728,0,__PYX_ERR(0, 5728, __pyx_L1_error))
+    __Pyx_TraceLine(5723,0,__PYX_ERR(0, 5723, __pyx_L1_error))
     __pyx_t_15 = (__pyx_v_n_nodes * __pyx_v_i);
     __pyx_t_11 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_V.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5728, __pyx_L1_error)
+      __PYX_ERR(0, 5723, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = ((__pyx_v_wx * __pyx_v_wy) * __pyx_v_wz);
 
-    /* "discretize/_extensions/tree_ext.pyx":5729
+    /* "discretize/_extensions/tree_ext.pyx":5724
  * 
  *             V[n_nodes*i    ] = wx*wy*wz
  *             V[n_nodes*i + 1] = (1 - wx)*wy*wz             # <<<<<<<<<<<<<<
  *             V[n_nodes*i + 2] = wx*(1 - wy)*wz
  *             V[n_nodes*i + 3] = (1 - wx)*(1 - wy)*wz
  */
-    __Pyx_TraceLine(5729,0,__PYX_ERR(0, 5729, __pyx_L1_error))
+    __Pyx_TraceLine(5724,0,__PYX_ERR(0, 5724, __pyx_L1_error))
     __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + 1);
     __pyx_t_11 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_V.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5729, __pyx_L1_error)
+      __PYX_ERR(0, 5724, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = (((1.0 - __pyx_v_wx) * __pyx_v_wy) * __pyx_v_wz);
 
-    /* "discretize/_extensions/tree_ext.pyx":5730
+    /* "discretize/_extensions/tree_ext.pyx":5725
  *             V[n_nodes*i    ] = wx*wy*wz
  *             V[n_nodes*i + 1] = (1 - wx)*wy*wz
  *             V[n_nodes*i + 2] = wx*(1 - wy)*wz             # <<<<<<<<<<<<<<
  *             V[n_nodes*i + 3] = (1 - wx)*(1 - wy)*wz
  *             if dim==3:
  */
-    __Pyx_TraceLine(5730,0,__PYX_ERR(0, 5730, __pyx_L1_error))
+    __Pyx_TraceLine(5725,0,__PYX_ERR(0, 5725, __pyx_L1_error))
     __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + 2);
     __pyx_t_11 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_V.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5730, __pyx_L1_error)
+      __PYX_ERR(0, 5725, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = ((__pyx_v_wx * (1.0 - __pyx_v_wy)) * __pyx_v_wz);
 
-    /* "discretize/_extensions/tree_ext.pyx":5731
+    /* "discretize/_extensions/tree_ext.pyx":5726
  *             V[n_nodes*i + 1] = (1 - wx)*wy*wz
  *             V[n_nodes*i + 2] = wx*(1 - wy)*wz
  *             V[n_nodes*i + 3] = (1 - wx)*(1 - wy)*wz             # <<<<<<<<<<<<<<
  *             if dim==3:
  *                 V[n_nodes*i + 4] = wx*wy*(1 - wz)
  */
-    __Pyx_TraceLine(5731,0,__PYX_ERR(0, 5731, __pyx_L1_error))
+    __Pyx_TraceLine(5726,0,__PYX_ERR(0, 5726, __pyx_L1_error))
     __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + 3);
     __pyx_t_11 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_V.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
     if (unlikely(__pyx_t_11 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_11);
-      __PYX_ERR(0, 5731, __pyx_L1_error)
+      __PYX_ERR(0, 5726, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = (((1.0 - __pyx_v_wx) * (1.0 - __pyx_v_wy)) * __pyx_v_wz);
 
-    /* "discretize/_extensions/tree_ext.pyx":5732
+    /* "discretize/_extensions/tree_ext.pyx":5727
  *             V[n_nodes*i + 2] = wx*(1 - wy)*wz
  *             V[n_nodes*i + 3] = (1 - wx)*(1 - wy)*wz
  *             if dim==3:             # <<<<<<<<<<<<<<
  *                 V[n_nodes*i + 4] = wx*wy*(1 - wz)
  *                 V[n_nodes*i + 5] = (1 - wx)*wy*(1 - wz)
  */
-    __Pyx_TraceLine(5732,0,__PYX_ERR(0, 5732, __pyx_L1_error))
+    __Pyx_TraceLine(5727,0,__PYX_ERR(0, 5727, __pyx_L1_error))
     __pyx_t_17 = ((__pyx_v_dim == 3) != 0);
     if (__pyx_t_17) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5733
+      /* "discretize/_extensions/tree_ext.pyx":5728
  *             V[n_nodes*i + 3] = (1 - wx)*(1 - wy)*wz
  *             if dim==3:
  *                 V[n_nodes*i + 4] = wx*wy*(1 - wz)             # <<<<<<<<<<<<<<
  *                 V[n_nodes*i + 5] = (1 - wx)*wy*(1 - wz)
  *                 V[n_nodes*i + 6] = wx*(1 - wy)*(1 - wz)
  */
-      __Pyx_TraceLine(5733,0,__PYX_ERR(0, 5733, __pyx_L1_error))
+      __Pyx_TraceLine(5728,0,__PYX_ERR(0, 5728, __pyx_L1_error))
       __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + 4);
       __pyx_t_11 = -1;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
       if (unlikely(__pyx_t_11 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        __PYX_ERR(0, 5733, __pyx_L1_error)
+        __PYX_ERR(0, 5728, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = ((__pyx_v_wx * __pyx_v_wy) * (1.0 - __pyx_v_wz));
 
-      /* "discretize/_extensions/tree_ext.pyx":5734
+      /* "discretize/_extensions/tree_ext.pyx":5729
  *             if dim==3:
  *                 V[n_nodes*i + 4] = wx*wy*(1 - wz)
  *                 V[n_nodes*i + 5] = (1 - wx)*wy*(1 - wz)             # <<<<<<<<<<<<<<
  *                 V[n_nodes*i + 6] = wx*(1 - wy)*(1 - wz)
  *                 V[n_nodes*i + 7] = (1 - wx)*(1 - wy)*(1 - wz)
  */
-      __Pyx_TraceLine(5734,0,__PYX_ERR(0, 5734, __pyx_L1_error))
+      __Pyx_TraceLine(5729,0,__PYX_ERR(0, 5729, __pyx_L1_error))
       __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + 5);
       __pyx_t_11 = -1;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
       if (unlikely(__pyx_t_11 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        __PYX_ERR(0, 5734, __pyx_L1_error)
+        __PYX_ERR(0, 5729, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = (((1.0 - __pyx_v_wx) * __pyx_v_wy) * (1.0 - __pyx_v_wz));
 
-      /* "discretize/_extensions/tree_ext.pyx":5735
+      /* "discretize/_extensions/tree_ext.pyx":5730
  *                 V[n_nodes*i + 4] = wx*wy*(1 - wz)
  *                 V[n_nodes*i + 5] = (1 - wx)*wy*(1 - wz)
  *                 V[n_nodes*i + 6] = wx*(1 - wy)*(1 - wz)             # <<<<<<<<<<<<<<
  *                 V[n_nodes*i + 7] = (1 - wx)*(1 - wy)*(1 - wz)
  * 
  */
-      __Pyx_TraceLine(5735,0,__PYX_ERR(0, 5735, __pyx_L1_error))
+      __Pyx_TraceLine(5730,0,__PYX_ERR(0, 5730, __pyx_L1_error))
       __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + 6);
       __pyx_t_11 = -1;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
       if (unlikely(__pyx_t_11 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        __PYX_ERR(0, 5735, __pyx_L1_error)
+        __PYX_ERR(0, 5730, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = ((__pyx_v_wx * (1.0 - __pyx_v_wy)) * (1.0 - __pyx_v_wz));
 
-      /* "discretize/_extensions/tree_ext.pyx":5736
+      /* "discretize/_extensions/tree_ext.pyx":5731
  *                 V[n_nodes*i + 5] = (1 - wx)*wy*(1 - wz)
  *                 V[n_nodes*i + 6] = wx*(1 - wy)*(1 - wz)
  *                 V[n_nodes*i + 7] = (1 - wx)*(1 - wy)*(1 - wz)             # <<<<<<<<<<<<<<
  * 
  *         Rn = self._deflate_nodes()
  */
-      __Pyx_TraceLine(5736,0,__PYX_ERR(0, 5736, __pyx_L1_error))
+      __Pyx_TraceLine(5731,0,__PYX_ERR(0, 5731, __pyx_L1_error))
       __pyx_t_15 = ((__pyx_v_n_nodes * __pyx_v_i) + 7);
       __pyx_t_11 = -1;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_V.shape[0];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_11 = 0;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_V.shape[0])) __pyx_t_11 = 0;
       if (unlikely(__pyx_t_11 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_11);
-        __PYX_ERR(0, 5736, __pyx_L1_error)
+        __PYX_ERR(0, 5731, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_V.data + __pyx_t_15 * __pyx_v_V.strides[0]) )) = (((1.0 - __pyx_v_wx) * (1.0 - __pyx_v_wy)) * (1.0 - __pyx_v_wz));
 
-      /* "discretize/_extensions/tree_ext.pyx":5732
+      /* "discretize/_extensions/tree_ext.pyx":5727
  *             V[n_nodes*i + 2] = wx*(1 - wy)*wz
  *             V[n_nodes*i + 3] = (1 - wx)*(1 - wy)*wz
  *             if dim==3:             # <<<<<<<<<<<<<<
  *                 V[n_nodes*i + 4] = wx*wy*(1 - wz)
  *                 V[n_nodes*i + 5] = (1 - wx)*wy*(1 - wz)
  */
     }
     __pyx_L3_continue:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5738
+  /* "discretize/_extensions/tree_ext.pyx":5733
  *                 V[n_nodes*i + 7] = (1 - wx)*(1 - wy)*(1 - wz)
  * 
  *         Rn = self._deflate_nodes()             # <<<<<<<<<<<<<<
  *         return sp.csr_matrix((V, (I, J)), shape=(locs.shape[0],self.n_total_nodes))*Rn
  * 
  */
-  __Pyx_TraceLine(5738,0,__PYX_ERR(0, 5738, __pyx_L1_error))
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5738, __pyx_L1_error)
+  __Pyx_TraceLine(5733,0,__PYX_ERR(0, 5733, __pyx_L1_error))
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_deflate_nodes); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5733, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_t_6 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
     __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
     if (likely(__pyx_t_6)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
       __Pyx_INCREF(__pyx_t_6);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_5, function);
     }
   }
   __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5738, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5733, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_Rn = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5739
+  /* "discretize/_extensions/tree_ext.pyx":5734
  * 
  *         Rn = self._deflate_nodes()
  *         return sp.csr_matrix((V, (I, J)), shape=(locs.shape[0],self.n_total_nodes))*Rn             # <<<<<<<<<<<<<<
  * 
- *     def _getCellIntMat(self, locs, zerosOutside):
+ *     def _getCellIntMat(self, locs, zeros_outside):
  */
-  __Pyx_TraceLine(5739,0,__PYX_ERR(0, 5739, __pyx_L1_error))
+  __Pyx_TraceLine(5734,0,__PYX_ERR(0, 5734, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_sp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_V, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_I, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_J, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_7);
   __pyx_t_6 = 0;
   __pyx_t_7 = 0;
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_4);
   __pyx_t_3 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_nodes); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_23 = PyTuple_New(2); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_23 = PyTuple_New(2); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_23);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_23, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_23, 1, __pyx_t_3);
   __pyx_t_6 = 0;
   __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_shape, __pyx_t_23) < 0) __PYX_ERR(0, 5739, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_shape, __pyx_t_23) < 0) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
-  __pyx_t_23 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_23 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_23);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = PyNumber_Multiply(__pyx_t_23, __pyx_v_Rn); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5739, __pyx_L1_error)
+  __pyx_t_7 = PyNumber_Multiply(__pyx_t_23, __pyx_v_Rn); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5734, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_23); __pyx_t_23 = 0;
   __pyx_r = __pyx_t_7;
   __pyx_t_7 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5676
+  /* "discretize/_extensions/tree_ext.pyx":5671
  *         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_faces))*Rf
  * 
- *     def _getNodeIntMat(self, locs, zerosOutside):             # <<<<<<<<<<<<<<
+ *     def _getNodeIntMat(self, locs, zeros_outside):             # <<<<<<<<<<<<<<
  *         cdef:
  *             double[:, :] locations = locs
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
@@ -71215,36 +71227,36 @@
   __Pyx_XDECREF(__pyx_v_Rn);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5741
+/* "discretize/_extensions/tree_ext.pyx":5736
  *         return sp.csr_matrix((V, (I, J)), shape=(locs.shape[0],self.n_total_nodes))*Rn
  * 
- *     def _getCellIntMat(self, locs, zerosOutside):             # <<<<<<<<<<<<<<
+ *     def _getCellIntMat(self, locs, zeros_outside):             # <<<<<<<<<<<<<<
  *         cdef:
  *             double[:, :] locations = locs
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_87_getCellIntMat(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_86_getCellIntMat[] = "_TreeMesh._getCellIntMat(self, locs, zerosOutside)";
+static char __pyx_doc_10discretize_11_extensions_8tree_ext_9_TreeMesh_86_getCellIntMat[] = "_TreeMesh._getCellIntMat(self, locs, zeros_outside)";
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_87_getCellIntMat(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_locs = 0;
-  PyObject *__pyx_v_zerosOutside = 0;
+  PyObject *__pyx_v_zeros_outside = 0;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("_getCellIntMat (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_locs,&__pyx_n_s_zerosOutside,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_locs,&__pyx_n_s_zeros_outside,0};
     PyObject* values[2] = {0,0};
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
       switch (pos_args) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -71256,47 +71268,47 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_locs)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zerosOutside)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_zeros_outside)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("_getCellIntMat", 1, 2, 2, 1); __PYX_ERR(0, 5741, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("_getCellIntMat", 1, 2, 2, 1); __PYX_ERR(0, 5736, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getCellIntMat") < 0)) __PYX_ERR(0, 5741, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_getCellIntMat") < 0)) __PYX_ERR(0, 5736, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_locs = values[0];
-    __pyx_v_zerosOutside = values[1];
+    __pyx_v_zeros_outside = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_getCellIntMat", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5741, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_getCellIntMat", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 5736, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._getCellIntMat", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_86_getCellIntMat(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_locs, __pyx_v_zerosOutside);
+  __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_86_getCellIntMat(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_locs, __pyx_v_zeros_outside);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_86_getCellIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zerosOutside) {
+static PyObject *__pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_86_getCellIntMat(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self, PyObject *__pyx_v_locs, PyObject *__pyx_v_zeros_outside) {
   __Pyx_memviewslice __pyx_v_locations = { 0, 0, { 0 }, { 0 }, { 0 } };
   int_t __pyx_v_dim;
   int_t __pyx_v_dir0;
   int_t __pyx_v_dir1;
   int_t __pyx_v_dir2;
   int_t __pyx_v_temp;
   int_t __pyx_v_n_loc;
@@ -71350,400 +71362,400 @@
   double __pyx_t_21;
   __pyx_t_5numpy_float64_t __pyx_t_22;
   PY_LONG_LONG __pyx_t_23;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_getCellIntMat", 0);
-  __Pyx_TraceCall("_getCellIntMat", __pyx_f[0], 5741, 0, __PYX_ERR(0, 5741, __pyx_L1_error));
+  __Pyx_TraceCall("_getCellIntMat", __pyx_f[0], 5736, 0, __PYX_ERR(0, 5736, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5743
- *     def _getCellIntMat(self, locs, zerosOutside):
+  /* "discretize/_extensions/tree_ext.pyx":5738
+ *     def _getCellIntMat(self, locs, zeros_outside):
  *         cdef:
  *             double[:, :] locations = locs             # <<<<<<<<<<<<<<
  *             int_t dim = self._dim
  *             int_t dir0, dir1, dir2, temp
  */
-  __Pyx_TraceLine(5743,0,__PYX_ERR(0, 5743, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 5743, __pyx_L1_error)
+  __Pyx_TraceLine(5738,0,__PYX_ERR(0, 5738, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_dsds_double(__pyx_v_locs, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 5738, __pyx_L1_error)
   __pyx_v_locations = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5744
+  /* "discretize/_extensions/tree_ext.pyx":5739
  *         cdef:
  *             double[:, :] locations = locs
  *             int_t dim = self._dim             # <<<<<<<<<<<<<<
  *             int_t dir0, dir1, dir2, temp
  *             int_t n_loc = locations.shape[0]
  */
-  __Pyx_TraceLine(5744,0,__PYX_ERR(0, 5744, __pyx_L1_error))
+  __Pyx_TraceLine(5739,0,__PYX_ERR(0, 5739, __pyx_L1_error))
   __pyx_t_2 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5746
+  /* "discretize/_extensions/tree_ext.pyx":5741
  *             int_t dim = self._dim
  *             int_t dir0, dir1, dir2, temp
  *             int_t n_loc = locations.shape[0]             # <<<<<<<<<<<<<<
  *             int_t n_cells = 4 if dim == 2 else 8
  *             np.int64_t[:] indptr = n_cells * np.arange(n_loc+1, dtype=np.int64)
  */
-  __Pyx_TraceLine(5746,0,__PYX_ERR(0, 5746, __pyx_L1_error))
+  __Pyx_TraceLine(5741,0,__PYX_ERR(0, 5741, __pyx_L1_error))
   __pyx_v_n_loc = (__pyx_v_locations.shape[0]);
 
-  /* "discretize/_extensions/tree_ext.pyx":5747
+  /* "discretize/_extensions/tree_ext.pyx":5742
  *             int_t dir0, dir1, dir2, temp
  *             int_t n_loc = locations.shape[0]
  *             int_t n_cells = 4 if dim == 2 else 8             # <<<<<<<<<<<<<<
  *             np.int64_t[:] indptr = n_cells * np.arange(n_loc+1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_cells * n_loc, dtype=np.int64)
  */
-  __Pyx_TraceLine(5747,0,__PYX_ERR(0, 5747, __pyx_L1_error))
+  __Pyx_TraceLine(5742,0,__PYX_ERR(0, 5742, __pyx_L1_error))
   if (((__pyx_v_dim == 2) != 0)) {
     __pyx_t_2 = 4;
   } else {
     __pyx_t_2 = 8;
   }
   __pyx_v_n_cells = __pyx_t_2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5748
+  /* "discretize/_extensions/tree_ext.pyx":5743
  *             int_t n_loc = locations.shape[0]
  *             int_t n_cells = 4 if dim == 2 else 8
  *             np.int64_t[:] indptr = n_cells * np.arange(n_loc+1, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.int64_t[:] indices = np.empty(n_cells * n_loc, dtype=np.int64)
  *             np.float64_t[:] data = np.ones(n_cells * n_loc, dtype=np.float64)
  */
-  __Pyx_TraceLine(5748,0,__PYX_ERR(0, 5748, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyInt_From_int_t(__pyx_v_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __Pyx_TraceLine(5743,0,__PYX_ERR(0, 5743, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyInt_From_int_t(__pyx_v_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_long((__pyx_v_n_loc + 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_long((__pyx_v_n_loc + 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 5748, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_8) < 0) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyNumber_Multiply(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __pyx_t_4 = PyNumber_Multiply(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5748, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_4, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5743, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_v_indptr = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5749
+  /* "discretize/_extensions/tree_ext.pyx":5744
  *             int_t n_cells = 4 if dim == 2 else 8
  *             np.int64_t[:] indptr = n_cells * np.arange(n_loc+1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_cells * n_loc, dtype=np.int64)             # <<<<<<<<<<<<<<
  *             np.float64_t[:] data = np.ones(n_cells * n_loc, dtype=np.float64)
  * 
  */
-  __Pyx_TraceLine(5749,0,__PYX_ERR(0, 5749, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __Pyx_TraceLine(5744,0,__PYX_ERR(0, 5744, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyInt_From_int_t((__pyx_v_n_cells * __pyx_v_n_loc)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int_t((__pyx_v_n_cells * __pyx_v_n_loc)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
   __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5749, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5749, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_5, PyBUF_WRITABLE); if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 5744, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_indices = __pyx_t_9;
   __pyx_t_9.memview = NULL;
   __pyx_t_9.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5750
+  /* "discretize/_extensions/tree_ext.pyx":5745
  *             np.int64_t[:] indptr = n_cells * np.arange(n_loc+1, dtype=np.int64)
  *             np.int64_t[:] indices = np.empty(n_cells * n_loc, dtype=np.int64)
  *             np.float64_t[:] data = np.ones(n_cells * n_loc, dtype=np.float64)             # <<<<<<<<<<<<<<
  * 
  *             np.int64_t[:] row_inds
  */
-  __Pyx_TraceLine(5750,0,__PYX_ERR(0, 5750, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __Pyx_TraceLine(5745,0,__PYX_ERR(0, 5745, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_ones); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_n_cells * __pyx_v_n_loc)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_From_int_t((__pyx_v_n_cells * __pyx_v_n_loc)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5750, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 5750, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_10.memview)) __PYX_ERR(0, 5745, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_data = __pyx_t_10;
   __pyx_t_10.memview = NULL;
   __pyx_t_10.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5760
+  /* "discretize/_extensions/tree_ext.pyx":5755
  *             c_Cell *cell
  *             double x, y, z
  *             double eps = 100*np.finfo(float).eps             # <<<<<<<<<<<<<<
- *             int zeros_out = zerosOutside
+ *             int zeros_out = zeros_outside
  * 
  */
-  __Pyx_TraceLine(5760,0,__PYX_ERR(0, 5760, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5760, __pyx_L1_error)
+  __Pyx_TraceLine(5755,0,__PYX_ERR(0, 5755, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_finfo); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5760, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_finfo); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, ((PyObject *)(&PyFloat_Type))) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)(&PyFloat_Type)));
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5760, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_eps); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5760, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_eps); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyNumber_Multiply(__pyx_int_100, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5760, __pyx_L1_error)
+  __pyx_t_6 = PyNumber_Multiply(__pyx_int_100, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5755, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5760, __pyx_L1_error)
+  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5755, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_eps = __pyx_t_11;
 
-  /* "discretize/_extensions/tree_ext.pyx":5761
+  /* "discretize/_extensions/tree_ext.pyx":5756
  *             double x, y, z
  *             double eps = 100*np.finfo(float).eps
- *             int zeros_out = zerosOutside             # <<<<<<<<<<<<<<
+ *             int zeros_out = zeros_outside             # <<<<<<<<<<<<<<
  * 
  *         dir0 = 0
  */
-  __Pyx_TraceLine(5761,0,__PYX_ERR(0, 5761, __pyx_L1_error))
-  __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_zerosOutside); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5761, __pyx_L1_error)
+  __Pyx_TraceLine(5756,0,__PYX_ERR(0, 5756, __pyx_L1_error))
+  __pyx_t_12 = __Pyx_PyInt_As_int(__pyx_v_zeros_outside); if (unlikely((__pyx_t_12 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 5756, __pyx_L1_error)
   __pyx_v_zeros_out = __pyx_t_12;
 
-  /* "discretize/_extensions/tree_ext.pyx":5763
- *             int zeros_out = zerosOutside
+  /* "discretize/_extensions/tree_ext.pyx":5758
+ *             int zeros_out = zeros_outside
  * 
  *         dir0 = 0             # <<<<<<<<<<<<<<
  *         dir1 = 1
  *         dir2 = 2
  */
-  __Pyx_TraceLine(5763,0,__PYX_ERR(0, 5763, __pyx_L1_error))
+  __Pyx_TraceLine(5758,0,__PYX_ERR(0, 5758, __pyx_L1_error))
   __pyx_v_dir0 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5764
+  /* "discretize/_extensions/tree_ext.pyx":5759
  * 
  *         dir0 = 0
  *         dir1 = 1             # <<<<<<<<<<<<<<
  *         dir2 = 2
  * 
  */
-  __Pyx_TraceLine(5764,0,__PYX_ERR(0, 5764, __pyx_L1_error))
+  __Pyx_TraceLine(5759,0,__PYX_ERR(0, 5759, __pyx_L1_error))
   __pyx_v_dir1 = 1;
 
-  /* "discretize/_extensions/tree_ext.pyx":5765
+  /* "discretize/_extensions/tree_ext.pyx":5760
  *         dir0 = 0
  *         dir1 = 1
  *         dir2 = 2             # <<<<<<<<<<<<<<
  * 
  *         for i in range(n_loc):
  */
-  __Pyx_TraceLine(5765,0,__PYX_ERR(0, 5765, __pyx_L1_error))
+  __Pyx_TraceLine(5760,0,__PYX_ERR(0, 5760, __pyx_L1_error))
   __pyx_v_dir2 = 2;
 
-  /* "discretize/_extensions/tree_ext.pyx":5767
+  /* "discretize/_extensions/tree_ext.pyx":5762
  *         dir2 = 2
  * 
  *         for i in range(n_loc):             # <<<<<<<<<<<<<<
  *             x = locations[i, 0]
  *             y = locations[i, 1]
  */
-  __Pyx_TraceLine(5767,0,__PYX_ERR(0, 5767, __pyx_L1_error))
+  __Pyx_TraceLine(5762,0,__PYX_ERR(0, 5762, __pyx_L1_error))
   __pyx_t_2 = __pyx_v_n_loc;
   __pyx_t_13 = __pyx_t_2;
   for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
     __pyx_v_i = __pyx_t_14;
 
-    /* "discretize/_extensions/tree_ext.pyx":5768
+    /* "discretize/_extensions/tree_ext.pyx":5763
  * 
  *         for i in range(n_loc):
  *             x = locations[i, 0]             # <<<<<<<<<<<<<<
  *             y = locations[i, 1]
  *             z = locations[i, 2] if dim==3 else 0.0
  */
-    __Pyx_TraceLine(5768,0,__PYX_ERR(0, 5768, __pyx_L1_error))
+    __Pyx_TraceLine(5763,0,__PYX_ERR(0, 5763, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_i;
     __pyx_t_16 = 0;
     __pyx_t_12 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_locations.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_locations.shape[1];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5768, __pyx_L1_error)
+      __PYX_ERR(0, 5763, __pyx_L1_error)
     }
     __pyx_v_x = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_15 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5769
+    /* "discretize/_extensions/tree_ext.pyx":5764
  *         for i in range(n_loc):
  *             x = locations[i, 0]
  *             y = locations[i, 1]             # <<<<<<<<<<<<<<
  *             z = locations[i, 2] if dim==3 else 0.0
  *             # get containing (or closest) cell
  */
-    __Pyx_TraceLine(5769,0,__PYX_ERR(0, 5769, __pyx_L1_error))
+    __Pyx_TraceLine(5764,0,__PYX_ERR(0, 5764, __pyx_L1_error))
     __pyx_t_16 = __pyx_v_i;
     __pyx_t_15 = 1;
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_locations.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_locations.shape[1];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 1;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5769, __pyx_L1_error)
+      __PYX_ERR(0, 5764, __pyx_L1_error)
     }
     __pyx_v_y = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_15 * __pyx_v_locations.strides[1]) )));
 
-    /* "discretize/_extensions/tree_ext.pyx":5770
+    /* "discretize/_extensions/tree_ext.pyx":5765
  *             x = locations[i, 0]
  *             y = locations[i, 1]
  *             z = locations[i, 2] if dim==3 else 0.0             # <<<<<<<<<<<<<<
  *             # get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)
  */
-    __Pyx_TraceLine(5770,0,__PYX_ERR(0, 5770, __pyx_L1_error))
+    __Pyx_TraceLine(5765,0,__PYX_ERR(0, 5765, __pyx_L1_error))
     if (((__pyx_v_dim == 3) != 0)) {
       __pyx_t_15 = __pyx_v_i;
       __pyx_t_16 = 2;
       __pyx_t_12 = -1;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5770, __pyx_L1_error)
+        __PYX_ERR(0, 5765, __pyx_L1_error)
       }
       __pyx_t_11 = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_15 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) )));
     } else {
       __pyx_t_11 = 0.0;
     }
     __pyx_v_z = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":5772
+    /* "discretize/_extensions/tree_ext.pyx":5767
  *             z = locations[i, 2] if dim==3 else 0.0
  *             # get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)             # <<<<<<<<<<<<<<
  *             row_inds = indices[indptr[i]:indptr[i + 1]]
  *             row_data = data[indptr[i]:indptr[i + 1]]
  */
-    __Pyx_TraceLine(5772,0,__PYX_ERR(0, 5772, __pyx_L1_error))
+    __Pyx_TraceLine(5767,0,__PYX_ERR(0, 5767, __pyx_L1_error))
     __pyx_v_cell = __pyx_v_self->tree->containing_cell(__pyx_v_x, __pyx_v_y, __pyx_v_z);
 
-    /* "discretize/_extensions/tree_ext.pyx":5773
+    /* "discretize/_extensions/tree_ext.pyx":5768
  *             # get containing (or closest) cell
  *             cell = self.tree.containing_cell(x, y, z)
  *             row_inds = indices[indptr[i]:indptr[i + 1]]             # <<<<<<<<<<<<<<
  *             row_data = data[indptr[i]:indptr[i + 1]]
  *             if zeros_out:
  */
-    __Pyx_TraceLine(5773,0,__PYX_ERR(0, 5773, __pyx_L1_error))
+    __Pyx_TraceLine(5768,0,__PYX_ERR(0, 5768, __pyx_L1_error))
     __pyx_t_16 = __pyx_v_i;
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5773, __pyx_L1_error)
+      __PYX_ERR(0, 5768, __pyx_L1_error)
     }
     __pyx_t_15 = (__pyx_v_i + 1);
     __pyx_t_12 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5773, __pyx_L1_error)
+      __PYX_ERR(0, 5768, __pyx_L1_error)
     }
     __pyx_t_9.data = __pyx_v_indices.data;
     __pyx_t_9.memview = __pyx_v_indices.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_9, 0);
     __pyx_t_12 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_9,
@@ -71755,49 +71767,49 @@
     (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_15 * __pyx_v_indptr.strides[0]) ))),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 5773, __pyx_L1_error)
+    __PYX_ERR(0, 5768, __pyx_L1_error)
 }
 
 __PYX_XDEC_MEMVIEW(&__pyx_v_row_inds, 1);
     __pyx_v_row_inds = __pyx_t_9;
     __pyx_t_9.memview = NULL;
     __pyx_t_9.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5774
+    /* "discretize/_extensions/tree_ext.pyx":5769
  *             cell = self.tree.containing_cell(x, y, z)
  *             row_inds = indices[indptr[i]:indptr[i + 1]]
  *             row_data = data[indptr[i]:indptr[i + 1]]             # <<<<<<<<<<<<<<
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:
  */
-    __Pyx_TraceLine(5774,0,__PYX_ERR(0, 5774, __pyx_L1_error))
+    __Pyx_TraceLine(5769,0,__PYX_ERR(0, 5769, __pyx_L1_error))
     __pyx_t_15 = __pyx_v_i;
     __pyx_t_12 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5774, __pyx_L1_error)
+      __PYX_ERR(0, 5769, __pyx_L1_error)
     }
     __pyx_t_16 = (__pyx_v_i + 1);
     __pyx_t_12 = -1;
     if (__pyx_t_16 < 0) {
       __pyx_t_16 += __pyx_v_indptr.shape[0];
       if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_16 >= __pyx_v_indptr.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 5774, __pyx_L1_error)
+      __PYX_ERR(0, 5769, __pyx_L1_error)
     }
     __pyx_t_10.data = __pyx_v_data.data;
     __pyx_t_10.memview = __pyx_v_data.memview;
     __PYX_INC_MEMVIEW(&__pyx_t_10, 0);
     __pyx_t_12 = -1;
     if (unlikely(__pyx_memoryview_slice_memviewslice(
     &__pyx_t_10,
@@ -71809,52 +71821,52 @@
     (*((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_16 * __pyx_v_indptr.strides[0]) ))),
     0,
     1,
     1,
     0,
     1) < 0))
 {
-    __PYX_ERR(0, 5774, __pyx_L1_error)
+    __PYX_ERR(0, 5769, __pyx_L1_error)
 }
 
 __PYX_XDEC_MEMVIEW(&__pyx_v_row_data, 1);
     __pyx_v_row_data = __pyx_t_10;
     __pyx_t_10.memview = NULL;
     __pyx_t_10.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":5775
+    /* "discretize/_extensions/tree_ext.pyx":5770
  *             row_inds = indices[indptr[i]:indptr[i + 1]]
  *             row_data = data[indptr[i]:indptr[i + 1]]
  *             if zeros_out:             # <<<<<<<<<<<<<<
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  */
-    __Pyx_TraceLine(5775,0,__PYX_ERR(0, 5775, __pyx_L1_error))
+    __Pyx_TraceLine(5770,0,__PYX_ERR(0, 5770, __pyx_L1_error))
     __pyx_t_17 = (__pyx_v_zeros_out != 0);
     if (__pyx_t_17) {
 
-      /* "discretize/_extensions/tree_ext.pyx":5776
+      /* "discretize/_extensions/tree_ext.pyx":5771
  *             row_data = data[indptr[i]:indptr[i + 1]]
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5776,0,__PYX_ERR(0, 5776, __pyx_L1_error))
+      __Pyx_TraceLine(5771,0,__PYX_ERR(0, 5771, __pyx_L1_error))
       __pyx_t_17 = ((__pyx_v_x < (((__pyx_v_cell->points[0])->location[0]) - __pyx_v_eps)) != 0);
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5777
+        /* "discretize/_extensions/tree_ext.pyx":5772
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:
  */
-        __Pyx_TraceLine(5777,0,__PYX_ERR(0, 5777, __pyx_L1_error))
+        __Pyx_TraceLine(5772,0,__PYX_ERR(0, 5772, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -71862,22 +71874,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5778
+        /* "discretize/_extensions/tree_ext.pyx":5773
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5778,0,__PYX_ERR(0, 5778, __pyx_L1_error))
+        __Pyx_TraceLine(5773,0,__PYX_ERR(0, 5773, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -71885,43 +71897,43 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5776
+        /* "discretize/_extensions/tree_ext.pyx":5771
  *             row_data = data[indptr[i]:indptr[i + 1]]
  *             if zeros_out:
  *                 if x < cell.points[0].location[0]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L6;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5779
+      /* "discretize/_extensions/tree_ext.pyx":5774
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5779,0,__PYX_ERR(0, 5779, __pyx_L1_error))
+      __Pyx_TraceLine(5774,0,__PYX_ERR(0, 5774, __pyx_L1_error))
       __pyx_t_17 = ((__pyx_v_x > (((__pyx_v_cell->points[3])->location[0]) + __pyx_v_eps)) != 0);
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5780
+        /* "discretize/_extensions/tree_ext.pyx":5775
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:
  */
-        __Pyx_TraceLine(5780,0,__PYX_ERR(0, 5780, __pyx_L1_error))
+        __Pyx_TraceLine(5775,0,__PYX_ERR(0, 5775, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -71929,22 +71941,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5781
+        /* "discretize/_extensions/tree_ext.pyx":5776
  *                 elif x > cell.points[3].location[0]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5781,0,__PYX_ERR(0, 5781, __pyx_L1_error))
+        __Pyx_TraceLine(5776,0,__PYX_ERR(0, 5776, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -71952,43 +71964,43 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5779
+        /* "discretize/_extensions/tree_ext.pyx":5774
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif x > cell.points[3].location[0]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L6;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5782
+      /* "discretize/_extensions/tree_ext.pyx":5777
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5782,0,__PYX_ERR(0, 5782, __pyx_L1_error))
+      __Pyx_TraceLine(5777,0,__PYX_ERR(0, 5777, __pyx_L1_error))
       __pyx_t_17 = ((__pyx_v_y < (((__pyx_v_cell->points[0])->location[1]) - __pyx_v_eps)) != 0);
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5783
+        /* "discretize/_extensions/tree_ext.pyx":5778
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:
  */
-        __Pyx_TraceLine(5783,0,__PYX_ERR(0, 5783, __pyx_L1_error))
+        __Pyx_TraceLine(5778,0,__PYX_ERR(0, 5778, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -71996,22 +72008,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5784
+        /* "discretize/_extensions/tree_ext.pyx":5779
  *                 elif y < cell.points[0].location[1]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5784,0,__PYX_ERR(0, 5784, __pyx_L1_error))
+        __Pyx_TraceLine(5779,0,__PYX_ERR(0, 5779, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -72019,43 +72031,43 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5782
+        /* "discretize/_extensions/tree_ext.pyx":5777
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y < cell.points[0].location[1]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L6;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5785
+      /* "discretize/_extensions/tree_ext.pyx":5780
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5785,0,__PYX_ERR(0, 5785, __pyx_L1_error))
+      __Pyx_TraceLine(5780,0,__PYX_ERR(0, 5780, __pyx_L1_error))
       __pyx_t_17 = ((__pyx_v_y > (((__pyx_v_cell->points[3])->location[1]) + __pyx_v_eps)) != 0);
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5786
+        /* "discretize/_extensions/tree_ext.pyx":5781
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  */
-        __Pyx_TraceLine(5786,0,__PYX_ERR(0, 5786, __pyx_L1_error))
+        __Pyx_TraceLine(5781,0,__PYX_ERR(0, 5781, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -72063,22 +72075,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5787
+        /* "discretize/_extensions/tree_ext.pyx":5782
  *                 elif y > cell.points[3].location[1]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5787,0,__PYX_ERR(0, 5787, __pyx_L1_error))
+        __Pyx_TraceLine(5782,0,__PYX_ERR(0, 5782, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -72086,51 +72098,51 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5785
+        /* "discretize/_extensions/tree_ext.pyx":5780
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif y > cell.points[3].location[1]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L6;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5788
+      /* "discretize/_extensions/tree_ext.pyx":5783
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5788,0,__PYX_ERR(0, 5788, __pyx_L1_error))
+      __Pyx_TraceLine(5783,0,__PYX_ERR(0, 5783, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L7_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_z < (((__pyx_v_cell->points[0])->location[2]) - __pyx_v_eps)) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L7_bool_binop_done:;
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5789
+        /* "discretize/_extensions/tree_ext.pyx":5784
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  */
-        __Pyx_TraceLine(5789,0,__PYX_ERR(0, 5789, __pyx_L1_error))
+        __Pyx_TraceLine(5784,0,__PYX_ERR(0, 5784, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -72138,22 +72150,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5790
+        /* "discretize/_extensions/tree_ext.pyx":5785
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0
  */
-        __Pyx_TraceLine(5790,0,__PYX_ERR(0, 5790, __pyx_L1_error))
+        __Pyx_TraceLine(5785,0,__PYX_ERR(0, 5785, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -72161,51 +72173,51 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5788
+        /* "discretize/_extensions/tree_ext.pyx":5783
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z < cell.points[0].location[2]-eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
         goto __pyx_L6;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5791
+      /* "discretize/_extensions/tree_ext.pyx":5786
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
-      __Pyx_TraceLine(5791,0,__PYX_ERR(0, 5791, __pyx_L1_error))
+      __Pyx_TraceLine(5786,0,__PYX_ERR(0, 5786, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L9_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_z > (((__pyx_v_cell->points[7])->location[2]) + __pyx_v_eps)) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L9_bool_binop_done:;
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5792
+        /* "discretize/_extensions/tree_ext.pyx":5787
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0             # <<<<<<<<<<<<<<
  *                     row_inds[:] = 0
  *             else:
  */
-        __Pyx_TraceLine(5792,0,__PYX_ERR(0, 5792, __pyx_L1_error))
+        __Pyx_TraceLine(5787,0,__PYX_ERR(0, 5787, __pyx_L1_error))
         {
             __pyx_t_5numpy_float64_t __pyx_temp_scalar = 0.0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_data.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_data.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -72213,22 +72225,22 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_float64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5793
+        /* "discretize/_extensions/tree_ext.pyx":5788
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0             # <<<<<<<<<<<<<<
  *             else:
  *                 # decide order to search based on distance to each faces
  */
-        __Pyx_TraceLine(5793,0,__PYX_ERR(0, 5793, __pyx_L1_error))
+        __Pyx_TraceLine(5788,0,__PYX_ERR(0, 5788, __pyx_L1_error))
         {
             __pyx_t_5numpy_int64_t __pyx_temp_scalar = 0;
             {
                 Py_ssize_t __pyx_temp_extent_0 = __pyx_v_row_inds.shape[0];
                 Py_ssize_t __pyx_temp_stride_0 = __pyx_v_row_inds.strides[0];
                 char *__pyx_temp_pointer_0;
                 Py_ssize_t __pyx_temp_idx_0;
@@ -72236,2419 +72248,2419 @@
                 for (__pyx_temp_idx_0 = 0; __pyx_temp_idx_0 < __pyx_temp_extent_0; __pyx_temp_idx_0++) {
                   *((__pyx_t_5numpy_int64_t *) __pyx_temp_pointer_0) = __pyx_temp_scalar;
                   __pyx_temp_pointer_0 += __pyx_temp_stride_0;
                 }
             }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5791
+        /* "discretize/_extensions/tree_ext.pyx":5786
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  *                 elif dim == 3 and z > cell.points[7].location[2]+eps:             # <<<<<<<<<<<<<<
  *                     row_data[:] = 0.0
  *                     row_inds[:] = 0
  */
       }
       __pyx_L6:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5775
+      /* "discretize/_extensions/tree_ext.pyx":5770
  *             row_inds = indices[indptr[i]:indptr[i + 1]]
  *             row_data = data[indptr[i]:indptr[i + 1]]
  *             if zeros_out:             # <<<<<<<<<<<<<<
  *                 if x < cell.points[0].location[0]-eps:
  *                     row_data[:] = 0.0
  */
       goto __pyx_L5;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5797
+    /* "discretize/_extensions/tree_ext.pyx":5792
  *                 # decide order to search based on distance to each faces
  *                 #
  *                 if (             # <<<<<<<<<<<<<<
  *                     abs(locations[i, dir0] - cell.location[dir0]) <
  *                     abs(locations[i, dir1] - cell.location[dir1])
  */
-    __Pyx_TraceLine(5797,0,__PYX_ERR(0, 5797, __pyx_L1_error))
+    __Pyx_TraceLine(5792,0,__PYX_ERR(0, 5792, __pyx_L1_error))
     /*else*/ {
 
-      /* "discretize/_extensions/tree_ext.pyx":5798
+      /* "discretize/_extensions/tree_ext.pyx":5793
  *                 #
  *                 if (
  *                     abs(locations[i, dir0] - cell.location[dir0]) <             # <<<<<<<<<<<<<<
  *                     abs(locations[i, dir1] - cell.location[dir1])
  *                 ):
  */
-      __Pyx_TraceLine(5798,0,__PYX_ERR(0, 5798, __pyx_L1_error))
+      __Pyx_TraceLine(5793,0,__PYX_ERR(0, 5793, __pyx_L1_error))
       __pyx_t_16 = __pyx_v_i;
       __pyx_t_15 = __pyx_v_dir0;
       __pyx_t_12 = -1;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5798, __pyx_L1_error)
+        __PYX_ERR(0, 5793, __pyx_L1_error)
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5799
+      /* "discretize/_extensions/tree_ext.pyx":5794
  *                 if (
  *                     abs(locations[i, dir0] - cell.location[dir0]) <
  *                     abs(locations[i, dir1] - cell.location[dir1])             # <<<<<<<<<<<<<<
  *                 ):
  *                     temp = dir0
  */
-      __Pyx_TraceLine(5799,0,__PYX_ERR(0, 5799, __pyx_L1_error))
+      __Pyx_TraceLine(5794,0,__PYX_ERR(0, 5794, __pyx_L1_error))
       __pyx_t_19 = __pyx_v_i;
       __pyx_t_20 = __pyx_v_dir1;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5799, __pyx_L1_error)
+        __PYX_ERR(0, 5794, __pyx_L1_error)
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5798
+      /* "discretize/_extensions/tree_ext.pyx":5793
  *                 #
  *                 if (
  *                     abs(locations[i, dir0] - cell.location[dir0]) <             # <<<<<<<<<<<<<<
  *                     abs(locations[i, dir1] - cell.location[dir1])
  *                 ):
  */
-      __Pyx_TraceLine(5798,0,__PYX_ERR(0, 5798, __pyx_L1_error))
+      __Pyx_TraceLine(5793,0,__PYX_ERR(0, 5793, __pyx_L1_error))
       __pyx_t_17 = ((fabs(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_15 * __pyx_v_locations.strides[1]) ))) - (__pyx_v_cell->location[__pyx_v_dir0]))) < fabs(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))) - (__pyx_v_cell->location[__pyx_v_dir1])))) != 0);
 
-      /* "discretize/_extensions/tree_ext.pyx":5797
+      /* "discretize/_extensions/tree_ext.pyx":5792
  *                 # decide order to search based on distance to each faces
  *                 #
  *                 if (             # <<<<<<<<<<<<<<
  *                     abs(locations[i, dir0] - cell.location[dir0]) <
  *                     abs(locations[i, dir1] - cell.location[dir1])
  */
-      __Pyx_TraceLine(5797,0,__PYX_ERR(0, 5797, __pyx_L1_error))
+      __Pyx_TraceLine(5792,0,__PYX_ERR(0, 5792, __pyx_L1_error))
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5801
+        /* "discretize/_extensions/tree_ext.pyx":5796
  *                     abs(locations[i, dir1] - cell.location[dir1])
  *                 ):
  *                     temp = dir0             # <<<<<<<<<<<<<<
  *                     dir0 = dir1
  *                     dir1 = temp
  */
-        __Pyx_TraceLine(5801,0,__PYX_ERR(0, 5801, __pyx_L1_error))
+        __Pyx_TraceLine(5796,0,__PYX_ERR(0, 5796, __pyx_L1_error))
         __pyx_v_temp = __pyx_v_dir0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5802
+        /* "discretize/_extensions/tree_ext.pyx":5797
  *                 ):
  *                     temp = dir0
  *                     dir0 = dir1             # <<<<<<<<<<<<<<
  *                     dir1 = temp
  *                 if dim == 3:
  */
-        __Pyx_TraceLine(5802,0,__PYX_ERR(0, 5802, __pyx_L1_error))
+        __Pyx_TraceLine(5797,0,__PYX_ERR(0, 5797, __pyx_L1_error))
         __pyx_v_dir0 = __pyx_v_dir1;
 
-        /* "discretize/_extensions/tree_ext.pyx":5803
+        /* "discretize/_extensions/tree_ext.pyx":5798
  *                     temp = dir0
  *                     dir0 = dir1
  *                     dir1 = temp             # <<<<<<<<<<<<<<
  *                 if dim == 3:
  *                     if (
  */
-        __Pyx_TraceLine(5803,0,__PYX_ERR(0, 5803, __pyx_L1_error))
+        __Pyx_TraceLine(5798,0,__PYX_ERR(0, 5798, __pyx_L1_error))
         __pyx_v_dir1 = __pyx_v_temp;
 
-        /* "discretize/_extensions/tree_ext.pyx":5797
+        /* "discretize/_extensions/tree_ext.pyx":5792
  *                 # decide order to search based on distance to each faces
  *                 #
  *                 if (             # <<<<<<<<<<<<<<
  *                     abs(locations[i, dir0] - cell.location[dir0]) <
  *                     abs(locations[i, dir1] - cell.location[dir1])
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5804
+      /* "discretize/_extensions/tree_ext.pyx":5799
  *                     dir0 = dir1
  *                     dir1 = temp
  *                 if dim == 3:             # <<<<<<<<<<<<<<
  *                     if (
  *                         abs(locations[i, dir1] - cell.location[dir1]) <
  */
-      __Pyx_TraceLine(5804,0,__PYX_ERR(0, 5804, __pyx_L1_error))
+      __Pyx_TraceLine(5799,0,__PYX_ERR(0, 5799, __pyx_L1_error))
       __pyx_t_17 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5806
+        /* "discretize/_extensions/tree_ext.pyx":5801
  *                 if dim == 3:
  *                     if (
  *                         abs(locations[i, dir1] - cell.location[dir1]) <             # <<<<<<<<<<<<<<
  *                         abs(locations[i, dir2] - cell.location[dir2])
  *                     ):
  */
-        __Pyx_TraceLine(5806,0,__PYX_ERR(0, 5806, __pyx_L1_error))
+        __Pyx_TraceLine(5801,0,__PYX_ERR(0, 5801, __pyx_L1_error))
         __pyx_t_20 = __pyx_v_i;
         __pyx_t_19 = __pyx_v_dir1;
         __pyx_t_12 = -1;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5806, __pyx_L1_error)
+          __PYX_ERR(0, 5801, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5807
+        /* "discretize/_extensions/tree_ext.pyx":5802
  *                     if (
  *                         abs(locations[i, dir1] - cell.location[dir1]) <
  *                         abs(locations[i, dir2] - cell.location[dir2])             # <<<<<<<<<<<<<<
  *                     ):
  *                         temp = dir1
  */
-        __Pyx_TraceLine(5807,0,__PYX_ERR(0, 5807, __pyx_L1_error))
+        __Pyx_TraceLine(5802,0,__PYX_ERR(0, 5802, __pyx_L1_error))
         __pyx_t_15 = __pyx_v_i;
         __pyx_t_16 = __pyx_v_dir2;
         __pyx_t_12 = -1;
         if (__pyx_t_15 < 0) {
           __pyx_t_15 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5807, __pyx_L1_error)
+          __PYX_ERR(0, 5802, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5806
+        /* "discretize/_extensions/tree_ext.pyx":5801
  *                 if dim == 3:
  *                     if (
  *                         abs(locations[i, dir1] - cell.location[dir1]) <             # <<<<<<<<<<<<<<
  *                         abs(locations[i, dir2] - cell.location[dir2])
  *                     ):
  */
-        __Pyx_TraceLine(5806,0,__PYX_ERR(0, 5806, __pyx_L1_error))
+        __Pyx_TraceLine(5801,0,__PYX_ERR(0, 5801, __pyx_L1_error))
         __pyx_t_17 = ((fabs(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))) - (__pyx_v_cell->location[__pyx_v_dir1]))) < fabs(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_15 * __pyx_v_locations.strides[0]) ) + __pyx_t_16 * __pyx_v_locations.strides[1]) ))) - (__pyx_v_cell->location[__pyx_v_dir2])))) != 0);
 
-        /* "discretize/_extensions/tree_ext.pyx":5805
+        /* "discretize/_extensions/tree_ext.pyx":5800
  *                     dir1 = temp
  *                 if dim == 3:
  *                     if (             # <<<<<<<<<<<<<<
  *                         abs(locations[i, dir1] - cell.location[dir1]) <
  *                         abs(locations[i, dir2] - cell.location[dir2])
  */
-        __Pyx_TraceLine(5805,0,__PYX_ERR(0, 5805, __pyx_L1_error))
+        __Pyx_TraceLine(5800,0,__PYX_ERR(0, 5800, __pyx_L1_error))
         if (__pyx_t_17) {
 
-          /* "discretize/_extensions/tree_ext.pyx":5809
+          /* "discretize/_extensions/tree_ext.pyx":5804
  *                         abs(locations[i, dir2] - cell.location[dir2])
  *                     ):
  *                         temp = dir1             # <<<<<<<<<<<<<<
  *                         dir1 = dir2
  *                         dir2 = temp
  */
-          __Pyx_TraceLine(5809,0,__PYX_ERR(0, 5809, __pyx_L1_error))
+          __Pyx_TraceLine(5804,0,__PYX_ERR(0, 5804, __pyx_L1_error))
           __pyx_v_temp = __pyx_v_dir1;
 
-          /* "discretize/_extensions/tree_ext.pyx":5810
+          /* "discretize/_extensions/tree_ext.pyx":5805
  *                     ):
  *                         temp = dir1
  *                         dir1 = dir2             # <<<<<<<<<<<<<<
  *                         dir2 = temp
  *                     if (
  */
-          __Pyx_TraceLine(5810,0,__PYX_ERR(0, 5810, __pyx_L1_error))
+          __Pyx_TraceLine(5805,0,__PYX_ERR(0, 5805, __pyx_L1_error))
           __pyx_v_dir1 = __pyx_v_dir2;
 
-          /* "discretize/_extensions/tree_ext.pyx":5811
+          /* "discretize/_extensions/tree_ext.pyx":5806
  *                         temp = dir1
  *                         dir1 = dir2
  *                         dir2 = temp             # <<<<<<<<<<<<<<
  *                     if (
  *                         abs(locations[i, dir0] - cell.location[dir0]) <
  */
-          __Pyx_TraceLine(5811,0,__PYX_ERR(0, 5811, __pyx_L1_error))
+          __Pyx_TraceLine(5806,0,__PYX_ERR(0, 5806, __pyx_L1_error))
           __pyx_v_dir2 = __pyx_v_temp;
 
-          /* "discretize/_extensions/tree_ext.pyx":5805
+          /* "discretize/_extensions/tree_ext.pyx":5800
  *                     dir1 = temp
  *                 if dim == 3:
  *                     if (             # <<<<<<<<<<<<<<
  *                         abs(locations[i, dir1] - cell.location[dir1]) <
  *                         abs(locations[i, dir2] - cell.location[dir2])
  */
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5813
+        /* "discretize/_extensions/tree_ext.pyx":5808
  *                         dir2 = temp
  *                     if (
  *                         abs(locations[i, dir0] - cell.location[dir0]) <             # <<<<<<<<<<<<<<
  *                         abs(locations[i, dir1] - cell.location[dir1])
  *                     ):
  */
-        __Pyx_TraceLine(5813,0,__PYX_ERR(0, 5813, __pyx_L1_error))
+        __Pyx_TraceLine(5808,0,__PYX_ERR(0, 5808, __pyx_L1_error))
         __pyx_t_16 = __pyx_v_i;
         __pyx_t_15 = __pyx_v_dir0;
         __pyx_t_12 = -1;
         if (__pyx_t_16 < 0) {
           __pyx_t_16 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_16 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_16 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_15 < 0) {
           __pyx_t_15 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_15 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5813, __pyx_L1_error)
+          __PYX_ERR(0, 5808, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5814
+        /* "discretize/_extensions/tree_ext.pyx":5809
  *                     if (
  *                         abs(locations[i, dir0] - cell.location[dir0]) <
  *                         abs(locations[i, dir1] - cell.location[dir1])             # <<<<<<<<<<<<<<
  *                     ):
  *                         temp = dir0
  */
-        __Pyx_TraceLine(5814,0,__PYX_ERR(0, 5814, __pyx_L1_error))
+        __Pyx_TraceLine(5809,0,__PYX_ERR(0, 5809, __pyx_L1_error))
         __pyx_t_19 = __pyx_v_i;
         __pyx_t_20 = __pyx_v_dir1;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5814, __pyx_L1_error)
+          __PYX_ERR(0, 5809, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5813
+        /* "discretize/_extensions/tree_ext.pyx":5808
  *                         dir2 = temp
  *                     if (
  *                         abs(locations[i, dir0] - cell.location[dir0]) <             # <<<<<<<<<<<<<<
  *                         abs(locations[i, dir1] - cell.location[dir1])
  *                     ):
  */
-        __Pyx_TraceLine(5813,0,__PYX_ERR(0, 5813, __pyx_L1_error))
+        __Pyx_TraceLine(5808,0,__PYX_ERR(0, 5808, __pyx_L1_error))
         __pyx_t_17 = ((fabs(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_16 * __pyx_v_locations.strides[0]) ) + __pyx_t_15 * __pyx_v_locations.strides[1]) ))) - (__pyx_v_cell->location[__pyx_v_dir0]))) < fabs(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))) - (__pyx_v_cell->location[__pyx_v_dir1])))) != 0);
 
-        /* "discretize/_extensions/tree_ext.pyx":5812
+        /* "discretize/_extensions/tree_ext.pyx":5807
  *                         dir1 = dir2
  *                         dir2 = temp
  *                     if (             # <<<<<<<<<<<<<<
  *                         abs(locations[i, dir0] - cell.location[dir0]) <
  *                         abs(locations[i, dir1] - cell.location[dir1])
  */
-        __Pyx_TraceLine(5812,0,__PYX_ERR(0, 5812, __pyx_L1_error))
+        __Pyx_TraceLine(5807,0,__PYX_ERR(0, 5807, __pyx_L1_error))
         if (__pyx_t_17) {
 
-          /* "discretize/_extensions/tree_ext.pyx":5816
+          /* "discretize/_extensions/tree_ext.pyx":5811
  *                         abs(locations[i, dir1] - cell.location[dir1])
  *                     ):
  *                         temp = dir0             # <<<<<<<<<<<<<<
  *                         dir0 = dir1
  *                         dir0 = temp
  */
-          __Pyx_TraceLine(5816,0,__PYX_ERR(0, 5816, __pyx_L1_error))
+          __Pyx_TraceLine(5811,0,__PYX_ERR(0, 5811, __pyx_L1_error))
           __pyx_v_temp = __pyx_v_dir0;
 
-          /* "discretize/_extensions/tree_ext.pyx":5817
+          /* "discretize/_extensions/tree_ext.pyx":5812
  *                     ):
  *                         temp = dir0
  *                         dir0 = dir1             # <<<<<<<<<<<<<<
  *                         dir0 = temp
  *                 # Look -dir0 and +dir0 from current cell
  */
-          __Pyx_TraceLine(5817,0,__PYX_ERR(0, 5817, __pyx_L1_error))
+          __Pyx_TraceLine(5812,0,__PYX_ERR(0, 5812, __pyx_L1_error))
           __pyx_v_dir0 = __pyx_v_dir1;
 
-          /* "discretize/_extensions/tree_ext.pyx":5818
+          /* "discretize/_extensions/tree_ext.pyx":5813
  *                         temp = dir0
  *                         dir0 = dir1
  *                         dir0 = temp             # <<<<<<<<<<<<<<
  *                 # Look -dir0 and +dir0 from current cell
  *                 if (
  */
-          __Pyx_TraceLine(5818,0,__PYX_ERR(0, 5818, __pyx_L1_error))
+          __Pyx_TraceLine(5813,0,__PYX_ERR(0, 5813, __pyx_L1_error))
           __pyx_v_dir0 = __pyx_v_temp;
 
-          /* "discretize/_extensions/tree_ext.pyx":5812
+          /* "discretize/_extensions/tree_ext.pyx":5807
  *                         dir1 = dir2
  *                         dir2 = temp
  *                     if (             # <<<<<<<<<<<<<<
  *                         abs(locations[i, dir0] - cell.location[dir0]) <
  *                         abs(locations[i, dir1] - cell.location[dir1])
  */
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":5804
+        /* "discretize/_extensions/tree_ext.pyx":5799
  *                     dir0 = dir1
  *                     dir1 = temp
  *                 if dim == 3:             # <<<<<<<<<<<<<<
  *                     if (
  *                         abs(locations[i, dir1] - cell.location[dir1]) <
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5821
+      /* "discretize/_extensions/tree_ext.pyx":5816
  *                 # Look -dir0 and +dir0 from current cell
  *                 if (
  *                     locations[i, dir0] < cell.location[dir0]             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2 * dir0] != NULL
  *                     and cell.neighbors[2 * dir0].is_leaf()
  */
-      __Pyx_TraceLine(5821,0,__PYX_ERR(0, 5821, __pyx_L1_error))
+      __Pyx_TraceLine(5816,0,__PYX_ERR(0, 5816, __pyx_L1_error))
       __pyx_t_20 = __pyx_v_i;
       __pyx_t_19 = __pyx_v_dir0;
       __pyx_t_12 = -1;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5821, __pyx_L1_error)
+        __PYX_ERR(0, 5816, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))) < (__pyx_v_cell->location[__pyx_v_dir0])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L16_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5822
+      /* "discretize/_extensions/tree_ext.pyx":5817
  *                 if (
  *                     locations[i, dir0] < cell.location[dir0]
  *                     and cell.neighbors[2 * dir0] != NULL             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2 * dir0].is_leaf()
  *                     and cell.neighbors[2 * dir0].level == cell.level
  */
-      __Pyx_TraceLine(5822,0,__PYX_ERR(0, 5822, __pyx_L1_error))
+      __Pyx_TraceLine(5817,0,__PYX_ERR(0, 5817, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[(2 * __pyx_v_dir0)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L16_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5823
+      /* "discretize/_extensions/tree_ext.pyx":5818
  *                     locations[i, dir0] < cell.location[dir0]
  *                     and cell.neighbors[2 * dir0] != NULL
  *                     and cell.neighbors[2 * dir0].is_leaf()             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2 * dir0].level == cell.level
  *                 ):
  */
-      __Pyx_TraceLine(5823,0,__PYX_ERR(0, 5823, __pyx_L1_error))
+      __Pyx_TraceLine(5818,0,__PYX_ERR(0, 5818, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_cell->neighbors[(2 * __pyx_v_dir0)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L16_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5824
+      /* "discretize/_extensions/tree_ext.pyx":5819
  *                     and cell.neighbors[2 * dir0] != NULL
  *                     and cell.neighbors[2 * dir0].is_leaf()
  *                     and cell.neighbors[2 * dir0].level == cell.level             # <<<<<<<<<<<<<<
  *                 ):
  *                     i000 = cell.neighbors[2 * dir0]
  */
-      __Pyx_TraceLine(5824,0,__PYX_ERR(0, 5824, __pyx_L1_error))
+      __Pyx_TraceLine(5819,0,__PYX_ERR(0, 5819, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[(2 * __pyx_v_dir0)])->level == __pyx_v_cell->level) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L16_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5820
+      /* "discretize/_extensions/tree_ext.pyx":5815
  *                         dir0 = temp
  *                 # Look -dir0 and +dir0 from current cell
  *                 if (             # <<<<<<<<<<<<<<
  *                     locations[i, dir0] < cell.location[dir0]
  *                     and cell.neighbors[2 * dir0] != NULL
  */
-      __Pyx_TraceLine(5820,0,__PYX_ERR(0, 5820, __pyx_L1_error))
+      __Pyx_TraceLine(5815,0,__PYX_ERR(0, 5815, __pyx_L1_error))
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5826
+        /* "discretize/_extensions/tree_ext.pyx":5821
  *                     and cell.neighbors[2 * dir0].level == cell.level
  *                 ):
  *                     i000 = cell.neighbors[2 * dir0]             # <<<<<<<<<<<<<<
  *                     i001 = cell
  *                 elif (
  */
-        __Pyx_TraceLine(5826,0,__PYX_ERR(0, 5826, __pyx_L1_error))
+        __Pyx_TraceLine(5821,0,__PYX_ERR(0, 5821, __pyx_L1_error))
         __pyx_v_i000 = (__pyx_v_cell->neighbors[(2 * __pyx_v_dir0)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5827
+        /* "discretize/_extensions/tree_ext.pyx":5822
  *                 ):
  *                     i000 = cell.neighbors[2 * dir0]
  *                     i001 = cell             # <<<<<<<<<<<<<<
  *                 elif (
  *                     locations[i, dir0] > cell.location[dir0]
  */
-        __Pyx_TraceLine(5827,0,__PYX_ERR(0, 5827, __pyx_L1_error))
+        __Pyx_TraceLine(5822,0,__PYX_ERR(0, 5822, __pyx_L1_error))
         __pyx_v_i001 = __pyx_v_cell;
 
-        /* "discretize/_extensions/tree_ext.pyx":5820
+        /* "discretize/_extensions/tree_ext.pyx":5815
  *                         dir0 = temp
  *                 # Look -dir0 and +dir0 from current cell
  *                 if (             # <<<<<<<<<<<<<<
  *                     locations[i, dir0] < cell.location[dir0]
  *                     and cell.neighbors[2 * dir0] != NULL
  */
         goto __pyx_L15;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5829
+      /* "discretize/_extensions/tree_ext.pyx":5824
  *                     i001 = cell
  *                 elif (
  *                     locations[i, dir0] > cell.location[dir0]             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2 * dir0 + 1] != NULL
  *                     and cell.neighbors[2 * dir0 + 1].is_leaf()
  */
-      __Pyx_TraceLine(5829,0,__PYX_ERR(0, 5829, __pyx_L1_error))
+      __Pyx_TraceLine(5824,0,__PYX_ERR(0, 5824, __pyx_L1_error))
       __pyx_t_19 = __pyx_v_i;
       __pyx_t_20 = __pyx_v_dir0;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5829, __pyx_L1_error)
+        __PYX_ERR(0, 5824, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))) > (__pyx_v_cell->location[__pyx_v_dir0])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L20_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5830
+      /* "discretize/_extensions/tree_ext.pyx":5825
  *                 elif (
  *                     locations[i, dir0] > cell.location[dir0]
  *                     and cell.neighbors[2 * dir0 + 1] != NULL             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2 * dir0 + 1].is_leaf()
  *                     and cell.neighbors[2 * dir0 + 1].level == cell.level
  */
-      __Pyx_TraceLine(5830,0,__PYX_ERR(0, 5830, __pyx_L1_error))
+      __Pyx_TraceLine(5825,0,__PYX_ERR(0, 5825, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[((2 * __pyx_v_dir0) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L20_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5831
+      /* "discretize/_extensions/tree_ext.pyx":5826
  *                     locations[i, dir0] > cell.location[dir0]
  *                     and cell.neighbors[2 * dir0 + 1] != NULL
  *                     and cell.neighbors[2 * dir0 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and cell.neighbors[2 * dir0 + 1].level == cell.level
  *                 ):
  */
-      __Pyx_TraceLine(5831,0,__PYX_ERR(0, 5831, __pyx_L1_error))
+      __Pyx_TraceLine(5826,0,__PYX_ERR(0, 5826, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_cell->neighbors[((2 * __pyx_v_dir0) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L20_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5832
+      /* "discretize/_extensions/tree_ext.pyx":5827
  *                     and cell.neighbors[2 * dir0 + 1] != NULL
  *                     and cell.neighbors[2 * dir0 + 1].is_leaf()
  *                     and cell.neighbors[2 * dir0 + 1].level == cell.level             # <<<<<<<<<<<<<<
  *                 ):
  *                     i000 = cell
  */
-      __Pyx_TraceLine(5832,0,__PYX_ERR(0, 5832, __pyx_L1_error))
+      __Pyx_TraceLine(5827,0,__PYX_ERR(0, 5827, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_cell->neighbors[((2 * __pyx_v_dir0) + 1)])->level == __pyx_v_cell->level) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L20_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5828
+      /* "discretize/_extensions/tree_ext.pyx":5823
  *                     i000 = cell.neighbors[2 * dir0]
  *                     i001 = cell
  *                 elif (             # <<<<<<<<<<<<<<
  *                     locations[i, dir0] > cell.location[dir0]
  *                     and cell.neighbors[2 * dir0 + 1] != NULL
  */
-      __Pyx_TraceLine(5828,0,__PYX_ERR(0, 5828, __pyx_L1_error))
+      __Pyx_TraceLine(5823,0,__PYX_ERR(0, 5823, __pyx_L1_error))
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5834
+        /* "discretize/_extensions/tree_ext.pyx":5829
  *                     and cell.neighbors[2 * dir0 + 1].level == cell.level
  *                 ):
  *                     i000 = cell             # <<<<<<<<<<<<<<
  *                     i001 = cell.neighbors[2 * dir0 + 1]
  *                 else:
  */
-        __Pyx_TraceLine(5834,0,__PYX_ERR(0, 5834, __pyx_L1_error))
+        __Pyx_TraceLine(5829,0,__PYX_ERR(0, 5829, __pyx_L1_error))
         __pyx_v_i000 = __pyx_v_cell;
 
-        /* "discretize/_extensions/tree_ext.pyx":5835
+        /* "discretize/_extensions/tree_ext.pyx":5830
  *                 ):
  *                     i000 = cell
  *                     i001 = cell.neighbors[2 * dir0 + 1]             # <<<<<<<<<<<<<<
  *                 else:
  *                     i000 = i001 = cell
  */
-        __Pyx_TraceLine(5835,0,__PYX_ERR(0, 5835, __pyx_L1_error))
+        __Pyx_TraceLine(5830,0,__PYX_ERR(0, 5830, __pyx_L1_error))
         __pyx_v_i001 = (__pyx_v_cell->neighbors[((2 * __pyx_v_dir0) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5828
+        /* "discretize/_extensions/tree_ext.pyx":5823
  *                     i000 = cell.neighbors[2 * dir0]
  *                     i001 = cell
  *                 elif (             # <<<<<<<<<<<<<<
  *                     locations[i, dir0] > cell.location[dir0]
  *                     and cell.neighbors[2 * dir0 + 1] != NULL
  */
         goto __pyx_L15;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5837
+      /* "discretize/_extensions/tree_ext.pyx":5832
  *                     i001 = cell.neighbors[2 * dir0 + 1]
  *                 else:
  *                     i000 = i001 = cell             # <<<<<<<<<<<<<<
  *                 # Look -y and +y from previous two cells
  *                 if (
  */
-      __Pyx_TraceLine(5837,0,__PYX_ERR(0, 5837, __pyx_L1_error))
+      __Pyx_TraceLine(5832,0,__PYX_ERR(0, 5832, __pyx_L1_error))
       /*else*/ {
         __pyx_v_i000 = __pyx_v_cell;
         __pyx_v_i001 = __pyx_v_cell;
       }
       __pyx_L15:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5840
+      /* "discretize/_extensions/tree_ext.pyx":5835
  *                 # Look -y and +y from previous two cells
  *                 if (
  *                     locations[i, dir1] < cell.location[dir1]             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir1] != NULL
  *                     and i001.neighbors[2 * dir1] != NULL
  */
-      __Pyx_TraceLine(5840,0,__PYX_ERR(0, 5840, __pyx_L1_error))
+      __Pyx_TraceLine(5835,0,__PYX_ERR(0, 5835, __pyx_L1_error))
       __pyx_t_20 = __pyx_v_i;
       __pyx_t_19 = __pyx_v_dir1;
       __pyx_t_12 = -1;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5840, __pyx_L1_error)
+        __PYX_ERR(0, 5835, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))) < (__pyx_v_cell->location[__pyx_v_dir1])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L25_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5841
+      /* "discretize/_extensions/tree_ext.pyx":5836
  *                 if (
  *                     locations[i, dir1] < cell.location[dir1]
  *                     and i000.neighbors[2 * dir1] != NULL             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir1] != NULL
  *                     and i000.neighbors[2 * dir1].is_leaf()
  */
-      __Pyx_TraceLine(5841,0,__PYX_ERR(0, 5841, __pyx_L1_error))
+      __Pyx_TraceLine(5836,0,__PYX_ERR(0, 5836, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i000->neighbors[(2 * __pyx_v_dir1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L25_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5842
+      /* "discretize/_extensions/tree_ext.pyx":5837
  *                     locations[i, dir1] < cell.location[dir1]
  *                     and i000.neighbors[2 * dir1] != NULL
  *                     and i001.neighbors[2 * dir1] != NULL             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir1].is_leaf()
  *                     and i001.neighbors[2 * dir1].is_leaf()
  */
-      __Pyx_TraceLine(5842,0,__PYX_ERR(0, 5842, __pyx_L1_error))
+      __Pyx_TraceLine(5837,0,__PYX_ERR(0, 5837, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i001->neighbors[(2 * __pyx_v_dir1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L25_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5843
+      /* "discretize/_extensions/tree_ext.pyx":5838
  *                     and i000.neighbors[2 * dir1] != NULL
  *                     and i001.neighbors[2 * dir1] != NULL
  *                     and i000.neighbors[2 * dir1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir1].is_leaf()
  *                     and i000.neighbors[2 * dir1].level == i000.level
  */
-      __Pyx_TraceLine(5843,0,__PYX_ERR(0, 5843, __pyx_L1_error))
+      __Pyx_TraceLine(5838,0,__PYX_ERR(0, 5838, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i000->neighbors[(2 * __pyx_v_dir1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L25_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5844
+      /* "discretize/_extensions/tree_ext.pyx":5839
  *                     and i001.neighbors[2 * dir1] != NULL
  *                     and i000.neighbors[2 * dir1].is_leaf()
  *                     and i001.neighbors[2 * dir1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir1].level == i000.level
  *                     and i001.neighbors[2 * dir1].level == i001.level
  */
-      __Pyx_TraceLine(5844,0,__PYX_ERR(0, 5844, __pyx_L1_error))
+      __Pyx_TraceLine(5839,0,__PYX_ERR(0, 5839, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i001->neighbors[(2 * __pyx_v_dir1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L25_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5845
+      /* "discretize/_extensions/tree_ext.pyx":5840
  *                     and i000.neighbors[2 * dir1].is_leaf()
  *                     and i001.neighbors[2 * dir1].is_leaf()
  *                     and i000.neighbors[2 * dir1].level == i000.level             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir1].level == i001.level
  *                 ):
  */
-      __Pyx_TraceLine(5845,0,__PYX_ERR(0, 5845, __pyx_L1_error))
+      __Pyx_TraceLine(5840,0,__PYX_ERR(0, 5840, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i000->neighbors[(2 * __pyx_v_dir1)])->level == __pyx_v_i000->level) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L25_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5846
+      /* "discretize/_extensions/tree_ext.pyx":5841
  *                     and i001.neighbors[2 * dir1].is_leaf()
  *                     and i000.neighbors[2 * dir1].level == i000.level
  *                     and i001.neighbors[2 * dir1].level == i001.level             # <<<<<<<<<<<<<<
  *                 ):
  *                     i010 = i000
  */
-      __Pyx_TraceLine(5846,0,__PYX_ERR(0, 5846, __pyx_L1_error))
+      __Pyx_TraceLine(5841,0,__PYX_ERR(0, 5841, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i001->neighbors[(2 * __pyx_v_dir1)])->level == __pyx_v_i001->level) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L25_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5839
+      /* "discretize/_extensions/tree_ext.pyx":5834
  *                     i000 = i001 = cell
  *                 # Look -y and +y from previous two cells
  *                 if (             # <<<<<<<<<<<<<<
  *                     locations[i, dir1] < cell.location[dir1]
  *                     and i000.neighbors[2 * dir1] != NULL
  */
-      __Pyx_TraceLine(5839,0,__PYX_ERR(0, 5839, __pyx_L1_error))
+      __Pyx_TraceLine(5834,0,__PYX_ERR(0, 5834, __pyx_L1_error))
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5848
+        /* "discretize/_extensions/tree_ext.pyx":5843
  *                     and i001.neighbors[2 * dir1].level == i001.level
  *                 ):
  *                     i010 = i000             # <<<<<<<<<<<<<<
  *                     i011 = i001
  *                     i000 = i000.neighbors[2 * dir1]
  */
-        __Pyx_TraceLine(5848,0,__PYX_ERR(0, 5848, __pyx_L1_error))
+        __Pyx_TraceLine(5843,0,__PYX_ERR(0, 5843, __pyx_L1_error))
         __pyx_v_i010 = __pyx_v_i000;
 
-        /* "discretize/_extensions/tree_ext.pyx":5849
+        /* "discretize/_extensions/tree_ext.pyx":5844
  *                 ):
  *                     i010 = i000
  *                     i011 = i001             # <<<<<<<<<<<<<<
  *                     i000 = i000.neighbors[2 * dir1]
  *                     i001 = i001.neighbors[2 * dir1]
  */
-        __Pyx_TraceLine(5849,0,__PYX_ERR(0, 5849, __pyx_L1_error))
+        __Pyx_TraceLine(5844,0,__PYX_ERR(0, 5844, __pyx_L1_error))
         __pyx_v_i011 = __pyx_v_i001;
 
-        /* "discretize/_extensions/tree_ext.pyx":5850
+        /* "discretize/_extensions/tree_ext.pyx":5845
  *                     i010 = i000
  *                     i011 = i001
  *                     i000 = i000.neighbors[2 * dir1]             # <<<<<<<<<<<<<<
  *                     i001 = i001.neighbors[2 * dir1]
  *                 elif (
  */
-        __Pyx_TraceLine(5850,0,__PYX_ERR(0, 5850, __pyx_L1_error))
+        __Pyx_TraceLine(5845,0,__PYX_ERR(0, 5845, __pyx_L1_error))
         __pyx_v_i000 = (__pyx_v_i000->neighbors[(2 * __pyx_v_dir1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5851
+        /* "discretize/_extensions/tree_ext.pyx":5846
  *                     i011 = i001
  *                     i000 = i000.neighbors[2 * dir1]
  *                     i001 = i001.neighbors[2 * dir1]             # <<<<<<<<<<<<<<
  *                 elif (
  *                     locations[i, dir1] > cell.location[dir1]
  */
-        __Pyx_TraceLine(5851,0,__PYX_ERR(0, 5851, __pyx_L1_error))
+        __Pyx_TraceLine(5846,0,__PYX_ERR(0, 5846, __pyx_L1_error))
         __pyx_v_i001 = (__pyx_v_i001->neighbors[(2 * __pyx_v_dir1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5839
+        /* "discretize/_extensions/tree_ext.pyx":5834
  *                     i000 = i001 = cell
  *                 # Look -y and +y from previous two cells
  *                 if (             # <<<<<<<<<<<<<<
  *                     locations[i, dir1] < cell.location[dir1]
  *                     and i000.neighbors[2 * dir1] != NULL
  */
         goto __pyx_L24;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5853
+      /* "discretize/_extensions/tree_ext.pyx":5848
  *                     i001 = i001.neighbors[2 * dir1]
  *                 elif (
  *                     locations[i, dir1] > cell.location[dir1]             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir1 + 1] != NULL
  *                     and i001.neighbors[2 * dir1 + 1] != NULL
  */
-      __Pyx_TraceLine(5853,0,__PYX_ERR(0, 5853, __pyx_L1_error))
+      __Pyx_TraceLine(5848,0,__PYX_ERR(0, 5848, __pyx_L1_error))
       __pyx_t_19 = __pyx_v_i;
       __pyx_t_20 = __pyx_v_dir1;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5853, __pyx_L1_error)
+        __PYX_ERR(0, 5848, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))) > (__pyx_v_cell->location[__pyx_v_dir1])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L32_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5854
+      /* "discretize/_extensions/tree_ext.pyx":5849
  *                 elif (
  *                     locations[i, dir1] > cell.location[dir1]
  *                     and i000.neighbors[2 * dir1 + 1] != NULL             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir1 + 1] != NULL
  *                     and i000.neighbors[2 * dir1 + 1].is_leaf()
  */
-      __Pyx_TraceLine(5854,0,__PYX_ERR(0, 5854, __pyx_L1_error))
+      __Pyx_TraceLine(5849,0,__PYX_ERR(0, 5849, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i000->neighbors[((2 * __pyx_v_dir1) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L32_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5855
+      /* "discretize/_extensions/tree_ext.pyx":5850
  *                     locations[i, dir1] > cell.location[dir1]
  *                     and i000.neighbors[2 * dir1 + 1] != NULL
  *                     and i001.neighbors[2 * dir1 + 1] != NULL             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir1 + 1].is_leaf()
  *                     and i001.neighbors[2 * dir1 + 1].is_leaf()
  */
-      __Pyx_TraceLine(5855,0,__PYX_ERR(0, 5855, __pyx_L1_error))
+      __Pyx_TraceLine(5850,0,__PYX_ERR(0, 5850, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i001->neighbors[((2 * __pyx_v_dir1) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L32_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5856
+      /* "discretize/_extensions/tree_ext.pyx":5851
  *                     and i000.neighbors[2 * dir1 + 1] != NULL
  *                     and i001.neighbors[2 * dir1 + 1] != NULL
  *                     and i000.neighbors[2 * dir1 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir1 + 1].is_leaf()
  *                     and i000.neighbors[2 * dir1 + 1].level == i000.level
  */
-      __Pyx_TraceLine(5856,0,__PYX_ERR(0, 5856, __pyx_L1_error))
+      __Pyx_TraceLine(5851,0,__PYX_ERR(0, 5851, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i000->neighbors[((2 * __pyx_v_dir1) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L32_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5857
+      /* "discretize/_extensions/tree_ext.pyx":5852
  *                     and i001.neighbors[2 * dir1 + 1] != NULL
  *                     and i000.neighbors[2 * dir1 + 1].is_leaf()
  *                     and i001.neighbors[2 * dir1 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir1 + 1].level == i000.level
  *                     and i001.neighbors[2 * dir1 + 1].level == i001.level
  */
-      __Pyx_TraceLine(5857,0,__PYX_ERR(0, 5857, __pyx_L1_error))
+      __Pyx_TraceLine(5852,0,__PYX_ERR(0, 5852, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i001->neighbors[((2 * __pyx_v_dir1) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L32_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5858
+      /* "discretize/_extensions/tree_ext.pyx":5853
  *                     and i000.neighbors[2 * dir1 + 1].is_leaf()
  *                     and i001.neighbors[2 * dir1 + 1].is_leaf()
  *                     and i000.neighbors[2 * dir1 + 1].level == i000.level             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir1 + 1].level == i001.level
  *                 ):
  */
-      __Pyx_TraceLine(5858,0,__PYX_ERR(0, 5858, __pyx_L1_error))
+      __Pyx_TraceLine(5853,0,__PYX_ERR(0, 5853, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i000->neighbors[((2 * __pyx_v_dir1) + 1)])->level == __pyx_v_i000->level) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L32_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5859
+      /* "discretize/_extensions/tree_ext.pyx":5854
  *                     and i001.neighbors[2 * dir1 + 1].is_leaf()
  *                     and i000.neighbors[2 * dir1 + 1].level == i000.level
  *                     and i001.neighbors[2 * dir1 + 1].level == i001.level             # <<<<<<<<<<<<<<
  *                 ):
  *                     i010 = i000.neighbors[2 * dir1 + 1]
  */
-      __Pyx_TraceLine(5859,0,__PYX_ERR(0, 5859, __pyx_L1_error))
+      __Pyx_TraceLine(5854,0,__PYX_ERR(0, 5854, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i001->neighbors[((2 * __pyx_v_dir1) + 1)])->level == __pyx_v_i001->level) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L32_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5852
+      /* "discretize/_extensions/tree_ext.pyx":5847
  *                     i000 = i000.neighbors[2 * dir1]
  *                     i001 = i001.neighbors[2 * dir1]
  *                 elif (             # <<<<<<<<<<<<<<
  *                     locations[i, dir1] > cell.location[dir1]
  *                     and i000.neighbors[2 * dir1 + 1] != NULL
  */
-      __Pyx_TraceLine(5852,0,__PYX_ERR(0, 5852, __pyx_L1_error))
+      __Pyx_TraceLine(5847,0,__PYX_ERR(0, 5847, __pyx_L1_error))
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5861
+        /* "discretize/_extensions/tree_ext.pyx":5856
  *                     and i001.neighbors[2 * dir1 + 1].level == i001.level
  *                 ):
  *                     i010 = i000.neighbors[2 * dir1 + 1]             # <<<<<<<<<<<<<<
  *                     i011 = i001.neighbors[2 * dir1 + 1]
  *                 else:
  */
-        __Pyx_TraceLine(5861,0,__PYX_ERR(0, 5861, __pyx_L1_error))
+        __Pyx_TraceLine(5856,0,__PYX_ERR(0, 5856, __pyx_L1_error))
         __pyx_v_i010 = (__pyx_v_i000->neighbors[((2 * __pyx_v_dir1) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5862
+        /* "discretize/_extensions/tree_ext.pyx":5857
  *                 ):
  *                     i010 = i000.neighbors[2 * dir1 + 1]
  *                     i011 = i001.neighbors[2 * dir1 + 1]             # <<<<<<<<<<<<<<
  *                 else:
  *                     i010 = i000
  */
-        __Pyx_TraceLine(5862,0,__PYX_ERR(0, 5862, __pyx_L1_error))
+        __Pyx_TraceLine(5857,0,__PYX_ERR(0, 5857, __pyx_L1_error))
         __pyx_v_i011 = (__pyx_v_i001->neighbors[((2 * __pyx_v_dir1) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5852
+        /* "discretize/_extensions/tree_ext.pyx":5847
  *                     i000 = i000.neighbors[2 * dir1]
  *                     i001 = i001.neighbors[2 * dir1]
  *                 elif (             # <<<<<<<<<<<<<<
  *                     locations[i, dir1] > cell.location[dir1]
  *                     and i000.neighbors[2 * dir1 + 1] != NULL
  */
         goto __pyx_L24;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5864
+      /* "discretize/_extensions/tree_ext.pyx":5859
  *                     i011 = i001.neighbors[2 * dir1 + 1]
  *                 else:
  *                     i010 = i000             # <<<<<<<<<<<<<<
  *                     i011 = i001
  *                     w1 = 1.0
  */
-      __Pyx_TraceLine(5864,0,__PYX_ERR(0, 5864, __pyx_L1_error))
+      __Pyx_TraceLine(5859,0,__PYX_ERR(0, 5859, __pyx_L1_error))
       /*else*/ {
         __pyx_v_i010 = __pyx_v_i000;
 
-        /* "discretize/_extensions/tree_ext.pyx":5865
+        /* "discretize/_extensions/tree_ext.pyx":5860
  *                 else:
  *                     i010 = i000
  *                     i011 = i001             # <<<<<<<<<<<<<<
  *                     w1 = 1.0
  *                 # Look -z and +z from previous four cells
  */
-        __Pyx_TraceLine(5865,0,__PYX_ERR(0, 5865, __pyx_L1_error))
+        __Pyx_TraceLine(5860,0,__PYX_ERR(0, 5860, __pyx_L1_error))
         __pyx_v_i011 = __pyx_v_i001;
 
-        /* "discretize/_extensions/tree_ext.pyx":5866
+        /* "discretize/_extensions/tree_ext.pyx":5861
  *                     i010 = i000
  *                     i011 = i001
  *                     w1 = 1.0             # <<<<<<<<<<<<<<
  *                 # Look -z and +z from previous four cells
  *                 if (
  */
-        __Pyx_TraceLine(5866,0,__PYX_ERR(0, 5866, __pyx_L1_error))
+        __Pyx_TraceLine(5861,0,__PYX_ERR(0, 5861, __pyx_L1_error))
         __pyx_v_w1 = 1.0;
       }
       __pyx_L24:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5869
+      /* "discretize/_extensions/tree_ext.pyx":5864
  *                 # Look -z and +z from previous four cells
  *                 if (
  *                     dim == 3             # <<<<<<<<<<<<<<
  *                     and locations[i, dir2] < cell.location[dir2]
  *                     and i000.neighbors[2 * dir2] != NULL
  */
-      __Pyx_TraceLine(5869,0,__PYX_ERR(0, 5869, __pyx_L1_error))
+      __Pyx_TraceLine(5864,0,__PYX_ERR(0, 5864, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5870
+      /* "discretize/_extensions/tree_ext.pyx":5865
  *                 if (
  *                     dim == 3
  *                     and locations[i, dir2] < cell.location[dir2]             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir2] != NULL
  *                     and i001.neighbors[2 * dir2] != NULL
  */
-      __Pyx_TraceLine(5870,0,__PYX_ERR(0, 5870, __pyx_L1_error))
+      __Pyx_TraceLine(5865,0,__PYX_ERR(0, 5865, __pyx_L1_error))
       __pyx_t_20 = __pyx_v_i;
       __pyx_t_19 = __pyx_v_dir2;
       __pyx_t_12 = -1;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5870, __pyx_L1_error)
+        __PYX_ERR(0, 5865, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))) < (__pyx_v_cell->location[__pyx_v_dir2])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5871
+      /* "discretize/_extensions/tree_ext.pyx":5866
  *                     dim == 3
  *                     and locations[i, dir2] < cell.location[dir2]
  *                     and i000.neighbors[2 * dir2] != NULL             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir2] != NULL
  *                     and i010.neighbors[2 * dir2] != NULL
  */
-      __Pyx_TraceLine(5871,0,__PYX_ERR(0, 5871, __pyx_L1_error))
+      __Pyx_TraceLine(5866,0,__PYX_ERR(0, 5866, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i000->neighbors[(2 * __pyx_v_dir2)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5872
+      /* "discretize/_extensions/tree_ext.pyx":5867
  *                     and locations[i, dir2] < cell.location[dir2]
  *                     and i000.neighbors[2 * dir2] != NULL
  *                     and i001.neighbors[2 * dir2] != NULL             # <<<<<<<<<<<<<<
  *                     and i010.neighbors[2 * dir2] != NULL
  *                     and i011.neighbors[2 * dir2] != NULL
  */
-      __Pyx_TraceLine(5872,0,__PYX_ERR(0, 5872, __pyx_L1_error))
+      __Pyx_TraceLine(5867,0,__PYX_ERR(0, 5867, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i001->neighbors[(2 * __pyx_v_dir2)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5873
+      /* "discretize/_extensions/tree_ext.pyx":5868
  *                     and i000.neighbors[2 * dir2] != NULL
  *                     and i001.neighbors[2 * dir2] != NULL
  *                     and i010.neighbors[2 * dir2] != NULL             # <<<<<<<<<<<<<<
  *                     and i011.neighbors[2 * dir2] != NULL
  *                     and i000.neighbors[2 * dir2].is_leaf()
  */
-      __Pyx_TraceLine(5873,0,__PYX_ERR(0, 5873, __pyx_L1_error))
+      __Pyx_TraceLine(5868,0,__PYX_ERR(0, 5868, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i010->neighbors[(2 * __pyx_v_dir2)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5874
+      /* "discretize/_extensions/tree_ext.pyx":5869
  *                     and i001.neighbors[2 * dir2] != NULL
  *                     and i010.neighbors[2 * dir2] != NULL
  *                     and i011.neighbors[2 * dir2] != NULL             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir2].is_leaf()
  *                     and i001.neighbors[2 * dir2].is_leaf()
  */
-      __Pyx_TraceLine(5874,0,__PYX_ERR(0, 5874, __pyx_L1_error))
+      __Pyx_TraceLine(5869,0,__PYX_ERR(0, 5869, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i011->neighbors[(2 * __pyx_v_dir2)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5875
+      /* "discretize/_extensions/tree_ext.pyx":5870
  *                     and i010.neighbors[2 * dir2] != NULL
  *                     and i011.neighbors[2 * dir2] != NULL
  *                     and i000.neighbors[2 * dir2].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir2].is_leaf()
  *                     and i010.neighbors[2 * dir2].is_leaf()
  */
-      __Pyx_TraceLine(5875,0,__PYX_ERR(0, 5875, __pyx_L1_error))
+      __Pyx_TraceLine(5870,0,__PYX_ERR(0, 5870, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i000->neighbors[(2 * __pyx_v_dir2)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5876
+      /* "discretize/_extensions/tree_ext.pyx":5871
  *                     and i011.neighbors[2 * dir2] != NULL
  *                     and i000.neighbors[2 * dir2].is_leaf()
  *                     and i001.neighbors[2 * dir2].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i010.neighbors[2 * dir2].is_leaf()
  *                     and i011.neighbors[2 * dir2].is_leaf()
  */
-      __Pyx_TraceLine(5876,0,__PYX_ERR(0, 5876, __pyx_L1_error))
+      __Pyx_TraceLine(5871,0,__PYX_ERR(0, 5871, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i001->neighbors[(2 * __pyx_v_dir2)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5877
+      /* "discretize/_extensions/tree_ext.pyx":5872
  *                     and i000.neighbors[2 * dir2].is_leaf()
  *                     and i001.neighbors[2 * dir2].is_leaf()
  *                     and i010.neighbors[2 * dir2].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i011.neighbors[2 * dir2].is_leaf()
  *                     and i000.neighbors[2 * dir2].level == i000.level
  */
-      __Pyx_TraceLine(5877,0,__PYX_ERR(0, 5877, __pyx_L1_error))
+      __Pyx_TraceLine(5872,0,__PYX_ERR(0, 5872, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i010->neighbors[(2 * __pyx_v_dir2)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5878
+      /* "discretize/_extensions/tree_ext.pyx":5873
  *                     and i001.neighbors[2 * dir2].is_leaf()
  *                     and i010.neighbors[2 * dir2].is_leaf()
  *                     and i011.neighbors[2 * dir2].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir2].level == i000.level
  *                     and i001.neighbors[2 * dir2].level == i001.level
  */
-      __Pyx_TraceLine(5878,0,__PYX_ERR(0, 5878, __pyx_L1_error))
+      __Pyx_TraceLine(5873,0,__PYX_ERR(0, 5873, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i011->neighbors[(2 * __pyx_v_dir2)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5879
+      /* "discretize/_extensions/tree_ext.pyx":5874
  *                     and i010.neighbors[2 * dir2].is_leaf()
  *                     and i011.neighbors[2 * dir2].is_leaf()
  *                     and i000.neighbors[2 * dir2].level == i000.level             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir2].level == i001.level
  *                     and i010.neighbors[2 * dir2].level == i010.level
  */
-      __Pyx_TraceLine(5879,0,__PYX_ERR(0, 5879, __pyx_L1_error))
+      __Pyx_TraceLine(5874,0,__PYX_ERR(0, 5874, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i000->neighbors[(2 * __pyx_v_dir2)])->level == __pyx_v_i000->level) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5880
+      /* "discretize/_extensions/tree_ext.pyx":5875
  *                     and i011.neighbors[2 * dir2].is_leaf()
  *                     and i000.neighbors[2 * dir2].level == i000.level
  *                     and i001.neighbors[2 * dir2].level == i001.level             # <<<<<<<<<<<<<<
  *                     and i010.neighbors[2 * dir2].level == i010.level
  *                     and i011.neighbors[2 * dir2].level == i011.level
  */
-      __Pyx_TraceLine(5880,0,__PYX_ERR(0, 5880, __pyx_L1_error))
+      __Pyx_TraceLine(5875,0,__PYX_ERR(0, 5875, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i001->neighbors[(2 * __pyx_v_dir2)])->level == __pyx_v_i001->level) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5881
+      /* "discretize/_extensions/tree_ext.pyx":5876
  *                     and i000.neighbors[2 * dir2].level == i000.level
  *                     and i001.neighbors[2 * dir2].level == i001.level
  *                     and i010.neighbors[2 * dir2].level == i010.level             # <<<<<<<<<<<<<<
  *                     and i011.neighbors[2 * dir2].level == i011.level
  *                 ):
  */
-      __Pyx_TraceLine(5881,0,__PYX_ERR(0, 5881, __pyx_L1_error))
+      __Pyx_TraceLine(5876,0,__PYX_ERR(0, 5876, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i010->neighbors[(2 * __pyx_v_dir2)])->level == __pyx_v_i010->level) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L40_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5882
+      /* "discretize/_extensions/tree_ext.pyx":5877
  *                     and i001.neighbors[2 * dir2].level == i001.level
  *                     and i010.neighbors[2 * dir2].level == i010.level
  *                     and i011.neighbors[2 * dir2].level == i011.level             # <<<<<<<<<<<<<<
  *                 ):
  *                     i100 = i000
  */
-      __Pyx_TraceLine(5882,0,__PYX_ERR(0, 5882, __pyx_L1_error))
+      __Pyx_TraceLine(5877,0,__PYX_ERR(0, 5877, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i011->neighbors[(2 * __pyx_v_dir2)])->level == __pyx_v_i011->level) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L40_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5868
+      /* "discretize/_extensions/tree_ext.pyx":5863
  *                     w1 = 1.0
  *                 # Look -z and +z from previous four cells
  *                 if (             # <<<<<<<<<<<<<<
  *                     dim == 3
  *                     and locations[i, dir2] < cell.location[dir2]
  */
-      __Pyx_TraceLine(5868,0,__PYX_ERR(0, 5868, __pyx_L1_error))
+      __Pyx_TraceLine(5863,0,__PYX_ERR(0, 5863, __pyx_L1_error))
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5884
+        /* "discretize/_extensions/tree_ext.pyx":5879
  *                     and i011.neighbors[2 * dir2].level == i011.level
  *                 ):
  *                     i100 = i000             # <<<<<<<<<<<<<<
  *                     i101 = i001
  *                     i110 = i010
  */
-        __Pyx_TraceLine(5884,0,__PYX_ERR(0, 5884, __pyx_L1_error))
+        __Pyx_TraceLine(5879,0,__PYX_ERR(0, 5879, __pyx_L1_error))
         __pyx_v_i100 = __pyx_v_i000;
 
-        /* "discretize/_extensions/tree_ext.pyx":5885
+        /* "discretize/_extensions/tree_ext.pyx":5880
  *                 ):
  *                     i100 = i000
  *                     i101 = i001             # <<<<<<<<<<<<<<
  *                     i110 = i010
  *                     i111 = i011
  */
-        __Pyx_TraceLine(5885,0,__PYX_ERR(0, 5885, __pyx_L1_error))
+        __Pyx_TraceLine(5880,0,__PYX_ERR(0, 5880, __pyx_L1_error))
         __pyx_v_i101 = __pyx_v_i001;
 
-        /* "discretize/_extensions/tree_ext.pyx":5886
+        /* "discretize/_extensions/tree_ext.pyx":5881
  *                     i100 = i000
  *                     i101 = i001
  *                     i110 = i010             # <<<<<<<<<<<<<<
  *                     i111 = i011
  *                     i000 = i000.neighbors[2 * dir2]
  */
-        __Pyx_TraceLine(5886,0,__PYX_ERR(0, 5886, __pyx_L1_error))
+        __Pyx_TraceLine(5881,0,__PYX_ERR(0, 5881, __pyx_L1_error))
         __pyx_v_i110 = __pyx_v_i010;
 
-        /* "discretize/_extensions/tree_ext.pyx":5887
+        /* "discretize/_extensions/tree_ext.pyx":5882
  *                     i101 = i001
  *                     i110 = i010
  *                     i111 = i011             # <<<<<<<<<<<<<<
  *                     i000 = i000.neighbors[2 * dir2]
  *                     i001 = i001.neighbors[2 * dir2]
  */
-        __Pyx_TraceLine(5887,0,__PYX_ERR(0, 5887, __pyx_L1_error))
+        __Pyx_TraceLine(5882,0,__PYX_ERR(0, 5882, __pyx_L1_error))
         __pyx_v_i111 = __pyx_v_i011;
 
-        /* "discretize/_extensions/tree_ext.pyx":5888
+        /* "discretize/_extensions/tree_ext.pyx":5883
  *                     i110 = i010
  *                     i111 = i011
  *                     i000 = i000.neighbors[2 * dir2]             # <<<<<<<<<<<<<<
  *                     i001 = i001.neighbors[2 * dir2]
  *                     i010 = i010.neighbors[2 * dir2]
  */
-        __Pyx_TraceLine(5888,0,__PYX_ERR(0, 5888, __pyx_L1_error))
+        __Pyx_TraceLine(5883,0,__PYX_ERR(0, 5883, __pyx_L1_error))
         __pyx_v_i000 = (__pyx_v_i000->neighbors[(2 * __pyx_v_dir2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5889
+        /* "discretize/_extensions/tree_ext.pyx":5884
  *                     i111 = i011
  *                     i000 = i000.neighbors[2 * dir2]
  *                     i001 = i001.neighbors[2 * dir2]             # <<<<<<<<<<<<<<
  *                     i010 = i010.neighbors[2 * dir2]
  *                     i011 = i011.neighbors[2 * dir2]
  */
-        __Pyx_TraceLine(5889,0,__PYX_ERR(0, 5889, __pyx_L1_error))
+        __Pyx_TraceLine(5884,0,__PYX_ERR(0, 5884, __pyx_L1_error))
         __pyx_v_i001 = (__pyx_v_i001->neighbors[(2 * __pyx_v_dir2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5890
+        /* "discretize/_extensions/tree_ext.pyx":5885
  *                     i000 = i000.neighbors[2 * dir2]
  *                     i001 = i001.neighbors[2 * dir2]
  *                     i010 = i010.neighbors[2 * dir2]             # <<<<<<<<<<<<<<
  *                     i011 = i011.neighbors[2 * dir2]
  *                 elif (
  */
-        __Pyx_TraceLine(5890,0,__PYX_ERR(0, 5890, __pyx_L1_error))
+        __Pyx_TraceLine(5885,0,__PYX_ERR(0, 5885, __pyx_L1_error))
         __pyx_v_i010 = (__pyx_v_i010->neighbors[(2 * __pyx_v_dir2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5891
+        /* "discretize/_extensions/tree_ext.pyx":5886
  *                     i001 = i001.neighbors[2 * dir2]
  *                     i010 = i010.neighbors[2 * dir2]
  *                     i011 = i011.neighbors[2 * dir2]             # <<<<<<<<<<<<<<
  *                 elif (
  *                     dim == 3
  */
-        __Pyx_TraceLine(5891,0,__PYX_ERR(0, 5891, __pyx_L1_error))
+        __Pyx_TraceLine(5886,0,__PYX_ERR(0, 5886, __pyx_L1_error))
         __pyx_v_i011 = (__pyx_v_i011->neighbors[(2 * __pyx_v_dir2)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5868
+        /* "discretize/_extensions/tree_ext.pyx":5863
  *                     w1 = 1.0
  *                 # Look -z and +z from previous four cells
  *                 if (             # <<<<<<<<<<<<<<
  *                     dim == 3
  *                     and locations[i, dir2] < cell.location[dir2]
  */
         goto __pyx_L39;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5893
+      /* "discretize/_extensions/tree_ext.pyx":5888
  *                     i011 = i011.neighbors[2 * dir2]
  *                 elif (
  *                     dim == 3             # <<<<<<<<<<<<<<
  *                     and locations[i, dir2] > cell.location[dir2]
  *                     and i000.neighbors[2 * dir2 + 1] != NULL
  */
-      __Pyx_TraceLine(5893,0,__PYX_ERR(0, 5893, __pyx_L1_error))
+      __Pyx_TraceLine(5888,0,__PYX_ERR(0, 5888, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5894
+      /* "discretize/_extensions/tree_ext.pyx":5889
  *                 elif (
  *                     dim == 3
  *                     and locations[i, dir2] > cell.location[dir2]             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir2 + 1] != NULL
  *                     and i001.neighbors[2 * dir2 + 1] != NULL
  */
-      __Pyx_TraceLine(5894,0,__PYX_ERR(0, 5894, __pyx_L1_error))
+      __Pyx_TraceLine(5889,0,__PYX_ERR(0, 5889, __pyx_L1_error))
       __pyx_t_19 = __pyx_v_i;
       __pyx_t_20 = __pyx_v_dir2;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_locations.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
       if (__pyx_t_20 < 0) {
         __pyx_t_20 += __pyx_v_locations.shape[1];
         if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
       } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5894, __pyx_L1_error)
+        __PYX_ERR(0, 5889, __pyx_L1_error)
       }
       __pyx_t_18 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))) > (__pyx_v_cell->location[__pyx_v_dir2])) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5895
+      /* "discretize/_extensions/tree_ext.pyx":5890
  *                     dim == 3
  *                     and locations[i, dir2] > cell.location[dir2]
  *                     and i000.neighbors[2 * dir2 + 1] != NULL             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir2 + 1] != NULL
  *                     and i010.neighbors[2 * dir2 + 1] != NULL
  */
-      __Pyx_TraceLine(5895,0,__PYX_ERR(0, 5895, __pyx_L1_error))
+      __Pyx_TraceLine(5890,0,__PYX_ERR(0, 5890, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i000->neighbors[((2 * __pyx_v_dir2) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5896
+      /* "discretize/_extensions/tree_ext.pyx":5891
  *                     and locations[i, dir2] > cell.location[dir2]
  *                     and i000.neighbors[2 * dir2 + 1] != NULL
  *                     and i001.neighbors[2 * dir2 + 1] != NULL             # <<<<<<<<<<<<<<
  *                     and i010.neighbors[2 * dir2 + 1] != NULL
  *                     and i011.neighbors[2 * dir2 + 1] != NULL
  */
-      __Pyx_TraceLine(5896,0,__PYX_ERR(0, 5896, __pyx_L1_error))
+      __Pyx_TraceLine(5891,0,__PYX_ERR(0, 5891, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i001->neighbors[((2 * __pyx_v_dir2) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5897
+      /* "discretize/_extensions/tree_ext.pyx":5892
  *                     and i000.neighbors[2 * dir2 + 1] != NULL
  *                     and i001.neighbors[2 * dir2 + 1] != NULL
  *                     and i010.neighbors[2 * dir2 + 1] != NULL             # <<<<<<<<<<<<<<
  *                     and i011.neighbors[2 * dir2 + 1] != NULL
  *                     and i000.neighbors[2 * dir2 + 1].is_leaf()
  */
-      __Pyx_TraceLine(5897,0,__PYX_ERR(0, 5897, __pyx_L1_error))
+      __Pyx_TraceLine(5892,0,__PYX_ERR(0, 5892, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i010->neighbors[((2 * __pyx_v_dir2) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5898
+      /* "discretize/_extensions/tree_ext.pyx":5893
  *                     and i001.neighbors[2 * dir2 + 1] != NULL
  *                     and i010.neighbors[2 * dir2 + 1] != NULL
  *                     and i011.neighbors[2 * dir2 + 1] != NULL             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i001.neighbors[2 * dir2 + 1].is_leaf()
  */
-      __Pyx_TraceLine(5898,0,__PYX_ERR(0, 5898, __pyx_L1_error))
+      __Pyx_TraceLine(5893,0,__PYX_ERR(0, 5893, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i011->neighbors[((2 * __pyx_v_dir2) + 1)]) != NULL) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5899
+      /* "discretize/_extensions/tree_ext.pyx":5894
  *                     and i010.neighbors[2 * dir2 + 1] != NULL
  *                     and i011.neighbors[2 * dir2 + 1] != NULL
  *                     and i000.neighbors[2 * dir2 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i010.neighbors[2 * dir2 + 1].is_leaf()
  */
-      __Pyx_TraceLine(5899,0,__PYX_ERR(0, 5899, __pyx_L1_error))
+      __Pyx_TraceLine(5894,0,__PYX_ERR(0, 5894, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i000->neighbors[((2 * __pyx_v_dir2) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5900
+      /* "discretize/_extensions/tree_ext.pyx":5895
  *                     and i011.neighbors[2 * dir2 + 1] != NULL
  *                     and i000.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i001.neighbors[2 * dir2 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i010.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i011.neighbors[2 * dir2 + 1].is_leaf()
  */
-      __Pyx_TraceLine(5900,0,__PYX_ERR(0, 5900, __pyx_L1_error))
+      __Pyx_TraceLine(5895,0,__PYX_ERR(0, 5895, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i001->neighbors[((2 * __pyx_v_dir2) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5901
+      /* "discretize/_extensions/tree_ext.pyx":5896
  *                     and i000.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i001.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i010.neighbors[2 * dir2 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i011.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i000.neighbors[2 * dir2 + 1].level == i000.level
  */
-      __Pyx_TraceLine(5901,0,__PYX_ERR(0, 5901, __pyx_L1_error))
+      __Pyx_TraceLine(5896,0,__PYX_ERR(0, 5896, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i010->neighbors[((2 * __pyx_v_dir2) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5902
+      /* "discretize/_extensions/tree_ext.pyx":5897
  *                     and i001.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i010.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i011.neighbors[2 * dir2 + 1].is_leaf()             # <<<<<<<<<<<<<<
  *                     and i000.neighbors[2 * dir2 + 1].level == i000.level
  *                     and i001.neighbors[2 * dir2 + 1].level == i001.level
  */
-      __Pyx_TraceLine(5902,0,__PYX_ERR(0, 5902, __pyx_L1_error))
+      __Pyx_TraceLine(5897,0,__PYX_ERR(0, 5897, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_i011->neighbors[((2 * __pyx_v_dir2) + 1)])->is_leaf() != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5903
+      /* "discretize/_extensions/tree_ext.pyx":5898
  *                     and i010.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i011.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i000.neighbors[2 * dir2 + 1].level == i000.level             # <<<<<<<<<<<<<<
  *                     and i001.neighbors[2 * dir2 + 1].level == i001.level
  *                     and i010.neighbors[2 * dir2 + 1].level == i010.level
  */
-      __Pyx_TraceLine(5903,0,__PYX_ERR(0, 5903, __pyx_L1_error))
+      __Pyx_TraceLine(5898,0,__PYX_ERR(0, 5898, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i000->neighbors[((2 * __pyx_v_dir2) + 1)])->level == __pyx_v_i000->level) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5904
+      /* "discretize/_extensions/tree_ext.pyx":5899
  *                     and i011.neighbors[2 * dir2 + 1].is_leaf()
  *                     and i000.neighbors[2 * dir2 + 1].level == i000.level
  *                     and i001.neighbors[2 * dir2 + 1].level == i001.level             # <<<<<<<<<<<<<<
  *                     and i010.neighbors[2 * dir2 + 1].level == i010.level
  *                     and i011.neighbors[2 * dir2 + 1].level == i011.level
  */
-      __Pyx_TraceLine(5904,0,__PYX_ERR(0, 5904, __pyx_L1_error))
+      __Pyx_TraceLine(5899,0,__PYX_ERR(0, 5899, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i001->neighbors[((2 * __pyx_v_dir2) + 1)])->level == __pyx_v_i001->level) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5905
+      /* "discretize/_extensions/tree_ext.pyx":5900
  *                     and i000.neighbors[2 * dir2 + 1].level == i000.level
  *                     and i001.neighbors[2 * dir2 + 1].level == i001.level
  *                     and i010.neighbors[2 * dir2 + 1].level == i010.level             # <<<<<<<<<<<<<<
  *                     and i011.neighbors[2 * dir2 + 1].level == i011.level
  *                 ):
  */
-      __Pyx_TraceLine(5905,0,__PYX_ERR(0, 5905, __pyx_L1_error))
+      __Pyx_TraceLine(5900,0,__PYX_ERR(0, 5900, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i010->neighbors[((2 * __pyx_v_dir2) + 1)])->level == __pyx_v_i010->level) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L54_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5906
+      /* "discretize/_extensions/tree_ext.pyx":5901
  *                     and i001.neighbors[2 * dir2 + 1].level == i001.level
  *                     and i010.neighbors[2 * dir2 + 1].level == i010.level
  *                     and i011.neighbors[2 * dir2 + 1].level == i011.level             # <<<<<<<<<<<<<<
  *                 ):
  *                     i100 = i000.neighbors[2 * dir2 + 1]
  */
-      __Pyx_TraceLine(5906,0,__PYX_ERR(0, 5906, __pyx_L1_error))
+      __Pyx_TraceLine(5901,0,__PYX_ERR(0, 5901, __pyx_L1_error))
       __pyx_t_18 = (((__pyx_v_i011->neighbors[((2 * __pyx_v_dir2) + 1)])->level == __pyx_v_i011->level) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L54_bool_binop_done:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5892
+      /* "discretize/_extensions/tree_ext.pyx":5887
  *                     i010 = i010.neighbors[2 * dir2]
  *                     i011 = i011.neighbors[2 * dir2]
  *                 elif (             # <<<<<<<<<<<<<<
  *                     dim == 3
  *                     and locations[i, dir2] > cell.location[dir2]
  */
-      __Pyx_TraceLine(5892,0,__PYX_ERR(0, 5892, __pyx_L1_error))
+      __Pyx_TraceLine(5887,0,__PYX_ERR(0, 5887, __pyx_L1_error))
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5908
+        /* "discretize/_extensions/tree_ext.pyx":5903
  *                     and i011.neighbors[2 * dir2 + 1].level == i011.level
  *                 ):
  *                     i100 = i000.neighbors[2 * dir2 + 1]             # <<<<<<<<<<<<<<
  *                     i101 = i001.neighbors[2 * dir2 + 1]
  *                     i110 = i010.neighbors[2 * dir2 + 1]
  */
-        __Pyx_TraceLine(5908,0,__PYX_ERR(0, 5908, __pyx_L1_error))
+        __Pyx_TraceLine(5903,0,__PYX_ERR(0, 5903, __pyx_L1_error))
         __pyx_v_i100 = (__pyx_v_i000->neighbors[((2 * __pyx_v_dir2) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5909
+        /* "discretize/_extensions/tree_ext.pyx":5904
  *                 ):
  *                     i100 = i000.neighbors[2 * dir2 + 1]
  *                     i101 = i001.neighbors[2 * dir2 + 1]             # <<<<<<<<<<<<<<
  *                     i110 = i010.neighbors[2 * dir2 + 1]
  *                     i111 = i011.neighbors[2 * dir2 + 1]
  */
-        __Pyx_TraceLine(5909,0,__PYX_ERR(0, 5909, __pyx_L1_error))
+        __Pyx_TraceLine(5904,0,__PYX_ERR(0, 5904, __pyx_L1_error))
         __pyx_v_i101 = (__pyx_v_i001->neighbors[((2 * __pyx_v_dir2) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5910
+        /* "discretize/_extensions/tree_ext.pyx":5905
  *                     i100 = i000.neighbors[2 * dir2 + 1]
  *                     i101 = i001.neighbors[2 * dir2 + 1]
  *                     i110 = i010.neighbors[2 * dir2 + 1]             # <<<<<<<<<<<<<<
  *                     i111 = i011.neighbors[2 * dir2 + 1]
  *                 else:
  */
-        __Pyx_TraceLine(5910,0,__PYX_ERR(0, 5910, __pyx_L1_error))
+        __Pyx_TraceLine(5905,0,__PYX_ERR(0, 5905, __pyx_L1_error))
         __pyx_v_i110 = (__pyx_v_i010->neighbors[((2 * __pyx_v_dir2) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5911
+        /* "discretize/_extensions/tree_ext.pyx":5906
  *                     i101 = i001.neighbors[2 * dir2 + 1]
  *                     i110 = i010.neighbors[2 * dir2 + 1]
  *                     i111 = i011.neighbors[2 * dir2 + 1]             # <<<<<<<<<<<<<<
  *                 else:
  *                     i100 = i000
  */
-        __Pyx_TraceLine(5911,0,__PYX_ERR(0, 5911, __pyx_L1_error))
+        __Pyx_TraceLine(5906,0,__PYX_ERR(0, 5906, __pyx_L1_error))
         __pyx_v_i111 = (__pyx_v_i011->neighbors[((2 * __pyx_v_dir2) + 1)]);
 
-        /* "discretize/_extensions/tree_ext.pyx":5892
+        /* "discretize/_extensions/tree_ext.pyx":5887
  *                     i010 = i010.neighbors[2 * dir2]
  *                     i011 = i011.neighbors[2 * dir2]
  *                 elif (             # <<<<<<<<<<<<<<
  *                     dim == 3
  *                     and locations[i, dir2] > cell.location[dir2]
  */
         goto __pyx_L39;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5913
+      /* "discretize/_extensions/tree_ext.pyx":5908
  *                     i111 = i011.neighbors[2 * dir2 + 1]
  *                 else:
  *                     i100 = i000             # <<<<<<<<<<<<<<
  *                     i101 = i001
  *                     i110 = i010
  */
-      __Pyx_TraceLine(5913,0,__PYX_ERR(0, 5913, __pyx_L1_error))
+      __Pyx_TraceLine(5908,0,__PYX_ERR(0, 5908, __pyx_L1_error))
       /*else*/ {
         __pyx_v_i100 = __pyx_v_i000;
 
-        /* "discretize/_extensions/tree_ext.pyx":5914
+        /* "discretize/_extensions/tree_ext.pyx":5909
  *                 else:
  *                     i100 = i000
  *                     i101 = i001             # <<<<<<<<<<<<<<
  *                     i110 = i010
  *                     i111 = i011
  */
-        __Pyx_TraceLine(5914,0,__PYX_ERR(0, 5914, __pyx_L1_error))
+        __Pyx_TraceLine(5909,0,__PYX_ERR(0, 5909, __pyx_L1_error))
         __pyx_v_i101 = __pyx_v_i001;
 
-        /* "discretize/_extensions/tree_ext.pyx":5915
+        /* "discretize/_extensions/tree_ext.pyx":5910
  *                     i100 = i000
  *                     i101 = i001
  *                     i110 = i010             # <<<<<<<<<<<<<<
  *                     i111 = i011
  * 
  */
-        __Pyx_TraceLine(5915,0,__PYX_ERR(0, 5915, __pyx_L1_error))
+        __Pyx_TraceLine(5910,0,__PYX_ERR(0, 5910, __pyx_L1_error))
         __pyx_v_i110 = __pyx_v_i010;
 
-        /* "discretize/_extensions/tree_ext.pyx":5916
+        /* "discretize/_extensions/tree_ext.pyx":5911
  *                     i101 = i001
  *                     i110 = i010
  *                     i111 = i011             # <<<<<<<<<<<<<<
  * 
  *                 if i001.index != i000.index:
  */
-        __Pyx_TraceLine(5916,0,__PYX_ERR(0, 5916, __pyx_L1_error))
+        __Pyx_TraceLine(5911,0,__PYX_ERR(0, 5911, __pyx_L1_error))
         __pyx_v_i111 = __pyx_v_i011;
       }
       __pyx_L39:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5918
+      /* "discretize/_extensions/tree_ext.pyx":5913
  *                     i111 = i011
  * 
  *                 if i001.index != i000.index:             # <<<<<<<<<<<<<<
  *                     w1 = ((i001.location[dir0] - locations[i, dir0])/
  *                           (i001.location[dir0] - i000.location[dir0]))
  */
-      __Pyx_TraceLine(5918,0,__PYX_ERR(0, 5918, __pyx_L1_error))
+      __Pyx_TraceLine(5913,0,__PYX_ERR(0, 5913, __pyx_L1_error))
       __pyx_t_17 = ((__pyx_v_i001->index != __pyx_v_i000->index) != 0);
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5919
+        /* "discretize/_extensions/tree_ext.pyx":5914
  * 
  *                 if i001.index != i000.index:
  *                     w1 = ((i001.location[dir0] - locations[i, dir0])/             # <<<<<<<<<<<<<<
  *                           (i001.location[dir0] - i000.location[dir0]))
  *                 else:
  */
-        __Pyx_TraceLine(5919,0,__PYX_ERR(0, 5919, __pyx_L1_error))
+        __Pyx_TraceLine(5914,0,__PYX_ERR(0, 5914, __pyx_L1_error))
         __pyx_t_20 = __pyx_v_i;
         __pyx_t_19 = __pyx_v_dir0;
         __pyx_t_12 = -1;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5919, __pyx_L1_error)
+          __PYX_ERR(0, 5914, __pyx_L1_error)
         }
         __pyx_t_11 = ((__pyx_v_i001->location[__pyx_v_dir0]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))));
 
-        /* "discretize/_extensions/tree_ext.pyx":5920
+        /* "discretize/_extensions/tree_ext.pyx":5915
  *                 if i001.index != i000.index:
  *                     w1 = ((i001.location[dir0] - locations[i, dir0])/
  *                           (i001.location[dir0] - i000.location[dir0]))             # <<<<<<<<<<<<<<
  *                 else:
  *                    w1 = 1.0
  */
-        __Pyx_TraceLine(5920,0,__PYX_ERR(0, 5920, __pyx_L1_error))
+        __Pyx_TraceLine(5915,0,__PYX_ERR(0, 5915, __pyx_L1_error))
         __pyx_t_21 = ((__pyx_v_i001->location[__pyx_v_dir0]) - (__pyx_v_i000->location[__pyx_v_dir0]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5919
+        /* "discretize/_extensions/tree_ext.pyx":5914
  * 
  *                 if i001.index != i000.index:
  *                     w1 = ((i001.location[dir0] - locations[i, dir0])/             # <<<<<<<<<<<<<<
  *                           (i001.location[dir0] - i000.location[dir0]))
  *                 else:
  */
-        __Pyx_TraceLine(5919,0,__PYX_ERR(0, 5919, __pyx_L1_error))
+        __Pyx_TraceLine(5914,0,__PYX_ERR(0, 5914, __pyx_L1_error))
         if (unlikely(__pyx_t_21 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5919, __pyx_L1_error)
+          __PYX_ERR(0, 5914, __pyx_L1_error)
         }
         __pyx_v_w1 = (__pyx_t_11 / __pyx_t_21);
 
-        /* "discretize/_extensions/tree_ext.pyx":5918
+        /* "discretize/_extensions/tree_ext.pyx":5913
  *                     i111 = i011
  * 
  *                 if i001.index != i000.index:             # <<<<<<<<<<<<<<
  *                     w1 = ((i001.location[dir0] - locations[i, dir0])/
  *                           (i001.location[dir0] - i000.location[dir0]))
  */
         goto __pyx_L68;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5922
+      /* "discretize/_extensions/tree_ext.pyx":5917
  *                           (i001.location[dir0] - i000.location[dir0]))
  *                 else:
  *                    w1 = 1.0             # <<<<<<<<<<<<<<
  * 
  *                 if i010.index != i000.index:
  */
-      __Pyx_TraceLine(5922,0,__PYX_ERR(0, 5922, __pyx_L1_error))
+      __Pyx_TraceLine(5917,0,__PYX_ERR(0, 5917, __pyx_L1_error))
       /*else*/ {
         __pyx_v_w1 = 1.0;
       }
       __pyx_L68:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5924
+      /* "discretize/_extensions/tree_ext.pyx":5919
  *                    w1 = 1.0
  * 
  *                 if i010.index != i000.index:             # <<<<<<<<<<<<<<
  *                     w2 = ((i010.location[dir1] - locations[i, dir1])/
  *                           (i010.location[dir1] - i000.location[dir1]))
  */
-      __Pyx_TraceLine(5924,0,__PYX_ERR(0, 5924, __pyx_L1_error))
+      __Pyx_TraceLine(5919,0,__PYX_ERR(0, 5919, __pyx_L1_error))
       __pyx_t_17 = ((__pyx_v_i010->index != __pyx_v_i000->index) != 0);
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5925
+        /* "discretize/_extensions/tree_ext.pyx":5920
  * 
  *                 if i010.index != i000.index:
  *                     w2 = ((i010.location[dir1] - locations[i, dir1])/             # <<<<<<<<<<<<<<
  *                           (i010.location[dir1] - i000.location[dir1]))
  *                 else:
  */
-        __Pyx_TraceLine(5925,0,__PYX_ERR(0, 5925, __pyx_L1_error))
+        __Pyx_TraceLine(5920,0,__PYX_ERR(0, 5920, __pyx_L1_error))
         __pyx_t_19 = __pyx_v_i;
         __pyx_t_20 = __pyx_v_dir1;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5925, __pyx_L1_error)
+          __PYX_ERR(0, 5920, __pyx_L1_error)
         }
         __pyx_t_21 = ((__pyx_v_i010->location[__pyx_v_dir1]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_19 * __pyx_v_locations.strides[0]) ) + __pyx_t_20 * __pyx_v_locations.strides[1]) ))));
 
-        /* "discretize/_extensions/tree_ext.pyx":5926
+        /* "discretize/_extensions/tree_ext.pyx":5921
  *                 if i010.index != i000.index:
  *                     w2 = ((i010.location[dir1] - locations[i, dir1])/
  *                           (i010.location[dir1] - i000.location[dir1]))             # <<<<<<<<<<<<<<
  *                 else:
  *                     w2 = 1.0
  */
-        __Pyx_TraceLine(5926,0,__PYX_ERR(0, 5926, __pyx_L1_error))
+        __Pyx_TraceLine(5921,0,__PYX_ERR(0, 5921, __pyx_L1_error))
         __pyx_t_11 = ((__pyx_v_i010->location[__pyx_v_dir1]) - (__pyx_v_i000->location[__pyx_v_dir1]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5925
+        /* "discretize/_extensions/tree_ext.pyx":5920
  * 
  *                 if i010.index != i000.index:
  *                     w2 = ((i010.location[dir1] - locations[i, dir1])/             # <<<<<<<<<<<<<<
  *                           (i010.location[dir1] - i000.location[dir1]))
  *                 else:
  */
-        __Pyx_TraceLine(5925,0,__PYX_ERR(0, 5925, __pyx_L1_error))
+        __Pyx_TraceLine(5920,0,__PYX_ERR(0, 5920, __pyx_L1_error))
         if (unlikely(__pyx_t_11 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5925, __pyx_L1_error)
+          __PYX_ERR(0, 5920, __pyx_L1_error)
         }
         __pyx_v_w2 = (__pyx_t_21 / __pyx_t_11);
 
-        /* "discretize/_extensions/tree_ext.pyx":5924
+        /* "discretize/_extensions/tree_ext.pyx":5919
  *                    w1 = 1.0
  * 
  *                 if i010.index != i000.index:             # <<<<<<<<<<<<<<
  *                     w2 = ((i010.location[dir1] - locations[i, dir1])/
  *                           (i010.location[dir1] - i000.location[dir1]))
  */
         goto __pyx_L69;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5928
+      /* "discretize/_extensions/tree_ext.pyx":5923
  *                           (i010.location[dir1] - i000.location[dir1]))
  *                 else:
  *                     w2 = 1.0             # <<<<<<<<<<<<<<
  * 
  *                 if dim == 3 and i100.index != i000.index:
  */
-      __Pyx_TraceLine(5928,0,__PYX_ERR(0, 5928, __pyx_L1_error))
+      __Pyx_TraceLine(5923,0,__PYX_ERR(0, 5923, __pyx_L1_error))
       /*else*/ {
         __pyx_v_w2 = 1.0;
       }
       __pyx_L69:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5930
+      /* "discretize/_extensions/tree_ext.pyx":5925
  *                     w2 = 1.0
  * 
  *                 if dim == 3 and i100.index != i000.index:             # <<<<<<<<<<<<<<
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/
  *                           (i100.location[dir2] - i000.location[dir2]))
  */
-      __Pyx_TraceLine(5930,0,__PYX_ERR(0, 5930, __pyx_L1_error))
+      __Pyx_TraceLine(5925,0,__PYX_ERR(0, 5925, __pyx_L1_error))
       __pyx_t_18 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_18) {
       } else {
         __pyx_t_17 = __pyx_t_18;
         goto __pyx_L71_bool_binop_done;
       }
       __pyx_t_18 = ((__pyx_v_i100->index != __pyx_v_i000->index) != 0);
       __pyx_t_17 = __pyx_t_18;
       __pyx_L71_bool_binop_done:;
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5931
+        /* "discretize/_extensions/tree_ext.pyx":5926
  * 
  *                 if dim == 3 and i100.index != i000.index:
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/             # <<<<<<<<<<<<<<
  *                           (i100.location[dir2] - i000.location[dir2]))
  *                 else:
  */
-        __Pyx_TraceLine(5931,0,__PYX_ERR(0, 5931, __pyx_L1_error))
+        __Pyx_TraceLine(5926,0,__PYX_ERR(0, 5926, __pyx_L1_error))
         __pyx_t_20 = __pyx_v_i;
         __pyx_t_19 = __pyx_v_dir2;
         __pyx_t_12 = -1;
         if (__pyx_t_20 < 0) {
           __pyx_t_20 += __pyx_v_locations.shape[0];
           if (unlikely(__pyx_t_20 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_20 >= __pyx_v_locations.shape[0])) __pyx_t_12 = 0;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_locations.shape[1];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 1;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_locations.shape[1])) __pyx_t_12 = 1;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5931, __pyx_L1_error)
+          __PYX_ERR(0, 5926, __pyx_L1_error)
         }
         __pyx_t_11 = ((__pyx_v_i100->location[__pyx_v_dir2]) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_locations.data + __pyx_t_20 * __pyx_v_locations.strides[0]) ) + __pyx_t_19 * __pyx_v_locations.strides[1]) ))));
 
-        /* "discretize/_extensions/tree_ext.pyx":5932
+        /* "discretize/_extensions/tree_ext.pyx":5927
  *                 if dim == 3 and i100.index != i000.index:
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/
  *                           (i100.location[dir2] - i000.location[dir2]))             # <<<<<<<<<<<<<<
  *                 else:
  *                     w3 = 1.0
  */
-        __Pyx_TraceLine(5932,0,__PYX_ERR(0, 5932, __pyx_L1_error))
+        __Pyx_TraceLine(5927,0,__PYX_ERR(0, 5927, __pyx_L1_error))
         __pyx_t_21 = ((__pyx_v_i100->location[__pyx_v_dir2]) - (__pyx_v_i000->location[__pyx_v_dir2]));
 
-        /* "discretize/_extensions/tree_ext.pyx":5931
+        /* "discretize/_extensions/tree_ext.pyx":5926
  * 
  *                 if dim == 3 and i100.index != i000.index:
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/             # <<<<<<<<<<<<<<
  *                           (i100.location[dir2] - i000.location[dir2]))
  *                 else:
  */
-        __Pyx_TraceLine(5931,0,__PYX_ERR(0, 5931, __pyx_L1_error))
+        __Pyx_TraceLine(5926,0,__PYX_ERR(0, 5926, __pyx_L1_error))
         if (unlikely(__pyx_t_21 == 0)) {
           PyErr_SetString(PyExc_ZeroDivisionError, "float division");
-          __PYX_ERR(0, 5931, __pyx_L1_error)
+          __PYX_ERR(0, 5926, __pyx_L1_error)
         }
-        __pyx_t_6 = PyFloat_FromDouble((__pyx_t_11 / __pyx_t_21)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5931, __pyx_L1_error)
+        __pyx_t_6 = PyFloat_FromDouble((__pyx_t_11 / __pyx_t_21)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5926, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_XDECREF_SET(__pyx_v_w3, __pyx_t_6);
         __pyx_t_6 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":5930
+        /* "discretize/_extensions/tree_ext.pyx":5925
  *                     w2 = 1.0
  * 
  *                 if dim == 3 and i100.index != i000.index:             # <<<<<<<<<<<<<<
  *                     w3 = ((i100.location[dir2] - locations[i, dir2])/
  *                           (i100.location[dir2] - i000.location[dir2]))
  */
         goto __pyx_L70;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":5934
+      /* "discretize/_extensions/tree_ext.pyx":5929
  *                           (i100.location[dir2] - i000.location[dir2]))
  *                 else:
  *                     w3 = 1.0             # <<<<<<<<<<<<<<
  * 
  * 
  */
-      __Pyx_TraceLine(5934,0,__PYX_ERR(0, 5934, __pyx_L1_error))
+      __Pyx_TraceLine(5929,0,__PYX_ERR(0, 5929, __pyx_L1_error))
       /*else*/ {
         __Pyx_INCREF(__pyx_float_1_0);
         __Pyx_XDECREF_SET(__pyx_v_w3, __pyx_float_1_0);
       }
       __pyx_L70:;
 
-      /* "discretize/_extensions/tree_ext.pyx":5937
+      /* "discretize/_extensions/tree_ext.pyx":5932
  * 
  * 
  *                 w1 = _clip01(w1)             # <<<<<<<<<<<<<<
  *                 w2 = _clip01(w2)
  *                 w3 = _clip01(w3)
  */
-      __Pyx_TraceLine(5937,0,__PYX_ERR(0, 5937, __pyx_L1_error))
+      __Pyx_TraceLine(5932,0,__PYX_ERR(0, 5932, __pyx_L1_error))
       __pyx_v_w1 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w1);
 
-      /* "discretize/_extensions/tree_ext.pyx":5938
+      /* "discretize/_extensions/tree_ext.pyx":5933
  * 
  *                 w1 = _clip01(w1)
  *                 w2 = _clip01(w2)             # <<<<<<<<<<<<<<
  *                 w3 = _clip01(w3)
  *                 row_data[0] = w1 * w2 * w3
  */
-      __Pyx_TraceLine(5938,0,__PYX_ERR(0, 5938, __pyx_L1_error))
+      __Pyx_TraceLine(5933,0,__PYX_ERR(0, 5933, __pyx_L1_error))
       __pyx_v_w2 = __pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_v_w2);
 
-      /* "discretize/_extensions/tree_ext.pyx":5939
+      /* "discretize/_extensions/tree_ext.pyx":5934
  *                 w1 = _clip01(w1)
  *                 w2 = _clip01(w2)
  *                 w3 = _clip01(w3)             # <<<<<<<<<<<<<<
  *                 row_data[0] = w1 * w2 * w3
  *                 row_data[1] = (1 - w1) * w2 * w3
  */
-      __Pyx_TraceLine(5939,0,__PYX_ERR(0, 5939, __pyx_L1_error))
-      __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_v_w3); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5939, __pyx_L1_error)
-      __pyx_t_6 = PyFloat_FromDouble(__pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_t_21)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5939, __pyx_L1_error)
+      __Pyx_TraceLine(5934,0,__PYX_ERR(0, 5934, __pyx_L1_error))
+      __pyx_t_21 = __pyx_PyFloat_AsDouble(__pyx_v_w3); if (unlikely((__pyx_t_21 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5934, __pyx_L1_error)
+      __pyx_t_6 = PyFloat_FromDouble(__pyx_f_10discretize_11_extensions_8tree_ext__clip01(__pyx_t_21)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5934, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF_SET(__pyx_v_w3, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":5940
+      /* "discretize/_extensions/tree_ext.pyx":5935
  *                 w2 = _clip01(w2)
  *                 w3 = _clip01(w3)
  *                 row_data[0] = w1 * w2 * w3             # <<<<<<<<<<<<<<
  *                 row_data[1] = (1 - w1) * w2 * w3
  *                 row_data[2] = w1 * (1 - w2) * w3
  */
-      __Pyx_TraceLine(5940,0,__PYX_ERR(0, 5940, __pyx_L1_error))
-      __pyx_t_6 = PyFloat_FromDouble((__pyx_v_w1 * __pyx_v_w2)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5940, __pyx_L1_error)
+      __Pyx_TraceLine(5935,0,__PYX_ERR(0, 5935, __pyx_L1_error))
+      __pyx_t_6 = PyFloat_FromDouble((__pyx_v_w1 * __pyx_v_w2)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5935, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_3 = PyNumber_Multiply(__pyx_t_6, __pyx_v_w3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5940, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_Multiply(__pyx_t_6, __pyx_v_w3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5935, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5940, __pyx_L1_error)
+      __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5935, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_t_19 = 0;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_row_data.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5940, __pyx_L1_error)
+        __PYX_ERR(0, 5935, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_19 * __pyx_v_row_data.strides[0]) )) = __pyx_t_22;
 
-      /* "discretize/_extensions/tree_ext.pyx":5941
+      /* "discretize/_extensions/tree_ext.pyx":5936
  *                 w3 = _clip01(w3)
  *                 row_data[0] = w1 * w2 * w3
  *                 row_data[1] = (1 - w1) * w2 * w3             # <<<<<<<<<<<<<<
  *                 row_data[2] = w1 * (1 - w2) * w3
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3
  */
-      __Pyx_TraceLine(5941,0,__PYX_ERR(0, 5941, __pyx_L1_error))
-      __pyx_t_3 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * __pyx_v_w2)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5941, __pyx_L1_error)
+      __Pyx_TraceLine(5936,0,__PYX_ERR(0, 5936, __pyx_L1_error))
+      __pyx_t_3 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * __pyx_v_w2)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5936, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyNumber_Multiply(__pyx_t_3, __pyx_v_w3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5941, __pyx_L1_error)
+      __pyx_t_6 = PyNumber_Multiply(__pyx_t_3, __pyx_v_w3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5936, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5941, __pyx_L1_error)
+      __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5936, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_19 = 1;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_row_data.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5941, __pyx_L1_error)
+        __PYX_ERR(0, 5936, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_19 * __pyx_v_row_data.strides[0]) )) = __pyx_t_22;
 
-      /* "discretize/_extensions/tree_ext.pyx":5942
+      /* "discretize/_extensions/tree_ext.pyx":5937
  *                 row_data[0] = w1 * w2 * w3
  *                 row_data[1] = (1 - w1) * w2 * w3
  *                 row_data[2] = w1 * (1 - w2) * w3             # <<<<<<<<<<<<<<
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3
  *                 row_inds[0] = i000.index
  */
-      __Pyx_TraceLine(5942,0,__PYX_ERR(0, 5942, __pyx_L1_error))
-      __pyx_t_6 = PyFloat_FromDouble((__pyx_v_w1 * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5942, __pyx_L1_error)
+      __Pyx_TraceLine(5937,0,__PYX_ERR(0, 5937, __pyx_L1_error))
+      __pyx_t_6 = PyFloat_FromDouble((__pyx_v_w1 * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5937, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_3 = PyNumber_Multiply(__pyx_t_6, __pyx_v_w3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5942, __pyx_L1_error)
+      __pyx_t_3 = PyNumber_Multiply(__pyx_t_6, __pyx_v_w3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5937, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5942, __pyx_L1_error)
+      __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5937, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __pyx_t_19 = 2;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_row_data.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5942, __pyx_L1_error)
+        __PYX_ERR(0, 5937, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_19 * __pyx_v_row_data.strides[0]) )) = __pyx_t_22;
 
-      /* "discretize/_extensions/tree_ext.pyx":5943
+      /* "discretize/_extensions/tree_ext.pyx":5938
  *                 row_data[1] = (1 - w1) * w2 * w3
  *                 row_data[2] = w1 * (1 - w2) * w3
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3             # <<<<<<<<<<<<<<
  *                 row_inds[0] = i000.index
  *                 row_inds[1] = i001.index
  */
-      __Pyx_TraceLine(5943,0,__PYX_ERR(0, 5943, __pyx_L1_error))
-      __pyx_t_3 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5943, __pyx_L1_error)
+      __Pyx_TraceLine(5938,0,__PYX_ERR(0, 5938, __pyx_L1_error))
+      __pyx_t_3 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_6 = PyNumber_Multiply(__pyx_t_3, __pyx_v_w3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5943, __pyx_L1_error)
+      __pyx_t_6 = PyNumber_Multiply(__pyx_t_3, __pyx_v_w3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5938, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5943, __pyx_L1_error)
+      __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5938, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_19 = 3;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_row_data.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5943, __pyx_L1_error)
+        __PYX_ERR(0, 5938, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_19 * __pyx_v_row_data.strides[0]) )) = __pyx_t_22;
 
-      /* "discretize/_extensions/tree_ext.pyx":5944
+      /* "discretize/_extensions/tree_ext.pyx":5939
  *                 row_data[2] = w1 * (1 - w2) * w3
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3
  *                 row_inds[0] = i000.index             # <<<<<<<<<<<<<<
  *                 row_inds[1] = i001.index
  *                 row_inds[2] = i010.index
  */
-      __Pyx_TraceLine(5944,0,__PYX_ERR(0, 5944, __pyx_L1_error))
+      __Pyx_TraceLine(5939,0,__PYX_ERR(0, 5939, __pyx_L1_error))
       __pyx_t_23 = __pyx_v_i000->index;
       __pyx_t_19 = 0;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_row_inds.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5944, __pyx_L1_error)
+        __PYX_ERR(0, 5939, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_19 * __pyx_v_row_inds.strides[0]) )) = __pyx_t_23;
 
-      /* "discretize/_extensions/tree_ext.pyx":5945
+      /* "discretize/_extensions/tree_ext.pyx":5940
  *                 row_data[3] = (1 - w1) * (1 - w2) * w3
  *                 row_inds[0] = i000.index
  *                 row_inds[1] = i001.index             # <<<<<<<<<<<<<<
  *                 row_inds[2] = i010.index
  *                 row_inds[3] = i011.index
  */
-      __Pyx_TraceLine(5945,0,__PYX_ERR(0, 5945, __pyx_L1_error))
+      __Pyx_TraceLine(5940,0,__PYX_ERR(0, 5940, __pyx_L1_error))
       __pyx_t_23 = __pyx_v_i001->index;
       __pyx_t_19 = 1;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_row_inds.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5945, __pyx_L1_error)
+        __PYX_ERR(0, 5940, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_19 * __pyx_v_row_inds.strides[0]) )) = __pyx_t_23;
 
-      /* "discretize/_extensions/tree_ext.pyx":5946
+      /* "discretize/_extensions/tree_ext.pyx":5941
  *                 row_inds[0] = i000.index
  *                 row_inds[1] = i001.index
  *                 row_inds[2] = i010.index             # <<<<<<<<<<<<<<
  *                 row_inds[3] = i011.index
  *                 if dim==3:
  */
-      __Pyx_TraceLine(5946,0,__PYX_ERR(0, 5946, __pyx_L1_error))
+      __Pyx_TraceLine(5941,0,__PYX_ERR(0, 5941, __pyx_L1_error))
       __pyx_t_23 = __pyx_v_i010->index;
       __pyx_t_19 = 2;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_row_inds.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5946, __pyx_L1_error)
+        __PYX_ERR(0, 5941, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_19 * __pyx_v_row_inds.strides[0]) )) = __pyx_t_23;
 
-      /* "discretize/_extensions/tree_ext.pyx":5947
+      /* "discretize/_extensions/tree_ext.pyx":5942
  *                 row_inds[1] = i001.index
  *                 row_inds[2] = i010.index
  *                 row_inds[3] = i011.index             # <<<<<<<<<<<<<<
  *                 if dim==3:
  *                     row_data[4] = w1 * w2 * (1 - w3)
  */
-      __Pyx_TraceLine(5947,0,__PYX_ERR(0, 5947, __pyx_L1_error))
+      __Pyx_TraceLine(5942,0,__PYX_ERR(0, 5942, __pyx_L1_error))
       __pyx_t_23 = __pyx_v_i011->index;
       __pyx_t_19 = 3;
       __pyx_t_12 = -1;
       if (__pyx_t_19 < 0) {
         __pyx_t_19 += __pyx_v_row_inds.shape[0];
         if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
       } else if (unlikely(__pyx_t_19 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
       if (unlikely(__pyx_t_12 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_12);
-        __PYX_ERR(0, 5947, __pyx_L1_error)
+        __PYX_ERR(0, 5942, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_19 * __pyx_v_row_inds.strides[0]) )) = __pyx_t_23;
 
-      /* "discretize/_extensions/tree_ext.pyx":5948
+      /* "discretize/_extensions/tree_ext.pyx":5943
  *                 row_inds[2] = i010.index
  *                 row_inds[3] = i011.index
  *                 if dim==3:             # <<<<<<<<<<<<<<
  *                     row_data[4] = w1 * w2 * (1 - w3)
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  */
-      __Pyx_TraceLine(5948,0,__PYX_ERR(0, 5948, __pyx_L1_error))
+      __Pyx_TraceLine(5943,0,__PYX_ERR(0, 5943, __pyx_L1_error))
       __pyx_t_17 = ((__pyx_v_dim == 3) != 0);
       if (__pyx_t_17) {
 
-        /* "discretize/_extensions/tree_ext.pyx":5949
+        /* "discretize/_extensions/tree_ext.pyx":5944
  *                 row_inds[3] = i011.index
  *                 if dim==3:
  *                     row_data[4] = w1 * w2 * (1 - w3)             # <<<<<<<<<<<<<<
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)
  */
-        __Pyx_TraceLine(5949,0,__PYX_ERR(0, 5949, __pyx_L1_error))
-        __pyx_t_6 = PyFloat_FromDouble((__pyx_v_w1 * __pyx_v_w2)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5949, __pyx_L1_error)
+        __Pyx_TraceLine(5944,0,__PYX_ERR(0, 5944, __pyx_L1_error))
+        __pyx_t_6 = PyFloat_FromDouble((__pyx_v_w1 * __pyx_v_w2)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5944, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w3, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5949, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w3, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5944, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5949, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5944, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5949, __pyx_L1_error)
+        __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5944, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __pyx_t_19 = 4;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_row_data.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5949, __pyx_L1_error)
+          __PYX_ERR(0, 5944, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_19 * __pyx_v_row_data.strides[0]) )) = __pyx_t_22;
 
-        /* "discretize/_extensions/tree_ext.pyx":5950
+        /* "discretize/_extensions/tree_ext.pyx":5945
  *                 if dim==3:
  *                     row_data[4] = w1 * w2 * (1 - w3)
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)             # <<<<<<<<<<<<<<
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  */
-        __Pyx_TraceLine(5950,0,__PYX_ERR(0, 5950, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * __pyx_v_w2)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5950, __pyx_L1_error)
+        __Pyx_TraceLine(5945,0,__PYX_ERR(0, 5945, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * __pyx_v_w2)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5945, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w3, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5950, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w3, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5945, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_6 = PyNumber_Multiply(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5950, __pyx_L1_error)
+        __pyx_t_6 = PyNumber_Multiply(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5945, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5950, __pyx_L1_error)
+        __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5945, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_19 = 5;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_row_data.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5950, __pyx_L1_error)
+          __PYX_ERR(0, 5945, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_19 * __pyx_v_row_data.strides[0]) )) = __pyx_t_22;
 
-        /* "discretize/_extensions/tree_ext.pyx":5951
+        /* "discretize/_extensions/tree_ext.pyx":5946
  *                     row_data[4] = w1 * w2 * (1 - w3)
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)             # <<<<<<<<<<<<<<
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                     row_inds[4] = i100.index
  */
-        __Pyx_TraceLine(5951,0,__PYX_ERR(0, 5951, __pyx_L1_error))
-        __pyx_t_6 = PyFloat_FromDouble((__pyx_v_w1 * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5951, __pyx_L1_error)
+        __Pyx_TraceLine(5946,0,__PYX_ERR(0, 5946, __pyx_L1_error))
+        __pyx_t_6 = PyFloat_FromDouble((__pyx_v_w1 * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5946, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w3, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5951, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w3, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5946, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5951, __pyx_L1_error)
+        __pyx_t_5 = PyNumber_Multiply(__pyx_t_6, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5946, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5951, __pyx_L1_error)
+        __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_5); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5946, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __pyx_t_19 = 6;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_row_data.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5951, __pyx_L1_error)
+          __PYX_ERR(0, 5946, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_19 * __pyx_v_row_data.strides[0]) )) = __pyx_t_22;
 
-        /* "discretize/_extensions/tree_ext.pyx":5952
+        /* "discretize/_extensions/tree_ext.pyx":5947
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)             # <<<<<<<<<<<<<<
  *                     row_inds[4] = i100.index
  *                     row_inds[5] = i101.index
  */
-        __Pyx_TraceLine(5952,0,__PYX_ERR(0, 5952, __pyx_L1_error))
-        __pyx_t_5 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5952, __pyx_L1_error)
+        __Pyx_TraceLine(5947,0,__PYX_ERR(0, 5947, __pyx_L1_error))
+        __pyx_t_5 = PyFloat_FromDouble(((1.0 - __pyx_v_w1) * (1.0 - __pyx_v_w2))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5947, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w3, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5952, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w3, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5947, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_6 = PyNumber_Multiply(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5952, __pyx_L1_error)
+        __pyx_t_6 = PyNumber_Multiply(__pyx_t_5, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5947, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5952, __pyx_L1_error)
+        __pyx_t_22 = __pyx_PyFloat_AsDouble(__pyx_t_6); if (unlikely((__pyx_t_22 == ((npy_float64)-1)) && PyErr_Occurred())) __PYX_ERR(0, 5947, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __pyx_t_19 = 7;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_row_data.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_row_data.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5952, __pyx_L1_error)
+          __PYX_ERR(0, 5947, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_row_data.data + __pyx_t_19 * __pyx_v_row_data.strides[0]) )) = __pyx_t_22;
 
-        /* "discretize/_extensions/tree_ext.pyx":5953
+        /* "discretize/_extensions/tree_ext.pyx":5948
  *                     row_data[6] = w1 * (1 - w2) * (1 - w3)
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                     row_inds[4] = i100.index             # <<<<<<<<<<<<<<
  *                     row_inds[5] = i101.index
  *                     row_inds[6] = i110.index
  */
-        __Pyx_TraceLine(5953,0,__PYX_ERR(0, 5953, __pyx_L1_error))
+        __Pyx_TraceLine(5948,0,__PYX_ERR(0, 5948, __pyx_L1_error))
         __pyx_t_23 = __pyx_v_i100->index;
         __pyx_t_19 = 4;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_row_inds.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5953, __pyx_L1_error)
+          __PYX_ERR(0, 5948, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_19 * __pyx_v_row_inds.strides[0]) )) = __pyx_t_23;
 
-        /* "discretize/_extensions/tree_ext.pyx":5954
+        /* "discretize/_extensions/tree_ext.pyx":5949
  *                     row_data[7] = (1 - w1) * (1 - w2) * (1 - w3)
  *                     row_inds[4] = i100.index
  *                     row_inds[5] = i101.index             # <<<<<<<<<<<<<<
  *                     row_inds[6] = i110.index
  *                     row_inds[7] = i111.index
  */
-        __Pyx_TraceLine(5954,0,__PYX_ERR(0, 5954, __pyx_L1_error))
+        __Pyx_TraceLine(5949,0,__PYX_ERR(0, 5949, __pyx_L1_error))
         __pyx_t_23 = __pyx_v_i101->index;
         __pyx_t_19 = 5;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_row_inds.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5954, __pyx_L1_error)
+          __PYX_ERR(0, 5949, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_19 * __pyx_v_row_inds.strides[0]) )) = __pyx_t_23;
 
-        /* "discretize/_extensions/tree_ext.pyx":5955
+        /* "discretize/_extensions/tree_ext.pyx":5950
  *                     row_inds[4] = i100.index
  *                     row_inds[5] = i101.index
  *                     row_inds[6] = i110.index             # <<<<<<<<<<<<<<
  *                     row_inds[7] = i111.index
  *         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0],self.n_cells))
  */
-        __Pyx_TraceLine(5955,0,__PYX_ERR(0, 5955, __pyx_L1_error))
+        __Pyx_TraceLine(5950,0,__PYX_ERR(0, 5950, __pyx_L1_error))
         __pyx_t_23 = __pyx_v_i110->index;
         __pyx_t_19 = 6;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_row_inds.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5955, __pyx_L1_error)
+          __PYX_ERR(0, 5950, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_19 * __pyx_v_row_inds.strides[0]) )) = __pyx_t_23;
 
-        /* "discretize/_extensions/tree_ext.pyx":5956
+        /* "discretize/_extensions/tree_ext.pyx":5951
  *                     row_inds[5] = i101.index
  *                     row_inds[6] = i110.index
  *                     row_inds[7] = i111.index             # <<<<<<<<<<<<<<
  *         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0],self.n_cells))
  * 
  */
-        __Pyx_TraceLine(5956,0,__PYX_ERR(0, 5956, __pyx_L1_error))
+        __Pyx_TraceLine(5951,0,__PYX_ERR(0, 5951, __pyx_L1_error))
         __pyx_t_23 = __pyx_v_i111->index;
         __pyx_t_19 = 7;
         __pyx_t_12 = -1;
         if (__pyx_t_19 < 0) {
           __pyx_t_19 += __pyx_v_row_inds.shape[0];
           if (unlikely(__pyx_t_19 < 0)) __pyx_t_12 = 0;
         } else if (unlikely(__pyx_t_19 >= __pyx_v_row_inds.shape[0])) __pyx_t_12 = 0;
         if (unlikely(__pyx_t_12 != -1)) {
           __Pyx_RaiseBufferIndexError(__pyx_t_12);
-          __PYX_ERR(0, 5956, __pyx_L1_error)
+          __PYX_ERR(0, 5951, __pyx_L1_error)
         }
         *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_row_inds.data + __pyx_t_19 * __pyx_v_row_inds.strides[0]) )) = __pyx_t_23;
 
-        /* "discretize/_extensions/tree_ext.pyx":5948
+        /* "discretize/_extensions/tree_ext.pyx":5943
  *                 row_inds[2] = i010.index
  *                 row_inds[3] = i011.index
  *                 if dim==3:             # <<<<<<<<<<<<<<
  *                     row_data[4] = w1 * w2 * (1 - w3)
  *                     row_data[5] = (1 - w1) * w2 * (1 - w3)
  */
       }
     }
     __pyx_L5:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5957
+  /* "discretize/_extensions/tree_ext.pyx":5952
  *                     row_inds[6] = i110.index
  *                     row_inds[7] = i111.index
  *         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0],self.n_cells))             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(5957,0,__PYX_ERR(0, 5957, __pyx_L1_error))
+  __Pyx_TraceLine(5952,0,__PYX_ERR(0, 5952, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_data, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_6 = __pyx_memoryview_fromslice(__pyx_v_data, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_float64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_float64_t, 0);; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_indices, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_4 = __pyx_memoryview_fromslice(__pyx_v_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_4);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_8);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_8);
   __pyx_t_8 = 0;
-  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_locs, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_5);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
-  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 5957, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5957, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5952, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_r = __pyx_t_7;
   __pyx_t_7 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5741
+  /* "discretize/_extensions/tree_ext.pyx":5736
  *         return sp.csr_matrix((V, (I, J)), shape=(locs.shape[0],self.n_total_nodes))*Rn
  * 
- *     def _getCellIntMat(self, locs, zerosOutside):             # <<<<<<<<<<<<<<
+ *     def _getCellIntMat(self, locs, zeros_outside):             # <<<<<<<<<<<<<<
  *         cdef:
  *             double[:, :] locations = locs
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __PYX_XDEC_MEMVIEW(&__pyx_t_1, 1);
@@ -74672,19 +74684,19 @@
   __Pyx_XDECREF(__pyx_v_w3);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5960
+/* "discretize/_extensions/tree_ext.pyx":5955
  * 
  *     @property
  *     def cell_nodes(self):             # <<<<<<<<<<<<<<
- *         """The index of nodes for each cell.
+ *         """The index of all nodes for each cell.
  * 
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_10cell_nodes_1__get__(PyObject *__pyx_v_self); /*proto*/
 static PyObject *__pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_10cell_nodes_1__get__(PyObject *__pyx_v_self) {
   PyObject *__pyx_r = 0;
@@ -74723,182 +74735,182 @@
   PY_LONG_LONG __pyx_t_15;
   Py_ssize_t __pyx_t_16;
   int __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 5960, 0, __PYX_ERR(0, 5960, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 5955, 0, __PYX_ERR(0, 5955, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5972
- *         These indices will also point to hanging nodes.
+  /* "discretize/_extensions/tree_ext.pyx":5969
+ *         TreeMesh.total_nodes
  *         """
  *         cdef int_t npc = 4 if self.dim == 2 else 8             # <<<<<<<<<<<<<<
  *         inds = np.empty((self.n_cells, npc), dtype=np.int64)
  *         cdef np.int64_t[:, :] node_index = inds
  */
-  __Pyx_TraceLine(5972,0,__PYX_ERR(0, 5972, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5972, __pyx_L1_error)
+  __Pyx_TraceLine(5969,0,__PYX_ERR(0, 5969, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5969, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_2, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5972, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_2, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5969, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 5972, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 5969, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if (__pyx_t_4) {
     __pyx_t_1 = 4;
   } else {
     __pyx_t_1 = 8;
   }
   __pyx_v_npc = __pyx_t_1;
 
-  /* "discretize/_extensions/tree_ext.pyx":5973
+  /* "discretize/_extensions/tree_ext.pyx":5970
  *         """
  *         cdef int_t npc = 4 if self.dim == 2 else 8
  *         inds = np.empty((self.n_cells, npc), dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:, :] node_index = inds
  *         cdef int_t i
  */
-  __Pyx_TraceLine(5973,0,__PYX_ERR(0, 5973, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __Pyx_TraceLine(5970,0,__PYX_ERR(0, 5970, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_npc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_npc); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_5);
   __pyx_t_3 = 0;
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 5973, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5973, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5970, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_inds = __pyx_t_7;
   __pyx_t_7 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5974
+  /* "discretize/_extensions/tree_ext.pyx":5971
  *         cdef int_t npc = 4 if self.dim == 2 else 8
  *         inds = np.empty((self.n_cells, npc), dtype=np.int64)
  *         cdef np.int64_t[:, :] node_index = inds             # <<<<<<<<<<<<<<
  *         cdef int_t i
  * 
  */
-  __Pyx_TraceLine(5974,0,__PYX_ERR(0, 5974, __pyx_L1_error))
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_inds, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5974, __pyx_L1_error)
+  __Pyx_TraceLine(5971,0,__PYX_ERR(0, 5971, __pyx_L1_error))
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_inds, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 5971, __pyx_L1_error)
   __pyx_v_node_index = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":5977
+  /* "discretize/_extensions/tree_ext.pyx":5974
  *         cdef int_t i
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             for i in range(npc):
  *                 node_index[cell.index, i] = cell.points[i].index
  */
-  __Pyx_TraceLine(5977,0,__PYX_ERR(0, 5977, __pyx_L1_error))
+  __Pyx_TraceLine(5974,0,__PYX_ERR(0, 5974, __pyx_L1_error))
   __pyx_t_10 = &__pyx_v_self->tree->cells;
   __pyx_t_9 = __pyx_t_10->begin();
   for (;;) {
     if (!(__pyx_t_9 != __pyx_t_10->end())) break;
     __pyx_t_11 = *__pyx_t_9;
     ++__pyx_t_9;
     __pyx_v_cell = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":5978
+    /* "discretize/_extensions/tree_ext.pyx":5975
  * 
  *         for cell in self.tree.cells:
  *             for i in range(npc):             # <<<<<<<<<<<<<<
  *                 node_index[cell.index, i] = cell.points[i].index
  * 
  */
-    __Pyx_TraceLine(5978,0,__PYX_ERR(0, 5978, __pyx_L1_error))
+    __Pyx_TraceLine(5975,0,__PYX_ERR(0, 5975, __pyx_L1_error))
     __pyx_t_1 = __pyx_v_npc;
     __pyx_t_12 = __pyx_t_1;
     for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
       __pyx_v_i = __pyx_t_13;
 
-      /* "discretize/_extensions/tree_ext.pyx":5979
+      /* "discretize/_extensions/tree_ext.pyx":5976
  *         for cell in self.tree.cells:
  *             for i in range(npc):
  *                 node_index[cell.index, i] = cell.points[i].index             # <<<<<<<<<<<<<<
  * 
  *         return inds
  */
-      __Pyx_TraceLine(5979,0,__PYX_ERR(0, 5979, __pyx_L1_error))
+      __Pyx_TraceLine(5976,0,__PYX_ERR(0, 5976, __pyx_L1_error))
       __pyx_t_14 = (__pyx_v_cell->points[__pyx_v_i])->index;
       __pyx_t_15 = __pyx_v_cell->index;
       __pyx_t_16 = __pyx_v_i;
       __pyx_t_17 = -1;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v_node_index.shape[0];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_15 >= __pyx_v_node_index.shape[0])) __pyx_t_17 = 0;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v_node_index.shape[1];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 1;
       } else if (unlikely(__pyx_t_16 >= __pyx_v_node_index.shape[1])) __pyx_t_17 = 1;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 5979, __pyx_L1_error)
+        __PYX_ERR(0, 5976, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_node_index.data + __pyx_t_15 * __pyx_v_node_index.strides[0]) ) + __pyx_t_16 * __pyx_v_node_index.strides[1]) )) = __pyx_t_14;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":5977
+    /* "discretize/_extensions/tree_ext.pyx":5974
  *         cdef int_t i
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             for i in range(npc):
  *                 node_index[cell.index, i] = cell.points[i].index
  */
-    __Pyx_TraceLine(5977,0,__PYX_ERR(0, 5977, __pyx_L1_error))
+    __Pyx_TraceLine(5974,0,__PYX_ERR(0, 5974, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":5981
+  /* "discretize/_extensions/tree_ext.pyx":5978
  *                 node_index[cell.index, i] = cell.points[i].index
  * 
  *         return inds             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(5981,0,__PYX_ERR(0, 5981, __pyx_L1_error))
+  __Pyx_TraceLine(5978,0,__PYX_ERR(0, 5978, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_inds);
   __pyx_r = __pyx_v_inds;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5960
+  /* "discretize/_extensions/tree_ext.pyx":5955
  * 
  *     @property
  *     def cell_nodes(self):             # <<<<<<<<<<<<<<
- *         """The index of nodes for each cell.
+ *         """The index of all nodes for each cell.
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
@@ -74913,15 +74925,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v_node_index, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":5984
+/* "discretize/_extensions/tree_ext.pyx":5981
  * 
  *     @property
  *     def edge_nodes(self):             # <<<<<<<<<<<<<<
  *         """The index of nodes for every edge.
  * 
  */
 
@@ -74963,531 +74975,531 @@
   Py_ssize_t __pyx_t_13;
   int __pyx_t_14;
   int __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 5984, 0, __PYX_ERR(0, 5984, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 5981, 0, __PYX_ERR(0, 5981, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":5998
+  /* "discretize/_extensions/tree_ext.pyx":5995
  *         These arrays will also index into the hanging nodes.
  *         """
  *         inds_x = np.empty((self.n_total_edges_x, 2), dtype=np.int64)             # <<<<<<<<<<<<<<
  *         inds_y = np.empty((self.n_total_edges_y, 2), dtype=np.int64)
  *         cdef np.int64_t[:, :] edge_inds
  */
-  __Pyx_TraceLine(5998,0,__PYX_ERR(0, 5998, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __Pyx_TraceLine(5995,0,__PYX_ERR(0, 5995, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_empty); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1);
   __Pyx_INCREF(__pyx_int_2);
   __Pyx_GIVEREF(__pyx_int_2);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_int_2);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_3);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_3);
   __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_int64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5998, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5998, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_inds_x = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5999
+  /* "discretize/_extensions/tree_ext.pyx":5996
  *         """
  *         inds_x = np.empty((self.n_total_edges_x, 2), dtype=np.int64)
  *         inds_y = np.empty((self.n_total_edges_y, 2), dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:, :] edge_inds
  * 
  */
-  __Pyx_TraceLine(5999,0,__PYX_ERR(0, 5999, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __Pyx_TraceLine(5996,0,__PYX_ERR(0, 5996, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_y); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_y); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
   __Pyx_INCREF(__pyx_int_2);
   __Pyx_GIVEREF(__pyx_int_2);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_2);
   __pyx_t_5 = 0;
-  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 5999, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5999, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5996, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_inds_y = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6002
+  /* "discretize/_extensions/tree_ext.pyx":5999
  *         cdef np.int64_t[:, :] edge_inds
  * 
  *         edge_inds = inds_x             # <<<<<<<<<<<<<<
  *         for it in self.tree.edges_x:
  *             edge = it.second
  */
-  __Pyx_TraceLine(6002,0,__PYX_ERR(0, 6002, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_inds_x, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 6002, __pyx_L1_error)
+  __Pyx_TraceLine(5999,0,__PYX_ERR(0, 5999, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_inds_x, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 5999, __pyx_L1_error)
   __pyx_v_edge_inds = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6003
+  /* "discretize/_extensions/tree_ext.pyx":6000
  * 
  *         edge_inds = inds_x
  *         for it in self.tree.edges_x:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  */
-  __Pyx_TraceLine(6003,0,__PYX_ERR(0, 6003, __pyx_L1_error))
+  __Pyx_TraceLine(6000,0,__PYX_ERR(0, 6000, __pyx_L1_error))
   __pyx_t_8 = &__pyx_v_self->tree->edges_x;
   __pyx_t_7 = __pyx_t_8->begin();
   for (;;) {
     if (!(__pyx_t_7 != __pyx_t_8->end())) break;
     __pyx_t_9 = *__pyx_t_7;
     ++__pyx_t_7;
     __pyx_v_it = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":6004
+    /* "discretize/_extensions/tree_ext.pyx":6001
  *         edge_inds = inds_x
  *         for it in self.tree.edges_x:
  *             edge = it.second             # <<<<<<<<<<<<<<
  *             edge_inds[edge.index, 0] = edge.points[0].index
  *             edge_inds[edge.index, 1] = edge.points[1].index
  */
-    __Pyx_TraceLine(6004,0,__PYX_ERR(0, 6004, __pyx_L1_error))
+    __Pyx_TraceLine(6001,0,__PYX_ERR(0, 6001, __pyx_L1_error))
     __pyx_t_10 = __pyx_v_it.second;
     __pyx_v_edge = __pyx_t_10;
 
-    /* "discretize/_extensions/tree_ext.pyx":6005
+    /* "discretize/_extensions/tree_ext.pyx":6002
  *         for it in self.tree.edges_x:
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index             # <<<<<<<<<<<<<<
  *             edge_inds[edge.index, 1] = edge.points[1].index
  * 
  */
-    __Pyx_TraceLine(6005,0,__PYX_ERR(0, 6005, __pyx_L1_error))
+    __Pyx_TraceLine(6002,0,__PYX_ERR(0, 6002, __pyx_L1_error))
     __pyx_t_11 = (__pyx_v_edge->points[0])->index;
     __pyx_t_12 = __pyx_v_edge->index;
     __pyx_t_13 = 0;
     __pyx_t_14 = -1;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_edge_inds.shape[0];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_14 = 0;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_edge_inds.shape[0])) __pyx_t_14 = 0;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_edge_inds.shape[1];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 1;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_edge_inds.shape[1])) __pyx_t_14 = 1;
     if (unlikely(__pyx_t_14 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_14);
-      __PYX_ERR(0, 6005, __pyx_L1_error)
+      __PYX_ERR(0, 6002, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_edge_inds.data + __pyx_t_12 * __pyx_v_edge_inds.strides[0]) ) + __pyx_t_13 * __pyx_v_edge_inds.strides[1]) )) = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6006
+    /* "discretize/_extensions/tree_ext.pyx":6003
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  *             edge_inds[edge.index, 1] = edge.points[1].index             # <<<<<<<<<<<<<<
  * 
  *         edge_inds = inds_y
  */
-    __Pyx_TraceLine(6006,0,__PYX_ERR(0, 6006, __pyx_L1_error))
+    __Pyx_TraceLine(6003,0,__PYX_ERR(0, 6003, __pyx_L1_error))
     __pyx_t_11 = (__pyx_v_edge->points[1])->index;
     __pyx_t_13 = __pyx_v_edge->index;
     __pyx_t_12 = 1;
     __pyx_t_14 = -1;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_edge_inds.shape[0];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_edge_inds.shape[0])) __pyx_t_14 = 0;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_edge_inds.shape[1];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_14 = 1;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_edge_inds.shape[1])) __pyx_t_14 = 1;
     if (unlikely(__pyx_t_14 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_14);
-      __PYX_ERR(0, 6006, __pyx_L1_error)
+      __PYX_ERR(0, 6003, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_edge_inds.data + __pyx_t_13 * __pyx_v_edge_inds.strides[0]) ) + __pyx_t_12 * __pyx_v_edge_inds.strides[1]) )) = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6003
+    /* "discretize/_extensions/tree_ext.pyx":6000
  * 
  *         edge_inds = inds_x
  *         for it in self.tree.edges_x:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  */
-    __Pyx_TraceLine(6003,0,__PYX_ERR(0, 6003, __pyx_L1_error))
+    __Pyx_TraceLine(6000,0,__PYX_ERR(0, 6000, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6008
+  /* "discretize/_extensions/tree_ext.pyx":6005
  *             edge_inds[edge.index, 1] = edge.points[1].index
  * 
  *         edge_inds = inds_y             # <<<<<<<<<<<<<<
  *         for it in self.tree.edges_y:
  *             edge = it.second
  */
-  __Pyx_TraceLine(6008,0,__PYX_ERR(0, 6008, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_inds_y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 6008, __pyx_L1_error)
+  __Pyx_TraceLine(6005,0,__PYX_ERR(0, 6005, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_inds_y, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 6005, __pyx_L1_error)
   __PYX_XDEC_MEMVIEW(&__pyx_v_edge_inds, 1);
   __pyx_v_edge_inds = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6009
+  /* "discretize/_extensions/tree_ext.pyx":6006
  * 
  *         edge_inds = inds_y
  *         for it in self.tree.edges_y:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  */
-  __Pyx_TraceLine(6009,0,__PYX_ERR(0, 6009, __pyx_L1_error))
+  __Pyx_TraceLine(6006,0,__PYX_ERR(0, 6006, __pyx_L1_error))
   __pyx_t_8 = &__pyx_v_self->tree->edges_y;
   __pyx_t_7 = __pyx_t_8->begin();
   for (;;) {
     if (!(__pyx_t_7 != __pyx_t_8->end())) break;
     __pyx_t_9 = *__pyx_t_7;
     ++__pyx_t_7;
     __pyx_v_it = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":6010
+    /* "discretize/_extensions/tree_ext.pyx":6007
  *         edge_inds = inds_y
  *         for it in self.tree.edges_y:
  *             edge = it.second             # <<<<<<<<<<<<<<
  *             edge_inds[edge.index, 0] = edge.points[0].index
  *             edge_inds[edge.index, 1] = edge.points[1].index
  */
-    __Pyx_TraceLine(6010,0,__PYX_ERR(0, 6010, __pyx_L1_error))
+    __Pyx_TraceLine(6007,0,__PYX_ERR(0, 6007, __pyx_L1_error))
     __pyx_t_10 = __pyx_v_it.second;
     __pyx_v_edge = __pyx_t_10;
 
-    /* "discretize/_extensions/tree_ext.pyx":6011
+    /* "discretize/_extensions/tree_ext.pyx":6008
  *         for it in self.tree.edges_y:
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index             # <<<<<<<<<<<<<<
  *             edge_inds[edge.index, 1] = edge.points[1].index
  * 
  */
-    __Pyx_TraceLine(6011,0,__PYX_ERR(0, 6011, __pyx_L1_error))
+    __Pyx_TraceLine(6008,0,__PYX_ERR(0, 6008, __pyx_L1_error))
     __pyx_t_11 = (__pyx_v_edge->points[0])->index;
     __pyx_t_12 = __pyx_v_edge->index;
     __pyx_t_13 = 0;
     __pyx_t_14 = -1;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_edge_inds.shape[0];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_14 = 0;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_edge_inds.shape[0])) __pyx_t_14 = 0;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_edge_inds.shape[1];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 1;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_edge_inds.shape[1])) __pyx_t_14 = 1;
     if (unlikely(__pyx_t_14 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_14);
-      __PYX_ERR(0, 6011, __pyx_L1_error)
+      __PYX_ERR(0, 6008, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_edge_inds.data + __pyx_t_12 * __pyx_v_edge_inds.strides[0]) ) + __pyx_t_13 * __pyx_v_edge_inds.strides[1]) )) = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6012
+    /* "discretize/_extensions/tree_ext.pyx":6009
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  *             edge_inds[edge.index, 1] = edge.points[1].index             # <<<<<<<<<<<<<<
  * 
  *         if self.dim == 2:
  */
-    __Pyx_TraceLine(6012,0,__PYX_ERR(0, 6012, __pyx_L1_error))
+    __Pyx_TraceLine(6009,0,__PYX_ERR(0, 6009, __pyx_L1_error))
     __pyx_t_11 = (__pyx_v_edge->points[1])->index;
     __pyx_t_13 = __pyx_v_edge->index;
     __pyx_t_12 = 1;
     __pyx_t_14 = -1;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_edge_inds.shape[0];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_edge_inds.shape[0])) __pyx_t_14 = 0;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_edge_inds.shape[1];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_14 = 1;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_edge_inds.shape[1])) __pyx_t_14 = 1;
     if (unlikely(__pyx_t_14 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_14);
-      __PYX_ERR(0, 6012, __pyx_L1_error)
+      __PYX_ERR(0, 6009, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_edge_inds.data + __pyx_t_13 * __pyx_v_edge_inds.strides[0]) ) + __pyx_t_12 * __pyx_v_edge_inds.strides[1]) )) = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6009
+    /* "discretize/_extensions/tree_ext.pyx":6006
  * 
  *         edge_inds = inds_y
  *         for it in self.tree.edges_y:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  */
-    __Pyx_TraceLine(6009,0,__PYX_ERR(0, 6009, __pyx_L1_error))
+    __Pyx_TraceLine(6006,0,__PYX_ERR(0, 6006, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6014
+  /* "discretize/_extensions/tree_ext.pyx":6011
  *             edge_inds[edge.index, 1] = edge.points[1].index
  * 
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             return inds_x, inds_y
  * 
  */
-  __Pyx_TraceLine(6014,0,__PYX_ERR(0, 6014, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6014, __pyx_L1_error)
+  __Pyx_TraceLine(6011,0,__PYX_ERR(0, 6011, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6011, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6014, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_t_4, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6011, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 6014, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_15 < 0)) __PYX_ERR(0, 6011, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_15) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6015
+    /* "discretize/_extensions/tree_ext.pyx":6012
  * 
  *         if self.dim == 2:
  *             return inds_x, inds_y             # <<<<<<<<<<<<<<
  * 
  *         inds_z = np.empty((self.n_total_edges_z, 2), dtype=np.int64)
  */
-    __Pyx_TraceLine(6015,0,__PYX_ERR(0, 6015, __pyx_L1_error))
+    __Pyx_TraceLine(6012,0,__PYX_ERR(0, 6012, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6015, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6012, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_v_inds_x);
     __Pyx_GIVEREF(__pyx_v_inds_x);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_inds_x);
     __Pyx_INCREF(__pyx_v_inds_y);
     __Pyx_GIVEREF(__pyx_v_inds_y);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_inds_y);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6014
+    /* "discretize/_extensions/tree_ext.pyx":6011
  *             edge_inds[edge.index, 1] = edge.points[1].index
  * 
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             return inds_x, inds_y
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6017
+  /* "discretize/_extensions/tree_ext.pyx":6014
  *             return inds_x, inds_y
  * 
  *         inds_z = np.empty((self.n_total_edges_z, 2), dtype=np.int64)             # <<<<<<<<<<<<<<
  *         edge_inds = inds_z
  *         for it in self.tree.edges_z:
  */
-  __Pyx_TraceLine(6017,0,__PYX_ERR(0, 6017, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __Pyx_TraceLine(6014,0,__PYX_ERR(0, 6014, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_empty); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_z); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_total_edges_z); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1);
   __Pyx_INCREF(__pyx_int_2);
   __Pyx_GIVEREF(__pyx_int_2);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_int_2);
   __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 6017, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6017, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6014, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_inds_z = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6018
+  /* "discretize/_extensions/tree_ext.pyx":6015
  * 
  *         inds_z = np.empty((self.n_total_edges_z, 2), dtype=np.int64)
  *         edge_inds = inds_z             # <<<<<<<<<<<<<<
  *         for it in self.tree.edges_z:
  *             edge = it.second
  */
-  __Pyx_TraceLine(6018,0,__PYX_ERR(0, 6018, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_inds_z, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 6018, __pyx_L1_error)
+  __Pyx_TraceLine(6015,0,__PYX_ERR(0, 6015, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_inds_z, PyBUF_WRITABLE); if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 6015, __pyx_L1_error)
   __PYX_XDEC_MEMVIEW(&__pyx_v_edge_inds, 1);
   __pyx_v_edge_inds = __pyx_t_6;
   __pyx_t_6.memview = NULL;
   __pyx_t_6.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6019
+  /* "discretize/_extensions/tree_ext.pyx":6016
  *         inds_z = np.empty((self.n_total_edges_z, 2), dtype=np.int64)
  *         edge_inds = inds_z
  *         for it in self.tree.edges_z:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  */
-  __Pyx_TraceLine(6019,0,__PYX_ERR(0, 6019, __pyx_L1_error))
+  __Pyx_TraceLine(6016,0,__PYX_ERR(0, 6016, __pyx_L1_error))
   __pyx_t_8 = &__pyx_v_self->tree->edges_z;
   __pyx_t_7 = __pyx_t_8->begin();
   for (;;) {
     if (!(__pyx_t_7 != __pyx_t_8->end())) break;
     __pyx_t_9 = *__pyx_t_7;
     ++__pyx_t_7;
     __pyx_v_it = __pyx_t_9;
 
-    /* "discretize/_extensions/tree_ext.pyx":6020
+    /* "discretize/_extensions/tree_ext.pyx":6017
  *         edge_inds = inds_z
  *         for it in self.tree.edges_z:
  *             edge = it.second             # <<<<<<<<<<<<<<
  *             edge_inds[edge.index, 0] = edge.points[0].index
  *             edge_inds[edge.index, 1] = edge.points[1].index
  */
-    __Pyx_TraceLine(6020,0,__PYX_ERR(0, 6020, __pyx_L1_error))
+    __Pyx_TraceLine(6017,0,__PYX_ERR(0, 6017, __pyx_L1_error))
     __pyx_t_10 = __pyx_v_it.second;
     __pyx_v_edge = __pyx_t_10;
 
-    /* "discretize/_extensions/tree_ext.pyx":6021
+    /* "discretize/_extensions/tree_ext.pyx":6018
  *         for it in self.tree.edges_z:
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index             # <<<<<<<<<<<<<<
  *             edge_inds[edge.index, 1] = edge.points[1].index
  * 
  */
-    __Pyx_TraceLine(6021,0,__PYX_ERR(0, 6021, __pyx_L1_error))
+    __Pyx_TraceLine(6018,0,__PYX_ERR(0, 6018, __pyx_L1_error))
     __pyx_t_11 = (__pyx_v_edge->points[0])->index;
     __pyx_t_12 = __pyx_v_edge->index;
     __pyx_t_13 = 0;
     __pyx_t_14 = -1;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_edge_inds.shape[0];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_14 = 0;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_edge_inds.shape[0])) __pyx_t_14 = 0;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_edge_inds.shape[1];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 1;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_edge_inds.shape[1])) __pyx_t_14 = 1;
     if (unlikely(__pyx_t_14 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_14);
-      __PYX_ERR(0, 6021, __pyx_L1_error)
+      __PYX_ERR(0, 6018, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_edge_inds.data + __pyx_t_12 * __pyx_v_edge_inds.strides[0]) ) + __pyx_t_13 * __pyx_v_edge_inds.strides[1]) )) = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6022
+    /* "discretize/_extensions/tree_ext.pyx":6019
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  *             edge_inds[edge.index, 1] = edge.points[1].index             # <<<<<<<<<<<<<<
  * 
  *         return inds_x, inds_y, inds_z
  */
-    __Pyx_TraceLine(6022,0,__PYX_ERR(0, 6022, __pyx_L1_error))
+    __Pyx_TraceLine(6019,0,__PYX_ERR(0, 6019, __pyx_L1_error))
     __pyx_t_11 = (__pyx_v_edge->points[1])->index;
     __pyx_t_13 = __pyx_v_edge->index;
     __pyx_t_12 = 1;
     __pyx_t_14 = -1;
     if (__pyx_t_13 < 0) {
       __pyx_t_13 += __pyx_v_edge_inds.shape[0];
       if (unlikely(__pyx_t_13 < 0)) __pyx_t_14 = 0;
     } else if (unlikely(__pyx_t_13 >= __pyx_v_edge_inds.shape[0])) __pyx_t_14 = 0;
     if (__pyx_t_12 < 0) {
       __pyx_t_12 += __pyx_v_edge_inds.shape[1];
       if (unlikely(__pyx_t_12 < 0)) __pyx_t_14 = 1;
     } else if (unlikely(__pyx_t_12 >= __pyx_v_edge_inds.shape[1])) __pyx_t_14 = 1;
     if (unlikely(__pyx_t_14 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_14);
-      __PYX_ERR(0, 6022, __pyx_L1_error)
+      __PYX_ERR(0, 6019, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int64_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_edge_inds.data + __pyx_t_13 * __pyx_v_edge_inds.strides[0]) ) + __pyx_t_12 * __pyx_v_edge_inds.strides[1]) )) = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6019
+    /* "discretize/_extensions/tree_ext.pyx":6016
  *         inds_z = np.empty((self.n_total_edges_z, 2), dtype=np.int64)
  *         edge_inds = inds_z
  *         for it in self.tree.edges_z:             # <<<<<<<<<<<<<<
  *             edge = it.second
  *             edge_inds[edge.index, 0] = edge.points[0].index
  */
-    __Pyx_TraceLine(6019,0,__PYX_ERR(0, 6019, __pyx_L1_error))
+    __Pyx_TraceLine(6016,0,__PYX_ERR(0, 6016, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6024
+  /* "discretize/_extensions/tree_ext.pyx":6021
  *             edge_inds[edge.index, 1] = edge.points[1].index
  * 
  *         return inds_x, inds_y, inds_z             # <<<<<<<<<<<<<<
  * 
  *     def __getstate__(self):
  */
-  __Pyx_TraceLine(6024,0,__PYX_ERR(0, 6024, __pyx_L1_error))
+  __Pyx_TraceLine(6021,0,__PYX_ERR(0, 6021, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6024, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6021, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_v_inds_x);
   __Pyx_GIVEREF(__pyx_v_inds_x);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_inds_x);
   __Pyx_INCREF(__pyx_v_inds_y);
   __Pyx_GIVEREF(__pyx_v_inds_y);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_inds_y);
   __Pyx_INCREF(__pyx_v_inds_z);
   __Pyx_GIVEREF(__pyx_v_inds_z);
   PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_inds_z);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":5984
+  /* "discretize/_extensions/tree_ext.pyx":5981
  * 
  *     @property
  *     def edge_nodes(self):             # <<<<<<<<<<<<<<
  *         """The index of nodes for every edge.
  * 
  */
 
@@ -75508,15 +75520,15 @@
   __Pyx_XDECREF(__pyx_v_inds_z);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6026
+/* "discretize/_extensions/tree_ext.pyx":6023
  *         return inds_x, inds_y, inds_z
  * 
  *     def __getstate__(self):             # <<<<<<<<<<<<<<
  *         """Get the current state of the TreeMesh."""
  *         cdef int id, dim = self._dim
  */
 
@@ -75562,245 +75574,245 @@
   PY_LONG_LONG __pyx_t_15;
   Py_ssize_t __pyx_t_16;
   int __pyx_t_17;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__getstate__", 0);
-  __Pyx_TraceCall("__getstate__", __pyx_f[0], 6026, 0, __PYX_ERR(0, 6026, __pyx_L1_error));
+  __Pyx_TraceCall("__getstate__", __pyx_f[0], 6023, 0, __PYX_ERR(0, 6023, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":6028
+  /* "discretize/_extensions/tree_ext.pyx":6025
  *     def __getstate__(self):
  *         """Get the current state of the TreeMesh."""
  *         cdef int id, dim = self._dim             # <<<<<<<<<<<<<<
  *         indArr = np.empty((self.n_cells, dim), dtype=np.int64)
  *         levels = np.empty((self.n_cells), dtype=np.int32)
  */
-  __Pyx_TraceLine(6028,0,__PYX_ERR(0, 6028, __pyx_L1_error))
+  __Pyx_TraceLine(6025,0,__PYX_ERR(0, 6025, __pyx_L1_error))
   __pyx_t_1 = __pyx_v_self->_dim;
   __pyx_v_dim = __pyx_t_1;
 
-  /* "discretize/_extensions/tree_ext.pyx":6029
+  /* "discretize/_extensions/tree_ext.pyx":6026
  *         """Get the current state of the TreeMesh."""
  *         cdef int id, dim = self._dim
  *         indArr = np.empty((self.n_cells, dim), dtype=np.int64)             # <<<<<<<<<<<<<<
  *         levels = np.empty((self.n_cells), dtype=np.int32)
  *         cdef np.int64_t[:, :] _indArr = indArr
  */
-  __Pyx_TraceLine(6029,0,__PYX_ERR(0, 6029, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __Pyx_TraceLine(6026,0,__PYX_ERR(0, 6026, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_empty); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_dim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
   __pyx_t_2 = 0;
   __pyx_t_4 = 0;
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_5);
   __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_int64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 6029, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6029, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6026, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_v_indArr = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6030
+  /* "discretize/_extensions/tree_ext.pyx":6027
  *         cdef int id, dim = self._dim
  *         indArr = np.empty((self.n_cells, dim), dtype=np.int64)
  *         levels = np.empty((self.n_cells), dtype=np.int32)             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:, :] _indArr = indArr
  *         cdef np.int32_t[:] _levels = levels
  */
-  __Pyx_TraceLine(6030,0,__PYX_ERR(0, 6030, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6030, __pyx_L1_error)
+  __Pyx_TraceLine(6027,0,__PYX_ERR(0, 6027, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6030, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_empty); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6030, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6030, __pyx_L1_error)
+  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6030, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6030, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6030, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_int32); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 6030, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6030, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_levels = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6031
+  /* "discretize/_extensions/tree_ext.pyx":6028
  *         indArr = np.empty((self.n_cells, dim), dtype=np.int64)
  *         levels = np.empty((self.n_cells), dtype=np.int32)
  *         cdef np.int64_t[:, :] _indArr = indArr             # <<<<<<<<<<<<<<
  *         cdef np.int32_t[:] _levels = levels
  *         for cell in self.tree.cells:
  */
-  __Pyx_TraceLine(6031,0,__PYX_ERR(0, 6031, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_indArr, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 6031, __pyx_L1_error)
+  __Pyx_TraceLine(6028,0,__PYX_ERR(0, 6028, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_to_MemoryviewSlice_dsds_nn___pyx_t_5numpy_int64_t(__pyx_v_indArr, PyBUF_WRITABLE); if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 6028, __pyx_L1_error)
   __pyx_v__indArr = __pyx_t_7;
   __pyx_t_7.memview = NULL;
   __pyx_t_7.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6032
+  /* "discretize/_extensions/tree_ext.pyx":6029
  *         levels = np.empty((self.n_cells), dtype=np.int32)
  *         cdef np.int64_t[:, :] _indArr = indArr
  *         cdef np.int32_t[:] _levels = levels             # <<<<<<<<<<<<<<
  *         for cell in self.tree.cells:
  *             for id in range(dim):
  */
-  __Pyx_TraceLine(6032,0,__PYX_ERR(0, 6032, __pyx_L1_error))
-  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int32_t(__pyx_v_levels, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 6032, __pyx_L1_error)
+  __Pyx_TraceLine(6029,0,__PYX_ERR(0, 6029, __pyx_L1_error))
+  __pyx_t_8 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int32_t(__pyx_v_levels, PyBUF_WRITABLE); if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 6029, __pyx_L1_error)
   __pyx_v__levels = __pyx_t_8;
   __pyx_t_8.memview = NULL;
   __pyx_t_8.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6033
+  /* "discretize/_extensions/tree_ext.pyx":6030
  *         cdef np.int64_t[:, :] _indArr = indArr
  *         cdef np.int32_t[:] _levels = levels
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             for id in range(dim):
  *                 _indArr[cell.index, id] = cell.location_ind[id]
  */
-  __Pyx_TraceLine(6033,0,__PYX_ERR(0, 6033, __pyx_L1_error))
+  __Pyx_TraceLine(6030,0,__PYX_ERR(0, 6030, __pyx_L1_error))
   __pyx_t_10 = &__pyx_v_self->tree->cells;
   __pyx_t_9 = __pyx_t_10->begin();
   for (;;) {
     if (!(__pyx_t_9 != __pyx_t_10->end())) break;
     __pyx_t_11 = *__pyx_t_9;
     ++__pyx_t_9;
     __pyx_v_cell = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6034
+    /* "discretize/_extensions/tree_ext.pyx":6031
  *         cdef np.int32_t[:] _levels = levels
  *         for cell in self.tree.cells:
  *             for id in range(dim):             # <<<<<<<<<<<<<<
  *                 _indArr[cell.index, id] = cell.location_ind[id]
  *             _levels[cell.index] = cell.level
  */
-    __Pyx_TraceLine(6034,0,__PYX_ERR(0, 6034, __pyx_L1_error))
+    __Pyx_TraceLine(6031,0,__PYX_ERR(0, 6031, __pyx_L1_error))
     __pyx_t_12 = __pyx_v_dim;
     __pyx_t_13 = __pyx_t_12;
     for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_13; __pyx_t_14+=1) {
       __pyx_v_id = __pyx_t_14;
 
-      /* "discretize/_extensions/tree_ext.pyx":6035
+      /* "discretize/_extensions/tree_ext.pyx":6032
  *         for cell in self.tree.cells:
  *             for id in range(dim):
  *                 _indArr[cell.index, id] = cell.location_ind[id]             # <<<<<<<<<<<<<<
  *             _levels[cell.index] = cell.level
  *         return indArr, levels
  */
-      __Pyx_TraceLine(6035,0,__PYX_ERR(0, 6035, __pyx_L1_error))
+      __Pyx_TraceLine(6032,0,__PYX_ERR(0, 6032, __pyx_L1_error))
       __pyx_t_15 = __pyx_v_cell->index;
       __pyx_t_16 = __pyx_v_id;
       __pyx_t_17 = -1;
       if (__pyx_t_15 < 0) {
         __pyx_t_15 += __pyx_v__indArr.shape[0];
         if (unlikely(__pyx_t_15 < 0)) __pyx_t_17 = 0;
       } else if (unlikely(__pyx_t_15 >= __pyx_v__indArr.shape[0])) __pyx_t_17 = 0;
       if (__pyx_t_16 < 0) {
         __pyx_t_16 += __pyx_v__indArr.shape[1];
         if (unlikely(__pyx_t_16 < 0)) __pyx_t_17 = 1;
       } else if (unlikely(__pyx_t_16 >= __pyx_v__indArr.shape[1])) __pyx_t_17 = 1;
       if (unlikely(__pyx_t_17 != -1)) {
         __Pyx_RaiseBufferIndexError(__pyx_t_17);
-        __PYX_ERR(0, 6035, __pyx_L1_error)
+        __PYX_ERR(0, 6032, __pyx_L1_error)
       }
       *((__pyx_t_5numpy_int64_t *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v__indArr.data + __pyx_t_15 * __pyx_v__indArr.strides[0]) ) + __pyx_t_16 * __pyx_v__indArr.strides[1]) )) = (__pyx_v_cell->location_ind[__pyx_v_id]);
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6036
+    /* "discretize/_extensions/tree_ext.pyx":6033
  *             for id in range(dim):
  *                 _indArr[cell.index, id] = cell.location_ind[id]
  *             _levels[cell.index] = cell.level             # <<<<<<<<<<<<<<
  *         return indArr, levels
  * 
  */
-    __Pyx_TraceLine(6036,0,__PYX_ERR(0, 6036, __pyx_L1_error))
+    __Pyx_TraceLine(6033,0,__PYX_ERR(0, 6033, __pyx_L1_error))
     __pyx_t_1 = __pyx_v_cell->level;
     __pyx_t_15 = __pyx_v_cell->index;
     __pyx_t_12 = -1;
     if (__pyx_t_15 < 0) {
       __pyx_t_15 += __pyx_v__levels.shape[0];
       if (unlikely(__pyx_t_15 < 0)) __pyx_t_12 = 0;
     } else if (unlikely(__pyx_t_15 >= __pyx_v__levels.shape[0])) __pyx_t_12 = 0;
     if (unlikely(__pyx_t_12 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_12);
-      __PYX_ERR(0, 6036, __pyx_L1_error)
+      __PYX_ERR(0, 6033, __pyx_L1_error)
     }
     *((__pyx_t_5numpy_int32_t *) ( /* dim=0 */ (__pyx_v__levels.data + __pyx_t_15 * __pyx_v__levels.strides[0]) )) = __pyx_t_1;
 
-    /* "discretize/_extensions/tree_ext.pyx":6033
+    /* "discretize/_extensions/tree_ext.pyx":6030
  *         cdef np.int64_t[:, :] _indArr = indArr
  *         cdef np.int32_t[:] _levels = levels
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             for id in range(dim):
  *                 _indArr[cell.index, id] = cell.location_ind[id]
  */
-    __Pyx_TraceLine(6033,0,__PYX_ERR(0, 6033, __pyx_L1_error))
+    __Pyx_TraceLine(6030,0,__PYX_ERR(0, 6030, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6037
+  /* "discretize/_extensions/tree_ext.pyx":6034
  *                 _indArr[cell.index, id] = cell.location_ind[id]
  *             _levels[cell.index] = cell.level
  *         return indArr, levels             # <<<<<<<<<<<<<<
  * 
  *     def __setstate__(self, state):
  */
-  __Pyx_TraceLine(6037,0,__PYX_ERR(0, 6037, __pyx_L1_error))
+  __Pyx_TraceLine(6034,0,__PYX_ERR(0, 6034, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6037, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6034, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_v_indArr);
   __Pyx_GIVEREF(__pyx_v_indArr);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_indArr);
   __Pyx_INCREF(__pyx_v_levels);
   __Pyx_GIVEREF(__pyx_v_levels);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_levels);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6026
+  /* "discretize/_extensions/tree_ext.pyx":6023
  *         return inds_x, inds_y, inds_z
  * 
  *     def __getstate__(self):             # <<<<<<<<<<<<<<
  *         """Get the current state of the TreeMesh."""
  *         cdef int id, dim = self._dim
  */
 
@@ -75822,15 +75834,15 @@
   __PYX_XDEC_MEMVIEW(&__pyx_v__levels, 1);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6039
+/* "discretize/_extensions/tree_ext.pyx":6036
  *         return indArr, levels
  * 
  *     def __setstate__(self, state):             # <<<<<<<<<<<<<<
  *         """Set the current state of the TreeMesh."""
  *         indArr, levels = state
  */
 
@@ -75866,307 +75878,307 @@
   int __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__setstate__", 0);
-  __Pyx_TraceCall("__setstate__", __pyx_f[0], 6039, 0, __PYX_ERR(0, 6039, __pyx_L1_error));
+  __Pyx_TraceCall("__setstate__", __pyx_f[0], 6036, 0, __PYX_ERR(0, 6036, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":6041
+  /* "discretize/_extensions/tree_ext.pyx":6038
  *     def __setstate__(self, state):
  *         """Set the current state of the TreeMesh."""
  *         indArr, levels = state             # <<<<<<<<<<<<<<
  *         indArr = np.asarray(indArr)
  *         levels = np.asarray(levels)
  */
-  __Pyx_TraceLine(6041,0,__PYX_ERR(0, 6041, __pyx_L1_error))
+  __Pyx_TraceLine(6038,0,__PYX_ERR(0, 6038, __pyx_L1_error))
   if ((likely(PyTuple_CheckExact(__pyx_v_state))) || (PyList_CheckExact(__pyx_v_state))) {
     PyObject* sequence = __pyx_v_state;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 6041, __pyx_L1_error)
+      __PYX_ERR(0, 6038, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_1);
     __Pyx_INCREF(__pyx_t_2);
     #else
-    __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6041, __pyx_L1_error)
+    __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6038, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6041, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6038, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     #endif
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_3 = PyObject_GetIter(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6041, __pyx_L1_error)
+    __pyx_t_3 = PyObject_GetIter(__pyx_v_state); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6038, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext;
     index = 0; __pyx_t_1 = __pyx_t_4(__pyx_t_3); if (unlikely(!__pyx_t_1)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_1);
     index = 1; __pyx_t_2 = __pyx_t_4(__pyx_t_3); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_2);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_4(__pyx_t_3), 2) < 0) __PYX_ERR(0, 6041, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_4(__pyx_t_3), 2) < 0) __PYX_ERR(0, 6038, __pyx_L1_error)
     __pyx_t_4 = NULL;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     goto __pyx_L4_unpacking_done;
     __pyx_L3_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_4 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 6041, __pyx_L1_error)
+    __PYX_ERR(0, 6038, __pyx_L1_error)
     __pyx_L4_unpacking_done:;
   }
   __pyx_v_indArr = __pyx_t_1;
   __pyx_t_1 = 0;
   __pyx_v_levels = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6042
+  /* "discretize/_extensions/tree_ext.pyx":6039
  *         """Set the current state of the TreeMesh."""
  *         indArr, levels = state
  *         indArr = np.asarray(indArr)             # <<<<<<<<<<<<<<
  *         levels = np.asarray(levels)
  *         xs = np.array(self._xs)
  */
-  __Pyx_TraceLine(6042,0,__PYX_ERR(0, 6042, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6042, __pyx_L1_error)
+  __Pyx_TraceLine(6039,0,__PYX_ERR(0, 6039, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6039, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6042, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6039, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_1)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_1);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_v_indArr) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_indArr);
   __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6042, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6039, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF_SET(__pyx_v_indArr, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6043
+  /* "discretize/_extensions/tree_ext.pyx":6040
  *         indArr, levels = state
  *         indArr = np.asarray(indArr)
  *         levels = np.asarray(levels)             # <<<<<<<<<<<<<<
  *         xs = np.array(self._xs)
  *         ys = np.array(self._ys)
  */
-  __Pyx_TraceLine(6043,0,__PYX_ERR(0, 6043, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6043, __pyx_L1_error)
+  __Pyx_TraceLine(6040,0,__PYX_ERR(0, 6040, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6043, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_3, __pyx_v_levels) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_v_levels);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6043, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6040, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF_SET(__pyx_v_levels, __pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6044
+  /* "discretize/_extensions/tree_ext.pyx":6041
  *         indArr = np.asarray(indArr)
  *         levels = np.asarray(levels)
  *         xs = np.array(self._xs)             # <<<<<<<<<<<<<<
  *         ys = np.array(self._ys)
  *         if self._dim == 3:
  */
-  __Pyx_TraceLine(6044,0,__PYX_ERR(0, 6044, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6044, __pyx_L1_error)
+  __Pyx_TraceLine(6041,0,__PYX_ERR(0, 6041, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6041, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6044, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6041, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6044, __pyx_L1_error)}
-  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self->_xs, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6044, __pyx_L1_error)
+  if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6041, __pyx_L1_error)}
+  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self->_xs, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6041, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
   __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6044, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6041, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_xs = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6045
+  /* "discretize/_extensions/tree_ext.pyx":6042
  *         levels = np.asarray(levels)
  *         xs = np.array(self._xs)
  *         ys = np.array(self._ys)             # <<<<<<<<<<<<<<
  *         if self._dim == 3:
  *             zs = np.array(self._zs)
  */
-  __Pyx_TraceLine(6045,0,__PYX_ERR(0, 6045, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6045, __pyx_L1_error)
+  __Pyx_TraceLine(6042,0,__PYX_ERR(0, 6042, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6045, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6045, __pyx_L1_error)}
-  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_self->_ys, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6045, __pyx_L1_error)
+  if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6042, __pyx_L1_error)}
+  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_self->_ys, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_5, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6045, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ys = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6046
+  /* "discretize/_extensions/tree_ext.pyx":6043
  *         xs = np.array(self._xs)
  *         ys = np.array(self._ys)
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             zs = np.array(self._zs)
  *             points = np.column_stack((xs[indArr[:, 0]],
  */
-  __Pyx_TraceLine(6046,0,__PYX_ERR(0, 6046, __pyx_L1_error))
+  __Pyx_TraceLine(6043,0,__PYX_ERR(0, 6043, __pyx_L1_error))
   __pyx_t_6 = ((__pyx_v_self->_dim == 3) != 0);
   if (__pyx_t_6) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6047
+    /* "discretize/_extensions/tree_ext.pyx":6044
  *         ys = np.array(self._ys)
  *         if self._dim == 3:
  *             zs = np.array(self._zs)             # <<<<<<<<<<<<<<
  *             points = np.column_stack((xs[indArr[:, 0]],
  *                                       ys[indArr[:, 1]],
  */
-    __Pyx_TraceLine(6047,0,__PYX_ERR(0, 6047, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6047, __pyx_L1_error)
+    __Pyx_TraceLine(6044,0,__PYX_ERR(0, 6044, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6047, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6047, __pyx_L1_error)}
-    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self->_zs, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6047, __pyx_L1_error)
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6044, __pyx_L1_error)}
+    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self->_zs, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_5, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6047, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6044, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_zs = __pyx_t_2;
     __pyx_t_2 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6048
+    /* "discretize/_extensions/tree_ext.pyx":6045
  *         if self._dim == 3:
  *             zs = np.array(self._zs)
  *             points = np.column_stack((xs[indArr[:, 0]],             # <<<<<<<<<<<<<<
  *                                       ys[indArr[:, 1]],
  *                                       zs[indArr[:, 2]]))
  */
-    __Pyx_TraceLine(6048,0,__PYX_ERR(0, 6048, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6048, __pyx_L1_error)
+    __Pyx_TraceLine(6045,0,__PYX_ERR(0, 6045, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6045, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_column_stack); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6048, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_column_stack); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6045, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__21); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6048, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__21); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6045, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_xs, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6048, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_xs, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6045, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6049
+    /* "discretize/_extensions/tree_ext.pyx":6046
  *             zs = np.array(self._zs)
  *             points = np.column_stack((xs[indArr[:, 0]],
  *                                       ys[indArr[:, 1]],             # <<<<<<<<<<<<<<
  *                                       zs[indArr[:, 2]]))
  *         else:
  */
-    __Pyx_TraceLine(6049,0,__PYX_ERR(0, 6049, __pyx_L1_error))
-    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__22); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6049, __pyx_L1_error)
+    __Pyx_TraceLine(6046,0,__PYX_ERR(0, 6046, __pyx_L1_error))
+    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__22); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6046, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_ys, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6049, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_ys, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6046, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6050
+    /* "discretize/_extensions/tree_ext.pyx":6047
  *             points = np.column_stack((xs[indArr[:, 0]],
  *                                       ys[indArr[:, 1]],
  *                                       zs[indArr[:, 2]]))             # <<<<<<<<<<<<<<
  *         else:
  *             points = np.column_stack((xs[indArr[:, 0]], ys[indArr[:, 1]]))
  */
-    __Pyx_TraceLine(6050,0,__PYX_ERR(0, 6050, __pyx_L1_error))
-    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__23); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6050, __pyx_L1_error)
+    __Pyx_TraceLine(6047,0,__PYX_ERR(0, 6047, __pyx_L1_error))
+    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__23); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_zs, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6050, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_zs, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6047, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6048
+    /* "discretize/_extensions/tree_ext.pyx":6045
  *         if self._dim == 3:
  *             zs = np.array(self._zs)
  *             points = np.column_stack((xs[indArr[:, 0]],             # <<<<<<<<<<<<<<
  *                                       ys[indArr[:, 1]],
  *                                       zs[indArr[:, 2]]))
  */
-    __Pyx_TraceLine(6048,0,__PYX_ERR(0, 6048, __pyx_L1_error))
-    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6048, __pyx_L1_error)
+    __Pyx_TraceLine(6045,0,__PYX_ERR(0, 6045, __pyx_L1_error))
+    __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6045, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_t_8);
@@ -76182,55 +76194,55 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_1, function);
       }
     }
     __pyx_t_2 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_8, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_3);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6048, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6045, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_v_points = __pyx_t_2;
     __pyx_t_2 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6046
+    /* "discretize/_extensions/tree_ext.pyx":6043
  *         xs = np.array(self._xs)
  *         ys = np.array(self._ys)
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             zs = np.array(self._zs)
  *             points = np.column_stack((xs[indArr[:, 0]],
  */
     goto __pyx_L5;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6052
+  /* "discretize/_extensions/tree_ext.pyx":6049
  *                                       zs[indArr[:, 2]]))
  *         else:
  *             points = np.column_stack((xs[indArr[:, 0]], ys[indArr[:, 1]]))             # <<<<<<<<<<<<<<
  *         # Set diagonal balance as false. If the state itself came from a diagonally
  *         # balanced tree, those cells will naturally be included in the state information
  */
-  __Pyx_TraceLine(6052,0,__PYX_ERR(0, 6052, __pyx_L1_error))
+  __Pyx_TraceLine(6049,0,__PYX_ERR(0, 6049, __pyx_L1_error))
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6052, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6049, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_column_stack); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6052, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_column_stack); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6049, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6052, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__21); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6049, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_xs, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6052, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_xs, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6049, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__22); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6052, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__22); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6049, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_ys, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6052, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_ys, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6049, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6052, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6049, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_7);
     __pyx_t_8 = 0;
     __pyx_t_7 = 0;
@@ -76243,51 +76255,51 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_3, function);
       }
     }
     __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_7, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_1);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6052, __pyx_L1_error)
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6049, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_points = __pyx_t_2;
     __pyx_t_2 = 0;
   }
   __pyx_L5:;
 
-  /* "discretize/_extensions/tree_ext.pyx":6058
+  /* "discretize/_extensions/tree_ext.pyx":6055
  *         # us to support reading in older TreeMesh that are not diagonally balanced when
  *         # we switch the default to be a diagonally balanced tree.
  *         self.insert_cells(points, levels, diagonal_balance=False)             # <<<<<<<<<<<<<<
  * 
  *     def __getitem__(self, key):
  */
-  __Pyx_TraceLine(6058,0,__PYX_ERR(0, 6058, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_insert_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6058, __pyx_L1_error)
+  __Pyx_TraceLine(6055,0,__PYX_ERR(0, 6055, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_insert_cells); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6055, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6058, __pyx_L1_error)
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6055, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_points);
   __Pyx_GIVEREF(__pyx_v_points);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_points);
   __Pyx_INCREF(__pyx_v_levels);
   __Pyx_GIVEREF(__pyx_v_levels);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_levels);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6058, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6055, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_diagonal_balance, Py_False) < 0) __PYX_ERR(0, 6058, __pyx_L1_error)
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6058, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_diagonal_balance, Py_False) < 0) __PYX_ERR(0, 6055, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6055, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6039
+  /* "discretize/_extensions/tree_ext.pyx":6036
  *         return indArr, levels
  * 
  *     def __setstate__(self, state):             # <<<<<<<<<<<<<<
  *         """Set the current state of the TreeMesh."""
  *         indArr, levels = state
  */
 
@@ -76312,15 +76324,15 @@
   __Pyx_XDECREF(__pyx_v_points);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6060
+/* "discretize/_extensions/tree_ext.pyx":6057
  *         self.insert_cells(points, levels, diagonal_balance=False)
  * 
  *     def __getitem__(self, key):             # <<<<<<<<<<<<<<
  *         """Get a TreeCell or cells.
  * 
  */
 
@@ -76358,327 +76370,327 @@
   PyObject *(*__pyx_t_9)(PyObject *);
   int __pyx_t_10;
   std::vector<Cell *> ::size_type __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__getitem__", 0);
-  __Pyx_TraceCall("__getitem__", __pyx_f[0], 6060, 0, __PYX_ERR(0, 6060, __pyx_L1_error));
+  __Pyx_TraceCall("__getitem__", __pyx_f[0], 6057, 0, __PYX_ERR(0, 6057, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_key);
 
-  /* "discretize/_extensions/tree_ext.pyx":6070
+  /* "discretize/_extensions/tree_ext.pyx":6067
  *         discretize.tree_mesh.TreeCell
  *         """
  *         if isinstance(key, slice):             # <<<<<<<<<<<<<<
  *             # Get the start, stop, and step from the slice
  *             return [self[ii] for ii in range(*key.indices(len(self)))]
  */
-  __Pyx_TraceLine(6070,0,__PYX_ERR(0, 6070, __pyx_L1_error))
+  __Pyx_TraceLine(6067,0,__PYX_ERR(0, 6067, __pyx_L1_error))
   __pyx_t_1 = PySlice_Check(__pyx_v_key); 
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6072
+    /* "discretize/_extensions/tree_ext.pyx":6069
  *         if isinstance(key, slice):
  *             # Get the start, stop, and step from the slice
  *             return [self[ii] for ii in range(*key.indices(len(self)))]             # <<<<<<<<<<<<<<
  *         elif isinstance(key, (int, np.integer)):
  *             if key < 0:  # Handle negative indices
  */
-    __Pyx_TraceLine(6072,0,__PYX_ERR(0, 6072, __pyx_L1_error))
+    __Pyx_TraceLine(6069,0,__PYX_ERR(0, 6069, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     { /* enter inner scope */
-      __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6072, __pyx_L6_error)
+      __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6069, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_indices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6072, __pyx_L6_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_indices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6069, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = PyObject_Length(((PyObject *)__pyx_v_self)); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 6072, __pyx_L6_error)
-      __pyx_t_7 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6072, __pyx_L6_error)
+      __pyx_t_6 = PyObject_Length(((PyObject *)__pyx_v_self)); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 6069, __pyx_L6_error)
+      __pyx_t_7 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6069, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_7);
       __pyx_t_8 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
         __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
         if (likely(__pyx_t_8)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
           __Pyx_INCREF(__pyx_t_8);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
         }
       }
       __pyx_t_4 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_8, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_7);
       __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6072, __pyx_L6_error)
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6069, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = __Pyx_PySequence_Tuple(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6072, __pyx_L6_error)
+      __pyx_t_5 = __Pyx_PySequence_Tuple(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6069, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6072, __pyx_L6_error)
+      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_5, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6069, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
         __pyx_t_5 = __pyx_t_4; __Pyx_INCREF(__pyx_t_5); __pyx_t_6 = 0;
         __pyx_t_9 = NULL;
       } else {
-        __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6072, __pyx_L6_error)
+        __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6069, __pyx_L6_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6072, __pyx_L6_error)
+        __pyx_t_9 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6069, __pyx_L6_error)
       }
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       for (;;) {
         if (likely(!__pyx_t_9)) {
           if (likely(PyList_CheckExact(__pyx_t_5))) {
             if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_4 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 6072, __pyx_L6_error)
+            __pyx_t_4 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 6069, __pyx_L6_error)
             #else
-            __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6072, __pyx_L6_error)
+            __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6069, __pyx_L6_error)
             __Pyx_GOTREF(__pyx_t_4);
             #endif
           } else {
             if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 6072, __pyx_L6_error)
+            __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_4); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 6069, __pyx_L6_error)
             #else
-            __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6072, __pyx_L6_error)
+            __pyx_t_4 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6069, __pyx_L6_error)
             __Pyx_GOTREF(__pyx_t_4);
             #endif
           }
         } else {
           __pyx_t_4 = __pyx_t_9(__pyx_t_5);
           if (unlikely(!__pyx_t_4)) {
             PyObject* exc_type = PyErr_Occurred();
             if (exc_type) {
               if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-              else __PYX_ERR(0, 6072, __pyx_L6_error)
+              else __PYX_ERR(0, 6069, __pyx_L6_error)
             }
             break;
           }
           __Pyx_GOTREF(__pyx_t_4);
         }
         __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_ii, __pyx_t_4);
         __pyx_t_4 = 0;
-        __pyx_t_4 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_self), __pyx_7genexpr__pyx_v_ii); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6072, __pyx_L6_error)
+        __pyx_t_4 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_v_self), __pyx_7genexpr__pyx_v_ii); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6069, __pyx_L6_error)
         __Pyx_GOTREF(__pyx_t_4);
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 6072, __pyx_L6_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 6069, __pyx_L6_error)
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_XDECREF(__pyx_7genexpr__pyx_v_ii); __pyx_7genexpr__pyx_v_ii = 0;
       goto __pyx_L9_exit_scope;
       __pyx_L6_error:;
       __Pyx_XDECREF(__pyx_7genexpr__pyx_v_ii); __pyx_7genexpr__pyx_v_ii = 0;
       goto __pyx_L1_error;
       __pyx_L9_exit_scope:;
     } /* exit inner scope */
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6070
+    /* "discretize/_extensions/tree_ext.pyx":6067
  *         discretize.tree_mesh.TreeCell
  *         """
  *         if isinstance(key, slice):             # <<<<<<<<<<<<<<
  *             # Get the start, stop, and step from the slice
  *             return [self[ii] for ii in range(*key.indices(len(self)))]
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6073
+  /* "discretize/_extensions/tree_ext.pyx":6070
  *             # Get the start, stop, and step from the slice
  *             return [self[ii] for ii in range(*key.indices(len(self)))]
  *         elif isinstance(key, (int, np.integer)):             # <<<<<<<<<<<<<<
  *             if key < 0:  # Handle negative indices
  *                 key += len(self)
  */
-  __Pyx_TraceLine(6073,0,__PYX_ERR(0, 6073, __pyx_L1_error))
+  __Pyx_TraceLine(6070,0,__PYX_ERR(0, 6070, __pyx_L1_error))
   __pyx_t_1 = PyInt_Check(__pyx_v_key); 
   __pyx_t_10 = (__pyx_t_1 != 0);
   if (!__pyx_t_10) {
   } else {
     __pyx_t_2 = __pyx_t_10;
     goto __pyx_L10_bool_binop_done;
   }
   __pyx_t_10 = __Pyx_TypeCheck(__pyx_v_key, __pyx_ptype_5numpy_integer); 
   __pyx_t_1 = (__pyx_t_10 != 0);
   __pyx_t_2 = __pyx_t_1;
   __pyx_L10_bool_binop_done:;
   __pyx_t_1 = (__pyx_t_2 != 0);
   if (likely(__pyx_t_1)) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6074
+    /* "discretize/_extensions/tree_ext.pyx":6071
  *             return [self[ii] for ii in range(*key.indices(len(self)))]
  *         elif isinstance(key, (int, np.integer)):
  *             if key < 0:  # Handle negative indices             # <<<<<<<<<<<<<<
  *                 key += len(self)
  *             if key >= len(self):
  */
-    __Pyx_TraceLine(6074,0,__PYX_ERR(0, 6074, __pyx_L1_error))
-    __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6074, __pyx_L1_error)
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 6074, __pyx_L1_error)
+    __Pyx_TraceLine(6071,0,__PYX_ERR(0, 6071, __pyx_L1_error))
+    __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6071, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 6071, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (__pyx_t_1) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6075
+      /* "discretize/_extensions/tree_ext.pyx":6072
  *         elif isinstance(key, (int, np.integer)):
  *             if key < 0:  # Handle negative indices
  *                 key += len(self)             # <<<<<<<<<<<<<<
  *             if key >= len(self):
  *                 raise IndexError(
  */
-      __Pyx_TraceLine(6075,0,__PYX_ERR(0, 6075, __pyx_L1_error))
-      __pyx_t_6 = PyObject_Length(((PyObject *)__pyx_v_self)); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 6075, __pyx_L1_error)
-      __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6075, __pyx_L1_error)
+      __Pyx_TraceLine(6072,0,__PYX_ERR(0, 6072, __pyx_L1_error))
+      __pyx_t_6 = PyObject_Length(((PyObject *)__pyx_v_self)); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 6072, __pyx_L1_error)
+      __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6072, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_key, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6075, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_key, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6072, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_DECREF_SET(__pyx_v_key, __pyx_t_5);
       __pyx_t_5 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6074
+      /* "discretize/_extensions/tree_ext.pyx":6071
  *             return [self[ii] for ii in range(*key.indices(len(self)))]
  *         elif isinstance(key, (int, np.integer)):
  *             if key < 0:  # Handle negative indices             # <<<<<<<<<<<<<<
  *                 key += len(self)
  *             if key >= len(self):
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6076
+    /* "discretize/_extensions/tree_ext.pyx":6073
  *             if key < 0:  # Handle negative indices
  *                 key += len(self)
  *             if key >= len(self):             # <<<<<<<<<<<<<<
  *                 raise IndexError(
  *                     "The index ({0:d}) is out of range.".format(key)
  */
-    __Pyx_TraceLine(6076,0,__PYX_ERR(0, 6076, __pyx_L1_error))
-    __pyx_t_6 = PyObject_Length(((PyObject *)__pyx_v_self)); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 6076, __pyx_L1_error)
-    __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6076, __pyx_L1_error)
+    __Pyx_TraceLine(6073,0,__PYX_ERR(0, 6073, __pyx_L1_error))
+    __pyx_t_6 = PyObject_Length(((PyObject *)__pyx_v_self)); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 6073, __pyx_L1_error)
+    __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6073, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_t_5, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6076, __pyx_L1_error)
+    __pyx_t_3 = PyObject_RichCompare(__pyx_v_key, __pyx_t_5, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6073, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 6076, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 6073, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     if (unlikely(__pyx_t_1)) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6078
+      /* "discretize/_extensions/tree_ext.pyx":6075
  *             if key >= len(self):
  *                 raise IndexError(
  *                     "The index ({0:d}) is out of range.".format(key)             # <<<<<<<<<<<<<<
  *                 )
  *             pycell = TreeCell()
  */
-      __Pyx_TraceLine(6078,0,__PYX_ERR(0, 6078, __pyx_L1_error))
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_The_index_0_d_is_out_of_range, __pyx_n_s_format); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6078, __pyx_L1_error)
+      __Pyx_TraceLine(6075,0,__PYX_ERR(0, 6075, __pyx_L1_error))
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_The_index_0_d_is_out_of_range, __pyx_n_s_format); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6075, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __pyx_t_4 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_5))) {
         __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
         if (likely(__pyx_t_4)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
           __Pyx_INCREF(__pyx_t_4);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
         }
       }
       __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_v_key) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_key);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6078, __pyx_L1_error)
+      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6075, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6077
+      /* "discretize/_extensions/tree_ext.pyx":6074
  *                 key += len(self)
  *             if key >= len(self):
  *                 raise IndexError(             # <<<<<<<<<<<<<<
  *                     "The index ({0:d}) is out of range.".format(key)
  *                 )
  */
-      __Pyx_TraceLine(6077,0,__PYX_ERR(0, 6077, __pyx_L1_error))
-      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IndexError, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6077, __pyx_L1_error)
+      __Pyx_TraceLine(6074,0,__PYX_ERR(0, 6074, __pyx_L1_error))
+      __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_IndexError, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6074, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       __Pyx_Raise(__pyx_t_5, 0, 0, 0);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __PYX_ERR(0, 6077, __pyx_L1_error)
+      __PYX_ERR(0, 6074, __pyx_L1_error)
 
-      /* "discretize/_extensions/tree_ext.pyx":6076
+      /* "discretize/_extensions/tree_ext.pyx":6073
  *             if key < 0:  # Handle negative indices
  *                 key += len(self)
  *             if key >= len(self):             # <<<<<<<<<<<<<<
  *                 raise IndexError(
  *                     "The index ({0:d}) is out of range.".format(key)
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6080
+    /* "discretize/_extensions/tree_ext.pyx":6077
  *                     "The index ({0:d}) is out of range.".format(key)
  *                 )
  *             pycell = TreeCell()             # <<<<<<<<<<<<<<
  *             pycell._set(self.tree.cells[key])
  *             return pycell
  */
-    __Pyx_TraceLine(6080,0,__PYX_ERR(0, 6080, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_CallNoArg(((PyObject *)__pyx_ptype_10discretize_11_extensions_8tree_ext_TreeCell)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6080, __pyx_L1_error)
+    __Pyx_TraceLine(6077,0,__PYX_ERR(0, 6077, __pyx_L1_error))
+    __pyx_t_5 = __Pyx_PyObject_CallNoArg(((PyObject *)__pyx_ptype_10discretize_11_extensions_8tree_ext_TreeCell)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6077, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_v_pycell = ((struct __pyx_obj_10discretize_11_extensions_8tree_ext_TreeCell *)__pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6081
+    /* "discretize/_extensions/tree_ext.pyx":6078
  *                 )
  *             pycell = TreeCell()
  *             pycell._set(self.tree.cells[key])             # <<<<<<<<<<<<<<
  *             return pycell
  *         else:
  */
-    __Pyx_TraceLine(6081,0,__PYX_ERR(0, 6081, __pyx_L1_error))
-    __pyx_t_11 = __Pyx_PyInt_As_size_t(__pyx_v_key); if (unlikely((__pyx_t_11 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 6081, __pyx_L1_error)
+    __Pyx_TraceLine(6078,0,__PYX_ERR(0, 6078, __pyx_L1_error))
+    __pyx_t_11 = __Pyx_PyInt_As_size_t(__pyx_v_key); if (unlikely((__pyx_t_11 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 6078, __pyx_L1_error)
     ((struct __pyx_vtabstruct_10discretize_11_extensions_8tree_ext_TreeCell *)__pyx_v_pycell->__pyx_vtab)->_set(__pyx_v_pycell, (__pyx_v_self->tree->cells[__pyx_t_11]));
 
-    /* "discretize/_extensions/tree_ext.pyx":6082
+    /* "discretize/_extensions/tree_ext.pyx":6079
  *             pycell = TreeCell()
  *             pycell._set(self.tree.cells[key])
  *             return pycell             # <<<<<<<<<<<<<<
  *         else:
  *             raise TypeError("Invalid argument type.")
  */
-    __Pyx_TraceLine(6082,0,__PYX_ERR(0, 6082, __pyx_L1_error))
+    __Pyx_TraceLine(6079,0,__PYX_ERR(0, 6079, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject *)__pyx_v_pycell));
     __pyx_r = ((PyObject *)__pyx_v_pycell);
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6073
+    /* "discretize/_extensions/tree_ext.pyx":6070
  *             # Get the start, stop, and step from the slice
  *             return [self[ii] for ii in range(*key.indices(len(self)))]
  *         elif isinstance(key, (int, np.integer)):             # <<<<<<<<<<<<<<
  *             if key < 0:  # Handle negative indices
  *                 key += len(self)
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6084
+  /* "discretize/_extensions/tree_ext.pyx":6081
  *             return pycell
  *         else:
  *             raise TypeError("Invalid argument type.")             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(6084,0,__PYX_ERR(0, 6084, __pyx_L1_error))
+  __Pyx_TraceLine(6081,0,__PYX_ERR(0, 6081, __pyx_L1_error))
   /*else*/ {
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__41, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6084, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__41, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6081, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_Raise(__pyx_t_5, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 6084, __pyx_L1_error)
+    __PYX_ERR(0, 6081, __pyx_L1_error)
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6060
+  /* "discretize/_extensions/tree_ext.pyx":6057
  *         self.insert_cells(points, levels, diagonal_balance=False)
  * 
  *     def __getitem__(self, key):             # <<<<<<<<<<<<<<
  *         """Get a TreeCell or cells.
  * 
  */
 
@@ -76697,15 +76709,15 @@
   __Pyx_XDECREF(__pyx_v_key);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6087
+/* "discretize/_extensions/tree_ext.pyx":6084
  * 
  *     @property
  *     def _ubc_indArr(self):             # <<<<<<<<<<<<<<
  *         if self.__ubc_indArr is not None:
  *             return self.__ubc_indArr
  */
 
@@ -76736,293 +76748,293 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   PyObject *(*__pyx_t_7)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 6087, 0, __PYX_ERR(0, 6087, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 6084, 0, __PYX_ERR(0, 6084, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":6088
+  /* "discretize/_extensions/tree_ext.pyx":6085
  *     @property
  *     def _ubc_indArr(self):
  *         if self.__ubc_indArr is not None:             # <<<<<<<<<<<<<<
  *             return self.__ubc_indArr
  *         indArr, levels = self.__getstate__()
  */
-  __Pyx_TraceLine(6088,0,__PYX_ERR(0, 6088, __pyx_L1_error))
+  __Pyx_TraceLine(6085,0,__PYX_ERR(0, 6085, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->__pyx___ubc_indArr != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6089
+    /* "discretize/_extensions/tree_ext.pyx":6086
  *     def _ubc_indArr(self):
  *         if self.__ubc_indArr is not None:
  *             return self.__ubc_indArr             # <<<<<<<<<<<<<<
  *         indArr, levels = self.__getstate__()
  * 
  */
-    __Pyx_TraceLine(6089,0,__PYX_ERR(0, 6089, __pyx_L1_error))
+    __Pyx_TraceLine(6086,0,__PYX_ERR(0, 6086, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->__pyx___ubc_indArr);
     __pyx_r = __pyx_v_self->__pyx___ubc_indArr;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6088
+    /* "discretize/_extensions/tree_ext.pyx":6085
  *     @property
  *     def _ubc_indArr(self):
  *         if self.__ubc_indArr is not None:             # <<<<<<<<<<<<<<
  *             return self.__ubc_indArr
  *         indArr, levels = self.__getstate__()
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6090
+  /* "discretize/_extensions/tree_ext.pyx":6087
  *         if self.__ubc_indArr is not None:
  *             return self.__ubc_indArr
  *         indArr, levels = self.__getstate__()             # <<<<<<<<<<<<<<
  * 
  *         max_level = self.tree.max_level
  */
-  __Pyx_TraceLine(6090,0,__PYX_ERR(0, 6090, __pyx_L1_error))
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_getstate); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6090, __pyx_L1_error)
+  __Pyx_TraceLine(6087,0,__PYX_ERR(0, 6087, __pyx_L1_error))
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_getstate); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6087, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_5) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6090, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6087, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
     PyObject* sequence = __pyx_t_3;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 6090, __pyx_L1_error)
+      __PYX_ERR(0, 6087, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_4);
     __Pyx_INCREF(__pyx_t_5);
     #else
-    __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6090, __pyx_L1_error)
+    __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6087, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6090, __pyx_L1_error)
+    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6087, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     #endif
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_6 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6090, __pyx_L1_error)
+    __pyx_t_6 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6087, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_7 = Py_TYPE(__pyx_t_6)->tp_iternext;
     index = 0; __pyx_t_4 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_4)) goto __pyx_L4_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_4);
     index = 1; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L4_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_5);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 6090, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 6087, __pyx_L1_error)
     __pyx_t_7 = NULL;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L5_unpacking_done;
     __pyx_L4_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_7 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 6090, __pyx_L1_error)
+    __PYX_ERR(0, 6087, __pyx_L1_error)
     __pyx_L5_unpacking_done:;
   }
   __pyx_v_indArr = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_v_levels = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6092
+  /* "discretize/_extensions/tree_ext.pyx":6089
  *         indArr, levels = self.__getstate__()
  * 
  *         max_level = self.tree.max_level             # <<<<<<<<<<<<<<
  * 
  *         levels = 1<<(max_level - levels)
  */
-  __Pyx_TraceLine(6092,0,__PYX_ERR(0, 6092, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyInt_From_int_t(__pyx_v_self->tree->max_level); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6092, __pyx_L1_error)
+  __Pyx_TraceLine(6089,0,__PYX_ERR(0, 6089, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyInt_From_int_t(__pyx_v_self->tree->max_level); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6089, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_v_max_level = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6094
+  /* "discretize/_extensions/tree_ext.pyx":6091
  *         max_level = self.tree.max_level
  * 
  *         levels = 1<<(max_level - levels)             # <<<<<<<<<<<<<<
  * 
  *         if self.dim == 2:
  */
-  __Pyx_TraceLine(6094,0,__PYX_ERR(0, 6094, __pyx_L1_error))
-  __pyx_t_3 = PyNumber_Subtract(__pyx_v_max_level, __pyx_v_levels); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6094, __pyx_L1_error)
+  __Pyx_TraceLine(6091,0,__PYX_ERR(0, 6091, __pyx_L1_error))
+  __pyx_t_3 = PyNumber_Subtract(__pyx_v_max_level, __pyx_v_levels); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6091, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Lshift(__pyx_int_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6094, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Lshift(__pyx_int_1, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6091, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF_SET(__pyx_v_levels, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6096
+  /* "discretize/_extensions/tree_ext.pyx":6093
  *         levels = 1<<(max_level - levels)
  * 
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             indArr[:, -1] = (self._ys.shape[0]-1) - indArr[:, -1]
  *         else:
  */
-  __Pyx_TraceLine(6096,0,__PYX_ERR(0, 6096, __pyx_L1_error))
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6096, __pyx_L1_error)
+  __Pyx_TraceLine(6093,0,__PYX_ERR(0, 6093, __pyx_L1_error))
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6093, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_5, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6096, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_5, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6093, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 6096, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 6093, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6097
+    /* "discretize/_extensions/tree_ext.pyx":6094
  * 
  *         if self.dim == 2:
  *             indArr[:, -1] = (self._ys.shape[0]-1) - indArr[:, -1]             # <<<<<<<<<<<<<<
  *         else:
  *             indArr[:, -1] = (self._zs.shape[0]-1) - indArr[:, -1]
  */
-    __Pyx_TraceLine(6097,0,__PYX_ERR(0, 6097, __pyx_L1_error))
-    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6097, __pyx_L1_error)}
-    __pyx_t_3 = PyInt_FromSsize_t(((__pyx_v_self->_ys.shape[0]) - 1)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6097, __pyx_L1_error)
+    __Pyx_TraceLine(6094,0,__PYX_ERR(0, 6094, __pyx_L1_error))
+    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6094, __pyx_L1_error)}
+    __pyx_t_3 = PyInt_FromSsize_t(((__pyx_v_self->_ys.shape[0]) - 1)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6094, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__42); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6097, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__42); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6094, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = PyNumber_Subtract(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6097, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Subtract(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6094, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_indArr, __pyx_tuple__42, __pyx_t_4) < 0)) __PYX_ERR(0, 6097, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_indArr, __pyx_tuple__42, __pyx_t_4) < 0)) __PYX_ERR(0, 6094, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6096
+    /* "discretize/_extensions/tree_ext.pyx":6093
  *         levels = 1<<(max_level - levels)
  * 
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             indArr[:, -1] = (self._ys.shape[0]-1) - indArr[:, -1]
  *         else:
  */
     goto __pyx_L6;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6099
+  /* "discretize/_extensions/tree_ext.pyx":6096
  *             indArr[:, -1] = (self._ys.shape[0]-1) - indArr[:, -1]
  *         else:
  *             indArr[:, -1] = (self._zs.shape[0]-1) - indArr[:, -1]             # <<<<<<<<<<<<<<
  * 
  *         indArr = (indArr - levels[:, None])//2
  */
-  __Pyx_TraceLine(6099,0,__PYX_ERR(0, 6099, __pyx_L1_error))
+  __Pyx_TraceLine(6096,0,__PYX_ERR(0, 6096, __pyx_L1_error))
   /*else*/ {
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6099, __pyx_L1_error)}
-    __pyx_t_4 = PyInt_FromSsize_t(((__pyx_v_self->_zs.shape[0]) - 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6099, __pyx_L1_error)
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6096, __pyx_L1_error)}
+    __pyx_t_4 = PyInt_FromSsize_t(((__pyx_v_self->_zs.shape[0]) - 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6096, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__42); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6099, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__42); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6096, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6099, __pyx_L1_error)
+    __pyx_t_3 = PyNumber_Subtract(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6096, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(PyObject_SetItem(__pyx_v_indArr, __pyx_tuple__42, __pyx_t_3) < 0)) __PYX_ERR(0, 6099, __pyx_L1_error)
+    if (unlikely(PyObject_SetItem(__pyx_v_indArr, __pyx_tuple__42, __pyx_t_3) < 0)) __PYX_ERR(0, 6096, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   }
   __pyx_L6:;
 
-  /* "discretize/_extensions/tree_ext.pyx":6101
+  /* "discretize/_extensions/tree_ext.pyx":6098
  *             indArr[:, -1] = (self._zs.shape[0]-1) - indArr[:, -1]
  * 
  *         indArr = (indArr - levels[:, None])//2             # <<<<<<<<<<<<<<
  *         indArr += 1
  * 
  */
-  __Pyx_TraceLine(6101,0,__PYX_ERR(0, 6101, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_levels, __pyx_tuple__43); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6101, __pyx_L1_error)
+  __Pyx_TraceLine(6098,0,__PYX_ERR(0, 6098, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_levels, __pyx_tuple__43); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6098, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = PyNumber_Subtract(__pyx_v_indArr, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6101, __pyx_L1_error)
+  __pyx_t_5 = PyNumber_Subtract(__pyx_v_indArr, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6098, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyInt_FloorDivideObjC(__pyx_t_5, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6101, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_FloorDivideObjC(__pyx_t_5, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6098, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF_SET(__pyx_v_indArr, __pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6102
+  /* "discretize/_extensions/tree_ext.pyx":6099
  * 
  *         indArr = (indArr - levels[:, None])//2
  *         indArr += 1             # <<<<<<<<<<<<<<
  * 
  *         self.__ubc_indArr = (indArr, levels)
  */
-  __Pyx_TraceLine(6102,0,__PYX_ERR(0, 6102, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_indArr, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6102, __pyx_L1_error)
+  __Pyx_TraceLine(6099,0,__PYX_ERR(0, 6099, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_indArr, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6099, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF_SET(__pyx_v_indArr, __pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6104
+  /* "discretize/_extensions/tree_ext.pyx":6101
  *         indArr += 1
  * 
  *         self.__ubc_indArr = (indArr, levels)             # <<<<<<<<<<<<<<
  *         return self.__ubc_indArr
  * 
  */
-  __Pyx_TraceLine(6104,0,__PYX_ERR(0, 6104, __pyx_L1_error))
-  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6104, __pyx_L1_error)
+  __Pyx_TraceLine(6101,0,__PYX_ERR(0, 6101, __pyx_L1_error))
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6101, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_v_indArr);
   __Pyx_GIVEREF(__pyx_v_indArr);
   PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_indArr);
   __Pyx_INCREF(__pyx_v_levels);
   __Pyx_GIVEREF(__pyx_v_levels);
   PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_levels);
   __Pyx_GIVEREF(__pyx_t_3);
   __Pyx_GOTREF(__pyx_v_self->__pyx___ubc_indArr);
   __Pyx_DECREF(__pyx_v_self->__pyx___ubc_indArr);
   __pyx_v_self->__pyx___ubc_indArr = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6105
+  /* "discretize/_extensions/tree_ext.pyx":6102
  * 
  *         self.__ubc_indArr = (indArr, levels)
  *         return self.__ubc_indArr             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __Pyx_TraceLine(6105,0,__PYX_ERR(0, 6105, __pyx_L1_error))
+  __Pyx_TraceLine(6102,0,__PYX_ERR(0, 6102, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->__pyx___ubc_indArr);
   __pyx_r = __pyx_v_self->__pyx___ubc_indArr;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6087
+  /* "discretize/_extensions/tree_ext.pyx":6084
  * 
  *     @property
  *     def _ubc_indArr(self):             # <<<<<<<<<<<<<<
  *         if self.__ubc_indArr is not None:
  *             return self.__ubc_indArr
  */
 
@@ -77040,15 +77052,15 @@
   __Pyx_XDECREF(__pyx_v_max_level);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6108
+/* "discretize/_extensions/tree_ext.pyx":6105
  * 
  *     @property
  *     def _ubc_order(self):             # <<<<<<<<<<<<<<
  *         if self.__ubc_order is not None:
  *             return self.__ubc_order
  */
 
@@ -77080,146 +77092,146 @@
   PyObject *(*__pyx_t_7)(PyObject *);
   PyObject *__pyx_t_8 = NULL;
   PyObject *__pyx_t_9 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
-  __Pyx_TraceCall("__get__", __pyx_f[0], 6108, 0, __PYX_ERR(0, 6108, __pyx_L1_error));
+  __Pyx_TraceCall("__get__", __pyx_f[0], 6105, 0, __PYX_ERR(0, 6105, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":6109
+  /* "discretize/_extensions/tree_ext.pyx":6106
  *     @property
  *     def _ubc_order(self):
  *         if self.__ubc_order is not None:             # <<<<<<<<<<<<<<
  *             return self.__ubc_order
  *         indArr, _ = self._ubc_indArr
  */
-  __Pyx_TraceLine(6109,0,__PYX_ERR(0, 6109, __pyx_L1_error))
+  __Pyx_TraceLine(6106,0,__PYX_ERR(0, 6106, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_self->__pyx___ubc_order != Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6110
+    /* "discretize/_extensions/tree_ext.pyx":6107
  *     def _ubc_order(self):
  *         if self.__ubc_order is not None:
  *             return self.__ubc_order             # <<<<<<<<<<<<<<
  *         indArr, _ = self._ubc_indArr
  *         if self.dim == 2:
  */
-    __Pyx_TraceLine(6110,0,__PYX_ERR(0, 6110, __pyx_L1_error))
+    __Pyx_TraceLine(6107,0,__PYX_ERR(0, 6107, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_self->__pyx___ubc_order);
     __pyx_r = __pyx_v_self->__pyx___ubc_order;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6109
+    /* "discretize/_extensions/tree_ext.pyx":6106
  *     @property
  *     def _ubc_order(self):
  *         if self.__ubc_order is not None:             # <<<<<<<<<<<<<<
  *             return self.__ubc_order
  *         indArr, _ = self._ubc_indArr
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6111
+  /* "discretize/_extensions/tree_ext.pyx":6108
  *         if self.__ubc_order is not None:
  *             return self.__ubc_order
  *         indArr, _ = self._ubc_indArr             # <<<<<<<<<<<<<<
  *         if self.dim == 2:
  *             self.__ubc_order = np.lexsort((indArr[:, 0], indArr[:, 1]))
  */
-  __Pyx_TraceLine(6111,0,__PYX_ERR(0, 6111, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_ubc_indArr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6111, __pyx_L1_error)
+  __Pyx_TraceLine(6108,0,__PYX_ERR(0, 6108, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_ubc_indArr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
     PyObject* sequence = __pyx_t_3;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 6111, __pyx_L1_error)
+      __PYX_ERR(0, 6108, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_4);
     __Pyx_INCREF(__pyx_t_5);
     #else
-    __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6111, __pyx_L1_error)
+    __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6108, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6111, __pyx_L1_error)
+    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6108, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     #endif
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_6 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6111, __pyx_L1_error)
+    __pyx_t_6 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6108, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_7 = Py_TYPE(__pyx_t_6)->tp_iternext;
     index = 0; __pyx_t_4 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_4)) goto __pyx_L4_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_4);
     index = 1; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L4_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_5);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 6111, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 6108, __pyx_L1_error)
     __pyx_t_7 = NULL;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     goto __pyx_L5_unpacking_done;
     __pyx_L4_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __pyx_t_7 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 6111, __pyx_L1_error)
+    __PYX_ERR(0, 6108, __pyx_L1_error)
     __pyx_L5_unpacking_done:;
   }
   __pyx_v_indArr = __pyx_t_4;
   __pyx_t_4 = 0;
   __pyx_v__ = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6112
+  /* "discretize/_extensions/tree_ext.pyx":6109
  *             return self.__ubc_order
  *         indArr, _ = self._ubc_indArr
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             self.__ubc_order = np.lexsort((indArr[:, 0], indArr[:, 1]))
  *         else:
  */
-  __Pyx_TraceLine(6112,0,__PYX_ERR(0, 6112, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6112, __pyx_L1_error)
+  __Pyx_TraceLine(6109,0,__PYX_ERR(0, 6109, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_5 = __Pyx_PyInt_EqObjC(__pyx_t_3, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6112, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_EqObjC(__pyx_t_3, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6109, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 6112, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 6109, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   if (__pyx_t_2) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6113
+    /* "discretize/_extensions/tree_ext.pyx":6110
  *         indArr, _ = self._ubc_indArr
  *         if self.dim == 2:
  *             self.__ubc_order = np.lexsort((indArr[:, 0], indArr[:, 1]))             # <<<<<<<<<<<<<<
  *         else:
  *             self.__ubc_order = np.lexsort((indArr[:, 0], indArr[:, 1], indArr[:, 2]))
  */
-    __Pyx_TraceLine(6113,0,__PYX_ERR(0, 6113, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6113, __pyx_L1_error)
+    __Pyx_TraceLine(6110,0,__PYX_ERR(0, 6110, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lexsort); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6113, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lexsort); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__21); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6113, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__21); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__22); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6113, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__22); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6113, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_6);
     __pyx_t_3 = 0;
     __pyx_t_6 = 0;
@@ -77232,54 +77244,54 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_4, function);
       }
     }
     __pyx_t_5 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_6, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_8);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6113, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6110, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_GIVEREF(__pyx_t_5);
     __Pyx_GOTREF(__pyx_v_self->__pyx___ubc_order);
     __Pyx_DECREF(__pyx_v_self->__pyx___ubc_order);
     __pyx_v_self->__pyx___ubc_order = __pyx_t_5;
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6112
+    /* "discretize/_extensions/tree_ext.pyx":6109
  *             return self.__ubc_order
  *         indArr, _ = self._ubc_indArr
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             self.__ubc_order = np.lexsort((indArr[:, 0], indArr[:, 1]))
  *         else:
  */
     goto __pyx_L6;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6115
+  /* "discretize/_extensions/tree_ext.pyx":6112
  *             self.__ubc_order = np.lexsort((indArr[:, 0], indArr[:, 1]))
  *         else:
  *             self.__ubc_order = np.lexsort((indArr[:, 0], indArr[:, 1], indArr[:, 2]))             # <<<<<<<<<<<<<<
  *         return self.__ubc_order
  * 
  */
-  __Pyx_TraceLine(6115,0,__PYX_ERR(0, 6115, __pyx_L1_error))
+  __Pyx_TraceLine(6112,0,__PYX_ERR(0, 6112, __pyx_L1_error))
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6115, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_lexsort); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6115, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_lexsort); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__21); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6115, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__21); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 6112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__22); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6115, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__22); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__23); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6115, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_indArr, __pyx_tuple__23); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6115, __pyx_L1_error)
+    __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_9, 2, __pyx_t_3);
@@ -77295,39 +77307,39 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_8, function);
       }
     }
     __pyx_t_5 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_3, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6115, __pyx_L1_error)
+    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6112, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_GIVEREF(__pyx_t_5);
     __Pyx_GOTREF(__pyx_v_self->__pyx___ubc_order);
     __Pyx_DECREF(__pyx_v_self->__pyx___ubc_order);
     __pyx_v_self->__pyx___ubc_order = __pyx_t_5;
     __pyx_t_5 = 0;
   }
   __pyx_L6:;
 
-  /* "discretize/_extensions/tree_ext.pyx":6116
+  /* "discretize/_extensions/tree_ext.pyx":6113
  *         else:
  *             self.__ubc_order = np.lexsort((indArr[:, 0], indArr[:, 1], indArr[:, 2]))
  *         return self.__ubc_order             # <<<<<<<<<<<<<<
  * 
  *     def __dealloc__(self):
  */
-  __Pyx_TraceLine(6116,0,__PYX_ERR(0, 6116, __pyx_L1_error))
+  __Pyx_TraceLine(6113,0,__PYX_ERR(0, 6113, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_self->__pyx___ubc_order);
   __pyx_r = __pyx_v_self->__pyx___ubc_order;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6108
+  /* "discretize/_extensions/tree_ext.pyx":6105
  * 
  *     @property
  *     def _ubc_order(self):             # <<<<<<<<<<<<<<
  *         if self.__ubc_order is not None:
  *             return self.__ubc_order
  */
 
@@ -77346,15 +77358,15 @@
   __Pyx_XDECREF(__pyx_v__);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6118
+/* "discretize/_extensions/tree_ext.pyx":6115
  *         return self.__ubc_order
  * 
  *     def __dealloc__(self):             # <<<<<<<<<<<<<<
  *         del self.tree
  *         del self.wrapper
  */
 
@@ -77372,37 +77384,37 @@
 static void __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_94__dealloc__(struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *__pyx_v_self) {
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__dealloc__", 0);
-  __Pyx_TraceCall("__dealloc__", __pyx_f[0], 6118, 0, __PYX_ERR(0, 6118, __pyx_L1_error));
+  __Pyx_TraceCall("__dealloc__", __pyx_f[0], 6115, 0, __PYX_ERR(0, 6115, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":6119
+  /* "discretize/_extensions/tree_ext.pyx":6116
  * 
  *     def __dealloc__(self):
  *         del self.tree             # <<<<<<<<<<<<<<
  *         del self.wrapper
  * 
  */
-  __Pyx_TraceLine(6119,0,__PYX_ERR(0, 6119, __pyx_L1_error))
+  __Pyx_TraceLine(6116,0,__PYX_ERR(0, 6116, __pyx_L1_error))
   delete __pyx_v_self->tree;
 
-  /* "discretize/_extensions/tree_ext.pyx":6120
+  /* "discretize/_extensions/tree_ext.pyx":6117
  *     def __dealloc__(self):
  *         del self.tree
  *         del self.wrapper             # <<<<<<<<<<<<<<
  * 
  *     @cython.boundscheck(False)
  */
-  __Pyx_TraceLine(6120,0,__PYX_ERR(0, 6120, __pyx_L1_error))
+  __Pyx_TraceLine(6117,0,__PYX_ERR(0, 6117, __pyx_L1_error))
   delete __pyx_v_self->wrapper;
 
-  /* "discretize/_extensions/tree_ext.pyx":6118
+  /* "discretize/_extensions/tree_ext.pyx":6115
  *         return self.__ubc_order
  * 
  *     def __dealloc__(self):             # <<<<<<<<<<<<<<
  *         del self.tree
  *         del self.wrapper
  */
 
@@ -77411,15 +77423,15 @@
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("discretize._extensions.tree_ext._TreeMesh.__dealloc__", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
   __Pyx_TraceReturn(Py_None, 0);
   __Pyx_RefNannyFinishContext();
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6124
+/* "discretize/_extensions/tree_ext.pyx":6121
  *     @cython.boundscheck(False)
  *     @cython.cdivision(True)
  *     def _vol_avg_from_tree(self, _TreeMesh meshin, values=None, output=None):             # <<<<<<<<<<<<<<
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  */
 
@@ -77469,15 +77481,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_output);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_vol_avg_from_tree") < 0)) __PYX_ERR(0, 6124, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_vol_avg_from_tree") < 0)) __PYX_ERR(0, 6121, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -77488,21 +77500,21 @@
     }
     __pyx_v_meshin = ((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)values[0]);
     __pyx_v_values = values[1];
     __pyx_v_output = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_vol_avg_from_tree", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 6124, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_vol_avg_from_tree", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 6121, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._vol_avg_from_tree", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_meshin), __pyx_ptype_10discretize_11_extensions_8tree_ext__TreeMesh, 1, "meshin", 0))) __PYX_ERR(0, 6124, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_meshin), __pyx_ptype_10discretize_11_extensions_8tree_ext__TreeMesh, 1, "meshin", 0))) __PYX_ERR(0, 6121, __pyx_L1_error)
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_96_vol_avg_from_tree(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_meshin, __pyx_v_values, __pyx_v_output);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -77584,50 +77596,50 @@
   double __pyx_t_30;
   int_t __pyx_t_31;
   int_t __pyx_t_32;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_vol_avg_from_tree", 0);
-  __Pyx_TraceCall("_vol_avg_from_tree", __pyx_f[0], 6124, 0, __PYX_ERR(0, 6124, __pyx_L1_error));
+  __Pyx_TraceCall("_vol_avg_from_tree", __pyx_f[0], 6121, 0, __PYX_ERR(0, 6121, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_output);
 
-  /* "discretize/_extensions/tree_ext.pyx":6127
+  /* "discretize/_extensions/tree_ext.pyx":6124
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, meshin.nodes_x)
  */
-  __Pyx_TraceLine(6127,0,__PYX_ERR(0, 6127, __pyx_L1_error))
+  __Pyx_TraceLine(6124,0,__PYX_ERR(0, 6124, __pyx_L1_error))
   {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "discretize/_extensions/tree_ext.pyx":6129
+      /* "discretize/_extensions/tree_ext.pyx":6126
  *         try:
  *             same_base = (
  *                 np.allclose(self.nodes_x, meshin.nodes_x)             # <<<<<<<<<<<<<<
  *                 and np.allclose(self.nodes_y, meshin.nodes_y)
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, meshin.nodes_z))
  */
-      __Pyx_TraceLine(6129,0,__PYX_ERR(0, 6129, __pyx_L3_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6129, __pyx_L3_error)
+      __Pyx_TraceLine(6126,0,__PYX_ERR(0, 6126, __pyx_L3_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6126, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_allclose); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6129, __pyx_L3_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_allclose); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6126, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6129, __pyx_L3_error)
+      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6126, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6129, __pyx_L3_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6126, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_9 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
@@ -77636,74 +77648,74 @@
           __Pyx_DECREF_SET(__pyx_t_7, function);
           __pyx_t_10 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_7)) {
         PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_6, __pyx_t_8};
-        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6129, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6126, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
         PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_6, __pyx_t_8};
-        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6129, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6126, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       {
-        __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6129, __pyx_L3_error)
+        __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6126, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_11);
         if (__pyx_t_9) {
           __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_6);
         PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_t_6);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_t_8);
         __pyx_t_6 = 0;
         __pyx_t_8 = 0;
-        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6129, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6126, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       }
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6129, __pyx_L3_error)
+      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6126, __pyx_L3_error)
       if (__pyx_t_12) {
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       } else {
-        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6129, __pyx_L3_error)
+        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6126, __pyx_L3_error)
         __pyx_t_4 = __pyx_t_13;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         goto __pyx_L9_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6130
+      /* "discretize/_extensions/tree_ext.pyx":6127
  *             same_base = (
  *                 np.allclose(self.nodes_x, meshin.nodes_x)
  *                 and np.allclose(self.nodes_y, meshin.nodes_y)             # <<<<<<<<<<<<<<
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, meshin.nodes_z))
  *             )
  */
-      __Pyx_TraceLine(6130,0,__PYX_ERR(0, 6130, __pyx_L3_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6130, __pyx_L3_error)
+      __Pyx_TraceLine(6127,0,__PYX_ERR(0, 6127, __pyx_L3_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6127, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_allclose); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6130, __pyx_L3_error)
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_allclose); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6127, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6130, __pyx_L3_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6127, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6130, __pyx_L3_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6127, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_6 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_11);
         if (likely(__pyx_t_6)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -77712,88 +77724,88 @@
           __Pyx_DECREF_SET(__pyx_t_11, function);
           __pyx_t_10 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_11)) {
         PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_7, __pyx_t_8};
-        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6130, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6127, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_11)) {
         PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_7, __pyx_t_8};
-        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6130, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6127, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       {
-        __pyx_t_9 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6130, __pyx_L3_error)
+        __pyx_t_9 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6127, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_9);
         if (__pyx_t_6) {
           __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6); __pyx_t_6 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_7);
         PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_10, __pyx_t_7);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_10, __pyx_t_8);
         __pyx_t_7 = 0;
         __pyx_t_8 = 0;
-        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_9, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6130, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_9, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6127, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       }
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6130, __pyx_L3_error)
+      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6127, __pyx_L3_error)
       if (__pyx_t_12) {
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       } else {
-        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6130, __pyx_L3_error)
+        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6127, __pyx_L3_error)
         __pyx_t_4 = __pyx_t_13;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         goto __pyx_L9_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6131
+      /* "discretize/_extensions/tree_ext.pyx":6128
  *                 np.allclose(self.nodes_x, meshin.nodes_x)
  *                 and np.allclose(self.nodes_y, meshin.nodes_y)
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, meshin.nodes_z))             # <<<<<<<<<<<<<<
  *             )
  *         except ValueError:
  */
-      __Pyx_TraceLine(6131,0,__PYX_ERR(0, 6131, __pyx_L3_error))
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6131, __pyx_L3_error)
+      __Pyx_TraceLine(6128,0,__PYX_ERR(0, 6128, __pyx_L3_error))
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6128, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_11 = __Pyx_PyInt_EqObjC(__pyx_t_5, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6131, __pyx_L3_error)
+      __pyx_t_11 = __Pyx_PyInt_EqObjC(__pyx_t_5, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6128, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6131, __pyx_L3_error)
+      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6128, __pyx_L3_error)
       if (!__pyx_t_12) {
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       } else {
-        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_11); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6131, __pyx_L3_error)
+        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_11); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6128, __pyx_L3_error)
         __pyx_t_4 = __pyx_t_13;
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         goto __pyx_L9_bool_binop_done;
       }
-      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6131, __pyx_L3_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6128, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_allclose); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6131, __pyx_L3_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_allclose); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6128, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6131, __pyx_L3_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6128, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6131, __pyx_L3_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6128, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_7 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_9);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
@@ -77802,55 +77814,55 @@
           __Pyx_DECREF_SET(__pyx_t_9, function);
           __pyx_t_10 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_9)) {
         PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_5, __pyx_t_8};
-        __pyx_t_11 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6131, __pyx_L3_error)
+        __pyx_t_11 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6128, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
         PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_5, __pyx_t_8};
-        __pyx_t_11 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6131, __pyx_L3_error)
+        __pyx_t_11 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6128, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       {
-        __pyx_t_6 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6131, __pyx_L3_error)
+        __pyx_t_6 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6128, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_6);
         if (__pyx_t_7) {
           __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7); __pyx_t_7 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_5);
         PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_10, __pyx_t_5);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_10, __pyx_t_8);
         __pyx_t_5 = 0;
         __pyx_t_8 = 0;
-        __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_6, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6131, __pyx_L3_error)
+        __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_6, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6128, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       }
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_11); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6131, __pyx_L3_error)
+      __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_11); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6128, __pyx_L3_error)
       __pyx_t_4 = __pyx_t_13;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __pyx_L9_bool_binop_done:;
       __pyx_v_same_base = __pyx_t_4;
 
-      /* "discretize/_extensions/tree_ext.pyx":6127
+      /* "discretize/_extensions/tree_ext.pyx":6124
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, meshin.nodes_x)
  */
     }
@@ -77862,48 +77874,48 @@
     __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6133
+    /* "discretize/_extensions/tree_ext.pyx":6130
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, meshin.nodes_z))
  *             )
  *         except ValueError:             # <<<<<<<<<<<<<<
  *             same_base = False
  *         cdef c_Cell * out_cell
  */
-    __Pyx_TraceLine(6133,0,__PYX_ERR(0, 6133, __pyx_L5_except_error))
+    __Pyx_TraceLine(6130,0,__PYX_ERR(0, 6130, __pyx_L5_except_error))
     __pyx_t_10 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ValueError);
     if (__pyx_t_10) {
       __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._vol_avg_from_tree", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_11, &__pyx_t_9, &__pyx_t_6) < 0) __PYX_ERR(0, 6133, __pyx_L5_except_error)
+      if (__Pyx_GetException(&__pyx_t_11, &__pyx_t_9, &__pyx_t_6) < 0) __PYX_ERR(0, 6130, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_GOTREF(__pyx_t_6);
 
-      /* "discretize/_extensions/tree_ext.pyx":6134
+      /* "discretize/_extensions/tree_ext.pyx":6131
  *             )
  *         except ValueError:
  *             same_base = False             # <<<<<<<<<<<<<<
  *         cdef c_Cell * out_cell
  *         cdef c_Cell * in_cell
  */
-      __Pyx_TraceLine(6134,0,__PYX_ERR(0, 6134, __pyx_L5_except_error))
+      __Pyx_TraceLine(6131,0,__PYX_ERR(0, 6131, __pyx_L5_except_error))
       __pyx_v_same_base = 0;
       __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       goto __pyx_L4_exception_handled;
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "discretize/_extensions/tree_ext.pyx":6127
+    /* "discretize/_extensions/tree_ext.pyx":6124
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, meshin.nodes_x)
  */
     __Pyx_XGIVEREF(__pyx_t_1);
@@ -77915,278 +77927,278 @@
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     __pyx_L8_try_end:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6138
+  /* "discretize/_extensions/tree_ext.pyx":6135
  *         cdef c_Cell * in_cell
  * 
  *         cdef np.float64_t[:] vals = np.array([])             # <<<<<<<<<<<<<<
  *         cdef np.float64_t[:] outs = np.array([])
  *         cdef int_t build_mat = 1
  */
-  __Pyx_TraceLine(6138,0,__PYX_ERR(0, 6138, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6138, __pyx_L1_error)
+  __Pyx_TraceLine(6135,0,__PYX_ERR(0, 6135, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6138, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = PyList_New(0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6138, __pyx_L1_error)
+  __pyx_t_9 = PyList_New(0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_11);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_11, function);
     }
   }
   __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_8, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_9);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6138, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 6138, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 6135, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_vals = __pyx_t_14;
   __pyx_t_14.memview = NULL;
   __pyx_t_14.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6139
+  /* "discretize/_extensions/tree_ext.pyx":6136
  * 
  *         cdef np.float64_t[:] vals = np.array([])
  *         cdef np.float64_t[:] outs = np.array([])             # <<<<<<<<<<<<<<
  *         cdef int_t build_mat = 1
  * 
  */
-  __Pyx_TraceLine(6139,0,__PYX_ERR(0, 6139, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6139, __pyx_L1_error)
+  __Pyx_TraceLine(6136,0,__PYX_ERR(0, 6136, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6139, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  __pyx_t_11 = PyList_New(0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6139, __pyx_L1_error)
+  __pyx_t_11 = PyList_New(0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_9);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_9, function);
     }
   }
   __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_8, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_11);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6139, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6136, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 6139, __pyx_L1_error)
+  __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_6, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 6136, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_outs = __pyx_t_14;
   __pyx_t_14.memview = NULL;
   __pyx_t_14.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6140
+  /* "discretize/_extensions/tree_ext.pyx":6137
  *         cdef np.float64_t[:] vals = np.array([])
  *         cdef np.float64_t[:] outs = np.array([])
  *         cdef int_t build_mat = 1             # <<<<<<<<<<<<<<
  * 
  *         if values is not None:
  */
-  __Pyx_TraceLine(6140,0,__PYX_ERR(0, 6140, __pyx_L1_error))
+  __Pyx_TraceLine(6137,0,__PYX_ERR(0, 6137, __pyx_L1_error))
   __pyx_v_build_mat = 1;
 
-  /* "discretize/_extensions/tree_ext.pyx":6142
+  /* "discretize/_extensions/tree_ext.pyx":6139
  *         cdef int_t build_mat = 1
  * 
  *         if values is not None:             # <<<<<<<<<<<<<<
  *             vals = values
  *             if output is None:
  */
-  __Pyx_TraceLine(6142,0,__PYX_ERR(0, 6142, __pyx_L1_error))
+  __Pyx_TraceLine(6139,0,__PYX_ERR(0, 6139, __pyx_L1_error))
   __pyx_t_12 = (__pyx_v_values != Py_None);
   __pyx_t_15 = (__pyx_t_12 != 0);
   if (__pyx_t_15) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6143
+    /* "discretize/_extensions/tree_ext.pyx":6140
  * 
  *         if values is not None:
  *             vals = values             # <<<<<<<<<<<<<<
  *             if output is None:
  *                 output = np.empty(self.n_cells)
  */
-    __Pyx_TraceLine(6143,0,__PYX_ERR(0, 6143, __pyx_L1_error))
-    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_v_values, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 6143, __pyx_L1_error)
+    __Pyx_TraceLine(6140,0,__PYX_ERR(0, 6140, __pyx_L1_error))
+    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_v_values, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 6140, __pyx_L1_error)
     __PYX_XDEC_MEMVIEW(&__pyx_v_vals, 1);
     __pyx_v_vals = __pyx_t_14;
     __pyx_t_14.memview = NULL;
     __pyx_t_14.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6144
+    /* "discretize/_extensions/tree_ext.pyx":6141
  *         if values is not None:
  *             vals = values
  *             if output is None:             # <<<<<<<<<<<<<<
  *                 output = np.empty(self.n_cells)
  *             output[:] = 0
  */
-    __Pyx_TraceLine(6144,0,__PYX_ERR(0, 6144, __pyx_L1_error))
+    __Pyx_TraceLine(6141,0,__PYX_ERR(0, 6141, __pyx_L1_error))
     __pyx_t_15 = (__pyx_v_output == Py_None);
     __pyx_t_12 = (__pyx_t_15 != 0);
     if (__pyx_t_12) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6145
+      /* "discretize/_extensions/tree_ext.pyx":6142
  *             vals = values
  *             if output is None:
  *                 output = np.empty(self.n_cells)             # <<<<<<<<<<<<<<
  *             output[:] = 0
  *             outs = output
  */
-      __Pyx_TraceLine(6145,0,__PYX_ERR(0, 6145, __pyx_L1_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6145, __pyx_L1_error)
+      __Pyx_TraceLine(6142,0,__PYX_ERR(0, 6142, __pyx_L1_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6142, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_empty); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6145, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_empty); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6142, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6145, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6142, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_8 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
         __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_11);
         if (likely(__pyx_t_8)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
           __Pyx_INCREF(__pyx_t_8);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_11, function);
         }
       }
       __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_8, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_9);
       __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6145, __pyx_L1_error)
+      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6142, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF_SET(__pyx_v_output, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6144
+      /* "discretize/_extensions/tree_ext.pyx":6141
  *         if values is not None:
  *             vals = values
  *             if output is None:             # <<<<<<<<<<<<<<
  *                 output = np.empty(self.n_cells)
  *             output[:] = 0
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6146
+    /* "discretize/_extensions/tree_ext.pyx":6143
  *             if output is None:
  *                 output = np.empty(self.n_cells)
  *             output[:] = 0             # <<<<<<<<<<<<<<
  *             outs = output
  * 
  */
-    __Pyx_TraceLine(6146,0,__PYX_ERR(0, 6146, __pyx_L1_error))
-    if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6146, __pyx_L1_error)
+    __Pyx_TraceLine(6143,0,__PYX_ERR(0, 6143, __pyx_L1_error))
+    if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6143, __pyx_L1_error)
 
-    /* "discretize/_extensions/tree_ext.pyx":6147
+    /* "discretize/_extensions/tree_ext.pyx":6144
  *                 output = np.empty(self.n_cells)
  *             output[:] = 0
  *             outs = output             # <<<<<<<<<<<<<<
  * 
  *             build_mat = 0
  */
-    __Pyx_TraceLine(6147,0,__PYX_ERR(0, 6147, __pyx_L1_error))
-    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_v_output, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 6147, __pyx_L1_error)
+    __Pyx_TraceLine(6144,0,__PYX_ERR(0, 6144, __pyx_L1_error))
+    __pyx_t_14 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_v_output, PyBUF_WRITABLE); if (unlikely(!__pyx_t_14.memview)) __PYX_ERR(0, 6144, __pyx_L1_error)
     __PYX_XDEC_MEMVIEW(&__pyx_v_outs, 1);
     __pyx_v_outs = __pyx_t_14;
     __pyx_t_14.memview = NULL;
     __pyx_t_14.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6149
+    /* "discretize/_extensions/tree_ext.pyx":6146
  *             outs = output
  * 
  *             build_mat = 0             # <<<<<<<<<<<<<<
  * 
  *         cdef vector[int_t] row_inds, col_inds
  */
-    __Pyx_TraceLine(6149,0,__PYX_ERR(0, 6149, __pyx_L1_error))
+    __Pyx_TraceLine(6146,0,__PYX_ERR(0, 6146, __pyx_L1_error))
     __pyx_v_build_mat = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6142
+    /* "discretize/_extensions/tree_ext.pyx":6139
  *         cdef int_t build_mat = 1
  * 
  *         if values is not None:             # <<<<<<<<<<<<<<
  *             vals = values
  *             if output is None:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6160
+  /* "discretize/_extensions/tree_ext.pyx":6157
  *         cdef double x1m, x1p, y1m, y1p, z1m, z1p
  *         cdef double x2m, x2p, y2m, y2p, z2m, z2p
  *         cdef double[:] origin = meshin._origin             # <<<<<<<<<<<<<<
  *         cdef double[:] xF
  *         if self.dim == 2:
  */
-  __Pyx_TraceLine(6160,0,__PYX_ERR(0, 6160, __pyx_L1_error))
-  if (unlikely(!__pyx_v_meshin->_origin.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6160, __pyx_L1_error)}
+  __Pyx_TraceLine(6157,0,__PYX_ERR(0, 6157, __pyx_L1_error))
+  if (unlikely(!__pyx_v_meshin->_origin.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6157, __pyx_L1_error)}
   __pyx_t_16 = __pyx_v_meshin->_origin;
   __PYX_INC_MEMVIEW(&__pyx_t_16, 1);
   __pyx_v_origin = __pyx_t_16;
   __pyx_t_16.memview = NULL;
   __pyx_t_16.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6162
+  /* "discretize/_extensions/tree_ext.pyx":6159
  *         cdef double[:] origin = meshin._origin
  *         cdef double[:] xF
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             xF = np.array([meshin._xs[-1], meshin._ys[-1]])
  *         else:
  */
-  __Pyx_TraceLine(6162,0,__PYX_ERR(0, 6162, __pyx_L1_error))
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6162, __pyx_L1_error)
+  __Pyx_TraceLine(6159,0,__PYX_ERR(0, 6159, __pyx_L1_error))
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6159, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_11 = __Pyx_PyInt_EqObjC(__pyx_t_6, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6162, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyInt_EqObjC(__pyx_t_6, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6159, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6162, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6159, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6163
+    /* "discretize/_extensions/tree_ext.pyx":6160
  *         cdef double[:] xF
  *         if self.dim == 2:
  *             xF = np.array([meshin._xs[-1], meshin._ys[-1]])             # <<<<<<<<<<<<<<
  *         else:
  *             xF = np.array([meshin._xs[-1], meshin._ys[-1], meshin._zs[-1]])
  */
-    __Pyx_TraceLine(6163,0,__PYX_ERR(0, 6163, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6163, __pyx_L1_error)
+    __Pyx_TraceLine(6160,0,__PYX_ERR(0, 6160, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6160, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6163, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6160, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_v_meshin->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6163, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_meshin->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6160, __pyx_L1_error)}
     __pyx_t_17 = -1L;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_meshin->_xs.shape[0];
-    __pyx_t_6 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_xs.data + __pyx_t_17 * __pyx_v_meshin->_xs.strides[0]) )))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6163, __pyx_L1_error)
+    __pyx_t_6 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_xs.data + __pyx_t_17 * __pyx_v_meshin->_xs.strides[0]) )))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6160, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (unlikely(!__pyx_v_meshin->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6163, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_meshin->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6160, __pyx_L1_error)}
     __pyx_t_17 = -1L;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_meshin->_ys.shape[0];
-    __pyx_t_8 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_ys.data + __pyx_t_17 * __pyx_v_meshin->_ys.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6163, __pyx_L1_error)
+    __pyx_t_8 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_ys.data + __pyx_t_17 * __pyx_v_meshin->_ys.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6160, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6163, __pyx_L1_error)
+    __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6160, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_6);
     PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_8);
     PyList_SET_ITEM(__pyx_t_5, 1, __pyx_t_8);
     __pyx_t_6 = 0;
     __pyx_t_8 = 0;
@@ -78199,63 +78211,63 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_9, function);
       }
     }
     __pyx_t_11 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_8, __pyx_t_5) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_5);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6163, __pyx_L1_error)
+    if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6160, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6163, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6160, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     __pyx_v_xF = __pyx_t_16;
     __pyx_t_16.memview = NULL;
     __pyx_t_16.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6162
+    /* "discretize/_extensions/tree_ext.pyx":6159
  *         cdef double[:] origin = meshin._origin
  *         cdef double[:] xF
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             xF = np.array([meshin._xs[-1], meshin._ys[-1]])
  *         else:
  */
     goto __pyx_L17;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6165
+  /* "discretize/_extensions/tree_ext.pyx":6162
  *             xF = np.array([meshin._xs[-1], meshin._ys[-1]])
  *         else:
  *             xF = np.array([meshin._xs[-1], meshin._ys[-1], meshin._zs[-1]])             # <<<<<<<<<<<<<<
  * 
  *         cdef int_t nnz_counter = 0
  */
-  __Pyx_TraceLine(6165,0,__PYX_ERR(0, 6165, __pyx_L1_error))
+  __Pyx_TraceLine(6162,0,__PYX_ERR(0, 6162, __pyx_L1_error))
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6165, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6165, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_v_meshin->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6165, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_meshin->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6162, __pyx_L1_error)}
     __pyx_t_17 = -1L;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_meshin->_xs.shape[0];
-    __pyx_t_9 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_xs.data + __pyx_t_17 * __pyx_v_meshin->_xs.strides[0]) )))); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6165, __pyx_L1_error)
+    __pyx_t_9 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_xs.data + __pyx_t_17 * __pyx_v_meshin->_xs.strides[0]) )))); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (unlikely(!__pyx_v_meshin->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6165, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_meshin->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6162, __pyx_L1_error)}
     __pyx_t_17 = -1L;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_meshin->_ys.shape[0];
-    __pyx_t_8 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_ys.data + __pyx_t_17 * __pyx_v_meshin->_ys.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6165, __pyx_L1_error)
+    __pyx_t_8 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_ys.data + __pyx_t_17 * __pyx_v_meshin->_ys.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (unlikely(!__pyx_v_meshin->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6165, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_meshin->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6162, __pyx_L1_error)}
     __pyx_t_17 = -1L;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_meshin->_zs.shape[0];
-    __pyx_t_6 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_zs.data + __pyx_t_17 * __pyx_v_meshin->_zs.strides[0]) )))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6165, __pyx_L1_error)
+    __pyx_t_6 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_meshin->_zs.data + __pyx_t_17 * __pyx_v_meshin->_zs.strides[0]) )))); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_7 = PyList_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6165, __pyx_L1_error)
+    __pyx_t_7 = PyList_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_9);
     PyList_SET_ITEM(__pyx_t_7, 0, __pyx_t_9);
     __Pyx_GIVEREF(__pyx_t_8);
     PyList_SET_ITEM(__pyx_t_7, 1, __pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_6);
     PyList_SET_ITEM(__pyx_t_7, 2, __pyx_t_6);
@@ -78271,1150 +78283,1150 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_11 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_7) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_7);
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6165, __pyx_L1_error)
+    if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6165, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_11, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6162, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     __pyx_v_xF = __pyx_t_16;
     __pyx_t_16.memview = NULL;
     __pyx_t_16.data = NULL;
   }
   __pyx_L17:;
 
-  /* "discretize/_extensions/tree_ext.pyx":6167
+  /* "discretize/_extensions/tree_ext.pyx":6164
  *             xF = np.array([meshin._xs[-1], meshin._ys[-1], meshin._zs[-1]])
  * 
  *         cdef int_t nnz_counter = 0             # <<<<<<<<<<<<<<
  *         cdef int_t nnz_row = 0
  *         if build_mat:
  */
-  __Pyx_TraceLine(6167,0,__PYX_ERR(0, 6167, __pyx_L1_error))
+  __Pyx_TraceLine(6164,0,__PYX_ERR(0, 6164, __pyx_L1_error))
   __pyx_v_nnz_counter = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6168
+  /* "discretize/_extensions/tree_ext.pyx":6165
  * 
  *         cdef int_t nnz_counter = 0
  *         cdef int_t nnz_row = 0             # <<<<<<<<<<<<<<
  *         if build_mat:
  *             indptr.push_back(0)
  */
-  __Pyx_TraceLine(6168,0,__PYX_ERR(0, 6168, __pyx_L1_error))
+  __Pyx_TraceLine(6165,0,__PYX_ERR(0, 6165, __pyx_L1_error))
   __pyx_v_nnz_row = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6169
+  /* "discretize/_extensions/tree_ext.pyx":6166
  *         cdef int_t nnz_counter = 0
  *         cdef int_t nnz_row = 0
  *         if build_mat:             # <<<<<<<<<<<<<<
  *             indptr.push_back(0)
  *         cdef int_t i, in_cell_ind
  */
-  __Pyx_TraceLine(6169,0,__PYX_ERR(0, 6169, __pyx_L1_error))
+  __Pyx_TraceLine(6166,0,__PYX_ERR(0, 6166, __pyx_L1_error))
   __pyx_t_12 = (__pyx_v_build_mat != 0);
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6170
+    /* "discretize/_extensions/tree_ext.pyx":6167
  *         cdef int_t nnz_row = 0
  *         if build_mat:
  *             indptr.push_back(0)             # <<<<<<<<<<<<<<
  *         cdef int_t i, in_cell_ind
  *         cdef int_t n_overlap
  */
-    __Pyx_TraceLine(6170,0,__PYX_ERR(0, 6170, __pyx_L1_error))
+    __Pyx_TraceLine(6167,0,__PYX_ERR(0, 6167, __pyx_L1_error))
     try {
       __pyx_v_indptr.push_back(0);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 6170, __pyx_L1_error)
+      __PYX_ERR(0, 6167, __pyx_L1_error)
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6169
+    /* "discretize/_extensions/tree_ext.pyx":6166
  *         cdef int_t nnz_counter = 0
  *         cdef int_t nnz_row = 0
  *         if build_mat:             # <<<<<<<<<<<<<<
  *             indptr.push_back(0)
  *         cdef int_t i, in_cell_ind
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6179
+  /* "discretize/_extensions/tree_ext.pyx":6176
  * 
  *         # easier path if they share the same base:
  *         if same_base:             # <<<<<<<<<<<<<<
  *             if build_mat:
  *                 all_weights.resize(meshin.n_cells, 0.0)
  */
-  __Pyx_TraceLine(6179,0,__PYX_ERR(0, 6179, __pyx_L1_error))
+  __Pyx_TraceLine(6176,0,__PYX_ERR(0, 6176, __pyx_L1_error))
   __pyx_t_12 = (__pyx_v_same_base != 0);
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6180
+    /* "discretize/_extensions/tree_ext.pyx":6177
  *         # easier path if they share the same base:
  *         if same_base:
  *             if build_mat:             # <<<<<<<<<<<<<<
  *                 all_weights.resize(meshin.n_cells, 0.0)
  *                 row_inds.resize(meshin.n_cells, 0)
  */
-    __Pyx_TraceLine(6180,0,__PYX_ERR(0, 6180, __pyx_L1_error))
+    __Pyx_TraceLine(6177,0,__PYX_ERR(0, 6177, __pyx_L1_error))
     __pyx_t_12 = (__pyx_v_build_mat != 0);
     if (__pyx_t_12) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6181
+      /* "discretize/_extensions/tree_ext.pyx":6178
  *         if same_base:
  *             if build_mat:
  *                 all_weights.resize(meshin.n_cells, 0.0)             # <<<<<<<<<<<<<<
  *                 row_inds.resize(meshin.n_cells, 0)
  *             out_visited.resize(self.n_cells, 0)
  */
-      __Pyx_TraceLine(6181,0,__PYX_ERR(0, 6181, __pyx_L1_error))
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6181, __pyx_L1_error)
+      __Pyx_TraceLine(6178,0,__PYX_ERR(0, 6178, __pyx_L1_error))
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6178, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_18 = __Pyx_PyInt_As_size_t(__pyx_t_11); if (unlikely((__pyx_t_18 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 6181, __pyx_L1_error)
+      __pyx_t_18 = __Pyx_PyInt_As_size_t(__pyx_t_11); if (unlikely((__pyx_t_18 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 6178, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       try {
         __pyx_v_all_weights.resize(__pyx_t_18, 0.0);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 6181, __pyx_L1_error)
+        __PYX_ERR(0, 6178, __pyx_L1_error)
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6182
+      /* "discretize/_extensions/tree_ext.pyx":6179
  *             if build_mat:
  *                 all_weights.resize(meshin.n_cells, 0.0)
  *                 row_inds.resize(meshin.n_cells, 0)             # <<<<<<<<<<<<<<
  *             out_visited.resize(self.n_cells, 0)
  *             for in_cell in meshin.tree.cells:
  */
-      __Pyx_TraceLine(6182,0,__PYX_ERR(0, 6182, __pyx_L1_error))
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6182, __pyx_L1_error)
+      __Pyx_TraceLine(6179,0,__PYX_ERR(0, 6179, __pyx_L1_error))
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6179, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_19 = __Pyx_PyInt_As_size_t(__pyx_t_11); if (unlikely((__pyx_t_19 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 6182, __pyx_L1_error)
+      __pyx_t_19 = __Pyx_PyInt_As_size_t(__pyx_t_11); if (unlikely((__pyx_t_19 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 6179, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       try {
         __pyx_v_row_inds.resize(__pyx_t_19, 0);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 6182, __pyx_L1_error)
+        __PYX_ERR(0, 6179, __pyx_L1_error)
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6180
+      /* "discretize/_extensions/tree_ext.pyx":6177
  *         # easier path if they share the same base:
  *         if same_base:
  *             if build_mat:             # <<<<<<<<<<<<<<
  *                 all_weights.resize(meshin.n_cells, 0.0)
  *                 row_inds.resize(meshin.n_cells, 0)
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6183
+    /* "discretize/_extensions/tree_ext.pyx":6180
  *                 all_weights.resize(meshin.n_cells, 0.0)
  *                 row_inds.resize(meshin.n_cells, 0)
  *             out_visited.resize(self.n_cells, 0)             # <<<<<<<<<<<<<<
  *             for in_cell in meshin.tree.cells:
  *                 # for each input cell find containing output cell
  */
-    __Pyx_TraceLine(6183,0,__PYX_ERR(0, 6183, __pyx_L1_error))
-    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6183, __pyx_L1_error)
+    __Pyx_TraceLine(6180,0,__PYX_ERR(0, 6180, __pyx_L1_error))
+    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6180, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_19 = __Pyx_PyInt_As_size_t(__pyx_t_11); if (unlikely((__pyx_t_19 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 6183, __pyx_L1_error)
+    __pyx_t_19 = __Pyx_PyInt_As_size_t(__pyx_t_11); if (unlikely((__pyx_t_19 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 6180, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     try {
       __pyx_v_out_visited.resize(__pyx_t_19, 0);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 6183, __pyx_L1_error)
+      __PYX_ERR(0, 6180, __pyx_L1_error)
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6184
+    /* "discretize/_extensions/tree_ext.pyx":6181
  *                 row_inds.resize(meshin.n_cells, 0)
  *             out_visited.resize(self.n_cells, 0)
  *             for in_cell in meshin.tree.cells:             # <<<<<<<<<<<<<<
  *                 # for each input cell find containing output cell
  *                 out_cell = self.tree.containing_cell(
  */
-    __Pyx_TraceLine(6184,0,__PYX_ERR(0, 6184, __pyx_L1_error))
+    __Pyx_TraceLine(6181,0,__PYX_ERR(0, 6181, __pyx_L1_error))
     __pyx_t_21 = &__pyx_v_meshin->tree->cells;
     __pyx_t_20 = __pyx_t_21->begin();
     for (;;) {
       if (!(__pyx_t_20 != __pyx_t_21->end())) break;
       __pyx_t_22 = *__pyx_t_20;
       ++__pyx_t_20;
       __pyx_v_in_cell = __pyx_t_22;
 
-      /* "discretize/_extensions/tree_ext.pyx":6186
+      /* "discretize/_extensions/tree_ext.pyx":6183
  *             for in_cell in meshin.tree.cells:
  *                 # for each input cell find containing output cell
  *                 out_cell = self.tree.containing_cell(             # <<<<<<<<<<<<<<
  *                     in_cell.location[0],
  *                     in_cell.location[1],
  */
-      __Pyx_TraceLine(6186,0,__PYX_ERR(0, 6186, __pyx_L1_error))
+      __Pyx_TraceLine(6183,0,__PYX_ERR(0, 6183, __pyx_L1_error))
       __pyx_v_out_cell = __pyx_v_self->tree->containing_cell((__pyx_v_in_cell->location[0]), (__pyx_v_in_cell->location[1]), (__pyx_v_in_cell->location[2]));
 
-      /* "discretize/_extensions/tree_ext.pyx":6195
+      /* "discretize/_extensions/tree_ext.pyx":6192
  *                 # else:
  *                 # contribution is 1.0
  *                 if out_cell.level < in_cell.level:             # <<<<<<<<<<<<<<
  *                     out_visited[out_cell.index] = 1
  *                     weight = in_cell.volume/out_cell.volume
  */
-      __Pyx_TraceLine(6195,0,__PYX_ERR(0, 6195, __pyx_L1_error))
+      __Pyx_TraceLine(6192,0,__PYX_ERR(0, 6192, __pyx_L1_error))
       __pyx_t_12 = ((__pyx_v_out_cell->level < __pyx_v_in_cell->level) != 0);
       if (__pyx_t_12) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6196
+        /* "discretize/_extensions/tree_ext.pyx":6193
  *                 # contribution is 1.0
  *                 if out_cell.level < in_cell.level:
  *                     out_visited[out_cell.index] = 1             # <<<<<<<<<<<<<<
  *                     weight = in_cell.volume/out_cell.volume
  *                     if not build_mat:
  */
-        __Pyx_TraceLine(6196,0,__PYX_ERR(0, 6196, __pyx_L1_error))
+        __Pyx_TraceLine(6193,0,__PYX_ERR(0, 6193, __pyx_L1_error))
         (__pyx_v_out_visited[__pyx_v_out_cell->index]) = 1;
 
-        /* "discretize/_extensions/tree_ext.pyx":6197
+        /* "discretize/_extensions/tree_ext.pyx":6194
  *                 if out_cell.level < in_cell.level:
  *                     out_visited[out_cell.index] = 1
  *                     weight = in_cell.volume/out_cell.volume             # <<<<<<<<<<<<<<
  *                     if not build_mat:
  *                         outs[out_cell.index] += weight*vals[in_cell.index]
  */
-        __Pyx_TraceLine(6197,0,__PYX_ERR(0, 6197, __pyx_L1_error))
+        __Pyx_TraceLine(6194,0,__PYX_ERR(0, 6194, __pyx_L1_error))
         __pyx_v_weight = (__pyx_v_in_cell->volume / __pyx_v_out_cell->volume);
 
-        /* "discretize/_extensions/tree_ext.pyx":6198
+        /* "discretize/_extensions/tree_ext.pyx":6195
  *                     out_visited[out_cell.index] = 1
  *                     weight = in_cell.volume/out_cell.volume
  *                     if not build_mat:             # <<<<<<<<<<<<<<
  *                         outs[out_cell.index] += weight*vals[in_cell.index]
  *                     else:
  */
-        __Pyx_TraceLine(6198,0,__PYX_ERR(0, 6198, __pyx_L1_error))
+        __Pyx_TraceLine(6195,0,__PYX_ERR(0, 6195, __pyx_L1_error))
         __pyx_t_12 = ((!(__pyx_v_build_mat != 0)) != 0);
         if (__pyx_t_12) {
 
-          /* "discretize/_extensions/tree_ext.pyx":6199
+          /* "discretize/_extensions/tree_ext.pyx":6196
  *                     weight = in_cell.volume/out_cell.volume
  *                     if not build_mat:
  *                         outs[out_cell.index] += weight*vals[in_cell.index]             # <<<<<<<<<<<<<<
  *                     else:
  *                         all_weights[in_cell.index] = weight
  */
-          __Pyx_TraceLine(6199,0,__PYX_ERR(0, 6199, __pyx_L1_error))
+          __Pyx_TraceLine(6196,0,__PYX_ERR(0, 6196, __pyx_L1_error))
           __pyx_t_23 = __pyx_v_in_cell->index;
           if (__pyx_t_23 < 0) __pyx_t_23 += __pyx_v_vals.shape[0];
           __pyx_t_24 = __pyx_v_out_cell->index;
           if (__pyx_t_24 < 0) __pyx_t_24 += __pyx_v_outs.shape[0];
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_outs.data + __pyx_t_24 * __pyx_v_outs.strides[0]) )) += (__pyx_v_weight * (*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_vals.data + __pyx_t_23 * __pyx_v_vals.strides[0]) ))));
 
-          /* "discretize/_extensions/tree_ext.pyx":6198
+          /* "discretize/_extensions/tree_ext.pyx":6195
  *                     out_visited[out_cell.index] = 1
  *                     weight = in_cell.volume/out_cell.volume
  *                     if not build_mat:             # <<<<<<<<<<<<<<
  *                         outs[out_cell.index] += weight*vals[in_cell.index]
  *                     else:
  */
           goto __pyx_L24;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6201
+        /* "discretize/_extensions/tree_ext.pyx":6198
  *                         outs[out_cell.index] += weight*vals[in_cell.index]
  *                     else:
  *                         all_weights[in_cell.index] = weight             # <<<<<<<<<<<<<<
  *                         row_inds[in_cell.index] = out_cell.index
  * 
  */
-        __Pyx_TraceLine(6201,0,__PYX_ERR(0, 6201, __pyx_L1_error))
+        __Pyx_TraceLine(6198,0,__PYX_ERR(0, 6198, __pyx_L1_error))
         /*else*/ {
           (__pyx_v_all_weights[__pyx_v_in_cell->index]) = __pyx_v_weight;
 
-          /* "discretize/_extensions/tree_ext.pyx":6202
+          /* "discretize/_extensions/tree_ext.pyx":6199
  *                     else:
  *                         all_weights[in_cell.index] = weight
  *                         row_inds[in_cell.index] = out_cell.index             # <<<<<<<<<<<<<<
  * 
  *             if build_mat:
  */
-          __Pyx_TraceLine(6202,0,__PYX_ERR(0, 6202, __pyx_L1_error))
+          __Pyx_TraceLine(6199,0,__PYX_ERR(0, 6199, __pyx_L1_error))
           __pyx_t_23 = __pyx_v_out_cell->index;
           (__pyx_v_row_inds[__pyx_v_in_cell->index]) = __pyx_t_23;
         }
         __pyx_L24:;
 
-        /* "discretize/_extensions/tree_ext.pyx":6195
+        /* "discretize/_extensions/tree_ext.pyx":6192
  *                 # else:
  *                 # contribution is 1.0
  *                 if out_cell.level < in_cell.level:             # <<<<<<<<<<<<<<
  *                     out_visited[out_cell.index] = 1
  *                     weight = in_cell.volume/out_cell.volume
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6184
+      /* "discretize/_extensions/tree_ext.pyx":6181
  *                 row_inds.resize(meshin.n_cells, 0)
  *             out_visited.resize(self.n_cells, 0)
  *             for in_cell in meshin.tree.cells:             # <<<<<<<<<<<<<<
  *                 # for each input cell find containing output cell
  *                 out_cell = self.tree.containing_cell(
  */
-      __Pyx_TraceLine(6184,0,__PYX_ERR(0, 6184, __pyx_L1_error))
+      __Pyx_TraceLine(6181,0,__PYX_ERR(0, 6181, __pyx_L1_error))
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6204
+    /* "discretize/_extensions/tree_ext.pyx":6201
  *                         row_inds[in_cell.index] = out_cell.index
  * 
  *             if build_mat:             # <<<<<<<<<<<<<<
  *                 P = sp.csr_matrix((all_weights, (row_inds, np.arange(meshin.n_cells))),
  *                                   shape=(self.n_cells, meshin.n_cells))
  */
-    __Pyx_TraceLine(6204,0,__PYX_ERR(0, 6204, __pyx_L1_error))
+    __Pyx_TraceLine(6201,0,__PYX_ERR(0, 6201, __pyx_L1_error))
     __pyx_t_12 = (__pyx_v_build_mat != 0);
     if (__pyx_t_12) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6205
+      /* "discretize/_extensions/tree_ext.pyx":6202
  * 
  *             if build_mat:
  *                 P = sp.csr_matrix((all_weights, (row_inds, np.arange(meshin.n_cells))),             # <<<<<<<<<<<<<<
  *                                   shape=(self.n_cells, meshin.n_cells))
  * 
  */
-      __Pyx_TraceLine(6205,0,__PYX_ERR(0, 6205, __pyx_L1_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_sp); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __Pyx_TraceLine(6202,0,__PYX_ERR(0, 6202, __pyx_L1_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_sp); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-      __pyx_t_11 = __pyx_convert_vector_to_py_double(__pyx_v_all_weights); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __pyx_t_11 = __pyx_convert_vector_to_py_double(__pyx_v_all_weights); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_7 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __pyx_t_7 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_arange); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_arange); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_25 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
         __pyx_t_25 = PyMethod_GET_SELF(__pyx_t_9);
         if (likely(__pyx_t_25)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
           __Pyx_INCREF(__pyx_t_25);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_9, function);
         }
       }
       __pyx_t_6 = (__pyx_t_25) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_25, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_8);
       __Pyx_XDECREF(__pyx_t_25); __pyx_t_25 = 0;
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_7);
       PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_7);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_6);
       __pyx_t_7 = 0;
       __pyx_t_6 = 0;
-      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GIVEREF(__pyx_t_11);
       PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_11);
       __Pyx_GIVEREF(__pyx_t_9);
       PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_9);
       __pyx_t_11 = 0;
       __pyx_t_9 = 0;
-      __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6);
       __pyx_t_6 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6206
+      /* "discretize/_extensions/tree_ext.pyx":6203
  *             if build_mat:
  *                 P = sp.csr_matrix((all_weights, (row_inds, np.arange(meshin.n_cells))),
  *                                   shape=(self.n_cells, meshin.n_cells))             # <<<<<<<<<<<<<<
  * 
  *                 n_unvisited = self.n_cells - np.sum(out_visited)
  */
-      __Pyx_TraceLine(6206,0,__PYX_ERR(0, 6206, __pyx_L1_error))
-      __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6206, __pyx_L1_error)
+      __Pyx_TraceLine(6203,0,__PYX_ERR(0, 6203, __pyx_L1_error))
+      __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6203, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6206, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6203, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6206, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6203, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6206, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6203, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_GIVEREF(__pyx_t_11);
       PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_11);
       __Pyx_GIVEREF(__pyx_t_7);
       PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_7);
       __pyx_t_11 = 0;
       __pyx_t_7 = 0;
-      if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_shape, __pyx_t_8) < 0) __PYX_ERR(0, 6206, __pyx_L1_error)
+      if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_shape, __pyx_t_8) < 0) __PYX_ERR(0, 6203, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6205
+      /* "discretize/_extensions/tree_ext.pyx":6202
  * 
  *             if build_mat:
  *                 P = sp.csr_matrix((all_weights, (row_inds, np.arange(meshin.n_cells))),             # <<<<<<<<<<<<<<
  *                                   shape=(self.n_cells, meshin.n_cells))
  * 
  */
-      __Pyx_TraceLine(6205,0,__PYX_ERR(0, 6205, __pyx_L1_error))
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6205, __pyx_L1_error)
+      __Pyx_TraceLine(6202,0,__PYX_ERR(0, 6202, __pyx_L1_error))
+      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6202, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_v_P = __pyx_t_8;
       __pyx_t_8 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6208
+      /* "discretize/_extensions/tree_ext.pyx":6205
  *                                   shape=(self.n_cells, meshin.n_cells))
  * 
  *                 n_unvisited = self.n_cells - np.sum(out_visited)             # <<<<<<<<<<<<<<
  *                 row_inds.resize(n_unvisited, 0)
  *                 col_inds.resize(n_unvisited, 0)
  */
-      __Pyx_TraceLine(6208,0,__PYX_ERR(0, 6208, __pyx_L1_error))
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6208, __pyx_L1_error)
+      __Pyx_TraceLine(6205,0,__PYX_ERR(0, 6205, __pyx_L1_error))
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6208, __pyx_L1_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_sum); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6208, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_sum); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = __pyx_convert_vector_to_py_int_t(__pyx_v_out_visited); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6208, __pyx_L1_error)
+      __pyx_t_9 = __pyx_convert_vector_to_py_int_t(__pyx_v_out_visited); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_7 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
           __Pyx_INCREF(__pyx_t_7);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
         }
       }
       __pyx_t_6 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_9);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6208, __pyx_L1_error)
+      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = PyNumber_Subtract(__pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6208, __pyx_L1_error)
+      __pyx_t_5 = PyNumber_Subtract(__pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_4 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_4 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6208, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_4 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6205, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __pyx_v_n_unvisited = __pyx_t_4;
 
-      /* "discretize/_extensions/tree_ext.pyx":6209
+      /* "discretize/_extensions/tree_ext.pyx":6206
  * 
  *                 n_unvisited = self.n_cells - np.sum(out_visited)
  *                 row_inds.resize(n_unvisited, 0)             # <<<<<<<<<<<<<<
  *                 col_inds.resize(n_unvisited, 0)
  *             i = 0
  */
-      __Pyx_TraceLine(6209,0,__PYX_ERR(0, 6209, __pyx_L1_error))
+      __Pyx_TraceLine(6206,0,__PYX_ERR(0, 6206, __pyx_L1_error))
       try {
         __pyx_v_row_inds.resize(__pyx_v_n_unvisited, 0);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 6209, __pyx_L1_error)
+        __PYX_ERR(0, 6206, __pyx_L1_error)
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6210
+      /* "discretize/_extensions/tree_ext.pyx":6207
  *                 n_unvisited = self.n_cells - np.sum(out_visited)
  *                 row_inds.resize(n_unvisited, 0)
  *                 col_inds.resize(n_unvisited, 0)             # <<<<<<<<<<<<<<
  *             i = 0
  *             # assign weights of 1 to unvisited output cells and find their containing cell
  */
-      __Pyx_TraceLine(6210,0,__PYX_ERR(0, 6210, __pyx_L1_error))
+      __Pyx_TraceLine(6207,0,__PYX_ERR(0, 6207, __pyx_L1_error))
       try {
         __pyx_v_col_inds.resize(__pyx_v_n_unvisited, 0);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 6210, __pyx_L1_error)
+        __PYX_ERR(0, 6207, __pyx_L1_error)
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6204
+      /* "discretize/_extensions/tree_ext.pyx":6201
  *                         row_inds[in_cell.index] = out_cell.index
  * 
  *             if build_mat:             # <<<<<<<<<<<<<<
  *                 P = sp.csr_matrix((all_weights, (row_inds, np.arange(meshin.n_cells))),
  *                                   shape=(self.n_cells, meshin.n_cells))
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6211
+    /* "discretize/_extensions/tree_ext.pyx":6208
  *                 row_inds.resize(n_unvisited, 0)
  *                 col_inds.resize(n_unvisited, 0)
  *             i = 0             # <<<<<<<<<<<<<<
  *             # assign weights of 1 to unvisited output cells and find their containing cell
  *             for out_cell in self.tree.cells:
  */
-    __Pyx_TraceLine(6211,0,__PYX_ERR(0, 6211, __pyx_L1_error))
+    __Pyx_TraceLine(6208,0,__PYX_ERR(0, 6208, __pyx_L1_error))
     __pyx_v_i = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6213
+    /* "discretize/_extensions/tree_ext.pyx":6210
  *             i = 0
  *             # assign weights of 1 to unvisited output cells and find their containing cell
  *             for out_cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *                 if not out_visited[out_cell.index]:
  *                     in_cell = meshin.tree.containing_cell(
  */
-    __Pyx_TraceLine(6213,0,__PYX_ERR(0, 6213, __pyx_L1_error))
+    __Pyx_TraceLine(6210,0,__PYX_ERR(0, 6210, __pyx_L1_error))
     __pyx_t_21 = &__pyx_v_self->tree->cells;
     __pyx_t_20 = __pyx_t_21->begin();
     for (;;) {
       if (!(__pyx_t_20 != __pyx_t_21->end())) break;
       __pyx_t_22 = *__pyx_t_20;
       ++__pyx_t_20;
       __pyx_v_out_cell = __pyx_t_22;
 
-      /* "discretize/_extensions/tree_ext.pyx":6214
+      /* "discretize/_extensions/tree_ext.pyx":6211
  *             # assign weights of 1 to unvisited output cells and find their containing cell
  *             for out_cell in self.tree.cells:
  *                 if not out_visited[out_cell.index]:             # <<<<<<<<<<<<<<
  *                     in_cell = meshin.tree.containing_cell(
  *                         out_cell.location[0],
  */
-      __Pyx_TraceLine(6214,0,__PYX_ERR(0, 6214, __pyx_L1_error))
+      __Pyx_TraceLine(6211,0,__PYX_ERR(0, 6211, __pyx_L1_error))
       __pyx_t_12 = ((!((__pyx_v_out_visited[__pyx_v_out_cell->index]) != 0)) != 0);
       if (__pyx_t_12) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6215
+        /* "discretize/_extensions/tree_ext.pyx":6212
  *             for out_cell in self.tree.cells:
  *                 if not out_visited[out_cell.index]:
  *                     in_cell = meshin.tree.containing_cell(             # <<<<<<<<<<<<<<
  *                         out_cell.location[0],
  *                         out_cell.location[1],
  */
-        __Pyx_TraceLine(6215,0,__PYX_ERR(0, 6215, __pyx_L1_error))
+        __Pyx_TraceLine(6212,0,__PYX_ERR(0, 6212, __pyx_L1_error))
         __pyx_v_in_cell = __pyx_v_meshin->tree->containing_cell((__pyx_v_out_cell->location[0]), (__pyx_v_out_cell->location[1]), (__pyx_v_out_cell->location[2]));
 
-        /* "discretize/_extensions/tree_ext.pyx":6221
+        /* "discretize/_extensions/tree_ext.pyx":6218
  *                     )
  * 
  *                     if not build_mat:             # <<<<<<<<<<<<<<
  *                         outs[out_cell.index] = vals[in_cell.index]
  *                     else:
  */
-        __Pyx_TraceLine(6221,0,__PYX_ERR(0, 6221, __pyx_L1_error))
+        __Pyx_TraceLine(6218,0,__PYX_ERR(0, 6218, __pyx_L1_error))
         __pyx_t_12 = ((!(__pyx_v_build_mat != 0)) != 0);
         if (__pyx_t_12) {
 
-          /* "discretize/_extensions/tree_ext.pyx":6222
+          /* "discretize/_extensions/tree_ext.pyx":6219
  * 
  *                     if not build_mat:
  *                         outs[out_cell.index] = vals[in_cell.index]             # <<<<<<<<<<<<<<
  *                     else:
  *                         row_inds[i] = out_cell.index
  */
-          __Pyx_TraceLine(6222,0,__PYX_ERR(0, 6222, __pyx_L1_error))
+          __Pyx_TraceLine(6219,0,__PYX_ERR(0, 6219, __pyx_L1_error))
           __pyx_t_23 = __pyx_v_in_cell->index;
           if (__pyx_t_23 < 0) __pyx_t_23 += __pyx_v_vals.shape[0];
           __pyx_t_24 = __pyx_v_out_cell->index;
           if (__pyx_t_24 < 0) __pyx_t_24 += __pyx_v_outs.shape[0];
           *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_outs.data + __pyx_t_24 * __pyx_v_outs.strides[0]) )) = (*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_vals.data + __pyx_t_23 * __pyx_v_vals.strides[0]) )));
 
-          /* "discretize/_extensions/tree_ext.pyx":6221
+          /* "discretize/_extensions/tree_ext.pyx":6218
  *                     )
  * 
  *                     if not build_mat:             # <<<<<<<<<<<<<<
  *                         outs[out_cell.index] = vals[in_cell.index]
  *                     else:
  */
           goto __pyx_L29;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6224
+        /* "discretize/_extensions/tree_ext.pyx":6221
  *                         outs[out_cell.index] = vals[in_cell.index]
  *                     else:
  *                         row_inds[i] = out_cell.index             # <<<<<<<<<<<<<<
  *                         col_inds[i] = in_cell.index
  *                         i += 1
  */
-        __Pyx_TraceLine(6224,0,__PYX_ERR(0, 6224, __pyx_L1_error))
+        __Pyx_TraceLine(6221,0,__PYX_ERR(0, 6221, __pyx_L1_error))
         /*else*/ {
           __pyx_t_23 = __pyx_v_out_cell->index;
           (__pyx_v_row_inds[__pyx_v_i]) = __pyx_t_23;
 
-          /* "discretize/_extensions/tree_ext.pyx":6225
+          /* "discretize/_extensions/tree_ext.pyx":6222
  *                     else:
  *                         row_inds[i] = out_cell.index
  *                         col_inds[i] = in_cell.index             # <<<<<<<<<<<<<<
  *                         i += 1
  *             if build_mat and n_unvisited > 0:
  */
-          __Pyx_TraceLine(6225,0,__PYX_ERR(0, 6225, __pyx_L1_error))
+          __Pyx_TraceLine(6222,0,__PYX_ERR(0, 6222, __pyx_L1_error))
           __pyx_t_23 = __pyx_v_in_cell->index;
           (__pyx_v_col_inds[__pyx_v_i]) = __pyx_t_23;
 
-          /* "discretize/_extensions/tree_ext.pyx":6226
+          /* "discretize/_extensions/tree_ext.pyx":6223
  *                         row_inds[i] = out_cell.index
  *                         col_inds[i] = in_cell.index
  *                         i += 1             # <<<<<<<<<<<<<<
  *             if build_mat and n_unvisited > 0:
  *                 P += sp.csr_matrix(
  */
-          __Pyx_TraceLine(6226,0,__PYX_ERR(0, 6226, __pyx_L1_error))
+          __Pyx_TraceLine(6223,0,__PYX_ERR(0, 6223, __pyx_L1_error))
           __pyx_v_i = (__pyx_v_i + 1);
         }
         __pyx_L29:;
 
-        /* "discretize/_extensions/tree_ext.pyx":6214
+        /* "discretize/_extensions/tree_ext.pyx":6211
  *             # assign weights of 1 to unvisited output cells and find their containing cell
  *             for out_cell in self.tree.cells:
  *                 if not out_visited[out_cell.index]:             # <<<<<<<<<<<<<<
  *                     in_cell = meshin.tree.containing_cell(
  *                         out_cell.location[0],
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6213
+      /* "discretize/_extensions/tree_ext.pyx":6210
  *             i = 0
  *             # assign weights of 1 to unvisited output cells and find their containing cell
  *             for out_cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *                 if not out_visited[out_cell.index]:
  *                     in_cell = meshin.tree.containing_cell(
  */
-      __Pyx_TraceLine(6213,0,__PYX_ERR(0, 6213, __pyx_L1_error))
+      __Pyx_TraceLine(6210,0,__PYX_ERR(0, 6210, __pyx_L1_error))
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6227
+    /* "discretize/_extensions/tree_ext.pyx":6224
  *                         col_inds[i] = in_cell.index
  *                         i += 1
  *             if build_mat and n_unvisited > 0:             # <<<<<<<<<<<<<<
  *                 P += sp.csr_matrix(
  *                     (np.ones(n_unvisited), (row_inds, col_inds)),
  */
-    __Pyx_TraceLine(6227,0,__PYX_ERR(0, 6227, __pyx_L1_error))
+    __Pyx_TraceLine(6224,0,__PYX_ERR(0, 6224, __pyx_L1_error))
     __pyx_t_15 = (__pyx_v_build_mat != 0);
     if (__pyx_t_15) {
     } else {
       __pyx_t_12 = __pyx_t_15;
       goto __pyx_L31_bool_binop_done;
     }
     __pyx_t_15 = ((__pyx_v_n_unvisited > 0) != 0);
     __pyx_t_12 = __pyx_t_15;
     __pyx_L31_bool_binop_done:;
     if (__pyx_t_12) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6228
+      /* "discretize/_extensions/tree_ext.pyx":6225
  *                         i += 1
  *             if build_mat and n_unvisited > 0:
  *                 P += sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                     (np.ones(n_unvisited), (row_inds, col_inds)),
  *                     shape=(self.n_cells, meshin.n_cells)
  */
-      __Pyx_TraceLine(6228,0,__PYX_ERR(0, 6228, __pyx_L1_error))
-      if (unlikely(!__pyx_v_P)) { __Pyx_RaiseUnboundLocalError("P"); __PYX_ERR(0, 6228, __pyx_L1_error) }
-      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6228, __pyx_L1_error)
+      __Pyx_TraceLine(6225,0,__PYX_ERR(0, 6225, __pyx_L1_error))
+      if (unlikely(!__pyx_v_P)) { __Pyx_RaiseUnboundLocalError("P"); __PYX_ERR(0, 6225, __pyx_L1_error) }
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_sp); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6228, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6229
+      /* "discretize/_extensions/tree_ext.pyx":6226
  *             if build_mat and n_unvisited > 0:
  *                 P += sp.csr_matrix(
  *                     (np.ones(n_unvisited), (row_inds, col_inds)),             # <<<<<<<<<<<<<<
  *                     shape=(self.n_cells, meshin.n_cells)
  *                 )
  */
-      __Pyx_TraceLine(6229,0,__PYX_ERR(0, 6229, __pyx_L1_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6229, __pyx_L1_error)
+      __Pyx_TraceLine(6226,0,__PYX_ERR(0, 6226, __pyx_L1_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6226, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_ones); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6229, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_ones); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6226, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = __Pyx_PyInt_From_int_t(__pyx_v_n_unvisited); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6229, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int_t(__pyx_v_n_unvisited); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6226, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_7 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_9);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
           __Pyx_INCREF(__pyx_t_7);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_9, function);
         }
       }
       __pyx_t_5 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_7, __pyx_t_8) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_8);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6229, __pyx_L1_error)
+      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6226, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6229, __pyx_L1_error)
+      __pyx_t_9 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6226, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_8 = __pyx_convert_vector_to_py_int_t(__pyx_v_col_inds); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6229, __pyx_L1_error)
+      __pyx_t_8 = __pyx_convert_vector_to_py_int_t(__pyx_v_col_inds); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6226, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6229, __pyx_L1_error)
+      __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6226, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_GIVEREF(__pyx_t_9);
       PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_8);
       PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_8);
       __pyx_t_9 = 0;
       __pyx_t_8 = 0;
-      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6229, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6226, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_GIVEREF(__pyx_t_5);
       PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_5);
       __Pyx_GIVEREF(__pyx_t_7);
       PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_7);
       __pyx_t_5 = 0;
       __pyx_t_7 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6228
+      /* "discretize/_extensions/tree_ext.pyx":6225
  *                         i += 1
  *             if build_mat and n_unvisited > 0:
  *                 P += sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                     (np.ones(n_unvisited), (row_inds, col_inds)),
  *                     shape=(self.n_cells, meshin.n_cells)
  */
-      __Pyx_TraceLine(6228,0,__PYX_ERR(0, 6228, __pyx_L1_error))
-      __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6228, __pyx_L1_error)
+      __Pyx_TraceLine(6225,0,__PYX_ERR(0, 6225, __pyx_L1_error))
+      __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_GIVEREF(__pyx_t_8);
       PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8);
       __pyx_t_8 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6230
+      /* "discretize/_extensions/tree_ext.pyx":6227
  *                 P += sp.csr_matrix(
  *                     (np.ones(n_unvisited), (row_inds, col_inds)),
  *                     shape=(self.n_cells, meshin.n_cells)             # <<<<<<<<<<<<<<
  *                 )
  *             if not build_mat:
  */
-      __Pyx_TraceLine(6230,0,__PYX_ERR(0, 6230, __pyx_L1_error))
-      __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6230, __pyx_L1_error)
+      __Pyx_TraceLine(6227,0,__PYX_ERR(0, 6227, __pyx_L1_error))
+      __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6227, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6230, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6227, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6230, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6227, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6230, __pyx_L1_error)
+      __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6227, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_GIVEREF(__pyx_t_5);
       PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_5);
       __Pyx_GIVEREF(__pyx_t_9);
       PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_9);
       __pyx_t_5 = 0;
       __pyx_t_9 = 0;
-      if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_11) < 0) __PYX_ERR(0, 6230, __pyx_L1_error)
+      if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_11) < 0) __PYX_ERR(0, 6227, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6228
+      /* "discretize/_extensions/tree_ext.pyx":6225
  *                         i += 1
  *             if build_mat and n_unvisited > 0:
  *                 P += sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                     (np.ones(n_unvisited), (row_inds, col_inds)),
  *                     shape=(self.n_cells, meshin.n_cells)
  */
-      __Pyx_TraceLine(6228,0,__PYX_ERR(0, 6228, __pyx_L1_error))
-      __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6228, __pyx_L1_error)
+      __Pyx_TraceLine(6225,0,__PYX_ERR(0, 6225, __pyx_L1_error))
+      __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_P, __pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6228, __pyx_L1_error)
+      __pyx_t_8 = PyNumber_InPlaceAdd(__pyx_v_P, __pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6225, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_XDECREF_SET(__pyx_v_P, __pyx_t_8);
       __pyx_t_8 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6227
+      /* "discretize/_extensions/tree_ext.pyx":6224
  *                         col_inds[i] = in_cell.index
  *                         i += 1
  *             if build_mat and n_unvisited > 0:             # <<<<<<<<<<<<<<
  *                 P += sp.csr_matrix(
  *                     (np.ones(n_unvisited), (row_inds, col_inds)),
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6232
+    /* "discretize/_extensions/tree_ext.pyx":6229
  *                     shape=(self.n_cells, meshin.n_cells)
  *                 )
  *             if not build_mat:             # <<<<<<<<<<<<<<
  *                 return output
  *             return P
  */
-    __Pyx_TraceLine(6232,0,__PYX_ERR(0, 6232, __pyx_L1_error))
+    __Pyx_TraceLine(6229,0,__PYX_ERR(0, 6229, __pyx_L1_error))
     __pyx_t_12 = ((!(__pyx_v_build_mat != 0)) != 0);
     if (__pyx_t_12) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6233
+      /* "discretize/_extensions/tree_ext.pyx":6230
  *                 )
  *             if not build_mat:
  *                 return output             # <<<<<<<<<<<<<<
  *             return P
  * 
  */
-      __Pyx_TraceLine(6233,0,__PYX_ERR(0, 6233, __pyx_L1_error))
+      __Pyx_TraceLine(6230,0,__PYX_ERR(0, 6230, __pyx_L1_error))
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(__pyx_v_output);
       __pyx_r = __pyx_v_output;
       goto __pyx_L0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6232
+      /* "discretize/_extensions/tree_ext.pyx":6229
  *                     shape=(self.n_cells, meshin.n_cells)
  *                 )
  *             if not build_mat:             # <<<<<<<<<<<<<<
  *                 return output
  *             return P
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6234
+    /* "discretize/_extensions/tree_ext.pyx":6231
  *             if not build_mat:
  *                 return output
  *             return P             # <<<<<<<<<<<<<<
  * 
  *         for cell in self.tree.cells:
  */
-    __Pyx_TraceLine(6234,0,__PYX_ERR(0, 6234, __pyx_L1_error))
+    __Pyx_TraceLine(6231,0,__PYX_ERR(0, 6231, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    if (unlikely(!__pyx_v_P)) { __Pyx_RaiseUnboundLocalError("P"); __PYX_ERR(0, 6234, __pyx_L1_error) }
+    if (unlikely(!__pyx_v_P)) { __Pyx_RaiseUnboundLocalError("P"); __PYX_ERR(0, 6231, __pyx_L1_error) }
     __Pyx_INCREF(__pyx_v_P);
     __pyx_r = __pyx_v_P;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6179
+    /* "discretize/_extensions/tree_ext.pyx":6176
  * 
  *         # easier path if they share the same base:
  *         if same_base:             # <<<<<<<<<<<<<<
  *             if build_mat:
  *                 all_weights.resize(meshin.n_cells, 0.0)
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6236
+  /* "discretize/_extensions/tree_ext.pyx":6233
  *             return P
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             x1m = min(cell.points[0].location[0], xF[0])
  *             y1m = min(cell.points[0].location[1], xF[1])
  */
-  __Pyx_TraceLine(6236,0,__PYX_ERR(0, 6236, __pyx_L1_error))
+  __Pyx_TraceLine(6233,0,__PYX_ERR(0, 6233, __pyx_L1_error))
   __pyx_t_21 = &__pyx_v_self->tree->cells;
   __pyx_t_20 = __pyx_t_21->begin();
   for (;;) {
     if (!(__pyx_t_20 != __pyx_t_21->end())) break;
     __pyx_t_22 = *__pyx_t_20;
     ++__pyx_t_20;
     __pyx_v_cell = __pyx_t_22;
 
-    /* "discretize/_extensions/tree_ext.pyx":6237
+    /* "discretize/_extensions/tree_ext.pyx":6234
  * 
  *         for cell in self.tree.cells:
  *             x1m = min(cell.points[0].location[0], xF[0])             # <<<<<<<<<<<<<<
  *             y1m = min(cell.points[0].location[1], xF[1])
  * 
  */
-    __Pyx_TraceLine(6237,0,__PYX_ERR(0, 6237, __pyx_L1_error))
+    __Pyx_TraceLine(6234,0,__PYX_ERR(0, 6234, __pyx_L1_error))
     __pyx_t_17 = 0;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_xF.shape[0];
     __pyx_t_26 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_17 * __pyx_v_xF.strides[0]) )));
     __pyx_t_27 = ((__pyx_v_cell->points[0])->location[0]);
     if (((__pyx_t_26 < __pyx_t_27) != 0)) {
       __pyx_t_28 = __pyx_t_26;
     } else {
       __pyx_t_28 = __pyx_t_27;
     }
     __pyx_v_x1m = __pyx_t_28;
 
-    /* "discretize/_extensions/tree_ext.pyx":6238
+    /* "discretize/_extensions/tree_ext.pyx":6235
  *         for cell in self.tree.cells:
  *             x1m = min(cell.points[0].location[0], xF[0])
  *             y1m = min(cell.points[0].location[1], xF[1])             # <<<<<<<<<<<<<<
  * 
  *             x1p = max(cell.points[3].location[0], origin[0])
  */
-    __Pyx_TraceLine(6238,0,__PYX_ERR(0, 6238, __pyx_L1_error))
+    __Pyx_TraceLine(6235,0,__PYX_ERR(0, 6235, __pyx_L1_error))
     __pyx_t_17 = 1;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_xF.shape[0];
     __pyx_t_28 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_17 * __pyx_v_xF.strides[0]) )));
     __pyx_t_26 = ((__pyx_v_cell->points[0])->location[1]);
     if (((__pyx_t_28 < __pyx_t_26) != 0)) {
       __pyx_t_27 = __pyx_t_28;
     } else {
       __pyx_t_27 = __pyx_t_26;
     }
     __pyx_v_y1m = __pyx_t_27;
 
-    /* "discretize/_extensions/tree_ext.pyx":6240
+    /* "discretize/_extensions/tree_ext.pyx":6237
  *             y1m = min(cell.points[0].location[1], xF[1])
  * 
  *             x1p = max(cell.points[3].location[0], origin[0])             # <<<<<<<<<<<<<<
  *             y1p = max(cell.points[3].location[1], origin[1])
  *             if self._dim==3:
  */
-    __Pyx_TraceLine(6240,0,__PYX_ERR(0, 6240, __pyx_L1_error))
+    __Pyx_TraceLine(6237,0,__PYX_ERR(0, 6237, __pyx_L1_error))
     __pyx_t_17 = 0;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_origin.shape[0];
     __pyx_t_27 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_17 * __pyx_v_origin.strides[0]) )));
     __pyx_t_28 = ((__pyx_v_cell->points[3])->location[0]);
     if (((__pyx_t_27 > __pyx_t_28) != 0)) {
       __pyx_t_26 = __pyx_t_27;
     } else {
       __pyx_t_26 = __pyx_t_28;
     }
     __pyx_v_x1p = __pyx_t_26;
 
-    /* "discretize/_extensions/tree_ext.pyx":6241
+    /* "discretize/_extensions/tree_ext.pyx":6238
  * 
  *             x1p = max(cell.points[3].location[0], origin[0])
  *             y1p = max(cell.points[3].location[1], origin[1])             # <<<<<<<<<<<<<<
  *             if self._dim==3:
  *                 z1m = min(cell.points[0].location[2], xF[2])
  */
-    __Pyx_TraceLine(6241,0,__PYX_ERR(0, 6241, __pyx_L1_error))
+    __Pyx_TraceLine(6238,0,__PYX_ERR(0, 6238, __pyx_L1_error))
     __pyx_t_17 = 1;
     if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_origin.shape[0];
     __pyx_t_26 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_17 * __pyx_v_origin.strides[0]) )));
     __pyx_t_27 = ((__pyx_v_cell->points[3])->location[1]);
     if (((__pyx_t_26 > __pyx_t_27) != 0)) {
       __pyx_t_28 = __pyx_t_26;
     } else {
       __pyx_t_28 = __pyx_t_27;
     }
     __pyx_v_y1p = __pyx_t_28;
 
-    /* "discretize/_extensions/tree_ext.pyx":6242
+    /* "discretize/_extensions/tree_ext.pyx":6239
  *             x1p = max(cell.points[3].location[0], origin[0])
  *             y1p = max(cell.points[3].location[1], origin[1])
  *             if self._dim==3:             # <<<<<<<<<<<<<<
  *                 z1m = min(cell.points[0].location[2], xF[2])
  *                 z1p = max(cell.points[7].location[2], origin[2])
  */
-    __Pyx_TraceLine(6242,0,__PYX_ERR(0, 6242, __pyx_L1_error))
+    __Pyx_TraceLine(6239,0,__PYX_ERR(0, 6239, __pyx_L1_error))
     __pyx_t_12 = ((__pyx_v_self->_dim == 3) != 0);
     if (__pyx_t_12) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6243
+      /* "discretize/_extensions/tree_ext.pyx":6240
  *             y1p = max(cell.points[3].location[1], origin[1])
  *             if self._dim==3:
  *                 z1m = min(cell.points[0].location[2], xF[2])             # <<<<<<<<<<<<<<
  *                 z1p = max(cell.points[7].location[2], origin[2])
  *             overlapping_cell_inds = meshin.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)
  */
-      __Pyx_TraceLine(6243,0,__PYX_ERR(0, 6243, __pyx_L1_error))
+      __Pyx_TraceLine(6240,0,__PYX_ERR(0, 6240, __pyx_L1_error))
       __pyx_t_17 = 2;
       if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_xF.shape[0];
       __pyx_t_28 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_17 * __pyx_v_xF.strides[0]) )));
       __pyx_t_26 = ((__pyx_v_cell->points[0])->location[2]);
       if (((__pyx_t_28 < __pyx_t_26) != 0)) {
         __pyx_t_27 = __pyx_t_28;
       } else {
         __pyx_t_27 = __pyx_t_26;
       }
       __pyx_v_z1m = __pyx_t_27;
 
-      /* "discretize/_extensions/tree_ext.pyx":6244
+      /* "discretize/_extensions/tree_ext.pyx":6241
  *             if self._dim==3:
  *                 z1m = min(cell.points[0].location[2], xF[2])
  *                 z1p = max(cell.points[7].location[2], origin[2])             # <<<<<<<<<<<<<<
  *             overlapping_cell_inds = meshin.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)
  *             n_overlap = overlapping_cell_inds.size()
  */
-      __Pyx_TraceLine(6244,0,__PYX_ERR(0, 6244, __pyx_L1_error))
+      __Pyx_TraceLine(6241,0,__PYX_ERR(0, 6241, __pyx_L1_error))
       __pyx_t_17 = 2;
       if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_origin.shape[0];
       __pyx_t_27 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_17 * __pyx_v_origin.strides[0]) )));
       __pyx_t_28 = ((__pyx_v_cell->points[7])->location[2]);
       if (((__pyx_t_27 > __pyx_t_28) != 0)) {
         __pyx_t_26 = __pyx_t_27;
       } else {
         __pyx_t_26 = __pyx_t_28;
       }
       __pyx_v_z1p = __pyx_t_26;
 
-      /* "discretize/_extensions/tree_ext.pyx":6242
+      /* "discretize/_extensions/tree_ext.pyx":6239
  *             x1p = max(cell.points[3].location[0], origin[0])
  *             y1p = max(cell.points[3].location[1], origin[1])
  *             if self._dim==3:             # <<<<<<<<<<<<<<
  *                 z1m = min(cell.points[0].location[2], xF[2])
  *                 z1p = max(cell.points[7].location[2], origin[2])
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6245
+    /* "discretize/_extensions/tree_ext.pyx":6242
  *                 z1m = min(cell.points[0].location[2], xF[2])
  *                 z1p = max(cell.points[7].location[2], origin[2])
  *             overlapping_cell_inds = meshin.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)             # <<<<<<<<<<<<<<
  *             n_overlap = overlapping_cell_inds.size()
  *             weights = <double *> malloc(n_overlap*sizeof(double))
  */
-    __Pyx_TraceLine(6245,0,__PYX_ERR(0, 6245, __pyx_L1_error))
+    __Pyx_TraceLine(6242,0,__PYX_ERR(0, 6242, __pyx_L1_error))
     __pyx_v_overlapping_cell_inds = __pyx_v_meshin->tree->find_overlapping_cells(__pyx_v_x1m, __pyx_v_x1p, __pyx_v_y1m, __pyx_v_y1p, __pyx_v_z1m, __pyx_v_z1p);
 
-    /* "discretize/_extensions/tree_ext.pyx":6246
+    /* "discretize/_extensions/tree_ext.pyx":6243
  *                 z1p = max(cell.points[7].location[2], origin[2])
  *             overlapping_cell_inds = meshin.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)
  *             n_overlap = overlapping_cell_inds.size()             # <<<<<<<<<<<<<<
  *             weights = <double *> malloc(n_overlap*sizeof(double))
  *             i = 0
  */
-    __Pyx_TraceLine(6246,0,__PYX_ERR(0, 6246, __pyx_L1_error))
+    __Pyx_TraceLine(6243,0,__PYX_ERR(0, 6243, __pyx_L1_error))
     __pyx_v_n_overlap = __pyx_v_overlapping_cell_inds.size();
 
-    /* "discretize/_extensions/tree_ext.pyx":6247
+    /* "discretize/_extensions/tree_ext.pyx":6244
  *             overlapping_cell_inds = meshin.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)
  *             n_overlap = overlapping_cell_inds.size()
  *             weights = <double *> malloc(n_overlap*sizeof(double))             # <<<<<<<<<<<<<<
  *             i = 0
  *             weight_sum = 0.0
  */
-    __Pyx_TraceLine(6247,0,__PYX_ERR(0, 6247, __pyx_L1_error))
+    __Pyx_TraceLine(6244,0,__PYX_ERR(0, 6244, __pyx_L1_error))
     __pyx_v_weights = ((double *)malloc((__pyx_v_n_overlap * (sizeof(double)))));
 
-    /* "discretize/_extensions/tree_ext.pyx":6248
+    /* "discretize/_extensions/tree_ext.pyx":6245
  *             n_overlap = overlapping_cell_inds.size()
  *             weights = <double *> malloc(n_overlap*sizeof(double))
  *             i = 0             # <<<<<<<<<<<<<<
  *             weight_sum = 0.0
  *             nnz_row = 0
  */
-    __Pyx_TraceLine(6248,0,__PYX_ERR(0, 6248, __pyx_L1_error))
+    __Pyx_TraceLine(6245,0,__PYX_ERR(0, 6245, __pyx_L1_error))
     __pyx_v_i = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6249
+    /* "discretize/_extensions/tree_ext.pyx":6246
  *             weights = <double *> malloc(n_overlap*sizeof(double))
  *             i = 0
  *             weight_sum = 0.0             # <<<<<<<<<<<<<<
  *             nnz_row = 0
  *             for in_cell_ind in overlapping_cell_inds:
  */
-    __Pyx_TraceLine(6249,0,__PYX_ERR(0, 6249, __pyx_L1_error))
+    __Pyx_TraceLine(6246,0,__PYX_ERR(0, 6246, __pyx_L1_error))
     __pyx_v_weight_sum = 0.0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6250
+    /* "discretize/_extensions/tree_ext.pyx":6247
  *             i = 0
  *             weight_sum = 0.0
  *             nnz_row = 0             # <<<<<<<<<<<<<<
  *             for in_cell_ind in overlapping_cell_inds:
  *                 in_cell = meshin.tree.cells[in_cell_ind]
  */
-    __Pyx_TraceLine(6250,0,__PYX_ERR(0, 6250, __pyx_L1_error))
+    __Pyx_TraceLine(6247,0,__PYX_ERR(0, 6247, __pyx_L1_error))
     __pyx_v_nnz_row = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6251
+    /* "discretize/_extensions/tree_ext.pyx":6248
  *             weight_sum = 0.0
  *             nnz_row = 0
  *             for in_cell_ind in overlapping_cell_inds:             # <<<<<<<<<<<<<<
  *                 in_cell = meshin.tree.cells[in_cell_ind]
  *                 x2m = in_cell.points[0].location[0]
  */
-    __Pyx_TraceLine(6251,0,__PYX_ERR(0, 6251, __pyx_L1_error))
+    __Pyx_TraceLine(6248,0,__PYX_ERR(0, 6248, __pyx_L1_error))
     __pyx_t_29 = __pyx_v_overlapping_cell_inds.begin();
     for (;;) {
       if (!(__pyx_t_29 != __pyx_v_overlapping_cell_inds.end())) break;
       __pyx_t_4 = *__pyx_t_29;
       ++__pyx_t_29;
       __pyx_v_in_cell_ind = __pyx_t_4;
 
-      /* "discretize/_extensions/tree_ext.pyx":6252
+      /* "discretize/_extensions/tree_ext.pyx":6249
  *             nnz_row = 0
  *             for in_cell_ind in overlapping_cell_inds:
  *                 in_cell = meshin.tree.cells[in_cell_ind]             # <<<<<<<<<<<<<<
  *                 x2m = in_cell.points[0].location[0]
  *                 y2m = in_cell.points[0].location[1]
  */
-      __Pyx_TraceLine(6252,0,__PYX_ERR(0, 6252, __pyx_L1_error))
+      __Pyx_TraceLine(6249,0,__PYX_ERR(0, 6249, __pyx_L1_error))
       __pyx_v_in_cell = (__pyx_v_meshin->tree->cells[__pyx_v_in_cell_ind]);
 
-      /* "discretize/_extensions/tree_ext.pyx":6253
+      /* "discretize/_extensions/tree_ext.pyx":6250
  *             for in_cell_ind in overlapping_cell_inds:
  *                 in_cell = meshin.tree.cells[in_cell_ind]
  *                 x2m = in_cell.points[0].location[0]             # <<<<<<<<<<<<<<
  *                 y2m = in_cell.points[0].location[1]
  *                 z2m = in_cell.points[0].location[2]
  */
-      __Pyx_TraceLine(6253,0,__PYX_ERR(0, 6253, __pyx_L1_error))
+      __Pyx_TraceLine(6250,0,__PYX_ERR(0, 6250, __pyx_L1_error))
       __pyx_v_x2m = ((__pyx_v_in_cell->points[0])->location[0]);
 
-      /* "discretize/_extensions/tree_ext.pyx":6254
+      /* "discretize/_extensions/tree_ext.pyx":6251
  *                 in_cell = meshin.tree.cells[in_cell_ind]
  *                 x2m = in_cell.points[0].location[0]
  *                 y2m = in_cell.points[0].location[1]             # <<<<<<<<<<<<<<
  *                 z2m = in_cell.points[0].location[2]
  *                 x2p = in_cell.points[3].location[0]
  */
-      __Pyx_TraceLine(6254,0,__PYX_ERR(0, 6254, __pyx_L1_error))
+      __Pyx_TraceLine(6251,0,__PYX_ERR(0, 6251, __pyx_L1_error))
       __pyx_v_y2m = ((__pyx_v_in_cell->points[0])->location[1]);
 
-      /* "discretize/_extensions/tree_ext.pyx":6255
+      /* "discretize/_extensions/tree_ext.pyx":6252
  *                 x2m = in_cell.points[0].location[0]
  *                 y2m = in_cell.points[0].location[1]
  *                 z2m = in_cell.points[0].location[2]             # <<<<<<<<<<<<<<
  *                 x2p = in_cell.points[3].location[0]
  *                 y2p = in_cell.points[3].location[1]
  */
-      __Pyx_TraceLine(6255,0,__PYX_ERR(0, 6255, __pyx_L1_error))
+      __Pyx_TraceLine(6252,0,__PYX_ERR(0, 6252, __pyx_L1_error))
       __pyx_v_z2m = ((__pyx_v_in_cell->points[0])->location[2]);
 
-      /* "discretize/_extensions/tree_ext.pyx":6256
+      /* "discretize/_extensions/tree_ext.pyx":6253
  *                 y2m = in_cell.points[0].location[1]
  *                 z2m = in_cell.points[0].location[2]
  *                 x2p = in_cell.points[3].location[0]             # <<<<<<<<<<<<<<
  *                 y2p = in_cell.points[3].location[1]
  *                 z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0
  */
-      __Pyx_TraceLine(6256,0,__PYX_ERR(0, 6256, __pyx_L1_error))
+      __Pyx_TraceLine(6253,0,__PYX_ERR(0, 6253, __pyx_L1_error))
       __pyx_v_x2p = ((__pyx_v_in_cell->points[3])->location[0]);
 
-      /* "discretize/_extensions/tree_ext.pyx":6257
+      /* "discretize/_extensions/tree_ext.pyx":6254
  *                 z2m = in_cell.points[0].location[2]
  *                 x2p = in_cell.points[3].location[0]
  *                 y2p = in_cell.points[3].location[1]             # <<<<<<<<<<<<<<
  *                 z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0
  * 
  */
-      __Pyx_TraceLine(6257,0,__PYX_ERR(0, 6257, __pyx_L1_error))
+      __Pyx_TraceLine(6254,0,__PYX_ERR(0, 6254, __pyx_L1_error))
       __pyx_v_y2p = ((__pyx_v_in_cell->points[3])->location[1]);
 
-      /* "discretize/_extensions/tree_ext.pyx":6258
+      /* "discretize/_extensions/tree_ext.pyx":6255
  *                 x2p = in_cell.points[3].location[0]
  *                 y2p = in_cell.points[3].location[1]
  *                 z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0             # <<<<<<<<<<<<<<
  * 
  *                 if x1m == xF[0] or x1p == origin[0]:
  */
-      __Pyx_TraceLine(6258,0,__PYX_ERR(0, 6258, __pyx_L1_error))
+      __Pyx_TraceLine(6255,0,__PYX_ERR(0, 6255, __pyx_L1_error))
       if (((__pyx_v_self->_dim == 3) != 0)) {
         __pyx_t_26 = ((__pyx_v_in_cell->points[7])->location[2]);
       } else {
         __pyx_t_26 = 0.0;
       }
       __pyx_v_z2p = __pyx_t_26;
 
-      /* "discretize/_extensions/tree_ext.pyx":6260
+      /* "discretize/_extensions/tree_ext.pyx":6257
  *                 z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0
  * 
  *                 if x1m == xF[0] or x1p == origin[0]:             # <<<<<<<<<<<<<<
  *                     over_lap_vol = 1.0
  *                 else:
  */
-      __Pyx_TraceLine(6260,0,__PYX_ERR(0, 6260, __pyx_L1_error))
+      __Pyx_TraceLine(6257,0,__PYX_ERR(0, 6257, __pyx_L1_error))
       __pyx_t_17 = 0;
       if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_xF.shape[0];
       __pyx_t_15 = ((__pyx_v_x1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_17 * __pyx_v_xF.strides[0]) )))) != 0);
       if (!__pyx_t_15) {
       } else {
         __pyx_t_12 = __pyx_t_15;
         goto __pyx_L40_bool_binop_done;
@@ -79422,42 +79434,42 @@
       __pyx_t_17 = 0;
       if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_origin.shape[0];
       __pyx_t_15 = ((__pyx_v_x1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_17 * __pyx_v_origin.strides[0]) )))) != 0);
       __pyx_t_12 = __pyx_t_15;
       __pyx_L40_bool_binop_done:;
       if (__pyx_t_12) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6261
+        /* "discretize/_extensions/tree_ext.pyx":6258
  * 
  *                 if x1m == xF[0] or x1p == origin[0]:
  *                     over_lap_vol = 1.0             # <<<<<<<<<<<<<<
  *                 else:
  *                     over_lap_vol = min(x1p, x2p) - max(x1m, x2m)
  */
-        __Pyx_TraceLine(6261,0,__PYX_ERR(0, 6261, __pyx_L1_error))
+        __Pyx_TraceLine(6258,0,__PYX_ERR(0, 6258, __pyx_L1_error))
         __pyx_v_over_lap_vol = 1.0;
 
-        /* "discretize/_extensions/tree_ext.pyx":6260
+        /* "discretize/_extensions/tree_ext.pyx":6257
  *                 z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0
  * 
  *                 if x1m == xF[0] or x1p == origin[0]:             # <<<<<<<<<<<<<<
  *                     over_lap_vol = 1.0
  *                 else:
  */
         goto __pyx_L39;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6263
+      /* "discretize/_extensions/tree_ext.pyx":6260
  *                     over_lap_vol = 1.0
  *                 else:
  *                     over_lap_vol = min(x1p, x2p) - max(x1m, x2m)             # <<<<<<<<<<<<<<
  *                 if y1m == xF[1] or y1p == origin[1]:
  *                     over_lap_vol *= 1.0
  */
-      __Pyx_TraceLine(6263,0,__PYX_ERR(0, 6263, __pyx_L1_error))
+      __Pyx_TraceLine(6260,0,__PYX_ERR(0, 6260, __pyx_L1_error))
       /*else*/ {
         __pyx_t_26 = __pyx_v_x2p;
         __pyx_t_27 = __pyx_v_x1p;
         if (((__pyx_t_26 < __pyx_t_27) != 0)) {
           __pyx_t_28 = __pyx_t_26;
         } else {
           __pyx_t_28 = __pyx_t_27;
@@ -79469,22 +79481,22 @@
         } else {
           __pyx_t_30 = __pyx_t_27;
         }
         __pyx_v_over_lap_vol = (__pyx_t_28 - __pyx_t_30);
       }
       __pyx_L39:;
 
-      /* "discretize/_extensions/tree_ext.pyx":6264
+      /* "discretize/_extensions/tree_ext.pyx":6261
  *                 else:
  *                     over_lap_vol = min(x1p, x2p) - max(x1m, x2m)
  *                 if y1m == xF[1] or y1p == origin[1]:             # <<<<<<<<<<<<<<
  *                     over_lap_vol *= 1.0
  *                 else:
  */
-      __Pyx_TraceLine(6264,0,__PYX_ERR(0, 6264, __pyx_L1_error))
+      __Pyx_TraceLine(6261,0,__PYX_ERR(0, 6261, __pyx_L1_error))
       __pyx_t_17 = 1;
       if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_xF.shape[0];
       __pyx_t_15 = ((__pyx_v_y1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_17 * __pyx_v_xF.strides[0]) )))) != 0);
       if (!__pyx_t_15) {
       } else {
         __pyx_t_12 = __pyx_t_15;
         goto __pyx_L43_bool_binop_done;
@@ -79492,42 +79504,42 @@
       __pyx_t_17 = 1;
       if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_origin.shape[0];
       __pyx_t_15 = ((__pyx_v_y1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_17 * __pyx_v_origin.strides[0]) )))) != 0);
       __pyx_t_12 = __pyx_t_15;
       __pyx_L43_bool_binop_done:;
       if (__pyx_t_12) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6265
+        /* "discretize/_extensions/tree_ext.pyx":6262
  *                     over_lap_vol = min(x1p, x2p) - max(x1m, x2m)
  *                 if y1m == xF[1] or y1p == origin[1]:
  *                     over_lap_vol *= 1.0             # <<<<<<<<<<<<<<
  *                 else:
  *                     over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  */
-        __Pyx_TraceLine(6265,0,__PYX_ERR(0, 6265, __pyx_L1_error))
+        __Pyx_TraceLine(6262,0,__PYX_ERR(0, 6262, __pyx_L1_error))
         __pyx_v_over_lap_vol = (__pyx_v_over_lap_vol * 1.0);
 
-        /* "discretize/_extensions/tree_ext.pyx":6264
+        /* "discretize/_extensions/tree_ext.pyx":6261
  *                 else:
  *                     over_lap_vol = min(x1p, x2p) - max(x1m, x2m)
  *                 if y1m == xF[1] or y1p == origin[1]:             # <<<<<<<<<<<<<<
  *                     over_lap_vol *= 1.0
  *                 else:
  */
         goto __pyx_L42;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6267
+      /* "discretize/_extensions/tree_ext.pyx":6264
  *                     over_lap_vol *= 1.0
  *                 else:
  *                     over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)             # <<<<<<<<<<<<<<
  *                 if self._dim==3:
  *                     if z1m == xF[2] or z1p == origin[2]:
  */
-      __Pyx_TraceLine(6267,0,__PYX_ERR(0, 6267, __pyx_L1_error))
+      __Pyx_TraceLine(6264,0,__PYX_ERR(0, 6264, __pyx_L1_error))
       /*else*/ {
         __pyx_t_30 = __pyx_v_y2p;
         __pyx_t_28 = __pyx_v_y1p;
         if (((__pyx_t_30 < __pyx_t_28) != 0)) {
           __pyx_t_26 = __pyx_t_30;
         } else {
           __pyx_t_26 = __pyx_t_28;
@@ -79539,33 +79551,33 @@
         } else {
           __pyx_t_27 = __pyx_t_28;
         }
         __pyx_v_over_lap_vol = (__pyx_v_over_lap_vol * (__pyx_t_26 - __pyx_t_27));
       }
       __pyx_L42:;
 
-      /* "discretize/_extensions/tree_ext.pyx":6268
+      /* "discretize/_extensions/tree_ext.pyx":6265
  *                 else:
  *                     over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  *                 if self._dim==3:             # <<<<<<<<<<<<<<
  *                     if z1m == xF[2] or z1p == origin[2]:
  *                         over_lap_vol *= 1.0
  */
-      __Pyx_TraceLine(6268,0,__PYX_ERR(0, 6268, __pyx_L1_error))
+      __Pyx_TraceLine(6265,0,__PYX_ERR(0, 6265, __pyx_L1_error))
       __pyx_t_12 = ((__pyx_v_self->_dim == 3) != 0);
       if (__pyx_t_12) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6269
+        /* "discretize/_extensions/tree_ext.pyx":6266
  *                     over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  *                 if self._dim==3:
  *                     if z1m == xF[2] or z1p == origin[2]:             # <<<<<<<<<<<<<<
  *                         over_lap_vol *= 1.0
  *                     else:
  */
-        __Pyx_TraceLine(6269,0,__PYX_ERR(0, 6269, __pyx_L1_error))
+        __Pyx_TraceLine(6266,0,__PYX_ERR(0, 6266, __pyx_L1_error))
         __pyx_t_17 = 2;
         if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_xF.shape[0];
         __pyx_t_15 = ((__pyx_v_z1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_17 * __pyx_v_xF.strides[0]) )))) != 0);
         if (!__pyx_t_15) {
         } else {
           __pyx_t_12 = __pyx_t_15;
           goto __pyx_L47_bool_binop_done;
@@ -79573,42 +79585,42 @@
         __pyx_t_17 = 2;
         if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_origin.shape[0];
         __pyx_t_15 = ((__pyx_v_z1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_17 * __pyx_v_origin.strides[0]) )))) != 0);
         __pyx_t_12 = __pyx_t_15;
         __pyx_L47_bool_binop_done:;
         if (__pyx_t_12) {
 
-          /* "discretize/_extensions/tree_ext.pyx":6270
+          /* "discretize/_extensions/tree_ext.pyx":6267
  *                 if self._dim==3:
  *                     if z1m == xF[2] or z1p == origin[2]:
  *                         over_lap_vol *= 1.0             # <<<<<<<<<<<<<<
  *                     else:
  *                         over_lap_vol *= min(z1p, z2p) - max(z1m, z2m)
  */
-          __Pyx_TraceLine(6270,0,__PYX_ERR(0, 6270, __pyx_L1_error))
+          __Pyx_TraceLine(6267,0,__PYX_ERR(0, 6267, __pyx_L1_error))
           __pyx_v_over_lap_vol = (__pyx_v_over_lap_vol * 1.0);
 
-          /* "discretize/_extensions/tree_ext.pyx":6269
+          /* "discretize/_extensions/tree_ext.pyx":6266
  *                     over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  *                 if self._dim==3:
  *                     if z1m == xF[2] or z1p == origin[2]:             # <<<<<<<<<<<<<<
  *                         over_lap_vol *= 1.0
  *                     else:
  */
           goto __pyx_L46;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6272
+        /* "discretize/_extensions/tree_ext.pyx":6269
  *                         over_lap_vol *= 1.0
  *                     else:
  *                         over_lap_vol *= min(z1p, z2p) - max(z1m, z2m)             # <<<<<<<<<<<<<<
  * 
  *                 weights[i] = over_lap_vol
  */
-        __Pyx_TraceLine(6272,0,__PYX_ERR(0, 6272, __pyx_L1_error))
+        __Pyx_TraceLine(6269,0,__PYX_ERR(0, 6269, __pyx_L1_error))
         /*else*/ {
           __pyx_t_27 = __pyx_v_z2p;
           __pyx_t_26 = __pyx_v_z1p;
           if (((__pyx_t_27 < __pyx_t_26) != 0)) {
             __pyx_t_30 = __pyx_t_27;
           } else {
             __pyx_t_30 = __pyx_t_26;
@@ -79620,386 +79632,386 @@
           } else {
             __pyx_t_28 = __pyx_t_26;
           }
           __pyx_v_over_lap_vol = (__pyx_v_over_lap_vol * (__pyx_t_30 - __pyx_t_28));
         }
         __pyx_L46:;
 
-        /* "discretize/_extensions/tree_ext.pyx":6268
+        /* "discretize/_extensions/tree_ext.pyx":6265
  *                 else:
  *                     over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  *                 if self._dim==3:             # <<<<<<<<<<<<<<
  *                     if z1m == xF[2] or z1p == origin[2]:
  *                         over_lap_vol *= 1.0
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6274
+      /* "discretize/_extensions/tree_ext.pyx":6271
  *                         over_lap_vol *= min(z1p, z2p) - max(z1m, z2m)
  * 
  *                 weights[i] = over_lap_vol             # <<<<<<<<<<<<<<
  *                 if build_mat and weights[i] != 0.0:
  *                     nnz_row += 1
  */
-      __Pyx_TraceLine(6274,0,__PYX_ERR(0, 6274, __pyx_L1_error))
+      __Pyx_TraceLine(6271,0,__PYX_ERR(0, 6271, __pyx_L1_error))
       (__pyx_v_weights[__pyx_v_i]) = __pyx_v_over_lap_vol;
 
-      /* "discretize/_extensions/tree_ext.pyx":6275
+      /* "discretize/_extensions/tree_ext.pyx":6272
  * 
  *                 weights[i] = over_lap_vol
  *                 if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                     nnz_row += 1
  *                     row_inds.push_back(in_cell_ind)
  */
-      __Pyx_TraceLine(6275,0,__PYX_ERR(0, 6275, __pyx_L1_error))
+      __Pyx_TraceLine(6272,0,__PYX_ERR(0, 6272, __pyx_L1_error))
       __pyx_t_15 = (__pyx_v_build_mat != 0);
       if (__pyx_t_15) {
       } else {
         __pyx_t_12 = __pyx_t_15;
         goto __pyx_L50_bool_binop_done;
       }
       __pyx_t_15 = (((__pyx_v_weights[__pyx_v_i]) != 0.0) != 0);
       __pyx_t_12 = __pyx_t_15;
       __pyx_L50_bool_binop_done:;
       if (__pyx_t_12) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6276
+        /* "discretize/_extensions/tree_ext.pyx":6273
  *                 weights[i] = over_lap_vol
  *                 if build_mat and weights[i] != 0.0:
  *                     nnz_row += 1             # <<<<<<<<<<<<<<
  *                     row_inds.push_back(in_cell_ind)
  * 
  */
-        __Pyx_TraceLine(6276,0,__PYX_ERR(0, 6276, __pyx_L1_error))
+        __Pyx_TraceLine(6273,0,__PYX_ERR(0, 6273, __pyx_L1_error))
         __pyx_v_nnz_row = (__pyx_v_nnz_row + 1);
 
-        /* "discretize/_extensions/tree_ext.pyx":6277
+        /* "discretize/_extensions/tree_ext.pyx":6274
  *                 if build_mat and weights[i] != 0.0:
  *                     nnz_row += 1
  *                     row_inds.push_back(in_cell_ind)             # <<<<<<<<<<<<<<
  * 
  *                 weight_sum += weights[i]
  */
-        __Pyx_TraceLine(6277,0,__PYX_ERR(0, 6277, __pyx_L1_error))
+        __Pyx_TraceLine(6274,0,__PYX_ERR(0, 6274, __pyx_L1_error))
         try {
           __pyx_v_row_inds.push_back(__pyx_v_in_cell_ind);
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 6277, __pyx_L1_error)
+          __PYX_ERR(0, 6274, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6275
+        /* "discretize/_extensions/tree_ext.pyx":6272
  * 
  *                 weights[i] = over_lap_vol
  *                 if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                     nnz_row += 1
  *                     row_inds.push_back(in_cell_ind)
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6279
+      /* "discretize/_extensions/tree_ext.pyx":6276
  *                     row_inds.push_back(in_cell_ind)
  * 
  *                 weight_sum += weights[i]             # <<<<<<<<<<<<<<
  *                 i += 1
  *             for i in range(n_overlap):
  */
-      __Pyx_TraceLine(6279,0,__PYX_ERR(0, 6279, __pyx_L1_error))
+      __Pyx_TraceLine(6276,0,__PYX_ERR(0, 6276, __pyx_L1_error))
       __pyx_v_weight_sum = (__pyx_v_weight_sum + (__pyx_v_weights[__pyx_v_i]));
 
-      /* "discretize/_extensions/tree_ext.pyx":6280
+      /* "discretize/_extensions/tree_ext.pyx":6277
  * 
  *                 weight_sum += weights[i]
  *                 i += 1             # <<<<<<<<<<<<<<
  *             for i in range(n_overlap):
  *                 weights[i] /= weight_sum
  */
-      __Pyx_TraceLine(6280,0,__PYX_ERR(0, 6280, __pyx_L1_error))
+      __Pyx_TraceLine(6277,0,__PYX_ERR(0, 6277, __pyx_L1_error))
       __pyx_v_i = (__pyx_v_i + 1);
 
-      /* "discretize/_extensions/tree_ext.pyx":6251
+      /* "discretize/_extensions/tree_ext.pyx":6248
  *             weight_sum = 0.0
  *             nnz_row = 0
  *             for in_cell_ind in overlapping_cell_inds:             # <<<<<<<<<<<<<<
  *                 in_cell = meshin.tree.cells[in_cell_ind]
  *                 x2m = in_cell.points[0].location[0]
  */
-      __Pyx_TraceLine(6251,0,__PYX_ERR(0, 6251, __pyx_L1_error))
+      __Pyx_TraceLine(6248,0,__PYX_ERR(0, 6248, __pyx_L1_error))
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6281
+    /* "discretize/_extensions/tree_ext.pyx":6278
  *                 weight_sum += weights[i]
  *                 i += 1
  *             for i in range(n_overlap):             # <<<<<<<<<<<<<<
  *                 weights[i] /= weight_sum
  *                 if build_mat and weights[i] != 0.0:
  */
-    __Pyx_TraceLine(6281,0,__PYX_ERR(0, 6281, __pyx_L1_error))
+    __Pyx_TraceLine(6278,0,__PYX_ERR(0, 6278, __pyx_L1_error))
     __pyx_t_4 = __pyx_v_n_overlap;
     __pyx_t_13 = __pyx_t_4;
     for (__pyx_t_31 = 0; __pyx_t_31 < __pyx_t_13; __pyx_t_31+=1) {
       __pyx_v_i = __pyx_t_31;
 
-      /* "discretize/_extensions/tree_ext.pyx":6282
+      /* "discretize/_extensions/tree_ext.pyx":6279
  *                 i += 1
  *             for i in range(n_overlap):
  *                 weights[i] /= weight_sum             # <<<<<<<<<<<<<<
  *                 if build_mat and weights[i] != 0.0:
  *                     all_weights.push_back(weights[i])
  */
-      __Pyx_TraceLine(6282,0,__PYX_ERR(0, 6282, __pyx_L1_error))
+      __Pyx_TraceLine(6279,0,__PYX_ERR(0, 6279, __pyx_L1_error))
       __pyx_t_32 = __pyx_v_i;
       (__pyx_v_weights[__pyx_t_32]) = ((__pyx_v_weights[__pyx_t_32]) / __pyx_v_weight_sum);
 
-      /* "discretize/_extensions/tree_ext.pyx":6283
+      /* "discretize/_extensions/tree_ext.pyx":6280
  *             for i in range(n_overlap):
  *                 weights[i] /= weight_sum
  *                 if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                     all_weights.push_back(weights[i])
  * 
  */
-      __Pyx_TraceLine(6283,0,__PYX_ERR(0, 6283, __pyx_L1_error))
+      __Pyx_TraceLine(6280,0,__PYX_ERR(0, 6280, __pyx_L1_error))
       __pyx_t_15 = (__pyx_v_build_mat != 0);
       if (__pyx_t_15) {
       } else {
         __pyx_t_12 = __pyx_t_15;
         goto __pyx_L55_bool_binop_done;
       }
       __pyx_t_15 = (((__pyx_v_weights[__pyx_v_i]) != 0.0) != 0);
       __pyx_t_12 = __pyx_t_15;
       __pyx_L55_bool_binop_done:;
       if (__pyx_t_12) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6284
+        /* "discretize/_extensions/tree_ext.pyx":6281
  *                 weights[i] /= weight_sum
  *                 if build_mat and weights[i] != 0.0:
  *                     all_weights.push_back(weights[i])             # <<<<<<<<<<<<<<
  * 
  *             if not build_mat:
  */
-        __Pyx_TraceLine(6284,0,__PYX_ERR(0, 6284, __pyx_L1_error))
+        __Pyx_TraceLine(6281,0,__PYX_ERR(0, 6281, __pyx_L1_error))
         try {
           __pyx_v_all_weights.push_back((__pyx_v_weights[__pyx_v_i]));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 6284, __pyx_L1_error)
+          __PYX_ERR(0, 6281, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6283
+        /* "discretize/_extensions/tree_ext.pyx":6280
  *             for i in range(n_overlap):
  *                 weights[i] /= weight_sum
  *                 if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                     all_weights.push_back(weights[i])
  * 
  */
       }
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6286
+    /* "discretize/_extensions/tree_ext.pyx":6283
  *                     all_weights.push_back(weights[i])
  * 
  *             if not build_mat:             # <<<<<<<<<<<<<<
  *                 for i in range(n_overlap):
  *                     outs[cell.index] += vals[overlapping_cell_inds[i]]*weights[i]
  */
-    __Pyx_TraceLine(6286,0,__PYX_ERR(0, 6286, __pyx_L1_error))
+    __Pyx_TraceLine(6283,0,__PYX_ERR(0, 6283, __pyx_L1_error))
     __pyx_t_12 = ((!(__pyx_v_build_mat != 0)) != 0);
     if (__pyx_t_12) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6287
+      /* "discretize/_extensions/tree_ext.pyx":6284
  * 
  *             if not build_mat:
  *                 for i in range(n_overlap):             # <<<<<<<<<<<<<<
  *                     outs[cell.index] += vals[overlapping_cell_inds[i]]*weights[i]
  *             else:
  */
-      __Pyx_TraceLine(6287,0,__PYX_ERR(0, 6287, __pyx_L1_error))
+      __Pyx_TraceLine(6284,0,__PYX_ERR(0, 6284, __pyx_L1_error))
       __pyx_t_4 = __pyx_v_n_overlap;
       __pyx_t_13 = __pyx_t_4;
       for (__pyx_t_31 = 0; __pyx_t_31 < __pyx_t_13; __pyx_t_31+=1) {
         __pyx_v_i = __pyx_t_31;
 
-        /* "discretize/_extensions/tree_ext.pyx":6288
+        /* "discretize/_extensions/tree_ext.pyx":6285
  *             if not build_mat:
  *                 for i in range(n_overlap):
  *                     outs[cell.index] += vals[overlapping_cell_inds[i]]*weights[i]             # <<<<<<<<<<<<<<
  *             else:
  *                 nnz_counter += nnz_row
  */
-        __Pyx_TraceLine(6288,0,__PYX_ERR(0, 6288, __pyx_L1_error))
+        __Pyx_TraceLine(6285,0,__PYX_ERR(0, 6285, __pyx_L1_error))
         __pyx_t_17 = (__pyx_v_overlapping_cell_inds[__pyx_v_i]);
         if (__pyx_t_17 < 0) __pyx_t_17 += __pyx_v_vals.shape[0];
         __pyx_t_23 = __pyx_v_cell->index;
         if (__pyx_t_23 < 0) __pyx_t_23 += __pyx_v_outs.shape[0];
         *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_outs.data + __pyx_t_23 * __pyx_v_outs.strides[0]) )) += ((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_vals.data + __pyx_t_17 * __pyx_v_vals.strides[0]) ))) * (__pyx_v_weights[__pyx_v_i]));
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6286
+      /* "discretize/_extensions/tree_ext.pyx":6283
  *                     all_weights.push_back(weights[i])
  * 
  *             if not build_mat:             # <<<<<<<<<<<<<<
  *                 for i in range(n_overlap):
  *                     outs[cell.index] += vals[overlapping_cell_inds[i]]*weights[i]
  */
       goto __pyx_L57;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6290
+    /* "discretize/_extensions/tree_ext.pyx":6287
  *                     outs[cell.index] += vals[overlapping_cell_inds[i]]*weights[i]
  *             else:
  *                 nnz_counter += nnz_row             # <<<<<<<<<<<<<<
  *                 indptr.push_back(nnz_counter)
  * 
  */
-    __Pyx_TraceLine(6290,0,__PYX_ERR(0, 6290, __pyx_L1_error))
+    __Pyx_TraceLine(6287,0,__PYX_ERR(0, 6287, __pyx_L1_error))
     /*else*/ {
       __pyx_v_nnz_counter = (__pyx_v_nnz_counter + __pyx_v_nnz_row);
 
-      /* "discretize/_extensions/tree_ext.pyx":6291
+      /* "discretize/_extensions/tree_ext.pyx":6288
  *             else:
  *                 nnz_counter += nnz_row
  *                 indptr.push_back(nnz_counter)             # <<<<<<<<<<<<<<
  * 
  *             free(weights)
  */
-      __Pyx_TraceLine(6291,0,__PYX_ERR(0, 6291, __pyx_L1_error))
+      __Pyx_TraceLine(6288,0,__PYX_ERR(0, 6288, __pyx_L1_error))
       try {
         __pyx_v_indptr.push_back(__pyx_v_nnz_counter);
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 6291, __pyx_L1_error)
+        __PYX_ERR(0, 6288, __pyx_L1_error)
       }
     }
     __pyx_L57:;
 
-    /* "discretize/_extensions/tree_ext.pyx":6293
+    /* "discretize/_extensions/tree_ext.pyx":6290
  *                 indptr.push_back(nnz_counter)
  * 
  *             free(weights)             # <<<<<<<<<<<<<<
  *             overlapping_cell_inds.clear()
  * 
  */
-    __Pyx_TraceLine(6293,0,__PYX_ERR(0, 6293, __pyx_L1_error))
+    __Pyx_TraceLine(6290,0,__PYX_ERR(0, 6290, __pyx_L1_error))
     free(__pyx_v_weights);
 
-    /* "discretize/_extensions/tree_ext.pyx":6294
+    /* "discretize/_extensions/tree_ext.pyx":6291
  * 
  *             free(weights)
  *             overlapping_cell_inds.clear()             # <<<<<<<<<<<<<<
  * 
  *         if not build_mat:
  */
-    __Pyx_TraceLine(6294,0,__PYX_ERR(0, 6294, __pyx_L1_error))
+    __Pyx_TraceLine(6291,0,__PYX_ERR(0, 6291, __pyx_L1_error))
     __pyx_v_overlapping_cell_inds.clear();
 
-    /* "discretize/_extensions/tree_ext.pyx":6236
+    /* "discretize/_extensions/tree_ext.pyx":6233
  *             return P
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             x1m = min(cell.points[0].location[0], xF[0])
  *             y1m = min(cell.points[0].location[1], xF[1])
  */
-    __Pyx_TraceLine(6236,0,__PYX_ERR(0, 6236, __pyx_L1_error))
+    __Pyx_TraceLine(6233,0,__PYX_ERR(0, 6233, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6296
+  /* "discretize/_extensions/tree_ext.pyx":6293
  *             overlapping_cell_inds.clear()
  * 
  *         if not build_mat:             # <<<<<<<<<<<<<<
  *             return output
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, meshin.n_cells))
  */
-  __Pyx_TraceLine(6296,0,__PYX_ERR(0, 6296, __pyx_L1_error))
+  __Pyx_TraceLine(6293,0,__PYX_ERR(0, 6293, __pyx_L1_error))
   __pyx_t_12 = ((!(__pyx_v_build_mat != 0)) != 0);
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6297
+    /* "discretize/_extensions/tree_ext.pyx":6294
  * 
  *         if not build_mat:
  *             return output             # <<<<<<<<<<<<<<
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, meshin.n_cells))
  * 
  */
-    __Pyx_TraceLine(6297,0,__PYX_ERR(0, 6297, __pyx_L1_error))
+    __Pyx_TraceLine(6294,0,__PYX_ERR(0, 6294, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_output);
     __pyx_r = __pyx_v_output;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6296
+    /* "discretize/_extensions/tree_ext.pyx":6293
  *             overlapping_cell_inds.clear()
  * 
  *         if not build_mat:             # <<<<<<<<<<<<<<
  *             return output
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, meshin.n_cells))
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6298
+  /* "discretize/_extensions/tree_ext.pyx":6295
  *         if not build_mat:
  *             return output
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, meshin.n_cells))             # <<<<<<<<<<<<<<
  * 
  *     @cython.boundscheck(False)
  */
-  __Pyx_TraceLine(6298,0,__PYX_ERR(0, 6298, __pyx_L1_error))
+  __Pyx_TraceLine(6295,0,__PYX_ERR(0, 6295, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_sp); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_sp); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_8 = __pyx_convert_vector_to_py_double(__pyx_v_all_weights); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_8 = __pyx_convert_vector_to_py_double(__pyx_v_all_weights); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_7 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_6 = __pyx_convert_vector_to_py_int_t(__pyx_v_indptr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_6 = __pyx_convert_vector_to_py_int_t(__pyx_v_indptr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_GIVEREF(__pyx_t_8);
   PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_9, 2, __pyx_t_6);
   __pyx_t_8 = 0;
   __pyx_t_7 = 0;
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_9);
   PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_9);
   __pyx_t_9 = 0;
-  __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_meshin), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_8);
   PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_8);
   __pyx_t_7 = 0;
   __pyx_t_8 = 0;
-  if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_shape, __pyx_t_5) < 0) __PYX_ERR(0, 6298, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_shape, __pyx_t_5) < 0) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_6, __pyx_t_9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6298, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_6, __pyx_t_9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6295, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6124
+  /* "discretize/_extensions/tree_ext.pyx":6121
  *     @cython.boundscheck(False)
  *     @cython.cdivision(True)
  *     def _vol_avg_from_tree(self, _TreeMesh meshin, values=None, output=None):             # <<<<<<<<<<<<<<
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  */
 
@@ -80025,15 +80037,15 @@
   __Pyx_XDECREF(__pyx_v_output);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6302
+/* "discretize/_extensions/tree_ext.pyx":6299
  *     @cython.boundscheck(False)
  *     @cython.cdivision(True)
  *     def _vol_avg_to_tens(self, out_tens_mesh, values=None, output=None):             # <<<<<<<<<<<<<<
  *         cdef vector[int_t] *overlapping_cells
  *         cdef double *weights
  */
 
@@ -80083,15 +80095,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_output);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_vol_avg_to_tens") < 0)) __PYX_ERR(0, 6302, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_vol_avg_to_tens") < 0)) __PYX_ERR(0, 6299, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -80102,15 +80114,15 @@
     }
     __pyx_v_out_tens_mesh = values[0];
     __pyx_v_values = values[1];
     __pyx_v_output = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_vol_avg_to_tens", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 6302, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_vol_avg_to_tens", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 6299, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._vol_avg_to_tens", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_98_vol_avg_to_tens(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_out_tens_mesh, __pyx_v_values, __pyx_v_output);
 
@@ -80202,50 +80214,50 @@
   Py_ssize_t __pyx_t_36;
   Py_ssize_t __pyx_t_37;
   Py_ssize_t __pyx_t_38;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_vol_avg_to_tens", 0);
-  __Pyx_TraceCall("_vol_avg_to_tens", __pyx_f[0], 6302, 0, __PYX_ERR(0, 6302, __pyx_L1_error));
+  __Pyx_TraceCall("_vol_avg_to_tens", __pyx_f[0], 6299, 0, __PYX_ERR(0, 6299, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_output);
 
-  /* "discretize/_extensions/tree_ext.pyx":6313
+  /* "discretize/_extensions/tree_ext.pyx":6310
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, out_tens_mesh.nodes_x)
  */
-  __Pyx_TraceLine(6313,0,__PYX_ERR(0, 6313, __pyx_L1_error))
+  __Pyx_TraceLine(6310,0,__PYX_ERR(0, 6310, __pyx_L1_error))
   {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_t_2);
     __Pyx_XGOTREF(__pyx_t_3);
     /*try:*/ {
 
-      /* "discretize/_extensions/tree_ext.pyx":6315
+      /* "discretize/_extensions/tree_ext.pyx":6312
  *         try:
  *             same_base = (
  *                 np.allclose(self.nodes_x, out_tens_mesh.nodes_x)             # <<<<<<<<<<<<<<
  *                 and np.allclose(self.nodes_y, out_tens_mesh.nodes_y)
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, out_tens_mesh.nodes_z))
  */
-      __Pyx_TraceLine(6315,0,__PYX_ERR(0, 6315, __pyx_L3_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6315, __pyx_L3_error)
+      __Pyx_TraceLine(6312,0,__PYX_ERR(0, 6312, __pyx_L3_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6312, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_allclose); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6315, __pyx_L3_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_allclose); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6312, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_7);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6315, __pyx_L3_error)
+      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6312, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6315, __pyx_L3_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6312, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_9 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
@@ -80254,74 +80266,74 @@
           __Pyx_DECREF_SET(__pyx_t_7, function);
           __pyx_t_10 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_7)) {
         PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_6, __pyx_t_8};
-        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6315, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6312, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
         PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_6, __pyx_t_8};
-        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6315, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6312, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       {
-        __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6315, __pyx_L3_error)
+        __pyx_t_11 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6312, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_11);
         if (__pyx_t_9) {
           __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_6);
         PyTuple_SET_ITEM(__pyx_t_11, 0+__pyx_t_10, __pyx_t_6);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_11, 1+__pyx_t_10, __pyx_t_8);
         __pyx_t_6 = 0;
         __pyx_t_8 = 0;
-        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6315, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_11, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6312, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       }
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6315, __pyx_L3_error)
+      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6312, __pyx_L3_error)
       if (__pyx_t_12) {
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       } else {
-        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6315, __pyx_L3_error)
+        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6312, __pyx_L3_error)
         __pyx_t_4 = __pyx_t_13;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         goto __pyx_L9_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6316
+      /* "discretize/_extensions/tree_ext.pyx":6313
  *             same_base = (
  *                 np.allclose(self.nodes_x, out_tens_mesh.nodes_x)
  *                 and np.allclose(self.nodes_y, out_tens_mesh.nodes_y)             # <<<<<<<<<<<<<<
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, out_tens_mesh.nodes_z))
  *             )
  */
-      __Pyx_TraceLine(6316,0,__PYX_ERR(0, 6316, __pyx_L3_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6316, __pyx_L3_error)
+      __Pyx_TraceLine(6313,0,__PYX_ERR(0, 6313, __pyx_L3_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6313, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_allclose); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6316, __pyx_L3_error)
+      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_allclose); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6313, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6316, __pyx_L3_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6313, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6316, __pyx_L3_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6313, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_6 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
         __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_11);
         if (likely(__pyx_t_6)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -80330,88 +80342,88 @@
           __Pyx_DECREF_SET(__pyx_t_11, function);
           __pyx_t_10 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_11)) {
         PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_7, __pyx_t_8};
-        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6316, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6313, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_11)) {
         PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_7, __pyx_t_8};
-        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6316, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyCFunction_FastCall(__pyx_t_11, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6313, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       {
-        __pyx_t_9 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6316, __pyx_L3_error)
+        __pyx_t_9 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6313, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_9);
         if (__pyx_t_6) {
           __Pyx_GIVEREF(__pyx_t_6); PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6); __pyx_t_6 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_7);
         PyTuple_SET_ITEM(__pyx_t_9, 0+__pyx_t_10, __pyx_t_7);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_9, 1+__pyx_t_10, __pyx_t_8);
         __pyx_t_7 = 0;
         __pyx_t_8 = 0;
-        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_9, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6316, __pyx_L3_error)
+        __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_9, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6313, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_5);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       }
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6316, __pyx_L3_error)
+      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6313, __pyx_L3_error)
       if (__pyx_t_12) {
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       } else {
-        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6316, __pyx_L3_error)
+        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_5); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6313, __pyx_L3_error)
         __pyx_t_4 = __pyx_t_13;
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         goto __pyx_L9_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6317
+      /* "discretize/_extensions/tree_ext.pyx":6314
  *                 np.allclose(self.nodes_x, out_tens_mesh.nodes_x)
  *                 and np.allclose(self.nodes_y, out_tens_mesh.nodes_y)
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, out_tens_mesh.nodes_z))             # <<<<<<<<<<<<<<
  *             )
  *         except ValueError:
  */
-      __Pyx_TraceLine(6317,0,__PYX_ERR(0, 6317, __pyx_L3_error))
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6317, __pyx_L3_error)
+      __Pyx_TraceLine(6314,0,__PYX_ERR(0, 6314, __pyx_L3_error))
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6314, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_11 = __Pyx_PyInt_EqObjC(__pyx_t_5, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6317, __pyx_L3_error)
+      __pyx_t_11 = __Pyx_PyInt_EqObjC(__pyx_t_5, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6314, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6317, __pyx_L3_error)
+      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_11); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6314, __pyx_L3_error)
       if (!__pyx_t_12) {
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       } else {
-        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_11); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6317, __pyx_L3_error)
+        __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_11); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6314, __pyx_L3_error)
         __pyx_t_4 = __pyx_t_13;
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         goto __pyx_L9_bool_binop_done;
       }
-      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6317, __pyx_L3_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6314, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_allclose); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6317, __pyx_L3_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_allclose); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6314, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6317, __pyx_L3_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6314, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6317, __pyx_L3_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6314, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_7 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_9);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
@@ -80420,55 +80432,55 @@
           __Pyx_DECREF_SET(__pyx_t_9, function);
           __pyx_t_10 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_9)) {
         PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_5, __pyx_t_8};
-        __pyx_t_11 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6317, __pyx_L3_error)
+        __pyx_t_11 = __Pyx_PyFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6314, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_9)) {
         PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_5, __pyx_t_8};
-        __pyx_t_11 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6317, __pyx_L3_error)
+        __pyx_t_11 = __Pyx_PyCFunction_FastCall(__pyx_t_9, __pyx_temp+1-__pyx_t_10, 2+__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6314, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       } else
       #endif
       {
-        __pyx_t_6 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6317, __pyx_L3_error)
+        __pyx_t_6 = PyTuple_New(2+__pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6314, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_6);
         if (__pyx_t_7) {
           __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_7); __pyx_t_7 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_5);
         PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_10, __pyx_t_5);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_10, __pyx_t_8);
         __pyx_t_5 = 0;
         __pyx_t_8 = 0;
-        __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_6, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6317, __pyx_L3_error)
+        __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_6, NULL); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6314, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       }
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_11); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6317, __pyx_L3_error)
+      __pyx_t_13 = __Pyx_PyInt_As_int_t(__pyx_t_11); if (unlikely((__pyx_t_13 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6314, __pyx_L3_error)
       __pyx_t_4 = __pyx_t_13;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __pyx_L9_bool_binop_done:;
       __pyx_v_same_base = __pyx_t_4;
 
-      /* "discretize/_extensions/tree_ext.pyx":6313
+      /* "discretize/_extensions/tree_ext.pyx":6310
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, out_tens_mesh.nodes_x)
  */
     }
@@ -80480,48 +80492,48 @@
     __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6319
+    /* "discretize/_extensions/tree_ext.pyx":6316
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, out_tens_mesh.nodes_z))
  *             )
  *         except ValueError:             # <<<<<<<<<<<<<<
  *             same_base = False
  * 
  */
-    __Pyx_TraceLine(6319,0,__PYX_ERR(0, 6319, __pyx_L5_except_error))
+    __Pyx_TraceLine(6316,0,__PYX_ERR(0, 6316, __pyx_L5_except_error))
     __pyx_t_10 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ValueError);
     if (__pyx_t_10) {
       __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._vol_avg_to_tens", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_11, &__pyx_t_9, &__pyx_t_6) < 0) __PYX_ERR(0, 6319, __pyx_L5_except_error)
+      if (__Pyx_GetException(&__pyx_t_11, &__pyx_t_9, &__pyx_t_6) < 0) __PYX_ERR(0, 6316, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_GOTREF(__pyx_t_6);
 
-      /* "discretize/_extensions/tree_ext.pyx":6320
+      /* "discretize/_extensions/tree_ext.pyx":6317
  *             )
  *         except ValueError:
  *             same_base = False             # <<<<<<<<<<<<<<
  * 
  *         if same_base:
  */
-      __Pyx_TraceLine(6320,0,__PYX_ERR(0, 6320, __pyx_L5_except_error))
+      __Pyx_TraceLine(6317,0,__PYX_ERR(0, 6317, __pyx_L5_except_error))
       __pyx_v_same_base = 0;
       __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
       goto __pyx_L4_exception_handled;
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "discretize/_extensions/tree_ext.pyx":6313
+    /* "discretize/_extensions/tree_ext.pyx":6310
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, out_tens_mesh.nodes_x)
  */
     __Pyx_XGIVEREF(__pyx_t_1);
@@ -80533,383 +80545,383 @@
     __Pyx_XGIVEREF(__pyx_t_1);
     __Pyx_XGIVEREF(__pyx_t_2);
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
     __pyx_L8_try_end:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6322
+  /* "discretize/_extensions/tree_ext.pyx":6319
  *             same_base = False
  * 
  *         if same_base:             # <<<<<<<<<<<<<<
  *             in_cell_inds = self._get_containing_cell_indexes(out_tens_mesh.cell_centers)
  *             # Every cell input cell is gauranteed to be a lower level than the output tenser mesh
  */
-  __Pyx_TraceLine(6322,0,__PYX_ERR(0, 6322, __pyx_L1_error))
+  __Pyx_TraceLine(6319,0,__PYX_ERR(0, 6319, __pyx_L1_error))
   __pyx_t_12 = (__pyx_v_same_base != 0);
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6323
+    /* "discretize/_extensions/tree_ext.pyx":6320
  * 
  *         if same_base:
  *             in_cell_inds = self._get_containing_cell_indexes(out_tens_mesh.cell_centers)             # <<<<<<<<<<<<<<
  *             # Every cell input cell is gauranteed to be a lower level than the output tenser mesh
  *             # therefore all weights a 1.0
  */
-    __Pyx_TraceLine(6323,0,__PYX_ERR(0, 6323, __pyx_L1_error))
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_containing_cell_indexes); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6323, __pyx_L1_error)
+    __Pyx_TraceLine(6320,0,__PYX_ERR(0, 6320, __pyx_L1_error))
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_containing_cell_indexes); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6320, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_cell_centers); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6323, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_cell_centers); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6320, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __pyx_t_8 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_9))) {
       __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_9);
       if (likely(__pyx_t_8)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
         __Pyx_INCREF(__pyx_t_8);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_9, function);
       }
     }
     __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_8, __pyx_t_11) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_11);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6323, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6320, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_v_in_cell_inds = __pyx_t_6;
     __pyx_t_6 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6326
+    /* "discretize/_extensions/tree_ext.pyx":6323
  *             # Every cell input cell is gauranteed to be a lower level than the output tenser mesh
  *             # therefore all weights a 1.0
  *             if values is not None:             # <<<<<<<<<<<<<<
  *                 if output is None:
  *                     output = np.empty(out_tens_mesh.n_cells)
  */
-    __Pyx_TraceLine(6326,0,__PYX_ERR(0, 6326, __pyx_L1_error))
+    __Pyx_TraceLine(6323,0,__PYX_ERR(0, 6323, __pyx_L1_error))
     __pyx_t_12 = (__pyx_v_values != Py_None);
     __pyx_t_14 = (__pyx_t_12 != 0);
     if (__pyx_t_14) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6327
+      /* "discretize/_extensions/tree_ext.pyx":6324
  *             # therefore all weights a 1.0
  *             if values is not None:
  *                 if output is None:             # <<<<<<<<<<<<<<
  *                     output = np.empty(out_tens_mesh.n_cells)
  *                 output[:] = values[in_cell_inds]
  */
-      __Pyx_TraceLine(6327,0,__PYX_ERR(0, 6327, __pyx_L1_error))
+      __Pyx_TraceLine(6324,0,__PYX_ERR(0, 6324, __pyx_L1_error))
       __pyx_t_14 = (__pyx_v_output == Py_None);
       __pyx_t_12 = (__pyx_t_14 != 0);
       if (__pyx_t_12) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6328
+        /* "discretize/_extensions/tree_ext.pyx":6325
  *             if values is not None:
  *                 if output is None:
  *                     output = np.empty(out_tens_mesh.n_cells)             # <<<<<<<<<<<<<<
  *                 output[:] = values[in_cell_inds]
  *                 return output
  */
-        __Pyx_TraceLine(6328,0,__PYX_ERR(0, 6328, __pyx_L1_error))
-        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6328, __pyx_L1_error)
+        __Pyx_TraceLine(6325,0,__PYX_ERR(0, 6325, __pyx_L1_error))
+        __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6325, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_empty); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6328, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_empty); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6325, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-        __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6328, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6325, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __pyx_t_8 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
           __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_11);
           if (likely(__pyx_t_8)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
             __Pyx_INCREF(__pyx_t_8);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_11, function);
           }
         }
         __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_11, __pyx_t_8, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_11, __pyx_t_9);
         __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6328, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6325, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         __Pyx_DECREF_SET(__pyx_v_output, __pyx_t_6);
         __pyx_t_6 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":6327
+        /* "discretize/_extensions/tree_ext.pyx":6324
  *             # therefore all weights a 1.0
  *             if values is not None:
  *                 if output is None:             # <<<<<<<<<<<<<<
  *                     output = np.empty(out_tens_mesh.n_cells)
  *                 output[:] = values[in_cell_inds]
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6329
+      /* "discretize/_extensions/tree_ext.pyx":6326
  *                 if output is None:
  *                     output = np.empty(out_tens_mesh.n_cells)
  *                 output[:] = values[in_cell_inds]             # <<<<<<<<<<<<<<
  *                 return output
  *             return sp.csr_matrix(
  */
-      __Pyx_TraceLine(6329,0,__PYX_ERR(0, 6329, __pyx_L1_error))
-      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_values, __pyx_v_in_cell_inds); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6329, __pyx_L1_error)
+      __Pyx_TraceLine(6326,0,__PYX_ERR(0, 6326, __pyx_L1_error))
+      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_values, __pyx_v_in_cell_inds); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6326, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_t_6, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6329, __pyx_L1_error)
+      if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_t_6, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6326, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6330
+      /* "discretize/_extensions/tree_ext.pyx":6327
  *                     output = np.empty(out_tens_mesh.n_cells)
  *                 output[:] = values[in_cell_inds]
  *                 return output             # <<<<<<<<<<<<<<
  *             return sp.csr_matrix(
  *                 (np.ones(out_tens_mesh.n_cells), (np.arange(out_tens_mesh.n_cells), in_cell_inds)),
  */
-      __Pyx_TraceLine(6330,0,__PYX_ERR(0, 6330, __pyx_L1_error))
+      __Pyx_TraceLine(6327,0,__PYX_ERR(0, 6327, __pyx_L1_error))
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(__pyx_v_output);
       __pyx_r = __pyx_v_output;
       goto __pyx_L0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6326
+      /* "discretize/_extensions/tree_ext.pyx":6323
  *             # Every cell input cell is gauranteed to be a lower level than the output tenser mesh
  *             # therefore all weights a 1.0
  *             if values is not None:             # <<<<<<<<<<<<<<
  *                 if output is None:
  *                     output = np.empty(out_tens_mesh.n_cells)
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6331
+    /* "discretize/_extensions/tree_ext.pyx":6328
  *                 output[:] = values[in_cell_inds]
  *                 return output
  *             return sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                 (np.ones(out_tens_mesh.n_cells), (np.arange(out_tens_mesh.n_cells), in_cell_inds)),
  *                 shape=(out_tens_mesh.n_cells, self.n_cells)
  */
-    __Pyx_TraceLine(6331,0,__PYX_ERR(0, 6331, __pyx_L1_error))
+    __Pyx_TraceLine(6328,0,__PYX_ERR(0, 6328, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6331, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6328, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6331, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6328, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6332
+    /* "discretize/_extensions/tree_ext.pyx":6329
  *                 return output
  *             return sp.csr_matrix(
  *                 (np.ones(out_tens_mesh.n_cells), (np.arange(out_tens_mesh.n_cells), in_cell_inds)),             # <<<<<<<<<<<<<<
  *                 shape=(out_tens_mesh.n_cells, self.n_cells)
  *             )
  */
-    __Pyx_TraceLine(6332,0,__PYX_ERR(0, 6332, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    __Pyx_TraceLine(6329,0,__PYX_ERR(0, 6329, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_ones); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_ones); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __pyx_t_5 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
       __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_8);
       if (likely(__pyx_t_5)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
         __Pyx_INCREF(__pyx_t_5);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_8, function);
       }
     }
     __pyx_t_6 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_5, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __pyx_t_7 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_5))) {
       __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_5);
       if (likely(__pyx_t_7)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
         __Pyx_INCREF(__pyx_t_7);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_8 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8);
     __Pyx_INCREF(__pyx_v_in_cell_inds);
     __Pyx_GIVEREF(__pyx_v_in_cell_inds);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_in_cell_inds);
     __pyx_t_8 = 0;
-    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6332, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6329, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_5);
     PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_5);
     __pyx_t_6 = 0;
     __pyx_t_5 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6331
+    /* "discretize/_extensions/tree_ext.pyx":6328
  *                 output[:] = values[in_cell_inds]
  *                 return output
  *             return sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                 (np.ones(out_tens_mesh.n_cells), (np.arange(out_tens_mesh.n_cells), in_cell_inds)),
  *                 shape=(out_tens_mesh.n_cells, self.n_cells)
  */
-    __Pyx_TraceLine(6331,0,__PYX_ERR(0, 6331, __pyx_L1_error))
-    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6331, __pyx_L1_error)
+    __Pyx_TraceLine(6328,0,__PYX_ERR(0, 6328, __pyx_L1_error))
+    __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6328, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8);
     __pyx_t_8 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6333
+    /* "discretize/_extensions/tree_ext.pyx":6330
  *             return sp.csr_matrix(
  *                 (np.ones(out_tens_mesh.n_cells), (np.arange(out_tens_mesh.n_cells), in_cell_inds)),
  *                 shape=(out_tens_mesh.n_cells, self.n_cells)             # <<<<<<<<<<<<<<
  *             )
  * 
  */
-    __Pyx_TraceLine(6333,0,__PYX_ERR(0, 6333, __pyx_L1_error))
-    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6333, __pyx_L1_error)
+    __Pyx_TraceLine(6330,0,__PYX_ERR(0, 6330, __pyx_L1_error))
+    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6330, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6333, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6330, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6333, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6330, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6333, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6330, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_9);
     PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_9);
     __pyx_t_6 = 0;
     __pyx_t_9 = 0;
-    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 6333, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 6330, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6331
+    /* "discretize/_extensions/tree_ext.pyx":6328
  *                 output[:] = values[in_cell_inds]
  *                 return output
  *             return sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                 (np.ones(out_tens_mesh.n_cells), (np.arange(out_tens_mesh.n_cells), in_cell_inds)),
  *                 shape=(out_tens_mesh.n_cells, self.n_cells)
  */
-    __Pyx_TraceLine(6331,0,__PYX_ERR(0, 6331, __pyx_L1_error))
-    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6331, __pyx_L1_error)
+    __Pyx_TraceLine(6328,0,__PYX_ERR(0, 6328, __pyx_L1_error))
+    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_5, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6328, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_r = __pyx_t_7;
     __pyx_t_7 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6322
+    /* "discretize/_extensions/tree_ext.pyx":6319
  *             same_base = False
  * 
  *         if same_base:             # <<<<<<<<<<<<<<
  *             in_cell_inds = self._get_containing_cell_indexes(out_tens_mesh.cell_centers)
  *             # Every cell input cell is gauranteed to be a lower level than the output tenser mesh
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6336
+  /* "discretize/_extensions/tree_ext.pyx":6333
  *             )
  * 
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             origin = np.r_[self.origin, 0.0]
  *             xF = np.array([self._xs[-1], self._ys[-1], 0.0])
  */
-  __Pyx_TraceLine(6336,0,__PYX_ERR(0, 6336, __pyx_L1_error))
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6336, __pyx_L1_error)
+  __Pyx_TraceLine(6333,0,__PYX_ERR(0, 6333, __pyx_L1_error))
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6333, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_8 = __Pyx_PyInt_EqObjC(__pyx_t_7, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6336, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_EqObjC(__pyx_t_7, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6333, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6336, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_12 < 0)) __PYX_ERR(0, 6333, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6337
+    /* "discretize/_extensions/tree_ext.pyx":6334
  * 
  *         if self.dim == 2:
  *             origin = np.r_[self.origin, 0.0]             # <<<<<<<<<<<<<<
  *             xF = np.array([self._xs[-1], self._ys[-1], 0.0])
  *         else:
  */
-    __Pyx_TraceLine(6337,0,__PYX_ERR(0, 6337, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6337, __pyx_L1_error)
+    __Pyx_TraceLine(6334,0,__PYX_ERR(0, 6334, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6334, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_r); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6337, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_r); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6334, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_origin); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6337, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_origin); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6334, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6337, __pyx_L1_error)
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6334, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8);
     __Pyx_INCREF(__pyx_float_0_0);
     __Pyx_GIVEREF(__pyx_float_0_0);
     PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_float_0_0);
     __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6337, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6334, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6337, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6334, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_v_origin = __pyx_t_15;
     __pyx_t_15.memview = NULL;
     __pyx_t_15.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6338
+    /* "discretize/_extensions/tree_ext.pyx":6335
  *         if self.dim == 2:
  *             origin = np.r_[self.origin, 0.0]
  *             xF = np.array([self._xs[-1], self._ys[-1], 0.0])             # <<<<<<<<<<<<<<
  *         else:
  *             origin = self._origin
  */
-    __Pyx_TraceLine(6338,0,__PYX_ERR(0, 6338, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6338, __pyx_L1_error)
+    __Pyx_TraceLine(6335,0,__PYX_ERR(0, 6335, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6335, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6338, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6335, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6338, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6335, __pyx_L1_error)}
     __pyx_t_16 = -1L;
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_self->_xs.shape[0];
-    __pyx_t_5 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_16 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6338, __pyx_L1_error)
+    __pyx_t_5 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_16 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6335, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6338, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6335, __pyx_L1_error)}
     __pyx_t_16 = -1L;
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_self->_ys.shape[0];
-    __pyx_t_11 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_16 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6338, __pyx_L1_error)
+    __pyx_t_11 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_16 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6335, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_9 = PyList_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6338, __pyx_L1_error)
+    __pyx_t_9 = PyList_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6335, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_GIVEREF(__pyx_t_5);
     PyList_SET_ITEM(__pyx_t_9, 0, __pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_11);
     PyList_SET_ITEM(__pyx_t_9, 1, __pyx_t_11);
     __Pyx_INCREF(__pyx_float_0_0);
     __Pyx_GIVEREF(__pyx_float_0_0);
@@ -80925,78 +80937,78 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_8 = (__pyx_t_11) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_11, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6338, __pyx_L1_error)
+    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6335, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6338, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6335, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_v_xF = __pyx_t_15;
     __pyx_t_15.memview = NULL;
     __pyx_t_15.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6336
+    /* "discretize/_extensions/tree_ext.pyx":6333
  *             )
  * 
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             origin = np.r_[self.origin, 0.0]
  *             xF = np.array([self._xs[-1], self._ys[-1], 0.0])
  */
     goto __pyx_L18;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6340
+  /* "discretize/_extensions/tree_ext.pyx":6337
  *             xF = np.array([self._xs[-1], self._ys[-1], 0.0])
  *         else:
  *             origin = self._origin             # <<<<<<<<<<<<<<
  *             xF = np.array([self._xs[-1], self._ys[-1], self._zs[-1]])
  *         cdef c_Cell * in_cell
  */
-  __Pyx_TraceLine(6340,0,__PYX_ERR(0, 6340, __pyx_L1_error))
+  __Pyx_TraceLine(6337,0,__PYX_ERR(0, 6337, __pyx_L1_error))
   /*else*/ {
-    if (unlikely(!__pyx_v_self->_origin.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6340, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_origin.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6337, __pyx_L1_error)}
     __pyx_t_15 = __pyx_v_self->_origin;
     __PYX_INC_MEMVIEW(&__pyx_t_15, 1);
     __pyx_v_origin = __pyx_t_15;
     __pyx_t_15.memview = NULL;
     __pyx_t_15.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6341
+    /* "discretize/_extensions/tree_ext.pyx":6338
  *         else:
  *             origin = self._origin
  *             xF = np.array([self._xs[-1], self._ys[-1], self._zs[-1]])             # <<<<<<<<<<<<<<
  *         cdef c_Cell * in_cell
  * 
  */
-    __Pyx_TraceLine(6341,0,__PYX_ERR(0, 6341, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6341, __pyx_L1_error)
+    __Pyx_TraceLine(6338,0,__PYX_ERR(0, 6338, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6341, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6341, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6338, __pyx_L1_error)}
     __pyx_t_16 = -1L;
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_self->_xs.shape[0];
-    __pyx_t_7 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_16 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6341, __pyx_L1_error)
+    __pyx_t_7 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_16 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6341, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6338, __pyx_L1_error)}
     __pyx_t_16 = -1L;
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_self->_ys.shape[0];
-    __pyx_t_11 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_16 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6341, __pyx_L1_error)
+    __pyx_t_11 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_16 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6341, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6338, __pyx_L1_error)}
     __pyx_t_16 = -1L;
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_self->_zs.shape[0];
-    __pyx_t_5 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_16 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6341, __pyx_L1_error)
+    __pyx_t_5 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_16 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_6 = PyList_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6341, __pyx_L1_error)
+    __pyx_t_6 = PyList_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_7);
     PyList_SET_ITEM(__pyx_t_6, 0, __pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_11);
     PyList_SET_ITEM(__pyx_t_6, 1, __pyx_t_11);
     __Pyx_GIVEREF(__pyx_t_5);
     PyList_SET_ITEM(__pyx_t_6, 2, __pyx_t_5);
@@ -81012,83 +81024,83 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_9, function);
       }
     }
     __pyx_t_8 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_6);
     __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6341, __pyx_L1_error)
+    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6338, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6341, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6338, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_v_xF = __pyx_t_15;
     __pyx_t_15.memview = NULL;
     __pyx_t_15.data = NULL;
   }
   __pyx_L18:;
 
-  /* "discretize/_extensions/tree_ext.pyx":6344
+  /* "discretize/_extensions/tree_ext.pyx":6341
  *         cdef c_Cell * in_cell
  * 
  *         cdef np.float64_t[:] vals = np.array([])             # <<<<<<<<<<<<<<
  *         cdef np.float64_t[::1, :, :] outs = np.array([[[]]])
  * 
  */
-  __Pyx_TraceLine(6344,0,__PYX_ERR(0, 6344, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6344, __pyx_L1_error)
+  __Pyx_TraceLine(6341,0,__PYX_ERR(0, 6341, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6341, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6344, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6341, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = PyList_New(0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6344, __pyx_L1_error)
+  __pyx_t_9 = PyList_New(0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6341, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_8 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_9);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6344, __pyx_L1_error)
+  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6341, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 6344, __pyx_L1_error)
+  __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 6341, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_vals = __pyx_t_17;
   __pyx_t_17.memview = NULL;
   __pyx_t_17.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6345
+  /* "discretize/_extensions/tree_ext.pyx":6342
  * 
  *         cdef np.float64_t[:] vals = np.array([])
  *         cdef np.float64_t[::1, :, :] outs = np.array([[[]]])             # <<<<<<<<<<<<<<
  * 
  *         cdef vector[int_t] row_inds
  */
-  __Pyx_TraceLine(6345,0,__PYX_ERR(0, 6345, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6345, __pyx_L1_error)
+  __Pyx_TraceLine(6342,0,__PYX_ERR(0, 6342, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6342, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6345, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6342, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6345, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6342, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = PyList_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6345, __pyx_L1_error)
+  __pyx_t_5 = PyList_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6342, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyList_SET_ITEM(__pyx_t_5, 0, __pyx_t_6);
   __pyx_t_6 = 0;
-  __pyx_t_6 = PyList_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6345, __pyx_L1_error)
+  __pyx_t_6 = PyList_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6342, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyList_SET_ITEM(__pyx_t_6, 0, __pyx_t_5);
   __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_9);
@@ -81098,89 +81110,89 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_9, function);
     }
   }
   __pyx_t_8 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_5, __pyx_t_6) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_6);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6345, __pyx_L1_error)
+  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6342, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_18 = __Pyx_PyObject_to_MemoryviewSlice_dcd_d__nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 6345, __pyx_L1_error)
+  __pyx_t_18 = __Pyx_PyObject_to_MemoryviewSlice_dcd_d__nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 6342, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_outs = __pyx_t_18;
   __pyx_t_18.memview = NULL;
   __pyx_t_18.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6350
+  /* "discretize/_extensions/tree_ext.pyx":6347
  *         cdef vector[int_t] indptr
  *         cdef vector[double] all_weights
  *         cdef int_t nnz_row = 0             # <<<<<<<<<<<<<<
  *         cdef int_t nnz_counter = 0
  * 
  */
-  __Pyx_TraceLine(6350,0,__PYX_ERR(0, 6350, __pyx_L1_error))
+  __Pyx_TraceLine(6347,0,__PYX_ERR(0, 6347, __pyx_L1_error))
   __pyx_v_nnz_row = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6351
+  /* "discretize/_extensions/tree_ext.pyx":6348
  *         cdef vector[double] all_weights
  *         cdef int_t nnz_row = 0
  *         cdef int_t nnz_counter = 0             # <<<<<<<<<<<<<<
  * 
  *         cdef double[:] nodes_x = out_tens_mesh.nodes_x
  */
-  __Pyx_TraceLine(6351,0,__PYX_ERR(0, 6351, __pyx_L1_error))
+  __Pyx_TraceLine(6348,0,__PYX_ERR(0, 6348, __pyx_L1_error))
   __pyx_v_nnz_counter = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6353
+  /* "discretize/_extensions/tree_ext.pyx":6350
  *         cdef int_t nnz_counter = 0
  * 
  *         cdef double[:] nodes_x = out_tens_mesh.nodes_x             # <<<<<<<<<<<<<<
  *         cdef double[:] nodes_y = out_tens_mesh.nodes_y
  *         cdef double[:] nodes_z = np.array([0.0, 0.0])
  */
-  __Pyx_TraceLine(6353,0,__PYX_ERR(0, 6353, __pyx_L1_error))
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6353, __pyx_L1_error)
+  __Pyx_TraceLine(6350,0,__PYX_ERR(0, 6350, __pyx_L1_error))
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6350, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6353, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6350, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_nodes_x = __pyx_t_15;
   __pyx_t_15.memview = NULL;
   __pyx_t_15.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6354
+  /* "discretize/_extensions/tree_ext.pyx":6351
  * 
  *         cdef double[:] nodes_x = out_tens_mesh.nodes_x
  *         cdef double[:] nodes_y = out_tens_mesh.nodes_y             # <<<<<<<<<<<<<<
  *         cdef double[:] nodes_z = np.array([0.0, 0.0])
  *         if self._dim==3:
  */
-  __Pyx_TraceLine(6354,0,__PYX_ERR(0, 6354, __pyx_L1_error))
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6354, __pyx_L1_error)
+  __Pyx_TraceLine(6351,0,__PYX_ERR(0, 6351, __pyx_L1_error))
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6351, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6354, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6351, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_nodes_y = __pyx_t_15;
   __pyx_t_15.memview = NULL;
   __pyx_t_15.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6355
+  /* "discretize/_extensions/tree_ext.pyx":6352
  *         cdef double[:] nodes_x = out_tens_mesh.nodes_x
  *         cdef double[:] nodes_y = out_tens_mesh.nodes_y
  *         cdef double[:] nodes_z = np.array([0.0, 0.0])             # <<<<<<<<<<<<<<
  *         if self._dim==3:
  *             nodes_z = out_tens_mesh.nodes_z
  */
-  __Pyx_TraceLine(6355,0,__PYX_ERR(0, 6355, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6355, __pyx_L1_error)
+  __Pyx_TraceLine(6352,0,__PYX_ERR(0, 6352, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6355, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6355, __pyx_L1_error)
+  __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_INCREF(__pyx_float_0_0);
   __Pyx_GIVEREF(__pyx_float_0_0);
   PyList_SET_ITEM(__pyx_t_9, 0, __pyx_float_0_0);
   __Pyx_INCREF(__pyx_float_0_0);
   __Pyx_GIVEREF(__pyx_float_0_0);
   PyList_SET_ITEM(__pyx_t_9, 1, __pyx_float_0_0);
@@ -81193,644 +81205,644 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_8 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_t_9);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6355, __pyx_L1_error)
+  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6355, __pyx_L1_error)
+  __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6352, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_nodes_z = __pyx_t_15;
   __pyx_t_15.memview = NULL;
   __pyx_t_15.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6356
+  /* "discretize/_extensions/tree_ext.pyx":6353
  *         cdef double[:] nodes_y = out_tens_mesh.nodes_y
  *         cdef double[:] nodes_z = np.array([0.0, 0.0])
  *         if self._dim==3:             # <<<<<<<<<<<<<<
  *             nodes_z = out_tens_mesh.nodes_z
  *         cdef int_t nx = len(nodes_x)-1
  */
-  __Pyx_TraceLine(6356,0,__PYX_ERR(0, 6356, __pyx_L1_error))
+  __Pyx_TraceLine(6353,0,__PYX_ERR(0, 6353, __pyx_L1_error))
   __pyx_t_12 = ((__pyx_v_self->_dim == 3) != 0);
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6357
+    /* "discretize/_extensions/tree_ext.pyx":6354
  *         cdef double[:] nodes_z = np.array([0.0, 0.0])
  *         if self._dim==3:
  *             nodes_z = out_tens_mesh.nodes_z             # <<<<<<<<<<<<<<
  *         cdef int_t nx = len(nodes_x)-1
  *         cdef int_t ny = len(nodes_y)-1
  */
-    __Pyx_TraceLine(6357,0,__PYX_ERR(0, 6357, __pyx_L1_error))
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6357, __pyx_L1_error)
+    __Pyx_TraceLine(6354,0,__PYX_ERR(0, 6354, __pyx_L1_error))
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6354, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6357, __pyx_L1_error)
+    __pyx_t_15 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 6354, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_v_nodes_z, 1);
     __pyx_v_nodes_z = __pyx_t_15;
     __pyx_t_15.memview = NULL;
     __pyx_t_15.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6356
+    /* "discretize/_extensions/tree_ext.pyx":6353
  *         cdef double[:] nodes_y = out_tens_mesh.nodes_y
  *         cdef double[:] nodes_z = np.array([0.0, 0.0])
  *         if self._dim==3:             # <<<<<<<<<<<<<<
  *             nodes_z = out_tens_mesh.nodes_z
  *         cdef int_t nx = len(nodes_x)-1
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6358
+  /* "discretize/_extensions/tree_ext.pyx":6355
  *         if self._dim==3:
  *             nodes_z = out_tens_mesh.nodes_z
  *         cdef int_t nx = len(nodes_x)-1             # <<<<<<<<<<<<<<
  *         cdef int_t ny = len(nodes_y)-1
  *         cdef int_t nz = len(nodes_z)-1
  */
-  __Pyx_TraceLine(6358,0,__PYX_ERR(0, 6358, __pyx_L1_error))
+  __Pyx_TraceLine(6355,0,__PYX_ERR(0, 6355, __pyx_L1_error))
   __pyx_t_19 = __Pyx_MemoryView_Len(__pyx_v_nodes_x); 
   __pyx_v_nx = (__pyx_t_19 - 1);
 
-  /* "discretize/_extensions/tree_ext.pyx":6359
+  /* "discretize/_extensions/tree_ext.pyx":6356
  *             nodes_z = out_tens_mesh.nodes_z
  *         cdef int_t nx = len(nodes_x)-1
  *         cdef int_t ny = len(nodes_y)-1             # <<<<<<<<<<<<<<
  *         cdef int_t nz = len(nodes_z)-1
  * 
  */
-  __Pyx_TraceLine(6359,0,__PYX_ERR(0, 6359, __pyx_L1_error))
+  __Pyx_TraceLine(6356,0,__PYX_ERR(0, 6356, __pyx_L1_error))
   __pyx_t_19 = __Pyx_MemoryView_Len(__pyx_v_nodes_y); 
   __pyx_v_ny = (__pyx_t_19 - 1);
 
-  /* "discretize/_extensions/tree_ext.pyx":6360
+  /* "discretize/_extensions/tree_ext.pyx":6357
  *         cdef int_t nx = len(nodes_x)-1
  *         cdef int_t ny = len(nodes_y)-1
  *         cdef int_t nz = len(nodes_z)-1             # <<<<<<<<<<<<<<
  * 
  *         cdef int_t build_mat = 1
  */
-  __Pyx_TraceLine(6360,0,__PYX_ERR(0, 6360, __pyx_L1_error))
+  __Pyx_TraceLine(6357,0,__PYX_ERR(0, 6357, __pyx_L1_error))
   __pyx_t_19 = __Pyx_MemoryView_Len(__pyx_v_nodes_z); 
   __pyx_v_nz = (__pyx_t_19 - 1);
 
-  /* "discretize/_extensions/tree_ext.pyx":6362
+  /* "discretize/_extensions/tree_ext.pyx":6359
  *         cdef int_t nz = len(nodes_z)-1
  * 
  *         cdef int_t build_mat = 1             # <<<<<<<<<<<<<<
  *         if values is not None:
  *             vals = values
  */
-  __Pyx_TraceLine(6362,0,__PYX_ERR(0, 6362, __pyx_L1_error))
+  __Pyx_TraceLine(6359,0,__PYX_ERR(0, 6359, __pyx_L1_error))
   __pyx_v_build_mat = 1;
 
-  /* "discretize/_extensions/tree_ext.pyx":6363
+  /* "discretize/_extensions/tree_ext.pyx":6360
  * 
  *         cdef int_t build_mat = 1
  *         if values is not None:             # <<<<<<<<<<<<<<
  *             vals = values
  *             if output is None:
  */
-  __Pyx_TraceLine(6363,0,__PYX_ERR(0, 6363, __pyx_L1_error))
+  __Pyx_TraceLine(6360,0,__PYX_ERR(0, 6360, __pyx_L1_error))
   __pyx_t_12 = (__pyx_v_values != Py_None);
   __pyx_t_14 = (__pyx_t_12 != 0);
   if (__pyx_t_14) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6364
+    /* "discretize/_extensions/tree_ext.pyx":6361
  *         cdef int_t build_mat = 1
  *         if values is not None:
  *             vals = values             # <<<<<<<<<<<<<<
  *             if output is None:
  *                 output = np.empty((nx, ny, nz), order='F')
  */
-    __Pyx_TraceLine(6364,0,__PYX_ERR(0, 6364, __pyx_L1_error))
-    __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_v_values, PyBUF_WRITABLE); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 6364, __pyx_L1_error)
+    __Pyx_TraceLine(6361,0,__PYX_ERR(0, 6361, __pyx_L1_error))
+    __pyx_t_17 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_v_values, PyBUF_WRITABLE); if (unlikely(!__pyx_t_17.memview)) __PYX_ERR(0, 6361, __pyx_L1_error)
     __PYX_XDEC_MEMVIEW(&__pyx_v_vals, 1);
     __pyx_v_vals = __pyx_t_17;
     __pyx_t_17.memview = NULL;
     __pyx_t_17.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6365
+    /* "discretize/_extensions/tree_ext.pyx":6362
  *         if values is not None:
  *             vals = values
  *             if output is None:             # <<<<<<<<<<<<<<
  *                 output = np.empty((nx, ny, nz), order='F')
  *             else:
  */
-    __Pyx_TraceLine(6365,0,__PYX_ERR(0, 6365, __pyx_L1_error))
+    __Pyx_TraceLine(6362,0,__PYX_ERR(0, 6362, __pyx_L1_error))
     __pyx_t_14 = (__pyx_v_output == Py_None);
     __pyx_t_12 = (__pyx_t_14 != 0);
     if (__pyx_t_12) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6366
+      /* "discretize/_extensions/tree_ext.pyx":6363
  *             vals = values
  *             if output is None:
  *                 output = np.empty((nx, ny, nz), order='F')             # <<<<<<<<<<<<<<
  *             else:
  *                 output = output.reshape((nx, ny, nz), order='F')
  */
-      __Pyx_TraceLine(6366,0,__PYX_ERR(0, 6366, __pyx_L1_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      __Pyx_TraceLine(6363,0,__PYX_ERR(0, 6363, __pyx_L1_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_empty); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = __Pyx_PyInt_From_int_t(__pyx_v_nx); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_From_int_t(__pyx_v_nx); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_9 = __Pyx_PyInt_From_int_t(__pyx_v_ny); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyInt_From_int_t(__pyx_v_ny); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_nz); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_nz); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
       __Pyx_GIVEREF(__pyx_t_8);
       PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_8);
       __Pyx_GIVEREF(__pyx_t_9);
       PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_5);
       PyTuple_SET_ITEM(__pyx_t_11, 2, __pyx_t_5);
       __pyx_t_8 = 0;
       __pyx_t_9 = 0;
       __pyx_t_5 = 0;
-      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_GIVEREF(__pyx_t_11);
       PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_11);
       __pyx_t_11 = 0;
-      __pyx_t_11 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 6366, __pyx_L1_error)
-      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_5, __pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6366, __pyx_L1_error)
+      if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 6363, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_5, __pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       __Pyx_DECREF_SET(__pyx_v_output, __pyx_t_9);
       __pyx_t_9 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6365
+      /* "discretize/_extensions/tree_ext.pyx":6362
  *         if values is not None:
  *             vals = values
  *             if output is None:             # <<<<<<<<<<<<<<
  *                 output = np.empty((nx, ny, nz), order='F')
  *             else:
  */
       goto __pyx_L21;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6368
+    /* "discretize/_extensions/tree_ext.pyx":6365
  *                 output = np.empty((nx, ny, nz), order='F')
  *             else:
  *                 output = output.reshape((nx, ny, nz), order='F')             # <<<<<<<<<<<<<<
  *             output[:] = 0
  *             outs = output
  */
-    __Pyx_TraceLine(6368,0,__PYX_ERR(0, 6368, __pyx_L1_error))
+    __Pyx_TraceLine(6365,0,__PYX_ERR(0, 6365, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_output, __pyx_n_s_reshape); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6368, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_output, __pyx_n_s_reshape); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_11 = __Pyx_PyInt_From_int_t(__pyx_v_nx); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6368, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyInt_From_int_t(__pyx_v_nx); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_11);
-      __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_ny); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6368, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyInt_From_int_t(__pyx_v_ny); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __Pyx_PyInt_From_int_t(__pyx_v_nz); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6368, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyInt_From_int_t(__pyx_v_nz); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6368, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_GIVEREF(__pyx_t_11);
       PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_11);
       __Pyx_GIVEREF(__pyx_t_5);
       PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_5);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_6);
       __pyx_t_11 = 0;
       __pyx_t_5 = 0;
       __pyx_t_6 = 0;
-      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6368, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_GIVEREF(__pyx_t_8);
       PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_8);
       __pyx_t_8 = 0;
-      __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6368, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 6368, __pyx_L1_error)
-      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_6, __pyx_t_8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6368, __pyx_L1_error)
+      if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 6365, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_6, __pyx_t_8); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6365, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF_SET(__pyx_v_output, __pyx_t_5);
       __pyx_t_5 = 0;
     }
     __pyx_L21:;
 
-    /* "discretize/_extensions/tree_ext.pyx":6369
+    /* "discretize/_extensions/tree_ext.pyx":6366
  *             else:
  *                 output = output.reshape((nx, ny, nz), order='F')
  *             output[:] = 0             # <<<<<<<<<<<<<<
  *             outs = output
  * 
  */
-    __Pyx_TraceLine(6369,0,__PYX_ERR(0, 6369, __pyx_L1_error))
-    if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6369, __pyx_L1_error)
+    __Pyx_TraceLine(6366,0,__PYX_ERR(0, 6366, __pyx_L1_error))
+    if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6366, __pyx_L1_error)
 
-    /* "discretize/_extensions/tree_ext.pyx":6370
+    /* "discretize/_extensions/tree_ext.pyx":6367
  *                 output = output.reshape((nx, ny, nz), order='F')
  *             output[:] = 0
  *             outs = output             # <<<<<<<<<<<<<<
  * 
  *             build_mat = 0
  */
-    __Pyx_TraceLine(6370,0,__PYX_ERR(0, 6370, __pyx_L1_error))
-    __pyx_t_18 = __Pyx_PyObject_to_MemoryviewSlice_dcd_d__nn___pyx_t_5numpy_float64_t(__pyx_v_output, PyBUF_WRITABLE); if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 6370, __pyx_L1_error)
+    __Pyx_TraceLine(6367,0,__PYX_ERR(0, 6367, __pyx_L1_error))
+    __pyx_t_18 = __Pyx_PyObject_to_MemoryviewSlice_dcd_d__nn___pyx_t_5numpy_float64_t(__pyx_v_output, PyBUF_WRITABLE); if (unlikely(!__pyx_t_18.memview)) __PYX_ERR(0, 6367, __pyx_L1_error)
     __PYX_XDEC_MEMVIEW(&__pyx_v_outs, 1);
     __pyx_v_outs = __pyx_t_18;
     __pyx_t_18.memview = NULL;
     __pyx_t_18.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6372
+    /* "discretize/_extensions/tree_ext.pyx":6369
  *             outs = output
  * 
  *             build_mat = 0             # <<<<<<<<<<<<<<
  *         if build_mat:
  *             indptr.push_back(0)
  */
-    __Pyx_TraceLine(6372,0,__PYX_ERR(0, 6372, __pyx_L1_error))
+    __Pyx_TraceLine(6369,0,__PYX_ERR(0, 6369, __pyx_L1_error))
     __pyx_v_build_mat = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6363
+    /* "discretize/_extensions/tree_ext.pyx":6360
  * 
  *         cdef int_t build_mat = 1
  *         if values is not None:             # <<<<<<<<<<<<<<
  *             vals = values
  *             if output is None:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6373
+  /* "discretize/_extensions/tree_ext.pyx":6370
  * 
  *             build_mat = 0
  *         if build_mat:             # <<<<<<<<<<<<<<
  *             indptr.push_back(0)
  * 
  */
-  __Pyx_TraceLine(6373,0,__PYX_ERR(0, 6373, __pyx_L1_error))
+  __Pyx_TraceLine(6370,0,__PYX_ERR(0, 6370, __pyx_L1_error))
   __pyx_t_12 = (__pyx_v_build_mat != 0);
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6374
+    /* "discretize/_extensions/tree_ext.pyx":6371
  *             build_mat = 0
  *         if build_mat:
  *             indptr.push_back(0)             # <<<<<<<<<<<<<<
  * 
  *         cdef int_t ix, iy, iz, in_cell_ind, i
  */
-    __Pyx_TraceLine(6374,0,__PYX_ERR(0, 6374, __pyx_L1_error))
+    __Pyx_TraceLine(6371,0,__PYX_ERR(0, 6371, __pyx_L1_error))
     try {
       __pyx_v_indptr.push_back(0);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 6374, __pyx_L1_error)
+      __PYX_ERR(0, 6371, __pyx_L1_error)
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6373
+    /* "discretize/_extensions/tree_ext.pyx":6370
  * 
  *             build_mat = 0
  *         if build_mat:             # <<<<<<<<<<<<<<
  *             indptr.push_back(0)
  * 
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6381
+  /* "discretize/_extensions/tree_ext.pyx":6378
  * 
  *         #for cell in self.tree.cells:
  *         for iz in range(nz):             # <<<<<<<<<<<<<<
  *             z1m = min(nodes_z[iz], xF[2])
  *             z1p = max(nodes_z[iz+1], origin[2])
  */
-  __Pyx_TraceLine(6381,0,__PYX_ERR(0, 6381, __pyx_L1_error))
+  __Pyx_TraceLine(6378,0,__PYX_ERR(0, 6378, __pyx_L1_error))
   __pyx_t_4 = __pyx_v_nz;
   __pyx_t_13 = __pyx_t_4;
   for (__pyx_t_20 = 0; __pyx_t_20 < __pyx_t_13; __pyx_t_20+=1) {
     __pyx_v_iz = __pyx_t_20;
 
-    /* "discretize/_extensions/tree_ext.pyx":6382
+    /* "discretize/_extensions/tree_ext.pyx":6379
  *         #for cell in self.tree.cells:
  *         for iz in range(nz):
  *             z1m = min(nodes_z[iz], xF[2])             # <<<<<<<<<<<<<<
  *             z1p = max(nodes_z[iz+1], origin[2])
  *             for iy in range(ny):
  */
-    __Pyx_TraceLine(6382,0,__PYX_ERR(0, 6382, __pyx_L1_error))
+    __Pyx_TraceLine(6379,0,__PYX_ERR(0, 6379, __pyx_L1_error))
     __pyx_t_16 = 2;
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_xF.shape[0];
     __pyx_t_21 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_16 * __pyx_v_xF.strides[0]) )));
     __pyx_t_16 = __pyx_v_iz;
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_nodes_z.shape[0];
     __pyx_t_22 = (*((double *) ( /* dim=0 */ (__pyx_v_nodes_z.data + __pyx_t_16 * __pyx_v_nodes_z.strides[0]) )));
     if (((__pyx_t_21 < __pyx_t_22) != 0)) {
       __pyx_t_23 = __pyx_t_21;
     } else {
       __pyx_t_23 = __pyx_t_22;
     }
     __pyx_v_z1m = __pyx_t_23;
 
-    /* "discretize/_extensions/tree_ext.pyx":6383
+    /* "discretize/_extensions/tree_ext.pyx":6380
  *         for iz in range(nz):
  *             z1m = min(nodes_z[iz], xF[2])
  *             z1p = max(nodes_z[iz+1], origin[2])             # <<<<<<<<<<<<<<
  *             for iy in range(ny):
  *                 y1m = min(nodes_y[iy], xF[1])
  */
-    __Pyx_TraceLine(6383,0,__PYX_ERR(0, 6383, __pyx_L1_error))
+    __Pyx_TraceLine(6380,0,__PYX_ERR(0, 6380, __pyx_L1_error))
     __pyx_t_16 = 2;
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_origin.shape[0];
     __pyx_t_23 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_16 * __pyx_v_origin.strides[0]) )));
     __pyx_t_16 = (__pyx_v_iz + 1);
     if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_nodes_z.shape[0];
     __pyx_t_21 = (*((double *) ( /* dim=0 */ (__pyx_v_nodes_z.data + __pyx_t_16 * __pyx_v_nodes_z.strides[0]) )));
     if (((__pyx_t_23 > __pyx_t_21) != 0)) {
       __pyx_t_22 = __pyx_t_23;
     } else {
       __pyx_t_22 = __pyx_t_21;
     }
     __pyx_v_z1p = __pyx_t_22;
 
-    /* "discretize/_extensions/tree_ext.pyx":6384
+    /* "discretize/_extensions/tree_ext.pyx":6381
  *             z1m = min(nodes_z[iz], xF[2])
  *             z1p = max(nodes_z[iz+1], origin[2])
  *             for iy in range(ny):             # <<<<<<<<<<<<<<
  *                 y1m = min(nodes_y[iy], xF[1])
  *                 y1p = max(nodes_y[iy+1], origin[1])
  */
-    __Pyx_TraceLine(6384,0,__PYX_ERR(0, 6384, __pyx_L1_error))
+    __Pyx_TraceLine(6381,0,__PYX_ERR(0, 6381, __pyx_L1_error))
     __pyx_t_24 = __pyx_v_ny;
     __pyx_t_25 = __pyx_t_24;
     for (__pyx_t_26 = 0; __pyx_t_26 < __pyx_t_25; __pyx_t_26+=1) {
       __pyx_v_iy = __pyx_t_26;
 
-      /* "discretize/_extensions/tree_ext.pyx":6385
+      /* "discretize/_extensions/tree_ext.pyx":6382
  *             z1p = max(nodes_z[iz+1], origin[2])
  *             for iy in range(ny):
  *                 y1m = min(nodes_y[iy], xF[1])             # <<<<<<<<<<<<<<
  *                 y1p = max(nodes_y[iy+1], origin[1])
  *                 for ix in range(nx):
  */
-      __Pyx_TraceLine(6385,0,__PYX_ERR(0, 6385, __pyx_L1_error))
+      __Pyx_TraceLine(6382,0,__PYX_ERR(0, 6382, __pyx_L1_error))
       __pyx_t_16 = 1;
       if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_xF.shape[0];
       __pyx_t_22 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_16 * __pyx_v_xF.strides[0]) )));
       __pyx_t_16 = __pyx_v_iy;
       if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_nodes_y.shape[0];
       __pyx_t_23 = (*((double *) ( /* dim=0 */ (__pyx_v_nodes_y.data + __pyx_t_16 * __pyx_v_nodes_y.strides[0]) )));
       if (((__pyx_t_22 < __pyx_t_23) != 0)) {
         __pyx_t_21 = __pyx_t_22;
       } else {
         __pyx_t_21 = __pyx_t_23;
       }
       __pyx_v_y1m = __pyx_t_21;
 
-      /* "discretize/_extensions/tree_ext.pyx":6386
+      /* "discretize/_extensions/tree_ext.pyx":6383
  *             for iy in range(ny):
  *                 y1m = min(nodes_y[iy], xF[1])
  *                 y1p = max(nodes_y[iy+1], origin[1])             # <<<<<<<<<<<<<<
  *                 for ix in range(nx):
  *                     x1m = min(nodes_x[ix], xF[0])
  */
-      __Pyx_TraceLine(6386,0,__PYX_ERR(0, 6386, __pyx_L1_error))
+      __Pyx_TraceLine(6383,0,__PYX_ERR(0, 6383, __pyx_L1_error))
       __pyx_t_16 = 1;
       if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_origin.shape[0];
       __pyx_t_21 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_16 * __pyx_v_origin.strides[0]) )));
       __pyx_t_16 = (__pyx_v_iy + 1);
       if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_nodes_y.shape[0];
       __pyx_t_22 = (*((double *) ( /* dim=0 */ (__pyx_v_nodes_y.data + __pyx_t_16 * __pyx_v_nodes_y.strides[0]) )));
       if (((__pyx_t_21 > __pyx_t_22) != 0)) {
         __pyx_t_23 = __pyx_t_21;
       } else {
         __pyx_t_23 = __pyx_t_22;
       }
       __pyx_v_y1p = __pyx_t_23;
 
-      /* "discretize/_extensions/tree_ext.pyx":6387
+      /* "discretize/_extensions/tree_ext.pyx":6384
  *                 y1m = min(nodes_y[iy], xF[1])
  *                 y1p = max(nodes_y[iy+1], origin[1])
  *                 for ix in range(nx):             # <<<<<<<<<<<<<<
  *                     x1m = min(nodes_x[ix], xF[0])
  *                     x1p = max(nodes_x[ix+1], origin[0])
  */
-      __Pyx_TraceLine(6387,0,__PYX_ERR(0, 6387, __pyx_L1_error))
+      __Pyx_TraceLine(6384,0,__PYX_ERR(0, 6384, __pyx_L1_error))
       __pyx_t_27 = __pyx_v_nx;
       __pyx_t_28 = __pyx_t_27;
       for (__pyx_t_29 = 0; __pyx_t_29 < __pyx_t_28; __pyx_t_29+=1) {
         __pyx_v_ix = __pyx_t_29;
 
-        /* "discretize/_extensions/tree_ext.pyx":6388
+        /* "discretize/_extensions/tree_ext.pyx":6385
  *                 y1p = max(nodes_y[iy+1], origin[1])
  *                 for ix in range(nx):
  *                     x1m = min(nodes_x[ix], xF[0])             # <<<<<<<<<<<<<<
  *                     x1p = max(nodes_x[ix+1], origin[0])
  *                     overlapping_cell_inds = self.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)
  */
-        __Pyx_TraceLine(6388,0,__PYX_ERR(0, 6388, __pyx_L1_error))
+        __Pyx_TraceLine(6385,0,__PYX_ERR(0, 6385, __pyx_L1_error))
         __pyx_t_16 = 0;
         if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_xF.shape[0];
         __pyx_t_23 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_16 * __pyx_v_xF.strides[0]) )));
         __pyx_t_16 = __pyx_v_ix;
         if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_nodes_x.shape[0];
         __pyx_t_21 = (*((double *) ( /* dim=0 */ (__pyx_v_nodes_x.data + __pyx_t_16 * __pyx_v_nodes_x.strides[0]) )));
         if (((__pyx_t_23 < __pyx_t_21) != 0)) {
           __pyx_t_22 = __pyx_t_23;
         } else {
           __pyx_t_22 = __pyx_t_21;
         }
         __pyx_v_x1m = __pyx_t_22;
 
-        /* "discretize/_extensions/tree_ext.pyx":6389
+        /* "discretize/_extensions/tree_ext.pyx":6386
  *                 for ix in range(nx):
  *                     x1m = min(nodes_x[ix], xF[0])
  *                     x1p = max(nodes_x[ix+1], origin[0])             # <<<<<<<<<<<<<<
  *                     overlapping_cell_inds = self.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)
  *                     n_overlap = overlapping_cell_inds.size()
  */
-        __Pyx_TraceLine(6389,0,__PYX_ERR(0, 6389, __pyx_L1_error))
+        __Pyx_TraceLine(6386,0,__PYX_ERR(0, 6386, __pyx_L1_error))
         __pyx_t_16 = 0;
         if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_origin.shape[0];
         __pyx_t_22 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_16 * __pyx_v_origin.strides[0]) )));
         __pyx_t_16 = (__pyx_v_ix + 1);
         if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_nodes_x.shape[0];
         __pyx_t_23 = (*((double *) ( /* dim=0 */ (__pyx_v_nodes_x.data + __pyx_t_16 * __pyx_v_nodes_x.strides[0]) )));
         if (((__pyx_t_22 > __pyx_t_23) != 0)) {
           __pyx_t_21 = __pyx_t_22;
         } else {
           __pyx_t_21 = __pyx_t_23;
         }
         __pyx_v_x1p = __pyx_t_21;
 
-        /* "discretize/_extensions/tree_ext.pyx":6390
+        /* "discretize/_extensions/tree_ext.pyx":6387
  *                     x1m = min(nodes_x[ix], xF[0])
  *                     x1p = max(nodes_x[ix+1], origin[0])
  *                     overlapping_cell_inds = self.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)             # <<<<<<<<<<<<<<
  *                     n_overlap = overlapping_cell_inds.size()
  *                     weights = <double *> malloc(n_overlap*sizeof(double))
  */
-        __Pyx_TraceLine(6390,0,__PYX_ERR(0, 6390, __pyx_L1_error))
+        __Pyx_TraceLine(6387,0,__PYX_ERR(0, 6387, __pyx_L1_error))
         __pyx_v_overlapping_cell_inds = __pyx_v_self->tree->find_overlapping_cells(__pyx_v_x1m, __pyx_v_x1p, __pyx_v_y1m, __pyx_v_y1p, __pyx_v_z1m, __pyx_v_z1p);
 
-        /* "discretize/_extensions/tree_ext.pyx":6391
+        /* "discretize/_extensions/tree_ext.pyx":6388
  *                     x1p = max(nodes_x[ix+1], origin[0])
  *                     overlapping_cell_inds = self.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)
  *                     n_overlap = overlapping_cell_inds.size()             # <<<<<<<<<<<<<<
  *                     weights = <double *> malloc(n_overlap*sizeof(double))
  *                     i = 0
  */
-        __Pyx_TraceLine(6391,0,__PYX_ERR(0, 6391, __pyx_L1_error))
+        __Pyx_TraceLine(6388,0,__PYX_ERR(0, 6388, __pyx_L1_error))
         __pyx_v_n_overlap = __pyx_v_overlapping_cell_inds.size();
 
-        /* "discretize/_extensions/tree_ext.pyx":6392
+        /* "discretize/_extensions/tree_ext.pyx":6389
  *                     overlapping_cell_inds = self.tree.find_overlapping_cells(x1m, x1p, y1m, y1p, z1m, z1p)
  *                     n_overlap = overlapping_cell_inds.size()
  *                     weights = <double *> malloc(n_overlap*sizeof(double))             # <<<<<<<<<<<<<<
  *                     i = 0
  *                     weight_sum = 0.0
  */
-        __Pyx_TraceLine(6392,0,__PYX_ERR(0, 6392, __pyx_L1_error))
+        __Pyx_TraceLine(6389,0,__PYX_ERR(0, 6389, __pyx_L1_error))
         __pyx_v_weights = ((double *)malloc((__pyx_v_n_overlap * (sizeof(double)))));
 
-        /* "discretize/_extensions/tree_ext.pyx":6393
+        /* "discretize/_extensions/tree_ext.pyx":6390
  *                     n_overlap = overlapping_cell_inds.size()
  *                     weights = <double *> malloc(n_overlap*sizeof(double))
  *                     i = 0             # <<<<<<<<<<<<<<
  *                     weight_sum = 0.0
  *                     nnz_row = 0
  */
-        __Pyx_TraceLine(6393,0,__PYX_ERR(0, 6393, __pyx_L1_error))
+        __Pyx_TraceLine(6390,0,__PYX_ERR(0, 6390, __pyx_L1_error))
         __pyx_v_i = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":6394
+        /* "discretize/_extensions/tree_ext.pyx":6391
  *                     weights = <double *> malloc(n_overlap*sizeof(double))
  *                     i = 0
  *                     weight_sum = 0.0             # <<<<<<<<<<<<<<
  *                     nnz_row = 0
  *                     for in_cell_ind in overlapping_cell_inds:
  */
-        __Pyx_TraceLine(6394,0,__PYX_ERR(0, 6394, __pyx_L1_error))
+        __Pyx_TraceLine(6391,0,__PYX_ERR(0, 6391, __pyx_L1_error))
         __pyx_v_weight_sum = 0.0;
 
-        /* "discretize/_extensions/tree_ext.pyx":6395
+        /* "discretize/_extensions/tree_ext.pyx":6392
  *                     i = 0
  *                     weight_sum = 0.0
  *                     nnz_row = 0             # <<<<<<<<<<<<<<
  *                     for in_cell_ind in overlapping_cell_inds:
  *                         in_cell = self.tree.cells[in_cell_ind]
  */
-        __Pyx_TraceLine(6395,0,__PYX_ERR(0, 6395, __pyx_L1_error))
+        __Pyx_TraceLine(6392,0,__PYX_ERR(0, 6392, __pyx_L1_error))
         __pyx_v_nnz_row = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":6396
+        /* "discretize/_extensions/tree_ext.pyx":6393
  *                     weight_sum = 0.0
  *                     nnz_row = 0
  *                     for in_cell_ind in overlapping_cell_inds:             # <<<<<<<<<<<<<<
  *                         in_cell = self.tree.cells[in_cell_ind]
  *                         x2m = in_cell.points[0].location[0]
  */
-        __Pyx_TraceLine(6396,0,__PYX_ERR(0, 6396, __pyx_L1_error))
+        __Pyx_TraceLine(6393,0,__PYX_ERR(0, 6393, __pyx_L1_error))
         __pyx_t_30 = __pyx_v_overlapping_cell_inds.begin();
         for (;;) {
           if (!(__pyx_t_30 != __pyx_v_overlapping_cell_inds.end())) break;
           __pyx_t_31 = *__pyx_t_30;
           ++__pyx_t_30;
           __pyx_v_in_cell_ind = __pyx_t_31;
 
-          /* "discretize/_extensions/tree_ext.pyx":6397
+          /* "discretize/_extensions/tree_ext.pyx":6394
  *                     nnz_row = 0
  *                     for in_cell_ind in overlapping_cell_inds:
  *                         in_cell = self.tree.cells[in_cell_ind]             # <<<<<<<<<<<<<<
  *                         x2m = in_cell.points[0].location[0]
  *                         y2m = in_cell.points[0].location[1]
  */
-          __Pyx_TraceLine(6397,0,__PYX_ERR(0, 6397, __pyx_L1_error))
+          __Pyx_TraceLine(6394,0,__PYX_ERR(0, 6394, __pyx_L1_error))
           __pyx_v_in_cell = (__pyx_v_self->tree->cells[__pyx_v_in_cell_ind]);
 
-          /* "discretize/_extensions/tree_ext.pyx":6398
+          /* "discretize/_extensions/tree_ext.pyx":6395
  *                     for in_cell_ind in overlapping_cell_inds:
  *                         in_cell = self.tree.cells[in_cell_ind]
  *                         x2m = in_cell.points[0].location[0]             # <<<<<<<<<<<<<<
  *                         y2m = in_cell.points[0].location[1]
  *                         z2m = in_cell.points[0].location[2]
  */
-          __Pyx_TraceLine(6398,0,__PYX_ERR(0, 6398, __pyx_L1_error))
+          __Pyx_TraceLine(6395,0,__PYX_ERR(0, 6395, __pyx_L1_error))
           __pyx_v_x2m = ((__pyx_v_in_cell->points[0])->location[0]);
 
-          /* "discretize/_extensions/tree_ext.pyx":6399
+          /* "discretize/_extensions/tree_ext.pyx":6396
  *                         in_cell = self.tree.cells[in_cell_ind]
  *                         x2m = in_cell.points[0].location[0]
  *                         y2m = in_cell.points[0].location[1]             # <<<<<<<<<<<<<<
  *                         z2m = in_cell.points[0].location[2]
  *                         x2p = in_cell.points[3].location[0]
  */
-          __Pyx_TraceLine(6399,0,__PYX_ERR(0, 6399, __pyx_L1_error))
+          __Pyx_TraceLine(6396,0,__PYX_ERR(0, 6396, __pyx_L1_error))
           __pyx_v_y2m = ((__pyx_v_in_cell->points[0])->location[1]);
 
-          /* "discretize/_extensions/tree_ext.pyx":6400
+          /* "discretize/_extensions/tree_ext.pyx":6397
  *                         x2m = in_cell.points[0].location[0]
  *                         y2m = in_cell.points[0].location[1]
  *                         z2m = in_cell.points[0].location[2]             # <<<<<<<<<<<<<<
  *                         x2p = in_cell.points[3].location[0]
  *                         y2p = in_cell.points[3].location[1]
  */
-          __Pyx_TraceLine(6400,0,__PYX_ERR(0, 6400, __pyx_L1_error))
+          __Pyx_TraceLine(6397,0,__PYX_ERR(0, 6397, __pyx_L1_error))
           __pyx_v_z2m = ((__pyx_v_in_cell->points[0])->location[2]);
 
-          /* "discretize/_extensions/tree_ext.pyx":6401
+          /* "discretize/_extensions/tree_ext.pyx":6398
  *                         y2m = in_cell.points[0].location[1]
  *                         z2m = in_cell.points[0].location[2]
  *                         x2p = in_cell.points[3].location[0]             # <<<<<<<<<<<<<<
  *                         y2p = in_cell.points[3].location[1]
  *                         z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0
  */
-          __Pyx_TraceLine(6401,0,__PYX_ERR(0, 6401, __pyx_L1_error))
+          __Pyx_TraceLine(6398,0,__PYX_ERR(0, 6398, __pyx_L1_error))
           __pyx_v_x2p = ((__pyx_v_in_cell->points[3])->location[0]);
 
-          /* "discretize/_extensions/tree_ext.pyx":6402
+          /* "discretize/_extensions/tree_ext.pyx":6399
  *                         z2m = in_cell.points[0].location[2]
  *                         x2p = in_cell.points[3].location[0]
  *                         y2p = in_cell.points[3].location[1]             # <<<<<<<<<<<<<<
  *                         z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0
  * 
  */
-          __Pyx_TraceLine(6402,0,__PYX_ERR(0, 6402, __pyx_L1_error))
+          __Pyx_TraceLine(6399,0,__PYX_ERR(0, 6399, __pyx_L1_error))
           __pyx_v_y2p = ((__pyx_v_in_cell->points[3])->location[1]);
 
-          /* "discretize/_extensions/tree_ext.pyx":6403
+          /* "discretize/_extensions/tree_ext.pyx":6400
  *                         x2p = in_cell.points[3].location[0]
  *                         y2p = in_cell.points[3].location[1]
  *                         z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0             # <<<<<<<<<<<<<<
  * 
  *                         if x1m == xF[0] or x1p == origin[0]:
  */
-          __Pyx_TraceLine(6403,0,__PYX_ERR(0, 6403, __pyx_L1_error))
+          __Pyx_TraceLine(6400,0,__PYX_ERR(0, 6400, __pyx_L1_error))
           if (((__pyx_v_self->_dim == 3) != 0)) {
             __pyx_t_21 = ((__pyx_v_in_cell->points[7])->location[2]);
           } else {
             __pyx_t_21 = 0.0;
           }
           __pyx_v_z2p = __pyx_t_21;
 
-          /* "discretize/_extensions/tree_ext.pyx":6405
+          /* "discretize/_extensions/tree_ext.pyx":6402
  *                         z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0
  * 
  *                         if x1m == xF[0] or x1p == origin[0]:             # <<<<<<<<<<<<<<
  *                             over_lap_vol = 1.0
  *                         else:
  */
-          __Pyx_TraceLine(6405,0,__PYX_ERR(0, 6405, __pyx_L1_error))
+          __Pyx_TraceLine(6402,0,__PYX_ERR(0, 6402, __pyx_L1_error))
           __pyx_t_16 = 0;
           if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_xF.shape[0];
           __pyx_t_14 = ((__pyx_v_x1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_16 * __pyx_v_xF.strides[0]) )))) != 0);
           if (!__pyx_t_14) {
           } else {
             __pyx_t_12 = __pyx_t_14;
             goto __pyx_L32_bool_binop_done;
@@ -81838,42 +81850,42 @@
           __pyx_t_16 = 0;
           if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_origin.shape[0];
           __pyx_t_14 = ((__pyx_v_x1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_16 * __pyx_v_origin.strides[0]) )))) != 0);
           __pyx_t_12 = __pyx_t_14;
           __pyx_L32_bool_binop_done:;
           if (__pyx_t_12) {
 
-            /* "discretize/_extensions/tree_ext.pyx":6406
+            /* "discretize/_extensions/tree_ext.pyx":6403
  * 
  *                         if x1m == xF[0] or x1p == origin[0]:
  *                             over_lap_vol = 1.0             # <<<<<<<<<<<<<<
  *                         else:
  *                             over_lap_vol = min(x1p, x2p) - max(x1m, x2m)
  */
-            __Pyx_TraceLine(6406,0,__PYX_ERR(0, 6406, __pyx_L1_error))
+            __Pyx_TraceLine(6403,0,__PYX_ERR(0, 6403, __pyx_L1_error))
             __pyx_v_over_lap_vol = 1.0;
 
-            /* "discretize/_extensions/tree_ext.pyx":6405
+            /* "discretize/_extensions/tree_ext.pyx":6402
  *                         z2p = in_cell.points[7].location[2] if self._dim==3 else 0.0
  * 
  *                         if x1m == xF[0] or x1p == origin[0]:             # <<<<<<<<<<<<<<
  *                             over_lap_vol = 1.0
  *                         else:
  */
             goto __pyx_L31;
           }
 
-          /* "discretize/_extensions/tree_ext.pyx":6408
+          /* "discretize/_extensions/tree_ext.pyx":6405
  *                             over_lap_vol = 1.0
  *                         else:
  *                             over_lap_vol = min(x1p, x2p) - max(x1m, x2m)             # <<<<<<<<<<<<<<
  *                         if y1m == xF[1] or y1p == origin[1]:
  *                             over_lap_vol *= 1.0
  */
-          __Pyx_TraceLine(6408,0,__PYX_ERR(0, 6408, __pyx_L1_error))
+          __Pyx_TraceLine(6405,0,__PYX_ERR(0, 6405, __pyx_L1_error))
           /*else*/ {
             __pyx_t_21 = __pyx_v_x2p;
             __pyx_t_22 = __pyx_v_x1p;
             if (((__pyx_t_21 < __pyx_t_22) != 0)) {
               __pyx_t_23 = __pyx_t_21;
             } else {
               __pyx_t_23 = __pyx_t_22;
@@ -81885,22 +81897,22 @@
             } else {
               __pyx_t_32 = __pyx_t_22;
             }
             __pyx_v_over_lap_vol = (__pyx_t_23 - __pyx_t_32);
           }
           __pyx_L31:;
 
-          /* "discretize/_extensions/tree_ext.pyx":6409
+          /* "discretize/_extensions/tree_ext.pyx":6406
  *                         else:
  *                             over_lap_vol = min(x1p, x2p) - max(x1m, x2m)
  *                         if y1m == xF[1] or y1p == origin[1]:             # <<<<<<<<<<<<<<
  *                             over_lap_vol *= 1.0
  *                         else:
  */
-          __Pyx_TraceLine(6409,0,__PYX_ERR(0, 6409, __pyx_L1_error))
+          __Pyx_TraceLine(6406,0,__PYX_ERR(0, 6406, __pyx_L1_error))
           __pyx_t_16 = 1;
           if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_xF.shape[0];
           __pyx_t_14 = ((__pyx_v_y1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_16 * __pyx_v_xF.strides[0]) )))) != 0);
           if (!__pyx_t_14) {
           } else {
             __pyx_t_12 = __pyx_t_14;
             goto __pyx_L35_bool_binop_done;
@@ -81908,42 +81920,42 @@
           __pyx_t_16 = 1;
           if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_origin.shape[0];
           __pyx_t_14 = ((__pyx_v_y1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_16 * __pyx_v_origin.strides[0]) )))) != 0);
           __pyx_t_12 = __pyx_t_14;
           __pyx_L35_bool_binop_done:;
           if (__pyx_t_12) {
 
-            /* "discretize/_extensions/tree_ext.pyx":6410
+            /* "discretize/_extensions/tree_ext.pyx":6407
  *                             over_lap_vol = min(x1p, x2p) - max(x1m, x2m)
  *                         if y1m == xF[1] or y1p == origin[1]:
  *                             over_lap_vol *= 1.0             # <<<<<<<<<<<<<<
  *                         else:
  *                             over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  */
-            __Pyx_TraceLine(6410,0,__PYX_ERR(0, 6410, __pyx_L1_error))
+            __Pyx_TraceLine(6407,0,__PYX_ERR(0, 6407, __pyx_L1_error))
             __pyx_v_over_lap_vol = (__pyx_v_over_lap_vol * 1.0);
 
-            /* "discretize/_extensions/tree_ext.pyx":6409
+            /* "discretize/_extensions/tree_ext.pyx":6406
  *                         else:
  *                             over_lap_vol = min(x1p, x2p) - max(x1m, x2m)
  *                         if y1m == xF[1] or y1p == origin[1]:             # <<<<<<<<<<<<<<
  *                             over_lap_vol *= 1.0
  *                         else:
  */
             goto __pyx_L34;
           }
 
-          /* "discretize/_extensions/tree_ext.pyx":6412
+          /* "discretize/_extensions/tree_ext.pyx":6409
  *                             over_lap_vol *= 1.0
  *                         else:
  *                             over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)             # <<<<<<<<<<<<<<
  *                         if self._dim==3:
  *                             if z1m == xF[2] or z1p == origin[2]:
  */
-          __Pyx_TraceLine(6412,0,__PYX_ERR(0, 6412, __pyx_L1_error))
+          __Pyx_TraceLine(6409,0,__PYX_ERR(0, 6409, __pyx_L1_error))
           /*else*/ {
             __pyx_t_32 = __pyx_v_y2p;
             __pyx_t_23 = __pyx_v_y1p;
             if (((__pyx_t_32 < __pyx_t_23) != 0)) {
               __pyx_t_21 = __pyx_t_32;
             } else {
               __pyx_t_21 = __pyx_t_23;
@@ -81955,33 +81967,33 @@
             } else {
               __pyx_t_22 = __pyx_t_23;
             }
             __pyx_v_over_lap_vol = (__pyx_v_over_lap_vol * (__pyx_t_21 - __pyx_t_22));
           }
           __pyx_L34:;
 
-          /* "discretize/_extensions/tree_ext.pyx":6413
+          /* "discretize/_extensions/tree_ext.pyx":6410
  *                         else:
  *                             over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  *                         if self._dim==3:             # <<<<<<<<<<<<<<
  *                             if z1m == xF[2] or z1p == origin[2]:
  *                                 over_lap_vol *= 1.0
  */
-          __Pyx_TraceLine(6413,0,__PYX_ERR(0, 6413, __pyx_L1_error))
+          __Pyx_TraceLine(6410,0,__PYX_ERR(0, 6410, __pyx_L1_error))
           __pyx_t_12 = ((__pyx_v_self->_dim == 3) != 0);
           if (__pyx_t_12) {
 
-            /* "discretize/_extensions/tree_ext.pyx":6414
+            /* "discretize/_extensions/tree_ext.pyx":6411
  *                             over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  *                         if self._dim==3:
  *                             if z1m == xF[2] or z1p == origin[2]:             # <<<<<<<<<<<<<<
  *                                 over_lap_vol *= 1.0
  *                             else:
  */
-            __Pyx_TraceLine(6414,0,__PYX_ERR(0, 6414, __pyx_L1_error))
+            __Pyx_TraceLine(6411,0,__PYX_ERR(0, 6411, __pyx_L1_error))
             __pyx_t_16 = 2;
             if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_xF.shape[0];
             __pyx_t_14 = ((__pyx_v_z1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_16 * __pyx_v_xF.strides[0]) )))) != 0);
             if (!__pyx_t_14) {
             } else {
               __pyx_t_12 = __pyx_t_14;
               goto __pyx_L39_bool_binop_done;
@@ -81989,42 +82001,42 @@
             __pyx_t_16 = 2;
             if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_origin.shape[0];
             __pyx_t_14 = ((__pyx_v_z1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_16 * __pyx_v_origin.strides[0]) )))) != 0);
             __pyx_t_12 = __pyx_t_14;
             __pyx_L39_bool_binop_done:;
             if (__pyx_t_12) {
 
-              /* "discretize/_extensions/tree_ext.pyx":6415
+              /* "discretize/_extensions/tree_ext.pyx":6412
  *                         if self._dim==3:
  *                             if z1m == xF[2] or z1p == origin[2]:
  *                                 over_lap_vol *= 1.0             # <<<<<<<<<<<<<<
  *                             else:
  *                                 over_lap_vol *= min(z1p, z2p) - max(z1m, z2m)
  */
-              __Pyx_TraceLine(6415,0,__PYX_ERR(0, 6415, __pyx_L1_error))
+              __Pyx_TraceLine(6412,0,__PYX_ERR(0, 6412, __pyx_L1_error))
               __pyx_v_over_lap_vol = (__pyx_v_over_lap_vol * 1.0);
 
-              /* "discretize/_extensions/tree_ext.pyx":6414
+              /* "discretize/_extensions/tree_ext.pyx":6411
  *                             over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  *                         if self._dim==3:
  *                             if z1m == xF[2] or z1p == origin[2]:             # <<<<<<<<<<<<<<
  *                                 over_lap_vol *= 1.0
  *                             else:
  */
               goto __pyx_L38;
             }
 
-            /* "discretize/_extensions/tree_ext.pyx":6417
+            /* "discretize/_extensions/tree_ext.pyx":6414
  *                                 over_lap_vol *= 1.0
  *                             else:
  *                                 over_lap_vol *= min(z1p, z2p) - max(z1m, z2m)             # <<<<<<<<<<<<<<
  * 
  *                         weights[i] = over_lap_vol
  */
-            __Pyx_TraceLine(6417,0,__PYX_ERR(0, 6417, __pyx_L1_error))
+            __Pyx_TraceLine(6414,0,__PYX_ERR(0, 6414, __pyx_L1_error))
             /*else*/ {
               __pyx_t_22 = __pyx_v_z2p;
               __pyx_t_21 = __pyx_v_z1p;
               if (((__pyx_t_22 < __pyx_t_21) != 0)) {
                 __pyx_t_32 = __pyx_t_22;
               } else {
                 __pyx_t_32 = __pyx_t_21;
@@ -82036,392 +82048,392 @@
               } else {
                 __pyx_t_23 = __pyx_t_21;
               }
               __pyx_v_over_lap_vol = (__pyx_v_over_lap_vol * (__pyx_t_32 - __pyx_t_23));
             }
             __pyx_L38:;
 
-            /* "discretize/_extensions/tree_ext.pyx":6413
+            /* "discretize/_extensions/tree_ext.pyx":6410
  *                         else:
  *                             over_lap_vol *= min(y1p, y2p) - max(y1m, y2m)
  *                         if self._dim==3:             # <<<<<<<<<<<<<<
  *                             if z1m == xF[2] or z1p == origin[2]:
  *                                 over_lap_vol *= 1.0
  */
           }
 
-          /* "discretize/_extensions/tree_ext.pyx":6419
+          /* "discretize/_extensions/tree_ext.pyx":6416
  *                                 over_lap_vol *= min(z1p, z2p) - max(z1m, z2m)
  * 
  *                         weights[i] = over_lap_vol             # <<<<<<<<<<<<<<
  *                         if build_mat and weights[i] != 0.0:
  *                             nnz_row += 1
  */
-          __Pyx_TraceLine(6419,0,__PYX_ERR(0, 6419, __pyx_L1_error))
+          __Pyx_TraceLine(6416,0,__PYX_ERR(0, 6416, __pyx_L1_error))
           (__pyx_v_weights[__pyx_v_i]) = __pyx_v_over_lap_vol;
 
-          /* "discretize/_extensions/tree_ext.pyx":6420
+          /* "discretize/_extensions/tree_ext.pyx":6417
  * 
  *                         weights[i] = over_lap_vol
  *                         if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                             nnz_row += 1
  *                             row_inds.push_back(in_cell_ind)
  */
-          __Pyx_TraceLine(6420,0,__PYX_ERR(0, 6420, __pyx_L1_error))
+          __Pyx_TraceLine(6417,0,__PYX_ERR(0, 6417, __pyx_L1_error))
           __pyx_t_14 = (__pyx_v_build_mat != 0);
           if (__pyx_t_14) {
           } else {
             __pyx_t_12 = __pyx_t_14;
             goto __pyx_L42_bool_binop_done;
           }
           __pyx_t_14 = (((__pyx_v_weights[__pyx_v_i]) != 0.0) != 0);
           __pyx_t_12 = __pyx_t_14;
           __pyx_L42_bool_binop_done:;
           if (__pyx_t_12) {
 
-            /* "discretize/_extensions/tree_ext.pyx":6421
+            /* "discretize/_extensions/tree_ext.pyx":6418
  *                         weights[i] = over_lap_vol
  *                         if build_mat and weights[i] != 0.0:
  *                             nnz_row += 1             # <<<<<<<<<<<<<<
  *                             row_inds.push_back(in_cell_ind)
  *                         weight_sum += weights[i]
  */
-            __Pyx_TraceLine(6421,0,__PYX_ERR(0, 6421, __pyx_L1_error))
+            __Pyx_TraceLine(6418,0,__PYX_ERR(0, 6418, __pyx_L1_error))
             __pyx_v_nnz_row = (__pyx_v_nnz_row + 1);
 
-            /* "discretize/_extensions/tree_ext.pyx":6422
+            /* "discretize/_extensions/tree_ext.pyx":6419
  *                         if build_mat and weights[i] != 0.0:
  *                             nnz_row += 1
  *                             row_inds.push_back(in_cell_ind)             # <<<<<<<<<<<<<<
  *                         weight_sum += weights[i]
  *                         i += 1
  */
-            __Pyx_TraceLine(6422,0,__PYX_ERR(0, 6422, __pyx_L1_error))
+            __Pyx_TraceLine(6419,0,__PYX_ERR(0, 6419, __pyx_L1_error))
             try {
               __pyx_v_row_inds.push_back(__pyx_v_in_cell_ind);
             } catch(...) {
               __Pyx_CppExn2PyErr();
-              __PYX_ERR(0, 6422, __pyx_L1_error)
+              __PYX_ERR(0, 6419, __pyx_L1_error)
             }
 
-            /* "discretize/_extensions/tree_ext.pyx":6420
+            /* "discretize/_extensions/tree_ext.pyx":6417
  * 
  *                         weights[i] = over_lap_vol
  *                         if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                             nnz_row += 1
  *                             row_inds.push_back(in_cell_ind)
  */
           }
 
-          /* "discretize/_extensions/tree_ext.pyx":6423
+          /* "discretize/_extensions/tree_ext.pyx":6420
  *                             nnz_row += 1
  *                             row_inds.push_back(in_cell_ind)
  *                         weight_sum += weights[i]             # <<<<<<<<<<<<<<
  *                         i += 1
  *                     for i in range(n_overlap):
  */
-          __Pyx_TraceLine(6423,0,__PYX_ERR(0, 6423, __pyx_L1_error))
+          __Pyx_TraceLine(6420,0,__PYX_ERR(0, 6420, __pyx_L1_error))
           __pyx_v_weight_sum = (__pyx_v_weight_sum + (__pyx_v_weights[__pyx_v_i]));
 
-          /* "discretize/_extensions/tree_ext.pyx":6424
+          /* "discretize/_extensions/tree_ext.pyx":6421
  *                             row_inds.push_back(in_cell_ind)
  *                         weight_sum += weights[i]
  *                         i += 1             # <<<<<<<<<<<<<<
  *                     for i in range(n_overlap):
  *                         weights[i] /= weight_sum
  */
-          __Pyx_TraceLine(6424,0,__PYX_ERR(0, 6424, __pyx_L1_error))
+          __Pyx_TraceLine(6421,0,__PYX_ERR(0, 6421, __pyx_L1_error))
           __pyx_v_i = (__pyx_v_i + 1);
 
-          /* "discretize/_extensions/tree_ext.pyx":6396
+          /* "discretize/_extensions/tree_ext.pyx":6393
  *                     weight_sum = 0.0
  *                     nnz_row = 0
  *                     for in_cell_ind in overlapping_cell_inds:             # <<<<<<<<<<<<<<
  *                         in_cell = self.tree.cells[in_cell_ind]
  *                         x2m = in_cell.points[0].location[0]
  */
-          __Pyx_TraceLine(6396,0,__PYX_ERR(0, 6396, __pyx_L1_error))
+          __Pyx_TraceLine(6393,0,__PYX_ERR(0, 6393, __pyx_L1_error))
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6425
+        /* "discretize/_extensions/tree_ext.pyx":6422
  *                         weight_sum += weights[i]
  *                         i += 1
  *                     for i in range(n_overlap):             # <<<<<<<<<<<<<<
  *                         weights[i] /= weight_sum
  *                         if build_mat and weights[i] != 0.0:
  */
-        __Pyx_TraceLine(6425,0,__PYX_ERR(0, 6425, __pyx_L1_error))
+        __Pyx_TraceLine(6422,0,__PYX_ERR(0, 6422, __pyx_L1_error))
         __pyx_t_31 = __pyx_v_n_overlap;
         __pyx_t_33 = __pyx_t_31;
         for (__pyx_t_34 = 0; __pyx_t_34 < __pyx_t_33; __pyx_t_34+=1) {
           __pyx_v_i = __pyx_t_34;
 
-          /* "discretize/_extensions/tree_ext.pyx":6426
+          /* "discretize/_extensions/tree_ext.pyx":6423
  *                         i += 1
  *                     for i in range(n_overlap):
  *                         weights[i] /= weight_sum             # <<<<<<<<<<<<<<
  *                         if build_mat and weights[i] != 0.0:
  *                             all_weights.push_back(weights[i])
  */
-          __Pyx_TraceLine(6426,0,__PYX_ERR(0, 6426, __pyx_L1_error))
+          __Pyx_TraceLine(6423,0,__PYX_ERR(0, 6423, __pyx_L1_error))
           __pyx_t_35 = __pyx_v_i;
           (__pyx_v_weights[__pyx_t_35]) = ((__pyx_v_weights[__pyx_t_35]) / __pyx_v_weight_sum);
 
-          /* "discretize/_extensions/tree_ext.pyx":6427
+          /* "discretize/_extensions/tree_ext.pyx":6424
  *                     for i in range(n_overlap):
  *                         weights[i] /= weight_sum
  *                         if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                             all_weights.push_back(weights[i])
  * 
  */
-          __Pyx_TraceLine(6427,0,__PYX_ERR(0, 6427, __pyx_L1_error))
+          __Pyx_TraceLine(6424,0,__PYX_ERR(0, 6424, __pyx_L1_error))
           __pyx_t_14 = (__pyx_v_build_mat != 0);
           if (__pyx_t_14) {
           } else {
             __pyx_t_12 = __pyx_t_14;
             goto __pyx_L47_bool_binop_done;
           }
           __pyx_t_14 = (((__pyx_v_weights[__pyx_v_i]) != 0.0) != 0);
           __pyx_t_12 = __pyx_t_14;
           __pyx_L47_bool_binop_done:;
           if (__pyx_t_12) {
 
-            /* "discretize/_extensions/tree_ext.pyx":6428
+            /* "discretize/_extensions/tree_ext.pyx":6425
  *                         weights[i] /= weight_sum
  *                         if build_mat and weights[i] != 0.0:
  *                             all_weights.push_back(weights[i])             # <<<<<<<<<<<<<<
  * 
  *                     if not build_mat:
  */
-            __Pyx_TraceLine(6428,0,__PYX_ERR(0, 6428, __pyx_L1_error))
+            __Pyx_TraceLine(6425,0,__PYX_ERR(0, 6425, __pyx_L1_error))
             try {
               __pyx_v_all_weights.push_back((__pyx_v_weights[__pyx_v_i]));
             } catch(...) {
               __Pyx_CppExn2PyErr();
-              __PYX_ERR(0, 6428, __pyx_L1_error)
+              __PYX_ERR(0, 6425, __pyx_L1_error)
             }
 
-            /* "discretize/_extensions/tree_ext.pyx":6427
+            /* "discretize/_extensions/tree_ext.pyx":6424
  *                     for i in range(n_overlap):
  *                         weights[i] /= weight_sum
  *                         if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                             all_weights.push_back(weights[i])
  * 
  */
           }
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6430
+        /* "discretize/_extensions/tree_ext.pyx":6427
  *                             all_weights.push_back(weights[i])
  * 
  *                     if not build_mat:             # <<<<<<<<<<<<<<
  *                         for i in range(n_overlap):
  *                             outs[ix, iy, iz] += vals[overlapping_cell_inds[i]]*weights[i]
  */
-        __Pyx_TraceLine(6430,0,__PYX_ERR(0, 6430, __pyx_L1_error))
+        __Pyx_TraceLine(6427,0,__PYX_ERR(0, 6427, __pyx_L1_error))
         __pyx_t_12 = ((!(__pyx_v_build_mat != 0)) != 0);
         if (__pyx_t_12) {
 
-          /* "discretize/_extensions/tree_ext.pyx":6431
+          /* "discretize/_extensions/tree_ext.pyx":6428
  * 
  *                     if not build_mat:
  *                         for i in range(n_overlap):             # <<<<<<<<<<<<<<
  *                             outs[ix, iy, iz] += vals[overlapping_cell_inds[i]]*weights[i]
  *                     else:
  */
-          __Pyx_TraceLine(6431,0,__PYX_ERR(0, 6431, __pyx_L1_error))
+          __Pyx_TraceLine(6428,0,__PYX_ERR(0, 6428, __pyx_L1_error))
           __pyx_t_31 = __pyx_v_n_overlap;
           __pyx_t_33 = __pyx_t_31;
           for (__pyx_t_34 = 0; __pyx_t_34 < __pyx_t_33; __pyx_t_34+=1) {
             __pyx_v_i = __pyx_t_34;
 
-            /* "discretize/_extensions/tree_ext.pyx":6432
+            /* "discretize/_extensions/tree_ext.pyx":6429
  *                     if not build_mat:
  *                         for i in range(n_overlap):
  *                             outs[ix, iy, iz] += vals[overlapping_cell_inds[i]]*weights[i]             # <<<<<<<<<<<<<<
  *                     else:
  *                         nnz_counter += nnz_row
  */
-            __Pyx_TraceLine(6432,0,__PYX_ERR(0, 6432, __pyx_L1_error))
+            __Pyx_TraceLine(6429,0,__PYX_ERR(0, 6429, __pyx_L1_error))
             __pyx_t_16 = (__pyx_v_overlapping_cell_inds[__pyx_v_i]);
             if (__pyx_t_16 < 0) __pyx_t_16 += __pyx_v_vals.shape[0];
             __pyx_t_36 = __pyx_v_ix;
             __pyx_t_37 = __pyx_v_iy;
             __pyx_t_38 = __pyx_v_iz;
             if (__pyx_t_36 < 0) __pyx_t_36 += __pyx_v_outs.shape[0];
             if (__pyx_t_37 < 0) __pyx_t_37 += __pyx_v_outs.shape[1];
             if (__pyx_t_38 < 0) __pyx_t_38 += __pyx_v_outs.shape[2];
             *((__pyx_t_5numpy_float64_t *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ ((char *) (((__pyx_t_5numpy_float64_t *) __pyx_v_outs.data) + __pyx_t_36)) ) + __pyx_t_37 * __pyx_v_outs.strides[1]) ) + __pyx_t_38 * __pyx_v_outs.strides[2]) )) += ((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_vals.data + __pyx_t_16 * __pyx_v_vals.strides[0]) ))) * (__pyx_v_weights[__pyx_v_i]));
           }
 
-          /* "discretize/_extensions/tree_ext.pyx":6430
+          /* "discretize/_extensions/tree_ext.pyx":6427
  *                             all_weights.push_back(weights[i])
  * 
  *                     if not build_mat:             # <<<<<<<<<<<<<<
  *                         for i in range(n_overlap):
  *                             outs[ix, iy, iz] += vals[overlapping_cell_inds[i]]*weights[i]
  */
           goto __pyx_L49;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6434
+        /* "discretize/_extensions/tree_ext.pyx":6431
  *                             outs[ix, iy, iz] += vals[overlapping_cell_inds[i]]*weights[i]
  *                     else:
  *                         nnz_counter += nnz_row             # <<<<<<<<<<<<<<
  *                         indptr.push_back(nnz_counter)
  * 
  */
-        __Pyx_TraceLine(6434,0,__PYX_ERR(0, 6434, __pyx_L1_error))
+        __Pyx_TraceLine(6431,0,__PYX_ERR(0, 6431, __pyx_L1_error))
         /*else*/ {
           __pyx_v_nnz_counter = (__pyx_v_nnz_counter + __pyx_v_nnz_row);
 
-          /* "discretize/_extensions/tree_ext.pyx":6435
+          /* "discretize/_extensions/tree_ext.pyx":6432
  *                     else:
  *                         nnz_counter += nnz_row
  *                         indptr.push_back(nnz_counter)             # <<<<<<<<<<<<<<
  * 
  *                     free(weights)
  */
-          __Pyx_TraceLine(6435,0,__PYX_ERR(0, 6435, __pyx_L1_error))
+          __Pyx_TraceLine(6432,0,__PYX_ERR(0, 6432, __pyx_L1_error))
           try {
             __pyx_v_indptr.push_back(__pyx_v_nnz_counter);
           } catch(...) {
             __Pyx_CppExn2PyErr();
-            __PYX_ERR(0, 6435, __pyx_L1_error)
+            __PYX_ERR(0, 6432, __pyx_L1_error)
           }
         }
         __pyx_L49:;
 
-        /* "discretize/_extensions/tree_ext.pyx":6437
+        /* "discretize/_extensions/tree_ext.pyx":6434
  *                         indptr.push_back(nnz_counter)
  * 
  *                     free(weights)             # <<<<<<<<<<<<<<
  *                     overlapping_cell_inds.clear()
  * 
  */
-        __Pyx_TraceLine(6437,0,__PYX_ERR(0, 6437, __pyx_L1_error))
+        __Pyx_TraceLine(6434,0,__PYX_ERR(0, 6434, __pyx_L1_error))
         free(__pyx_v_weights);
 
-        /* "discretize/_extensions/tree_ext.pyx":6438
+        /* "discretize/_extensions/tree_ext.pyx":6435
  * 
  *                     free(weights)
  *                     overlapping_cell_inds.clear()             # <<<<<<<<<<<<<<
  * 
  *         if not build_mat:
  */
-        __Pyx_TraceLine(6438,0,__PYX_ERR(0, 6438, __pyx_L1_error))
+        __Pyx_TraceLine(6435,0,__PYX_ERR(0, 6435, __pyx_L1_error))
         __pyx_v_overlapping_cell_inds.clear();
       }
     }
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6440
+  /* "discretize/_extensions/tree_ext.pyx":6437
  *                     overlapping_cell_inds.clear()
  * 
  *         if not build_mat:             # <<<<<<<<<<<<<<
  *             return output.reshape(-1, order='F')
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(out_tens_mesh.n_cells, self.n_cells))
  */
-  __Pyx_TraceLine(6440,0,__PYX_ERR(0, 6440, __pyx_L1_error))
+  __Pyx_TraceLine(6437,0,__PYX_ERR(0, 6437, __pyx_L1_error))
   __pyx_t_12 = ((!(__pyx_v_build_mat != 0)) != 0);
   if (__pyx_t_12) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6441
+    /* "discretize/_extensions/tree_ext.pyx":6438
  * 
  *         if not build_mat:
  *             return output.reshape(-1, order='F')             # <<<<<<<<<<<<<<
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(out_tens_mesh.n_cells, self.n_cells))
  * 
  */
-    __Pyx_TraceLine(6441,0,__PYX_ERR(0, 6441, __pyx_L1_error))
+    __Pyx_TraceLine(6438,0,__PYX_ERR(0, 6438, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_output, __pyx_n_s_reshape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6441, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_output, __pyx_n_s_reshape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6438, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6441, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6438, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 6441, __pyx_L1_error)
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__44, __pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6441, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 6438, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__44, __pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6438, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6440
+    /* "discretize/_extensions/tree_ext.pyx":6437
  *                     overlapping_cell_inds.clear()
  * 
  *         if not build_mat:             # <<<<<<<<<<<<<<
  *             return output.reshape(-1, order='F')
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(out_tens_mesh.n_cells, self.n_cells))
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6442
+  /* "discretize/_extensions/tree_ext.pyx":6439
  *         if not build_mat:
  *             return output.reshape(-1, order='F')
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(out_tens_mesh.n_cells, self.n_cells))             # <<<<<<<<<<<<<<
  * 
  *     @cython.boundscheck(False)
  */
-  __Pyx_TraceLine(6442,0,__PYX_ERR(0, 6442, __pyx_L1_error))
+  __Pyx_TraceLine(6439,0,__PYX_ERR(0, 6439, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_sp); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-  __pyx_t_6 = __pyx_convert_vector_to_py_double(__pyx_v_all_weights); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_6 = __pyx_convert_vector_to_py_double(__pyx_v_all_weights); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_5 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_5 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_9 = __pyx_convert_vector_to_py_int_t(__pyx_v_indptr); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_9 = __pyx_convert_vector_to_py_int_t(__pyx_v_indptr); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_6);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_9);
   PyTuple_SET_ITEM(__pyx_t_11, 2, __pyx_t_9);
   __pyx_t_6 = 0;
   __pyx_t_5 = 0;
   __pyx_t_9 = 0;
-  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_GIVEREF(__pyx_t_11);
   PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_11);
   __pyx_t_11 = 0;
-  __pyx_t_11 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_11 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_11);
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_out_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
-  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_5);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5);
   __Pyx_GIVEREF(__pyx_t_6);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_6);
   __pyx_t_5 = 0;
   __pyx_t_6 = 0;
-  if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 6442, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_shape, __pyx_t_7) < 0) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_9, __pyx_t_11); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6442, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_9, __pyx_t_11); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6439, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
   __pyx_r = __pyx_t_7;
   __pyx_t_7 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6302
+  /* "discretize/_extensions/tree_ext.pyx":6299
  *     @cython.boundscheck(False)
  *     @cython.cdivision(True)
  *     def _vol_avg_to_tens(self, out_tens_mesh, values=None, output=None):             # <<<<<<<<<<<<<<
  *         cdef vector[int_t] *overlapping_cells
  *         cdef double *weights
  */
 
@@ -82450,15 +82462,15 @@
   __Pyx_XDECREF(__pyx_v_output);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6446
+/* "discretize/_extensions/tree_ext.pyx":6443
  *     @cython.boundscheck(False)
  *     @cython.cdivision(True)
  *     def _vol_avg_from_tens(self, in_tens_mesh, values=None, output=None):             # <<<<<<<<<<<<<<
  *         cdef double *weights
  *         cdef double over_lap_vol
  */
 
@@ -82508,15 +82520,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_output);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_vol_avg_from_tens") < 0)) __PYX_ERR(0, 6446, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "_vol_avg_from_tens") < 0)) __PYX_ERR(0, 6443, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -82527,15 +82539,15 @@
     }
     __pyx_v_in_tens_mesh = values[0];
     __pyx_v_values = values[1];
     __pyx_v_output = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("_vol_avg_from_tens", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 6446, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("_vol_avg_from_tens", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 6443, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._vol_avg_from_tens", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_pf_10discretize_11_extensions_8tree_ext_9_TreeMesh_100_vol_avg_from_tens(((struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *)__pyx_v_self), __pyx_v_in_tens_mesh, __pyx_v_values, __pyx_v_output);
 
@@ -82640,66 +82652,66 @@
   Py_ssize_t __pyx_t_38;
   Py_ssize_t __pyx_t_39;
   PY_LONG_LONG __pyx_t_40;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_vol_avg_from_tens", 0);
-  __Pyx_TraceCall("_vol_avg_from_tens", __pyx_f[0], 6446, 0, __PYX_ERR(0, 6446, __pyx_L1_error));
+  __Pyx_TraceCall("_vol_avg_from_tens", __pyx_f[0], 6443, 0, __PYX_ERR(0, 6443, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_output);
 
-  /* "discretize/_extensions/tree_ext.pyx":6452
+  /* "discretize/_extensions/tree_ext.pyx":6449
  *         cdef double x2m, x2p, y2m, y2p, z2m, z2p
  *         cdef int_t ix, ix1, ix2, iy, iy1, iy2, iz, iz1, iz2
  *         cdef double[:] origin = in_tens_mesh.origin             # <<<<<<<<<<<<<<
  *         cdef double[:] xF
  * 
  */
-  __Pyx_TraceLine(6452,0,__PYX_ERR(0, 6452, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_origin); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6452, __pyx_L1_error)
+  __Pyx_TraceLine(6449,0,__PYX_ERR(0, 6449, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_origin); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6449, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 6452, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 6449, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_origin = __pyx_t_2;
   __pyx_t_2.memview = NULL;
   __pyx_t_2.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6457
+  /* "discretize/_extensions/tree_ext.pyx":6454
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, in_tens_mesh.nodes_x)
  */
-  __Pyx_TraceLine(6457,0,__PYX_ERR(0, 6457, __pyx_L1_error))
+  __Pyx_TraceLine(6454,0,__PYX_ERR(0, 6454, __pyx_L1_error))
   {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_3, &__pyx_t_4, &__pyx_t_5);
     __Pyx_XGOTREF(__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_4);
     __Pyx_XGOTREF(__pyx_t_5);
     /*try:*/ {
 
-      /* "discretize/_extensions/tree_ext.pyx":6459
+      /* "discretize/_extensions/tree_ext.pyx":6456
  *         try:
  *             same_base = (
  *                 np.allclose(self.nodes_x, in_tens_mesh.nodes_x)             # <<<<<<<<<<<<<<
  *                 and np.allclose(self.nodes_y, in_tens_mesh.nodes_y)
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, in_tens_mesh.nodes_z))
  */
-      __Pyx_TraceLine(6459,0,__PYX_ERR(0, 6459, __pyx_L3_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6459, __pyx_L3_error)
+      __Pyx_TraceLine(6456,0,__PYX_ERR(0, 6456, __pyx_L3_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6456, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_allclose); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6459, __pyx_L3_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_allclose); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6456, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6459, __pyx_L3_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6456, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6459, __pyx_L3_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6456, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_10 = NULL;
       __pyx_t_11 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
         __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_8);
         if (likely(__pyx_t_10)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -82708,74 +82720,74 @@
           __Pyx_DECREF_SET(__pyx_t_8, function);
           __pyx_t_11 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_8)) {
         PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_9};
-        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6459, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6456, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_8)) {
         PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_t_7, __pyx_t_9};
-        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6459, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_8, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6456, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else
       #endif
       {
-        __pyx_t_12 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6459, __pyx_L3_error)
+        __pyx_t_12 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6456, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_12);
         if (__pyx_t_10) {
           __Pyx_GIVEREF(__pyx_t_10); PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10); __pyx_t_10 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_7);
         PyTuple_SET_ITEM(__pyx_t_12, 0+__pyx_t_11, __pyx_t_7);
         __Pyx_GIVEREF(__pyx_t_9);
         PyTuple_SET_ITEM(__pyx_t_12, 1+__pyx_t_11, __pyx_t_9);
         __pyx_t_7 = 0;
         __pyx_t_9 = 0;
-        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6459, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6456, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       }
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 6459, __pyx_L3_error)
+      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 6456, __pyx_L3_error)
       if (__pyx_t_13) {
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       } else {
-        __pyx_t_14 = __Pyx_PyInt_As_int_t(__pyx_t_1); if (unlikely((__pyx_t_14 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6459, __pyx_L3_error)
+        __pyx_t_14 = __Pyx_PyInt_As_int_t(__pyx_t_1); if (unlikely((__pyx_t_14 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6456, __pyx_L3_error)
         __pyx_t_6 = __pyx_t_14;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L9_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6460
+      /* "discretize/_extensions/tree_ext.pyx":6457
  *             same_base = (
  *                 np.allclose(self.nodes_x, in_tens_mesh.nodes_x)
  *                 and np.allclose(self.nodes_y, in_tens_mesh.nodes_y)             # <<<<<<<<<<<<<<
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, in_tens_mesh.nodes_z))
  *             )
  */
-      __Pyx_TraceLine(6460,0,__PYX_ERR(0, 6460, __pyx_L3_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6460, __pyx_L3_error)
+      __Pyx_TraceLine(6457,0,__PYX_ERR(0, 6457, __pyx_L3_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6457, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_allclose); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6460, __pyx_L3_error)
+      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_allclose); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6457, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6460, __pyx_L3_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6457, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6460, __pyx_L3_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6457, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_7 = NULL;
       __pyx_t_11 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_12))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_12);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
@@ -82784,88 +82796,88 @@
           __Pyx_DECREF_SET(__pyx_t_12, function);
           __pyx_t_11 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_12)) {
         PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_8, __pyx_t_9};
-        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6460, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6457, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_12)) {
         PyObject *__pyx_temp[3] = {__pyx_t_7, __pyx_t_8, __pyx_t_9};
-        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6460, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6457, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else
       #endif
       {
-        __pyx_t_10 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6460, __pyx_L3_error)
+        __pyx_t_10 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6457, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_10);
         if (__pyx_t_7) {
           __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_7); __pyx_t_7 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_11, __pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_9);
         PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_11, __pyx_t_9);
         __pyx_t_8 = 0;
         __pyx_t_9 = 0;
-        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6460, __pyx_L3_error)
+        __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6457, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_1);
         __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       }
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 6460, __pyx_L3_error)
+      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 6457, __pyx_L3_error)
       if (__pyx_t_13) {
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       } else {
-        __pyx_t_14 = __Pyx_PyInt_As_int_t(__pyx_t_1); if (unlikely((__pyx_t_14 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6460, __pyx_L3_error)
+        __pyx_t_14 = __Pyx_PyInt_As_int_t(__pyx_t_1); if (unlikely((__pyx_t_14 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6457, __pyx_L3_error)
         __pyx_t_6 = __pyx_t_14;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L9_bool_binop_done;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6461
+      /* "discretize/_extensions/tree_ext.pyx":6458
  *                 np.allclose(self.nodes_x, in_tens_mesh.nodes_x)
  *                 and np.allclose(self.nodes_y, in_tens_mesh.nodes_y)
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, in_tens_mesh.nodes_z))             # <<<<<<<<<<<<<<
  *             )
  *         except ValueError:
  */
-      __Pyx_TraceLine(6461,0,__PYX_ERR(0, 6461, __pyx_L3_error))
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6461, __pyx_L3_error)
+      __Pyx_TraceLine(6458,0,__PYX_ERR(0, 6458, __pyx_L3_error))
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6458, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_12 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6461, __pyx_L3_error)
+      __pyx_t_12 = __Pyx_PyInt_EqObjC(__pyx_t_1, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6458, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_12); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 6461, __pyx_L3_error)
+      __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_12); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 6458, __pyx_L3_error)
       if (!__pyx_t_13) {
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       } else {
-        __pyx_t_14 = __Pyx_PyInt_As_int_t(__pyx_t_12); if (unlikely((__pyx_t_14 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6461, __pyx_L3_error)
+        __pyx_t_14 = __Pyx_PyInt_As_int_t(__pyx_t_12); if (unlikely((__pyx_t_14 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6458, __pyx_L3_error)
         __pyx_t_6 = __pyx_t_14;
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
         goto __pyx_L9_bool_binop_done;
       }
-      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6461, __pyx_L3_error)
+      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6458, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_allclose); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6461, __pyx_L3_error)
+      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_allclose); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6458, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6461, __pyx_L3_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6458, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6461, __pyx_L3_error)
+      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6458, __pyx_L3_error)
       __Pyx_GOTREF(__pyx_t_9);
       __pyx_t_8 = NULL;
       __pyx_t_11 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
         __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_10);
         if (likely(__pyx_t_8)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
@@ -82874,55 +82886,55 @@
           __Pyx_DECREF_SET(__pyx_t_10, function);
           __pyx_t_11 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_10)) {
         PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_1, __pyx_t_9};
-        __pyx_t_12 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6461, __pyx_L3_error)
+        __pyx_t_12 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6458, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
         PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_t_1, __pyx_t_9};
-        __pyx_t_12 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6461, __pyx_L3_error)
+        __pyx_t_12 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6458, __pyx_L3_error)
         __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       } else
       #endif
       {
-        __pyx_t_7 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6461, __pyx_L3_error)
+        __pyx_t_7 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6458, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_7);
         if (__pyx_t_8) {
           __Pyx_GIVEREF(__pyx_t_8); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_8); __pyx_t_8 = NULL;
         }
         __Pyx_GIVEREF(__pyx_t_1);
         PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_11, __pyx_t_1);
         __Pyx_GIVEREF(__pyx_t_9);
         PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_11, __pyx_t_9);
         __pyx_t_1 = 0;
         __pyx_t_9 = 0;
-        __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_7, NULL); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6461, __pyx_L3_error)
+        __pyx_t_12 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_7, NULL); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6458, __pyx_L3_error)
         __Pyx_GOTREF(__pyx_t_12);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       }
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __pyx_t_14 = __Pyx_PyInt_As_int_t(__pyx_t_12); if (unlikely((__pyx_t_14 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6461, __pyx_L3_error)
+      __pyx_t_14 = __Pyx_PyInt_As_int_t(__pyx_t_12); if (unlikely((__pyx_t_14 == ((int_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 6458, __pyx_L3_error)
       __pyx_t_6 = __pyx_t_14;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
       __pyx_L9_bool_binop_done:;
       __pyx_v_same_base = __pyx_t_6;
 
-      /* "discretize/_extensions/tree_ext.pyx":6457
+      /* "discretize/_extensions/tree_ext.pyx":6454
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, in_tens_mesh.nodes_x)
  */
     }
@@ -82935,48 +82947,48 @@
     __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_t_2, 1);
     __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6463
+    /* "discretize/_extensions/tree_ext.pyx":6460
  *                 and (self.dim == 2 or np.allclose(self.nodes_z, in_tens_mesh.nodes_z))
  *             )
  *         except ValueError:             # <<<<<<<<<<<<<<
  *             same_base = False
  * 
  */
-    __Pyx_TraceLine(6463,0,__PYX_ERR(0, 6463, __pyx_L5_except_error))
+    __Pyx_TraceLine(6460,0,__PYX_ERR(0, 6460, __pyx_L5_except_error))
     __pyx_t_11 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ValueError);
     if (__pyx_t_11) {
       __Pyx_AddTraceback("discretize._extensions.tree_ext._TreeMesh._vol_avg_from_tens", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_12, &__pyx_t_10, &__pyx_t_7) < 0) __PYX_ERR(0, 6463, __pyx_L5_except_error)
+      if (__Pyx_GetException(&__pyx_t_12, &__pyx_t_10, &__pyx_t_7) < 0) __PYX_ERR(0, 6460, __pyx_L5_except_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_GOTREF(__pyx_t_7);
 
-      /* "discretize/_extensions/tree_ext.pyx":6464
+      /* "discretize/_extensions/tree_ext.pyx":6461
  *             )
  *         except ValueError:
  *             same_base = False             # <<<<<<<<<<<<<<
  * 
  * 
  */
-      __Pyx_TraceLine(6464,0,__PYX_ERR(0, 6464, __pyx_L5_except_error))
+      __Pyx_TraceLine(6461,0,__PYX_ERR(0, 6461, __pyx_L5_except_error))
       __pyx_v_same_base = 0;
       __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
       __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       goto __pyx_L4_exception_handled;
     }
     goto __pyx_L5_except_error;
     __pyx_L5_except_error:;
 
-    /* "discretize/_extensions/tree_ext.pyx":6457
+    /* "discretize/_extensions/tree_ext.pyx":6454
  *         # first check if they have the same tensor base, as it makes it a lot easier...
  *         cdef int_t same_base
  *         try:             # <<<<<<<<<<<<<<
  *             same_base = (
  *                 np.allclose(self.nodes_x, in_tens_mesh.nodes_x)
  */
     __Pyx_XGIVEREF(__pyx_t_3);
@@ -82988,159 +83000,159 @@
     __Pyx_XGIVEREF(__pyx_t_3);
     __Pyx_XGIVEREF(__pyx_t_4);
     __Pyx_XGIVEREF(__pyx_t_5);
     __Pyx_ExceptionReset(__pyx_t_3, __pyx_t_4, __pyx_t_5);
     __pyx_L8_try_end:;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6467
+  /* "discretize/_extensions/tree_ext.pyx":6464
  * 
  * 
  *         if same_base:             # <<<<<<<<<<<<<<
  *             out_cell_inds = self._get_containing_cell_indexes(in_tens_mesh.cell_centers)
  *             ws = in_tens_mesh.cell_volumes/self.cell_volumes[out_cell_inds]
  */
-  __Pyx_TraceLine(6467,0,__PYX_ERR(0, 6467, __pyx_L1_error))
+  __Pyx_TraceLine(6464,0,__PYX_ERR(0, 6464, __pyx_L1_error))
   __pyx_t_13 = (__pyx_v_same_base != 0);
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6468
+    /* "discretize/_extensions/tree_ext.pyx":6465
  * 
  *         if same_base:
  *             out_cell_inds = self._get_containing_cell_indexes(in_tens_mesh.cell_centers)             # <<<<<<<<<<<<<<
  *             ws = in_tens_mesh.cell_volumes/self.cell_volumes[out_cell_inds]
  *             if values is not None:
  */
-    __Pyx_TraceLine(6468,0,__PYX_ERR(0, 6468, __pyx_L1_error))
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_containing_cell_indexes); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6468, __pyx_L1_error)
+    __Pyx_TraceLine(6465,0,__PYX_ERR(0, 6465, __pyx_L1_error))
+    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_containing_cell_indexes); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6465, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_cell_centers); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6468, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_cell_centers); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6465, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __pyx_t_9 = NULL;
     if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_10))) {
       __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_10);
       if (likely(__pyx_t_9)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
         __Pyx_INCREF(__pyx_t_9);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_10, function);
       }
     }
     __pyx_t_7 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_9, __pyx_t_12) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_12);
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6468, __pyx_L1_error)
+    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6465, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_v_out_cell_inds = __pyx_t_7;
     __pyx_t_7 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6469
+    /* "discretize/_extensions/tree_ext.pyx":6466
  *         if same_base:
  *             out_cell_inds = self._get_containing_cell_indexes(in_tens_mesh.cell_centers)
  *             ws = in_tens_mesh.cell_volumes/self.cell_volumes[out_cell_inds]             # <<<<<<<<<<<<<<
  *             if values is not None:
  *                 if output is None:
  */
-    __Pyx_TraceLine(6469,0,__PYX_ERR(0, 6469, __pyx_L1_error))
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_cell_volumes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6469, __pyx_L1_error)
+    __Pyx_TraceLine(6466,0,__PYX_ERR(0, 6466, __pyx_L1_error))
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_cell_volumes); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6466, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_cell_volumes); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6469, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_cell_volumes); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6466, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_10, __pyx_v_out_cell_inds); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6469, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_t_10, __pyx_v_out_cell_inds); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6466, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_7, __pyx_t_12); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6469, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_7, __pyx_t_12); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6466, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __pyx_v_ws = __pyx_t_10;
     __pyx_t_10 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6470
+    /* "discretize/_extensions/tree_ext.pyx":6467
  *             out_cell_inds = self._get_containing_cell_indexes(in_tens_mesh.cell_centers)
  *             ws = in_tens_mesh.cell_volumes/self.cell_volumes[out_cell_inds]
  *             if values is not None:             # <<<<<<<<<<<<<<
  *                 if output is None:
  *                     output = np.empty(self.n_cells)
  */
-    __Pyx_TraceLine(6470,0,__PYX_ERR(0, 6470, __pyx_L1_error))
+    __Pyx_TraceLine(6467,0,__PYX_ERR(0, 6467, __pyx_L1_error))
     __pyx_t_13 = (__pyx_v_values != Py_None);
     __pyx_t_15 = (__pyx_t_13 != 0);
     if (__pyx_t_15) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6471
+      /* "discretize/_extensions/tree_ext.pyx":6468
  *             ws = in_tens_mesh.cell_volumes/self.cell_volumes[out_cell_inds]
  *             if values is not None:
  *                 if output is None:             # <<<<<<<<<<<<<<
  *                     output = np.empty(self.n_cells)
  *                 output[:] = np.bincount(out_cell_inds, ws*values)
  */
-      __Pyx_TraceLine(6471,0,__PYX_ERR(0, 6471, __pyx_L1_error))
+      __Pyx_TraceLine(6468,0,__PYX_ERR(0, 6468, __pyx_L1_error))
       __pyx_t_15 = (__pyx_v_output == Py_None);
       __pyx_t_13 = (__pyx_t_15 != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6472
+        /* "discretize/_extensions/tree_ext.pyx":6469
  *             if values is not None:
  *                 if output is None:
  *                     output = np.empty(self.n_cells)             # <<<<<<<<<<<<<<
  *                 output[:] = np.bincount(out_cell_inds, ws*values)
  *                 return output
  */
-        __Pyx_TraceLine(6472,0,__PYX_ERR(0, 6472, __pyx_L1_error))
-        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6472, __pyx_L1_error)
+        __Pyx_TraceLine(6469,0,__PYX_ERR(0, 6469, __pyx_L1_error))
+        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6469, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
-        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_empty); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6472, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_empty); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6469, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        __pyx_t_12 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6472, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6469, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_12);
         __pyx_t_9 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
           __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
           if (likely(__pyx_t_9)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
             __Pyx_INCREF(__pyx_t_9);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_7, function);
           }
         }
         __pyx_t_10 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_9, __pyx_t_12) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_12);
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6472, __pyx_L1_error)
+        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6469, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         __Pyx_DECREF_SET(__pyx_v_output, __pyx_t_10);
         __pyx_t_10 = 0;
 
-        /* "discretize/_extensions/tree_ext.pyx":6471
+        /* "discretize/_extensions/tree_ext.pyx":6468
  *             ws = in_tens_mesh.cell_volumes/self.cell_volumes[out_cell_inds]
  *             if values is not None:
  *                 if output is None:             # <<<<<<<<<<<<<<
  *                     output = np.empty(self.n_cells)
  *                 output[:] = np.bincount(out_cell_inds, ws*values)
  */
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6473
+      /* "discretize/_extensions/tree_ext.pyx":6470
  *                 if output is None:
  *                     output = np.empty(self.n_cells)
  *                 output[:] = np.bincount(out_cell_inds, ws*values)             # <<<<<<<<<<<<<<
  *                 return output
  *             return sp.csr_matrix(
  */
-      __Pyx_TraceLine(6473,0,__PYX_ERR(0, 6473, __pyx_L1_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6473, __pyx_L1_error)
+      __Pyx_TraceLine(6470,0,__PYX_ERR(0, 6470, __pyx_L1_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6470, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_bincount); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6473, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_bincount); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6470, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_7 = PyNumber_Multiply(__pyx_v_ws, __pyx_v_values); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6473, __pyx_L1_error)
+      __pyx_t_7 = PyNumber_Multiply(__pyx_v_ws, __pyx_v_values); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6470, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
       __pyx_t_9 = NULL;
       __pyx_t_11 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_12))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_12);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
@@ -83149,245 +83161,245 @@
           __Pyx_DECREF_SET(__pyx_t_12, function);
           __pyx_t_11 = 1;
         }
       }
       #if CYTHON_FAST_PYCALL
       if (PyFunction_Check(__pyx_t_12)) {
         PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_v_out_cell_inds, __pyx_t_7};
-        __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6473, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6470, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       } else
       #endif
       #if CYTHON_FAST_PYCCALL
       if (__Pyx_PyFastCFunction_Check(__pyx_t_12)) {
         PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_v_out_cell_inds, __pyx_t_7};
-        __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6473, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyCFunction_FastCall(__pyx_t_12, __pyx_temp+1-__pyx_t_11, 2+__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6470, __pyx_L1_error)
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       } else
       #endif
       {
-        __pyx_t_1 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6473, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_New(2+__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6470, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         if (__pyx_t_9) {
           __Pyx_GIVEREF(__pyx_t_9); PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_9); __pyx_t_9 = NULL;
         }
         __Pyx_INCREF(__pyx_v_out_cell_inds);
         __Pyx_GIVEREF(__pyx_v_out_cell_inds);
         PyTuple_SET_ITEM(__pyx_t_1, 0+__pyx_t_11, __pyx_v_out_cell_inds);
         __Pyx_GIVEREF(__pyx_t_7);
         PyTuple_SET_ITEM(__pyx_t_1, 1+__pyx_t_11, __pyx_t_7);
         __pyx_t_7 = 0;
-        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_1, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6473, __pyx_L1_error)
+        __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_1, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6470, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       }
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_t_10, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6473, __pyx_L1_error)
+      if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_t_10, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6470, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6474
+      /* "discretize/_extensions/tree_ext.pyx":6471
  *                     output = np.empty(self.n_cells)
  *                 output[:] = np.bincount(out_cell_inds, ws*values)
  *                 return output             # <<<<<<<<<<<<<<
  *             return sp.csr_matrix(
  *                 (ws, (out_cell_inds, np.arange(in_tens_mesh.n_cells))),
  */
-      __Pyx_TraceLine(6474,0,__PYX_ERR(0, 6474, __pyx_L1_error))
+      __Pyx_TraceLine(6471,0,__PYX_ERR(0, 6471, __pyx_L1_error))
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(__pyx_v_output);
       __pyx_r = __pyx_v_output;
       goto __pyx_L0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6470
+      /* "discretize/_extensions/tree_ext.pyx":6467
  *             out_cell_inds = self._get_containing_cell_indexes(in_tens_mesh.cell_centers)
  *             ws = in_tens_mesh.cell_volumes/self.cell_volumes[out_cell_inds]
  *             if values is not None:             # <<<<<<<<<<<<<<
  *                 if output is None:
  *                     output = np.empty(self.n_cells)
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6475
+    /* "discretize/_extensions/tree_ext.pyx":6472
  *                 output[:] = np.bincount(out_cell_inds, ws*values)
  *                 return output
  *             return sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                 (ws, (out_cell_inds, np.arange(in_tens_mesh.n_cells))),
  *                 shape=(self.n_cells, in_tens_mesh.n_cells)
  */
-    __Pyx_TraceLine(6475,0,__PYX_ERR(0, 6475, __pyx_L1_error))
+    __Pyx_TraceLine(6472,0,__PYX_ERR(0, 6472, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_sp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6475, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_sp); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6472, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6475, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6472, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6476
+    /* "discretize/_extensions/tree_ext.pyx":6473
  *                 return output
  *             return sp.csr_matrix(
  *                 (ws, (out_cell_inds, np.arange(in_tens_mesh.n_cells))),             # <<<<<<<<<<<<<<
  *                 shape=(self.n_cells, in_tens_mesh.n_cells)
  *             )
  */
-    __Pyx_TraceLine(6476,0,__PYX_ERR(0, 6476, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6476, __pyx_L1_error)
+    __Pyx_TraceLine(6473,0,__PYX_ERR(0, 6473, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_arange); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6476, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_arange); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6476, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_9 = NULL;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
       __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_7);
       if (likely(__pyx_t_9)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
         __Pyx_INCREF(__pyx_t_9);
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_7, function);
       }
     }
     __pyx_t_10 = (__pyx_t_9) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_9, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_1);
     __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6476, __pyx_L1_error)
+    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6476, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_INCREF(__pyx_v_out_cell_inds);
     __Pyx_GIVEREF(__pyx_v_out_cell_inds);
     PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_out_cell_inds);
     __Pyx_GIVEREF(__pyx_t_10);
     PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_10);
     __pyx_t_10 = 0;
-    __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6476, __pyx_L1_error)
+    __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6473, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_INCREF(__pyx_v_ws);
     __Pyx_GIVEREF(__pyx_v_ws);
     PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_ws);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_7);
     __pyx_t_7 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6475
+    /* "discretize/_extensions/tree_ext.pyx":6472
  *                 output[:] = np.bincount(out_cell_inds, ws*values)
  *                 return output
  *             return sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                 (ws, (out_cell_inds, np.arange(in_tens_mesh.n_cells))),
  *                 shape=(self.n_cells, in_tens_mesh.n_cells)
  */
-    __Pyx_TraceLine(6475,0,__PYX_ERR(0, 6475, __pyx_L1_error))
-    __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6475, __pyx_L1_error)
+    __Pyx_TraceLine(6472,0,__PYX_ERR(0, 6472, __pyx_L1_error))
+    __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6472, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_10);
     PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_10);
     __pyx_t_10 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6477
+    /* "discretize/_extensions/tree_ext.pyx":6474
  *             return sp.csr_matrix(
  *                 (ws, (out_cell_inds, np.arange(in_tens_mesh.n_cells))),
  *                 shape=(self.n_cells, in_tens_mesh.n_cells)             # <<<<<<<<<<<<<<
  *             )
  * 
  */
-    __Pyx_TraceLine(6477,0,__PYX_ERR(0, 6477, __pyx_L1_error))
-    __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6477, __pyx_L1_error)
+    __Pyx_TraceLine(6474,0,__PYX_ERR(0, 6474, __pyx_L1_error))
+    __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6477, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6477, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6477, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6474, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_9);
     PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_9);
     __pyx_t_1 = 0;
     __pyx_t_9 = 0;
-    if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_shape, __pyx_t_8) < 0) __PYX_ERR(0, 6477, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_shape, __pyx_t_8) < 0) __PYX_ERR(0, 6474, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6475
+    /* "discretize/_extensions/tree_ext.pyx":6472
  *                 output[:] = np.bincount(out_cell_inds, ws*values)
  *                 return output
  *             return sp.csr_matrix(             # <<<<<<<<<<<<<<
  *                 (ws, (out_cell_inds, np.arange(in_tens_mesh.n_cells))),
  *                 shape=(self.n_cells, in_tens_mesh.n_cells)
  */
-    __Pyx_TraceLine(6475,0,__PYX_ERR(0, 6475, __pyx_L1_error))
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_7, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6475, __pyx_L1_error)
+    __Pyx_TraceLine(6472,0,__PYX_ERR(0, 6472, __pyx_L1_error))
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_7, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6472, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_r = __pyx_t_8;
     __pyx_t_8 = 0;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6467
+    /* "discretize/_extensions/tree_ext.pyx":6464
  * 
  * 
  *         if same_base:             # <<<<<<<<<<<<<<
  *             out_cell_inds = self._get_containing_cell_indexes(in_tens_mesh.cell_centers)
  *             ws = in_tens_mesh.cell_volumes/self.cell_volumes[out_cell_inds]
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6481
+  /* "discretize/_extensions/tree_ext.pyx":6478
  * 
  * 
  *         cdef np.float64_t[:] nodes_x = in_tens_mesh.nodes_x             # <<<<<<<<<<<<<<
  *         cdef np.float64_t[:] nodes_y = in_tens_mesh.nodes_y
  *         cdef np.float64_t[:] nodes_z = np.array([0.0, 0.0])
  */
-  __Pyx_TraceLine(6481,0,__PYX_ERR(0, 6481, __pyx_L1_error))
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6481, __pyx_L1_error)
+  __Pyx_TraceLine(6478,0,__PYX_ERR(0, 6478, __pyx_L1_error))
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_x); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6478, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6481, __pyx_L1_error)
+  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6478, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_nodes_x = __pyx_t_16;
   __pyx_t_16.memview = NULL;
   __pyx_t_16.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6482
+  /* "discretize/_extensions/tree_ext.pyx":6479
  * 
  *         cdef np.float64_t[:] nodes_x = in_tens_mesh.nodes_x
  *         cdef np.float64_t[:] nodes_y = in_tens_mesh.nodes_y             # <<<<<<<<<<<<<<
  *         cdef np.float64_t[:] nodes_z = np.array([0.0, 0.0])
  *         if self._dim == 3:
  */
-  __Pyx_TraceLine(6482,0,__PYX_ERR(0, 6482, __pyx_L1_error))
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6482, __pyx_L1_error)
+  __Pyx_TraceLine(6479,0,__PYX_ERR(0, 6479, __pyx_L1_error))
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6479, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6482, __pyx_L1_error)
+  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6479, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_nodes_y = __pyx_t_16;
   __pyx_t_16.memview = NULL;
   __pyx_t_16.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6483
+  /* "discretize/_extensions/tree_ext.pyx":6480
  *         cdef np.float64_t[:] nodes_x = in_tens_mesh.nodes_x
  *         cdef np.float64_t[:] nodes_y = in_tens_mesh.nodes_y
  *         cdef np.float64_t[:] nodes_z = np.array([0.0, 0.0])             # <<<<<<<<<<<<<<
  *         if self._dim == 3:
  *             nodes_z = in_tens_mesh.nodes_z
  */
-  __Pyx_TraceLine(6483,0,__PYX_ERR(0, 6483, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6483, __pyx_L1_error)
+  __Pyx_TraceLine(6480,0,__PYX_ERR(0, 6480, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6480, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6483, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6480, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = PyList_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6483, __pyx_L1_error)
+  __pyx_t_10 = PyList_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6480, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_INCREF(__pyx_float_0_0);
   __Pyx_GIVEREF(__pyx_float_0_0);
   PyList_SET_ITEM(__pyx_t_10, 0, __pyx_float_0_0);
   __Pyx_INCREF(__pyx_float_0_0);
   __Pyx_GIVEREF(__pyx_float_0_0);
   PyList_SET_ITEM(__pyx_t_10, 1, __pyx_float_0_0);
@@ -83400,132 +83412,132 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_8 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_12, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_10);
   __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6483, __pyx_L1_error)
+  if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6480, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6483, __pyx_L1_error)
+  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6480, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __pyx_v_nodes_z = __pyx_t_16;
   __pyx_t_16.memview = NULL;
   __pyx_t_16.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6484
+  /* "discretize/_extensions/tree_ext.pyx":6481
  *         cdef np.float64_t[:] nodes_y = in_tens_mesh.nodes_y
  *         cdef np.float64_t[:] nodes_z = np.array([0.0, 0.0])
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             nodes_z = in_tens_mesh.nodes_z
  *         cdef int_t nx = len(nodes_x)-1
  */
-  __Pyx_TraceLine(6484,0,__PYX_ERR(0, 6484, __pyx_L1_error))
+  __Pyx_TraceLine(6481,0,__PYX_ERR(0, 6481, __pyx_L1_error))
   __pyx_t_13 = ((__pyx_v_self->_dim == 3) != 0);
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6485
+    /* "discretize/_extensions/tree_ext.pyx":6482
  *         cdef np.float64_t[:] nodes_z = np.array([0.0, 0.0])
  *         if self._dim == 3:
  *             nodes_z = in_tens_mesh.nodes_z             # <<<<<<<<<<<<<<
  *         cdef int_t nx = len(nodes_x)-1
  *         cdef int_t ny = len(nodes_y)-1
  */
-    __Pyx_TraceLine(6485,0,__PYX_ERR(0, 6485, __pyx_L1_error))
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6485, __pyx_L1_error)
+    __Pyx_TraceLine(6482,0,__PYX_ERR(0, 6482, __pyx_L1_error))
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_nodes_z); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6482, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6485, __pyx_L1_error)
+    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_8, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6482, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_v_nodes_z, 1);
     __pyx_v_nodes_z = __pyx_t_16;
     __pyx_t_16.memview = NULL;
     __pyx_t_16.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6484
+    /* "discretize/_extensions/tree_ext.pyx":6481
  *         cdef np.float64_t[:] nodes_y = in_tens_mesh.nodes_y
  *         cdef np.float64_t[:] nodes_z = np.array([0.0, 0.0])
  *         if self._dim == 3:             # <<<<<<<<<<<<<<
  *             nodes_z = in_tens_mesh.nodes_z
  *         cdef int_t nx = len(nodes_x)-1
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6486
+  /* "discretize/_extensions/tree_ext.pyx":6483
  *         if self._dim == 3:
  *             nodes_z = in_tens_mesh.nodes_z
  *         cdef int_t nx = len(nodes_x)-1             # <<<<<<<<<<<<<<
  *         cdef int_t ny = len(nodes_y)-1
  *         cdef int_t nz = len(nodes_z)-1
  */
-  __Pyx_TraceLine(6486,0,__PYX_ERR(0, 6486, __pyx_L1_error))
+  __Pyx_TraceLine(6483,0,__PYX_ERR(0, 6483, __pyx_L1_error))
   __pyx_t_17 = __Pyx_MemoryView_Len(__pyx_v_nodes_x); 
   __pyx_v_nx = (__pyx_t_17 - 1);
 
-  /* "discretize/_extensions/tree_ext.pyx":6487
+  /* "discretize/_extensions/tree_ext.pyx":6484
  *             nodes_z = in_tens_mesh.nodes_z
  *         cdef int_t nx = len(nodes_x)-1
  *         cdef int_t ny = len(nodes_y)-1             # <<<<<<<<<<<<<<
  *         cdef int_t nz = len(nodes_z)-1
  * 
  */
-  __Pyx_TraceLine(6487,0,__PYX_ERR(0, 6487, __pyx_L1_error))
+  __Pyx_TraceLine(6484,0,__PYX_ERR(0, 6484, __pyx_L1_error))
   __pyx_t_17 = __Pyx_MemoryView_Len(__pyx_v_nodes_y); 
   __pyx_v_ny = (__pyx_t_17 - 1);
 
-  /* "discretize/_extensions/tree_ext.pyx":6488
+  /* "discretize/_extensions/tree_ext.pyx":6485
  *         cdef int_t nx = len(nodes_x)-1
  *         cdef int_t ny = len(nodes_y)-1
  *         cdef int_t nz = len(nodes_z)-1             # <<<<<<<<<<<<<<
  * 
  *         cdef double * dx
  */
-  __Pyx_TraceLine(6488,0,__PYX_ERR(0, 6488, __pyx_L1_error))
+  __Pyx_TraceLine(6485,0,__PYX_ERR(0, 6485, __pyx_L1_error))
   __pyx_t_17 = __Pyx_MemoryView_Len(__pyx_v_nodes_z); 
   __pyx_v_nz = (__pyx_t_17 - 1);
 
-  /* "discretize/_extensions/tree_ext.pyx":6494
+  /* "discretize/_extensions/tree_ext.pyx":6491
  *         cdef double * dz
  * 
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             xF = np.array([nodes_x[-1], nodes_y[-1]])
  *         else:
  */
-  __Pyx_TraceLine(6494,0,__PYX_ERR(0, 6494, __pyx_L1_error))
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6494, __pyx_L1_error)
+  __Pyx_TraceLine(6491,0,__PYX_ERR(0, 6491, __pyx_L1_error))
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6491, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = __Pyx_PyInt_EqObjC(__pyx_t_8, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6494, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyInt_EqObjC(__pyx_t_8, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6491, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 6494, __pyx_L1_error)
+  __pyx_t_13 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_13 < 0)) __PYX_ERR(0, 6491, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6495
+    /* "discretize/_extensions/tree_ext.pyx":6492
  * 
  *         if self.dim == 2:
  *             xF = np.array([nodes_x[-1], nodes_y[-1]])             # <<<<<<<<<<<<<<
  *         else:
  *             xF = np.array([nodes_x[-1], nodes_y[-1], nodes_z[-1]])
  */
-    __Pyx_TraceLine(6495,0,__PYX_ERR(0, 6495, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6495, __pyx_L1_error)
+    __Pyx_TraceLine(6492,0,__PYX_ERR(0, 6492, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6492, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6495, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6492, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __pyx_t_18 = -1L;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_x.shape[0];
-    __pyx_t_8 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_x.data + __pyx_t_18 * __pyx_v_nodes_x.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6495, __pyx_L1_error)
+    __pyx_t_8 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_x.data + __pyx_t_18 * __pyx_v_nodes_x.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6492, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __pyx_t_18 = -1L;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_y.shape[0];
-    __pyx_t_12 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_y.data + __pyx_t_18 * __pyx_v_nodes_y.strides[0]) )))); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6495, __pyx_L1_error)
+    __pyx_t_12 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_y.data + __pyx_t_18 * __pyx_v_nodes_y.strides[0]) )))); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6492, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6495, __pyx_L1_error)
+    __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6492, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_GIVEREF(__pyx_t_8);
     PyList_SET_ITEM(__pyx_t_9, 0, __pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_12);
     PyList_SET_ITEM(__pyx_t_9, 1, __pyx_t_12);
     __pyx_t_8 = 0;
     __pyx_t_12 = 0;
@@ -83538,60 +83550,60 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_10, function);
       }
     }
     __pyx_t_7 = (__pyx_t_12) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_12, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_10, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6495, __pyx_L1_error)
+    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6492, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 6495, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 6492, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_v_xF = __pyx_t_2;
     __pyx_t_2.memview = NULL;
     __pyx_t_2.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6494
+    /* "discretize/_extensions/tree_ext.pyx":6491
  *         cdef double * dz
  * 
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             xF = np.array([nodes_x[-1], nodes_y[-1]])
  *         else:
  */
     goto __pyx_L19;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6497
+  /* "discretize/_extensions/tree_ext.pyx":6494
  *             xF = np.array([nodes_x[-1], nodes_y[-1]])
  *         else:
  *             xF = np.array([nodes_x[-1], nodes_y[-1], nodes_z[-1]])             # <<<<<<<<<<<<<<
  * 
  *         cdef np.float64_t[::1, :, :] vals = np.array([[[]]])
  */
-  __Pyx_TraceLine(6497,0,__PYX_ERR(0, 6497, __pyx_L1_error))
+  __Pyx_TraceLine(6494,0,__PYX_ERR(0, 6494, __pyx_L1_error))
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6497, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6497, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_t_18 = -1L;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_x.shape[0];
-    __pyx_t_10 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_x.data + __pyx_t_18 * __pyx_v_nodes_x.strides[0]) )))); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6497, __pyx_L1_error)
+    __pyx_t_10 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_x.data + __pyx_t_18 * __pyx_v_nodes_x.strides[0]) )))); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __pyx_t_18 = -1L;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_y.shape[0];
-    __pyx_t_12 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_y.data + __pyx_t_18 * __pyx_v_nodes_y.strides[0]) )))); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6497, __pyx_L1_error)
+    __pyx_t_12 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_y.data + __pyx_t_18 * __pyx_v_nodes_y.strides[0]) )))); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __pyx_t_18 = -1L;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_z.shape[0];
-    __pyx_t_8 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_z.data + __pyx_t_18 * __pyx_v_nodes_z.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6497, __pyx_L1_error)
+    __pyx_t_8 = PyFloat_FromDouble((*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_z.data + __pyx_t_18 * __pyx_v_nodes_z.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6497, __pyx_L1_error)
+    __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_10);
     PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_10);
     __Pyx_GIVEREF(__pyx_t_12);
     PyList_SET_ITEM(__pyx_t_1, 1, __pyx_t_12);
     __Pyx_GIVEREF(__pyx_t_8);
     PyList_SET_ITEM(__pyx_t_1, 2, __pyx_t_8);
@@ -83607,46 +83619,46 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_9, function);
       }
     }
     __pyx_t_7 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_8, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_1);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6497, __pyx_L1_error)
+    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6494, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 6497, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_2.memview)) __PYX_ERR(0, 6494, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_v_xF = __pyx_t_2;
     __pyx_t_2.memview = NULL;
     __pyx_t_2.data = NULL;
   }
   __pyx_L19:;
 
-  /* "discretize/_extensions/tree_ext.pyx":6499
+  /* "discretize/_extensions/tree_ext.pyx":6496
  *             xF = np.array([nodes_x[-1], nodes_y[-1], nodes_z[-1]])
  * 
  *         cdef np.float64_t[::1, :, :] vals = np.array([[[]]])             # <<<<<<<<<<<<<<
  *         cdef np.float64_t[:] outs = np.array([])
  * 
  */
-  __Pyx_TraceLine(6499,0,__PYX_ERR(0, 6499, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6499, __pyx_L1_error)
+  __Pyx_TraceLine(6496,0,__PYX_ERR(0, 6496, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6496, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6499, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6496, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = PyList_New(0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6499, __pyx_L1_error)
+  __pyx_t_9 = PyList_New(0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6496, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_8 = PyList_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6499, __pyx_L1_error)
+  __pyx_t_8 = PyList_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6496, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_9);
   PyList_SET_ITEM(__pyx_t_8, 0, __pyx_t_9);
   __pyx_t_9 = 0;
-  __pyx_t_9 = PyList_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6499, __pyx_L1_error)
+  __pyx_t_9 = PyList_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6496, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_GIVEREF(__pyx_t_8);
   PyList_SET_ITEM(__pyx_t_9, 0, __pyx_t_8);
   __pyx_t_8 = 0;
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_1))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
@@ -83656,691 +83668,691 @@
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_1, function);
     }
   }
   __pyx_t_7 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_8, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_9);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6499, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6496, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_dcd_d__nn___pyx_t_5numpy_float64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 6499, __pyx_L1_error)
+  __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_dcd_d__nn___pyx_t_5numpy_float64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 6496, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_vals = __pyx_t_19;
   __pyx_t_19.memview = NULL;
   __pyx_t_19.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6500
+  /* "discretize/_extensions/tree_ext.pyx":6497
  * 
  *         cdef np.float64_t[::1, :, :] vals = np.array([[[]]])
  *         cdef np.float64_t[:] outs = np.array([])             # <<<<<<<<<<<<<<
  * 
  *         cdef int_t build_mat = 1
  */
-  __Pyx_TraceLine(6500,0,__PYX_ERR(0, 6500, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6500, __pyx_L1_error)
+  __Pyx_TraceLine(6497,0,__PYX_ERR(0, 6497, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6497, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6500, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6497, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6500, __pyx_L1_error)
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6497, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_9))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_9);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_9, function);
     }
   }
   __pyx_t_7 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_8, __pyx_t_1) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_1);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6500, __pyx_L1_error)
+  if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6497, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6500, __pyx_L1_error)
+  __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_t_7, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6497, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_v_outs = __pyx_t_16;
   __pyx_t_16.memview = NULL;
   __pyx_t_16.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6502
+  /* "discretize/_extensions/tree_ext.pyx":6499
  *         cdef np.float64_t[:] outs = np.array([])
  * 
  *         cdef int_t build_mat = 1             # <<<<<<<<<<<<<<
  *         if values is not None:
  *             vals = values.reshape((nx, ny, nz), order='F')
  */
-  __Pyx_TraceLine(6502,0,__PYX_ERR(0, 6502, __pyx_L1_error))
+  __Pyx_TraceLine(6499,0,__PYX_ERR(0, 6499, __pyx_L1_error))
   __pyx_v_build_mat = 1;
 
-  /* "discretize/_extensions/tree_ext.pyx":6503
+  /* "discretize/_extensions/tree_ext.pyx":6500
  * 
  *         cdef int_t build_mat = 1
  *         if values is not None:             # <<<<<<<<<<<<<<
  *             vals = values.reshape((nx, ny, nz), order='F')
  *             if output is None:
  */
-  __Pyx_TraceLine(6503,0,__PYX_ERR(0, 6503, __pyx_L1_error))
+  __Pyx_TraceLine(6500,0,__PYX_ERR(0, 6500, __pyx_L1_error))
   __pyx_t_13 = (__pyx_v_values != Py_None);
   __pyx_t_15 = (__pyx_t_13 != 0);
   if (__pyx_t_15) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6504
+    /* "discretize/_extensions/tree_ext.pyx":6501
  *         cdef int_t build_mat = 1
  *         if values is not None:
  *             vals = values.reshape((nx, ny, nz), order='F')             # <<<<<<<<<<<<<<
  *             if output is None:
  *                 output = np.empty(self.n_cells)
  */
-    __Pyx_TraceLine(6504,0,__PYX_ERR(0, 6504, __pyx_L1_error))
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_values, __pyx_n_s_reshape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    __Pyx_TraceLine(6501,0,__PYX_ERR(0, 6501, __pyx_L1_error))
+    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_values, __pyx_n_s_reshape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_9 = __Pyx_PyInt_From_int_t(__pyx_v_nx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_From_int_t(__pyx_v_nx); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_1 = __Pyx_PyInt_From_int_t(__pyx_v_ny); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_int_t(__pyx_v_ny); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyInt_From_int_t(__pyx_v_nz); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int_t(__pyx_v_nz); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_GIVEREF(__pyx_t_9);
     PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_9);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_8);
     __pyx_t_9 = 0;
     __pyx_t_1 = 0;
     __pyx_t_8 = 0;
-    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_12);
     PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_12);
     __pyx_t_12 = 0;
-    __pyx_t_12 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    __pyx_t_12 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
-    if (PyDict_SetItem(__pyx_t_12, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 6504, __pyx_L1_error)
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, __pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_12, __pyx_n_s_order, __pyx_n_u_F) < 0) __PYX_ERR(0, 6501, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_8, __pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-    __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_dcd_d__nn___pyx_t_5numpy_float64_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 6504, __pyx_L1_error)
+    __pyx_t_19 = __Pyx_PyObject_to_MemoryviewSlice_dcd_d__nn___pyx_t_5numpy_float64_t(__pyx_t_1, PyBUF_WRITABLE); if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 6501, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __PYX_XDEC_MEMVIEW(&__pyx_v_vals, 1);
     __pyx_v_vals = __pyx_t_19;
     __pyx_t_19.memview = NULL;
     __pyx_t_19.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6505
+    /* "discretize/_extensions/tree_ext.pyx":6502
  *         if values is not None:
  *             vals = values.reshape((nx, ny, nz), order='F')
  *             if output is None:             # <<<<<<<<<<<<<<
  *                 output = np.empty(self.n_cells)
  *             output[:] = 0
  */
-    __Pyx_TraceLine(6505,0,__PYX_ERR(0, 6505, __pyx_L1_error))
+    __Pyx_TraceLine(6502,0,__PYX_ERR(0, 6502, __pyx_L1_error))
     __pyx_t_15 = (__pyx_v_output == Py_None);
     __pyx_t_13 = (__pyx_t_15 != 0);
     if (__pyx_t_13) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6506
+      /* "discretize/_extensions/tree_ext.pyx":6503
  *             vals = values.reshape((nx, ny, nz), order='F')
  *             if output is None:
  *                 output = np.empty(self.n_cells)             # <<<<<<<<<<<<<<
  *             output[:] = 0
  *             outs = output
  */
-      __Pyx_TraceLine(6506,0,__PYX_ERR(0, 6506, __pyx_L1_error))
-      __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6506, __pyx_L1_error)
+      __Pyx_TraceLine(6503,0,__PYX_ERR(0, 6503, __pyx_L1_error))
+      __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6503, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
-      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6506, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_empty); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6503, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6506, __pyx_L1_error)
+      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6503, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_12);
       __pyx_t_7 = NULL;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
         __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
         if (likely(__pyx_t_7)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
           __Pyx_INCREF(__pyx_t_7);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_8, function);
         }
       }
       __pyx_t_1 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_8, __pyx_t_7, __pyx_t_12) : __Pyx_PyObject_CallOneArg(__pyx_t_8, __pyx_t_12);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6506, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6503, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF_SET(__pyx_v_output, __pyx_t_1);
       __pyx_t_1 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6505
+      /* "discretize/_extensions/tree_ext.pyx":6502
  *         if values is not None:
  *             vals = values.reshape((nx, ny, nz), order='F')
  *             if output is None:             # <<<<<<<<<<<<<<
  *                 output = np.empty(self.n_cells)
  *             output[:] = 0
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6507
+    /* "discretize/_extensions/tree_ext.pyx":6504
  *             if output is None:
  *                 output = np.empty(self.n_cells)
  *             output[:] = 0             # <<<<<<<<<<<<<<
  *             outs = output
  * 
  */
-    __Pyx_TraceLine(6507,0,__PYX_ERR(0, 6507, __pyx_L1_error))
-    if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6507, __pyx_L1_error)
+    __Pyx_TraceLine(6504,0,__PYX_ERR(0, 6504, __pyx_L1_error))
+    if (__Pyx_PyObject_SetSlice(__pyx_v_output, __pyx_int_0, 0, 0, NULL, NULL, &__pyx_slice__20, 0, 0, 1) < 0) __PYX_ERR(0, 6504, __pyx_L1_error)
 
-    /* "discretize/_extensions/tree_ext.pyx":6508
+    /* "discretize/_extensions/tree_ext.pyx":6505
  *                 output = np.empty(self.n_cells)
  *             output[:] = 0
  *             outs = output             # <<<<<<<<<<<<<<
  * 
  *             build_mat = 0
  */
-    __Pyx_TraceLine(6508,0,__PYX_ERR(0, 6508, __pyx_L1_error))
-    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_v_output, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6508, __pyx_L1_error)
+    __Pyx_TraceLine(6505,0,__PYX_ERR(0, 6505, __pyx_L1_error))
+    __pyx_t_16 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_float64_t(__pyx_v_output, PyBUF_WRITABLE); if (unlikely(!__pyx_t_16.memview)) __PYX_ERR(0, 6505, __pyx_L1_error)
     __PYX_XDEC_MEMVIEW(&__pyx_v_outs, 1);
     __pyx_v_outs = __pyx_t_16;
     __pyx_t_16.memview = NULL;
     __pyx_t_16.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6510
+    /* "discretize/_extensions/tree_ext.pyx":6507
  *             outs = output
  * 
  *             build_mat = 0             # <<<<<<<<<<<<<<
  * 
  *         cdef vector[int_t] row_inds
  */
-    __Pyx_TraceLine(6510,0,__PYX_ERR(0, 6510, __pyx_L1_error))
+    __Pyx_TraceLine(6507,0,__PYX_ERR(0, 6507, __pyx_L1_error))
     __pyx_v_build_mat = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6503
+    /* "discretize/_extensions/tree_ext.pyx":6500
  * 
  *         cdef int_t build_mat = 1
  *         if values is not None:             # <<<<<<<<<<<<<<
  *             vals = values.reshape((nx, ny, nz), order='F')
  *             if output is None:
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6514
+  /* "discretize/_extensions/tree_ext.pyx":6511
  *         cdef vector[int_t] row_inds
  *         cdef vector[double] all_weights
  *         cdef np.int64_t[:] indptr = np.zeros(self.n_cells+1, dtype=np.int64)             # <<<<<<<<<<<<<<
  *         cdef int_t nnz_counter = 0
  *         cdef int_t nnz_row = 0
  */
-  __Pyx_TraceLine(6514,0,__PYX_ERR(0, 6514, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __Pyx_TraceLine(6511,0,__PYX_ERR(0, 6511, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_12 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_12);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_12);
   PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_12);
   __pyx_t_12 = 0;
-  __pyx_t_12 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_12);
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_int64); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-  if (PyDict_SetItem(__pyx_t_12, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 6514, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_12, __pyx_n_s_dtype, __pyx_t_9) < 0) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_1, __pyx_t_12); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_1, __pyx_t_12); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-  __pyx_t_20 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_20.memview)) __PYX_ERR(0, 6514, __pyx_L1_error)
+  __pyx_t_20 = __Pyx_PyObject_to_MemoryviewSlice_ds_nn___pyx_t_5numpy_int64_t(__pyx_t_9, PyBUF_WRITABLE); if (unlikely(!__pyx_t_20.memview)) __PYX_ERR(0, 6511, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __pyx_v_indptr = __pyx_t_20;
   __pyx_t_20.memview = NULL;
   __pyx_t_20.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6515
+  /* "discretize/_extensions/tree_ext.pyx":6512
  *         cdef vector[double] all_weights
  *         cdef np.int64_t[:] indptr = np.zeros(self.n_cells+1, dtype=np.int64)
  *         cdef int_t nnz_counter = 0             # <<<<<<<<<<<<<<
  *         cdef int_t nnz_row = 0
  * 
  */
-  __Pyx_TraceLine(6515,0,__PYX_ERR(0, 6515, __pyx_L1_error))
+  __Pyx_TraceLine(6512,0,__PYX_ERR(0, 6512, __pyx_L1_error))
   __pyx_v_nnz_counter = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6516
+  /* "discretize/_extensions/tree_ext.pyx":6513
  *         cdef np.int64_t[:] indptr = np.zeros(self.n_cells+1, dtype=np.int64)
  *         cdef int_t nnz_counter = 0
  *         cdef int_t nnz_row = 0             # <<<<<<<<<<<<<<
  * 
  *         cdef int_t nx_overlap, ny_overlap, nz_overlap, n_overlap
  */
-  __Pyx_TraceLine(6516,0,__PYX_ERR(0, 6516, __pyx_L1_error))
+  __Pyx_TraceLine(6513,0,__PYX_ERR(0, 6513, __pyx_L1_error))
   __pyx_v_nnz_row = 0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6522
+  /* "discretize/_extensions/tree_ext.pyx":6519
  *         cdef double weight_sum
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             x1m = min(cell.points[0].location[0], xF[0])
  *             y1m = min(cell.points[0].location[1], xF[1])
  */
-  __Pyx_TraceLine(6522,0,__PYX_ERR(0, 6522, __pyx_L1_error))
+  __Pyx_TraceLine(6519,0,__PYX_ERR(0, 6519, __pyx_L1_error))
   __pyx_t_22 = &__pyx_v_self->tree->cells;
   __pyx_t_21 = __pyx_t_22->begin();
   for (;;) {
     if (!(__pyx_t_21 != __pyx_t_22->end())) break;
     __pyx_t_23 = *__pyx_t_21;
     ++__pyx_t_21;
     __pyx_v_cell = __pyx_t_23;
 
-    /* "discretize/_extensions/tree_ext.pyx":6523
+    /* "discretize/_extensions/tree_ext.pyx":6520
  * 
  *         for cell in self.tree.cells:
  *             x1m = min(cell.points[0].location[0], xF[0])             # <<<<<<<<<<<<<<
  *             y1m = min(cell.points[0].location[1], xF[1])
  * 
  */
-    __Pyx_TraceLine(6523,0,__PYX_ERR(0, 6523, __pyx_L1_error))
+    __Pyx_TraceLine(6520,0,__PYX_ERR(0, 6520, __pyx_L1_error))
     __pyx_t_18 = 0;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_xF.shape[0];
     __pyx_t_24 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_18 * __pyx_v_xF.strides[0]) )));
     __pyx_t_25 = ((__pyx_v_cell->points[0])->location[0]);
     if (((__pyx_t_24 < __pyx_t_25) != 0)) {
       __pyx_t_26 = __pyx_t_24;
     } else {
       __pyx_t_26 = __pyx_t_25;
     }
     __pyx_v_x1m = __pyx_t_26;
 
-    /* "discretize/_extensions/tree_ext.pyx":6524
+    /* "discretize/_extensions/tree_ext.pyx":6521
  *         for cell in self.tree.cells:
  *             x1m = min(cell.points[0].location[0], xF[0])
  *             y1m = min(cell.points[0].location[1], xF[1])             # <<<<<<<<<<<<<<
  * 
  *             x1p = max(cell.points[3].location[0], origin[0])
  */
-    __Pyx_TraceLine(6524,0,__PYX_ERR(0, 6524, __pyx_L1_error))
+    __Pyx_TraceLine(6521,0,__PYX_ERR(0, 6521, __pyx_L1_error))
     __pyx_t_18 = 1;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_xF.shape[0];
     __pyx_t_26 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_18 * __pyx_v_xF.strides[0]) )));
     __pyx_t_24 = ((__pyx_v_cell->points[0])->location[1]);
     if (((__pyx_t_26 < __pyx_t_24) != 0)) {
       __pyx_t_25 = __pyx_t_26;
     } else {
       __pyx_t_25 = __pyx_t_24;
     }
     __pyx_v_y1m = __pyx_t_25;
 
-    /* "discretize/_extensions/tree_ext.pyx":6526
+    /* "discretize/_extensions/tree_ext.pyx":6523
  *             y1m = min(cell.points[0].location[1], xF[1])
  * 
  *             x1p = max(cell.points[3].location[0], origin[0])             # <<<<<<<<<<<<<<
  *             y1p = max(cell.points[3].location[1], origin[1])
  *             if self._dim==3:
  */
-    __Pyx_TraceLine(6526,0,__PYX_ERR(0, 6526, __pyx_L1_error))
+    __Pyx_TraceLine(6523,0,__PYX_ERR(0, 6523, __pyx_L1_error))
     __pyx_t_18 = 0;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_origin.shape[0];
     __pyx_t_25 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_18 * __pyx_v_origin.strides[0]) )));
     __pyx_t_26 = ((__pyx_v_cell->points[3])->location[0]);
     if (((__pyx_t_25 > __pyx_t_26) != 0)) {
       __pyx_t_24 = __pyx_t_25;
     } else {
       __pyx_t_24 = __pyx_t_26;
     }
     __pyx_v_x1p = __pyx_t_24;
 
-    /* "discretize/_extensions/tree_ext.pyx":6527
+    /* "discretize/_extensions/tree_ext.pyx":6524
  * 
  *             x1p = max(cell.points[3].location[0], origin[0])
  *             y1p = max(cell.points[3].location[1], origin[1])             # <<<<<<<<<<<<<<
  *             if self._dim==3:
  *                 z1m = min(cell.points[0].location[2], xF[2])
  */
-    __Pyx_TraceLine(6527,0,__PYX_ERR(0, 6527, __pyx_L1_error))
+    __Pyx_TraceLine(6524,0,__PYX_ERR(0, 6524, __pyx_L1_error))
     __pyx_t_18 = 1;
     if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_origin.shape[0];
     __pyx_t_24 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_18 * __pyx_v_origin.strides[0]) )));
     __pyx_t_25 = ((__pyx_v_cell->points[3])->location[1]);
     if (((__pyx_t_24 > __pyx_t_25) != 0)) {
       __pyx_t_26 = __pyx_t_24;
     } else {
       __pyx_t_26 = __pyx_t_25;
     }
     __pyx_v_y1p = __pyx_t_26;
 
-    /* "discretize/_extensions/tree_ext.pyx":6528
+    /* "discretize/_extensions/tree_ext.pyx":6525
  *             x1p = max(cell.points[3].location[0], origin[0])
  *             y1p = max(cell.points[3].location[1], origin[1])
  *             if self._dim==3:             # <<<<<<<<<<<<<<
  *                 z1m = min(cell.points[0].location[2], xF[2])
  *                 z1p = max(cell.points[7].location[2], origin[2])
  */
-    __Pyx_TraceLine(6528,0,__PYX_ERR(0, 6528, __pyx_L1_error))
+    __Pyx_TraceLine(6525,0,__PYX_ERR(0, 6525, __pyx_L1_error))
     __pyx_t_13 = ((__pyx_v_self->_dim == 3) != 0);
     if (__pyx_t_13) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6529
+      /* "discretize/_extensions/tree_ext.pyx":6526
  *             y1p = max(cell.points[3].location[1], origin[1])
  *             if self._dim==3:
  *                 z1m = min(cell.points[0].location[2], xF[2])             # <<<<<<<<<<<<<<
  *                 z1p = max(cell.points[7].location[2], origin[2])
  *             # then need to find overlapping cells of TensorMesh...
  */
-      __Pyx_TraceLine(6529,0,__PYX_ERR(0, 6529, __pyx_L1_error))
+      __Pyx_TraceLine(6526,0,__PYX_ERR(0, 6526, __pyx_L1_error))
       __pyx_t_18 = 2;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_xF.shape[0];
       __pyx_t_26 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_18 * __pyx_v_xF.strides[0]) )));
       __pyx_t_24 = ((__pyx_v_cell->points[0])->location[2]);
       if (((__pyx_t_26 < __pyx_t_24) != 0)) {
         __pyx_t_25 = __pyx_t_26;
       } else {
         __pyx_t_25 = __pyx_t_24;
       }
       __pyx_v_z1m = __pyx_t_25;
 
-      /* "discretize/_extensions/tree_ext.pyx":6530
+      /* "discretize/_extensions/tree_ext.pyx":6527
  *             if self._dim==3:
  *                 z1m = min(cell.points[0].location[2], xF[2])
  *                 z1p = max(cell.points[7].location[2], origin[2])             # <<<<<<<<<<<<<<
  *             # then need to find overlapping cells of TensorMesh...
  *             ix1 = max(_bisect_left(nodes_x, x1m) - 1, 0)
  */
-      __Pyx_TraceLine(6530,0,__PYX_ERR(0, 6530, __pyx_L1_error))
+      __Pyx_TraceLine(6527,0,__PYX_ERR(0, 6527, __pyx_L1_error))
       __pyx_t_18 = 2;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_origin.shape[0];
       __pyx_t_25 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_18 * __pyx_v_origin.strides[0]) )));
       __pyx_t_26 = ((__pyx_v_cell->points[7])->location[2]);
       if (((__pyx_t_25 > __pyx_t_26) != 0)) {
         __pyx_t_24 = __pyx_t_25;
       } else {
         __pyx_t_24 = __pyx_t_26;
       }
       __pyx_v_z1p = __pyx_t_24;
 
-      /* "discretize/_extensions/tree_ext.pyx":6528
+      /* "discretize/_extensions/tree_ext.pyx":6525
  *             x1p = max(cell.points[3].location[0], origin[0])
  *             y1p = max(cell.points[3].location[1], origin[1])
  *             if self._dim==3:             # <<<<<<<<<<<<<<
  *                 z1m = min(cell.points[0].location[2], xF[2])
  *                 z1p = max(cell.points[7].location[2], origin[2])
  */
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6532
+    /* "discretize/_extensions/tree_ext.pyx":6529
  *                 z1p = max(cell.points[7].location[2], origin[2])
  *             # then need to find overlapping cells of TensorMesh...
  *             ix1 = max(_bisect_left(nodes_x, x1m) - 1, 0)             # <<<<<<<<<<<<<<
  *             ix2 = min(_bisect_right(nodes_x, x1p), nx)
  *             iy1 = max(_bisect_left(nodes_y, y1m) - 1, 0)
  */
-    __Pyx_TraceLine(6532,0,__PYX_ERR(0, 6532, __pyx_L1_error))
+    __Pyx_TraceLine(6529,0,__PYX_ERR(0, 6529, __pyx_L1_error))
     __pyx_t_27 = 0;
     __pyx_t_28 = (__pyx_f_10discretize_11_extensions_18interputils_cython__bisect_left(__pyx_v_nodes_x, __pyx_v_x1m) - 1);
     if (((__pyx_t_27 > __pyx_t_28) != 0)) {
       __pyx_t_29 = __pyx_t_27;
     } else {
       __pyx_t_29 = __pyx_t_28;
     }
     __pyx_v_ix1 = __pyx_t_29;
 
-    /* "discretize/_extensions/tree_ext.pyx":6533
+    /* "discretize/_extensions/tree_ext.pyx":6530
  *             # then need to find overlapping cells of TensorMesh...
  *             ix1 = max(_bisect_left(nodes_x, x1m) - 1, 0)
  *             ix2 = min(_bisect_right(nodes_x, x1p), nx)             # <<<<<<<<<<<<<<
  *             iy1 = max(_bisect_left(nodes_y, y1m) - 1, 0)
  *             iy2 = min(_bisect_right(nodes_y, y1p), ny)
  */
-    __Pyx_TraceLine(6533,0,__PYX_ERR(0, 6533, __pyx_L1_error))
+    __Pyx_TraceLine(6530,0,__PYX_ERR(0, 6530, __pyx_L1_error))
     __pyx_t_6 = __pyx_v_nx;
     __pyx_t_29 = __pyx_f_10discretize_11_extensions_18interputils_cython__bisect_right(__pyx_v_nodes_x, __pyx_v_x1p);
     if (((__pyx_t_6 < __pyx_t_29) != 0)) {
       __pyx_t_28 = __pyx_t_6;
     } else {
       __pyx_t_28 = __pyx_t_29;
     }
     __pyx_v_ix2 = __pyx_t_28;
 
-    /* "discretize/_extensions/tree_ext.pyx":6534
+    /* "discretize/_extensions/tree_ext.pyx":6531
  *             ix1 = max(_bisect_left(nodes_x, x1m) - 1, 0)
  *             ix2 = min(_bisect_right(nodes_x, x1p), nx)
  *             iy1 = max(_bisect_left(nodes_y, y1m) - 1, 0)             # <<<<<<<<<<<<<<
  *             iy2 = min(_bisect_right(nodes_y, y1p), ny)
  *             if self._dim==3:
  */
-    __Pyx_TraceLine(6534,0,__PYX_ERR(0, 6534, __pyx_L1_error))
+    __Pyx_TraceLine(6531,0,__PYX_ERR(0, 6531, __pyx_L1_error))
     __pyx_t_27 = 0;
     __pyx_t_28 = (__pyx_f_10discretize_11_extensions_18interputils_cython__bisect_left(__pyx_v_nodes_y, __pyx_v_y1m) - 1);
     if (((__pyx_t_27 > __pyx_t_28) != 0)) {
       __pyx_t_29 = __pyx_t_27;
     } else {
       __pyx_t_29 = __pyx_t_28;
     }
     __pyx_v_iy1 = __pyx_t_29;
 
-    /* "discretize/_extensions/tree_ext.pyx":6535
+    /* "discretize/_extensions/tree_ext.pyx":6532
  *             ix2 = min(_bisect_right(nodes_x, x1p), nx)
  *             iy1 = max(_bisect_left(nodes_y, y1m) - 1, 0)
  *             iy2 = min(_bisect_right(nodes_y, y1p), ny)             # <<<<<<<<<<<<<<
  *             if self._dim==3:
  *                 iz1 = max(_bisect_left(nodes_z, z1m) - 1, 0)
  */
-    __Pyx_TraceLine(6535,0,__PYX_ERR(0, 6535, __pyx_L1_error))
+    __Pyx_TraceLine(6532,0,__PYX_ERR(0, 6532, __pyx_L1_error))
     __pyx_t_6 = __pyx_v_ny;
     __pyx_t_29 = __pyx_f_10discretize_11_extensions_18interputils_cython__bisect_right(__pyx_v_nodes_y, __pyx_v_y1p);
     if (((__pyx_t_6 < __pyx_t_29) != 0)) {
       __pyx_t_28 = __pyx_t_6;
     } else {
       __pyx_t_28 = __pyx_t_29;
     }
     __pyx_v_iy2 = __pyx_t_28;
 
-    /* "discretize/_extensions/tree_ext.pyx":6536
+    /* "discretize/_extensions/tree_ext.pyx":6533
  *             iy1 = max(_bisect_left(nodes_y, y1m) - 1, 0)
  *             iy2 = min(_bisect_right(nodes_y, y1p), ny)
  *             if self._dim==3:             # <<<<<<<<<<<<<<
  *                 iz1 = max(_bisect_left(nodes_z, z1m) - 1, 0)
  *                 iz2 = min(_bisect_right(nodes_z, z1p), nz)
  */
-    __Pyx_TraceLine(6536,0,__PYX_ERR(0, 6536, __pyx_L1_error))
+    __Pyx_TraceLine(6533,0,__PYX_ERR(0, 6533, __pyx_L1_error))
     __pyx_t_13 = ((__pyx_v_self->_dim == 3) != 0);
     if (__pyx_t_13) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6537
+      /* "discretize/_extensions/tree_ext.pyx":6534
  *             iy2 = min(_bisect_right(nodes_y, y1p), ny)
  *             if self._dim==3:
  *                 iz1 = max(_bisect_left(nodes_z, z1m) - 1, 0)             # <<<<<<<<<<<<<<
  *                 iz2 = min(_bisect_right(nodes_z, z1p), nz)
  *             else:
  */
-      __Pyx_TraceLine(6537,0,__PYX_ERR(0, 6537, __pyx_L1_error))
+      __Pyx_TraceLine(6534,0,__PYX_ERR(0, 6534, __pyx_L1_error))
       __pyx_t_27 = 0;
       __pyx_t_28 = (__pyx_f_10discretize_11_extensions_18interputils_cython__bisect_left(__pyx_v_nodes_z, __pyx_v_z1m) - 1);
       if (((__pyx_t_27 > __pyx_t_28) != 0)) {
         __pyx_t_29 = __pyx_t_27;
       } else {
         __pyx_t_29 = __pyx_t_28;
       }
       __pyx_v_iz1 = __pyx_t_29;
 
-      /* "discretize/_extensions/tree_ext.pyx":6538
+      /* "discretize/_extensions/tree_ext.pyx":6535
  *             if self._dim==3:
  *                 iz1 = max(_bisect_left(nodes_z, z1m) - 1, 0)
  *                 iz2 = min(_bisect_right(nodes_z, z1p), nz)             # <<<<<<<<<<<<<<
  *             else:
  *                 iz1 = 0
  */
-      __Pyx_TraceLine(6538,0,__PYX_ERR(0, 6538, __pyx_L1_error))
+      __Pyx_TraceLine(6535,0,__PYX_ERR(0, 6535, __pyx_L1_error))
       __pyx_t_6 = __pyx_v_nz;
       __pyx_t_29 = __pyx_f_10discretize_11_extensions_18interputils_cython__bisect_right(__pyx_v_nodes_z, __pyx_v_z1p);
       if (((__pyx_t_6 < __pyx_t_29) != 0)) {
         __pyx_t_28 = __pyx_t_6;
       } else {
         __pyx_t_28 = __pyx_t_29;
       }
       __pyx_v_iz2 = __pyx_t_28;
 
-      /* "discretize/_extensions/tree_ext.pyx":6536
+      /* "discretize/_extensions/tree_ext.pyx":6533
  *             iy1 = max(_bisect_left(nodes_y, y1m) - 1, 0)
  *             iy2 = min(_bisect_right(nodes_y, y1p), ny)
  *             if self._dim==3:             # <<<<<<<<<<<<<<
  *                 iz1 = max(_bisect_left(nodes_z, z1m) - 1, 0)
  *                 iz2 = min(_bisect_right(nodes_z, z1p), nz)
  */
       goto __pyx_L25;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6540
+    /* "discretize/_extensions/tree_ext.pyx":6537
  *                 iz2 = min(_bisect_right(nodes_z, z1p), nz)
  *             else:
  *                 iz1 = 0             # <<<<<<<<<<<<<<
  *                 iz2 = 1
  *             nx_overlap = ix2-ix1
  */
-    __Pyx_TraceLine(6540,0,__PYX_ERR(0, 6540, __pyx_L1_error))
+    __Pyx_TraceLine(6537,0,__PYX_ERR(0, 6537, __pyx_L1_error))
     /*else*/ {
       __pyx_v_iz1 = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6541
+      /* "discretize/_extensions/tree_ext.pyx":6538
  *             else:
  *                 iz1 = 0
  *                 iz2 = 1             # <<<<<<<<<<<<<<
  *             nx_overlap = ix2-ix1
  *             ny_overlap = iy2-iy1
  */
-      __Pyx_TraceLine(6541,0,__PYX_ERR(0, 6541, __pyx_L1_error))
+      __Pyx_TraceLine(6538,0,__PYX_ERR(0, 6538, __pyx_L1_error))
       __pyx_v_iz2 = 1;
     }
     __pyx_L25:;
 
-    /* "discretize/_extensions/tree_ext.pyx":6542
+    /* "discretize/_extensions/tree_ext.pyx":6539
  *                 iz1 = 0
  *                 iz2 = 1
  *             nx_overlap = ix2-ix1             # <<<<<<<<<<<<<<
  *             ny_overlap = iy2-iy1
  *             nz_overlap = iz2-iz1
  */
-    __Pyx_TraceLine(6542,0,__PYX_ERR(0, 6542, __pyx_L1_error))
+    __Pyx_TraceLine(6539,0,__PYX_ERR(0, 6539, __pyx_L1_error))
     __pyx_v_nx_overlap = (__pyx_v_ix2 - __pyx_v_ix1);
 
-    /* "discretize/_extensions/tree_ext.pyx":6543
+    /* "discretize/_extensions/tree_ext.pyx":6540
  *                 iz2 = 1
  *             nx_overlap = ix2-ix1
  *             ny_overlap = iy2-iy1             # <<<<<<<<<<<<<<
  *             nz_overlap = iz2-iz1
  *             n_overlap = nx_overlap*ny_overlap*nz_overlap
  */
-    __Pyx_TraceLine(6543,0,__PYX_ERR(0, 6543, __pyx_L1_error))
+    __Pyx_TraceLine(6540,0,__PYX_ERR(0, 6540, __pyx_L1_error))
     __pyx_v_ny_overlap = (__pyx_v_iy2 - __pyx_v_iy1);
 
-    /* "discretize/_extensions/tree_ext.pyx":6544
+    /* "discretize/_extensions/tree_ext.pyx":6541
  *             nx_overlap = ix2-ix1
  *             ny_overlap = iy2-iy1
  *             nz_overlap = iz2-iz1             # <<<<<<<<<<<<<<
  *             n_overlap = nx_overlap*ny_overlap*nz_overlap
  *             weights = <double *> malloc(n_overlap*sizeof(double))
  */
-    __Pyx_TraceLine(6544,0,__PYX_ERR(0, 6544, __pyx_L1_error))
+    __Pyx_TraceLine(6541,0,__PYX_ERR(0, 6541, __pyx_L1_error))
     __pyx_v_nz_overlap = (__pyx_v_iz2 - __pyx_v_iz1);
 
-    /* "discretize/_extensions/tree_ext.pyx":6545
+    /* "discretize/_extensions/tree_ext.pyx":6542
  *             ny_overlap = iy2-iy1
  *             nz_overlap = iz2-iz1
  *             n_overlap = nx_overlap*ny_overlap*nz_overlap             # <<<<<<<<<<<<<<
  *             weights = <double *> malloc(n_overlap*sizeof(double))
  * 
  */
-    __Pyx_TraceLine(6545,0,__PYX_ERR(0, 6545, __pyx_L1_error))
+    __Pyx_TraceLine(6542,0,__PYX_ERR(0, 6542, __pyx_L1_error))
     __pyx_v_n_overlap = ((__pyx_v_nx_overlap * __pyx_v_ny_overlap) * __pyx_v_nz_overlap);
 
-    /* "discretize/_extensions/tree_ext.pyx":6546
+    /* "discretize/_extensions/tree_ext.pyx":6543
  *             nz_overlap = iz2-iz1
  *             n_overlap = nx_overlap*ny_overlap*nz_overlap
  *             weights = <double *> malloc(n_overlap*sizeof(double))             # <<<<<<<<<<<<<<
  * 
  *             dx = <double *> malloc(nx_overlap*sizeof(double))
  */
-    __Pyx_TraceLine(6546,0,__PYX_ERR(0, 6546, __pyx_L1_error))
+    __Pyx_TraceLine(6543,0,__PYX_ERR(0, 6543, __pyx_L1_error))
     __pyx_v_weights = ((double *)malloc((__pyx_v_n_overlap * (sizeof(double)))));
 
-    /* "discretize/_extensions/tree_ext.pyx":6548
+    /* "discretize/_extensions/tree_ext.pyx":6545
  *             weights = <double *> malloc(n_overlap*sizeof(double))
  * 
  *             dx = <double *> malloc(nx_overlap*sizeof(double))             # <<<<<<<<<<<<<<
  *             for ix in range(ix1, ix2):
  *                 x2m = nodes_x[ix]
  */
-    __Pyx_TraceLine(6548,0,__PYX_ERR(0, 6548, __pyx_L1_error))
+    __Pyx_TraceLine(6545,0,__PYX_ERR(0, 6545, __pyx_L1_error))
     __pyx_v_dx = ((double *)malloc((__pyx_v_nx_overlap * (sizeof(double)))));
 
-    /* "discretize/_extensions/tree_ext.pyx":6549
+    /* "discretize/_extensions/tree_ext.pyx":6546
  * 
  *             dx = <double *> malloc(nx_overlap*sizeof(double))
  *             for ix in range(ix1, ix2):             # <<<<<<<<<<<<<<
  *                 x2m = nodes_x[ix]
  *                 x2p = nodes_x[ix+1]
  */
-    __Pyx_TraceLine(6549,0,__PYX_ERR(0, 6549, __pyx_L1_error))
+    __Pyx_TraceLine(6546,0,__PYX_ERR(0, 6546, __pyx_L1_error))
     __pyx_t_6 = __pyx_v_ix2;
     __pyx_t_14 = __pyx_t_6;
     for (__pyx_t_30 = __pyx_v_ix1; __pyx_t_30 < __pyx_t_14; __pyx_t_30+=1) {
       __pyx_v_ix = __pyx_t_30;
 
-      /* "discretize/_extensions/tree_ext.pyx":6550
+      /* "discretize/_extensions/tree_ext.pyx":6547
  *             dx = <double *> malloc(nx_overlap*sizeof(double))
  *             for ix in range(ix1, ix2):
  *                 x2m = nodes_x[ix]             # <<<<<<<<<<<<<<
  *                 x2p = nodes_x[ix+1]
  *                 if x1m == xF[0] or x1p == origin[0]:
  */
-      __Pyx_TraceLine(6550,0,__PYX_ERR(0, 6550, __pyx_L1_error))
+      __Pyx_TraceLine(6547,0,__PYX_ERR(0, 6547, __pyx_L1_error))
       __pyx_t_18 = __pyx_v_ix;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_x.shape[0];
       __pyx_v_x2m = (*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_x.data + __pyx_t_18 * __pyx_v_nodes_x.strides[0]) )));
 
-      /* "discretize/_extensions/tree_ext.pyx":6551
+      /* "discretize/_extensions/tree_ext.pyx":6548
  *             for ix in range(ix1, ix2):
  *                 x2m = nodes_x[ix]
  *                 x2p = nodes_x[ix+1]             # <<<<<<<<<<<<<<
  *                 if x1m == xF[0] or x1p == origin[0]:
  *                     dx[ix-ix1] = 1.0
  */
-      __Pyx_TraceLine(6551,0,__PYX_ERR(0, 6551, __pyx_L1_error))
+      __Pyx_TraceLine(6548,0,__PYX_ERR(0, 6548, __pyx_L1_error))
       __pyx_t_18 = (__pyx_v_ix + 1);
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_x.shape[0];
       __pyx_v_x2p = (*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_x.data + __pyx_t_18 * __pyx_v_nodes_x.strides[0]) )));
 
-      /* "discretize/_extensions/tree_ext.pyx":6552
+      /* "discretize/_extensions/tree_ext.pyx":6549
  *                 x2m = nodes_x[ix]
  *                 x2p = nodes_x[ix+1]
  *                 if x1m == xF[0] or x1p == origin[0]:             # <<<<<<<<<<<<<<
  *                     dx[ix-ix1] = 1.0
  *                 else:
  */
-      __Pyx_TraceLine(6552,0,__PYX_ERR(0, 6552, __pyx_L1_error))
+      __Pyx_TraceLine(6549,0,__PYX_ERR(0, 6549, __pyx_L1_error))
       __pyx_t_18 = 0;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_xF.shape[0];
       __pyx_t_15 = ((__pyx_v_x1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_18 * __pyx_v_xF.strides[0]) )))) != 0);
       if (!__pyx_t_15) {
       } else {
         __pyx_t_13 = __pyx_t_15;
         goto __pyx_L29_bool_binop_done;
@@ -84348,42 +84360,42 @@
       __pyx_t_18 = 0;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_origin.shape[0];
       __pyx_t_15 = ((__pyx_v_x1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_18 * __pyx_v_origin.strides[0]) )))) != 0);
       __pyx_t_13 = __pyx_t_15;
       __pyx_L29_bool_binop_done:;
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6553
+        /* "discretize/_extensions/tree_ext.pyx":6550
  *                 x2p = nodes_x[ix+1]
  *                 if x1m == xF[0] or x1p == origin[0]:
  *                     dx[ix-ix1] = 1.0             # <<<<<<<<<<<<<<
  *                 else:
  *                     dx[ix-ix1] = min(x1p, x2p) - max(x1m, x2m)
  */
-        __Pyx_TraceLine(6553,0,__PYX_ERR(0, 6553, __pyx_L1_error))
+        __Pyx_TraceLine(6550,0,__PYX_ERR(0, 6550, __pyx_L1_error))
         (__pyx_v_dx[(__pyx_v_ix - __pyx_v_ix1)]) = 1.0;
 
-        /* "discretize/_extensions/tree_ext.pyx":6552
+        /* "discretize/_extensions/tree_ext.pyx":6549
  *                 x2m = nodes_x[ix]
  *                 x2p = nodes_x[ix+1]
  *                 if x1m == xF[0] or x1p == origin[0]:             # <<<<<<<<<<<<<<
  *                     dx[ix-ix1] = 1.0
  *                 else:
  */
         goto __pyx_L28;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6555
+      /* "discretize/_extensions/tree_ext.pyx":6552
  *                     dx[ix-ix1] = 1.0
  *                 else:
  *                     dx[ix-ix1] = min(x1p, x2p) - max(x1m, x2m)             # <<<<<<<<<<<<<<
  * 
  *             dy = <double *> malloc(ny_overlap*sizeof(double))
  */
-      __Pyx_TraceLine(6555,0,__PYX_ERR(0, 6555, __pyx_L1_error))
+      __Pyx_TraceLine(6552,0,__PYX_ERR(0, 6552, __pyx_L1_error))
       /*else*/ {
         __pyx_t_24 = __pyx_v_x2p;
         __pyx_t_25 = __pyx_v_x1p;
         if (((__pyx_t_24 < __pyx_t_25) != 0)) {
           __pyx_t_26 = __pyx_t_24;
         } else {
           __pyx_t_26 = __pyx_t_25;
@@ -84396,69 +84408,69 @@
           __pyx_t_31 = __pyx_t_25;
         }
         (__pyx_v_dx[(__pyx_v_ix - __pyx_v_ix1)]) = (__pyx_t_26 - __pyx_t_31);
       }
       __pyx_L28:;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6557
+    /* "discretize/_extensions/tree_ext.pyx":6554
  *                     dx[ix-ix1] = min(x1p, x2p) - max(x1m, x2m)
  * 
  *             dy = <double *> malloc(ny_overlap*sizeof(double))             # <<<<<<<<<<<<<<
  *             for iy in range(iy1, iy2):
  *                 y2m = nodes_y[iy]
  */
-    __Pyx_TraceLine(6557,0,__PYX_ERR(0, 6557, __pyx_L1_error))
+    __Pyx_TraceLine(6554,0,__PYX_ERR(0, 6554, __pyx_L1_error))
     __pyx_v_dy = ((double *)malloc((__pyx_v_ny_overlap * (sizeof(double)))));
 
-    /* "discretize/_extensions/tree_ext.pyx":6558
+    /* "discretize/_extensions/tree_ext.pyx":6555
  * 
  *             dy = <double *> malloc(ny_overlap*sizeof(double))
  *             for iy in range(iy1, iy2):             # <<<<<<<<<<<<<<
  *                 y2m = nodes_y[iy]
  *                 y2p = nodes_y[iy+1]
  */
-    __Pyx_TraceLine(6558,0,__PYX_ERR(0, 6558, __pyx_L1_error))
+    __Pyx_TraceLine(6555,0,__PYX_ERR(0, 6555, __pyx_L1_error))
     __pyx_t_6 = __pyx_v_iy2;
     __pyx_t_14 = __pyx_t_6;
     for (__pyx_t_30 = __pyx_v_iy1; __pyx_t_30 < __pyx_t_14; __pyx_t_30+=1) {
       __pyx_v_iy = __pyx_t_30;
 
-      /* "discretize/_extensions/tree_ext.pyx":6559
+      /* "discretize/_extensions/tree_ext.pyx":6556
  *             dy = <double *> malloc(ny_overlap*sizeof(double))
  *             for iy in range(iy1, iy2):
  *                 y2m = nodes_y[iy]             # <<<<<<<<<<<<<<
  *                 y2p = nodes_y[iy+1]
  *                 if y1m == xF[1] or y1p == origin[1]:
  */
-      __Pyx_TraceLine(6559,0,__PYX_ERR(0, 6559, __pyx_L1_error))
+      __Pyx_TraceLine(6556,0,__PYX_ERR(0, 6556, __pyx_L1_error))
       __pyx_t_18 = __pyx_v_iy;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_y.shape[0];
       __pyx_v_y2m = (*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_y.data + __pyx_t_18 * __pyx_v_nodes_y.strides[0]) )));
 
-      /* "discretize/_extensions/tree_ext.pyx":6560
+      /* "discretize/_extensions/tree_ext.pyx":6557
  *             for iy in range(iy1, iy2):
  *                 y2m = nodes_y[iy]
  *                 y2p = nodes_y[iy+1]             # <<<<<<<<<<<<<<
  *                 if y1m == xF[1] or y1p == origin[1]:
  *                     dy[iy-iy1] = 1.0
  */
-      __Pyx_TraceLine(6560,0,__PYX_ERR(0, 6560, __pyx_L1_error))
+      __Pyx_TraceLine(6557,0,__PYX_ERR(0, 6557, __pyx_L1_error))
       __pyx_t_18 = (__pyx_v_iy + 1);
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_y.shape[0];
       __pyx_v_y2p = (*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_y.data + __pyx_t_18 * __pyx_v_nodes_y.strides[0]) )));
 
-      /* "discretize/_extensions/tree_ext.pyx":6561
+      /* "discretize/_extensions/tree_ext.pyx":6558
  *                 y2m = nodes_y[iy]
  *                 y2p = nodes_y[iy+1]
  *                 if y1m == xF[1] or y1p == origin[1]:             # <<<<<<<<<<<<<<
  *                     dy[iy-iy1] = 1.0
  *                 else:
  */
-      __Pyx_TraceLine(6561,0,__PYX_ERR(0, 6561, __pyx_L1_error))
+      __Pyx_TraceLine(6558,0,__PYX_ERR(0, 6558, __pyx_L1_error))
       __pyx_t_18 = 1;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_xF.shape[0];
       __pyx_t_15 = ((__pyx_v_y1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_18 * __pyx_v_xF.strides[0]) )))) != 0);
       if (!__pyx_t_15) {
       } else {
         __pyx_t_13 = __pyx_t_15;
         goto __pyx_L34_bool_binop_done;
@@ -84466,42 +84478,42 @@
       __pyx_t_18 = 1;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_origin.shape[0];
       __pyx_t_15 = ((__pyx_v_y1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_18 * __pyx_v_origin.strides[0]) )))) != 0);
       __pyx_t_13 = __pyx_t_15;
       __pyx_L34_bool_binop_done:;
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6562
+        /* "discretize/_extensions/tree_ext.pyx":6559
  *                 y2p = nodes_y[iy+1]
  *                 if y1m == xF[1] or y1p == origin[1]:
  *                     dy[iy-iy1] = 1.0             # <<<<<<<<<<<<<<
  *                 else:
  *                     dy[iy-iy1] = min(y1p, y2p) - max(y1m, y2m)
  */
-        __Pyx_TraceLine(6562,0,__PYX_ERR(0, 6562, __pyx_L1_error))
+        __Pyx_TraceLine(6559,0,__PYX_ERR(0, 6559, __pyx_L1_error))
         (__pyx_v_dy[(__pyx_v_iy - __pyx_v_iy1)]) = 1.0;
 
-        /* "discretize/_extensions/tree_ext.pyx":6561
+        /* "discretize/_extensions/tree_ext.pyx":6558
  *                 y2m = nodes_y[iy]
  *                 y2p = nodes_y[iy+1]
  *                 if y1m == xF[1] or y1p == origin[1]:             # <<<<<<<<<<<<<<
  *                     dy[iy-iy1] = 1.0
  *                 else:
  */
         goto __pyx_L33;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6564
+      /* "discretize/_extensions/tree_ext.pyx":6561
  *                     dy[iy-iy1] = 1.0
  *                 else:
  *                     dy[iy-iy1] = min(y1p, y2p) - max(y1m, y2m)             # <<<<<<<<<<<<<<
  * 
  *             dz = <double *> malloc(nz_overlap*sizeof(double))
  */
-      __Pyx_TraceLine(6564,0,__PYX_ERR(0, 6564, __pyx_L1_error))
+      __Pyx_TraceLine(6561,0,__PYX_ERR(0, 6561, __pyx_L1_error))
       /*else*/ {
         __pyx_t_31 = __pyx_v_y2p;
         __pyx_t_26 = __pyx_v_y1p;
         if (((__pyx_t_31 < __pyx_t_26) != 0)) {
           __pyx_t_24 = __pyx_t_31;
         } else {
           __pyx_t_24 = __pyx_t_26;
@@ -84514,80 +84526,80 @@
           __pyx_t_25 = __pyx_t_26;
         }
         (__pyx_v_dy[(__pyx_v_iy - __pyx_v_iy1)]) = (__pyx_t_24 - __pyx_t_25);
       }
       __pyx_L33:;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6566
+    /* "discretize/_extensions/tree_ext.pyx":6563
  *                     dy[iy-iy1] = min(y1p, y2p) - max(y1m, y2m)
  * 
  *             dz = <double *> malloc(nz_overlap*sizeof(double))             # <<<<<<<<<<<<<<
  *             for iz in range(iz1, iz2):
  *                 z2m = nodes_z[iz]
  */
-    __Pyx_TraceLine(6566,0,__PYX_ERR(0, 6566, __pyx_L1_error))
+    __Pyx_TraceLine(6563,0,__PYX_ERR(0, 6563, __pyx_L1_error))
     __pyx_v_dz = ((double *)malloc((__pyx_v_nz_overlap * (sizeof(double)))));
 
-    /* "discretize/_extensions/tree_ext.pyx":6567
+    /* "discretize/_extensions/tree_ext.pyx":6564
  * 
  *             dz = <double *> malloc(nz_overlap*sizeof(double))
  *             for iz in range(iz1, iz2):             # <<<<<<<<<<<<<<
  *                 z2m = nodes_z[iz]
  *                 z2p = nodes_z[iz+1]
  */
-    __Pyx_TraceLine(6567,0,__PYX_ERR(0, 6567, __pyx_L1_error))
+    __Pyx_TraceLine(6564,0,__PYX_ERR(0, 6564, __pyx_L1_error))
     __pyx_t_6 = __pyx_v_iz2;
     __pyx_t_14 = __pyx_t_6;
     for (__pyx_t_30 = __pyx_v_iz1; __pyx_t_30 < __pyx_t_14; __pyx_t_30+=1) {
       __pyx_v_iz = __pyx_t_30;
 
-      /* "discretize/_extensions/tree_ext.pyx":6568
+      /* "discretize/_extensions/tree_ext.pyx":6565
  *             dz = <double *> malloc(nz_overlap*sizeof(double))
  *             for iz in range(iz1, iz2):
  *                 z2m = nodes_z[iz]             # <<<<<<<<<<<<<<
  *                 z2p = nodes_z[iz+1]
  *                 if self._dim==3:
  */
-      __Pyx_TraceLine(6568,0,__PYX_ERR(0, 6568, __pyx_L1_error))
+      __Pyx_TraceLine(6565,0,__PYX_ERR(0, 6565, __pyx_L1_error))
       __pyx_t_18 = __pyx_v_iz;
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_z.shape[0];
       __pyx_v_z2m = (*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_z.data + __pyx_t_18 * __pyx_v_nodes_z.strides[0]) )));
 
-      /* "discretize/_extensions/tree_ext.pyx":6569
+      /* "discretize/_extensions/tree_ext.pyx":6566
  *             for iz in range(iz1, iz2):
  *                 z2m = nodes_z[iz]
  *                 z2p = nodes_z[iz+1]             # <<<<<<<<<<<<<<
  *                 if self._dim==3:
  *                     if z1m == xF[2] or z1p == origin[2]:
  */
-      __Pyx_TraceLine(6569,0,__PYX_ERR(0, 6569, __pyx_L1_error))
+      __Pyx_TraceLine(6566,0,__PYX_ERR(0, 6566, __pyx_L1_error))
       __pyx_t_18 = (__pyx_v_iz + 1);
       if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_nodes_z.shape[0];
       __pyx_v_z2p = (*((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_nodes_z.data + __pyx_t_18 * __pyx_v_nodes_z.strides[0]) )));
 
-      /* "discretize/_extensions/tree_ext.pyx":6570
+      /* "discretize/_extensions/tree_ext.pyx":6567
  *                 z2m = nodes_z[iz]
  *                 z2p = nodes_z[iz+1]
  *                 if self._dim==3:             # <<<<<<<<<<<<<<
  *                     if z1m == xF[2] or z1p == origin[2]:
  *                         dz[iz-iz1] = 1.0
  */
-      __Pyx_TraceLine(6570,0,__PYX_ERR(0, 6570, __pyx_L1_error))
+      __Pyx_TraceLine(6567,0,__PYX_ERR(0, 6567, __pyx_L1_error))
       __pyx_t_13 = ((__pyx_v_self->_dim == 3) != 0);
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6571
+        /* "discretize/_extensions/tree_ext.pyx":6568
  *                 z2p = nodes_z[iz+1]
  *                 if self._dim==3:
  *                     if z1m == xF[2] or z1p == origin[2]:             # <<<<<<<<<<<<<<
  *                         dz[iz-iz1] = 1.0
  *                     else:
  */
-        __Pyx_TraceLine(6571,0,__PYX_ERR(0, 6571, __pyx_L1_error))
+        __Pyx_TraceLine(6568,0,__PYX_ERR(0, 6568, __pyx_L1_error))
         __pyx_t_18 = 2;
         if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_xF.shape[0];
         __pyx_t_15 = ((__pyx_v_z1m == (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_18 * __pyx_v_xF.strides[0]) )))) != 0);
         if (!__pyx_t_15) {
         } else {
           __pyx_t_13 = __pyx_t_15;
           goto __pyx_L40_bool_binop_done;
@@ -84595,42 +84607,42 @@
         __pyx_t_18 = 2;
         if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_origin.shape[0];
         __pyx_t_15 = ((__pyx_v_z1p == (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_18 * __pyx_v_origin.strides[0]) )))) != 0);
         __pyx_t_13 = __pyx_t_15;
         __pyx_L40_bool_binop_done:;
         if (__pyx_t_13) {
 
-          /* "discretize/_extensions/tree_ext.pyx":6572
+          /* "discretize/_extensions/tree_ext.pyx":6569
  *                 if self._dim==3:
  *                     if z1m == xF[2] or z1p == origin[2]:
  *                         dz[iz-iz1] = 1.0             # <<<<<<<<<<<<<<
  *                     else:
  *                         dz[iz-iz1] = min(z1p, z2p) - max(z1m, z2m)
  */
-          __Pyx_TraceLine(6572,0,__PYX_ERR(0, 6572, __pyx_L1_error))
+          __Pyx_TraceLine(6569,0,__PYX_ERR(0, 6569, __pyx_L1_error))
           (__pyx_v_dz[(__pyx_v_iz - __pyx_v_iz1)]) = 1.0;
 
-          /* "discretize/_extensions/tree_ext.pyx":6571
+          /* "discretize/_extensions/tree_ext.pyx":6568
  *                 z2p = nodes_z[iz+1]
  *                 if self._dim==3:
  *                     if z1m == xF[2] or z1p == origin[2]:             # <<<<<<<<<<<<<<
  *                         dz[iz-iz1] = 1.0
  *                     else:
  */
           goto __pyx_L39;
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6574
+        /* "discretize/_extensions/tree_ext.pyx":6571
  *                         dz[iz-iz1] = 1.0
  *                     else:
  *                         dz[iz-iz1] = min(z1p, z2p) - max(z1m, z2m)             # <<<<<<<<<<<<<<
  *                 else:
  *                     dz[iz-iz1] = 1.0
  */
-        __Pyx_TraceLine(6574,0,__PYX_ERR(0, 6574, __pyx_L1_error))
+        __Pyx_TraceLine(6571,0,__PYX_ERR(0, 6571, __pyx_L1_error))
         /*else*/ {
           __pyx_t_25 = __pyx_v_z2p;
           __pyx_t_24 = __pyx_v_z1p;
           if (((__pyx_t_25 < __pyx_t_24) != 0)) {
             __pyx_t_31 = __pyx_t_25;
           } else {
             __pyx_t_31 = __pyx_t_24;
@@ -84642,542 +84654,542 @@
           } else {
             __pyx_t_26 = __pyx_t_24;
           }
           (__pyx_v_dz[(__pyx_v_iz - __pyx_v_iz1)]) = (__pyx_t_31 - __pyx_t_26);
         }
         __pyx_L39:;
 
-        /* "discretize/_extensions/tree_ext.pyx":6570
+        /* "discretize/_extensions/tree_ext.pyx":6567
  *                 z2m = nodes_z[iz]
  *                 z2p = nodes_z[iz+1]
  *                 if self._dim==3:             # <<<<<<<<<<<<<<
  *                     if z1m == xF[2] or z1p == origin[2]:
  *                         dz[iz-iz1] = 1.0
  */
         goto __pyx_L38;
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6576
+      /* "discretize/_extensions/tree_ext.pyx":6573
  *                         dz[iz-iz1] = min(z1p, z2p) - max(z1m, z2m)
  *                 else:
  *                     dz[iz-iz1] = 1.0             # <<<<<<<<<<<<<<
  * 
  *             i = 0
  */
-      __Pyx_TraceLine(6576,0,__PYX_ERR(0, 6576, __pyx_L1_error))
+      __Pyx_TraceLine(6573,0,__PYX_ERR(0, 6573, __pyx_L1_error))
       /*else*/ {
         (__pyx_v_dz[(__pyx_v_iz - __pyx_v_iz1)]) = 1.0;
       }
       __pyx_L38:;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6578
+    /* "discretize/_extensions/tree_ext.pyx":6575
  *                     dz[iz-iz1] = 1.0
  * 
  *             i = 0             # <<<<<<<<<<<<<<
  *             weight_sum = 0.0
  *             nnz_row = 0
  */
-    __Pyx_TraceLine(6578,0,__PYX_ERR(0, 6578, __pyx_L1_error))
+    __Pyx_TraceLine(6575,0,__PYX_ERR(0, 6575, __pyx_L1_error))
     __pyx_v_i = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6579
+    /* "discretize/_extensions/tree_ext.pyx":6576
  * 
  *             i = 0
  *             weight_sum = 0.0             # <<<<<<<<<<<<<<
  *             nnz_row = 0
  *             for iz in range(iz1, iz2):
  */
-    __Pyx_TraceLine(6579,0,__PYX_ERR(0, 6579, __pyx_L1_error))
+    __Pyx_TraceLine(6576,0,__PYX_ERR(0, 6576, __pyx_L1_error))
     __pyx_v_weight_sum = 0.0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6580
+    /* "discretize/_extensions/tree_ext.pyx":6577
  *             i = 0
  *             weight_sum = 0.0
  *             nnz_row = 0             # <<<<<<<<<<<<<<
  *             for iz in range(iz1, iz2):
  *                 for iy in range(iy1, iy2):
  */
-    __Pyx_TraceLine(6580,0,__PYX_ERR(0, 6580, __pyx_L1_error))
+    __Pyx_TraceLine(6577,0,__PYX_ERR(0, 6577, __pyx_L1_error))
     __pyx_v_nnz_row = 0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6581
+    /* "discretize/_extensions/tree_ext.pyx":6578
  *             weight_sum = 0.0
  *             nnz_row = 0
  *             for iz in range(iz1, iz2):             # <<<<<<<<<<<<<<
  *                 for iy in range(iy1, iy2):
  *                     for ix in range(ix1, ix2):
  */
-    __Pyx_TraceLine(6581,0,__PYX_ERR(0, 6581, __pyx_L1_error))
+    __Pyx_TraceLine(6578,0,__PYX_ERR(0, 6578, __pyx_L1_error))
     __pyx_t_6 = __pyx_v_iz2;
     __pyx_t_14 = __pyx_t_6;
     for (__pyx_t_30 = __pyx_v_iz1; __pyx_t_30 < __pyx_t_14; __pyx_t_30+=1) {
       __pyx_v_iz = __pyx_t_30;
 
-      /* "discretize/_extensions/tree_ext.pyx":6582
+      /* "discretize/_extensions/tree_ext.pyx":6579
  *             nnz_row = 0
  *             for iz in range(iz1, iz2):
  *                 for iy in range(iy1, iy2):             # <<<<<<<<<<<<<<
  *                     for ix in range(ix1, ix2):
  *                         in_cell_ind = ix + (iy + iz*ny)*nx
  */
-      __Pyx_TraceLine(6582,0,__PYX_ERR(0, 6582, __pyx_L1_error))
+      __Pyx_TraceLine(6579,0,__PYX_ERR(0, 6579, __pyx_L1_error))
       __pyx_t_32 = __pyx_v_iy2;
       __pyx_t_33 = __pyx_t_32;
       for (__pyx_t_34 = __pyx_v_iy1; __pyx_t_34 < __pyx_t_33; __pyx_t_34+=1) {
         __pyx_v_iy = __pyx_t_34;
 
-        /* "discretize/_extensions/tree_ext.pyx":6583
+        /* "discretize/_extensions/tree_ext.pyx":6580
  *             for iz in range(iz1, iz2):
  *                 for iy in range(iy1, iy2):
  *                     for ix in range(ix1, ix2):             # <<<<<<<<<<<<<<
  *                         in_cell_ind = ix + (iy + iz*ny)*nx
  *                         weights[i] = dx[ix-ix1]*dy[iy-iy1]*dz[iz-iz1]
  */
-        __Pyx_TraceLine(6583,0,__PYX_ERR(0, 6583, __pyx_L1_error))
+        __Pyx_TraceLine(6580,0,__PYX_ERR(0, 6580, __pyx_L1_error))
         __pyx_t_35 = __pyx_v_ix2;
         __pyx_t_36 = __pyx_t_35;
         for (__pyx_t_37 = __pyx_v_ix1; __pyx_t_37 < __pyx_t_36; __pyx_t_37+=1) {
           __pyx_v_ix = __pyx_t_37;
 
-          /* "discretize/_extensions/tree_ext.pyx":6584
+          /* "discretize/_extensions/tree_ext.pyx":6581
  *                 for iy in range(iy1, iy2):
  *                     for ix in range(ix1, ix2):
  *                         in_cell_ind = ix + (iy + iz*ny)*nx             # <<<<<<<<<<<<<<
  *                         weights[i] = dx[ix-ix1]*dy[iy-iy1]*dz[iz-iz1]
  *                         if build_mat and weights[i] != 0.0:
  */
-          __Pyx_TraceLine(6584,0,__PYX_ERR(0, 6584, __pyx_L1_error))
+          __Pyx_TraceLine(6581,0,__PYX_ERR(0, 6581, __pyx_L1_error))
           __pyx_v_in_cell_ind = (__pyx_v_ix + ((__pyx_v_iy + (__pyx_v_iz * __pyx_v_ny)) * __pyx_v_nx));
 
-          /* "discretize/_extensions/tree_ext.pyx":6585
+          /* "discretize/_extensions/tree_ext.pyx":6582
  *                     for ix in range(ix1, ix2):
  *                         in_cell_ind = ix + (iy + iz*ny)*nx
  *                         weights[i] = dx[ix-ix1]*dy[iy-iy1]*dz[iz-iz1]             # <<<<<<<<<<<<<<
  *                         if build_mat and weights[i] != 0.0:
  *                             nnz_row += 1
  */
-          __Pyx_TraceLine(6585,0,__PYX_ERR(0, 6585, __pyx_L1_error))
+          __Pyx_TraceLine(6582,0,__PYX_ERR(0, 6582, __pyx_L1_error))
           (__pyx_v_weights[__pyx_v_i]) = (((__pyx_v_dx[(__pyx_v_ix - __pyx_v_ix1)]) * (__pyx_v_dy[(__pyx_v_iy - __pyx_v_iy1)])) * (__pyx_v_dz[(__pyx_v_iz - __pyx_v_iz1)]));
 
-          /* "discretize/_extensions/tree_ext.pyx":6586
+          /* "discretize/_extensions/tree_ext.pyx":6583
  *                         in_cell_ind = ix + (iy + iz*ny)*nx
  *                         weights[i] = dx[ix-ix1]*dy[iy-iy1]*dz[iz-iz1]
  *                         if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                             nnz_row += 1
  *                             row_inds.push_back(in_cell_ind)
  */
-          __Pyx_TraceLine(6586,0,__PYX_ERR(0, 6586, __pyx_L1_error))
+          __Pyx_TraceLine(6583,0,__PYX_ERR(0, 6583, __pyx_L1_error))
           __pyx_t_15 = (__pyx_v_build_mat != 0);
           if (__pyx_t_15) {
           } else {
             __pyx_t_13 = __pyx_t_15;
             goto __pyx_L49_bool_binop_done;
           }
           __pyx_t_15 = (((__pyx_v_weights[__pyx_v_i]) != 0.0) != 0);
           __pyx_t_13 = __pyx_t_15;
           __pyx_L49_bool_binop_done:;
           if (__pyx_t_13) {
 
-            /* "discretize/_extensions/tree_ext.pyx":6587
+            /* "discretize/_extensions/tree_ext.pyx":6584
  *                         weights[i] = dx[ix-ix1]*dy[iy-iy1]*dz[iz-iz1]
  *                         if build_mat and weights[i] != 0.0:
  *                             nnz_row += 1             # <<<<<<<<<<<<<<
  *                             row_inds.push_back(in_cell_ind)
  * 
  */
-            __Pyx_TraceLine(6587,0,__PYX_ERR(0, 6587, __pyx_L1_error))
+            __Pyx_TraceLine(6584,0,__PYX_ERR(0, 6584, __pyx_L1_error))
             __pyx_v_nnz_row = (__pyx_v_nnz_row + 1);
 
-            /* "discretize/_extensions/tree_ext.pyx":6588
+            /* "discretize/_extensions/tree_ext.pyx":6585
  *                         if build_mat and weights[i] != 0.0:
  *                             nnz_row += 1
  *                             row_inds.push_back(in_cell_ind)             # <<<<<<<<<<<<<<
  * 
  *                         weight_sum += weights[i]
  */
-            __Pyx_TraceLine(6588,0,__PYX_ERR(0, 6588, __pyx_L1_error))
+            __Pyx_TraceLine(6585,0,__PYX_ERR(0, 6585, __pyx_L1_error))
             try {
               __pyx_v_row_inds.push_back(__pyx_v_in_cell_ind);
             } catch(...) {
               __Pyx_CppExn2PyErr();
-              __PYX_ERR(0, 6588, __pyx_L1_error)
+              __PYX_ERR(0, 6585, __pyx_L1_error)
             }
 
-            /* "discretize/_extensions/tree_ext.pyx":6586
+            /* "discretize/_extensions/tree_ext.pyx":6583
  *                         in_cell_ind = ix + (iy + iz*ny)*nx
  *                         weights[i] = dx[ix-ix1]*dy[iy-iy1]*dz[iz-iz1]
  *                         if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                             nnz_row += 1
  *                             row_inds.push_back(in_cell_ind)
  */
           }
 
-          /* "discretize/_extensions/tree_ext.pyx":6590
+          /* "discretize/_extensions/tree_ext.pyx":6587
  *                             row_inds.push_back(in_cell_ind)
  * 
  *                         weight_sum += weights[i]             # <<<<<<<<<<<<<<
  *                         i += 1
  * 
  */
-          __Pyx_TraceLine(6590,0,__PYX_ERR(0, 6590, __pyx_L1_error))
+          __Pyx_TraceLine(6587,0,__PYX_ERR(0, 6587, __pyx_L1_error))
           __pyx_v_weight_sum = (__pyx_v_weight_sum + (__pyx_v_weights[__pyx_v_i]));
 
-          /* "discretize/_extensions/tree_ext.pyx":6591
+          /* "discretize/_extensions/tree_ext.pyx":6588
  * 
  *                         weight_sum += weights[i]
  *                         i += 1             # <<<<<<<<<<<<<<
  * 
  *             for i in range(n_overlap):
  */
-          __Pyx_TraceLine(6591,0,__PYX_ERR(0, 6591, __pyx_L1_error))
+          __Pyx_TraceLine(6588,0,__PYX_ERR(0, 6588, __pyx_L1_error))
           __pyx_v_i = (__pyx_v_i + 1);
         }
       }
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6593
+    /* "discretize/_extensions/tree_ext.pyx":6590
  *                         i += 1
  * 
  *             for i in range(n_overlap):             # <<<<<<<<<<<<<<
  *                 weights[i] /= weight_sum
  *                 if build_mat and weights[i] != 0.0:
  */
-    __Pyx_TraceLine(6593,0,__PYX_ERR(0, 6593, __pyx_L1_error))
+    __Pyx_TraceLine(6590,0,__PYX_ERR(0, 6590, __pyx_L1_error))
     __pyx_t_6 = __pyx_v_n_overlap;
     __pyx_t_14 = __pyx_t_6;
     for (__pyx_t_30 = 0; __pyx_t_30 < __pyx_t_14; __pyx_t_30+=1) {
       __pyx_v_i = __pyx_t_30;
 
-      /* "discretize/_extensions/tree_ext.pyx":6594
+      /* "discretize/_extensions/tree_ext.pyx":6591
  * 
  *             for i in range(n_overlap):
  *                 weights[i] /= weight_sum             # <<<<<<<<<<<<<<
  *                 if build_mat and weights[i] != 0.0:
  *                     all_weights.push_back(weights[i])
  */
-      __Pyx_TraceLine(6594,0,__PYX_ERR(0, 6594, __pyx_L1_error))
+      __Pyx_TraceLine(6591,0,__PYX_ERR(0, 6591, __pyx_L1_error))
       __pyx_t_32 = __pyx_v_i;
       (__pyx_v_weights[__pyx_t_32]) = ((__pyx_v_weights[__pyx_t_32]) / __pyx_v_weight_sum);
 
-      /* "discretize/_extensions/tree_ext.pyx":6595
+      /* "discretize/_extensions/tree_ext.pyx":6592
  *             for i in range(n_overlap):
  *                 weights[i] /= weight_sum
  *                 if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                     all_weights.push_back(weights[i])
  * 
  */
-      __Pyx_TraceLine(6595,0,__PYX_ERR(0, 6595, __pyx_L1_error))
+      __Pyx_TraceLine(6592,0,__PYX_ERR(0, 6592, __pyx_L1_error))
       __pyx_t_15 = (__pyx_v_build_mat != 0);
       if (__pyx_t_15) {
       } else {
         __pyx_t_13 = __pyx_t_15;
         goto __pyx_L54_bool_binop_done;
       }
       __pyx_t_15 = (((__pyx_v_weights[__pyx_v_i]) != 0.0) != 0);
       __pyx_t_13 = __pyx_t_15;
       __pyx_L54_bool_binop_done:;
       if (__pyx_t_13) {
 
-        /* "discretize/_extensions/tree_ext.pyx":6596
+        /* "discretize/_extensions/tree_ext.pyx":6593
  *                 weights[i] /= weight_sum
  *                 if build_mat and weights[i] != 0.0:
  *                     all_weights.push_back(weights[i])             # <<<<<<<<<<<<<<
  * 
  *             if not build_mat:
  */
-        __Pyx_TraceLine(6596,0,__PYX_ERR(0, 6596, __pyx_L1_error))
+        __Pyx_TraceLine(6593,0,__PYX_ERR(0, 6593, __pyx_L1_error))
         try {
           __pyx_v_all_weights.push_back((__pyx_v_weights[__pyx_v_i]));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 6596, __pyx_L1_error)
+          __PYX_ERR(0, 6593, __pyx_L1_error)
         }
 
-        /* "discretize/_extensions/tree_ext.pyx":6595
+        /* "discretize/_extensions/tree_ext.pyx":6592
  *             for i in range(n_overlap):
  *                 weights[i] /= weight_sum
  *                 if build_mat and weights[i] != 0.0:             # <<<<<<<<<<<<<<
  *                     all_weights.push_back(weights[i])
  * 
  */
       }
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6598
+    /* "discretize/_extensions/tree_ext.pyx":6595
  *                     all_weights.push_back(weights[i])
  * 
  *             if not build_mat:             # <<<<<<<<<<<<<<
  *                 i = 0
  *                 for iz in range(iz1, iz2):
  */
-    __Pyx_TraceLine(6598,0,__PYX_ERR(0, 6598, __pyx_L1_error))
+    __Pyx_TraceLine(6595,0,__PYX_ERR(0, 6595, __pyx_L1_error))
     __pyx_t_13 = ((!(__pyx_v_build_mat != 0)) != 0);
     if (__pyx_t_13) {
 
-      /* "discretize/_extensions/tree_ext.pyx":6599
+      /* "discretize/_extensions/tree_ext.pyx":6596
  * 
  *             if not build_mat:
  *                 i = 0             # <<<<<<<<<<<<<<
  *                 for iz in range(iz1, iz2):
  *                     for iy in range(iy1, iy2):
  */
-      __Pyx_TraceLine(6599,0,__PYX_ERR(0, 6599, __pyx_L1_error))
+      __Pyx_TraceLine(6596,0,__PYX_ERR(0, 6596, __pyx_L1_error))
       __pyx_v_i = 0;
 
-      /* "discretize/_extensions/tree_ext.pyx":6600
+      /* "discretize/_extensions/tree_ext.pyx":6597
  *             if not build_mat:
  *                 i = 0
  *                 for iz in range(iz1, iz2):             # <<<<<<<<<<<<<<
  *                     for iy in range(iy1, iy2):
  *                         for ix in range(ix1, ix2):
  */
-      __Pyx_TraceLine(6600,0,__PYX_ERR(0, 6600, __pyx_L1_error))
+      __Pyx_TraceLine(6597,0,__PYX_ERR(0, 6597, __pyx_L1_error))
       __pyx_t_6 = __pyx_v_iz2;
       __pyx_t_14 = __pyx_t_6;
       for (__pyx_t_30 = __pyx_v_iz1; __pyx_t_30 < __pyx_t_14; __pyx_t_30+=1) {
         __pyx_v_iz = __pyx_t_30;
 
-        /* "discretize/_extensions/tree_ext.pyx":6601
+        /* "discretize/_extensions/tree_ext.pyx":6598
  *                 i = 0
  *                 for iz in range(iz1, iz2):
  *                     for iy in range(iy1, iy2):             # <<<<<<<<<<<<<<
  *                         for ix in range(ix1, ix2):
  *                             outs[cell.index] += vals[ix, iy, iz]*weights[i]
  */
-        __Pyx_TraceLine(6601,0,__PYX_ERR(0, 6601, __pyx_L1_error))
+        __Pyx_TraceLine(6598,0,__PYX_ERR(0, 6598, __pyx_L1_error))
         __pyx_t_32 = __pyx_v_iy2;
         __pyx_t_33 = __pyx_t_32;
         for (__pyx_t_34 = __pyx_v_iy1; __pyx_t_34 < __pyx_t_33; __pyx_t_34+=1) {
           __pyx_v_iy = __pyx_t_34;
 
-          /* "discretize/_extensions/tree_ext.pyx":6602
+          /* "discretize/_extensions/tree_ext.pyx":6599
  *                 for iz in range(iz1, iz2):
  *                     for iy in range(iy1, iy2):
  *                         for ix in range(ix1, ix2):             # <<<<<<<<<<<<<<
  *                             outs[cell.index] += vals[ix, iy, iz]*weights[i]
  *                             i += 1
  */
-          __Pyx_TraceLine(6602,0,__PYX_ERR(0, 6602, __pyx_L1_error))
+          __Pyx_TraceLine(6599,0,__PYX_ERR(0, 6599, __pyx_L1_error))
           __pyx_t_35 = __pyx_v_ix2;
           __pyx_t_36 = __pyx_t_35;
           for (__pyx_t_37 = __pyx_v_ix1; __pyx_t_37 < __pyx_t_36; __pyx_t_37+=1) {
             __pyx_v_ix = __pyx_t_37;
 
-            /* "discretize/_extensions/tree_ext.pyx":6603
+            /* "discretize/_extensions/tree_ext.pyx":6600
  *                     for iy in range(iy1, iy2):
  *                         for ix in range(ix1, ix2):
  *                             outs[cell.index] += vals[ix, iy, iz]*weights[i]             # <<<<<<<<<<<<<<
  *                             i += 1
  *             else:
  */
-            __Pyx_TraceLine(6603,0,__PYX_ERR(0, 6603, __pyx_L1_error))
+            __Pyx_TraceLine(6600,0,__PYX_ERR(0, 6600, __pyx_L1_error))
             __pyx_t_18 = __pyx_v_ix;
             __pyx_t_38 = __pyx_v_iy;
             __pyx_t_39 = __pyx_v_iz;
             if (__pyx_t_18 < 0) __pyx_t_18 += __pyx_v_vals.shape[0];
             if (__pyx_t_38 < 0) __pyx_t_38 += __pyx_v_vals.shape[1];
             if (__pyx_t_39 < 0) __pyx_t_39 += __pyx_v_vals.shape[2];
             __pyx_t_40 = __pyx_v_cell->index;
             if (__pyx_t_40 < 0) __pyx_t_40 += __pyx_v_outs.shape[0];
             *((__pyx_t_5numpy_float64_t *) ( /* dim=0 */ (__pyx_v_outs.data + __pyx_t_40 * __pyx_v_outs.strides[0]) )) += ((*((__pyx_t_5numpy_float64_t *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ ((char *) (((__pyx_t_5numpy_float64_t *) __pyx_v_vals.data) + __pyx_t_18)) ) + __pyx_t_38 * __pyx_v_vals.strides[1]) ) + __pyx_t_39 * __pyx_v_vals.strides[2]) ))) * (__pyx_v_weights[__pyx_v_i]));
 
-            /* "discretize/_extensions/tree_ext.pyx":6604
+            /* "discretize/_extensions/tree_ext.pyx":6601
  *                         for ix in range(ix1, ix2):
  *                             outs[cell.index] += vals[ix, iy, iz]*weights[i]
  *                             i += 1             # <<<<<<<<<<<<<<
  *             else:
  *                 nnz_counter += nnz_row
  */
-            __Pyx_TraceLine(6604,0,__PYX_ERR(0, 6604, __pyx_L1_error))
+            __Pyx_TraceLine(6601,0,__PYX_ERR(0, 6601, __pyx_L1_error))
             __pyx_v_i = (__pyx_v_i + 1);
           }
         }
       }
 
-      /* "discretize/_extensions/tree_ext.pyx":6598
+      /* "discretize/_extensions/tree_ext.pyx":6595
  *                     all_weights.push_back(weights[i])
  * 
  *             if not build_mat:             # <<<<<<<<<<<<<<
  *                 i = 0
  *                 for iz in range(iz1, iz2):
  */
       goto __pyx_L56;
     }
 
-    /* "discretize/_extensions/tree_ext.pyx":6606
+    /* "discretize/_extensions/tree_ext.pyx":6603
  *                             i += 1
  *             else:
  *                 nnz_counter += nnz_row             # <<<<<<<<<<<<<<
  *                 indptr[cell.index+1] = nnz_counter
  * 
  */
-    __Pyx_TraceLine(6606,0,__PYX_ERR(0, 6606, __pyx_L1_error))
+    __Pyx_TraceLine(6603,0,__PYX_ERR(0, 6603, __pyx_L1_error))
     /*else*/ {
       __pyx_v_nnz_counter = (__pyx_v_nnz_counter + __pyx_v_nnz_row);
 
-      /* "discretize/_extensions/tree_ext.pyx":6607
+      /* "discretize/_extensions/tree_ext.pyx":6604
  *             else:
  *                 nnz_counter += nnz_row
  *                 indptr[cell.index+1] = nnz_counter             # <<<<<<<<<<<<<<
  * 
  *             free(weights)
  */
-      __Pyx_TraceLine(6607,0,__PYX_ERR(0, 6607, __pyx_L1_error))
+      __Pyx_TraceLine(6604,0,__PYX_ERR(0, 6604, __pyx_L1_error))
       __pyx_t_40 = (__pyx_v_cell->index + 1);
       if (__pyx_t_40 < 0) __pyx_t_40 += __pyx_v_indptr.shape[0];
       *((__pyx_t_5numpy_int64_t *) ( /* dim=0 */ (__pyx_v_indptr.data + __pyx_t_40 * __pyx_v_indptr.strides[0]) )) = __pyx_v_nnz_counter;
     }
     __pyx_L56:;
 
-    /* "discretize/_extensions/tree_ext.pyx":6609
+    /* "discretize/_extensions/tree_ext.pyx":6606
  *                 indptr[cell.index+1] = nnz_counter
  * 
  *             free(weights)             # <<<<<<<<<<<<<<
  *             free(dx)
  *             free(dy)
  */
-    __Pyx_TraceLine(6609,0,__PYX_ERR(0, 6609, __pyx_L1_error))
+    __Pyx_TraceLine(6606,0,__PYX_ERR(0, 6606, __pyx_L1_error))
     free(__pyx_v_weights);
 
-    /* "discretize/_extensions/tree_ext.pyx":6610
+    /* "discretize/_extensions/tree_ext.pyx":6607
  * 
  *             free(weights)
  *             free(dx)             # <<<<<<<<<<<<<<
  *             free(dy)
  *             free(dz)
  */
-    __Pyx_TraceLine(6610,0,__PYX_ERR(0, 6610, __pyx_L1_error))
+    __Pyx_TraceLine(6607,0,__PYX_ERR(0, 6607, __pyx_L1_error))
     free(__pyx_v_dx);
 
-    /* "discretize/_extensions/tree_ext.pyx":6611
+    /* "discretize/_extensions/tree_ext.pyx":6608
  *             free(weights)
  *             free(dx)
  *             free(dy)             # <<<<<<<<<<<<<<
  *             free(dz)
  * 
  */
-    __Pyx_TraceLine(6611,0,__PYX_ERR(0, 6611, __pyx_L1_error))
+    __Pyx_TraceLine(6608,0,__PYX_ERR(0, 6608, __pyx_L1_error))
     free(__pyx_v_dy);
 
-    /* "discretize/_extensions/tree_ext.pyx":6612
+    /* "discretize/_extensions/tree_ext.pyx":6609
  *             free(dx)
  *             free(dy)
  *             free(dz)             # <<<<<<<<<<<<<<
  * 
  *         if not build_mat:
  */
-    __Pyx_TraceLine(6612,0,__PYX_ERR(0, 6612, __pyx_L1_error))
+    __Pyx_TraceLine(6609,0,__PYX_ERR(0, 6609, __pyx_L1_error))
     free(__pyx_v_dz);
 
-    /* "discretize/_extensions/tree_ext.pyx":6522
+    /* "discretize/_extensions/tree_ext.pyx":6519
  *         cdef double weight_sum
  * 
  *         for cell in self.tree.cells:             # <<<<<<<<<<<<<<
  *             x1m = min(cell.points[0].location[0], xF[0])
  *             y1m = min(cell.points[0].location[1], xF[1])
  */
-    __Pyx_TraceLine(6522,0,__PYX_ERR(0, 6522, __pyx_L1_error))
+    __Pyx_TraceLine(6519,0,__PYX_ERR(0, 6519, __pyx_L1_error))
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6614
+  /* "discretize/_extensions/tree_ext.pyx":6611
  *             free(dz)
  * 
  *         if not build_mat:             # <<<<<<<<<<<<<<
  *             return output
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, in_tens_mesh.n_cells))
  */
-  __Pyx_TraceLine(6614,0,__PYX_ERR(0, 6614, __pyx_L1_error))
+  __Pyx_TraceLine(6611,0,__PYX_ERR(0, 6611, __pyx_L1_error))
   __pyx_t_13 = ((!(__pyx_v_build_mat != 0)) != 0);
   if (__pyx_t_13) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6615
+    /* "discretize/_extensions/tree_ext.pyx":6612
  * 
  *         if not build_mat:
  *             return output             # <<<<<<<<<<<<<<
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, in_tens_mesh.n_cells))
  * 
  */
-    __Pyx_TraceLine(6615,0,__PYX_ERR(0, 6615, __pyx_L1_error))
+    __Pyx_TraceLine(6612,0,__PYX_ERR(0, 6612, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_v_output);
     __pyx_r = __pyx_v_output;
     goto __pyx_L0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6614
+    /* "discretize/_extensions/tree_ext.pyx":6611
  *             free(dz)
  * 
  *         if not build_mat:             # <<<<<<<<<<<<<<
  *             return output
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, in_tens_mesh.n_cells))
  */
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6616
+  /* "discretize/_extensions/tree_ext.pyx":6613
  *         if not build_mat:
  *             return output
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, in_tens_mesh.n_cells))             # <<<<<<<<<<<<<<
  * 
  *     def get_overlapping_cells(self, rectangle):
  */
-  __Pyx_TraceLine(6616,0,__PYX_ERR(0, 6616, __pyx_L1_error))
+  __Pyx_TraceLine(6613,0,__PYX_ERR(0, 6613, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_sp); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_sp); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_csr_matrix); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_12);
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_9 = __pyx_convert_vector_to_py_double(__pyx_v_all_weights); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_9 = __pyx_convert_vector_to_py_double(__pyx_v_all_weights); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_1 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_1 = __pyx_convert_vector_to_py_int_t(__pyx_v_row_inds); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_8 = __pyx_memoryview_fromslice(__pyx_v_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_8 = __pyx_memoryview_fromslice(__pyx_v_indptr, 1, (PyObject *(*)(char *)) __pyx_memview_get_nn___pyx_t_5numpy_int64_t, (int (*)(char *, PyObject *)) __pyx_memview_set_nn___pyx_t_5numpy_int64_t, 0);; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
-  __pyx_t_7 = PyTuple_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_9);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_9);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_8);
   PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_t_8);
   __pyx_t_9 = 0;
   __pyx_t_1 = 0;
   __pyx_t_8 = 0;
-  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_GIVEREF(__pyx_t_7);
   PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7);
   __pyx_t_7 = 0;
-  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_n_cells); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_tens_mesh, __pyx_n_s_n_cells); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_9);
   PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_9);
   __pyx_t_1 = 0;
   __pyx_t_9 = 0;
-  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_shape, __pyx_t_10) < 0) __PYX_ERR(0, 6616, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_shape, __pyx_t_10) < 0) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_8, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6616, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_12, __pyx_t_8, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6613, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
   __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_r = __pyx_t_10;
   __pyx_t_10 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6446
+  /* "discretize/_extensions/tree_ext.pyx":6443
  *     @cython.boundscheck(False)
  *     @cython.cdivision(True)
  *     def _vol_avg_from_tens(self, in_tens_mesh, values=None, output=None):             # <<<<<<<<<<<<<<
  *         cdef double *weights
  *         cdef double over_lap_vol
  */
 
@@ -85209,15 +85221,15 @@
   __Pyx_XDECREF(__pyx_v_output);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6618
+/* "discretize/_extensions/tree_ext.pyx":6615
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, in_tens_mesh.n_cells))
  * 
  *     def get_overlapping_cells(self, rectangle):             # <<<<<<<<<<<<<<
  *         """Find the indicis of cells that overlap the given rectangle
  * 
  */
 
@@ -85258,88 +85270,88 @@
   PyObject *__pyx_t_9 = NULL;
   PyObject *__pyx_t_10 = NULL;
   double __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_overlapping_cells", 0);
-  __Pyx_TraceCall("get_overlapping_cells", __pyx_f[0], 6618, 0, __PYX_ERR(0, 6618, __pyx_L1_error));
+  __Pyx_TraceCall("get_overlapping_cells", __pyx_f[0], 6615, 0, __PYX_ERR(0, 6615, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":6633
+  /* "discretize/_extensions/tree_ext.pyx":6630
  *         """
  *         cdef double xm, ym, zm, xp, yp, zp
  *         cdef double[:] origin = self._origin             # <<<<<<<<<<<<<<
  *         cdef double[:] xF
  *         if self.dim == 2:
  */
-  __Pyx_TraceLine(6633,0,__PYX_ERR(0, 6633, __pyx_L1_error))
-  if (unlikely(!__pyx_v_self->_origin.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6633, __pyx_L1_error)}
+  __Pyx_TraceLine(6630,0,__PYX_ERR(0, 6630, __pyx_L1_error))
+  if (unlikely(!__pyx_v_self->_origin.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6630, __pyx_L1_error)}
   __pyx_t_1 = __pyx_v_self->_origin;
   __PYX_INC_MEMVIEW(&__pyx_t_1, 1);
   __pyx_v_origin = __pyx_t_1;
   __pyx_t_1.memview = NULL;
   __pyx_t_1.data = NULL;
 
-  /* "discretize/_extensions/tree_ext.pyx":6635
+  /* "discretize/_extensions/tree_ext.pyx":6632
  *         cdef double[:] origin = self._origin
  *         cdef double[:] xF
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             xF = np.array([self._xs[-1], self._ys[-1]])
  *         else:
  */
-  __Pyx_TraceLine(6635,0,__PYX_ERR(0, 6635, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6635, __pyx_L1_error)
+  __Pyx_TraceLine(6632,0,__PYX_ERR(0, 6632, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6632, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_2, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6635, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_t_2, __pyx_int_2, 2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6632, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6635, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6632, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if (__pyx_t_4) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6636
+    /* "discretize/_extensions/tree_ext.pyx":6633
  *         cdef double[:] xF
  *         if self.dim == 2:
  *             xF = np.array([self._xs[-1], self._ys[-1]])             # <<<<<<<<<<<<<<
  *         else:
  *             xF = np.array([self._xs[-1], self._ys[-1], self._zs[-1]])
  */
-    __Pyx_TraceLine(6636,0,__PYX_ERR(0, 6636, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6636, __pyx_L1_error)
+    __Pyx_TraceLine(6633,0,__PYX_ERR(0, 6633, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6633, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6636, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6633, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6636, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6633, __pyx_L1_error)}
     __pyx_t_6 = -1L;
     __pyx_t_7 = -1;
     if (__pyx_t_6 < 0) {
       __pyx_t_6 += __pyx_v_self->_xs.shape[0];
       if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
     } else if (unlikely(__pyx_t_6 >= __pyx_v_self->_xs.shape[0])) __pyx_t_7 = 0;
     if (unlikely(__pyx_t_7 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      __PYX_ERR(0, 6636, __pyx_L1_error)
+      __PYX_ERR(0, 6633, __pyx_L1_error)
     }
-    __pyx_t_2 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_6 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6636, __pyx_L1_error)
+    __pyx_t_2 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_6 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6633, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6636, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6633, __pyx_L1_error)}
     __pyx_t_6 = -1L;
     __pyx_t_7 = -1;
     if (__pyx_t_6 < 0) {
       __pyx_t_6 += __pyx_v_self->_ys.shape[0];
       if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
     } else if (unlikely(__pyx_t_6 >= __pyx_v_self->_ys.shape[0])) __pyx_t_7 = 0;
     if (unlikely(__pyx_t_7 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      __PYX_ERR(0, 6636, __pyx_L1_error)
+      __PYX_ERR(0, 6633, __pyx_L1_error)
     }
-    __pyx_t_8 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_6 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6636, __pyx_L1_error)
+    __pyx_t_8 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_6 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6633, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6636, __pyx_L1_error)
+    __pyx_t_9 = PyList_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6633, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_GIVEREF(__pyx_t_2);
     PyList_SET_ITEM(__pyx_t_9, 0, __pyx_t_2);
     __Pyx_GIVEREF(__pyx_t_8);
     PyList_SET_ITEM(__pyx_t_9, 1, __pyx_t_8);
     __pyx_t_2 = 0;
     __pyx_t_8 = 0;
@@ -85352,87 +85364,87 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_5, function);
       }
     }
     __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_8, __pyx_t_9) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_t_9);
     __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6636, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6633, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 6636, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 6633, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_xF = __pyx_t_1;
     __pyx_t_1.memview = NULL;
     __pyx_t_1.data = NULL;
 
-    /* "discretize/_extensions/tree_ext.pyx":6635
+    /* "discretize/_extensions/tree_ext.pyx":6632
  *         cdef double[:] origin = self._origin
  *         cdef double[:] xF
  *         if self.dim == 2:             # <<<<<<<<<<<<<<
  *             xF = np.array([self._xs[-1], self._ys[-1]])
  *         else:
  */
     goto __pyx_L3;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6638
+  /* "discretize/_extensions/tree_ext.pyx":6635
  *             xF = np.array([self._xs[-1], self._ys[-1]])
  *         else:
  *             xF = np.array([self._xs[-1], self._ys[-1], self._zs[-1]])             # <<<<<<<<<<<<<<
  *         xm = min(rectangle[0], xF[0])
  *         xp = max(rectangle[1], origin[0])
  */
-  __Pyx_TraceLine(6638,0,__PYX_ERR(0, 6638, __pyx_L1_error))
+  __Pyx_TraceLine(6635,0,__PYX_ERR(0, 6635, __pyx_L1_error))
   /*else*/ {
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6638, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6635, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6638, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_array); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6635, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6638, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_xs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6635, __pyx_L1_error)}
     __pyx_t_6 = -1L;
     __pyx_t_7 = -1;
     if (__pyx_t_6 < 0) {
       __pyx_t_6 += __pyx_v_self->_xs.shape[0];
       if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
     } else if (unlikely(__pyx_t_6 >= __pyx_v_self->_xs.shape[0])) __pyx_t_7 = 0;
     if (unlikely(__pyx_t_7 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      __PYX_ERR(0, 6638, __pyx_L1_error)
+      __PYX_ERR(0, 6635, __pyx_L1_error)
     }
-    __pyx_t_5 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_6 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6638, __pyx_L1_error)
+    __pyx_t_5 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_xs.data + __pyx_t_6 * __pyx_v_self->_xs.strides[0]) )))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 6635, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6638, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_ys.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6635, __pyx_L1_error)}
     __pyx_t_6 = -1L;
     __pyx_t_7 = -1;
     if (__pyx_t_6 < 0) {
       __pyx_t_6 += __pyx_v_self->_ys.shape[0];
       if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
     } else if (unlikely(__pyx_t_6 >= __pyx_v_self->_ys.shape[0])) __pyx_t_7 = 0;
     if (unlikely(__pyx_t_7 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      __PYX_ERR(0, 6638, __pyx_L1_error)
+      __PYX_ERR(0, 6635, __pyx_L1_error)
     }
-    __pyx_t_8 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_6 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6638, __pyx_L1_error)
+    __pyx_t_8 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_ys.data + __pyx_t_6 * __pyx_v_self->_ys.strides[0]) )))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 6635, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6638, __pyx_L1_error)}
+    if (unlikely(!__pyx_v_self->_zs.memview)) {PyErr_SetString(PyExc_AttributeError,"Memoryview is not initialized");__PYX_ERR(0, 6635, __pyx_L1_error)}
     __pyx_t_6 = -1L;
     __pyx_t_7 = -1;
     if (__pyx_t_6 < 0) {
       __pyx_t_6 += __pyx_v_self->_zs.shape[0];
       if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
     } else if (unlikely(__pyx_t_6 >= __pyx_v_self->_zs.shape[0])) __pyx_t_7 = 0;
     if (unlikely(__pyx_t_7 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      __PYX_ERR(0, 6638, __pyx_L1_error)
+      __PYX_ERR(0, 6635, __pyx_L1_error)
     }
-    __pyx_t_2 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_6 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6638, __pyx_L1_error)
+    __pyx_t_2 = PyFloat_FromDouble((*((double *) ( /* dim=0 */ (__pyx_v_self->_zs.data + __pyx_t_6 * __pyx_v_self->_zs.strides[0]) )))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6635, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_10 = PyList_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6638, __pyx_L1_error)
+    __pyx_t_10 = PyList_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6635, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_GIVEREF(__pyx_t_5);
     PyList_SET_ITEM(__pyx_t_10, 0, __pyx_t_5);
     __Pyx_GIVEREF(__pyx_t_8);
     PyList_SET_ITEM(__pyx_t_10, 1, __pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_2);
     PyList_SET_ITEM(__pyx_t_10, 2, __pyx_t_2);
@@ -85448,337 +85460,337 @@
         __Pyx_INCREF(function);
         __Pyx_DECREF_SET(__pyx_t_9, function);
       }
     }
     __pyx_t_3 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_9, __pyx_t_2, __pyx_t_10) : __Pyx_PyObject_CallOneArg(__pyx_t_9, __pyx_t_10);
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6638, __pyx_L1_error)
+    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6635, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 6638, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_to_MemoryviewSlice_ds_double(__pyx_t_3, PyBUF_WRITABLE); if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 6635, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_xF = __pyx_t_1;
     __pyx_t_1.memview = NULL;
     __pyx_t_1.data = NULL;
   }
   __pyx_L3:;
 
-  /* "discretize/_extensions/tree_ext.pyx":6639
+  /* "discretize/_extensions/tree_ext.pyx":6636
  *         else:
  *             xF = np.array([self._xs[-1], self._ys[-1], self._zs[-1]])
  *         xm = min(rectangle[0], xF[0])             # <<<<<<<<<<<<<<
  *         xp = max(rectangle[1], origin[0])
  *         ym = min(rectangle[2], xF[1])
  */
-  __Pyx_TraceLine(6639,0,__PYX_ERR(0, 6639, __pyx_L1_error))
+  __Pyx_TraceLine(6636,0,__PYX_ERR(0, 6636, __pyx_L1_error))
   __pyx_t_6 = 0;
   __pyx_t_7 = -1;
   if (__pyx_t_6 < 0) {
     __pyx_t_6 += __pyx_v_xF.shape[0];
     if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
   } else if (unlikely(__pyx_t_6 >= __pyx_v_xF.shape[0])) __pyx_t_7 = 0;
   if (unlikely(__pyx_t_7 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_7);
-    __PYX_ERR(0, 6639, __pyx_L1_error)
+    __PYX_ERR(0, 6636, __pyx_L1_error)
   }
   __pyx_t_11 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_6 * __pyx_v_xF.strides[0]) )));
-  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_rectangle, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6639, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_rectangle, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6636, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6639, __pyx_L1_error)
+  __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6636, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_2 = PyObject_RichCompare(__pyx_t_10, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6639, __pyx_L1_error)
+  __pyx_t_2 = PyObject_RichCompare(__pyx_t_10, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6636, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6639, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6636, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (__pyx_t_4) {
-    __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6639, __pyx_L1_error)
+    __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6636, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_9 = __pyx_t_2;
     __pyx_t_2 = 0;
   } else {
     __Pyx_INCREF(__pyx_t_3);
     __pyx_t_9 = __pyx_t_3;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6639, __pyx_L1_error)
+  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6636, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __pyx_v_xm = __pyx_t_11;
 
-  /* "discretize/_extensions/tree_ext.pyx":6640
+  /* "discretize/_extensions/tree_ext.pyx":6637
  *             xF = np.array([self._xs[-1], self._ys[-1], self._zs[-1]])
  *         xm = min(rectangle[0], xF[0])
  *         xp = max(rectangle[1], origin[0])             # <<<<<<<<<<<<<<
  *         ym = min(rectangle[2], xF[1])
  *         yp = max(rectangle[3], origin[1])
  */
-  __Pyx_TraceLine(6640,0,__PYX_ERR(0, 6640, __pyx_L1_error))
+  __Pyx_TraceLine(6637,0,__PYX_ERR(0, 6637, __pyx_L1_error))
   __pyx_t_6 = 0;
   __pyx_t_7 = -1;
   if (__pyx_t_6 < 0) {
     __pyx_t_6 += __pyx_v_origin.shape[0];
     if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
   } else if (unlikely(__pyx_t_6 >= __pyx_v_origin.shape[0])) __pyx_t_7 = 0;
   if (unlikely(__pyx_t_7 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_7);
-    __PYX_ERR(0, 6640, __pyx_L1_error)
+    __PYX_ERR(0, 6637, __pyx_L1_error)
   }
   __pyx_t_11 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_6 * __pyx_v_origin.strides[0]) )));
-  __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_rectangle, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6640, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_rectangle, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6637, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6640, __pyx_L1_error)
+  __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6637, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_10 = PyObject_RichCompare(__pyx_t_2, __pyx_t_9, Py_GT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6640, __pyx_L1_error)
+  __pyx_t_10 = PyObject_RichCompare(__pyx_t_2, __pyx_t_9, Py_GT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6637, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6640, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6637, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   if (__pyx_t_4) {
-    __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6640, __pyx_L1_error)
+    __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6637, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __pyx_t_3 = __pyx_t_10;
     __pyx_t_10 = 0;
   } else {
     __Pyx_INCREF(__pyx_t_9);
     __pyx_t_3 = __pyx_t_9;
   }
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6640, __pyx_L1_error)
+  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6637, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_xp = __pyx_t_11;
 
-  /* "discretize/_extensions/tree_ext.pyx":6641
+  /* "discretize/_extensions/tree_ext.pyx":6638
  *         xm = min(rectangle[0], xF[0])
  *         xp = max(rectangle[1], origin[0])
  *         ym = min(rectangle[2], xF[1])             # <<<<<<<<<<<<<<
  *         yp = max(rectangle[3], origin[1])
  *         if self.dim==3:
  */
-  __Pyx_TraceLine(6641,0,__PYX_ERR(0, 6641, __pyx_L1_error))
+  __Pyx_TraceLine(6638,0,__PYX_ERR(0, 6638, __pyx_L1_error))
   __pyx_t_6 = 1;
   __pyx_t_7 = -1;
   if (__pyx_t_6 < 0) {
     __pyx_t_6 += __pyx_v_xF.shape[0];
     if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
   } else if (unlikely(__pyx_t_6 >= __pyx_v_xF.shape[0])) __pyx_t_7 = 0;
   if (unlikely(__pyx_t_7 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_7);
-    __PYX_ERR(0, 6641, __pyx_L1_error)
+    __PYX_ERR(0, 6638, __pyx_L1_error)
   }
   __pyx_t_11 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_6 * __pyx_v_xF.strides[0]) )));
-  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_rectangle, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6641, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_rectangle, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6638, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6641, __pyx_L1_error)
+  __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6638, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
-  __pyx_t_2 = PyObject_RichCompare(__pyx_t_10, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6641, __pyx_L1_error)
+  __pyx_t_2 = PyObject_RichCompare(__pyx_t_10, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6638, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6641, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6638, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   if (__pyx_t_4) {
-    __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6641, __pyx_L1_error)
+    __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6638, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_t_9 = __pyx_t_2;
     __pyx_t_2 = 0;
   } else {
     __Pyx_INCREF(__pyx_t_3);
     __pyx_t_9 = __pyx_t_3;
   }
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6641, __pyx_L1_error)
+  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6638, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   __pyx_v_ym = __pyx_t_11;
 
-  /* "discretize/_extensions/tree_ext.pyx":6642
+  /* "discretize/_extensions/tree_ext.pyx":6639
  *         xp = max(rectangle[1], origin[0])
  *         ym = min(rectangle[2], xF[1])
  *         yp = max(rectangle[3], origin[1])             # <<<<<<<<<<<<<<
  *         if self.dim==3:
  *             zm = min(rectangle[4], xF[2])
  */
-  __Pyx_TraceLine(6642,0,__PYX_ERR(0, 6642, __pyx_L1_error))
+  __Pyx_TraceLine(6639,0,__PYX_ERR(0, 6639, __pyx_L1_error))
   __pyx_t_6 = 1;
   __pyx_t_7 = -1;
   if (__pyx_t_6 < 0) {
     __pyx_t_6 += __pyx_v_origin.shape[0];
     if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
   } else if (unlikely(__pyx_t_6 >= __pyx_v_origin.shape[0])) __pyx_t_7 = 0;
   if (unlikely(__pyx_t_7 != -1)) {
     __Pyx_RaiseBufferIndexError(__pyx_t_7);
-    __PYX_ERR(0, 6642, __pyx_L1_error)
+    __PYX_ERR(0, 6639, __pyx_L1_error)
   }
   __pyx_t_11 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_6 * __pyx_v_origin.strides[0]) )));
-  __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_rectangle, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6642, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_rectangle, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6639, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
-  __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6642, __pyx_L1_error)
+  __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6639, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_10 = PyObject_RichCompare(__pyx_t_2, __pyx_t_9, Py_GT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6642, __pyx_L1_error)
+  __pyx_t_10 = PyObject_RichCompare(__pyx_t_2, __pyx_t_9, Py_GT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6639, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6642, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6639, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
   if (__pyx_t_4) {
-    __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6642, __pyx_L1_error)
+    __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6639, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __pyx_t_3 = __pyx_t_10;
     __pyx_t_10 = 0;
   } else {
     __Pyx_INCREF(__pyx_t_9);
     __pyx_t_3 = __pyx_t_9;
   }
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6642, __pyx_L1_error)
+  __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6639, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_v_yp = __pyx_t_11;
 
-  /* "discretize/_extensions/tree_ext.pyx":6643
+  /* "discretize/_extensions/tree_ext.pyx":6640
  *         ym = min(rectangle[2], xF[1])
  *         yp = max(rectangle[3], origin[1])
  *         if self.dim==3:             # <<<<<<<<<<<<<<
  *             zm = min(rectangle[4], xF[2])
  *             zp = max(rectangle[5], origin[2])
  */
-  __Pyx_TraceLine(6643,0,__PYX_ERR(0, 6643, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6643, __pyx_L1_error)
+  __Pyx_TraceLine(6640,0,__PYX_ERR(0, 6640, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_dim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6640, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_9 = __Pyx_PyInt_EqObjC(__pyx_t_3, __pyx_int_3, 3, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6643, __pyx_L1_error)
+  __pyx_t_9 = __Pyx_PyInt_EqObjC(__pyx_t_3, __pyx_int_3, 3, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6640, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6643, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6640, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
   if (__pyx_t_4) {
 
-    /* "discretize/_extensions/tree_ext.pyx":6644
+    /* "discretize/_extensions/tree_ext.pyx":6641
  *         yp = max(rectangle[3], origin[1])
  *         if self.dim==3:
  *             zm = min(rectangle[4], xF[2])             # <<<<<<<<<<<<<<
  *             zp = max(rectangle[5], origin[2])
  *         else:
  */
-    __Pyx_TraceLine(6644,0,__PYX_ERR(0, 6644, __pyx_L1_error))
+    __Pyx_TraceLine(6641,0,__PYX_ERR(0, 6641, __pyx_L1_error))
     __pyx_t_6 = 2;
     __pyx_t_7 = -1;
     if (__pyx_t_6 < 0) {
       __pyx_t_6 += __pyx_v_xF.shape[0];
       if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
     } else if (unlikely(__pyx_t_6 >= __pyx_v_xF.shape[0])) __pyx_t_7 = 0;
     if (unlikely(__pyx_t_7 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      __PYX_ERR(0, 6644, __pyx_L1_error)
+      __PYX_ERR(0, 6641, __pyx_L1_error)
     }
     __pyx_t_11 = (*((double *) ( /* dim=0 */ (__pyx_v_xF.data + __pyx_t_6 * __pyx_v_xF.strides[0]) )));
-    __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_rectangle, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6644, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_rectangle, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6644, __pyx_L1_error)
+    __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6641, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_2 = PyObject_RichCompare(__pyx_t_10, __pyx_t_9, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6644, __pyx_L1_error)
+    __pyx_t_2 = PyObject_RichCompare(__pyx_t_10, __pyx_t_9, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6641, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6644, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6641, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     if (__pyx_t_4) {
-      __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6644, __pyx_L1_error)
+      __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6641, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_t_3 = __pyx_t_2;
       __pyx_t_2 = 0;
     } else {
       __Pyx_INCREF(__pyx_t_9);
       __pyx_t_3 = __pyx_t_9;
     }
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6644, __pyx_L1_error)
+    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_3); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6641, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_zm = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6645
+    /* "discretize/_extensions/tree_ext.pyx":6642
  *         if self.dim==3:
  *             zm = min(rectangle[4], xF[2])
  *             zp = max(rectangle[5], origin[2])             # <<<<<<<<<<<<<<
  *         else:
  *             zm = 0.0
  */
-    __Pyx_TraceLine(6645,0,__PYX_ERR(0, 6645, __pyx_L1_error))
+    __Pyx_TraceLine(6642,0,__PYX_ERR(0, 6642, __pyx_L1_error))
     __pyx_t_6 = 2;
     __pyx_t_7 = -1;
     if (__pyx_t_6 < 0) {
       __pyx_t_6 += __pyx_v_origin.shape[0];
       if (unlikely(__pyx_t_6 < 0)) __pyx_t_7 = 0;
     } else if (unlikely(__pyx_t_6 >= __pyx_v_origin.shape[0])) __pyx_t_7 = 0;
     if (unlikely(__pyx_t_7 != -1)) {
       __Pyx_RaiseBufferIndexError(__pyx_t_7);
-      __PYX_ERR(0, 6645, __pyx_L1_error)
+      __PYX_ERR(0, 6642, __pyx_L1_error)
     }
     __pyx_t_11 = (*((double *) ( /* dim=0 */ (__pyx_v_origin.data + __pyx_t_6 * __pyx_v_origin.strides[0]) )));
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_rectangle, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6645, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_rectangle, 5, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 6642, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6645, __pyx_L1_error)
+    __pyx_t_2 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6642, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_10 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6645, __pyx_L1_error)
+    __pyx_t_10 = PyObject_RichCompare(__pyx_t_2, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6642, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6645, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely(__pyx_t_4 < 0)) __PYX_ERR(0, 6642, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     if (__pyx_t_4) {
-      __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6645, __pyx_L1_error)
+      __pyx_t_10 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 6642, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __pyx_t_9 = __pyx_t_10;
       __pyx_t_10 = 0;
     } else {
       __Pyx_INCREF(__pyx_t_3);
       __pyx_t_9 = __pyx_t_3;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6645, __pyx_L1_error)
+    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_t_9); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 6642, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_v_zp = __pyx_t_11;
 
-    /* "discretize/_extensions/tree_ext.pyx":6643
+    /* "discretize/_extensions/tree_ext.pyx":6640
  *         ym = min(rectangle[2], xF[1])
  *         yp = max(rectangle[3], origin[1])
  *         if self.dim==3:             # <<<<<<<<<<<<<<
  *             zm = min(rectangle[4], xF[2])
  *             zp = max(rectangle[5], origin[2])
  */
     goto __pyx_L4;
   }
 
-  /* "discretize/_extensions/tree_ext.pyx":6647
+  /* "discretize/_extensions/tree_ext.pyx":6644
  *             zp = max(rectangle[5], origin[2])
  *         else:
  *             zm = 0.0             # <<<<<<<<<<<<<<
  *             zp = 0.0
  *         return self.tree.find_overlapping_cells(xm, xp, ym, yp, zm, zp)
  */
-  __Pyx_TraceLine(6647,0,__PYX_ERR(0, 6647, __pyx_L1_error))
+  __Pyx_TraceLine(6644,0,__PYX_ERR(0, 6644, __pyx_L1_error))
   /*else*/ {
     __pyx_v_zm = 0.0;
 
-    /* "discretize/_extensions/tree_ext.pyx":6648
+    /* "discretize/_extensions/tree_ext.pyx":6645
  *         else:
  *             zm = 0.0
  *             zp = 0.0             # <<<<<<<<<<<<<<
  *         return self.tree.find_overlapping_cells(xm, xp, ym, yp, zm, zp)
  * 
  */
-    __Pyx_TraceLine(6648,0,__PYX_ERR(0, 6648, __pyx_L1_error))
+    __Pyx_TraceLine(6645,0,__PYX_ERR(0, 6645, __pyx_L1_error))
     __pyx_v_zp = 0.0;
   }
   __pyx_L4:;
 
-  /* "discretize/_extensions/tree_ext.pyx":6649
+  /* "discretize/_extensions/tree_ext.pyx":6646
  *             zm = 0.0
  *             zp = 0.0
  *         return self.tree.find_overlapping_cells(xm, xp, ym, yp, zm, zp)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(6649,0,__PYX_ERR(0, 6649, __pyx_L1_error))
+  __Pyx_TraceLine(6646,0,__PYX_ERR(0, 6646, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_9 = __pyx_convert_vector_to_py_int_t(__pyx_v_self->tree->find_overlapping_cells(__pyx_v_xm, __pyx_v_xp, __pyx_v_ym, __pyx_v_yp, __pyx_v_zm, __pyx_v_zp)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6649, __pyx_L1_error)
+  __pyx_t_9 = __pyx_convert_vector_to_py_int_t(__pyx_v_self->tree->find_overlapping_cells(__pyx_v_xm, __pyx_v_xp, __pyx_v_ym, __pyx_v_yp, __pyx_v_zm, __pyx_v_zp)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 6646, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_9);
   __pyx_r = __pyx_t_9;
   __pyx_t_9 = 0;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6618
+  /* "discretize/_extensions/tree_ext.pyx":6615
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(self.n_cells, in_tens_mesh.n_cells))
  * 
  *     def get_overlapping_cells(self, rectangle):             # <<<<<<<<<<<<<<
  *         """Find the indicis of cells that overlap the given rectangle
  * 
  */
 
@@ -85921,15 +85933,15 @@
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "discretize/_extensions/tree_ext.pyx":6652
+/* "discretize/_extensions/tree_ext.pyx":6649
  * 
  * 
  * cdef inline double _clip01(double x) nogil:             # <<<<<<<<<<<<<<
  *     return min(1, max(x, 0))
  */
 
 static CYTHON_INLINE double __pyx_f_10discretize_11_extensions_8tree_ext__clip01(double __pyx_v_x) {
@@ -85937,22 +85949,22 @@
   __Pyx_TraceDeclarations
   long __pyx_t_1;
   double __pyx_t_2;
   double __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceCall("_clip01", __pyx_f[0], 6652, 1, __PYX_ERR(0, 6652, __pyx_L1_error));
+  __Pyx_TraceCall("_clip01", __pyx_f[0], 6649, 1, __PYX_ERR(0, 6649, __pyx_L1_error));
 
-  /* "discretize/_extensions/tree_ext.pyx":6653
+  /* "discretize/_extensions/tree_ext.pyx":6650
  * 
  * cdef inline double _clip01(double x) nogil:
  *     return min(1, max(x, 0))             # <<<<<<<<<<<<<<
  */
-  __Pyx_TraceLine(6653,1,__PYX_ERR(0, 6653, __pyx_L1_error))
+  __Pyx_TraceLine(6650,1,__PYX_ERR(0, 6650, __pyx_L1_error))
   __pyx_t_1 = 0;
   __pyx_t_2 = __pyx_v_x;
   if (((__pyx_t_1 > __pyx_t_2) != 0)) {
     __pyx_t_3 = __pyx_t_1;
   } else {
     __pyx_t_3 = __pyx_t_2;
   }
@@ -85962,15 +85974,15 @@
     __pyx_t_3 = __pyx_t_2;
   } else {
     __pyx_t_3 = __pyx_t_1;
   }
   __pyx_r = __pyx_t_3;
   goto __pyx_L0;
 
-  /* "discretize/_extensions/tree_ext.pyx":6652
+  /* "discretize/_extensions/tree_ext.pyx":6649
  * 
  * 
  * cdef inline double _clip01(double x) nogil:             # <<<<<<<<<<<<<<
  *     return min(1, max(x, 0))
  */
 
   /* function exit code */
@@ -101521,15 +101533,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_10discretize_11_extensions_8tree_ext__TreeMesh(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_obj_10discretize_11_extensions_8tree_ext__TreeMesh *p;
   PyObject *o;
@@ -102253,16 +102265,16 @@
   return __pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_edge_to_cell_1__get__(o);
 }
 
 static PyObject *__pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_to_cell_vector(PyObject *o, CYTHON_UNUSED void *x) {
   return __pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_edge_to_cell_vector_1__get__(o);
 }
 
-static PyObject *__pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_to_face_vector(PyObject *o, CYTHON_UNUSED void *x) {
-  return __pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_27average_edge_to_face_vector_1__get__(o);
+static PyObject *__pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_to_face(PyObject *o, CYTHON_UNUSED void *x) {
+  return __pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_20average_edge_to_face_1__get__(o);
 }
 
 static PyObject *__pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_face_x_to_cell(PyObject *o, CYTHON_UNUSED void *x) {
   return __pyx_pw_10discretize_11_extensions_8tree_ext_9_TreeMesh_22average_face_x_to_cell_1__get__(o);
 }
 
 static PyObject *__pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_face_y_to_cell(PyObject *o, CYTHON_UNUSED void *x) {
@@ -102485,15 +102497,15 @@
   {(char *)"stencil_cell_gradient_y", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_stencil_cell_gradient_y, 0, (char *)"Differencing operator along y-direction to total (including hanging) y faces.\n\n        This property constructs a differencing operator along the y-axis\n        that acts on cell centered quantities; i.e. the stencil for the\n        y-component of the cell gradient. The operator computes the\n        differences between the values at adjacent cell centers along the\n        y-direction, and places the result on the y-faces. The operator is a sparse\n        matrix :math:`\\mathbf{G_y}` that can be applied as a matrix-vector\n        product to a cell centered quantity :math:`\\boldsymbol{\\phi}`, i.e.::\n\n            diff_phi_y = Gy @ phi\n\n        By default, the operator assumes zero-Neumann boundary conditions\n        on the scalar quantity.\n\n        Returns\n        -------\n        (n_total_faces_y, n_cells) scipy.sparse.csr_matrix\n            The stencil for the y-component of the cell gradient\n        ", 0},
   {(char *)"stencil_cell_gradient_z", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_stencil_cell_gradient_z, 0, (char *)"Differencing operator along z-direction to total (including hanging) z faces.\n\n        This property constructs a differencing operator along the z-axis\n        that acts on cell centered quantities; i.e. the stencil for the\n        z-component of the cell gradient. The operator computes the\n        differences between the values at adjacent cell centers along the\n        z-direction, and places the result on the z-faces. The operator is a sparse\n        matrix :math:`\\mathbf{G_z}` that can be applied as a matrix-vector\n        product to a cell centered quantity :math:`\\boldsymbol{\\phi}`, i.e.::\n\n            diff_phi_z = Gz @ phi\n\n        By default, the operator assumes zero-Neumann boundary conditions\n        on the scalar quantity.\n\n        Returns\n        -------\n        (n_total_faces_z, n_cells) scipy.sparse.csr_matrix\n            The stencil for the z-component of the cell gradient\n        ", 0},
   {(char *)"average_edge_x_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_x_to_cell, 0, (char *)"Averaging operator from x-edges to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from x-edges to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on x-edges must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh. *See notes*.\n\n        Returns\n        -------\n        (n_cells, n_edges_x) scipy.sparse.csr_matrix\n            The scalar averaging operator from x-edges to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_x}` be a discrete scalar quantity that\n        lives on x-edges. **average_edge_x_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{xc}}` that projects\n        :math:`\\boldsymbol{\\phi_x}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{xc}} \\, \\boldsymbol{\\phi_x}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its x-edges. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Axc @ phi_x\n        ", 0},
   {(char *)"average_edge_y_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_y_to_cell, 0, (char *)"Averaging operator from y-edges to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from y-edges to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on y-edges must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh. *See notes*.\n\n        Returns\n        -------\n        (n_cells, n_edges_y) scipy.sparse.csr_matrix\n            The scalar averaging operator from y-edges to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_y}` be a discrete scalar quantity that\n        lives on y-edges. **average_edge_y_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{yc}}` that projects\n        :math:`\\boldsymbol{\\phi_y}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{yc}} \\, \\boldsymbol{\\phi_y}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its y-edges. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Ayc @ phi_y\n        ", 0},
   {(char *)"average_edge_z_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_z_to_cell, 0, (char *)"Averaging operator from z-edges to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from z-edges to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on z-edges must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh. *See notes*.\n\n        Returns\n        -------\n        (n_cells, n_edges_z) scipy.sparse.csr_matrix\n            The scalar averaging operator from z-edges to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_z}` be a discrete scalar quantity that\n        lives on z-edges. **average_edge_z_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{zc}}` that projects\n        :math:`\\boldsymbol{\\phi_z}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{zc}} \\, \\boldsymbol{\\phi_z}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its z-edges. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Azc @ phi_z\n        ", 0},
   {(char *)"average_edge_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_to_cell, 0, (char *)"Averaging operator from edges to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from edges to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on mesh edges must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh. *See notes*.\n\n        Returns\n        -------\n        (n_cells, n_edges) scipy.sparse.csr_matrix\n            The scalar averaging operator from edges to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_e}` be a discrete scalar quantity that\n        lives on mesh edges. **average_edge_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{ec}}` that projects\n        :math:`\\boldsymbol{\\phi_e}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{ec}} \\, \\boldsymbol{\\phi_e}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its edges. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Aec @ phi_e\n        ", 0},
   {(char *)"average_edge_to_cell_vector", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_to_cell_vector, 0, (char *)"Averaging operator from edges to cell centers (vector quantities).\n\n        This property constructs the averaging operator that independently maps the\n        Cartesian components of vector quantities from edges to cell centers.\n        This averaging operators is used when a discrete vector quantity defined on mesh edges\n        must be approximated at cell centers. Once constructed, the operator is\n        stored permanently as a property of the mesh.\n\n        Be aware that the Cartesian components of the original vector\n        are defined on their respective edges; e.g. the x-component lives\n        on x-edges. However, the x, y and z components are being averaged\n        separately to cell centers. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            u_c = Aec @ u_e\n\n        Returns\n        -------\n        (dim * n_cells, n_edges) scipy.sparse.csr_matrix\n            The vector averaging operator from edges to cell centers. Since we\n            are averaging a vector quantity to cell centers, the first dimension\n            of the operator is the mesh dimension times the number of cells.\n\n        Notes\n        -----\n        Let :math:`\\mathbf{u_e}` be the discrete representation of a vector\n        quantity whose Cartesian components are defined on their respective edges;\n        e.g. :math:`u_x` is defined on x-edges.\n        **average_edge_to_cell_vector** constructs a discrete linear operator\n        :math:`\\mathbf{A_{ec}}` that projects each Cartesian component of\n        :math:`\\mathbf{u_e}` independently to cell centers, i.e.:\n\n        .. math::\n            \\mathbf{u_c} = \\mathbf{A_{ec}} \\, \\mathbf{u_e}\n\n        where :math:`\\mathbf{u_c}` is a discrete vector quantity whose Cartesian\n        components defined at the cell centers and organized into a 1D array of\n        the form np.r_[ux, uy, uz]. For each cell, and for each Cartesian component,\n        we are simply taking the ""average of the values\n        defined on the cell's corresponding edges and placing the result at\n        the cell's center.\n        ", 0},
-  {(char *)"average_edge_to_face_vector", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_to_face_vector, 0, (char *)"Averaging operator from edges to faces (vector quantities).\n\n        This property constructs the averaging operator that independently maps the\n        Cartesian components of vector quantities from edges to faces.\n        This averaging operators is used when a discrete vector quantity defined on mesh edges\n        must be approximated at faces. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            u_f = Aef @ u_e\n\n        Once constructed, the operator is stored permanently as a property of the mesh.\n\n        Returns\n        -------\n        (n_faces, n_edges) scipy.sparse.csr_matrix\n            The vector averaging operator from edges to faces.\n\n        Notes\n        -----\n        Let :math:`\\mathbf{u_e}` be the discrete representation of a vector\n        quantity whose Cartesian components are defined on their respective edges;\n        e.g. the x-component is defined on x-edges. **average_edge_to_face_vector**\n        constructs a discrete linear operator :math:`\\mathbf{A_{ef}}` that\n        projects each Cartesian component of :math:`\\mathbf{u_e}` to\n        its corresponding face, i.e.:\n\n        .. math::\n            \\mathbf{u_f} = \\mathbf{A_{ef}} \\, \\mathbf{u_e}\n\n        where :math:`\\mathbf{u_f}` is a discrete vector quantity whose Cartesian\n        components are defined on their respective faces; e.g. the x-component is\n        defined on x-faces.\n        ", 0},
+  {(char *)"average_edge_to_face", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_edge_to_face, 0, (char *)"Averaging operator from edges to faces.\n\n        This property constructs the averaging operator that maps uantities from edges to faces.\n        This averaging operators is used when a discrete quantity defined on mesh edges\n        must be approximated at faces. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            u_f = Aef @ u_e\n\n        Once constructed, the operator is stored permanently as a property of the mesh.\n\n        Returns\n        -------\n        (n_faces, n_edges) scipy.sparse.csr_matrix\n            The averaging operator from edges to faces.\n\n        Notes\n        -----\n        Let :math:`\\mathbf{u_e}` be the discrete representation of aquantity whose\n        that is defined on the edges. **average_edge_to_face**\n        constructs a discrete linear operator :math:`\\mathbf{A_{ef}}` that\n        projects :math:`\\mathbf{u_e}` to its corresponding face, i.e.:\n\n        .. math::\n            \\mathbf{u_f} = \\mathbf{A_{ef}} \\, \\mathbf{u_e}\n\n        where :math:`\\mathbf{u_f}` is a quantity defined on the respective faces.\n        ", 0},
   {(char *)"average_face_x_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_face_x_to_cell, 0, (char *)"Averaging operator from x-faces to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from x-faces to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on x-faces must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh.\n\n        Returns\n        -------\n        (n_cells, n_faces_x) scipy.sparse.csr_matrix\n            The scalar averaging operator from x-faces to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_x}` be a discrete scalar quantity that\n        lives on x-faces. **average_face_x_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{xc}}` that projects\n        :math:`\\boldsymbol{\\phi_x}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{xc}} \\, \\boldsymbol{\\phi_x}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its x-faces. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Axc @ phi_x\n        ", 0},
   {(char *)"average_face_y_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_face_y_to_cell, 0, (char *)"Averaging operator from y-faces to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from y-faces to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on x-faces must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh. *See notes*.\n\n        Returns\n        -------\n        (n_cells, n_faces_y) scipy.sparse.csr_matrix\n            The scalar averaging operator from y-faces to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_y}` be a discrete scalar quantity that\n        lives on y-faces. **average_face_y_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{yc}}` that projects\n        :math:`\\boldsymbol{\\phi_y}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{yc}} \\, \\boldsymbol{\\phi_y}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its y-faces. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Ayc @ phi_y\n        ", 0},
   {(char *)"average_face_z_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_face_z_to_cell, 0, (char *)"Averaging operator from z-faces to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from z-faces to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on z-faces must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh. *See notes*.\n\n        Returns\n        -------\n        (n_cells, n_faces_z) scipy.sparse.csr_matrix\n            The scalar averaging operator from z-faces to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_z}` be a discrete scalar quantity that\n        lives on z-faces. **average_face_z_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{zc}}` that projects\n        :math:`\\boldsymbol{\\phi_z}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{zc}} \\, \\boldsymbol{\\phi_z}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its z-faces. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Azc @ phi_z\n        ", 0},
   {(char *)"average_face_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_face_to_cell, 0, (char *)"Averaging operator from faces to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from faces to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on mesh faces must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh. *See notes*.\n\n        Returns\n        -------\n        (n_cells, n_faces) scipy.sparse.csr_matrix\n            The scalar averaging operator from faces to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_f}` be a discrete scalar quantity that\n        lives on mesh faces. **average_face_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{fc}}` that projects\n        :math:`\\boldsymbol{\\phi_f}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{fc}} \\, \\boldsymbol{\\phi_f}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its faces. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Afc @ phi_f\n        ", 0},
   {(char *)"average_face_to_cell_vector", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_face_to_cell_vector, 0, (char *)"Averaging operator from faces to cell centers (vector quantities).\n\n        This property constructs the averaging operator that independently maps the\n        Cartesian components of vector quantities from faces to cell centers.\n        This averaging operators is used when a discrete vector quantity defined on mesh faces\n        must be approximated at cell centers. Once constructed, the operator is\n        stored permanently as a property of the mesh.\n\n        Be aware that the Cartesian components of the original vector\n        are defined on their respective faces; e.g. the x-component lives\n        on x-faces. However, the x, y and z components are being averaged\n        separately to cell centers. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            u_c = Afc @ u_f\n\n        Returns\n        -------\n        (dim * n_cells, n_faces) scipy.sparse.csr_matrix\n            The vector averaging operator from faces to cell centers. Since we\n            are averaging a vector quantity to cell centers, the first dimension\n            of the operator is the mesh dimension times the number of cells.\n\n        Notes\n        -----\n        Let :math:`\\mathbf{u_f}` be the discrete representation of a vector\n        quantity whose Cartesian components are defined on their respective faces;\n        e.g. :math:`u_x` is defined on x-faces.\n        **average_face_to_cell_vector** constructs a discrete linear operator\n        :math:`\\mathbf{A_{fc}}` that projects each Cartesian component of\n        :math:`\\mathbf{u_f}` independently to cell centers, i.e.:\n\n        .. math::\n            \\mathbf{u_c} = \\mathbf{A_{fc}} \\, \\mathbf{u_f}\n\n        where :math:`\\mathbf{u_c}` is a discrete vector quantity whose Cartesian\n        components defined at the cell centers and organized into a 1D array of\n        the form np.r_[ux, uy, uz]. For each cell, and for each Cartesian component,\n        we are simply taking the ""average of the values\n        defined on the cell's corresponding faces and placing the result at\n        the cell's center.\n        ", 0},
   {(char *)"average_node_to_cell", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_node_to_cell, 0, (char *)"Averaging operator from nodes to cell centers (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from nodes to cell centers. This averaging operator is\n        used when a discrete scalar quantity defined on mesh nodes must be\n        projected to cell centers. Once constructed, the operator is stored\n        permanently as a property of the mesh. *See notes*.\n\n        Returns\n        -------\n        (n_cells, n_nodes) scipy.sparse.csr_matrix\n            The scalar averaging operator from nodes to cell centers\n\n        Notes\n        -----\n        Let :math:`\\boldsymbol{\\phi_n}` be a discrete scalar quantity that\n        lives on mesh nodes. **average_node_to_cell** constructs a discrete\n        linear operator :math:`\\mathbf{A_{nc}}` that projects\n        :math:`\\boldsymbol{\\phi_f}` to cell centers, i.e.:\n\n        .. math::\n            \\boldsymbol{\\phi_c} = \\mathbf{A_{nc}} \\, \\boldsymbol{\\phi_n}\n\n        where :math:`\\boldsymbol{\\phi_c}` approximates the value of the scalar\n        quantity at cell centers. For each cell, we are simply averaging\n        the values defined on its nodes. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            phi_c = Anc @ phi_n\n        ", 0},
   {(char *)"average_node_to_edge_x", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_node_to_edge_x, 0, (char *)"Averaging operator from nodes to x edges (scalar quantities).\n\n        This property constructs a 2nd order averaging operator that maps scalar\n        quantities from nodes to edges. This averaging operator is\n        used when a discrete scalar quantity defined on mesh nodes must be\n        projected to edges.\n\n        Returns\n        -------\n        (n_edges_x, n_nodes) scipy.sparse.csr_matrix\n            The scalar averaging operator from nodes to edges\n        ", 0},
@@ -102508,15 +102520,15 @@
   {(char *)"average_cell_vector_to_face", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_cell_vector_to_face, 0, (char *)"Averaging operator from cell centers to faces (vector quantities).\n\n        This property constructs the averaging operator that independently maps the\n        Cartesian components of vector quantities from cell centers to faces.\n        This averaging operators is used when a discrete vector quantity defined at\n        cell centers must be approximated on the faces. Once constructed, the operator is\n        stored permanently as a property of the mesh.\n\n        Be aware that the Cartesian components of the original vector\n        are defined seperately at cell centers in a 1D numpy.array organized [ux, uy, uz].\n        Once projected to faces, the Cartesian components are defined on their respective\n        faces; e.g. the x-component lives on x-faces. The operation is implemented as a\n        matrix vector product, i.e.::\n\n            u_f = Acf @ u_c\n\n        Returns\n        -------\n        (n_faces, dim * n_cells) scipy.sparse.csr_matrix\n            The vector averaging operator from cell centers to faces. Since we\n            are averaging a vector quantity from cell centers, the second dimension\n            of the operator is the mesh dimension times the number of cells.\n\n        Notes\n        -----\n        Let :math:`\\mathbf{u_c}` be the discrete representation of a vector\n        quantity whose Cartesian components are defined separately at cell centers.\n        **average_cell_vector_to_face** constructs a discrete linear operator\n        :math:`\\mathbf{A_{cf}}` that projects each Cartesian component of\n        :math:`\\mathbf{u_c}` to the faces, i.e.:\n\n        .. math::\n            \\mathbf{u_f} = \\mathbf{A_{cf}} \\, \\mathbf{u_c}\n\n        where :math:`\\mathbf{u_f}` is the discrete vector quantity whose Cartesian\n        components are approximated on their respective cell faces; e.g. the x-component is\n        approximated on x-faces. For each face (x, y or z), we are simply taking a weighted average\n        between ""the values of the correct Cartesian component at the corresponding cell centers.\n\n        E.g. for the x-component, which is projected to x-faces, the weighted average on\n        a 2D mesh would be:\n\n        .. math::\n            u_x(i \\! + \\! 1/2, j) = \\frac{h_{i+1} u_x (i,j) + h_i u_x(i \\! + \\! 1,j)}{hx_i + hx_{i+1}}\n\n        where :math:`h_i` and :math:`h_{i+1}` represent the cell respective cell widths\n        in the x-direction. For boundary faces, nearest neighbor is used to extrapolate\n        the values.\n        ", 0},
   {(char *)"average_cell_to_face_x", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_cell_to_face_x, 0, (char *)"Averaging operator from cell centers to x faces (scalar quantities).\n\n        This property constructs an averaging operator that maps scalar\n        quantities from cell centers to face. This averaging operator is\n        used when a discrete scalar quantity defined cell centers must be\n        projected to faces.\n\n        Returns\n        -------\n        (n_faces_x, n_cells) scipy.sparse.csr_matrix\n            The scalar averaging operator from cell centers to x faces\n        ", 0},
   {(char *)"average_cell_to_face_y", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_cell_to_face_y, 0, (char *)"Averaging operator from cell centers to y faces (scalar quantities).\n\n        This property constructs an averaging operator that maps scalar\n        quantities from cell centers to face. This averaging operator is\n        used when a discrete scalar quantity defined cell centers must be\n        projected to faces.\n\n        Returns\n        -------\n        (n_faces_y, n_cells) scipy.sparse.csr_matrix\n            The scalar averaging operator from cell centers to y faces\n        ", 0},
   {(char *)"average_cell_to_face_z", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_average_cell_to_face_z, 0, (char *)"Averaging operator from cell centers to z faces (scalar quantities).\n\n        This property constructs an averaging operator that maps scalar\n        quantities from cell centers to face. This averaging operator is\n        used when a discrete scalar quantity defined cell centers must be\n        projected to faces.\n\n        Returns\n        -------\n        (n_faces_z, n_cells) scipy.sparse.csr_matrix\n            The scalar averaging operator from cell centers to z faces\n        ", 0},
   {(char *)"project_face_to_boundary_face", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_project_face_to_boundary_face, 0, (char *)"Projection matrix from all faces to boundary faces.\n\n        Constructs and returns a matrix :math:`\\mathbf{P}` that projects from\n        all mesh faces to boundary faces. That is, for a discrete vector\n        :math:`\\mathbf{u}` that lives on the faces, the values on the boundary\n        faces :math:`\\mathbf{u_b}` can be extracted via the following\n        matrix-vector product::\n\n            ub = P @ u\n\n        Returns\n        -------\n        scipy.sparse.csr_matrix\n            (n_boundary_faces, n_faces) Projection matrix with shape\n        ", 0},
   {(char *)"project_edge_to_boundary_edge", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_project_edge_to_boundary_edge, 0, (char *)"Projection matrix from all edges to boundary edges.\n\n        Constructs and returns a matrix :math:`\\mathbf{P}` that projects from\n        all mesh edges to boundary edges. That is, for a discrete vector\n        :math:`\\mathbf{u}` that lives on the edges, the values on the boundary\n        edges :math:`\\mathbf{u_b}` can be extracted via the following\n        matrix-vector product::\n\n            ub = P @ u\n\n        Returns\n        -------\n        (n_boundary_edges, n_edges) scipy.sparse.csr_matrix\n            Projection matrix with shape\n        ", 0},
   {(char *)"project_node_to_boundary_node", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_project_node_to_boundary_node, 0, (char *)"Projection matrix from all nodes to boundary nodes.\n\n        Constructs and returns a matrix :math:`\\mathbf{P}` that projects from\n        all mesh nodes to boundary nodes. That is, for a discrete scalar\n        :math:`\\mathbf{u}` that lives on the nodes, the values on the boundary\n        nodes :math:`\\mathbf{u_b}` can be extracted via the following\n        matrix-vector product::\n\n            ub = P @ u\n\n        Returns\n        -------\n        (n_boundary_nodes, n_nodes) scipy.sparse.csr_matrix\n            Projection matrix with shape\n        ", 0},
-  {(char *)"cell_nodes", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_cell_nodes, 0, (char *)"The index of nodes for each cell.\n\n        Returns\n        -------\n        numpy.ndarray of int\n            Index array of shape (n_cells, 4) if 2D, or (n_cells, 8) if 3D\n\n        Notes\n        -----\n        These indices will also point to hanging nodes.\n        ", 0},
+  {(char *)"cell_nodes", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_cell_nodes, 0, (char *)"The index of all nodes for each cell.\n\n        These indices point to non-hanging and hanging nodes.\n\n        Returns\n        -------\n        numpy.ndarray of int\n            Index array of shape (n_cells, 4) if 2D, or (n_cells, 8) if 3D\n\n        See also\n        --------\n        TreeMesh.total_nodes\n        ", 0},
   {(char *)"edge_nodes", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh_edge_nodes, 0, (char *)"The index of nodes for every edge.\n\n        The index of the nodes at each end of every (including hanging) edge.\n\n        Returns\n        -------\n        (dim) tuple of numpy.ndarray of int\n            One numpy array for each edge type (x, y, (z)) for this mesh.\n\n        Notes\n        -----\n        These arrays will also index into the hanging nodes.\n        ", 0},
   {(char *)"_ubc_indArr", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh__ubc_indArr, 0, (char *)0, 0},
   {(char *)"_ubc_order", __pyx_getprop_10discretize_11_extensions_8tree_ext_9_TreeMesh__ubc_order, 0, (char *)0, 0},
   {0, 0, 0, 0, 0}
 };
 
 static PySequenceMethods __pyx_tp_as_sequence__TreeMesh = {
@@ -102601,15 +102613,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine *__pyx_freelist_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine[8];
 static int __pyx_freecount_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine = 0;
 
@@ -102719,15 +102731,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx *__pyx_freelist_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx[8];
 static int __pyx_freecount_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx = 0;
 
@@ -102837,15 +102849,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx *__pyx_freelist_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx[8];
 static int __pyx_freecount_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx = 0;
 
@@ -102955,15 +102967,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx *__pyx_freelist_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx[8];
 static int __pyx_freecount_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx = 0;
 
@@ -103073,15 +103085,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static struct __pyx_obj_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx *__pyx_freelist_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx[8];
 static int __pyx_freecount_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx = 0;
 
@@ -103191,15 +103203,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_array __pyx_vtable_array;
 
 static PyObject *__pyx_tp_new_array(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_array_obj *p;
@@ -103383,15 +103395,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyObject *__pyx_tp_new_Enum(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_MemviewEnum_obj *p;
   PyObject *o;
@@ -103505,15 +103517,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct_memoryview __pyx_vtable_memoryview;
 
 static PyObject *__pyx_tp_new_memoryview(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryview_obj *p;
@@ -103769,15 +103781,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 static struct __pyx_vtabstruct__memoryviewslice __pyx_vtable__memoryviewslice;
 
 static PyObject *__pyx_tp_new__memoryviewslice(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_memoryviewslice_obj *p;
@@ -103918,15 +103930,15 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
-  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
   0, /*tp_pypy_flags*/
   #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
@@ -104050,15 +104062,15 @@
   {&__pyx_n_s_asarray, __pyx_k_asarray, sizeof(__pyx_k_asarray), 0, 0, 1, 1},
   {&__pyx_n_s_atleast_1d, __pyx_k_atleast_1d, sizeof(__pyx_k_atleast_1d), 0, 0, 1, 1},
   {&__pyx_n_s_atleast_2d, __pyx_k_atleast_2d, sizeof(__pyx_k_atleast_2d), 0, 0, 1, 1},
   {&__pyx_n_s_aveFy2CC, __pyx_k_aveFy2CC, sizeof(__pyx_k_aveFy2CC), 0, 0, 1, 1},
   {&__pyx_n_s_average_cell_to_face_x, __pyx_k_average_cell_to_face_x, sizeof(__pyx_k_average_cell_to_face_x), 0, 0, 1, 1},
   {&__pyx_n_s_average_cell_to_face_y, __pyx_k_average_cell_to_face_y, sizeof(__pyx_k_average_cell_to_face_y), 0, 0, 1, 1},
   {&__pyx_n_s_average_cell_to_face_z, __pyx_k_average_cell_to_face_z, sizeof(__pyx_k_average_cell_to_face_z), 0, 0, 1, 1},
-  {&__pyx_n_s_average_edge_to_face_vector, __pyx_k_average_edge_to_face_vector, sizeof(__pyx_k_average_edge_to_face_vector), 0, 0, 1, 1},
+  {&__pyx_n_s_average_edge_to_face, __pyx_k_average_edge_to_face, sizeof(__pyx_k_average_edge_to_face), 0, 0, 1, 1},
   {&__pyx_n_s_average_edge_x_to_cell, __pyx_k_average_edge_x_to_cell, sizeof(__pyx_k_average_edge_x_to_cell), 0, 0, 1, 1},
   {&__pyx_n_s_average_edge_y_to_cell, __pyx_k_average_edge_y_to_cell, sizeof(__pyx_k_average_edge_y_to_cell), 0, 0, 1, 1},
   {&__pyx_n_s_average_edge_z_to_cell, __pyx_k_average_edge_z_to_cell, sizeof(__pyx_k_average_edge_z_to_cell), 0, 0, 1, 1},
   {&__pyx_n_s_average_face_x_to_cell, __pyx_k_average_face_x_to_cell, sizeof(__pyx_k_average_face_x_to_cell), 0, 0, 1, 1},
   {&__pyx_n_s_average_face_z_to_cell, __pyx_k_average_face_z_to_cell, sizeof(__pyx_k_average_face_z_to_cell), 0, 0, 1, 1},
   {&__pyx_n_s_average_node_to_edge_x, __pyx_k_average_node_to_edge_x, sizeof(__pyx_k_average_node_to_edge_x), 0, 0, 1, 1},
   {&__pyx_n_s_average_node_to_edge_y, __pyx_k_average_node_to_edge_y, sizeof(__pyx_k_average_node_to_edge_y), 0, 0, 1, 1},
@@ -104307,25 +104319,25 @@
   {&__pyx_n_u_yd, __pyx_k_yd, sizeof(__pyx_k_yd), 0, 1, 0, 1},
   {&__pyx_n_u_yu, __pyx_k_yu, sizeof(__pyx_k_yu), 0, 1, 0, 1},
   {&__pyx_n_u_z, __pyx_k_z, sizeof(__pyx_k_z), 0, 1, 0, 1},
   {&__pyx_n_s_zEdge, __pyx_k_zEdge, sizeof(__pyx_k_zEdge), 0, 0, 1, 1},
   {&__pyx_n_s_zFace, __pyx_k_zFace, sizeof(__pyx_k_zFace), 0, 0, 1, 1},
   {&__pyx_n_u_zd, __pyx_k_zd, sizeof(__pyx_k_zd), 0, 1, 0, 1},
   {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
-  {&__pyx_n_s_zerosOutside, __pyx_k_zerosOutside, sizeof(__pyx_k_zerosOutside), 0, 0, 1, 1},
+  {&__pyx_n_s_zeros_outside, __pyx_k_zeros_outside, sizeof(__pyx_k_zeros_outside), 0, 0, 1, 1},
   {&__pyx_n_u_zu, __pyx_k_zu, sizeof(__pyx_k_zu), 0, 1, 0, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
   __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 240, __pyx_L1_error)
   __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 2, __pyx_L1_error)
   __pyx_builtin_super = __Pyx_GetBuiltinName(__pyx_n_s_super); if (!__pyx_builtin_super) __PYX_ERR(0, 343, __pyx_L1_error)
   __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 348, __pyx_L1_error)
   __pyx_builtin_NotImplementedError = __Pyx_GetBuiltinName(__pyx_n_s_NotImplementedError); if (!__pyx_builtin_NotImplementedError) __PYX_ERR(0, 895, __pyx_L1_error)
-  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 6077, __pyx_L1_error)
+  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 6074, __pyx_L1_error)
   __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(2, 944, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 149, __pyx_L1_error)
   __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(1, 152, __pyx_L1_error)
   __pyx_builtin_Ellipsis = __Pyx_GetBuiltinName(__pyx_n_s_Ellipsis); if (!__pyx_builtin_Ellipsis) __PYX_ERR(1, 406, __pyx_L1_error)
   __pyx_builtin_id = __Pyx_GetBuiltinName(__pyx_n_s_id); if (!__pyx_builtin_id) __PYX_ERR(1, 615, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
@@ -104559,169 +104571,169 @@
  *         cdef np.int64_t[:] I,J
  *         cdef np.float64_t[:] V
  */
   __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_u_There_are_no_z_edges_in_2D); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 3802, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__26);
   __Pyx_GIVEREF(__pyx_tuple__26);
 
-  /* "discretize/_extensions/tree_ext.pyx":4166
+  /* "discretize/_extensions/tree_ext.pyx":4161
  *             return self._average_face_z_to_cell
  *         if self._dim == 2:
  *             raise Exception('There are no z-faces in 2D')             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I,J
  *         cdef np.float64_t[:] V
  */
-  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_kp_u_There_are_no_z_faces_in_2D); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 4166, __pyx_L1_error)
+  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_kp_u_There_are_no_z_faces_in_2D); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 4161, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__27);
   __Pyx_GIVEREF(__pyx_tuple__27);
 
-  /* "discretize/_extensions/tree_ext.pyx":4423
+  /* "discretize/_extensions/tree_ext.pyx":4418
  *         """
  *         if self._dim == 2:
  *             raise Exception('TreeMesh has no z-edges in 2D')             # <<<<<<<<<<<<<<
  *         if self._average_node_to_edge_z is not None:
  *             return self._average_node_to_edge_z
  */
-  __pyx_tuple__28 = PyTuple_Pack(1, __pyx_kp_u_TreeMesh_has_no_z_edges_in_2D); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 4423, __pyx_L1_error)
+  __pyx_tuple__28 = PyTuple_Pack(1, __pyx_kp_u_TreeMesh_has_no_z_edges_in_2D); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 4418, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__28);
   __Pyx_GIVEREF(__pyx_tuple__28);
 
-  /* "discretize/_extensions/tree_ext.pyx":4583
+  /* "discretize/_extensions/tree_ext.pyx":4578
  *         """
  *         if self._dim == 2:
  *             raise Exception('TreeMesh has no z faces in 2D')             # <<<<<<<<<<<<<<
  *         cdef np.int64_t[:] I, J
  *         cdef np.float64_t[:] V
  */
-  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_u_TreeMesh_has_no_z_faces_in_2D); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 4583, __pyx_L1_error)
+  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_u_TreeMesh_has_no_z_faces_in_2D); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 4578, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__29);
   __Pyx_GIVEREF(__pyx_tuple__29);
 
-  /* "discretize/_extensions/tree_ext.pyx":5006
+  /* "discretize/_extensions/tree_ext.pyx":5001
  *         """
  *         if self.dim == 2:
  *             raise Exception('TreeMesh has no z-faces in 2D')             # <<<<<<<<<<<<<<
  *         if self._average_cell_to_face_z is not None:
  *             return self._average_cell_to_face_z
  */
-  __pyx_tuple__30 = PyTuple_Pack(1, __pyx_kp_u_TreeMesh_has_no_z_faces_in_2D_2); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 5006, __pyx_L1_error)
+  __pyx_tuple__30 = PyTuple_Pack(1, __pyx_kp_u_TreeMesh_has_no_z_faces_in_2D_2); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 5001, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__30);
   __Pyx_GIVEREF(__pyx_tuple__30);
 
-  /* "discretize/_extensions/tree_ext.pyx":5281
+  /* "discretize/_extensions/tree_ext.pyx":5276
  * 
  *     def _getFacePxx(self):
  *         def Pxx(xFace, yFace):             # <<<<<<<<<<<<<<
  *             return self._getFaceP(xFace, yFace, None)
  *         return Pxx
  */
-  __pyx_tuple__31 = PyTuple_Pack(2, __pyx_n_s_xFace, __pyx_n_s_yFace); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 5281, __pyx_L1_error)
+  __pyx_tuple__31 = PyTuple_Pack(2, __pyx_n_s_xFace, __pyx_n_s_yFace); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(0, 5276, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__31);
   __Pyx_GIVEREF(__pyx_tuple__31);
-  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_discretize__extensions_tree_ext, __pyx_n_s_Pxx, 5281, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 5281, __pyx_L1_error)
+  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__31, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_discretize__extensions_tree_ext, __pyx_n_s_Pxx, 5276, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 5276, __pyx_L1_error)
 
-  /* "discretize/_extensions/tree_ext.pyx":5286
+  /* "discretize/_extensions/tree_ext.pyx":5281
  * 
  *     def _getFacePxxx(self):
  *         def Pxxx(xFace, yFace, zFace):             # <<<<<<<<<<<<<<
  *             return self._getFaceP(xFace, yFace, zFace)
  *         return Pxxx
  */
-  __pyx_tuple__33 = PyTuple_Pack(3, __pyx_n_s_xFace, __pyx_n_s_yFace, __pyx_n_s_zFace); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 5286, __pyx_L1_error)
+  __pyx_tuple__33 = PyTuple_Pack(3, __pyx_n_s_xFace, __pyx_n_s_yFace, __pyx_n_s_zFace); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 5281, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__33);
   __Pyx_GIVEREF(__pyx_tuple__33);
-  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_discretize__extensions_tree_ext, __pyx_n_s_Pxxx, 5286, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 5286, __pyx_L1_error)
+  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_discretize__extensions_tree_ext, __pyx_n_s_Pxxx, 5281, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(0, 5281, __pyx_L1_error)
 
-  /* "discretize/_extensions/tree_ext.pyx":5311
+  /* "discretize/_extensions/tree_ext.pyx":5306
  *                 edges[2] = int(zEdge[-1]) #0, 1, 2, 3
  *         except ValueError:
  *             raise Exception('Last character of edge string must be 0, 1, 2, or 3')             # <<<<<<<<<<<<<<
  * 
  *         offsets[0] = 0
  */
-  __pyx_tuple__35 = PyTuple_Pack(1, __pyx_kp_u_Last_character_of_edge_string_mu); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 5311, __pyx_L1_error)
+  __pyx_tuple__35 = PyTuple_Pack(1, __pyx_kp_u_Last_character_of_edge_string_mu); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 5306, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__35);
   __Pyx_GIVEREF(__pyx_tuple__35);
 
-  /* "discretize/_extensions/tree_ext.pyx":5337
+  /* "discretize/_extensions/tree_ext.pyx":5332
  * 
  *     def _getEdgePxx(self):
  *         def Pxx(xEdge, yEdge):             # <<<<<<<<<<<<<<
  *             return self._getEdgeP(xEdge, yEdge, None)
  *         return Pxx
  */
-  __pyx_tuple__36 = PyTuple_Pack(2, __pyx_n_s_xEdge, __pyx_n_s_yEdge); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 5337, __pyx_L1_error)
+  __pyx_tuple__36 = PyTuple_Pack(2, __pyx_n_s_xEdge, __pyx_n_s_yEdge); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 5332, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__36);
   __Pyx_GIVEREF(__pyx_tuple__36);
-  __pyx_codeobj__37 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_discretize__extensions_tree_ext, __pyx_n_s_Pxx, 5337, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(0, 5337, __pyx_L1_error)
+  __pyx_codeobj__37 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_discretize__extensions_tree_ext, __pyx_n_s_Pxx, 5332, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(0, 5332, __pyx_L1_error)
 
-  /* "discretize/_extensions/tree_ext.pyx":5342
+  /* "discretize/_extensions/tree_ext.pyx":5337
  * 
  *     def _getEdgePxxx(self):
  *         def Pxxx(xEdge, yEdge, zEdge):             # <<<<<<<<<<<<<<
  *             return self._getEdgeP(xEdge, yEdge, zEdge)
  *         return Pxxx
  */
-  __pyx_tuple__38 = PyTuple_Pack(3, __pyx_n_s_xEdge, __pyx_n_s_yEdge, __pyx_n_s_zEdge); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 5342, __pyx_L1_error)
+  __pyx_tuple__38 = PyTuple_Pack(3, __pyx_n_s_xEdge, __pyx_n_s_yEdge, __pyx_n_s_zEdge); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 5337, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__38);
   __Pyx_GIVEREF(__pyx_tuple__38);
-  __pyx_codeobj__39 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_discretize__extensions_tree_ext, __pyx_n_s_Pxxx, 5342, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__39)) __PYX_ERR(0, 5342, __pyx_L1_error)
+  __pyx_codeobj__39 = (PyObject*)__Pyx_PyCode_New(3, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_discretize__extensions_tree_ext, __pyx_n_s_Pxxx, 5337, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__39)) __PYX_ERR(0, 5337, __pyx_L1_error)
 
-  /* "discretize/_extensions/tree_ext.pyx":5379
+  /* "discretize/_extensions/tree_ext.pyx":5374
  *             offset = self.n_total_edges_x + self.n_total_edges_y
  *         else:
  *             raise ValueError('Invalid direction, must be x, y, or z')             # <<<<<<<<<<<<<<
  * 
  *         for i in range(n_loc):
  */
-  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_kp_u_Invalid_direction_must_be_x_y_or); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 5379, __pyx_L1_error)
+  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_kp_u_Invalid_direction_must_be_x_y_or); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 5374, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__40);
   __Pyx_GIVEREF(__pyx_tuple__40);
 
-  /* "discretize/_extensions/tree_ext.pyx":6084
+  /* "discretize/_extensions/tree_ext.pyx":6081
  *             return pycell
  *         else:
  *             raise TypeError("Invalid argument type.")             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
-  __pyx_tuple__41 = PyTuple_Pack(1, __pyx_kp_u_Invalid_argument_type); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 6084, __pyx_L1_error)
+  __pyx_tuple__41 = PyTuple_Pack(1, __pyx_kp_u_Invalid_argument_type); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 6081, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__41);
   __Pyx_GIVEREF(__pyx_tuple__41);
 
-  /* "discretize/_extensions/tree_ext.pyx":6097
+  /* "discretize/_extensions/tree_ext.pyx":6094
  * 
  *         if self.dim == 2:
  *             indArr[:, -1] = (self._ys.shape[0]-1) - indArr[:, -1]             # <<<<<<<<<<<<<<
  *         else:
  *             indArr[:, -1] = (self._zs.shape[0]-1) - indArr[:, -1]
  */
-  __pyx_tuple__42 = PyTuple_Pack(2, __pyx_slice__20, __pyx_int_neg_1); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 6097, __pyx_L1_error)
+  __pyx_tuple__42 = PyTuple_Pack(2, __pyx_slice__20, __pyx_int_neg_1); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 6094, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__42);
   __Pyx_GIVEREF(__pyx_tuple__42);
 
-  /* "discretize/_extensions/tree_ext.pyx":6101
+  /* "discretize/_extensions/tree_ext.pyx":6098
  *             indArr[:, -1] = (self._zs.shape[0]-1) - indArr[:, -1]
  * 
  *         indArr = (indArr - levels[:, None])//2             # <<<<<<<<<<<<<<
  *         indArr += 1
  * 
  */
-  __pyx_tuple__43 = PyTuple_Pack(2, __pyx_slice__20, Py_None); if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 6101, __pyx_L1_error)
+  __pyx_tuple__43 = PyTuple_Pack(2, __pyx_slice__20, Py_None); if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 6098, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__43);
   __Pyx_GIVEREF(__pyx_tuple__43);
 
-  /* "discretize/_extensions/tree_ext.pyx":6441
+  /* "discretize/_extensions/tree_ext.pyx":6438
  * 
  *         if not build_mat:
  *             return output.reshape(-1, order='F')             # <<<<<<<<<<<<<<
  *         return sp.csr_matrix((all_weights, row_inds, indptr), shape=(out_tens_mesh.n_cells, self.n_cells))
  * 
  */
-  __pyx_tuple__44 = PyTuple_Pack(1, __pyx_int_neg_1); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 6441, __pyx_L1_error)
+  __pyx_tuple__44 = PyTuple_Pack(1, __pyx_int_neg_1); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 6438, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__44);
   __Pyx_GIVEREF(__pyx_tuple__44);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
@@ -105002,16 +105014,16 @@
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_float_0_0 = PyFloat_FromDouble(0.0); if (unlikely(!__pyx_float_0_0)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_float_0_5 = PyFloat_FromDouble(0.5); if (unlikely(!__pyx_float_0_5)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_float_1_0 = PyFloat_FromDouble(1.0); if (unlikely(!__pyx_float_1_0)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_float_0_25 = PyFloat_FromDouble(0.25); if (unlikely(!__pyx_float_0_25)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_4 = PyInt_FromLong(4); if (unlikely(!__pyx_int_4)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_5 = PyInt_FromLong(5); if (unlikely(!__pyx_int_5)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_6 = PyInt_FromLong(6); if (unlikely(!__pyx_int_6)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -105106,39 +105118,39 @@
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine.tp_dictoffset && __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine = &__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct__refine;
-  if (PyType_Ready(&__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx) < 0) __PYX_ERR(0, 5280, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx) < 0) __PYX_ERR(0, 5275, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx.tp_dictoffset && __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx = &__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_1__getFacePxx;
-  if (PyType_Ready(&__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx) < 0) __PYX_ERR(0, 5285, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx) < 0) __PYX_ERR(0, 5280, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx.tp_dictoffset && __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx = &__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_2__getFacePxxx;
-  if (PyType_Ready(&__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx) < 0) __PYX_ERR(0, 5336, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx) < 0) __PYX_ERR(0, 5331, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx.tp_dictoffset && __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx = &__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_3__getEdgePxx;
-  if (PyType_Ready(&__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx) < 0) __PYX_ERR(0, 5341, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx) < 0) __PYX_ERR(0, 5336, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx.tp_dictoffset && __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx = &__pyx_type_10discretize_11_extensions_8tree_ext___pyx_scope_struct_4__getEdgePxxx;
@@ -105206,55 +105218,39 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_0_29_35(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(3, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(2, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(2, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(2, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(2, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_generic = __Pyx_ImportType(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_generic) __PYX_ERR(2, 770, __pyx_L1_error)
-  __pyx_ptype_5numpy_number = __Pyx_ImportType(__pyx_t_1, "numpy", "number", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_number) __PYX_ERR(2, 772, __pyx_L1_error)
-  __pyx_ptype_5numpy_integer = __Pyx_ImportType(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_integer) __PYX_ERR(2, 774, __pyx_L1_error)
-  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(2, 776, __pyx_L1_error)
-  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(2, 778, __pyx_L1_error)
-  __pyx_ptype_5numpy_inexact = __Pyx_ImportType(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(2, 780, __pyx_L1_error)
-  __pyx_ptype_5numpy_floating = __Pyx_ImportType(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_floating) __PYX_ERR(2, 782, __pyx_L1_error)
-  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(2, 784, __pyx_L1_error)
-  __pyx_ptype_5numpy_flexible = __Pyx_ImportType(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(2, 786, __pyx_L1_error)
-  __pyx_ptype_5numpy_character = __Pyx_ImportType(__pyx_t_1, "numpy", "character", sizeof(PyObject), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_5numpy_character) __PYX_ERR(2, 788, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(2, 826, __pyx_L1_error)
+  __pyx_ptype_5numpy_dtype = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArray_Descr),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(2, 199, __pyx_L1_error)
+  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(2, 222, __pyx_L1_error)
+  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayMultiIterObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(2, 226, __pyx_L1_error)
+  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyArrayObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(2, 238, __pyx_L1_error)
+  __pyx_ptype_5numpy_generic = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "generic", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_generic) __PYX_ERR(2, 770, __pyx_L1_error)
+  __pyx_ptype_5numpy_number = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "number", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_number) __PYX_ERR(2, 772, __pyx_L1_error)
+  __pyx_ptype_5numpy_integer = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "integer", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_integer) __PYX_ERR(2, 774, __pyx_L1_error)
+  __pyx_ptype_5numpy_signedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "signedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_signedinteger) __PYX_ERR(2, 776, __pyx_L1_error)
+  __pyx_ptype_5numpy_unsignedinteger = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "unsignedinteger", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_unsignedinteger) __PYX_ERR(2, 778, __pyx_L1_error)
+  __pyx_ptype_5numpy_inexact = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "inexact", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_inexact) __PYX_ERR(2, 780, __pyx_L1_error)
+  __pyx_ptype_5numpy_floating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "floating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_floating) __PYX_ERR(2, 782, __pyx_L1_error)
+  __pyx_ptype_5numpy_complexfloating = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "complexfloating", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_complexfloating) __PYX_ERR(2, 784, __pyx_L1_error)
+  __pyx_ptype_5numpy_flexible = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "flexible", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_flexible) __PYX_ERR(2, 786, __pyx_L1_error)
+  __pyx_ptype_5numpy_character = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "character", sizeof(PyObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyObject),__Pyx_ImportType_CheckSize_Warn_0_29_35); if (!__pyx_ptype_5numpy_character) __PYX_ERR(2, 788, __pyx_L1_error)
+  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType_0_29_35(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __PYX_GET_STRUCT_ALIGNMENT_0_29_35(PyUFuncObject),__Pyx_ImportType_CheckSize_Ignore_0_29_35); if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(2, 826, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -105274,16 +105270,16 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_function_import_code", 0);
   /*--- Function import code ---*/
   __pyx_t_1 = PyImport_ImportModule("discretize._extensions.interputils_cython"); if (!__pyx_t_1) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_ImportFunction(__pyx_t_1, "_bisect_left", (void (**)(void))&__pyx_f_10discretize_11_extensions_18interputils_cython__bisect_left, "__pyx_t_5numpy_int64_t (__Pyx_memviewslice, __pyx_t_5numpy_float64_t)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  if (__Pyx_ImportFunction(__pyx_t_1, "_bisect_right", (void (**)(void))&__pyx_f_10discretize_11_extensions_18interputils_cython__bisect_right, "__pyx_t_5numpy_int64_t (__Pyx_memviewslice, __pyx_t_5numpy_float64_t)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ImportFunction_0_29_35(__pyx_t_1, "_bisect_left", (void (**)(void))&__pyx_f_10discretize_11_extensions_18interputils_cython__bisect_left, "__pyx_t_5numpy_int64_t (__Pyx_memviewslice, __pyx_t_5numpy_float64_t)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ImportFunction_0_29_35(__pyx_t_1, "_bisect_right", (void (**)(void))&__pyx_f_10discretize_11_extensions_18interputils_cython__bisect_right, "__pyx_t_5numpy_int64_t (__Pyx_memviewslice, __pyx_t_5numpy_float64_t)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -105541,21 +105537,21 @@
  * cdef int _evaluate_func(void* function, c_Cell* cell) with gil:             # <<<<<<<<<<<<<<
  *     # Wraps a function to be called in C++
  *     func = <object> function
  */
   __Pyx_TraceLine(303,0,__PYX_ERR(0, 303, __pyx_L1_error))
 
 
-  /* "discretize/_extensions/tree_ext.pyx":6652
+  /* "discretize/_extensions/tree_ext.pyx":6649
  * 
  * 
  * cdef inline double _clip01(double x) nogil:             # <<<<<<<<<<<<<<
  *     return min(1, max(x, 0))
  */
-  __Pyx_TraceLine(6652,0,__PYX_ERR(0, 6652, __pyx_L1_error))
+  __Pyx_TraceLine(6649,0,__PYX_ERR(0, 6649, __pyx_L1_error))
 
 
   /* "discretize/_extensions/tree_ext.pyx":1
  * # distutils: language=c++             # <<<<<<<<<<<<<<
  * # cython: embedsignature=True, language_level=3
  * # cython: linetrace=True
  */
@@ -107061,28 +107057,28 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+#if CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
@@ -108163,15 +108159,18 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
@@ -110702,61 +110701,79 @@
     Py_XDECREF(reduce_cython);
     Py_XDECREF(setstate);
     Py_XDECREF(setstate_cython);
     return ret;
 }
 
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+#ifndef __PYX_HAVE_RT_ImportType_0_29_35
+#define __PYX_HAVE_RT_ImportType_0_29_35
+static PyTypeObject *__Pyx_ImportType_0_29_35(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_0_29_35 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
 #ifdef Py_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
 #ifndef Py_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_0_29_35 && (size_t)basicsize != size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_0_29_35 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
@@ -112691,15 +112708,15 @@
                         } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
                             return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -112887,15 +112904,15 @@
                         } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
                             return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -113083,15 +113100,15 @@
                         } else if (8 * sizeof(int_t) >= 4 * PyLong_SHIFT) {
                             return (int_t) (((((((((int_t)digits[3]) << PyLong_SHIFT) | (int_t)digits[2]) << PyLong_SHIFT) | (int_t)digits[1]) << PyLong_SHIFT) | (int_t)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -113355,15 +113372,15 @@
                         } else if (8 * sizeof(npy_int64) >= 4 * PyLong_SHIFT) {
                             return (npy_int64) (((((((((npy_int64)digits[3]) << PyLong_SHIFT) | (npy_int64)digits[2]) << PyLong_SHIFT) | (npy_int64)digits[1]) << PyLong_SHIFT) | (npy_int64)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -113551,15 +113568,15 @@
                         } else if (8 * sizeof(npy_int8) >= 4 * PyLong_SHIFT) {
                             return (npy_int8) (((((((((npy_int8)digits[3]) << PyLong_SHIFT) | (npy_int8)digits[2]) << PyLong_SHIFT) | (npy_int8)digits[1]) << PyLong_SHIFT) | (npy_int8)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -113785,15 +113802,15 @@
                         } else if (8 * sizeof(size_t) >= 4 * PyLong_SHIFT) {
                             return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -113981,15 +113998,15 @@
                         } else if (8 * sizeof(char) >= 4 * PyLong_SHIFT) {
                             return (char) (((((((((char)digits[3]) << PyLong_SHIFT) | (char)digits[2]) << PyLong_SHIFT) | (char)digits[1]) << PyLong_SHIFT) | (char)digits[0]));
                         }
                     }
                     break;
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
@@ -114156,17 +114173,17 @@
                       ctversion, __Pyx_MODULE_NAME, rtversion);
         return PyErr_WarnEx(NULL, message, 1);
     }
     return 0;
 }
 
 /* FunctionImport */
-  #ifndef __PYX_HAVE_RT_ImportFunction
-#define __PYX_HAVE_RT_ImportFunction
-static int __Pyx_ImportFunction(PyObject *module, const char *funcname, void (**f)(void), const char *sig) {
+  #ifndef __PYX_HAVE_RT_ImportFunction_0_29_35
+#define __PYX_HAVE_RT_ImportFunction_0_29_35
+static int __Pyx_ImportFunction_0_29_35(PyObject *module, const char *funcname, void (**f)(void), const char *sig) {
     PyObject *d = 0;
     PyObject *cobj = 0;
     union {
         void (*fp)(void);
         void *p;
     } tmp;
     d = PyObject_GetAttrString(module, (char *)"__pyx_capi__");
```

### Comparing `discretize-0.8.3/discretize/_extensions/tree_ext.pyx` & `discretize-0.9.0/discretize/_extensions/tree_ext.pyx`

 * *Files 0% similar despite different names*

```diff
@@ -422,15 +422,15 @@
         self._average_face_to_cell_vector = None
 
         self._average_edge_x_to_cell = None
         self._average_edge_y_to_cell = None
         self._average_edge_z_to_cell = None
         self._average_edge_to_cell = None
         self._average_edge_to_cell_vector = None
-        self._average_edge_to_face_vector = None
+        self._average_edge_to_face = None
 
         self._average_node_to_cell = None
         self._average_node_to_edge = None
         self._average_node_to_face = None
         self._average_node_to_edge_x = None
         self._average_node_to_edge_y = None
         self._average_node_to_edge_z = None
@@ -865,33 +865,33 @@
         --------
         We create a simple mesh and refine the TreeMesh such that all cells that
         intersect the line segment path are at the given levels.
 
         >>> import discretize
         >>> import matplotlib.pyplot as plt
         >>> import matplotlib.patches as patches
-        >>> tree_mesh = discretize.TreeMesh([32, 32, 32])
-        >>> tree_mesh.max_level
+        >>> mesh = discretize.TreeMesh([32, 32, 32])
+        >>> mesh.max_level
         5
 
         Next we define the bottom points of the prism, its heights, and the level we
         want to refine to, then refine the mesh.
 
         >>> triangle = [[0.14, 0.31, 0.21], [0.32, 0.96, 0.34], [0.87, 0.23, 0.12]]
         >>> height = 0.35
         >>> levels = 5
-        >>> mesh.refine_vertical_trianglular_prism(triangle, height, levels)
+        >>> tree_mesh.refine_vertical_trianglular_prism(triangle, height, levels)
 
         Now lets look at the mesh.
 
-        >>> v = mesh.cell_levels_by_index(np.arange(mesh.n_cells))
+        >>> v = tree_mesh.cell_levels_by_index(np.arange(tree_mesh.n_cells))
         >>> fig, axs = plt.subplots(1, 3, figsize=(12,4))
-        >>> mesh.plot_slice(v, ax=axs[0], normal='x', grid=True, clim=[2, 5])
-        >>> mesh.plot_slice(v, ax=axs[1], normal='y', grid=True, clim=[2, 5])
-        >>> mesh.plot_slice(v, ax=axs[2], normal='z', grid=True, clim=[2, 5])
+        >>> tree_mesh.plot_slice(v, ax=axs[0], normal='x', grid=True, clim=[2, 5])
+        >>> tree_mesh.plot_slice(v, ax=axs[1], normal='y', grid=True, clim=[2, 5])
+        >>> tree_mesh.plot_slice(v, ax=axs[2], normal='z', grid=True, clim=[2, 5])
         >>> plt.show()
 
         """
         if self.dim == 2:
             raise NotImplementedError("refine_vertical_trianglular_prism only implemented in 3D.")
         triangle = np.require(np.atleast_2d(triangle), dtype=np.float64, requirements="C")
         if triangle.ndim == 2:
@@ -3908,62 +3908,57 @@
             stacks = [self.average_edge_x_to_cell, self.average_edge_y_to_cell]
             if self._dim == 3:
                 stacks += [self.average_edge_z_to_cell]
             self._average_edge_to_cell_vector = sp.block_diag(stacks).tocsr()
         return self._average_edge_to_cell_vector
 
     @property
-    def average_edge_to_face_vector(self):
-        """Averaging operator from edges to faces (vector quantities).
+    def average_edge_to_face(self):
+        r"""Averaging operator from edges to faces.
 
-        This property constructs the averaging operator that independently maps the
-        Cartesian components of vector quantities from edges to faces.
-        This averaging operators is used when a discrete vector quantity defined on mesh edges
+        This property constructs the averaging operator that maps uantities from edges to faces.
+        This averaging operators is used when a discrete quantity defined on mesh edges
         must be approximated at faces. The operation is implemented as a
         matrix vector product, i.e.::
 
             u_f = Aef @ u_e
 
         Once constructed, the operator is stored permanently as a property of the mesh.
 
         Returns
         -------
         (n_faces, n_edges) scipy.sparse.csr_matrix
-            The vector averaging operator from edges to faces.
+            The averaging operator from edges to faces.
 
         Notes
         -----
-        Let :math:`\mathbf{u_e}` be the discrete representation of a vector
-        quantity whose Cartesian components are defined on their respective edges;
-        e.g. the x-component is defined on x-edges. **average_edge_to_face_vector**
+        Let :math:`\mathbf{u_e}` be the discrete representation of aquantity whose
+        that is defined on the edges. **average_edge_to_face**
         constructs a discrete linear operator :math:`\mathbf{A_{ef}}` that
-        projects each Cartesian component of :math:`\mathbf{u_e}` to
-        its corresponding face, i.e.:
+        projects :math:`\mathbf{u_e}` to its corresponding face, i.e.:
 
         .. math::
             \mathbf{u_f} = \mathbf{A_{ef}} \, \mathbf{u_e}
 
-        where :math:`\mathbf{u_f}` is a discrete vector quantity whose Cartesian
-        components are defined on their respective faces; e.g. the x-component is
-        defined on x-faces.
+        where :math:`\mathbf{u_f}` is a quantity defined on the respective faces.
         """
         if self.dim == 2:
             return sp.diags(
                 [1, 1],
                 [-self.n_faces_x, self.n_faces_y],
                 shape=(self.n_faces, self.n_edges)
             )
 
-        if self._average_edge_to_face_vector is not None:
-            return self._average_edge_to_face_vector
+        if self._average_edge_to_face is not None:
+            return self._average_edge_to_face
         cdef:
             int_t dim = self._dim
             np.int64_t[:] I = np.empty(4*self.n_faces, dtype=np.int64)
             np.int64_t[:] J = np.empty(4*self.n_faces, dtype=np.int64)
-            np.float64_t[:] V = np.full(4*self.n_faces, 0.5, dtype=np.float64)
+            np.float64_t[:] V = np.full(4*self.n_faces, 0.25, dtype=np.float64)
             Face *face
             int_t ii
             int_t face_offset_y = self.n_faces_x
             int_t face_offset_z = self.n_faces_x + self.n_faces_y
             int_t edge_offset_y = self.n_total_edges_x
             int_t edge_offset_z = self.n_total_edges_x + self.n_total_edges_y
             double area
@@ -4000,16 +3995,16 @@
             J[4*ii + 1] = face.edges[1].index
             J[4*ii + 2] = face.edges[2].index + edge_offset_y
             J[4*ii + 3] = face.edges[3].index
 
         Av = sp.csr_matrix((V, (I, J)),shape=(self.n_faces, self.n_total_edges))
         R = self._deflate_edges()
 
-        self._average_edge_to_face_vector = Av @ R
-        return self._average_edge_to_face_vector
+        self._average_edge_to_face = Av @ R
+        return self._average_edge_to_face
 
     @property
     @cython.boundscheck(False)
     def average_face_x_to_cell(self):
         r"""Averaging operator from x-faces to cell centers (scalar quantities).
 
         This property constructs a 2nd order averaging operator that maps scalar
@@ -5339,15 +5334,15 @@
         return Pxx
 
     def _getEdgePxxx(self):
         def Pxxx(xEdge, yEdge, zEdge):
             return self._getEdgeP(xEdge, yEdge, zEdge)
         return Pxxx
 
-    def _getEdgeIntMat(self, locs, zerosOutside, direction):
+    def _getEdgeIntMat(self, locs, zeros_outside, direction):
         cdef:
             double[:, :] locations = locs
             int_t dir, dir1, dir2
             int_t dim = self._dim
             int_t n_loc = locs.shape[0]
             int_t n_edges = 2 if self._dim == 2 else 4
             np.int64_t[:] indptr = 2 * n_edges * np.arange(n_loc+1, dtype=np.int64)
@@ -5360,15 +5355,15 @@
             int_t ii, i, j, offset
             c_Cell *cell
             c_Cell *i0, *i1
             Edge *i000, *i001, *i010, *i011, *i100, *i101, *i110, *i111
             double x, y, z
             double w1, w2, w3
             double eps = 100*np.finfo(float).eps
-            int zeros_out = zerosOutside
+            int zeros_out = zeros_outside
 
         if direction == 'x':
             dir, dir1, dir2 = 0, 1, 2
             offset = 0
         elif direction == 'y':
             dir, dir1, dir2 = 1, 0, 2
             offset = self.n_total_edges_x
@@ -5473,15 +5468,15 @@
                     row_inds[6] = i110.index + offset
                     row_inds[7] = i111.index + offset
 
         Re = self._deflate_edges()
         A = sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_edges))
         return A*Re
 
-    def _getFaceIntMat(self, locs, zerosOutside, direction):
+    def _getFaceIntMat(self, locs, zeros_outside, direction):
         cdef:
             double[:, :] locations = locs
             int_t dir, dir1, dir2, temp
             int_t dim = self._dim
             int_t n_loc = locs.shape[0]
             int_t n_faces = 4 if dim == 2 else 8
             np.int64_t[:] indptr = n_faces * np.arange(n_loc + 1, dtype=np.int64)
@@ -5492,15 +5487,15 @@
             c_Cell *cell
             c_Cell *i00, *i01, *i10, *i11
             Face *f000, *f001, *f010, *f011, *f100, *f101, *f110, *f111
             Edge *e00, *e01, *e10, *e11
             double x, y, z
             double w1, w2, w3
             double eps = 100*np.finfo(float).eps
-            int zeros_out = zerosOutside
+            int zeros_out = zeros_outside
 
         if direction == 'x':
             dir = 0
             dir1 = 1
             dir2 = 2
             offset = 0
         elif direction == 'y':
@@ -5669,30 +5664,30 @@
                   row_inds[5] = f101.index + offset
                   row_inds[6] = f110.index + offset
                   row_inds[7] = f111.index + offset
 
         Rf = self._deflate_faces()
         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0], self.n_total_faces))*Rf
 
-    def _getNodeIntMat(self, locs, zerosOutside):
+    def _getNodeIntMat(self, locs, zeros_outside):
         cdef:
             double[:, :] locations = locs
             int_t dim = self._dim
             int_t n_loc = locs.shape[0]
             int_t n_nodes = 1<<dim
             np.int64_t[:] I = np.empty(n_loc*n_nodes, dtype=np.int64)
             np.int64_t[:] J = np.empty(n_loc*n_nodes, dtype=np.int64)
             np.float64_t[:] V = np.empty(n_loc*n_nodes, dtype=np.float64)
 
             int_t ii, i
             c_Cell *cell
             double x, y, z
             double wx, wy, wz
             double eps = 100*np.finfo(float).eps
-            int zeros_out = zerosOutside
+            int zeros_out = zeros_outside
 
         for i in range(n_loc):
             x = locations[i, 0]
             y = locations[i, 1]
             z = locations[i, 2] if dim==3 else 0.0
             #get containing (or closest) cell
             cell = self.tree.containing_cell(x, y, z)
@@ -5734,15 +5729,15 @@
                 V[n_nodes*i + 5] = (1 - wx)*wy*(1 - wz)
                 V[n_nodes*i + 6] = wx*(1 - wy)*(1 - wz)
                 V[n_nodes*i + 7] = (1 - wx)*(1 - wy)*(1 - wz)
 
         Rn = self._deflate_nodes()
         return sp.csr_matrix((V, (I, J)), shape=(locs.shape[0],self.n_total_nodes))*Rn
 
-    def _getCellIntMat(self, locs, zerosOutside):
+    def _getCellIntMat(self, locs, zeros_outside):
         cdef:
             double[:, :] locations = locs
             int_t dim = self._dim
             int_t dir0, dir1, dir2, temp
             int_t n_loc = locations.shape[0]
             int_t n_cells = 4 if dim == 2 else 8
             np.int64_t[:] indptr = n_cells * np.arange(n_loc+1, dtype=np.int64)
@@ -5754,15 +5749,15 @@
             np.float64_t w0, w1, w2
 
             int_t ii, i
             c_Cell *i000, *i001, *i010, *i011, *i100, *i101, *i110, *i111
             c_Cell *cell
             double x, y, z
             double eps = 100*np.finfo(float).eps
-            int zeros_out = zerosOutside
+            int zeros_out = zeros_outside
 
         dir0 = 0
         dir1 = 1
         dir2 = 2
 
         for i in range(n_loc):
             x = locations[i, 0]
@@ -5954,24 +5949,26 @@
                     row_inds[5] = i101.index
                     row_inds[6] = i110.index
                     row_inds[7] = i111.index
         return sp.csr_matrix((data, indices, indptr), shape=(locs.shape[0],self.n_cells))
 
     @property
     def cell_nodes(self):
-        """The index of nodes for each cell.
+        """The index of all nodes for each cell.
+
+        These indices point to non-hanging and hanging nodes.
 
         Returns
         -------
         numpy.ndarray of int
             Index array of shape (n_cells, 4) if 2D, or (n_cells, 8) if 3D
 
-        Notes
-        -----
-        These indices will also point to hanging nodes.
+        See also
+        --------
+        TreeMesh.total_nodes
         """
         cdef int_t npc = 4 if self.dim == 2 else 8
         inds = np.empty((self.n_cells, npc), dtype=np.int64)
         cdef np.int64_t[:, :] node_index = inds
         cdef int_t i
 
         for cell in self.tree.cells:
```

### Comparing `discretize-0.8.3/discretize/_extensions/triplet.h` & `discretize-0.9.0/discretize/_extensions/triplet.h`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/base/__init__.py` & `discretize-0.9.0/discretize/base/__init__.py`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/base/base_mesh.py` & `discretize-0.9.0/discretize/base/base_mesh.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,9 @@
 """Module for the base ``discretize`` mesh."""
 import numpy as np
-import warnings
 import os
 import json
 from scipy.spatial import KDTree
 from discretize.utils.code_utils import (
     deprecate_property,
     deprecate_method,
     as_array_n_by_dim,
@@ -163,19 +162,17 @@
         ----------
         file_name : str, optional
             File name for saving the mesh properties
         verbose : bool, optional
             If *True*, the path of the json file is printed
         """
         if "filename" in kwargs:
-            file_name = kwargs["filename"]
-            warnings.warn(
-                "The filename keyword argument has been deprecated, please use file_name. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The filename keyword argument has been removed, please use file_name. "
+                "This will be removed in discretize 1.0.0"
             )
         f = os.path.abspath(file_name)  # make sure we are working with abs path
         with open(f, "w") as outfile:
             json.dump(self.to_dict(), outfile)
 
         if verbose:
             print("Saved {}".format(f))
@@ -825,77 +822,73 @@
         Construct the divergence operator and apply to face-vector
 
         >>> Df = mesh.face_divergence
         >>> div_u = Df @ u
 
         Plot the original face-vector and its divergence
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 6))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(
-            ...     u, ax=ax1, v_type="F", view="vec", stream_opts={"color": "w", "density": 1.0}
-            ... )
-            >>> ax1.set_title("Vector at cell faces", fontsize=14)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(div_u, ax=ax2)
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Divergence at cell centers", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 6))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(
+        ...     u, ax=ax1, v_type="F", view="vec", stream_opts={"color": "w", "density": 1.0}
+        ... )
+        >>> ax1.set_title("Vector at cell faces", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(div_u, ax=ax2)
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Divergence at cell centers", fontsize=14)
+        >>> plt.show()
 
         The discrete divergence operator is a sparse matrix that maps
         from faces to cell centers. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements in
         the original discrete quantity :math:`\mathbf{u}` and its
         discrete divergence :math:`\boldsymbol{\phi}` as well as a
         spy plot.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> mesh = TensorMesh([[(1, 6)], [(1, 3)]])
-            >>> fig = plt.figure(figsize=(10, 10))
-            >>> ax1 = fig.add_subplot(211)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.plot(
-            ...     mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8
-            ... )
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="r")
-            >>> ax1.plot(
-            ...     mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8
-            ... )
-            >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
-            ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="g")
-            >>> ax1.plot(
-            ...     mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8
-            ... )
-            >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.1, "{0:d}".format((ii + mesh.nFx)), color="g")
+        >>> mesh = TensorMesh([[(1, 6)], [(1, 3)]])
+        >>> fig = plt.figure(figsize=(10, 10))
+        >>> ax1 = fig.add_subplot(211)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.plot(
+        ...     mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8
+        ... )
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.plot(
+        ...     mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8
+        ... )
+        >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
+        ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="g")
+        >>> ax1.plot(
+        ...     mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8
+        ... )
+        >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.1, "{0:d}".format((ii + mesh.nFx)), color="g")
 
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.set_title("Mapping of Face Divergence", fontsize=14, pad=15)
-            >>> ax1.legend(
-            ...     ['Mesh', r'$\mathbf{\phi}$ (centers)', r'$\mathbf{u}$ (faces)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-            >>> ax2 = fig.add_subplot(212)
-            >>> ax2.spy(mesh.face_divergence)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("Cell Index", fontsize=12)
-            >>> ax2.set_xlabel("Face Index", fontsize=12)
-            >>> plt.show()
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.set_title("Mapping of Face Divergence", fontsize=14, pad=15)
+        >>> ax1.legend(
+        ...     ['Mesh', r'$\mathbf{\phi}$ (centers)', r'$\mathbf{u}$ (faces)'],
+        ...     loc='upper right', fontsize=14
+        ... )
+        >>> ax2 = fig.add_subplot(212)
+        >>> ax2.spy(mesh.face_divergence)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("Cell Index", fontsize=12)
+        >>> ax2.set_xlabel("Face Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(f"face_divergence not implemented for {type(self)}")
 
     @property
     def nodal_gradient(self):
         r"""Nodal gradient operator (nodes to edges).
 
@@ -973,73 +966,69 @@
         Construct the gradient operator and apply to vector
 
         >>> Gn = mesh.nodal_gradient
         >>> grad_phi = Gn @ phi
 
         Plot the original function and the gradient
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 6))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi, v_type="N", ax=ax1)
-            >>> ax1.set_title("Scalar at nodes", fontsize=14)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(
-            ...     grad_phi, ax=ax2, v_type="E", view="vec",
-            ...     stream_opts={"color": "w", "density": 1.0}
-            ... )
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Gradient at edges", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 6))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi, v_type="N", ax=ax1)
+        >>> ax1.set_title("Scalar at nodes", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(
+        ...     grad_phi, ax=ax2, v_type="E", view="vec",
+        ...     stream_opts={"color": "w", "density": 1.0}
+        ... )
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Gradient at edges", fontsize=14)
+        >>> plt.show()
 
         The nodal gradient operator is a sparse matrix that maps
         from nodes to edges. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements in
         the original discrete quantity :math:`\boldsymbol{\phi}` and its
         discrete gradient as well as a spy plot.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> mesh = TensorMesh([[(1, 3)], [(1, 6)]])
-            >>> fig = plt.figure(figsize=(12, 10))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.set_title("Mapping of Gradient Operator", fontsize=14, pad=15)
-            >>> ax1.plot(mesh.nodes[:, 0], mesh.nodes[:, 1], "ro", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nN), mesh.nodes):
-            >>>     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
-
-            >>> ax1.plot(mesh.edges_x[:, 0], mesh.edges_x[:, 1], "g>", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nEx), mesh.edges_x):
-            >>>     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
-
-            >>> ax1.plot(mesh.edges_y[:, 0], mesh.edges_y[:, 1], "g^", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nEy), mesh.edges_y):
-            >>>     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format((ii + mesh.nEx)), color="g")
-
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.legend(
-            >>>     ['Mesh', r'$\mathbf{\phi}$ (nodes)', r'$\mathbf{u}$ (edges)'],
-            >>>     loc='upper right', fontsize=14
-            >>> )
-            >>> ax2 = fig.add_subplot(122)
-            >>> ax2.spy(mesh.nodal_gradient)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("Edge Index", fontsize=12)
-            >>> ax2.set_xlabel("Node Index", fontsize=12)
-            >>> plt.plot()
+        >>> mesh = TensorMesh([[(1, 3)], [(1, 6)]])
+        >>> fig = plt.figure(figsize=(12, 10))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.set_title("Mapping of Gradient Operator", fontsize=14, pad=15)
+        >>> ax1.plot(mesh.nodes[:, 0], mesh.nodes[:, 1], "ro", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nN), mesh.nodes):
+        >>>     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
+
+        >>> ax1.plot(mesh.edges_x[:, 0], mesh.edges_x[:, 1], "g>", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nEx), mesh.edges_x):
+        >>>     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
+
+        >>> ax1.plot(mesh.edges_y[:, 0], mesh.edges_y[:, 1], "g^", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nEy), mesh.edges_y):
+        >>>     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format((ii + mesh.nEx)), color="g")
+
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.legend(
+        >>>     ['Mesh', r'$\mathbf{\phi}$ (nodes)', r'$\mathbf{u}$ (edges)'],
+        >>>     loc='upper right', fontsize=14
+        >>> )
+        >>> ax2 = fig.add_subplot(122)
+        >>> ax2.spy(mesh.nodal_gradient)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("Edge Index", fontsize=12)
+        >>> ax2.set_xlabel("Node Index", fontsize=12)
+        >>> plt.plot()
         """
         raise NotImplementedError(f"nodal_gradient not implemented for {type(self)}")
 
     @property
     def edge_curl(self):
         r"""Edge curl operator (edges to faces).
 
@@ -1136,43 +1125,41 @@
         ...     k = (edges[:, 0] == min_edges[0]) | (edges[:, 1] == max_edges[1])
         ...     poly = node + np.c_[np.r_[0, 1, 1, 0], np.r_[0, 0, 1, 1], np.r_[0, 0, 0, 0]]
         ...     ds = [0.07, -0.09, -0.07]
         >>> edge_tan[k, :] *= -1
 
         Plot the curve and its mapping for a single face.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(10, 15))
-            >>> ax1 = fig.add_axes([0, 0.35, 1, 0.6], projection='3d', elev=25, azim=-60)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.plot(
-            ...     mesh.edges[edge_ind, 0], mesh.edges[edge_ind, 1], mesh.edges[edge_ind, 2],
-            ...     "go", markersize=10
-            ... )
-            >>> ax1.plot(
-            ...     mesh.faces[face_ind, 0], mesh.faces[face_ind, 1], mesh.faces[face_ind, 2],
-            ...     "rs", markersize=10
-            ... )
-            >>> poly = mp3d.art3d.Poly3DCollection(
-            ...     [poly], alpha=0.1, facecolor='r', linewidth=None
-            ... )
-            >>> ax1.add_collection(poly)
-            >>> ax1.quiver(
-            ...     edges[:, 0], edges[:, 1], edges[:, 2],
-            ...     0.5*edge_tan[:, 0], 0.5*edge_tan[:, 1], 0.5*edge_tan[:, 2],
-            ...     edgecolor='g', pivot='middle', linewidth=4, arrow_length_ratio=0.25
-            ... )
-            >>> ax1.text(face[0]+ds[0], face[1]+ds[1], face[2]+ds[2], "{0:d}".format(face_ind), color="r")
-            >>> for ii, loc in zip(range(len(edge_ind)), edges):
-            ...     ax1.text(loc[0]+ds[0], loc[1]+ds[1], loc[2]+ds[2], "{0:d}".format(edge_ind[ii]), color="g")
-            >>> ax1.legend(
-            ...     ['Mesh', r'$\mathbf{u}$ (edges)', r'$\mathbf{w}$ (face)'],
-            ...     loc='upper right', fontsize=14
-            ... )
+        >>> fig = plt.figure(figsize=(10, 15))
+        >>> ax1 = fig.add_axes([0, 0.35, 1, 0.6], projection='3d', elev=25, azim=-60)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.plot(
+        ...     mesh.edges[edge_ind, 0], mesh.edges[edge_ind, 1], mesh.edges[edge_ind, 2],
+        ...     "go", markersize=10
+        ... )
+        >>> ax1.plot(
+        ...     mesh.faces[face_ind, 0], mesh.faces[face_ind, 1], mesh.faces[face_ind, 2],
+        ...     "rs", markersize=10
+        ... )
+        >>> poly = mp3d.art3d.Poly3DCollection(
+        ...     [poly], alpha=0.1, facecolor='r', linewidth=None
+        ... )
+        >>> ax1.add_collection(poly)
+        >>> ax1.quiver(
+        ...     edges[:, 0], edges[:, 1], edges[:, 2],
+        ...     0.5*edge_tan[:, 0], 0.5*edge_tan[:, 1], 0.5*edge_tan[:, 2],
+        ...     edgecolor='g', pivot='middle', linewidth=4, arrow_length_ratio=0.25
+        ... )
+        >>> ax1.text(face[0]+ds[0], face[1]+ds[1], face[2]+ds[2], "{0:d}".format(face_ind), color="r")
+        >>> for ii, loc in zip(range(len(edge_ind)), edges):
+        ...     ax1.text(loc[0]+ds[0], loc[1]+ds[1], loc[2]+ds[2], "{0:d}".format(edge_ind[ii]), color="g")
+        >>> ax1.legend(
+        ...     ['Mesh', r'$\mathbf{u}$ (edges)', r'$\mathbf{w}$ (face)'],
+        ...     loc='upper right', fontsize=14
+        ... )
 
             Manually make axis properties invisible
 
             >>> ax1.set_xticks([])
             >>> ax1.set_yticks([])
             >>> ax1.set_zticks([])
             >>> ax1.w_xaxis.set_pane_color((1.0, 1.0, 1.0, 0.0))
@@ -1469,76 +1456,72 @@
         >>> mesh.set_cell_gradient_BC(['neumann', 'neumann'])
         >>> G = mesh.stencil_cell_gradient
         >>> diff_phi = G @ phi
 
         Now we plot the original scalar, and the differencing taken along the
         x and y axes.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(15, 4.5))
-            >>> ax1 = fig.add_subplot(131)
-            >>> mesh.plot_image(phi, ax=ax1)
-            >>> ax1.set_title("Scalar at cell centers", fontsize=14)
-
-            >>> ax2 = fig.add_subplot(132)
-            >>> mesh.plot_image(diff_phi, ax=ax2, v_type="Fx")
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Difference (x-axis)", fontsize=14)
-
-            >>> ax3 = fig.add_subplot(133)
-            >>> mesh.plot_image(diff_phi, ax=ax3, v_type="Fy")
-            >>> ax3.set_yticks([])
-            >>> ax3.set_ylabel("")
-            >>> ax3.set_title("Difference (y-axis)", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(15, 4.5))
+        >>> ax1 = fig.add_subplot(131)
+        >>> mesh.plot_image(phi, ax=ax1)
+        >>> ax1.set_title("Scalar at cell centers", fontsize=14)
+
+        >>> ax2 = fig.add_subplot(132)
+        >>> mesh.plot_image(diff_phi, ax=ax2, v_type="Fx")
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Difference (x-axis)", fontsize=14)
+
+        >>> ax3 = fig.add_subplot(133)
+        >>> mesh.plot_image(diff_phi, ax=ax3, v_type="Fy")
+        >>> ax3.set_yticks([])
+        >>> ax3.set_ylabel("")
+        >>> ax3.set_title("Difference (y-axis)", fontsize=14)
+        >>> plt.show()
 
         The cell gradient stencil is a sparse differencing matrix that maps
         from cell centers to faces. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements
         and a spy plot.
 
         >>> mesh = TensorMesh([[(1, 3)], [(1, 6)]])
         >>> mesh.set_cell_gradient_BC('neumann')
 
-        .. collapse:: Expand to show scripting for plot
+        >>> fig = plt.figure(figsize=(12, 10))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.set_title("Mapping of Stencil", fontsize=14, pad=15)
+        >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.plot(mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
+        >>> ax1.plot(mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format((ii + mesh.nFx)), color="g")
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.legend(
+        ...     ['Mesh', r'$\mathbf{\phi}$ (centers)', r'$\mathbf{G^\ast \phi}$ (faces)'],
+        ...     loc='upper right', fontsize=14
+        ... )
 
-            >>> fig = plt.figure(figsize=(12, 10))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.set_title("Mapping of Stencil", fontsize=14, pad=15)
-            >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
-            >>> ax1.plot(mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
-            >>> ax1.plot(mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format((ii + mesh.nFx)), color="g")
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.legend(
-            ...     ['Mesh', r'$\mathbf{\phi}$ (centers)', r'$\mathbf{G^\ast \phi}$ (faces)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-
-            >>> ax2 = fig.add_subplot(122)
-            >>> ax2.spy(mesh.stencil_cell_gradient)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("Face Index", fontsize=12)
-            >>> ax2.set_xlabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> ax2 = fig.add_subplot(122)
+        >>> ax2.spy(mesh.stencil_cell_gradient)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("Face Index", fontsize=12)
+        >>> ax2.set_xlabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"stencil_cell_gradient not implemented for {type(self)}"
         )
 
     # Inner Products
     def get_face_inner_product(
@@ -1660,30 +1643,28 @@
         ...     [sig1, sig4, sig5],
         ...     [sig4, sig2, sig6],
         ...     [sig5, sig6, sig3]
         ... ])
 
         Then plot matrix entries,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(15, 5))
-            >>> ax1 = fig.add_subplot(131)
-            >>> ax1.imshow(sig_iso_tensor)
-            >>> ax1.axis('off')
-            >>> ax1.set_title("Tensor (isotropic)", fontsize=16)
-            >>> ax2 = fig.add_subplot(132)
-            >>> ax2.imshow(sig_diag_tensor)
-            >>> ax2.axis('off')
-            >>> ax2.set_title("Tensor (diagonal anisotropic)", fontsize=16)
-            >>> ax3 = fig.add_subplot(133)
-            >>> ax3.imshow(sig_full_tensor)
-            >>> ax3.axis('off')
-            >>> ax3.set_title("Tensor (full anisotropic)", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(15, 5))
+        >>> ax1 = fig.add_subplot(131)
+        >>> ax1.imshow(sig_iso_tensor)
+        >>> ax1.axis('off')
+        >>> ax1.set_title("Tensor (isotropic)", fontsize=16)
+        >>> ax2 = fig.add_subplot(132)
+        >>> ax2.imshow(sig_diag_tensor)
+        >>> ax2.axis('off')
+        >>> ax2.set_title("Tensor (diagonal anisotropic)", fontsize=16)
+        >>> ax3 = fig.add_subplot(133)
+        >>> ax3.imshow(sig_full_tensor)
+        >>> ax3.axis('off')
+        >>> ax3.set_title("Tensor (full anisotropic)", fontsize=16)
+        >>> plt.show()
 
         Here, construct and image the face inner product matrices for
         the isotropic, diagonal anisotropic and full tensor cases.
         Spy plots are used to demonstrate the sparsity of the inner
         product matrices.
 
         Isotropic case:
@@ -1700,27 +1681,25 @@
         Full anisotropic case:
 
         >>> sig = np.tile(np.c_[sig1, sig2, sig3, sig4, sig5, sig6], (mesh.nC, 1))
         >>> M3 = mesh.get_face_inner_product(sig)
 
         And then we can plot the sparse representation,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(12, 4))
-            >>> ax1 = fig.add_subplot(131)
-            >>> ax1.spy(M1, ms=5)
-            >>> ax1.set_title("M (isotropic)", fontsize=16)
-            >>> ax2 = fig.add_subplot(132)
-            >>> ax2.spy(M2, ms=5)
-            >>> ax2.set_title("M (diagonal anisotropic)", fontsize=16)
-            >>> ax3 = fig.add_subplot(133)
-            >>> ax3.spy(M3, ms=5)
-            >>> ax3.set_title("M (full anisotropic)", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(12, 4))
+        >>> ax1 = fig.add_subplot(131)
+        >>> ax1.spy(M1, ms=5)
+        >>> ax1.set_title("M (isotropic)", fontsize=16)
+        >>> ax2 = fig.add_subplot(132)
+        >>> ax2.spy(M2, ms=5)
+        >>> ax2.set_title("M (diagonal anisotropic)", fontsize=16)
+        >>> ax3 = fig.add_subplot(133)
+        >>> ax3.spy(M3, ms=5)
+        >>> ax3.set_title("M (full anisotropic)", fontsize=16)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"get_face_inner_product not implemented for {type(self)}"
         )
 
     def get_edge_inner_product(
         self,
@@ -1842,30 +1821,28 @@
         ...     [sig1, sig4, sig5],
         ...     [sig4, sig2, sig6],
         ...     [sig5, sig6, sig3]
         ... ])
 
         Then plot the matrix entries,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(15, 5))
-            >>> ax1 = fig.add_subplot(131)
-            >>> ax1.imshow(sig_iso_tensor)
-            >>> ax1.axis('off')
-            >>> ax1.set_title("Tensor (isotropic)", fontsize=16)
-            >>> ax2 = fig.add_subplot(132)
-            >>> ax2.imshow(sig_diag_tensor)
-            >>> ax2.axis('off')
-            >>> ax2.set_title("Tensor (diagonal anisotropic)", fontsize=16)
-            >>> ax3 = fig.add_subplot(133)
-            >>> ax3.imshow(sig_full_tensor)
-            >>> ax3.axis('off')
-            >>> ax3.set_title("Tensor (full anisotropic)", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(15, 5))
+        >>> ax1 = fig.add_subplot(131)
+        >>> ax1.imshow(sig_iso_tensor)
+        >>> ax1.axis('off')
+        >>> ax1.set_title("Tensor (isotropic)", fontsize=16)
+        >>> ax2 = fig.add_subplot(132)
+        >>> ax2.imshow(sig_diag_tensor)
+        >>> ax2.axis('off')
+        >>> ax2.set_title("Tensor (diagonal anisotropic)", fontsize=16)
+        >>> ax3 = fig.add_subplot(133)
+        >>> ax3.imshow(sig_full_tensor)
+        >>> ax3.axis('off')
+        >>> ax3.set_title("Tensor (full anisotropic)", fontsize=16)
+        >>> plt.show()
 
         Here construct and image the edge inner product matrices for
         the isotropic, diagonal anisotropic and full tensor cases.
         Spy plots are used to demonstrate the sparsity of the inner
         product matrices.
 
         Isotropic case:
@@ -1882,27 +1859,25 @@
         Full anisotropic
 
         >>> sig = np.tile(np.c_[sig1, sig2, sig3, sig4, sig5, sig6], (mesh.nC, 1))
         >>> M3 = mesh.get_edge_inner_product(sig)
 
         Then plot the sparse representation,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(12, 4))
-            >>> ax1 = fig.add_subplot(131)
-            >>> ax1.spy(M1, ms=5)
-            >>> ax1.set_title("M (isotropic)", fontsize=16)
-            >>> ax2 = fig.add_subplot(132)
-            >>> ax2.spy(M2, ms=5)
-            >>> ax2.set_title("M (diagonal anisotropic)", fontsize=16)
-            >>> ax3 = fig.add_subplot(133)
-            >>> ax3.spy(M3, ms=5)
-            >>> ax3.set_title("M (full anisotropic)", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(12, 4))
+        >>> ax1 = fig.add_subplot(131)
+        >>> ax1.spy(M1, ms=5)
+        >>> ax1.set_title("M (isotropic)", fontsize=16)
+        >>> ax2 = fig.add_subplot(132)
+        >>> ax2.spy(M2, ms=5)
+        >>> ax2.set_title("M (diagonal anisotropic)", fontsize=16)
+        >>> ax3 = fig.add_subplot(133)
+        >>> ax3.spy(M3, ms=5)
+        >>> ax3.set_title("M (full anisotropic)", fontsize=16)
+        >>> plt.show()
 
         """
         raise NotImplementedError(
             f"get_edge_inner_product not implemented for {type(self)}"
         )
 
     def get_face_inner_product_deriv(
@@ -2032,31 +2007,29 @@
         >>> u = np.random.rand(mesh.nF)  # vector of shape (n_faces)
         >>> Mf = mesh.get_face_inner_product(m)
         >>> F = mesh.get_face_inner_product_deriv(m)  # Function handle
         >>> dFdm_u = F(u)
 
         Spy plot for the inner product matrix and its derivative
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(15, 5))
-            >>> ax1 = fig.add_axes([0.05, 0.05, 0.3, 0.85])
-            >>> ax1.spy(Mf, ms=6)
-            >>> ax1.set_title("Face Inner Product Matrix (Isotropic)", fontsize=14, pad=5)
-            >>> ax1.set_xlabel("Face Index", fontsize=12)
-            >>> ax1.set_ylabel("Face Index", fontsize=12)
-            >>> ax2 = fig.add_axes([0.43, 0.05, 0.17, 0.8])
-            >>> ax2.spy(dFdm_u, ms=6)
-            >>> ax2.set_title(
-            ...     "$u^T \, \dfrac{\partial M(m)}{\partial m}$ (Isotropic)",
-            ...     fontsize=14, pad=5
-            ... )
-            >>> ax2.set_xlabel("Parameter Index", fontsize=12)
-            >>> ax2.set_ylabel("Face Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(15, 5))
+        >>> ax1 = fig.add_axes([0.05, 0.05, 0.3, 0.85])
+        >>> ax1.spy(Mf, ms=6)
+        >>> ax1.set_title("Face Inner Product Matrix (Isotropic)", fontsize=14, pad=5)
+        >>> ax1.set_xlabel("Face Index", fontsize=12)
+        >>> ax1.set_ylabel("Face Index", fontsize=12)
+        >>> ax2 = fig.add_axes([0.43, 0.05, 0.17, 0.8])
+        >>> ax2.spy(dFdm_u, ms=6)
+        >>> ax2.set_title(
+        ...     "$u^T \, \dfrac{\partial M(m)}{\partial m}$ (Isotropic)",
+        ...     fontsize=14, pad=5
+        ... )
+        >>> ax2.set_xlabel("Parameter Index", fontsize=12)
+        >>> ax2.set_ylabel("Face Index", fontsize=12)
+        >>> plt.show()
 
         For our second example, the physical properties on the mesh are fully
         anisotropic; that is, the physical properties of each cell are defined
         by a tensor with parameters :math:`\sigma_1`, :math:`\sigma_2` and :math:`\sigma_3`.
         Once again we construct the face inner product matrix and visualize it with a
         spy plot. We then use **get_face_inner_product_deriv** to construct the
         function handle :math:`\mathbf{F}(\mathbf{u})` and plot the evaluation
@@ -2066,31 +2039,29 @@
         >>> u = np.random.rand(mesh.nF)     # vector of shape (n_faces)
         >>> Mf = mesh.get_face_inner_product(m)
         >>> F = mesh.get_face_inner_product_deriv(m)  # Function handle
         >>> dFdm_u = F(u)
 
         Plot the anisotropic inner product matrix and its derivative matrix,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(15, 5))
-            >>> ax1 = fig.add_axes([0.05, 0.05, 0.3, 0.8])
-            >>> ax1.spy(Mf, ms=6)
-            >>> ax1.set_title("Face Inner Product (Full Tensor)", fontsize=14, pad=5)
-            >>> ax1.set_xlabel("Face Index", fontsize=12)
-            >>> ax1.set_ylabel("Face Index", fontsize=12)
-            >>> ax2 = fig.add_axes([0.4, 0.05, 0.45, 0.85])
-            >>> ax2.spy(dFdm_u, ms=6)
-            >>> ax2.set_title(
-            ...     "$u^T \, \dfrac{\partial M(m)}{\partial m} \;$ (Full Tensor)",
-            ...     fontsize=14, pad=5
-            ... )
-            >>> ax2.set_xlabel("Parameter Index", fontsize=12)
-            >>> ax2.set_ylabel("Face Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(15, 5))
+        >>> ax1 = fig.add_axes([0.05, 0.05, 0.3, 0.8])
+        >>> ax1.spy(Mf, ms=6)
+        >>> ax1.set_title("Face Inner Product (Full Tensor)", fontsize=14, pad=5)
+        >>> ax1.set_xlabel("Face Index", fontsize=12)
+        >>> ax1.set_ylabel("Face Index", fontsize=12)
+        >>> ax2 = fig.add_axes([0.4, 0.05, 0.45, 0.85])
+        >>> ax2.spy(dFdm_u, ms=6)
+        >>> ax2.set_title(
+        ...     "$u^T \, \dfrac{\partial M(m)}{\partial m} \;$ (Full Tensor)",
+        ...     fontsize=14, pad=5
+        ... )
+        >>> ax2.set_xlabel("Parameter Index", fontsize=12)
+        >>> ax2.set_ylabel("Face Index", fontsize=12)
+        >>> plt.show()
 
         """
         raise NotImplementedError(
             f"get_face_inner_product_deriv not implemented for {type(self)}"
         )
 
     def get_edge_inner_product_deriv(
@@ -2219,31 +2190,29 @@
         >>> u = np.random.rand(mesh.nF)  # vector of shape (n_edges)
         >>> Me = mesh.get_edge_inner_product(m)
         >>> F = mesh.get_edge_inner_product_deriv(m)  # Function handle
         >>> dFdm_u = F(u)
 
         Plot inner product matrix and its derivative matrix
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(15, 5))
-            >>> ax1 = fig.add_axes([0.05, 0.05, 0.3, 0.8])
-            >>> ax1.spy(Me, ms=6)
-            >>> ax1.set_title("Edge Inner Product Matrix (Isotropic)", fontsize=14, pad=5)
-            >>> ax1.set_xlabel("Edge Index", fontsize=12)
-            >>> ax1.set_ylabel("Edge Index", fontsize=12)
-            >>> ax2 = fig.add_axes([0.43, 0.05, 0.17, 0.8])
-            >>> ax2.spy(dFdm_u, ms=6)
-            >>> ax2.set_title(
-            ...     "$u^T \, \dfrac{\partial M(m)}{\partial m}$ (Isotropic)",
-            ...     fontsize=14, pad=5
-            ... )
-            >>> ax2.set_xlabel("Parameter Index", fontsize=12)
-            >>> ax2.set_ylabel("Edge Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(15, 5))
+        >>> ax1 = fig.add_axes([0.05, 0.05, 0.3, 0.8])
+        >>> ax1.spy(Me, ms=6)
+        >>> ax1.set_title("Edge Inner Product Matrix (Isotropic)", fontsize=14, pad=5)
+        >>> ax1.set_xlabel("Edge Index", fontsize=12)
+        >>> ax1.set_ylabel("Edge Index", fontsize=12)
+        >>> ax2 = fig.add_axes([0.43, 0.05, 0.17, 0.8])
+        >>> ax2.spy(dFdm_u, ms=6)
+        >>> ax2.set_title(
+        ...     "$u^T \, \dfrac{\partial M(m)}{\partial m}$ (Isotropic)",
+        ...     fontsize=14, pad=5
+        ... )
+        >>> ax2.set_xlabel("Parameter Index", fontsize=12)
+        >>> ax2.set_ylabel("Edge Index", fontsize=12)
+        >>> plt.show()
 
         For our second example, the physical properties on the mesh are fully
         anisotropic; that is, the physical properties of each cell are defined
         by a tensor with parameters :math:`\sigma_1`, :math:`\sigma_2` and :math:`\sigma_3`.
         Once again we construct the edge inner product matrix and visualize it with a
         spy plot. We then use **get_edge_inner_product_deriv** to construct the
         function handle :math:`\mathbf{F}(\mathbf{u})` and plot the evaluation
@@ -2253,31 +2222,29 @@
         >>> u = np.random.rand(mesh.nF)     # vector of shape (n_edges)
         >>> Me = mesh.get_edge_inner_product(m)
         >>> F = mesh.get_edge_inner_product_deriv(m)  # Function handle
         >>> dFdm_u = F(u)
 
         Plot the anisotropic inner product matrix and its derivative matrix
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(15, 5))
-            >>> ax1 = fig.add_axes([0.05, 0.05, 0.3, 0.8])
-            >>> ax1.spy(Me, ms=6)
-            >>> ax1.set_title("Edge Inner Product (Full Tensor)", fontsize=14, pad=5)
-            >>> ax1.set_xlabel("Edge Index", fontsize=12)
-            >>> ax1.set_ylabel("Edge Index", fontsize=12)
-            >>> ax2 = fig.add_axes([0.4, 0.05, 0.45, 0.8])
-            >>> ax2.spy(dFdm_u, ms=6)
-            >>> ax2.set_title(
-            ...     "$u^T \, \dfrac{\partial M(m)}{\partial m} \;$ (Full Tensor)",
-            ...     fontsize=14, pad=5
-            ... )
-            >>> ax2.set_xlabel("Parameter Index", fontsize=12)
-            >>> ax2.set_ylabel("Edge Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(15, 5))
+        >>> ax1 = fig.add_axes([0.05, 0.05, 0.3, 0.8])
+        >>> ax1.spy(Me, ms=6)
+        >>> ax1.set_title("Edge Inner Product (Full Tensor)", fontsize=14, pad=5)
+        >>> ax1.set_xlabel("Edge Index", fontsize=12)
+        >>> ax1.set_ylabel("Edge Index", fontsize=12)
+        >>> ax2 = fig.add_axes([0.4, 0.05, 0.45, 0.8])
+        >>> ax2.spy(dFdm_u, ms=6)
+        >>> ax2.set_title(
+        ...     "$u^T \, \dfrac{\partial M(m)}{\partial m} \;$ (Full Tensor)",
+        ...     fontsize=14, pad=5
+        ... )
+        >>> ax2.set_xlabel("Parameter Index", fontsize=12)
+        >>> ax2.set_ylabel("Edge Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"get_edge_inner_product_deriv not implemented for {type(self)}"
         )
 
     # Averaging
     @property
@@ -2339,36 +2306,32 @@
         the discrete scalar quantity to approximate the value at cell centers.
 
         >>> Afc = mesh.average_face_to_cell
         >>> phi_c = Afc @ phi_f
 
         And finally plot the results:
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi_f, ax=ax1, v_type="F")
-            >>> ax1.set_title("Variable at faces", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi_f, ax=ax1, v_type="F")
+        >>> ax1.set_title("Variable at faces", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Afc, ms=1)
-            >>> ax1.set_title("Face Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Afc, ms=1)
+        >>> ax1.set_title("Face Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_face_to_cell not implemented for {type(self)}"
         )
 
     @property
     def average_face_to_cell_vector(self):
@@ -2444,36 +2407,32 @@
         the discrete vector quantity to approximate the value at cell centers.
 
         >>> Afc = mesh.average_face_to_cell_vector
         >>> u_c = Afc @ u_f
 
         And finally, plot the results:
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(u_f, ax=ax1, v_type="F", view='vec')
-            >>> ax1.set_title("Variable at faces", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(u_c, ax=ax2, v_type="CCv", view='vec')
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(u_f, ax=ax1, v_type="F", view='vec')
+        >>> ax1.set_title("Variable at faces", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(u_c, ax=ax2, v_type="CCv", view='vec')
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Afc, ms=1)
-            >>> ax1.set_title("Face Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Vector Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Afc, ms=1)
+        >>> ax1.set_title("Face Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Vector Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_face_to_cell_vector not implemented for {type(self)}"
         )
 
     @property
     def average_cell_to_face(self):
@@ -2542,36 +2501,32 @@
         the discrete scalar quantity to approximate the value at the faces.
 
         >>> Acf = mesh.average_cell_to_face
         >>> phi_f = Acf @ phi_c
 
         Plot the results
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi_c, ax=ax1, v_type="CC")
-            >>> ax1.set_title("Variable at cell centers", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_f, ax=ax2, v_type="F")
-            >>> ax2.set_title("Averaged to faces", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi_c, ax=ax1, v_type="CC")
+        >>> ax1.set_title("Variable at cell centers", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_f, ax=ax2, v_type="F")
+        >>> ax2.set_title("Averaged to faces", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Acf, ms=1)
-            >>> ax1.set_title("Cell Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Face Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Acf, ms=1)
+        >>> ax1.set_title("Cell Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Face Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_cell_to_face not implemented for {type(self)}"
         )
 
     @property
     def average_cell_vector_to_face(self):
@@ -2652,36 +2607,32 @@
         the discrete vector quantity to approximate the value on the faces.
 
         >>> Acf = mesh.average_cell_vector_to_face
         >>> u_f = Acf @ u_c
 
         And plot the results
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(u_c, ax=ax1, v_type="CCv", view='vec')
-            >>> ax1.set_title("Variable at faces", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(u_f, ax=ax2, v_type="F", view='vec')
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(u_c, ax=ax1, v_type="CCv", view='vec')
+        >>> ax1.set_title("Variable at faces", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(u_f, ax=ax2, v_type="F", view='vec')
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Acf, ms=1)
-            >>> ax1.set_title("Cell Vector Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Face Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Acf, ms=1)
+        >>> ax1.set_title("Cell Vector Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Face Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_cell_vector_to_face not implemented for {type(self)}"
         )
 
     @property
     def average_cell_to_edge(self):
@@ -2749,36 +2700,32 @@
         the discrete scalar quantity to approximate the value at the edges.
 
         >>> Ace = mesh.average_cell_to_edge
         >>> phi_e = Ace @ phi_c
 
         And plot the results:
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi_c, ax=ax1, v_type="CC")
-            >>> ax1.set_title("Variable at cell centers", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_e, ax=ax2, v_type="E")
-            >>> ax2.set_title("Averaged to edges", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi_c, ax=ax1, v_type="CC")
+        >>> ax1.set_title("Variable at cell centers", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_e, ax=ax2, v_type="E")
+        >>> ax2.set_title("Averaged to edges", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Ace, ms=1)
-            >>> ax1.set_title("Cell Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Edge Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Ace, ms=1)
+        >>> ax1.set_title("Cell Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Edge Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_cell_to_edge not implemented for {type(self)}"
         )
 
     @property
     def average_edge_to_cell(self):
@@ -2838,36 +2785,32 @@
         the discrete scalar quantity to approximate the value at cell centers.
 
         >>> Aec = mesh.average_edge_to_cell
         >>> phi_c = Aec @ phi_e
 
         And plot the results:
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi_e, ax=ax1, v_type="E")
-            >>> ax1.set_title("Variable at edges", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi_e, ax=ax1, v_type="E")
+        >>> ax1.set_title("Variable at edges", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Aec, ms=1)
-            >>> ax1.set_title("Edge Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Aec, ms=1)
+        >>> ax1.set_title("Edge Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_edge_to_cell not implemented for {type(self)}"
         )
 
     @property
     def average_edge_to_cell_vector(self):
@@ -2942,75 +2885,66 @@
         the discrete vector quantity to approximate the value at cell centers.
 
         >>> Aec = mesh.average_edge_to_cell_vector
         >>> u_c = Aec @ u_e
 
         And plot the results:
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(u_e, ax=ax1, v_type="E", view='vec')
-            >>> ax1.set_title("Variable at edges", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(u_c, ax=ax2, v_type="CCv", view='vec')
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(u_e, ax=ax1, v_type="E", view='vec')
+        >>> ax1.set_title("Variable at edges", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(u_c, ax=ax2, v_type="CCv", view='vec')
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Aec, ms=1)
-            >>> ax1.set_title("Edge Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Vector Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Aec, ms=1)
+        >>> ax1.set_title("Edge Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Vector Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_edge_to_cell_vector not implemented for {type(self)}"
         )
 
     @property
-    def average_edge_to_face_vector(self):
-        r"""Averaging operator from edges to faces (vector quantities).
+    def average_edge_to_face(self):
+        r"""Averaging operator from edges to faces.
 
-        This property constructs the averaging operator that independently maps the
-        Cartesian components of vector quantities from edges to faces.
-        This averaging operators is used when a discrete vector quantity defined on mesh edges
+        This property constructs the averaging operator that maps uantities from edges to faces.
+        This averaging operators is used when a discrete quantity defined on mesh edges
         must be approximated at faces. The operation is implemented as a
         matrix vector product, i.e.::
 
             u_f = Aef @ u_e
 
         Once constructed, the operator is stored permanently as a property of the mesh.
 
         Returns
         -------
         (n_faces, n_edges) scipy.sparse.csr_matrix
-            The vector averaging operator from edges to faces.
+            The averaging operator from edges to faces.
 
         Notes
         -----
-        Let :math:`\mathbf{u_e}` be the discrete representation of a vector
-        quantity whose Cartesian components are defined on their respective edges;
-        e.g. the x-component is defined on x-edges. **average_edge_to_face_vector**
+        Let :math:`\mathbf{u_e}` be the discrete representation of aquantity whose
+        that is defined on the edges. **average_edge_to_face**
         constructs a discrete linear operator :math:`\mathbf{A_{ef}}` that
-        projects each Cartesian component of :math:`\mathbf{u_e}` to
-        its corresponding face, i.e.:
+        projects :math:`\mathbf{u_e}` to its corresponding face, i.e.:
 
         .. math::
             \mathbf{u_f} = \mathbf{A_{ef}} \, \mathbf{u_e}
 
-        where :math:`\mathbf{u_f}` is a discrete vector quantity whose Cartesian
-        components are defined on their respective faces; e.g. the x-component is
-        defined on x-faces.
+        where :math:`\mathbf{u_f}` is a quantity defined on the respective faces.
 
         Examples
         --------
         Here we compute the values of a vector function discretized to the edges.
         We then create an averaging operator to approximate the function on
         the faces.
 
@@ -3020,57 +2954,54 @@
         >>> import numpy as np
         >>> import matplotlib.pyplot as plt
         >>> h = 0.5 * np.ones(40)
         >>> mesh = TensorMesh([h, h], x0="CC")
 
         Create a discrete vector on mesh edges
 
-        >>> edges_x = mesh.edges_x
-        >>> edges_y = mesh.edges_y
-        >>> u_ex = -(edges_x[:, 1] / np.sqrt(np.sum(edges_x ** 2, axis=1))) * np.exp(
-        ...     -(edges_x[:, 0] ** 2 + edges_x[:, 1] ** 2) / 6 ** 2
+        >>> edges = mesh.edges
+        >>> u_ex = -(edges[:, 1] / np.sqrt(np.sum(edges ** 2, axis=1))) * np.exp(
+        ...     -(edges[:, 0] ** 2 + edges[:, 1] ** 2) / 6 ** 2
         ... )
-        >>> u_ey = (edges_y[:, 0] / np.sqrt(np.sum(edges_y ** 2, axis=1))) * np.exp(
-        ...     -(edges_y[:, 0] ** 2 + edges_y[:, 1] ** 2) / 6 ** 2
+        >>> u_ey = (edges[:, 0] / np.sqrt(np.sum(edges ** 2, axis=1))) * np.exp(
+        ...     -(edges[:, 0] ** 2 + edges[:, 1] ** 2) / 6 ** 2
         ... )
-        >>> u_e = np.r_[u_ex, u_ey]
+        >>> u_e = np.c_[u_ex, u_ey]
 
         Next, we construct the averaging operator and apply it to
         the discrete vector quantity to approximate the value at the faces.
 
-        >>> Aef = mesh.average_edge_to_face_vector
+        >>> Aef = mesh.average_edge_to_face
         >>> u_f = Aef @ u_e
 
         Plot the results,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(u_e, ax=ax1, v_type="E", view='vec')
-            >>> ax1.set_title("Variable at edges", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(u_f, ax=ax2, v_type="F", view='vec')
-            >>> ax2.set_title("Averaged to faces", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> proj_ue = mesh.project_edge_vector(u_e)
+        >>> mesh.plot_image(proj_ue, ax=ax1, v_type="E", view='vec')
+        >>> ax1.set_title("Variable at edges", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> proj_uf = mesh.project_face_vector(u_f)
+        >>> mesh.plot_image(proj_uf, ax=ax2, v_type="F", view='vec')
+        >>> ax2.set_title("Averaged to faces", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Aef, ms=1)
-            >>> ax1.set_title("Edge Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Face Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Aef, ms=1)
+        >>> ax1.set_title("Edge Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Face Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
-            f"average_edge_to_face_vector not implemented for {type(self)}"
+            f"average_edge_to_face not implemented for {type(self)}"
         )
 
     @property
     def average_node_to_cell(self):
         r"""Averaging operator from nodes to cell centers (scalar quantities).
 
         This property constructs a 2nd order averaging operator that maps scalar
@@ -3127,36 +3058,32 @@
         the discrete scalar quantity to approximate the value at cell centers.
 
         >>> Anc = mesh.average_node_to_cell
         >>> phi_c = Anc @ phi_n
 
         Plot the results,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi_n, ax=ax1, v_type="N")
-            >>> ax1.set_title("Variable at nodes", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi_n, ax=ax1, v_type="N")
+        >>> ax1.set_title("Variable at nodes", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Anc, ms=1)
-            >>> ax1.set_title("Node Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Anc, ms=1)
+        >>> ax1.set_title("Node Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_node_to_cell not implemented for {type(self)}"
         )
 
     @property
     def average_node_to_edge(self):
@@ -3217,36 +3144,32 @@
         the discrete scalar quantity to approximate the value on the edges.
 
         >>> Ane = mesh.average_node_to_edge
         >>> phi_e = Ane @ phi_n
 
         Plot the results,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi_n, ax=ax1, v_type="N")
-            >>> ax1.set_title("Variable at nodes")
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_e, ax=ax2, v_type="E")
-            >>> ax2.set_title("Averaged to edges")
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi_n, ax=ax1, v_type="N")
+        >>> ax1.set_title("Variable at nodes")
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_e, ax=ax2, v_type="E")
+        >>> ax2.set_title("Averaged to edges")
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Ane, ms=1)
-            >>> ax1.set_title("Node Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Edge Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Ane, ms=1)
+        >>> ax1.set_title("Node Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Edge Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_node_to_edge not implemented for {type(self)}"
         )
 
     @property
     def average_node_to_face(self):
@@ -3307,36 +3230,32 @@
         the discrete scalar quantity to approximate the value on the faces.
 
         >>> Anf = mesh.average_node_to_face
         >>> phi_f = Anf @ phi_n
 
         Plot the results,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi_n, ax=ax1, v_type="N")
-            >>> ax1.set_title("Variable at nodes")
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_f, ax=ax2, v_type="F")
-            >>> ax2.set_title("Averaged to faces")
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi_n, ax=ax1, v_type="N")
+        >>> ax1.set_title("Variable at nodes")
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_f, ax=ax2, v_type="F")
+        >>> ax2.set_title("Averaged to faces")
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Anf, ms=1)
-            >>> ax1.set_title("Node Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Face Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Anf, ms=1)
+        >>> ax1.set_title("Node Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Face Index", fontsize=12)
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"average_node_to_face not implemented for {type(self)}"
         )
 
     @property
     def project_face_to_boundary_face(self):
@@ -3539,22 +3458,20 @@
         >>> dense = np.linspace(0, 1, 200)
         >>> fun = lambda x: np.cos(2*np.pi*x)
 
         >>> hx = 0.125 * np.ones(8)
         >>> mesh1D = TensorMesh([hx])
         >>> Q = mesh1D.get_interpolation_matrix(locs, 'nodes')
 
-        .. collapse:: Expand to see scripting for plot
-
-            >>> plt.figure(figsize=(5, 3))
-            >>> plt.plot(dense, fun(dense), ':', c="C0", lw=3, label="True Function")
-            >>> plt.plot(mesh1D.nodes, fun(mesh1D.nodes), 's', c="C0", ms=8, label="True sampled")
-            >>> plt.plot(locs, Q*fun(mesh1D.nodes), 'o', ms=4, label="Interpolated")
-            >>> plt.legend()
-            >>> plt.show()
+        >>> plt.figure(figsize=(5, 3))
+        >>> plt.plot(dense, fun(dense), ':', c="C0", lw=3, label="True Function")
+        >>> plt.plot(mesh1D.nodes, fun(mesh1D.nodes), 's', c="C0", ms=8, label="True sampled")
+        >>> plt.plot(locs, Q*fun(mesh1D.nodes), 'o', ms=4, label="Interpolated")
+        >>> plt.legend()
+        >>> plt.show()
 
         Here, demonstrate a similar example on a 2D mesh using a 2D Gaussian distribution.
         We interpolate the Gaussian from the nodes to cell centers and examine the relative
         error.
 
         >>> hx = np.ones(10)
         >>> hy = np.ones(10)
@@ -3565,28 +3482,26 @@
         >>> nodes = mesh2D.nodes
         >>> val_nodes = fun(nodes[:, 0], nodes[:, 1])
         >>> centers = mesh2D.cell_centers
         >>> val_centers = fun(centers[:, 0], centers[:, 1])
         >>> A = mesh2D.get_interpolation_matrix(centers, 'nodes')
         >>> val_interp = A.dot(val_nodes)
 
-        .. collapse:: Expand to see scripting for plot
-
-            >>> fig = plt.figure(figsize=(11,3.3))
-            >>> clim = (0., 1.)
-            >>> ax1 = fig.add_subplot(131)
-            >>> ax2 = fig.add_subplot(132)
-            >>> ax3 = fig.add_subplot(133)
-            >>> mesh2D.plot_image(val_centers, ax=ax1, clim=clim)
-            >>> mesh2D.plot_image(val_interp, ax=ax2, clim=clim)
-            >>> mesh2D.plot_image(val_centers-val_interp, ax=ax3, clim=clim)
-            >>> ax1.set_title('Analytic at Centers')
-            >>> ax2.set_title('Interpolated from Nodes')
-            >>> ax3.set_title('Relative Error')
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11,3.3))
+        >>> clim = (0., 1.)
+        >>> ax1 = fig.add_subplot(131)
+        >>> ax2 = fig.add_subplot(132)
+        >>> ax3 = fig.add_subplot(133)
+        >>> mesh2D.plot_image(val_centers, ax=ax1, clim=clim)
+        >>> mesh2D.plot_image(val_interp, ax=ax2, clim=clim)
+        >>> mesh2D.plot_image(val_centers-val_interp, ax=ax3, clim=clim)
+        >>> ax1.set_title('Analytic at Centers')
+        >>> ax2.set_title('Interpolated from Nodes')
+        >>> ax3.set_title('Relative Error')
+        >>> plt.show()
         """
         raise NotImplementedError(
             f"get_interpolation_matrix not implemented for {type(self)}"
         )
 
     def _parse_location_type(self, location_type):
         if len(location_type) == 0:
@@ -3609,75 +3524,71 @@
             else:
                 return "cell_centers"
         else:
             return location_type
 
     # DEPRECATED
     normals = deprecate_property(
-        "face_normals", "normals", removal_version="1.0.0", future_warn=True
+        "face_normals", "normals", removal_version="1.0.0", error=True
     )
     tangents = deprecate_property(
-        "edge_tangents", "tangents", removal_version="1.0.0", future_warn=True
+        "edge_tangents", "tangents", removal_version="1.0.0", error=True
     )
     projectEdgeVector = deprecate_method(
         "project_edge_vector",
         "projectEdgeVector",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     projectFaceVector = deprecate_method(
         "project_face_vector",
         "projectFaceVector",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     getInterpolationMat = deprecate_method(
         "get_interpolation_matrix",
         "getInterpolationMat",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     nodalGrad = deprecate_property(
-        "nodal_gradient", "nodalGrad", removal_version="1.0.0", future_warn=True
+        "nodal_gradient", "nodalGrad", removal_version="1.0.0", error=True
     )
     nodalLaplacian = deprecate_property(
-        "nodal_laplacian", "nodalLaplacian", removal_version="1.0.0", future_warn=True
+        "nodal_laplacian", "nodalLaplacian", removal_version="1.0.0", error=True
     )
     faceDiv = deprecate_property(
-        "face_divergence", "faceDiv", removal_version="1.0.0", future_warn=True
+        "face_divergence", "faceDiv", removal_version="1.0.0", error=True
     )
     edgeCurl = deprecate_property(
-        "edge_curl", "edgeCurl", removal_version="1.0.0", future_warn=True
+        "edge_curl", "edgeCurl", removal_version="1.0.0", error=True
     )
     getFaceInnerProduct = deprecate_method(
         "get_face_inner_product",
         "getFaceInnerProduct",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     getEdgeInnerProduct = deprecate_method(
         "get_edge_inner_product",
         "getEdgeInnerProduct",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     getFaceInnerProductDeriv = deprecate_method(
         "get_face_inner_product_deriv",
         "getFaceInnerProductDeriv",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     getEdgeInnerProductDeriv = deprecate_method(
         "get_edge_inner_product_deriv",
         "getEdgeInnerProductDeriv",
         removal_version="1.0.0",
-        future_warn=True,
-    )
-    vol = deprecate_property(
-        "cell_volumes", "vol", removal_version="1.0.0", future_warn=True
-    )
-    area = deprecate_property(
-        "face_areas", "area", removal_version="1.0.0", future_warn=True
+        error=True,
     )
+    vol = deprecate_property("cell_volumes", "vol", removal_version="1.0.0", error=True)
+    area = deprecate_property("face_areas", "area", removal_version="1.0.0", error=True)
     edge = deprecate_property(
-        "edge_lengths", "edge", removal_version="1.0.0", future_warn=True
+        "edge_lengths", "edge", removal_version="1.0.0", error=True
     )
```

### Comparing `discretize-0.8.3/discretize/base/base_regular_mesh.py` & `discretize-0.9.0/discretize/base/base_regular_mesh.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,14 +1,13 @@
 """Base classes for all regular shaped meshes supported in ``discretize``."""
 
 import numpy as np
 from discretize.utils import mkvc, Identity
 from discretize.base.base_mesh import BaseMesh
 from discretize.utils.code_utils import deprecate_method
-import warnings
 
 
 class BaseRegularMesh(BaseMesh):
     """Base Regular mesh class for the ``discretize`` package.
 
     The ``BaseRegularMesh`` class does all the basic counting and organizing
     you wouldn't want to do manually. ``BaseRegularMesh`` is a class that should
@@ -521,82 +520,65 @@
     def axis_u(self):
         """Orientation of the first axis.
 
         .. deprecated:: 0.7.0
           `axis_u` will be removed in discretize 1.0.0. This functionality was replaced
           by the :py:attr:`~.BaseRegularMesh.orientation`.
         """
-        warnings.warn(
-            "The axis_u property is deprecated, please access as self.orientation[0]. "
-            "This will be removed in discretize 1.0.0.",
-            FutureWarning,
+        raise NotImplementedError(
+            "The axis_u property is rmoved, please access as self.orientation[0]. "
+            "This will be removed in discretize 1.0.0."
         )
-        return self.orientation[0]
 
     @axis_u.setter
     def axis_u(self, value):
-        warnings.warn(
-            "Setting the axis_u property is deprecated, and now unchecked, please "
-            "directly set the self.orientation property. This will be removed in "
-            "discretize 1.0.0.",
-            FutureWarning,
+        raise NotImplementedError(
+            "The axis_u property is removed, please access as self.orientation[0]. "
+            "This will be removed in discretize 1.0.0."
         )
-        self.orientation[0] = value
 
     @property
     def axis_v(self):
         """Orientation of the second axis.
 
         .. deprecated:: 0.7.0
           `axis_v` will be removed in discretize 1.0.0. This functionality was replaced
           by the :py:attr:`~.BaseRegularMesh.orientation`.
         """
-        warnings.warn(
-            "The axis_v property is deprecated, please access as self.orientation[1]. "
-            "This will be removed in discretize 1.0.0.",
-            FutureWarning,
+        raise NotImplementedError(
+            "The axis_v property is removed, please access as self.orientation[1]. "
+            "This will be removed in discretize 1.0.0."
         )
-        return self.orientation[1]
 
     @axis_v.setter
     def axis_v(self, value):
-        warnings.warn(
-            "Setting the axis_v property is deprecated, and now unchecked, please "
-            "directly set the self.orientation property. This will be removed in "
-            "discretize 1.0.0.",
-            FutureWarning,
+        raise NotImplementedError(
+            "The axis_v property is removed, please access as self.orientation[1]. "
+            "This will be removed in discretize 1.0.0."
         )
-        value = value / np.linalg.norm(value)
-        self.orientation[1] = value
 
     @property
     def axis_w(self):
         """Orientation of the third axis.
 
         .. deprecated:: 0.7.0
           `axis_w` will be removed in discretize 1.0.0. This functionality was replaced
           by the :py:attr:`~.BaseRegularMesh.orientation`.
         """
-        warnings.warn(
-            "The axis_w property is deprecated, please access as self.orientation[2]. "
-            "This will be removed in discretize 1.0.0.",
-            FutureWarning,
+        raise NotImplementedError(
+            "The axis_w property is removed, please access as self.orientation[2]. "
+            "This will be removed in discretize 1.0.0."
         )
-        return self.orientation[2]
 
     @axis_w.setter
     def axis_w(self, value):
-        warnings.warn(
-            "Setting the axis_v property is deprecated, and now unchecked, please "
-            "directly set the self.orientation property. This will be removed in "
-            "discretize 1.0.0.",
-            FutureWarning,
+        raise NotImplementedError(
+            "The axis_w property is removed, please access as self.orientation[2]. "
+            "This will be removed in discretize 1.0.0."
         )
-        value = value / np.linalg.norm(value)
-        self.orientation[2] = value
 
 
 class BaseRectangularMesh(BaseRegularMesh):
     """Base rectangular mesh class for the ``discretize`` package.
 
     The ``BaseRectangularMesh`` class acts as an extension of the
     :class:`~discretize.base.BaseRegularMesh` classes with a regular structure.
@@ -864,32 +846,28 @@
             The dimensions of quantity being returned
 
             - *V:* return a vector (1D array) or a list of vectors
             - *M:* return matrix (nD array) or a list of matrices
 
         """
         if "xType" in kwargs:
-            warnings.warn(
-                "The xType keyword argument has been deprecated, please use x_type. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The xType keyword argument has been removed, please use x_type. "
+                "This will be removed in discretize 1.0.0"
             )
             x_type = kwargs["xType"]
         if "outType" in kwargs:
-            warnings.warn(
-                "The outType keyword argument has been deprecated, please use out_type. "
+            raise TypeError(
+                "The outType keyword argument has been removed, please use out_type. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            out_type = kwargs["outType"]
         if "format" in kwargs:
-            warnings.warn(
-                "The format keyword argument has been deprecated, please use return_format. "
+            raise TypeError(
+                "The format keyword argument has been removed, please use return_format. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
             return_format = kwargs["format"]
 
         x_type = self._parse_location_type(x_type)
         out_type = self._parse_location_type(out_type)
 
         allowed_x_type = [
@@ -901,45 +879,45 @@
             "faces_z",
             "edges",
             "edges_x",
             "edges_y",
             "edges_z",
         ]
         if not (isinstance(x, list) or isinstance(x, np.ndarray)):
-            raise Exception("x must be either a list or a ndarray")
+            raise TypeError("x must be either a list or a ndarray")
         if x_type not in allowed_x_type:
-            raise Exception(
+            raise ValueError(
                 "x_type must be either '" + "', '".join(allowed_x_type) + "'"
             )
         if out_type not in allowed_x_type:
-            raise Exception(
+            raise ValueError(
                 "out_type must be either '" + "', '".join(allowed_x_type) + "'"
             )
         if return_format not in ["M", "V"]:
-            raise Exception("return_format must be either 'M' or 'V'")
+            raise ValueError("return_format must be either 'M' or 'V'")
         if out_type[: len(x_type)] != x_type:
-            raise Exception("You cannot change types when reshaping.")
+            raise ValueError("You cannot change types when reshaping.")
         if x_type not in out_type:
-            raise Exception("You cannot change type of components.")
+            raise ValueError("You cannot change type of components.")
 
         if isinstance(x, list):
             for i, xi in enumerate(x):
                 if not isinstance(x, np.ndarray):
-                    raise Exception("x[{0:d}] must be a numpy array".format(i))
+                    raise TypeError("x[{0:d}] must be a numpy array".format(i))
                 if xi.size != x[0].size:
-                    raise Exception("Number of elements in list must not change.")
+                    raise ValueError("Number of elements in list must not change.")
 
             x_array = np.ones((x.size, len(x)))
             # Unwrap it and put it in a np array
             for i, xi in enumerate(x):
                 x_array[:, i] = mkvc(xi)
             x = x_array
 
         if not isinstance(x, np.ndarray):
-            raise Exception("x must be a numpy array")
+            raise TypeError("x must be a numpy array")
 
         x = x[:]  # make a copy.
         x_type_is_FE_xyz = (
             len(x_type) > 1
             and x_type[0] in ["f", "e"]
             and x_type[-1] in ["x", "y", "z"]
         )
@@ -952,15 +930,15 @@
                 return mkvc(xx)
 
         def switchKernal(xx):
             """Switch over the different options."""
             if x_type in ["cell_centers", "nodes"]:
                 nn = self.shape_cells if x_type == "cell_centers" else self.shape_nodes
                 if xx.size != np.prod(nn):
-                    raise Exception("Number of elements must not change.")
+                    raise ValueError("Number of elements must not change.")
                 return outKernal(xx, nn)
             elif x_type in ["faces", "edges"]:
                 # This will only deal with components of fields,
                 # not full 'F' or 'E'
                 xx = mkvc(xx)  # unwrap it in case it is a matrix
                 if x_type == "faces":
                     nn = (self.nFx, self.nFy, self.nFz)[: self.dim]
@@ -972,45 +950,45 @@
                 nx[0] = self.shape_faces_x if x_type == "faces" else self.shape_edges_x
                 nx[1] = self.shape_faces_y if x_type == "faces" else self.shape_edges_y
                 nx[2] = self.shape_faces_z if x_type == "faces" else self.shape_edges_z
 
                 for dim, dimName in enumerate(["x", "y", "z"]):
                     if dimName in out_type:
                         if self.dim <= dim:
-                            raise Exception(
+                            raise ValueError(
                                 "Dimensions of mesh not great enough for "
                                 "{}_{}".format(x_type, dimName)
                             )
                         if xx.size != np.sum(nn):
-                            raise Exception("Vector is not the right size.")
+                            raise ValueError("Vector is not the right size.")
                         start = np.sum(nn[: dim + 1])
                         end = np.sum(nn[: dim + 2])
                         return outKernal(xx[start:end], nx[dim])
 
             elif x_type_is_FE_xyz:
                 # This will deal with partial components (x, y or z)
                 # lying on edges or faces
                 if "x" in x_type:
                     nn = self.shape_faces_x if "f" in x_type else self.shape_edges_x
                 elif "y" in x_type:
                     nn = self.shape_faces_y if "f" in x_type else self.shape_edges_y
                 elif "z" in x_type:
                     nn = self.shape_faces_z if "f" in x_type else self.shape_edges_z
                 if xx.size != np.prod(nn):
-                    raise Exception(
+                    raise ValueError(
                         f"Vector is not the right size. Expected {np.prod(nn)}, got {xx.size}"
                     )
                 return outKernal(xx, nn)
 
         # Check if we are dealing with a vector quantity
         isVectorQuantity = len(x.shape) == 2 and x.shape[1] == self.dim
 
         if out_type in ["faces", "edges"]:
             if isVectorQuantity:
-                raise Exception("Not sure what to do with a vector vector quantity..")
+                raise ValueError("Not sure what to do with a vector vector quantity..")
             outTypeCopy = out_type
             out = ()
             for dirName in ["x", "y", "z"][: self.dim]:
                 out_type = outTypeCopy + "_" + dirName
                 out += (switchKernal(x),)
             return out
         elif isVectorQuantity:
@@ -1018,128 +996,80 @@
             for ii in range(x.shape[1]):
                 out += (switchKernal(x[:, ii]),)
             return out
         else:
             return switchKernal(x)
 
     # DEPRECATED
-    r = deprecate_method("reshape", "r", removal_version="1.0.0", future_warn=True)
+    r = deprecate_method("reshape", "r", removal_version="1.0.0", error=True)
 
     @property
     def nCx(self):
         """Number of cells in the x direction.
 
-        Returns
-        -------
-        int
-
-        .. deprecated:: 0.5.0
-          `nCx` will be removed in discretize 1.0.0, it is replaced by
-          `mesh.shape_cells[0]` to reduce namespace clutter.
-        """
-        warnings.warn(
-            "nCx has been deprecated, please access as mesh.shape_cells[0]",
-            FutureWarning,
+        `nCx` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.shape_cells[0]` to reduce namespace clutter.
+        """
+        raise NotImplementedError(
+            "The nCx property is removed, please access as mesh.shape_cells[0]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        return self.shape_cells[0]
 
     @property
     def nCy(self):
         """Number of cells in the y direction.
 
-        Returns
-        -------
-        int or None
-            None if dim < 2
-
-        .. deprecated:: 0.5.0
-          `nCy` will be removed in discretize 1.0.0, it is replaced by
-          `mesh.shape_cells[1]` to reduce namespace clutter.
-        """
-        warnings.warn(
-            "nCy has been deprecated, please access as mesh.shape_cells[1]",
-            FutureWarning,
+        `nCy` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.shape_cells[1]` to reduce namespace clutter.
+        """
+        raise NotImplementedError(
+            "The nCy property is removed, please access as mesh.shape_cells[1]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        if self.dim < 2:
-            return None
-        return self.shape_cells[1]
 
     @property
     def nCz(self):
         """Number of cells in the z direction.
 
-        Returns
-        -------
-        int or None
-            None if dim < 3
-
-        .. deprecated:: 0.5.0
-          `nCz` will be removed in discretize 1.0.0, it is replaced by
-          `mesh.shape_cells[2]` to reduce namespace clutter.
-        """
-        warnings.warn(
-            "nCz has been deprecated, please access as mesh.shape_cells[2]",
-            FutureWarning,
+        `nCz` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.shape_cells[2]` to reduce namespace clutter.
+        """
+        raise NotImplementedError(
+            "The nCz property is removed, please access as mesh.shape_cells[2]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        if self.dim < 3:
-            return None
-        return self.shape_cells[2]
 
     @property
     def nNx(self):
         """Number of nodes in the x-direction.
 
-        Returns
-        -------
-        int
-
-        .. deprecated:: 0.5.0
-          `nNx` will be removed in discretize 1.0.0, it is replaced by
-          `mesh.shape_nodes[0]` to reduce namespace clutter.
-        """
-        warnings.warn(
-            "nNx has been deprecated, please access as mesh.shape_nodes[0]",
-            FutureWarning,
+        `nNx` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.shape_nodes[0]` to reduce namespace clutter.
+        """
+        raise NotImplementedError(
+            "The nNx property is removed, please access as mesh.shape_nodes[0]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        return self.shape_nodes[0]
 
     @property
     def nNy(self):
         """Number of nodes in the y-direction.
 
-        Returns
-        -------
-        int or None
-            None if dim < 2
-
-        .. deprecated:: 0.5.0
-          `nNy` will be removed in discretize 1.0.0, it is replaced by
-          `mesh.shape_nodes[1]` to reduce namespace clutter.
-        """
-        warnings.warn(
-            "nNy has been deprecated, please access as mesh.shape_nodes[1]",
-            FutureWarning,
+        `nNy` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.shape_nodes[1]` to reduce namespace clutter.
+        """
+        raise NotImplementedError(
+            "The nNy property is removed, please access as mesh.shape_nodes[1]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        if self.dim < 2:
-            return None
-        return self.shape_nodes[1]
 
     @property
     def nNz(self):
         """Number of nodes in the z-direction.
 
-        Returns
-        -------
-        int or None
-            None if dim < 3
-
-        .. deprecated:: 0.5.0
-          `nNz` will be removed in discretize 1.0.0, it is replaced by
-          `mesh.shape_nodes[2]` to reduce namespace clutter.
-        """
-        warnings.warn(
-            "nNz has been deprecated, please access as mesh.shape_nodes[2]",
-            FutureWarning,
+        `nNz` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.shape_nodes[2]` to reduce namespace clutter.
+        """
+        raise NotImplementedError(
+            "The nNz property is removed, please access as mesh.shape_nodes[2]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        if self.dim < 3:
-            return None
-        return self.shape_nodes[2]
```

### Comparing `discretize-0.8.3/discretize/base/base_tensor_mesh.py` & `discretize-0.9.0/discretize/base/base_tensor_mesh.py`

 * *Files 2% similar despite different names*

```diff
@@ -550,17 +550,17 @@
         if dim == 1:
             return None  # no boundary edges in 1D
         if dim == 2:
             ex = ndgrid(self.cell_centers_x, self.nodes_y[[0, -1]])
             ey = ndgrid(self.nodes_x[[0, -1]], self.cell_centers_y)
             return np.r_[ex, ey]
         if dim == 3:
-            ex = self.edges_x[make_boundary_bool(self.shape_edges_x, dir="yz")]
-            ey = self.edges_y[make_boundary_bool(self.shape_edges_y, dir="xz")]
-            ez = self.edges_z[make_boundary_bool(self.shape_edges_z, dir="xy")]
+            ex = self.edges_x[make_boundary_bool(self.shape_edges_x, bdir="yz")]
+            ey = self.edges_y[make_boundary_bool(self.shape_edges_y, bdir="xz")]
+            ez = self.edges_z[make_boundary_bool(self.shape_edges_z, bdir="xy")]
             return np.r_[ex, ey, ez]
 
     def _getTensorGrid(self, key):
         if getattr(self, "_" + key, None) is None:
             setattr(self, "_" + key, ndgrid(self.get_tensor(key)))
         return getattr(self, "_" + key)
 
@@ -653,20 +653,18 @@
         Returns
         -------
         (n_pts) numpy.ndarray of bool
             Boolean array identifying points which lie within the mesh
 
         """
         if "locType" in kwargs:
-            warnings.warn(
-                "The locType keyword argument has been deprecated, please use location_type. "
+            raise TypeError(
+                "The locType keyword argument has been removed, please use location_type. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            location_type = kwargs["locType"]
         pts = as_array_n_by_dim(pts, self.dim)
 
         tensors = self.get_tensor(location_type)
 
         if location_type[0].lower() == "n" and self._meshType == "CYL":
             # NOTE: for a CYL mesh we add a node to check if we are inside in
             # the radial direction!
@@ -679,15 +677,15 @@
             inside = (
                 inside
                 & (pts[:, i] >= tensor.min() - TOL)
                 & (pts[:, i] <= tensor.max() + TOL)
             )
         return inside
 
-    def _getInterpolationMat(
+    def _get_interpolation_matrix(
         self, loc, location_type="cell_centers", zeros_outside=False
     ):
         """Produce an interpolation matrix.
 
         Parameters
         ----------
         loc : numpy.ndarray
@@ -759,15 +757,15 @@
             elif location_type[-1] == "y":
                 Q = sp.hstack([Z, Q, Z])
             elif location_type[-1] == "z":
                 Q = sp.hstack([Z, Z, Q])
 
         else:
             raise NotImplementedError(
-                "getInterpolationMat: location_type=="
+                "get_interpolation_matrix: location_type=="
                 + location_type
                 + " and mesh.dim=="
                 + str(self.dim)
             )
 
         if zeros_outside:
             Q[indZeros, :] = 0
@@ -775,33 +773,29 @@
         return Q.tocsr()
 
     def get_interpolation_matrix(  # NOQA D102
         self, loc, location_type="cell_centers", zeros_outside=False, **kwargs
     ):
         # Documentation inherited from discretize.base.BaseMesh
         if "locType" in kwargs:
-            warnings.warn(
-                "The locType keyword argument has been deprecated, please use location_type. "
+            raise TypeError(
+                "The locType keyword argument has been removed, please use location_type. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            location_type = kwargs["locType"]
         if "zerosOutside" in kwargs:
-            warnings.warn(
-                "The zerosOutside keyword argument has been deprecated, please use zeros_outside. "
+            raise TypeError(
+                "The zerosOutside keyword argument has been removed, please use zeros_outside. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            zeros_outside = kwargs["zerosOutside"]
-        return self._getInterpolationMat(loc, location_type, zeros_outside)
+        return self._get_interpolation_matrix(loc, location_type, zeros_outside)
 
     def _fastInnerProduct(
         self, projection_type, model=None, invert_model=False, invert_matrix=False
     ):
-        """Fast version of getFaceInnerProduct.
+        """Fast version of get_face_inner_product_deriv.
 
         This does not handle the case of a full tensor property.
 
         Parameters
         ----------
         model : numpy.ndarray
             material property (tensor properties are possible) at each cell center (nC, (1, 3, or 6))
@@ -853,15 +847,15 @@
             M = n_elements * sdiag(Av.T * Vprop)
 
         elif model.size == self.nC * self.dim:
             Av = getattr(self, "ave" + projection_type + "2CCV")
 
             # if cyl, then only certain components are relevant due to symmetry
             # for faces, x, z matters, for edges, y (which is theta) matters
-            if self._meshType == "CYL":
+            if self._meshType == "CYL" and self.is_symmetric:
                 if projection_type == "E":
                     model = model[:, 1]  # this is the action of a projection mat
                 elif projection_type == "F":
                     model = model[:, [0, 2]]
 
             V = sp.kron(sp.identity(n_elements), sdiag(self.cell_volumes))
             M = sdiag(Av.T * V * mkvc(model))
@@ -955,15 +949,15 @@
             elif invert_matrix:
                 dMdprop = n_elements * (sdiag(-MI.diagonal() ** 2) * Av.T * V)
 
         elif tensorType == 2:  # anisotropic
             Av = getattr(self, "ave" + projection_type + "2CCV")
             V = sp.kron(sp.identity(self.dim), sdiag(self.cell_volumes))
 
-            if self._meshType == "CYL":
+            if self._meshType == "CYL" and self.is_symmetric:
                 Zero = sp.csr_matrix((self.nC, self.nC))
                 Eye = sp.eye(self.nC)
                 if projection_type == "E":
                     P = sp.hstack([Zero, Eye, Zero])
                     # print(P.todense())
                 elif projection_type == "F":
                     P = sp.vstack(
@@ -989,91 +983,77 @@
             def innerProductDeriv(v=None):
                 if v is None:
                     warnings.warn(
                         "Depreciation Warning: TensorMesh.innerProductDeriv."
                         " You should be supplying a vector. "
                         "Use: sdiag(u)*dMdprop",
                         FutureWarning,
+                        stacklevel=2,
                     )
                     return dMdprop
                 return sdiag(v) * dMdprop
 
             return innerProductDeriv
         else:
             return None
 
     # DEPRECATED
     @property
     def hx(self):
         """Width of cells in the x direction.
 
-        Returns
-        -------
-        numpy.ndarray
-
-        .. deprecated:: 0.5.0
-          `hx` will be removed in discretize 1.0.0 to reduce namespace clutter,
-          please use `mesh.h[0]`.
+        `hx` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.h[0]` to reduce namespace clutter.
         """
-        warnings.warn(
-            "hx has been deprecated, please access as mesh.h[0]", FutureWarning
+        raise NotImplementedError(
+            "The hx property is removed, please access as mesh.h[0]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        return self.h[0]
 
     @property
     def hy(self):
         """Width of cells in the y direction.
 
-        Returns
-        -------
-        numpy.ndarray or None
-
-        .. deprecated:: 0.5.0
-          `hy` will be removed in discretize 1.0.0 to reduce namespace clutter,
-          please use `mesh.h[1]`.
+        `hy` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.h[1]` to reduce namespace clutter.
         """
-        warnings.warn(
-            "hy has been deprecated, please access as mesh.h[1]", FutureWarning
+        raise NotImplementedError(
+            "The hy property is removed, please access as mesh.h[1]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        return None if self.dim < 2 else self.h[1]
 
     @property
     def hz(self):
         """Width of cells in the z direction.
 
-        Returns
-        -------
-        numpy.ndarray or None
-
-        .. deprecated:: 0.5.0
-          `hz` will be removed in discretize 1.0.0 to reduce namespace clutter,
-          please use `mesh.h[2]`.
+        `hz` will be removed in discretize 1.0.0, it is replaced by
+        `mesh.h[2]` to reduce namespace clutter.
         """
-        warnings.warn(
-            "hz has been deprecated, please access as mesh.h[2]", FutureWarning
+        raise NotImplementedError(
+            "The hz property is removed, please access as mesh.h[2]. "
+            "This message will be removed in discretize 1.0.0."
         )
-        return None if self.dim < 3 else self.h[2]
 
     vectorNx = deprecate_property(
-        "nodes_x", "vectorNx", removal_version="1.0.0", future_warn=True
+        "nodes_x", "vectorNx", removal_version="1.0.0", error=True
     )
     vectorNy = deprecate_property(
-        "nodes_y", "vectorNy", removal_version="1.0.0", future_warn=True
+        "nodes_y", "vectorNy", removal_version="1.0.0", error=True
     )
     vectorNz = deprecate_property(
-        "nodes_z", "vectorNz", removal_version="1.0.0", future_warn=True
+        "nodes_z", "vectorNz", removal_version="1.0.0", error=True
     )
     vectorCCx = deprecate_property(
-        "cell_centers_x", "vectorCCx", removal_version="1.0.0", future_warn=True
+        "cell_centers_x", "vectorCCx", removal_version="1.0.0", error=True
     )
     vectorCCy = deprecate_property(
-        "cell_centers_y", "vectorCCy", removal_version="1.0.0", future_warn=True
+        "cell_centers_y", "vectorCCy", removal_version="1.0.0", error=True
     )
     vectorCCz = deprecate_property(
-        "cell_centers_z", "vectorCCz", removal_version="1.0.0", future_warn=True
+        "cell_centers_z", "vectorCCz", removal_version="1.0.0", error=True
     )
     isInside = deprecate_method(
-        "is_inside", "isInside", removal_version="1.0.0", future_warn=True
+        "is_inside", "isInside", removal_version="1.0.0", error=True
     )
     getTensor = deprecate_method(
-        "get_tensor", "getTensor", removal_version="1.0.0", future_warn=True
+        "get_tensor", "getTensor", removal_version="1.0.0", error=True
     )
```

### Comparing `discretize-0.8.3/discretize/curvilinear_mesh.py` & `discretize-0.9.0/discretize/curvilinear_mesh.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,9 +1,10 @@
 """Module containing the curvilinear mesh implementation."""
 import numpy as np
+import scipy.sparse as sp
 
 from discretize.utils import (
     mkvc,
     index_cube,
     face_info,
     volume_tetrahedron,
     make_boundary_bool,
@@ -502,56 +503,56 @@
         # Documentation inherited from discretize.base.BaseMesh
         return self.nodes[make_boundary_bool(self.shape_nodes)]
 
     @property
     def boundary_edges(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         if self.dim == 2:
-            ex = self.edges_x[make_boundary_bool(self.shape_edges_x, dir="y")]
-            ey = self.edges_y[make_boundary_bool(self.shape_edges_y, dir="x")]
+            ex = self.edges_x[make_boundary_bool(self.shape_edges_x, bdir="y")]
+            ey = self.edges_y[make_boundary_bool(self.shape_edges_y, bdir="x")]
             return np.r_[ex, ey]
         elif self.dim == 3:
-            ex = self.edges_x[make_boundary_bool(self.shape_edges_x, dir="yz")]
-            ey = self.edges_y[make_boundary_bool(self.shape_edges_y, dir="xz")]
-            ez = self.edges_z[make_boundary_bool(self.shape_edges_z, dir="xy")]
+            ex = self.edges_x[make_boundary_bool(self.shape_edges_x, bdir="yz")]
+            ey = self.edges_y[make_boundary_bool(self.shape_edges_y, bdir="xz")]
+            ez = self.edges_z[make_boundary_bool(self.shape_edges_z, bdir="xy")]
             return np.r_[ex, ey, ez]
 
     @property
     def boundary_faces(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
-        fx = self.faces_x[make_boundary_bool(self.shape_faces_x, dir="x")]
-        fy = self.faces_y[make_boundary_bool(self.shape_faces_y, dir="y")]
+        fx = self.faces_x[make_boundary_bool(self.shape_faces_x, bdir="x")]
+        fy = self.faces_y[make_boundary_bool(self.shape_faces_y, bdir="y")]
         if self.dim == 2:
             return np.r_[fx, fy]
         elif self.dim == 3:
-            fz = self.faces_z[make_boundary_bool(self.shape_faces_z, dir="z")]
+            fz = self.faces_z[make_boundary_bool(self.shape_faces_z, bdir="z")]
             return np.r_[fx, fy, fz]
 
     @property
     def boundary_face_outward_normals(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         is_bxm = np.zeros(self.shape_faces_x, order="F", dtype=bool)
         is_bxm[0, :] = True
         is_bxm = is_bxm.reshape(-1, order="F")
 
         is_bym = np.zeros(self.shape_faces_y, order="F", dtype=bool)
         is_bym[:, 0] = True
         is_bym = is_bym.reshape(-1, order="F")
 
         is_b = np.r_[
-            make_boundary_bool(self.shape_faces_x, dir="x"),
-            make_boundary_bool(self.shape_faces_y, dir="y"),
+            make_boundary_bool(self.shape_faces_x, bdir="x"),
+            make_boundary_bool(self.shape_faces_y, bdir="y"),
         ]
         switch = np.r_[is_bxm, is_bym]
         if self.dim == 3:
             is_bzm = np.zeros(self.shape_faces_z, order="F", dtype=bool)
             is_bzm[:, :, 0] = True
             is_bzm = is_bzm.reshape(-1, order="F")
 
-            is_b = np.r_[is_b, make_boundary_bool(self.shape_faces_z, dir="z")]
+            is_b = np.r_[is_b, make_boundary_bool(self.shape_faces_z, bdir="z")]
             switch = np.r_[switch, is_bzm]
         face_normals = self.face_normals.copy()
         face_normals[switch] *= -1
         return face_normals[is_b]
 
     # --------------- Geometries ---------------------
     #
@@ -643,25 +644,25 @@
                 area2 = _length2D(edge2)
                 self._face_areas = np.r_[mkvc(area1), mkvc(area2)]
                 self._normals = [_normalize2D(normal1), _normalize2D(normal2)]
 
             elif self.dim == 3:
                 A, E, F, B = index_cube("AEFB", self.vnN, self.vnFx)
                 normal1, area1 = face_info(
-                    self.gridN, A, E, F, B, average=False, normalizeNormals=False
+                    self.gridN, A, E, F, B, average=False, normalize_normals=False
                 )
 
                 A, D, H, E = index_cube("ADHE", self.vnN, self.vnFy)
                 normal2, area2 = face_info(
-                    self.gridN, A, D, H, E, average=False, normalizeNormals=False
+                    self.gridN, A, D, H, E, average=False, normalize_normals=False
                 )
 
                 A, B, C, D = index_cube("ABCD", self.vnN, self.vnFz)
                 normal3, area3 = face_info(
-                    self.gridN, A, B, C, D, average=False, normalizeNormals=False
+                    self.gridN, A, B, C, D, average=False, normalize_normals=False
                 )
 
                 self._face_areas = np.r_[mkvc(area1), mkvc(area2), mkvc(area3)]
                 self._normals = [normal1, normal2, normal3]
         return self._face_areas
 
     @property
@@ -733,7 +734,107 @@
 
     @property
     def edge_tangents(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         if getattr(self, "_edge_tangents", None) is None:
             self.edge_lengths  # calling .edge_lengths will create the tangents
         return self._edge_tangents
+
+    def _get_edge_surf_int_proj_mats(self, only_boundary=False, with_area=True):
+        """Return the projection operators for integrating edges on each face.
+
+        Parameters
+        ----------
+        only_boundary : bool, optional
+            Whether to only operate on the boundary faces or not.
+        with_area : bool, optional
+            Whether to include the face area.
+
+        Returns
+        -------
+        list of (3 * n_faces, n_edges) scipy.sparse.csr_matrix
+        """
+        # edges associated with each face... can just get the indices of the curl...
+        face_edges = self.edge_curl.indices.reshape(-1, 4)
+        face_areas = self.face_areas
+        if only_boundary:
+            bf_inds = self.project_face_to_boundary_face.indices
+            face_edges = face_edges[bf_inds]
+            face_areas = face_areas[bf_inds]
+            face_normals = self.boundary_face_outward_normals
+        else:
+            face_normals = self.face_normals
+
+        # face_edges is edge_x1m, edge_x1p, edge_x2m, edge_x2p for each of them so...
+        edge_inds = [[0, 2], [1, 2], [0, 3], [1, 3]]
+
+        n_f = face_edges.shape[0]
+
+        ones = np.ones(n_f * 2)
+        P_indptr = np.arange(2 * n_f + 1)
+
+        d = np.ones(3, dtype=int)[:, None] * np.arange(2)
+        t = np.arange(n_f)
+        T_col_inds = (d + t[:, None, None] * 2).reshape(-1)
+        T_ind_ptr = 2 * np.arange(3 * n_f + 1)
+
+        Ps = []
+
+        # translate c to fortran ordering
+        C2F_col_inds = np.arange(n_f * 3).reshape((-1, 3), order="C").reshape(-1)
+        C2F_row_inds = np.arange(n_f * 3).reshape((-1, 3), order="F").reshape(-1)
+        C2F = sp.csr_matrix(
+            (np.ones(n_f * 3), (C2F_row_inds, C2F_col_inds)), shape=(n_f * 3, n_f * 3)
+        )
+
+        for i in range(4):
+            # matrix which selects the edges associate with each of the nodes of each boundary face
+            node_edges = face_edges[:, edge_inds[i]]
+            P = sp.csr_matrix(
+                (ones, node_edges.reshape(-1), P_indptr), shape=(2 * n_f, self.n_edges)
+            )
+
+            edge_dirs = self.edge_tangents[node_edges]
+            t_for = np.concatenate((edge_dirs, face_normals[:, None, :]), axis=1)
+            t_inv = np.linalg.inv(t_for)
+            t_inv = t_inv[:, :, :-1] / 4  # n_edges_per_thing
+
+            if with_area:
+                t_inv *= face_areas[:, None, None]
+
+            T = C2F @ sp.csr_matrix(
+                (t_inv.reshape(-1), T_col_inds, T_ind_ptr),
+                shape=(3 * n_f, 2 * n_f),
+            )
+            Ps.append((T @ P))
+        return Ps
+
+    @property
+    def boundary_edge_vector_integral(self):  # NOQA D102
+        # Documentation inherited from discretize.base.BaseMesh
+        if self.dim == 2:
+            return super().boundary_edge_vector_integral
+
+        Ps = self._get_edge_surf_int_proj_mats(only_boundary=True, with_area=True)
+        # cross product matrix:
+        # cx = mesh.boundary_face_outward_normals[:, 0]
+        # cy = mesh.boundary_face_outward_normals[:, 1]
+        # cz = mesh.boundary_face_outward_normals[:, 2]
+        # z = np.zeros(n_bf)
+        #
+        # vs = np.stack([np.c_[z, cz, -cy], np.c_[-cz, z, cx], np.c_[cy, -cx, z]], axis=-1)
+        # the cross product of a vector defined on each face with the face outward normal...
+        # so V cross n = -n cross V
+
+        cx = sp.diags(self.boundary_face_outward_normals[:, 0])
+        cy = sp.diags(self.boundary_face_outward_normals[:, 1])
+        cz = sp.diags(self.boundary_face_outward_normals[:, 2])
+        # the negative cross mat
+        cross_mat = sp.bmat([[None, cz, -cy], [-cz, None, cx], [cy, -cx, None]])
+
+        Pf = self.project_face_to_boundary_face
+        Pe = self.project_edge_to_boundary_edge
+        Av = (Pf @ self.average_edge_to_face) @ Pe.T
+        Av = cross_mat @ sp.block_diag((Av, Av, Av))
+
+        Me = np.sum(Ps).T @ Av
+        return Me
```

### Comparing `discretize-0.8.3/discretize/cylindrical_mesh.py` & `discretize-0.9.0/discretize/cylindrical_mesh.py`

 * *Files 4% similar despite different names*

```diff
@@ -11,24 +11,24 @@
     speye,
     ddx,
     sdiag,
     spzeros,
     interpolation_matrix,
     cyl2cart,
     as_array_n_by_dim,
+    Identity,
 )
 from discretize.base import BaseTensorMesh, BaseRectangularMesh
 from discretize.operators import DiffOperators, InnerProducts
 from discretize.mixins import InterfaceMixins
 from discretize.utils.code_utils import (
     deprecate_class,
     deprecate_property,
     deprecate_method,
 )
-import warnings
 
 
 class CylindricalMesh(
     InnerProducts, DiffOperators, BaseTensorMesh, BaseRectangularMesh, InterfaceMixins
 ):
     r"""
     Class for cylindrical meshes.
@@ -132,16 +132,16 @@
 
     def __init__(self, h, origin=None, cartesian_origin=None, **kwargs):
         kwargs.pop("reference_system", None)  # reference system must be cylindrical
         if "cartesianOrigin" in kwargs.keys():
             cartesian_origin = kwargs.pop("cartesianOrigin")
         super().__init__(h=h, origin=origin, reference_system="cylindrical", **kwargs)
 
-        if not np.abs(self.h[1].sum() - 2 * np.pi) < 1e-10:
-            raise AssertionError("The 2nd dimension must sum to 2*pi")
+        if self.h[1].sum() > 2 * np.pi + 1e-10:
+            raise ValueError("The 2nd dimension must cannot sum to more than 2*pi.")
 
         if self.dim == 2:
             print("Warning, a disk mesh has not been tested thoroughly.")
 
         if cartesian_origin is None:
             cartesian_origin = np.zeros(self.dim)
         self.cartesian_origin = cartesian_origin
@@ -165,19 +165,29 @@
     @cartesian_origin.setter
     def cartesian_origin(self, value):
         # ensure the value is a numpy array
         value = np.asarray(value, dtype=np.float64)
         value = np.atleast_1d(value)
         if len(value) != self.dim:
             raise ValueError(
-                f"cartesian origin and shape must be the same length, got {len(value)} and {len(self.dim)}"
+                f"cartesian origin and shape must be the same length, got {len(value)} and {self.dim}"
             )
         self._cartesian_origin = value
 
     @property
+    def is_wrapped(self):
+        """Whether the mesh discretizes the full azimuthal space.
+
+        Returns
+        -------
+        bool
+        """
+        return np.allclose(self.h[1].sum(), 2 * np.pi, atol=1e-10)
+
+    @property
     def is_symmetric(self):
         """Validate whether mesh is symmetric.
 
         Symmetric cylindrical meshes have useful mathematical
         properties that allow us to reduce the computational cost
         of solving radially symmetric 3D problems.
         When constructing cylindrical meshes in discretize, we almost
@@ -189,15 +199,25 @@
         *is_symmetric* would return a value of *False* .
 
         Returns
         -------
         bool
             *True* if the mesh is symmetric, *False* otherwise
         """
-        return self.shape_cells[1] == 1
+        return self.is_wrapped and self.shape_cells[1] == 1
+
+    @property
+    def includes_zero(self):
+        """Whether the radial dimension starts at 0.
+
+        Returns
+        -------
+        bool
+        """
+        return self.origin[0] == 0.0
 
     @property
     def shape_nodes(self):
         """Return the number of nodes along each axis.
 
         This property returns a tuple containing the number of nodes along
         the :math:`x` (radial), :math:`y` (azimuthal) and :math:`z` (vertical)
@@ -210,23 +230,29 @@
         -------
         (dim) tuple of int
             Number of nodes in the :math:`x` (radial),
             :math:`y` (azimuthal) and :math:`z` (vertical) directions, respectively.
         """
         vnC = self.shape_cells
         if self.is_symmetric:
-            return (vnC[0], 0, vnC[2] + 1)
-        else:
+            if self.includes_zero:
+                return (vnC[0], 0, vnC[2] + 1)
+            return (vnC[0] + 1, 0, vnC[2] + 1)
+        elif self.is_wrapped:
             return (vnC[0] + 1, vnC[1], vnC[2] + 1)
+        else:
+            return super().shape_nodes
 
     @property
     def _shape_total_nodes(self):
         vnC = self.shape_cells
         if self.is_symmetric:
-            return (vnC[0], 1, vnC[2] + 1)
+            if self.includes_zero:
+                return (vnC[0], 1, vnC[2] + 1)
+            return (vnC[0] + 1, 1, vnC[2] + 1)
         else:
             return tuple(x + 1 for x in vnC)
 
     @property
     def n_nodes(self):
         """Return total number of mesh nodes.
 
@@ -240,34 +266,40 @@
         -------
         int
             Total number of nodes for non-symmetric meshes, 0 for symmetric meshes
         """
         if self.is_symmetric:
             return 0
         nx, ny, nz = self.shape_nodes
-        return (nx - 1) * ny * nz + nz
+        if self.includes_zero:
+            return (nx - 1) * ny * nz + nz
+        else:
+            return nx * ny * nz
 
     @property
     def _n_total_nodes(self):
         return int(np.prod(self._shape_total_nodes))
 
     @property
     def _shape_total_faces_x(self):
         """Vector number of total Fx (prior to deflating)."""
         return self._shape_total_nodes[:1] + self.shape_cells[1:]
 
     @property
     def _n_total_faces_x(self):
-        """Number of total Fx (prior to defplating)."""
+        """Number of total Fx (prior to deflating)."""
         return int(np.prod(self._shape_total_faces_x))
 
     @property
     def _n_hanging_faces_x(self):
         """Number of hanging Fx."""
-        return int(np.prod(self.shape_cells[1:]))
+        if self.includes_zero:
+            return int(np.prod(self.shape_cells[1:]))
+        else:
+            return 0
 
     @property
     def shape_faces_x(self):
         """Number of x-faces along each axis direction.
 
         This property returns the number of x-faces along the
         :math:`x` (radial), :math:`y` (azimuthal) and :math:`z` (vertical)
@@ -276,15 +308,18 @@
 
         Returns
         -------
         (dim) tuple of int
             Number of x-faces along the :math:`x` (radial),
             :math:`y` (azimuthal) and :math:`z` (vertical) directions, respectively.
         """
-        return self.shape_cells
+        if self.includes_zero:
+            return self.shape_cells
+        else:
+            return super().shape_faces_x
 
     @property
     def _shape_total_faces_y(self):
         """Vector number of total Fy (prior to deflating)."""
         vnC = self.shape_cells
         return (vnC[0], self._shape_total_nodes[1]) + vnC[2:]
 
@@ -292,30 +327,33 @@
     def _n_total_faces_y(self):
         """Number of total Fy (prior to deflating)."""
         return int(np.prod(self._shape_total_faces_y))
 
     @property
     def _n_hanging_faces_y(self):
         """Number of hanging y-faces."""
-        return int(np.prod(self.shape_cells[::2]))
+        if self.is_wrapped:
+            return int(np.prod(self.shape_cells[::2]))
+        else:
+            return 0
 
     @property
     def _shape_total_faces_z(self):
         """Vector number of total Fz (prior to deflating)."""
         return self.shape_cells[:-1] + self._shape_total_nodes[-1:]
 
     @property
     def _n_total_faces_z(self):
         """Number of total Fz (prior to deflating)."""
         return int(np.prod(self._shape_total_faces_z))
 
     @property
     def _n_hanging_faces_z(self):
         """Number of hanging Fz."""
-        return int(np.prod(self.shape_cells[::2]))
+        return 0
 
     @property
     def _shape_total_edges_x(self):
         """Vector number of total Ex (prior to deflating)."""
         return self.shape_cells[:1] + self._shape_total_nodes[1:]
 
     @property
@@ -345,15 +383,18 @@
 
         Returns
         -------
         (dim) tuple of int
             Number of y-edges along the :math:`x` (radial),
             :math:`y` (azimuthal) and :math:`z` (vertical) directions, respectively.
         """
-        return tuple(x + y for x, y in zip(self.shape_cells, [0, 0, 1]))
+        if self.includes_zero:
+            return tuple(x + y for x, y in zip(self.shape_cells, [0, 0, 1]))
+        else:
+            return tuple(x + y for x, y in zip(self.shape_cells, [1, 0, 1]))
 
     @property
     def _shape_total_edges_z(self):
         """Vector number of total Ez (prior to deflating)."""
         return self._shape_total_nodes[:-1] + self.shape_cells[-1:]
 
     @property
@@ -394,30 +435,40 @@
         int
             Number of z-edges for non-symmetric meshes and *0* for symmetric meshes
         """
         z_shape = self.shape_edges_z
         cell_shape = self.shape_cells
         if self.is_symmetric:
             return int(np.prod(z_shape))
-        return int(np.prod([z_shape[0] - 1, z_shape[1], cell_shape[2]])) + cell_shape[2]
+        if self.includes_zero:
+            return (
+                int(np.prod([z_shape[0] - 1, z_shape[1], cell_shape[2]]))
+                + cell_shape[2]
+            )
+        return int(np.prod(z_shape))
 
     @property
     def cell_centers_x(self):
         """Return the x-positions of cell centers along the x-direction.
 
         This property returns a 1D vector containing the x-position values
         of the cell centers along the x-direction (radial). The length of the vector
         is equal to the number of cells in the x-direction.
 
         Returns
         -------
         (n_cells_x) numpy.ndarray
             x-positions of cell centers along the x-direction
         """
-        return np.r_[0, self.h[0][:-1].cumsum()] + self.h[0] * 0.5
+        nodes = self.nodes_x
+        ccx = 0.5 * (nodes[1:] + nodes[:-1])
+        if self.is_symmetric and self.includes_zero:
+            return np.r_[self.h[0][0] * 0.5, ccx]
+        return ccx
+        # return np.r_[self.origin[0], self.h[0][:-1].cumsum()] + self.h[0] * 0.5
 
     @property
     def cell_centers_y(self):
         """Return the y-positions of cell centers along the y-direction (azimuthal).
 
         This property returns a 1D vector containing the y-position values
         of the cell centers along the y-direction (azimuthal). The length of the vector
@@ -428,33 +479,35 @@
 
         Returns
         -------
         (n_cells_y) numpy.ndarray
             y-positions of cell centers along the y-direction
         """
         if self.is_symmetric:
-            return self.origin[1] + np.r_[0, self.h[1][:-1]]
-        return self.origin[1] + np.r_[0, self.h[1][:-1].cumsum()] + self.h[1] * 0.5
+            return np.r_[self.origin[1]]
+        nodes = self._nodes_y_full
+        return (nodes[1:] + nodes[:-1]) / 2
 
     @property
     def nodes_x(self):
         """Return the x-positions of nodes along the x-direction (radial).
 
         This property returns a 1D vector containing the x-position values
         of the nodes along the x-direction (radial). The length of the vector
         is equal to the number of nodes in the x-direction.
 
         Returns
         -------
         (n_nodes_x) numpy.ndarray
             x-positions of nodes along the x-direction
         """
-        if self.is_symmetric:
-            return self.h[0].cumsum()
-        return np.r_[0, self.h[0]].cumsum()
+        nodes = np.r_[self.origin[0], self.h[0]].cumsum()
+        if self.is_symmetric and self.includes_zero:
+            return nodes[1:]
+        return nodes
 
     @property
     def _nodes_y_full(self):
         """Full nodal y vector (prior to deflating)."""
         if self.is_symmetric:
             return np.r_[self.origin[1]]
         return self.origin[1] + np.r_[0, self.h[1].cumsum()]
@@ -469,15 +522,17 @@
         indicating all nodes have a y-position of 0. See :py:attr:`~.CylindricalMesh.is_symmetric`.
 
         Returns
         -------
         (n_nodes_y) numpy.ndarray
             y-positions of nodes along the y-direction
         """
-        return self.origin[1] + np.r_[0, self.h[1][:-1].cumsum()]
+        if self.is_wrapped:
+            return self.origin[1] + np.r_[0, self.h[1][:-1].cumsum()]
+        return super().nodes_y
 
     @property
     def _edge_x_lengths_full(self):
         """Full x-edge lengths (prior to deflating)."""
         nx, ny, nz = self._shape_total_nodes
         return np.kron(np.ones(nz), np.kron(np.ones(ny), self.h[0]))
 
@@ -650,22 +705,22 @@
         -------
         (n_faces_y) numpy.ndarray
             A 1D array containing the y-face areas in the case of non-symmetric meshes.
             Returns an error for symmetric meshes.
         """
         if getattr(self, "_face_y_areas", None) is None:
             if self.is_symmetric:
-                raise Exception("There are no y-faces on the Cyl Symmetric mesh")
+                raise AttributeError("There are no y-faces on the Cyl Symmetric mesh")
             self._face_y_areas = self._face_y_areas_full[~self._ishanging_faces_y]
         return self._face_y_areas
 
     @property
     def _face_z_areas_full(self):
         """Area of z-faces prior to deflation."""
-        if self.is_symmetric:
+        if self.is_symmetric and self.includes_zero:
             return np.kron(
                 np.ones_like(self.nodes_z),
                 pi * (self.nodes_x**2 - np.r_[0, self.nodes_x[:-1]] ** 2),
             )
         return np.kron(
             np.ones(self._shape_total_nodes[2]),
             np.kron(
@@ -746,15 +801,15 @@
 
         Returns
         -------
         (n_cells numpy.ndarray
             Volumes of all mesh cells
         """
         if getattr(self, "_cell_volumes", None) is None:
-            if self.is_symmetric:
+            if self.is_symmetric and self.includes_zero:
                 az = pi * (self.nodes_x**2 - np.r_[0, self.nodes_x[:-1]] ** 2)
                 self._cell_volumes = np.kron(self.h[2], az)
             else:
                 self._cell_volumes = np.kron(
                     self.h[2],
                     np.kron(
                         self.h[1],
@@ -764,62 +819,62 @@
         return self._cell_volumes
 
     @property
     def _ishanging_faces_x(self):
         """Boolean vector indicating if an x-face is hanging or not."""
         if getattr(self, "_ishanging_faces_x_bool", None) is None:
             hang_x = np.zeros(self._shape_total_faces_x, dtype=bool, order="F")
-            hang_x[0] = True
+            if self.includes_zero and not self.is_symmetric:
+                hang_x[0] = True
             self._ishanging_faces_x_bool = hang_x.reshape(-1, order="F")
         return self._ishanging_faces_x_bool
 
     @property
     def _hanging_faces_x(self):
         """Hanging x-faces dictionary mapping.
 
         Dictionary of the indices of the hanging x-faces (keys) and a list
         of indices that the eliminated faces map to (if applicable)
         """
         if getattr(self, "_hanging_faces_x_dict", None) is None:
-            self._hanging_faces_x_dict = dict(
-                zip(
-                    np.nonzero(self._ishanging_faces_x)[0].tolist(),
-                    [None] * self._n_hanging_faces_x,
-                )
-            )
+            if self.includes_zero:
+                hanging_f = np.where(self._ishanging_faces_x)[0]
+                # Mark as None to remove them...
+                deflate_f = [None] * len(hanging_f)
+            else:
+                hanging_f = deflate_f = []
+            self._hanging_faces_x_dict = dict(zip(hanging_f, deflate_f))
         return self._hanging_faces_x_dict
 
     @property
     def _ishanging_faces_y(self):
         """Boolean vector indicating if a y-face is hanging or not."""
         if getattr(self, "_ishanging_faces_y_bool", None) is None:
             hang_y = np.zeros(self._shape_total_faces_y, dtype=bool, order="F")
-            hang_y[:, -1] = True
+            if self.is_wrapped:
+                hang_y[:, -1] = True
             self._ishanging_faces_y_bool = hang_y.reshape(-1, order="F")
         return self._ishanging_faces_y_bool
 
     @property
     def _hanging_faces_y(self):
         """Hanging y-faces dictionary mapping.
 
         Dictionary of the indices of the hanging y-faces (keys) and a list
         of indices that the eliminated faces map to (if applicable).
         """
         if getattr(self, "_hanging_faces_y_dict", None) is None:
-            deflate_y = np.zeros(self._shape_total_nodes[1], dtype=bool)
-            deflate_y[0] = True
-            deflateFy = np.nonzero(
-                np.kron(
-                    np.ones(self.shape_cells[2], dtype=bool),
-                    np.kron(deflate_y, np.ones(self.shape_cells[0], dtype=bool)),
-                )
-            )[0].tolist()
-            self._hanging_faces_y_dict = dict(
-                zip(np.nonzero(self._ishanging_faces_y)[0].tolist(), deflateFy)
-            )
+            hanging_f = np.where(self._ishanging_faces_y)[0]
+            nx, ny, nz = self._shape_total_faces_y
+            irs, its, izs = np.unravel_index(hanging_f, (nx, ny, nz), order="F")
+            if self.is_wrapped:
+                ny = ny - 1
+                its %= ny
+            deflate_f = np.ravel_multi_index((irs, its, izs), (nx, ny, nz), order="F")
+            self._hanging_faces_y_dict = dict(zip(hanging_f, deflate_f))
         return self._hanging_faces_y_dict
 
     @property
     def _ishanging_faces_z(self):
         """Boolean vector indicating if a z-face is hanging or not."""
         if getattr(self, "_ishanging_faces_z_bool", None) is None:
             self._ishanging_faces_z_bool = np.zeros(self._n_total_faces_z, dtype=bool)
@@ -835,64 +890,62 @@
         return {}
 
     @property
     def _ishanging_edges_x(self):
         """Boolean vector indicating if a x-edge is hanging or not."""
         if getattr(self, "_ishanging_edges_x_bool", None) is None:
             hang_x = np.zeros(self._shape_total_edges_x, dtype=bool, order="F")
-            hang_x[:, -1] = True
+            if self.is_wrapped:
+                hang_x[:, -1] = True
             self._ishanging_edges_x_bool = hang_x.reshape(-1, order="F")
         return self._ishanging_edges_x_bool
 
     @property
     def _hanging_edges_x(self):
         """Hanging x-edges dictionary mapping.
 
         Dictionary of the indices of the hanging x-edges (keys) and a list
         of indices that the eliminated faces map to (if applicable).
         """
         if getattr(self, "_hanging_edges_x_dict", None) is None:
-            nx, ny, nz = self._shape_total_nodes
-            deflate_y = np.zeros(ny, dtype=bool)
-            deflate_y[0] = True
-            deflateEx = np.nonzero(
-                np.kron(
-                    np.ones(nz, dtype=bool),
-                    np.kron(deflate_y, np.ones(self.shape_cells[0], dtype=bool)),
-                )
-            )[0].tolist()
-            self._hanging_edges_x_dict = dict(
-                zip(np.nonzero(self._ishanging_edges_x)[0].tolist(), deflateEx)
-            )
+            hanging_e = np.where(self._ishanging_edges_x)[0]
+            nx, ny, nz = self._shape_total_edges_x
+            irs, its, izs = np.unravel_index(hanging_e, (nx, ny, nz), order="F")
+            if self.is_wrapped:
+                ny = ny - 1
+                its %= ny
+            deflated_e = np.ravel_multi_index((irs, its, izs), (nx, ny, nz), order="F")
+            self._hanging_edges_x_dict = dict(zip(hanging_e, deflated_e))
         return self._hanging_edges_x_dict
 
     @property
     def _ishanging_edges_y(self):
         """Boolean vector indicating if a y-edge is hanging or not."""
         if getattr(self, "_ishanging_edges_y_bool", None) is None:
             hang_y = np.zeros(self._shape_total_edges_y, dtype=bool, order="F")
-            if not self.is_symmetric:
+            if self.includes_zero or self.is_symmetric:
                 hang_y[0] = True
             self._ishanging_edges_y_bool = hang_y.reshape(-1, order="F")
         return self._ishanging_edges_y_bool
 
     @property
     def _hanging_edges_y(self):
         """Hanging y-edges dictionary mapping.
 
         Dictionary of the indices of the hanging y-edges (keys) and a list
         of indices that the eliminated faces map to (if applicable).
         """
         if getattr(self, "_hanging_edges_y_dict", None) is None:
-            self._hanging_edges_y_dict = dict(
-                zip(
-                    np.nonzero(self._ishanging_edges_y)[0].tolist(),
-                    [None] * len(self._ishanging_edges_y_bool),
-                )
-            )
+            if self.includes_zero:
+                hanging_e = np.where(self._ishanging_edges_y)[0]
+                # Mark as None to remove them...
+                deflate_e = [None] * len(hanging_e)
+            else:
+                hanging_e = deflate_e = []
+            self._hanging_edges_y_dict = dict(zip(hanging_e, deflate_e))
         return self._hanging_edges_y_dict
 
     @property
     def _ishanging_edges(self):
         if self.dim == 2:
             return np.r_[self._ishanging_edges_x, self._ishanging_edges_y]
         else:
@@ -908,82 +961,98 @@
         if getattr(self, "_ishanging_edges_z_bool", None) is None:
             if self.is_symmetric:
                 self._ishanging_edges_z_bool = np.ones(
                     self._n_total_edges_z, dtype=bool
                 )
             else:
                 is_hanging = np.zeros(self._shape_total_edges_z, dtype=bool, order="F")
-                is_hanging[0] = True  # axis of symmetry nodes are hanging
-                is_hanging[0, 0] = False  # axis of symmetry nodes which are not hanging
-                is_hanging[:, -1] = True  # nodes at maximum theta that are duplicated
+                if self.includes_zero:
+                    is_hanging[0] = True  # axis of symmetry nodes are hanging
+                    is_hanging[
+                        0, 0
+                    ] = False  # axis of symmetry nodes which are not hanging
+                if self.is_wrapped:
+                    is_hanging[
+                        :, -1
+                    ] = True  # nodes at maximum theta that are duplicated
                 self._ishanging_edges_z_bool = is_hanging.reshape(-1, order="F")
 
         return self._ishanging_edges_z_bool
 
     @property
     def _hanging_edges_z(self):
         """Hanging z-edges dictionary mapping.
 
         Dictionary of the indices of the hanging z-edges (keys) and a list
         of indices that the eliminated faces map to (if applicable).
         """
         if getattr(self, "_hanging_edges_z_dict", None) is None:
-            nx, ny, nz = self._shape_total_nodes
-            # deflate
-            deflateEz = np.hstack(
-                [
-                    np.hstack(
-                        [np.zeros(ny - 1, dtype=int), np.arange(1, nx, dtype=int)]
-                    )
-                    + i * int(nx * ny)
-                    for i in range(self.shape_cells[2])
-                ]
-            )
-            deflate = zip(np.nonzero(self._ishanging_edges_z)[0].tolist(), deflateEz)
-
-            self._hanging_edges_z_dict = dict(deflate)
+            hanging_e = np.where(self._ishanging_edges_z)[0]
+            nx, ny, nz = self._shape_total_edges_z
+            irs, its, izs = np.unravel_index(hanging_e, (nx, ny, nz), order="F")
+            # If wrapped, map max it to it=0.
+            if self.is_wrapped:
+                ny = ny - 1
+                its %= ny
+            # If I include zero, wrap all the thetas at the center together
+            if self.includes_zero:
+                centers = irs == 0
+                its[centers] = 0
+                deflated_e = irs + ny * its + ((nx - 1) * ny + 1) * izs
+            else:
+                deflated_e = np.ravel_multi_index(
+                    (irs, its, izs), (nx, ny, nz), order="F"
+                )
+            self._hanging_edges_z_dict = dict(zip(hanging_e, deflated_e))
         return self._hanging_edges_z_dict
 
     @property
     def _ishanging_nodes(self):
         """Boolean vector indicating if a node is hanging or not."""
         if getattr(self, "_ishanging_nodes_bool", None) is None:
             if self.is_symmetric:
                 self._ishanging_nodes_bool = np.zeros(self._n_total_nodes, dtype=bool)
             else:
                 is_hanging = np.zeros(self._shape_total_nodes, dtype=bool, order="F")
-                is_hanging[0] = True  # axis of symmetry nodes are hanging
-                is_hanging[0, 0] = False  # axis of symmetry nodes which are not hanging
-                is_hanging[:, -1] = True  # nodes at maximum theta that are duplicated
+                if self.includes_zero:
+                    is_hanging[0, 1:] = True  # axis of symmetry nodes that are hanging
+                if self.is_wrapped:
+                    is_hanging[
+                        :, -1
+                    ] = True  # nodes at maximum theta that are duplicated
                 self._ishanging_nodes_bool = is_hanging.reshape(-1, order="F")
 
         return self._ishanging_nodes_bool
 
     @property
     def _hanging_nodes(self):
         """Hanging nodes dictionary mapping.
 
         Dictionary of the indices of the hanging nodes (keys) and a list
         of indices that the eliminated nodes map to (if applicable).
         """
         if getattr(self, "_hanging_nodes_dict", None) is None:
+            hanging_nodes = np.where(self._ishanging_nodes)[0]
             nx, ny, nz = self._shape_total_nodes
-            # go by layer
-            deflateN = np.hstack(
-                [
-                    np.hstack(
-                        [np.zeros(ny - 1, dtype=int), np.arange(1, nx, dtype=int)]
-                    )
-                    + i * int(nx * ny)
-                    for i in range(nz)
-                ]
-            ).tolist()
-            self._hanging_nodes_dict = dict(
-                zip(np.nonzero(self._ishanging_nodes)[0].tolist(), deflateN)
-            )
+            irs, its, izs = np.unravel_index(hanging_nodes, (nx, ny, nz), order="F")
+            # If wrapped, map max it to it=0.
+            if self.is_wrapped:
+                ny = ny - 1
+                its %= ny
+            # If I include zero, wrap all the thetas at the center together
+            if self.includes_zero:
+                centers = irs == 0
+                its[centers] = 0
+                deflated_n = irs + ny * its + ((nx - 1) * ny + 1) * izs
+            else:
+                deflated_n = np.ravel_multi_index(
+                    (irs, its, izs), (nx, ny, nz), order="F"
+                )
+
+            self._hanging_nodes_dict = dict(zip(hanging_nodes, deflated_n))
         return self._hanging_nodes_dict
 
     ####################################################
     # Grids
     ####################################################
 
     @property
@@ -1090,20 +1159,26 @@
                 self._edges_z = None
             else:
                 self._edges_z = self._edges_z_full[~self._ishanging_edges_z, :]
         return self._edges_z
 
     @property
     def _is_boundary_face(self):
-        # outer most radial faces are a boundaries
         is_br = np.zeros(self._shape_total_faces_x, dtype=bool, order="F")
+        # if I don't start at r=0, then the inner faces are boundary faces
+        if not self.includes_zero:
+            is_br[0] = True
+        # outer most radial faces are a boundaries
         is_br[-1] = True
         is_br = is_br.reshape(-1, order="F")
-        # no theta face is on a boundary
-        is_bt = np.zeros(self._n_total_faces_y, dtype=bool)
+        # Theta face is on a boundary if not wrapped
+        is_bt = np.zeros(self._shape_total_faces_y, dtype=bool, order="F")
+        if not self.is_wrapped:
+            is_bt[:, [0, -1]] = True
+        is_bt = is_bt.reshape(-1, order="F")
         # top and bottom faces are boundaries
         is_bz = np.zeros(self.shape_faces_z, dtype=bool, order="F")
         is_bz[:, :, [0, -1]] = True
         is_bz = is_bz.reshape(-1, order="F")
 
         is_b = np.r_[
             is_br[~self._ishanging_faces_x], is_bt[~self._ishanging_faces_y], is_bz
@@ -1115,27 +1190,42 @@
         # Documentation inherited from discretize.base.BaseMesh
         return self.faces[self._is_boundary_face]
 
     @property
     def boundary_face_outward_normals(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         normals = self.face_normals[self._is_boundary_face]
-        # need to switch the direction of the bottom z faces
-        # there should be n_cells_theta * n_cells_z, radial faces
+
+        # determine which to flip
+        neg_x = np.zeros(self._shape_total_faces_x, dtype=bool, order="F")
+        neg_x[0] = True
+        neg_x = neg_x.reshape(-1, order="F")
+        neg_y = np.zeros(self._shape_total_faces_y, dtype=bool, order="F")
+        neg_y[:, 0] = True
+        neg_y = neg_y.reshape(-1, order="F")
+        neg_z = np.zeros(self._shape_total_faces_z, dtype=bool, order="F")
+        neg_z[:, :, 0] = True
+        neg_z = neg_z.reshape(-1, order="F")
+        neg = np.r_[
+            neg_x[~self._ishanging_faces_x], neg_y[~self._ishanging_faces_y], neg_z
+        ][self._is_boundary_face]
+
         # then n_cells_theta * n_cells_r, bottom faces,
-        n1 = self.shape_cells[1] * self.shape_cells[2]
-        n2 = self.shape_cells[0] * self.shape_cells[1]
-        normals[n1 : n1 + n2] *= -1
+        normals[neg] = -normals[neg]
         return normals
 
     @property
     def _is_boundary_node(self):
         is_b = np.zeros(self._shape_total_nodes, dtype=bool, order="F")
         # outward rs are boundary:
         is_b[-1] = True
+        if not self.includes_zero:
+            is_b[0] = True
+        if not self.is_wrapped:
+            is_b[:, [0, -1]] = True
         # top and bottom zs are boundary
         is_b[:, :, [0, -1]] = True
         is_b = is_b.reshape(-1, order="F")
         is_b = is_b[~self._ishanging_nodes]
         return is_b
 
     @property
@@ -1144,24 +1234,30 @@
         return self.nodes[self._is_boundary_node]
 
     @property
     def _is_boundary_edge(self):
         # top and bottom radial edges are on the boundary
         is_br = np.zeros(self._shape_total_edges_x, dtype=bool, order="F")
         is_br[:, :, [0, -1]] = True
+        if not self.is_wrapped:
+            is_br[:, [0, -1]] = True
         is_br = is_br.reshape(-1, order="F")
         is_bt = np.zeros(self._shape_total_edges_y, dtype=bool, order="F")
         # outside theta edges are on boundary
         is_bt[-1] = True
+        if not self.includes_zero:
+            is_bt[0] = True
         # top and bottom theta edges are on boundary
         is_bt[:, :, [0, -1]] = True
         is_bt = is_bt.reshape(-1, order="F")
         # outside z edges are on boundaries
         is_bz = np.zeros(self._shape_total_edges_z, dtype=bool, order="F")
         is_bz[-1] = True
+        if not self.includes_zero or not self.is_wrapped:
+            is_bz[0] = True
         is_bz = is_bz.reshape(-1, order="F")
 
         is_b = np.r_[
             is_br[~self._ishanging_edges_x],
             is_bt[~self._ishanging_edges_y],
             is_bz[~self._ishanging_edges_z],
         ]
@@ -1191,15 +1287,15 @@
             self._face_divergence = D
         return self._face_divergence
 
     @property
     def face_x_divergence(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseTensorMesh
         if getattr(self, "_face_x_divergence", None) is None:
-            if self.is_symmetric:
+            if self.is_symmetric and self.includes_zero:
                 ncx, ncy, ncz = self.shape_cells
                 D1 = kron3(speye(ncz), speye(ncy), ddx(ncx)[:, 1:])
             else:
                 D1 = super()._face_x_divergence_stencil
 
             S = self._face_x_areas_full
             V = self.cell_volumes
@@ -1315,27 +1411,23 @@
         return self._nodal_gradient
 
     @property
     def _edge_curl_stencil(self):
         if self.is_symmetric:
             nCx, nCy, nCz = self.shape_cells
             # 1D Difference matricies
-            dr = sp.spdiags(
-                (np.ones((nCx + 1, 1)) * [-1, 1]).T, [-1, 0], nCx, nCx, format="csr"
-            )
-            dz = sp.spdiags(
-                (np.ones((nCz + 1, 1)) * [-1, 1]).T,
-                [0, 1],
-                nCz,
-                nCz + 1,
-                format="csr",
-            )
+            if self.includes_zero:
+                dr = sp.diags([-1, 1], [-1, 0], shape=(nCx, nCx), format="csr")
+                dz = sp.diags([-1, 1], [0, 1], shape=(nCz, nCz + 1), format="csr")
+            else:
+                dr = sp.diags([-1, 1], [0, 1], shape=(nCx, nCx + 1), format="csr")
+                dz = sp.diags([-1, 1], [0, 1], shape=(nCz, nCz + 1), format="csr")
             # 2D Difference matricies
             Dr = sp.kron(sp.identity(nCz + 1), dr)
-            Dz = -sp.kron(dz, sp.identity(nCx))
+            Dz = -sp.kron(dz, sp.identity(dr.shape[-1]))
             return sp.vstack((Dz, Dr))
         else:
             stencil = super()._edge_curl_stencil
             P_f = self._deflation_matrix("faces")
             P_e = self._deflation_matrix("edges", as_ones=True)
             return P_f @ stencil @ P_e.T
 
@@ -1350,29 +1442,32 @@
             )
         return self._edge_curl
 
     @property
     def average_edge_x_to_cell(self):  # NOQA D102
         # Documentation inherited from discretize.operators.DiffOperators
         if self.is_symmetric:
-            raise Exception("There are no x-edges on a cyl symmetric mesh")
+            raise AttributeError("There are no x-edges on a cyl symmetric mesh")
         return (
             kron3(
                 av(self.shape_cells[2]),
                 av(self.shape_cells[1]),
                 speye(self.shape_cells[0]),
             )
             * self._deflation_matrix("Ex", as_ones=True).T
         )
 
     @property
     def average_edge_y_to_cell(self):  # NOQA D102
         # Documentation inherited from discretize.operators.DiffOperators
         if self.is_symmetric:
-            avR = av(self.shape_cells[0])[:, 1:]
+            if self.includes_zero:
+                avR = av(self.shape_cells[0])[:, 1:]
+            else:
+                avR = av(self.shape_cells[0])
             return sp.kron(av(self.shape_cells[2]), avR, format="csr")
         else:
             return (
                 kron3(
                     av(self.shape_cells[2]),
                     speye(self.shape_cells[1]),
                     av(self.shape_cells[0]),
@@ -1380,15 +1475,15 @@
                 * self._deflation_matrix("Ey", as_ones=True).T
             )
 
     @property
     def average_edge_z_to_cell(self):  # NOQA D102
         # Documentation inherited from discretize.operators.DiffOperators
         if self.is_symmetric:
-            raise Exception("There are no z-edges on a cyl symmetric mesh")
+            raise AttributeError("There are no z-edges on a cyl symmetric mesh")
         return (
             kron3(
                 speye(self.shape_cells[2]),
                 av(self.shape_cells[1]),
                 av(self.shape_cells[0]),
             )
             * self._deflation_matrix("Ez", as_ones=True).T
@@ -1421,35 +1516,51 @@
             if getattr(self, "_average_edge_to_cell_vector", None) is None:
                 self._average_edge_to_cell_vector = sp.block_diag(
                     (self.aveEx2CC, self.aveEy2CC, self.aveEz2CC), format="csr"
                 )
         return self._average_edge_to_cell_vector
 
     @property
+    def average_edge_to_face(self):  # NOQA D102
+        # Documentation inherited from discretize.base.BaseMesh
+        if self.is_symmetric:
+            nx, _, nz = self.shape_edges_y
+
+            if self.includes_zero:
+                e_to_fx = sp.kron(av(nz - 1), sp.eye(nx))
+                e_to_fz = sp.kron(sp.eye(nz), av(nx).toarray()[:, 1:])
+            else:
+                e_to_fx = sp.kron(av(nz - 1), sp.eye(nx))
+                e_to_fz = sp.kron(sp.eye(nz), av(nx - 1))
+
+            return sp.vstack([e_to_fx, e_to_fz])
+        else:
+            Av = super().average_edge_to_face
+            # then need to deflate it...
+            De = self._deflation_matrix("edges", as_ones=True)
+            Df = self._deflation_matrix("faces", as_ones=False)
+            return Df @ Av @ De.T
+
+    @property
     def average_face_x_to_cell(self):  # NOQA D102
         # Documentation inherited from discretize.operators.DiffOperators
-        avR = av(self.vnC[0])[
-            :, 1:
-        ]  # TODO: this should be handled by a deflation matrix
-        return kron3(speye(self.vnC[2]), speye(self.vnC[1]), avR)
+        if self.includes_zero:
+            avR = av(self.vnC[0])[:, 1:]
+            return kron3(speye(self.vnC[2]), speye(self.vnC[1]), avR)
+        return super().average_face_x_to_cell
 
     @property
     def average_face_y_to_cell(self):  # NOQA D102
         # Documentation inherited from discretize.operators.DiffOperators
         return (
-            kron3(speye(self.vnC[2]), av(self.vnC[1]), speye(self.vnC[0]))
+            super().average_face_y_to_cell
             * self._deflation_matrix("Fy", as_ones=True).T
         )
 
     @property
-    def average_face_z_to_cell(self):  # NOQA D102
-        # Documentation inherited from discretize.operators.DiffOperators
-        return kron3(av(self.vnC[2]), speye(self.vnC[1]), speye(self.vnC[0]))
-
-    @property
     def average_face_to_cell(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         if getattr(self, "_average_face_to_cell", None) is None:
             if self.is_symmetric:
                 self._average_face_to_cell = 0.5 * (
                     sp.hstack((self.aveFx2CC, self.aveFz2CC), format="csr")
                 )
@@ -1504,35 +1615,54 @@
         if getattr(self, "_average_node_to_face", None) is None:
             ave = super().average_node_to_face
             ave = ave @ self._deflation_matrix("nodes", as_ones=True).T
             self._average_node_to_face = ave
         return self._average_node_to_face
 
     @property
+    def average_node_to_cell(self):  # NOQA D102
+        # Documentation inherited from discretize.base.BaseMesh
+        if getattr(self, "_average_node_to_cell", None) is None:
+            ave = super().average_node_to_cell
+            ave = ave @ self._deflation_matrix("nodes", as_ones=True).T
+            self._average_node_to_cell = ave
+        return self._average_node_to_cell
+
+    @property
     def average_cell_to_face(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         if getattr(self, "_average_cell_to_face", None) is None:
             if self.dim == 3:
-                # average_cell_to_face_r
-                av_c2f_r = kron3(
-                    speye(self.shape_cells[2]),
-                    speye(self.shape_cells[1]),
-                    av_extrap(self.shape_cells[0]),
-                )[~self._ishanging_faces_x]
-
-                av_c2f_t = self._deflation_matrix("faces_y") @ kron3(
-                    speye(self.shape_cells[2]),
-                    av_extrap(self.shape_cells[1]),
-                    speye(self.shape_cells[0]),
-                )
+                nx, ny, nz = self.shape_cells
+                if self.is_symmetric and self.includes_zero:
+                    av_c2f_r = kron3(
+                        speye(nz),
+                        speye(ny),
+                        av_extrap(nx)[1:],
+                    )
+                else:
+                    av_c2f_r = kron3(
+                        speye(nz),
+                        speye(ny),
+                        av_extrap(nx),
+                    )[~self._ishanging_faces_x]
+
+                if not self.is_symmetric:
+                    av_c2f_t = self._deflation_matrix("faces_y") @ kron3(
+                        speye(nz),
+                        av_extrap(ny),
+                        speye(nx),
+                    )
+                else:
+                    av_c2f_t = None
 
                 av_c2f_z = kron3(
-                    av_extrap(self.shape_cells[2]),
-                    speye(self.shape_cells[1]),
-                    speye(self.shape_cells[0]),
+                    av_extrap(nz),
+                    speye(ny),
+                    speye(nx),
                 )
 
                 self._average_cell_to_face = sp.vstack(
                     (av_c2f_r, av_c2f_t, av_c2f_z),
                     format="csr",
                 )
         return self._average_cell_to_face
@@ -1577,14 +1707,16 @@
             "edges_y",
             "edges_z",
             "cell_centers",
         ]:
             raise ValueError(
                 "Location must be a grid location, not {}".format(location)
             )
+        if not (self.is_symmetric or self.is_wrapped or self.includes_zero):
+            return Identity()
         if location == "cell_centers":
             return speye(self.n_cells)
         if self.is_symmetric and location == "nodes":
             return sp.csr_matrix((self.n_nodes, self._n_total_nodes))
 
         elif location in ["edges", "faces"]:
             if self.is_symmetric:
@@ -1600,38 +1732,34 @@
             return sp.block_diag(
                 [
                     self._deflation_matrix(location + coord, as_ones=as_ones)
                     for coord in ["_x", "_y", "_z"]
                 ]
             )
 
-        R = speye(getattr(self, "_n_total_{}".format(location)))
+        n_total = getattr(self, "_n_total_{}".format(location))
+        n_items = getattr(self, "n_{}".format(location))
+        if n_total == n_items:
+            return sp.eye(n_total, format="csr")
+        is_hanging = getattr(self, "_ishanging_{}".format(location))
         hanging_dict = getattr(self, "_hanging_{}".format(location))
-        nothanging = ~getattr(self, "_ishanging_{}".format(location))
 
-        # remove eliminated edges / faces (eg. Fx just doesn't exist)
-        hang = {k: v for k, v in hanging_dict.items() if v is not None}
-
-        values = list(hang.values())
-        entries = np.ones(len(values))
-
-        Hang = sp.csr_matrix(
-            (entries, (values, list(hang.keys()))),
-            shape=(
-                getattr(self, "_n_total_{}".format(location)),
-                getattr(self, "_n_total_{}".format(location)),
-            ),
-        )
-        R = R + Hang
-
-        R = R[nothanging, :]
+        vs = np.ones(n_total)
+        inds = np.empty(n_total, dtype=int)
+        inds[~is_hanging] = np.arange(n_items)
+        for k, v in hanging_dict.items():
+            if v is not None:
+                inds[k] = v
+            else:
+                inds[k] = 0
+                vs[k] = 0
 
+        R = sp.csr_matrix((vs, (inds, np.arange(n_total))), shape=(n_items, n_total))
         if not as_ones:
             R = sdiag(1.0 / R.sum(1)) * R
-
         return R
 
     ####################################################
     # Interpolation
     ####################################################
 
     def get_interpolation_matrix(
@@ -1672,27 +1800,23 @@
         Returns
         -------
         (n_pts, n_loc_type) scipy.sparse.csr_matrix
             The interpolation matrix
 
         """
         if "locType" in kwargs:
-            warnings.warn(
-                "The locType keyword argument has been deprecated, please use location_type. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The locType keyword argument has been removed, please use location_type. "
+                "This will be removed in discretize 1.0.0"
             )
-            location_type = kwargs["locType"]
         if "zerosOutside" in kwargs:
-            warnings.warn(
-                "The zerosOutside keyword argument has been deprecated, please use zeros_outside. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The zerosOutside keyword argument has been removed, please use zeros_outside. "
+                "This will be removed in discretize 1.0.0"
             )
-            zeros_outside = kwargs["zerosOutside"]
 
         location_type = self._parse_location_type(location_type)
         if self.is_symmetric and location_type in ["edges_x", "edges_z", "faces_y"]:
             raise ValueError(
                 "Symmetric CylindricalMesh does not support {0!s} interpolation, "
                 "as this variable does not exist.".format(location_type)
             )
@@ -1713,149 +1837,187 @@
         elif location_type == "nodes":
             rtz = [self.nodes_x, self._nodes_y_full]
             if self.dim == 3:
                 rtz.append(self.nodes_z)
             Q = interpolation_matrix(loc, *rtz)
             Q = Q @ self._deflation_matrix("nodes", as_ones=True).T
         elif location_type == "cell_centers":
-            # theta wrap around interpolation
             rtz = [
                 self.cell_centers_x,
-                np.r_[
-                    self.cell_centers_y[-1] - 2 * np.pi,
-                    self.cell_centers_y,
-                    self.cell_centers_y[0] + 2 * np.pi,
-                ],
             ]
+            # theta wrap around interpolation
+            if self.is_wrapped:
+                rtz.append(
+                    np.r_[
+                        self.cell_centers_y[-1] - 2 * np.pi,
+                        self.cell_centers_y,
+                        self.cell_centers_y[0] + 2 * np.pi,
+                    ]
+                )
+            else:
+                rtz.append(self.cell_centers_y)
             if self.dim == 3:
                 rtz.append(self.cell_centers_z)
             Q = interpolation_matrix(loc, *rtz)
-            irs, its, izs = np.unravel_index(
-                Q.indices, self.shape_cells + np.r_[0, 2, 0], order="F"
-            )
-            its = (its - 1) % self.shape_cells[1]
-            new_indices = np.ravel_multi_index(
-                (irs, its, izs), self.shape_cells, order="F"
-            )
-            Q = sp.csr_matrix(
-                (Q.data, new_indices, Q.indptr), shape=(Q.shape[0], self.n_cells)
-            )
-        else:
+            if self.is_wrapped:
+                irs, its, izs = np.unravel_index(
+                    Q.indices, self.shape_cells + np.r_[0, 2, 0], order="F"
+                )
+                its = (its - 1) % self.shape_cells[1]
+                new_indices = np.ravel_multi_index(
+                    (irs, its, izs), self.shape_cells, order="F"
+                )
+                Q = sp.csr_matrix(
+                    (Q.data, new_indices, Q.indptr), shape=(Q.shape[0], self.n_cells)
+                )
+        elif location_type in [
+            "edges_x",
+            "edges_y",
+            "edges_z",
+            "faces_x",
+            "faces_y",
+            "faces_z",
+        ]:
             ind = {"x": 0, "y": 1, "z": 2}[location_type[-1]]
             if self.dim < ind:
                 raise ValueError("mesh is not high enough dimension.")
             if "f" in location_type.lower():
                 items = (self.nFx, self.nFy, self.nFz)[: self.dim]
             else:
                 items = (self.nEx, self.nEy, self.nEz)[: self.dim]
             components = [spzeros(loc.shape[0], n) for n in items]
             if location_type == "faces_x":
-                # theta wrap around interpolation
-                nodes_x = self.nodes_x if self.is_symmetric else self.nodes_x[1:]
+                if self.includes_zero and not self.is_symmetric:
+                    nodes_x = self.nodes_x[1:]
+                else:
+                    nodes_x = self.nodes_x
                 rtz = [
                     nodes_x,
-                    np.r_[
-                        self.cell_centers_y[-1] - 2 * np.pi,
-                        self.cell_centers_y,
-                        self.cell_centers_y[0] + 2 * np.pi,
-                    ],
                 ]
+                # theta wrap around interpolation
+                if self.is_wrapped:
+                    rtz.append(
+                        np.r_[
+                            self.cell_centers_y[-1] - 2 * np.pi,
+                            self.cell_centers_y,
+                            self.cell_centers_y[0] + 2 * np.pi,
+                        ],
+                    )
+                else:
+                    rtz.append(self.cell_centers_y)
                 if self.dim == 3:
                     rtz.append(self.cell_centers_z)
                 Q = interpolation_matrix(loc, *rtz)
                 # unwrap the theta indices
-                irs, its, izs = np.unravel_index(
-                    Q.indices, self.shape_faces_x + np.r_[0, 2, 0], order="F"
-                )
-                its = (its - 1) % self.shape_faces_x[1]
-                new_indices = np.ravel_multi_index(
-                    (irs, its, izs), self.shape_faces_x, order="F"
-                )
-                Q = sp.csr_matrix(
-                    (Q.data, new_indices, Q.indptr), shape=(Q.shape[0], self.n_faces_x)
-                )
+                if self.is_wrapped:
+                    irs, its, izs = np.unravel_index(
+                        Q.indices, self.shape_faces_x + np.r_[0, 2, 0], order="F"
+                    )
+                    its = (its - 1) % self.shape_faces_x[1]
+                    new_indices = np.ravel_multi_index(
+                        (irs, its, izs), self.shape_faces_x, order="F"
+                    )
+                    Q = sp.csr_matrix(
+                        (Q.data, new_indices, Q.indptr),
+                        shape=(Q.shape[0], self.n_faces_x),
+                    )
                 components[0] = Q
             elif location_type == "faces_y":
                 rtz = [
                     self.cell_centers_x,
                     self._nodes_y_full,
                 ]
                 if self.dim == 3:
                     rtz.append(self.cell_centers_z)
                 Q = interpolation_matrix(loc, *rtz)
                 Q = Q @ self._deflation_matrix("faces_y", as_ones=True).T
                 components[1] = Q
             elif location_type == "faces_z":
-                # theta wrap around interpolation
                 rtz = [
                     self.cell_centers_x,
-                    np.r_[
-                        self.cell_centers_y[-1] - 2 * np.pi,
-                        self.cell_centers_y,
-                        self.cell_centers_y[0] + 2 * np.pi,
-                    ],
-                    self.nodes_z,
                 ]
+                # theta wrap around interpolation
+                if self.is_wrapped:
+                    rtz.append(
+                        np.r_[
+                            self.cell_centers_y[-1] - 2 * np.pi,
+                            self.cell_centers_y,
+                            self.cell_centers_y[0] + 2 * np.pi,
+                        ],
+                    )
+                else:
+                    rtz.append(self.cell_centers_y)
+                rtz.append(self.nodes_z)
                 Q = interpolation_matrix(loc, *rtz)
-                # unwrap the theta indices
-                irs, its, izs = np.unravel_index(
-                    Q.indices, self.shape_faces_z + np.r_[0, 2, 0], order="F"
-                )
-                its = (its - 1) % self.shape_faces_z[1]
-                new_indices = np.ravel_multi_index(
-                    (irs, its, izs), self.shape_faces_z, order="F"
-                )
-                Q = sp.csr_matrix(
-                    (Q.data, new_indices, Q.indptr), shape=(Q.shape[0], self.n_faces_z)
-                )
+                if self.is_wrapped:
+                    # unwrap the theta indices
+                    irs, its, izs = np.unravel_index(
+                        Q.indices, self.shape_faces_z + np.r_[0, 2, 0], order="F"
+                    )
+                    its = (its - 1) % self.shape_faces_z[1]
+                    new_indices = np.ravel_multi_index(
+                        (irs, its, izs), self.shape_faces_z, order="F"
+                    )
+                    Q = sp.csr_matrix(
+                        (Q.data, new_indices, Q.indptr),
+                        shape=(Q.shape[0], self.n_faces_z),
+                    )
                 components[2] = Q
             elif location_type == "edges_x":
                 rtz = [
                     self.cell_centers_x,
                     self._nodes_y_full,
                 ]
                 if self.dim == 3:
                     rtz.append(self.nodes_z)
                 Q = interpolation_matrix(loc, *rtz)
                 Q = Q @ self._deflation_matrix("edges_x", as_ones=True).T
                 components[0] = Q
             elif location_type == "edges_y":
                 # theta wrap around
-                nodes_x = self.nodes_x if self.is_symmetric else self.nodes_x[1:]
-                rtz = [
-                    nodes_x,
-                    np.r_[
-                        self.cell_centers_y[-1] - 2 * np.pi,
-                        self.cell_centers_y,
-                        self.cell_centers_y[0] + 2 * np.pi,
-                    ],
-                ]
+                if self.is_symmetric or not self.includes_zero:
+                    nodes_x = self.nodes_x
+                else:
+                    nodes_x = self.nodes_x[1:]
+                rtz = [nodes_x]
+                if self.is_wrapped:
+                    rtz.append(
+                        np.r_[
+                            self.cell_centers_y[-1] - 2 * np.pi,
+                            self.cell_centers_y,
+                            self.cell_centers_y[0] + 2 * np.pi,
+                        ],
+                    )
+                else:
+                    rtz.append(self.cell_centers_y)
                 if self.dim == 3:
                     rtz.append(self.nodes_z)
                 Q = interpolation_matrix(loc, *rtz)
-                irs, its, izs = np.unravel_index(
-                    Q.indices, self.shape_edges_y + np.r_[0, 2, 0], order="F"
-                )
-                its = (its - 1) % self.shape_edges_y[1]
-                new_indices = np.ravel_multi_index(
-                    (irs, its, izs), self.shape_edges_y, order="F"
-                )
-                Q = sp.csr_matrix(
-                    (Q.data, new_indices, Q.indptr), shape=(Q.shape[0], self.n_edges_y)
-                )
+                if self.is_wrapped:
+                    irs, its, izs = np.unravel_index(
+                        Q.indices, self.shape_edges_y + np.r_[0, 2, 0], order="F"
+                    )
+                    its = (its - 1) % self.shape_edges_y[1]
+                    new_indices = np.ravel_multi_index(
+                        (irs, its, izs), self.shape_edges_y, order="F"
+                    )
+                    Q = sp.csr_matrix(
+                        (Q.data, new_indices, Q.indptr),
+                        shape=(Q.shape[0], self.n_edges_y),
+                    )
                 components[1] = Q
             elif location_type == "edges_z":
                 rtz = [self.nodes_x, self._nodes_y_full, self.cell_centers_z]
                 Q = interpolation_matrix(loc, *rtz)
                 Q = Q @ self._deflation_matrix("edges_z", as_ones=True).T
                 components[2] = Q
-            else:
-                raise ValueError("Unrecognized location type")
             # remove any zero blocks (hstack complains)
             Q = sp.hstack([comp for comp in components if comp.shape[1] > 0])
+        else:
+            raise ValueError("Unrecognized location type")
         if zeros_outside:
             Q[~self.is_inside(loc), :] = 0
         return Q
 
     def cartesian_grid(self, location_type="cell_centers", theta_shift=None, **kwargs):
         """Return the specified grid in cartesian coordinates.
 
@@ -1871,20 +2033,18 @@
 
         Returns
         -------
         (n_items, dim) numpy.ndarray
             cartesian coordinates for the cylindrical grid
         """
         if "locType" in kwargs:
-            warnings.warn(
-                "The locType keyword argument has been deprecated, please use location_type. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The locType keyword argument has been removed, please use location_type. "
+                "This will be removed in discretize 1.0.0"
             )
-            location_type = kwargs["locType"]
         try:
             grid = getattr(self, location_type).copy()
         except AttributeError:
             grid = getattr(self, f"grid{location_type}").copy()
         if theta_shift is not None:
             grid[:, 1] = grid[:, 1] - theta_shift
         return cyl2cart(grid)  # TODO: account for cartesian origin
@@ -1915,32 +2075,28 @@
         Returns
         -------
         scipy.sparse.csr_matrix
             interpolation matrix from gridded locations on cylindrical mesh to gridded locations
             on another mesh
         """
         if "locType" in kwargs:
-            warnings.warn(
-                "The locType keyword argument has been deprecated, please use location_type. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The locType keyword argument has been removed, please use location_type. "
+                "This will be removed in discretize 1.0.0"
             )
-            location_type = kwargs["locType"]
         if "locTypeTo" in kwargs:
-            warnings.warn(
-                "The locTypeTo keyword argument has been deprecated, please use location_type_to. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The locTypeTo keyword argument has been removed, please use location_type_to. "
+                "This will be removed in discretize 1.0.0"
             )
-            location_type_to = kwargs["locTypeTo"]
 
         location_type = self._parse_location_type(location_type)
 
         if not self.is_symmetric:
-            raise AssertionError(
+            raise NotImplementedError(
                 "Currently we have not taken into account other projections "
                 "for more complicated CylindricalMeshes"
             )
 
         if location_type_to is None:
             location_type_to = location_type
         location_type_to = self._parse_location_type(location_type_to)
@@ -2010,46 +2166,46 @@
 
         Pc2r = self.get_interpolation_matrix(G, interp_type)
         Proj = sdiag(proj)
         return Proj * Pc2r
 
     # DEPRECATIONS
     areaFx = deprecate_property(
-        "face_x_areas", "areaFx", removal_version="1.0.0", future_warn=True
+        "face_x_areas", "areaFx", removal_version="1.0.0", error=True
     )
     areaFy = deprecate_property(
-        "face_y_areas", "areaFy", removal_version="1.0.0", future_warn=True
+        "face_y_areas", "areaFy", removal_version="1.0.0", error=True
     )
     areaFz = deprecate_property(
-        "face_z_areas", "areaFz", removal_version="1.0.0", future_warn=True
+        "face_z_areas", "areaFz", removal_version="1.0.0", error=True
     )
     edgeEx = deprecate_property(
-        "edge_x_lengths", "edgeEx", removal_version="1.0.0", future_warn=True
+        "edge_x_lengths", "edgeEx", removal_version="1.0.0", error=True
     )
     edgeEy = deprecate_property(
-        "edge_y_lengths", "edgeEy", removal_version="1.0.0", future_warn=True
+        "edge_y_lengths", "edgeEy", removal_version="1.0.0", error=True
     )
     edgeEz = deprecate_property(
-        "edge_z_lengths", "edgeEz", removal_version="1.0.0", future_warn=True
+        "edge_z_lengths", "edgeEz", removal_version="1.0.0", error=True
     )
     isSymmetric = deprecate_property(
-        "is_symmetric", "isSymmetric", removal_version="1.0.0", future_warn=True
+        "is_symmetric", "isSymmetric", removal_version="1.0.0", error=True
     )
     cartesianOrigin = deprecate_property(
-        "cartesian_origin", "cartesianOrigin", removal_version="1.0.0", future_warn=True
+        "cartesian_origin", "cartesianOrigin", removal_version="1.0.0", error=True
     )
     getInterpolationMatCartMesh = deprecate_method(
         "get_interpolation_matrix_cartesian_mesh",
         "getInterpolationMatCartMesh",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     cartesianGrid = deprecate_method(
-        "cartesian_grid", "cartesianGrid", removal_version="1.0.0", future_warn=True
+        "cartesian_grid", "cartesianGrid", removal_version="1.0.0", error=True
     )
 
 
-@deprecate_class(removal_version="1.0.0", future_warn=True)
+@deprecate_class(removal_version="1.0.0", error=True)
 class CylMesh(CylindricalMesh):
     """Deprecated calling of `discretize.CylindricalMesh`."""
 
     pass
```

### Comparing `discretize-0.8.3/discretize/mixins/__init__.py` & `discretize-0.9.0/discretize/mixins/__init__.py`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/mixins/mesh_io.py` & `discretize-0.9.0/discretize/mixins/mesh_io.py`

 * *Files 5% similar despite different names*

```diff
@@ -3,15 +3,14 @@
 The text files representing meshes are often in the `UBC` format.
 """
 import os
 import numpy as np
 
 from discretize.utils import mkvc
 from discretize.utils.code_utils import deprecate_method
-import warnings
 
 try:
     from discretize.mixins.vtk_mod import (
         InterfaceTensorread_vtk,
         InterfaceSimplexReadVTK,
     )
 except ImportError:
@@ -413,29 +412,27 @@
         """Read 2D or 3D tensor mesh from UBC-GIF formatted file.
 
         *readUBC* has been deprecated and replaced by *read_UBC*
         See Also
         --------
         read_UBC
         """
-        warnings.warn(
-            "TensorMesh.readUBC has been deprecated and will be removed in"
+        raise NotImplementedError(
+            "TensorMesh.readUBC has been removed and this be removed in"
             "discretize 1.0.0. please use TensorMesh.read_UBC",
-            FutureWarning,
         )
-        return TensorMesh.read_UBC(file_name, directory)
 
     readModelUBC = deprecate_method(
-        "read_model_UBC", "readModelUBC", removal_version="1.0.0", future_warn=True
+        "read_model_UBC", "readModelUBC", removal_version="1.0.0", error=True
     )
     writeUBC = deprecate_method(
-        "write_UBC", "writeUBC", removal_version="1.0.0", future_warn=True
+        "write_UBC", "writeUBC", removal_version="1.0.0", error=True
     )
     writeModelUBC = deprecate_method(
-        "write_model_UBC", "writeModelUBC", removal_version="1.0.0", future_warn=True
+        "write_model_UBC", "writeModelUBC", removal_version="1.0.0", error=True
     )
 
 
 class TreeMeshIO(object):
     """Class for managing the input/output of tree meshes and models.
 
     The ``TreeMeshIO`` class contains a set of class methods specifically
@@ -607,29 +604,27 @@
 
         *readUBC* has been deprecated and replaced by *read_UBC*
 
         See Also
         --------
         read_UBC
         """
-        warnings.warn(
-            "TensorMesh.readUBC has been deprecated and will be removed in"
+        raise NotImplementedError(
+            "TensorMesh.readUBC has been removed and this be removed in"
             "discretize 1.0.0. please use TensorMesh.read_UBC",
-            FutureWarning,
         )
-        return TreeMesh.read_UBC(file_name, directory)
 
     readModelUBC = deprecate_method(
-        "read_model_UBC", "readModelUBC", removal_version="1.0.0", future_warn=True
+        "read_model_UBC", "readModelUBC", removal_version="1.0.0", error=True
     )
     writeUBC = deprecate_method(
-        "write_UBC", "writeUBC", removal_version="1.0.0", future_warn=True
+        "write_UBC", "writeUBC", removal_version="1.0.0", error=True
     )
     writeModelUBC = deprecate_method(
-        "write_model_UBC", "writeModelUBC", removal_version="1.0.0", future_warn=True
+        "write_model_UBC", "writeModelUBC", removal_version="1.0.0", error=True
     )
 
 
 class SimplexMeshIO(InterfaceSimplexReadVTK):
     """Empty class for future text based IO of a SimplexMesh."""
 
     pass
```

### Comparing `discretize-0.8.3/discretize/mixins/mpl_mod.py` & `discretize-0.9.0/discretize/mixins/mpl_mod.py`

 * *Files 0% similar despite different names*

```diff
@@ -105,24 +105,24 @@
         >>> mesh.plot_grid(nodes=True, faces=True, centers=True, lines=True)
         >>> plt.show()
 
         Plotting a 2D CurvilinearMesh
 
         >>> from matplotlib import pyplot as plt
         >>> import discretize
-        >>> X, Y = discretize.utils.exampleLrmGrid([10, 10], 'rotate')
+        >>> X, Y = discretize.utils.example_curvilinear_grid([10, 10], 'rotate')
         >>> M = discretize.CurvilinearMesh([X, Y])
         >>> M.plot_grid()
         >>> plt.show()
 
         Plotting a 3D CurvilinearMesh
 
         >>> from matplotlib import pyplot as plt
         >>> import discretize
-        >>> X, Y, Z = discretize.utils.exampleLrmGrid([5, 5, 5], 'rotate')
+        >>> X, Y, Z = discretize.utils.example_curvilinear_grid([5, 5, 5], 'rotate')
         >>> M = discretize.CurvilinearMesh([X, Y, Z])
         >>> M.plot_grid()
         >>> plt.show()
 
         Plotting a 2D TreeMesh
 
         >>> from matplotlib import pyplot as plt
@@ -160,15 +160,17 @@
                     type(self).__name__
                 )
             )
 
         if "showIt" in kwargs:
             show_it = kwargs.pop("showIt")
             warnings.warn(
-                "showIt has been deprecated, please use show_it", FutureWarning
+                "showIt has been deprecated, please use show_it",
+                FutureWarning,
+                stacklevel=2,
             )
 
         if ax is not None:
             ax_test = ax
             if not isinstance(ax, (list, tuple, np.ndarray)):
                 ax_test = (ax,)
             for a in ax_test:
@@ -301,34 +303,44 @@
             )
 
         if "pcolorOpts" in kwargs:
             pcolor_opts = kwargs.pop("pcolorOpts")
             warnings.warn(
                 "pcolorOpts has been deprecated, please use pcolor_opts",
                 FutureWarning,
+                stacklevel=2,
             )
         if "streamOpts" in kwargs:
             stream_opts = kwargs.pop("streamOpts")
             warnings.warn(
                 "streamOpts has been deprecated, please use stream_opts",
                 FutureWarning,
+                stacklevel=2,
             )
         if "gridOpts" in kwargs:
             grid_opts = kwargs.pop("gridOpts")
             warnings.warn(
-                "gridOpts has been deprecated, please use grid_opts", FutureWarning
+                "gridOpts has been deprecated, please use grid_opts",
+                FutureWarning,
+                stacklevel=2,
             )
         if "showIt" in kwargs:
             show_it = kwargs.pop("showIt")
             warnings.warn(
-                "showIt has been deprecated, please use show_it", FutureWarning
+                "showIt has been deprecated, please use show_it",
+                FutureWarning,
+                stacklevel=2,
             )
         if "vType" in kwargs:
             v_type = kwargs.pop("vType")
-            warnings.warn("vType has been deprecated, please use v_type", FutureWarning)
+            warnings.warn(
+                "vType has been deprecated, please use v_type",
+                FutureWarning,
+                stacklevel=2,
+            )
 
         # Some Error checking and common defaults
         if pcolor_opts is None:
             pcolor_opts = {}
         if stream_opts is None:
             stream_opts = {"color": "k"}
         if grid_opts is None:
@@ -535,34 +547,44 @@
 
         normal = normal.upper()
         if "pcolorOpts" in kwargs:
             pcolor_opts = kwargs["pcolorOpts"]
             warnings.warn(
                 "pcolorOpts has been deprecated, please use pcolor_opts",
                 FutureWarning,
+                stacklevel=2,
             )
         if "streamOpts" in kwargs:
             stream_opts = kwargs["streamOpts"]
             warnings.warn(
                 "streamOpts has been deprecated, please use stream_opts",
                 FutureWarning,
+                stacklevel=2,
             )
         if "gridOpts" in kwargs:
             grid_opts = kwargs["gridOpts"]
             warnings.warn(
-                "gridOpts has been deprecated, please use grid_opts", FutureWarning
+                "gridOpts has been deprecated, please use grid_opts",
+                FutureWarning,
+                stacklevel=2,
             )
         if "showIt" in kwargs:
             show_it = kwargs["showIt"]
             warnings.warn(
-                "showIt has been deprecated, please use show_it", FutureWarning
+                "showIt has been deprecated, please use show_it",
+                FutureWarning,
+                stacklevel=2,
             )
         if "vType" in kwargs:
             v_type = kwargs["vType"]
-            warnings.warn("vType has been deprecated, please use v_type", FutureWarning)
+            warnings.warn(
+                "vType has been deprecated, please use v_type",
+                FutureWarning,
+                stacklevel=2,
+            )
         if pcolor_opts is None:
             pcolor_opts = {}
         if stream_opts is None:
             stream_opts = {"color": "k"}
         if grid_opts is None:
             if grid:
                 grid_opts = {"color": "k"}
@@ -614,29 +636,29 @@
 
         # Some user error checking
         if v_type not in v_typeOpts:
             raise ValueError(
                 "v_type must be in ['{0!s}']".format("', '".join(v_typeOpts))
             )
         if not self.dim == 3:
-            raise TypeError("Must be a 3D mesh. Use plotImage.")
+            raise TypeError("Must be a 3D mesh. Use plot_image.")
         if view not in viewOpts:
             raise ValueError("view must be in ['{0!s}']".format("', '".join(viewOpts)))
         if normal not in normalOpts:
             raise ValueError(
                 "normal must be in ['{0!s}']".format("', '".join(normalOpts))
             )
         if not isinstance(grid, bool):
             raise TypeError("grid must be a boolean")
 
         if v.dtype == complex and view == "vec":
             raise NotImplementedError("Can not plot a complex vector.")
 
         if self.dim == 2:
-            raise NotImplementedError("Must be a 3D mesh. Use plotImage.")
+            raise NotImplementedError("Must be a 3D mesh. Use plot_image.")
 
         # slice_loc errors
         if (ind is not None) and (slice_loc is not None):
             raise Warning("Both ind and slice_loc are defined. Behavior undefined.")
         # slice_loc implement
         if slice_loc is not None:
             if normal == "X":
@@ -739,14 +761,15 @@
             fig.clf()
 
         if "pcolorOpts" in kwargs:
             pcolor_opts = kwargs["pcolorOpts"]
             warnings.warn(
                 "pcolorOpts has been deprecated, please use pcolor_opts",
                 FutureWarning,
+                stacklevel=2,
             )
 
         # Populate figure
         tracker = Slicer(
             self,
             v,
             xslice,
@@ -1016,14 +1039,15 @@
         **kwargs,
     ):
         if "annotationColor" in kwargs:
             annotation_color = kwargs.pop("annotationColor")
             warnings.warn(
                 "annotationColor has been deprecated, please use annotation_color",
                 FutureWarning,
+                stacklevel=2,
             )
 
         if self.dim == 1:
             if v_type == "CC":
                 ph = ax.plot(
                     self.cell_centers_x, v, linestyle="-", color="C1", marker="o"
                 )
@@ -1494,43 +1518,47 @@
         if slc not in ["theta", "z", "both", None]:
             raise ValueError(
                 "slice must be either 'theta','z', or 'both' not {}".format(slc)
             )
 
         # if slc is None, provide slices in both the theta and z directions
         if slc == "theta":
-            return self.__plotGridThetaSlice(*args, **kwargs)
+            return self.__plot_gridThetaSlice(*args, **kwargs)
         elif slc == "z":
-            return self.__plotGridZSlice(*args, **kwargs)
+            return self.__plot_gridZSlice(*args, **kwargs)
         else:
             ax = kwargs.pop("ax", None)
             if ax is not None:
                 if not isinstance(ax, list) or len(ax) != 2:
                     warnings.warn(
                         "two axes handles must be provided to plot both theta "
-                        "and z slices through the mesh. Over-writing the axes."
+                        "and z slices through the mesh. Over-writing the axes.",
+                        stacklevel=2,
                     )
                     ax = None
                 else:
                     # find the one with a polar projection and pass it to the
                     # theta slice, other one to the z-slice
                     polarax = [
-                        a for a in ax if a.__class__.__name__ == "PolarAxesSubplot"
+                        a
+                        for a in ax
+                        if a.__class__.__name__ in ["PolarAxesSubplot", "PolarAxes"]
                     ]
                     if len(polarax) != 1:
                         warnings.warn(
                             """
                             No polar axes provided. Over-writing the axes. If you prefer to create your
                             own, please use
 
                                 `ax = plt.subplot(121, projection='polar')`
 
                             for reference, see: http://matplotlib.org/examples/pylab_examples/polar_demo.html
                                                 https://github.com/matplotlib/matplotlib/issues/312
-                            """
+                            """,
+                            stacklevel=2,
                         )
                         ax = None
 
                     else:
                         polarax = polarax[0]
                         cartax = [a for a in ax if a != polarax][0]
 
@@ -1544,41 +1572,43 @@
             kwargspolar = kwargs.copy()
             kwargspolar["ax"] = polarax
 
             kwargscart = kwargs.copy()
             kwargscart["ax"] = cartax
 
             ax = []
-            ax.append(self.__plotGridZSlice(*args, **kwargspolar))
-            ax.append(self.__plotGridThetaSlice(*args, **kwargscart))
+            ax.append(self.__plot_gridZSlice(*args, **kwargspolar))
+            ax.append(self.__plot_gridThetaSlice(*args, **kwargscart))
             plt.tight_layout()
 
         return ax
 
-    def __plotGridThetaSlice(self, *args, **kwargs):
+    def __plot_gridThetaSlice(self, *args, **kwargs):
         # make a cyl symmetric mesh
         h2d = [self.h[0], 1, self.h[2]]
         mesh2D = self.__class__(h=h2d, origin=self.origin)
         return mesh2D.plot_grid(*args, **kwargs)
 
-    def __plotGridZSlice(self, *args, **kwargs):
+    def __plot_gridZSlice(self, *args, **kwargs):
         _, plt = load_matplotlib()
         # https://github.com/matplotlib/matplotlib/issues/312
         ax = kwargs.get("ax", None)
         if ax is not None:
-            if ax.__class__.__name__ != "PolarAxesSubplot":
+            print(ax.__class__.__name__)
+            if ax.__class__.__name__ not in ["PolarAxesSubplot", "PolarAxes"]:
                 warnings.warn(
                     """
                     Creating new axes with Polar projection. If you prefer to create your own, please use
 
                         `ax = plt.subplot(121, projection='polar')`
 
                     for reference, see: http://matplotlib.org/examples/pylab_examples/polar_demo.html
                                         https://github.com/matplotlib/matplotlib/issues/312
-                    """
+                    """,
+                    stacklevel=2,
                 )
                 ax = plt.subplot(111, projection="polar")
         else:
             ax = plt.subplot(111, projection="polar")
 
         # radial lines
         NN = ndgrid(self.nodes_x, self.nodes_y, np.r_[0])[:, :2]
@@ -1597,17 +1627,21 @@
 
         color = kwargs.get("color", "C0")
         linewidth = kwargs.get("linewidth", 1.0)
         ax.plot(Y1, X1, linestyle="-", color=color, lw=linewidth)
 
         # circles
         n = 100
+        if self.is_wrapped:
+            th = np.linspace(0, 2 * np.pi, n)
+        else:
+            th = np.linspace(self.nodes_y[0], self.nodes_y[-1], n)
         for r in self.nodes_x:
             ax.plot(
-                np.linspace(0.0, np.pi * 2, n),
+                th,
                 r * np.ones(n),
                 linestyle="-",
                 color=color,
                 lw=linewidth,
             )
 
         return ax
@@ -1973,15 +2007,15 @@
         quiver_opts=None,
         **kwargs,
     ):
         from matplotlib.collections import PolyCollection  # lazy loaded
 
         if self.dim == 3:
             raise NotImplementedError(
-                "plotImage is not implemented for 3D TreeMesh, please use plotSlice"
+                "plot_image is not implemented for 3D TreeMesh, please use plot_slice"
             )
         # reshape to cell_centered thing
         if v_type == "CC":
             pass
         if v_type == "CCv":
             if view != "vec":
                 raise ValueError("Other types for CCv not supported")
@@ -2426,22 +2460,23 @@
 
         # 0. Some checks, not very extensive
         if "pcolorOpts" in kwargs:
             pcolor_opts = kwargs["pcolorOpts"]
             warnings.warn(
                 "pcolorOpts has been deprecated, please use pcolor_opts",
                 FutureWarning,
+                stacklevel=2,
             )
 
         # Add pcolor_opts to self
         self.pc_props = pcolor_opts if pcolor_opts is not None else {}
 
         # (a) Mesh dimensionality
         if mesh.dim != 3:
-            err = "Must be a 3D mesh. Use plotImage instead."
+            err = "Must be a 3D mesh. Use plot_image instead."
             err += " Mesh provided has {} dimension(s).".format(mesh.dim)
             raise ValueError(err)
 
         # (b) v_type  # Not yet working for ['CCv']
         v_typeOpts = ["CC", "Fx", "Fy", "Fz", "Ex", "Ey", "Ez"]
         if v_type not in v_typeOpts:
             err = "v_type must be in ['{0!s}'].".format("', '".join(v_typeOpts))
@@ -2545,14 +2580,16 @@
 
         # Get plot2grid dimension
         figgrid = (grid[0] + grid[2], grid[1] + grid[2])
 
         # Create subplots
         self.fig = plt.gcf()
         self.fig.subplots_adjust(wspace=0.075, hspace=0.1)
+        # To capture mouse scroll in notebooks (otherwise it is hard to slice through volume)
+        self.fig.canvas.capture_scroll = True
 
         # X-Y
         self.ax1 = plt.subplot2grid(
             figgrid, (0, 0), colspan=grid[1], rowspan=grid[0], aspect=aspect1
         )
         if self.yx:
             self.ax1.set_ylabel("x")
```

### Comparing `discretize-0.8.3/discretize/mixins/omf_mod.py` & `discretize-0.9.0/discretize/mixins/omf_mod.py`

 * *Files 20% similar despite different names*

```diff
@@ -49,74 +49,70 @@
     >>> import numpy as np
 
     >>> hx = np.ones(4)
     >>> hy = 2*np.ones(3)
     >>> hz = 3*np.ones(2)
     >>> mesh = TensorMesh([hx, hy, hz])
 
-    >>> dim = (mesh.nCz, mesh.nCy, mesh.nCx)  # OMF orderting
+    >>> dim = mesh.shape_cells[::-1] # OMF orderting
     >>> xc = np.reshape(mesh.cell_centers[:, 0], dim, order="C").ravel(order="F")
     >>> yc = np.reshape(mesh.cell_centers[:, 1], dim, order="C").ravel(order="F")
     >>> zc = np.reshape(mesh.cell_centers[:, 2], dim, order="C").ravel(order="F")
 
-    .. collapse:: Original ordering. Click to expand
-
-        >>> mesh.cell_centers
-        array([[0.5, 1. , 1.5],
-               [1.5, 1. , 1.5],
-               [2.5, 1. , 1.5],
-               [3.5, 1. , 1.5],
-               [0.5, 3. , 1.5],
-               [1.5, 3. , 1.5],
-               [2.5, 3. , 1.5],
-               [3.5, 3. , 1.5],
-               [0.5, 5. , 1.5],
-               [1.5, 5. , 1.5],
-               [2.5, 5. , 1.5],
-               [3.5, 5. , 1.5],
-               [0.5, 1. , 4.5],
-               [1.5, 1. , 4.5],
-               [2.5, 1. , 4.5],
-               [3.5, 1. , 4.5],
-               [0.5, 3. , 4.5],
-               [1.5, 3. , 4.5],
-               [2.5, 3. , 4.5],
-               [3.5, 3. , 4.5],
-               [0.5, 5. , 4.5],
-               [1.5, 5. , 4.5],
-               [2.5, 5. , 4.5],
-               [3.5, 5. , 4.5]])
-
-    .. collapse:: OMF ordering. Click to expand
-
-        >>> np.c_[xc, yc, zc]
-        array([[0.5, 1. , 1.5],
-               [0.5, 1. , 4.5],
-               [0.5, 3. , 1.5],
-               [0.5, 3. , 4.5],
-               [0.5, 5. , 1.5],
-               [0.5, 5. , 4.5],
-               [1.5, 1. , 1.5],
-               [1.5, 1. , 4.5],
-               [1.5, 3. , 1.5],
-               [1.5, 3. , 4.5],
-               [1.5, 5. , 1.5],
-               [1.5, 5. , 4.5],
-               [2.5, 1. , 1.5],
-               [2.5, 1. , 4.5],
-               [2.5, 3. , 1.5],
-               [2.5, 3. , 4.5],
-               [2.5, 5. , 1.5],
-               [2.5, 5. , 4.5],
-               [3.5, 1. , 1.5],
-               [3.5, 1. , 4.5],
-               [3.5, 3. , 1.5],
-               [3.5, 3. , 4.5],
-               [3.5, 5. , 1.5],
-               [3.5, 5. , 4.5]])
+    >>> mesh.cell_centers
+    array([[0.5, 1. , 1.5],
+           [1.5, 1. , 1.5],
+           [2.5, 1. , 1.5],
+           [3.5, 1. , 1.5],
+           [0.5, 3. , 1.5],
+           [1.5, 3. , 1.5],
+           [2.5, 3. , 1.5],
+           [3.5, 3. , 1.5],
+           [0.5, 5. , 1.5],
+           [1.5, 5. , 1.5],
+           [2.5, 5. , 1.5],
+           [3.5, 5. , 1.5],
+           [0.5, 1. , 4.5],
+           [1.5, 1. , 4.5],
+           [2.5, 1. , 4.5],
+           [3.5, 1. , 4.5],
+           [0.5, 3. , 4.5],
+           [1.5, 3. , 4.5],
+           [2.5, 3. , 4.5],
+           [3.5, 3. , 4.5],
+           [0.5, 5. , 4.5],
+           [1.5, 5. , 4.5],
+           [2.5, 5. , 4.5],
+           [3.5, 5. , 4.5]])
+
+    >>> np.c_[xc, yc, zc]
+    array([[0.5, 1. , 1.5],
+           [0.5, 1. , 4.5],
+           [0.5, 3. , 1.5],
+           [0.5, 3. , 4.5],
+           [0.5, 5. , 1.5],
+           [0.5, 5. , 4.5],
+           [1.5, 1. , 1.5],
+           [1.5, 1. , 4.5],
+           [1.5, 3. , 1.5],
+           [1.5, 3. , 4.5],
+           [1.5, 5. , 1.5],
+           [1.5, 5. , 4.5],
+           [2.5, 1. , 1.5],
+           [2.5, 1. , 4.5],
+           [2.5, 3. , 1.5],
+           [2.5, 3. , 4.5],
+           [2.5, 5. , 1.5],
+           [2.5, 5. , 4.5],
+           [3.5, 1. , 1.5],
+           [3.5, 1. , 4.5],
+           [3.5, 3. , 1.5],
+           [3.5, 3. , 4.5],
+           [3.5, 5. , 1.5],
+           [3.5, 5. , 4.5]])
     """
     dim = (nz, ny, nx)
     return np.reshape(arr, dim, order="C").ravel(order="F")
 
 
 def _unravel_data_array(arr, nx, ny, nz):
     """Unravel an array from omf ordering to discretize ordering.
@@ -205,22 +201,23 @@
         elif len(tensors) == 3:
             geometry.tensor_u = tensors[0]
             geometry.tensor_v = tensors[1]
             geometry.tensor_w = tensors[2]
         else:
             raise RuntimeError("This mesh is too high-dimensional for OMF")
         # Set rotation axes
-        geometry.axis_u = mesh.axis_u
-        geometry.axis_v = mesh.axis_v
-        geometry.axis_w = mesh.axis_w
+        orientation = mesh.orientation
+        geometry.axis_u = orientation[0]
+        geometry.axis_v = orientation[1]
+        geometry.axis_w = orientation[2]
         # Set the origin
         geometry.origin = mesh.origin
         # Make sure the geometry is built correctly
         geometry.validate()
-        # Make the volume elemet (the OMF object)
+        # Make the volume element (the OMF object)
         omfmesh = omf().VolumeElement(
             geometry=geometry,
         )
         # Add model data arrays onto the cells of the mesh
         omfmesh.data = []
         for name, arr in models.items():
             data = omf().ScalarData(
@@ -277,19 +274,22 @@
         return convert(mesh, models=models)
 
     @staticmethod
     def _omf_volume_to_tensor(element):
         """Convert an :class:`omf.VolumeElement` to :class:`discretize.TensorMesh`."""
         geometry = element.geometry
         h = [geometry.tensor_u, geometry.tensor_v, geometry.tensor_w]
-        mesh = discretize.TensorMesh(h)
-        mesh.axis_u = geometry.axis_u
-        mesh.axis_v = geometry.axis_v
-        mesh.axis_w = geometry.axis_w
-        mesh.origin = geometry.origin
+        orientation = np.array(
+            [
+                geometry.axis_u,
+                geometry.axis_v,
+                geometry.axis_w,
+            ]
+        )
+        mesh = discretize.TensorMesh(h, origin=geometry.origin, orientation=orientation)
 
         data_dict = {}
         for data in element.data:
             # NOTE: this is agnostic about data location - i.e. nodes vs cells
             data_dict[data.name] = _unravel_data_array(
                 np.array(data.array), *mesh.shape_cells
             )
```

### Comparing `discretize-0.8.3/discretize/mixins/vtk_mod.py` & `discretize-0.9.0/discretize/mixins/vtk_mod.py`

 * *Files 2% similar despite different names*

```diff
@@ -53,16 +53,14 @@
 .. _`Laguna del Maule Bouguer Gravity`: http://docs.simpeg.xyz/content/examples/20-published/plot_laguna_del_maule_inversion.html
 
 """
 import os
 import numpy as np
 from discretize.utils import cyl2cart
 
-# from ..utils import cyl2cart
-
 import warnings
 
 
 def load_vtk(extra=None):
     """Lazy load principal VTK routines.
 
     This is not beautiful. But if VTK is installed, but never used, it reduces
@@ -142,15 +140,15 @@
 
     Get a VTK data object
 
     >>> dataset = mesh.to_vtk()
 
     Save this mesh to a VTK file
 
-    >>> mesh.writeVTK('sample_mesh')
+    >>> mesh.write_vtk('sample_mesh')
 
     Here, the reference frame of the mesh is rotated. In this case, conversion
     to VTK produces a :class:`pyvista.StructuredGrid` object.
 
     >>> axis_u = (1,-1,0)
     >>> axis_v = (-1,-1,0)
     >>> axis_w = (0,0,1)
@@ -162,15 +160,15 @@
 
     Yield the rotated vtkStructuredGrid
 
     >>> dataset_r = mesh.to_vtk()
 
     or write it out to a VTK format
 
-    >>> mesh.writeVTK('sample_rotated')
+    >>> mesh.write_vtk('sample_rotated')
 
     The two above code snippets produced a :class:`pyvista.RectilinearGrid` and a
     :class:`pyvista.StructuredGrid` respecitvely. To demonstarte the difference, we
     have plotted the two datasets next to each other where the first mesh is in
     green and its data axes are parrallel to the traditional cartesian reference
     frame. The second, rotated mesh is shown in red and its data axes are
     rotated from the traditional Cartesian reference frame as specified by the
@@ -402,25 +400,33 @@
 
     def __cyl_mesh_to_vtk(mesh, models=None):
         """Convert the CylindricalMesh to a vtk object.
 
         Constructs an vtkUnstructuredGrid made of rational Bezier hexahedrons and wedges.
         Wedges happen on the very internal layer about r=0, and hexes occur elsewhere.
         """
-        # # Points
-        P = mesh._deflation_matrix("nodes", as_ones=True).T.tocsr()
-
         if np.any(mesh.h[1] >= np.pi):
             raise NotImplementedError(
                 "Exporting cylindrical meshes to vtk with angles larger than 180 degrees"
                 " is not yet supported."
             )
+        # # Points
+        deflate_nodes = mesh._n_total_nodes != mesh.n_nodes
+        if deflate_nodes:
+            inds = np.empty(mesh._n_total_nodes, dtype=int)
+            is_hanging_nodes = mesh._ishanging_nodes
+            inds[~is_hanging_nodes] = np.arange(mesh.n_nodes)
+            inds[is_hanging_nodes] = list(mesh._hanging_nodes.values())
+
         # calculate control points
         dphis_half = mesh.h[1] / 2
-        phi_controls = mesh.nodes_y + dphis_half
+        if mesh.is_wrapped:
+            phi_controls = mesh.nodes_y + dphis_half
+        else:
+            phi_controls = mesh.nodes_y[:-1] + dphis_half
         if mesh.nodes_x[0] == 0.0:
             Rs, Phis, Zs = np.meshgrid(
                 mesh.nodes_x[1:], phi_controls, mesh.nodes_z, indexing="ij"
             )
         else:
             Rs, Phis, Zs = np.meshgrid(
                 mesh.nodes_x, phi_controls, mesh.nodes_z, indexing="ij"
@@ -430,15 +436,15 @@
         control_nodes = np.c_[
             Rs.reshape(-1, order="F"),
             Phis.reshape(-1, order="F"),
             Zs.reshape(-1, order="F"),
         ]
 
         cells = np.arange(mesh.n_cells).reshape(mesh.shape_cells, order="F")
-        if mesh.nodes_x[0] == 0.0:
+        if mesh.includes_zero:
             wedge_cells = cells[0].reshape(-1, order="F")
             hex_cells = (cells[1:]).reshape(-1, order="F")
         else:
             hex_cells = cells.reshape(-1, order="F")
 
         # Hex Cells...
         # calculate indices
@@ -446,25 +452,26 @@
 
         irs = np.stack([ir, ir, ir + 1, ir + 1, ir, ir, ir + 1, ir + 1], axis=-1)
         its = np.stack([it + 1, it, it, it + 1, it + 1, it, it, it + 1], axis=-1)
         izs = np.stack([iz, iz, iz, iz, iz + 1, iz + 1, iz + 1, iz + 1], axis=-1)
         i_hex_nodes = np.ravel_multi_index(
             (irs, its, izs), mesh._shape_total_nodes, order="F"
         )
-        i_hex_nodes = P.indices[i_hex_nodes]
+        if deflate_nodes:
+            i_hex_nodes = inds[i_hex_nodes]
 
-        if mesh.nodes_x[0] == 0.0:
+        if mesh.includes_zero:
             irs = np.stack([ir - 1, ir, ir - 1, ir], axis=-1)
         else:
             irs = np.stack([ir, ir + 1, ir, ir + 1], axis=-1)
         its = np.stack([it, it, it, it], axis=-1)
         izs = np.stack([iz, iz, iz + 1, iz + 1], axis=-1)
         i_hex_control_nodes = np.ravel_multi_index((irs, its, izs), Rs.shape, order="F")
 
-        if mesh.nodes_x[0] == 0.0:
+        if mesh.includes_zero:
             # Wedge Cells nodes
             # put control points along radial edge for halfway points on the edges...
             Phis, Zs = np.meshgrid(mesh.nodes_y, mesh.nodes_z, indexing="ij")
             Rhalfs = np.full_like(Phis, mesh.nodes_x[1] * 0.5)
             wedge_control_nodes = np.c_[
                 Rhalfs.reshape(-1, order="F"),
                 Phis.reshape(-1, order="F"),
@@ -477,15 +484,16 @@
             )
             irs = np.stack([ir, ir + 1, ir + 1, ir, ir + 1, ir + 1], axis=-1)
             its = np.stack([it, it, it + 1, it, it, it + 1], axis=-1)
             izs = np.stack([iz, iz, iz, iz + 1, iz + 1, iz + 1], axis=-1)
             i_wedge_nodes = np.ravel_multi_index(
                 (irs, its, izs), mesh._shape_total_nodes, order="F"
             )
-            i_wedge_nodes = P.indices[i_wedge_nodes]
+            if deflate_nodes:
+                i_wedge_nodes = inds[i_wedge_nodes]
 
             its = np.stack([it, it + 1, it, it + 1], axis=-1)
             izs = np.stack([iz, iz, iz + 1, iz + 1], axis=-1)
             # wrap mode for the duplicated wedge control nodes
             i_wscn = np.ravel_multi_index(
                 (its, izs), Rhalfs.shape, order="F", mode="wrap"
             ) + len(control_nodes)
@@ -512,26 +520,33 @@
         cell_con = np.empty((mesh.n_cells, 13), dtype=int)
         cell_con[:, 0] = 12
         cell_con[hex_cells, 1:9] = i_hex_nodes
         cell_con[hex_cells, 9:] = i_hex_control_nodes + mesh.n_nodes
         nodes_cyl = np.r_[mesh.nodes, control_nodes]
 
         # calculate weights for control points
-        control_weights = (
-            np.sin(np.pi / 2 - dphis_half)[None, :, None]
-            * np.ones((mesh.shape_nodes[0] - 1, mesh.shape_nodes[2]))[:, None, :]
-        )
+        if mesh.includes_zero:
+            control_weights = (
+                np.sin(np.pi / 2 - dphis_half)[None, :, None]
+                * np.ones((mesh.shape_nodes[0] - 1, mesh.shape_nodes[2]))[:, None, :]
+            )
+        else:
+            control_weights = (
+                np.sin(np.pi / 2 - dphis_half)[None, :, None]
+                * np.ones((mesh.shape_nodes[0], mesh.shape_nodes[2]))[:, None, :]
+            )
+
         rational_weights = np.r_[
             np.ones(mesh.n_nodes), control_weights.reshape(-1, order="F")
         ]
 
         higher_order_degrees = np.empty((mesh.n_cells, 3))
         higher_order_degrees[hex_cells, :] = [2, 1, 1]
 
-        if mesh.nodes_x[0] == 0.0:
+        if mesh.includes_zero:
             cell_types[wedge_cells] = _vtk.VTK_BEZIER_WEDGE
             cell_con[wedge_cells, 1:7] = i_wedge_nodes
             cell_con[wedge_cells, 7:] = i_wedge_control_nodes + mesh.n_nodes
             nodes_cyl = np.r_[nodes_cyl, wedge_control_nodes]
             rational_weights = np.r_[
                 rational_weights, np.ones(len(wedge_control_nodes))
             ]
@@ -602,15 +617,16 @@
         cvtd = convert(mesh, models=models)
         try:
             import pyvista
 
             cvtd = pyvista.wrap(cvtd)
         except ImportError:
             warnings.warn(
-                "For easier use of VTK objects, you should install `pyvista` (the VTK interface): pip install pyvista"
+                "For easier use of VTK objects, you should install `pyvista` (the VTK interface): pip install pyvista",
+                stacklevel=1,
             )
         return cvtd
 
     def toVTK(mesh, models=None):
         """Convert mesh (and models) to corresponding VTK or PyVista data object.
 
         *toVTK* has been deprecated and replaced by *to_vtk*.
@@ -618,14 +634,15 @@
         See Also
         --------
         to_vtk
         """
         warnings.warn(
             "Deprecation Warning: `toVTK` is deprecated, use `to_vtk` instead",
             category=FutureWarning,
+            stacklevel=2,
         )
         return InterfaceVTK.to_vtk(mesh, models=models)
 
     @staticmethod
     def _save_unstructured_grid(file_name, vtkUnstructGrid, directory=""):
         """Save an unstructured grid to a vtk file.
 
@@ -784,14 +801,15 @@
         See Also
         --------
         write_vtk
         """
         warnings.warn(
             "Deprecation Warning: `writeVTK` is deprecated, use `write_vtk` instead",
             category=FutureWarning,
+            stacklevel=2,
         )
         return InterfaceVTK.write_vtk(
             mesh, file_name, models=models, directory=directory
         )
 
 
 class InterfaceTensorread_vtk(object):
@@ -896,14 +914,15 @@
         See Also
         --------
         read_vtk
         """
         warnings.warn(
             "Deprecation Warning: `readVTK` is deprecated, use `read_vtk` instead",
             category=FutureWarning,
+            stacklevel=2,
         )
         return InterfaceTensorread_vtk.read_vtk(
             TensorMesh, file_name, directory=directory
         )
 
 
 class InterfaceSimplexReadVTK:
```

### Comparing `discretize-0.8.3/discretize/operators/__init__.py` & `discretize-0.9.0/discretize/operators/__init__.py`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/operators/differential_operators.py` & `discretize-0.9.0/discretize/operators/differential_operators.py`

 * *Files 4% similar despite different names*

```diff
@@ -282,71 +282,66 @@
         Construct the x-divergence operator and apply to vector
 
         >>> Dx = mesh.face_x_divergence
         >>> dphi_dx = Dx @ phi
 
         Plot the original function and the x-divergence
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 6))
-            >>> ax1 = fig.add_subplot(121)
-            >>> w = np.r_[phi, np.ones(mesh.nFy)]  # Need vector on all faces for image plot
-            >>> mesh.plot_image(w, ax=ax1, v_type="Fx")
-            >>> ax1.set_title("Scalar on x-faces", fontsize=14)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(dphi_dx, ax=ax2)
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("X-derivative at cell center", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 6))
+        >>> ax1 = fig.add_subplot(121)
+        >>> w = np.r_[phi, np.ones(mesh.nFy)]  # Need vector on all faces for image plot
+        >>> mesh.plot_image(w, ax=ax1, v_type="Fx")
+        >>> ax1.set_title("Scalar on x-faces", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(dphi_dx, ax=ax2)
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("X-derivative at cell center", fontsize=14)
+        >>> plt.show()
 
         The discrete x-face divergence operator is a sparse matrix that maps
         from x-faces to cell centers. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements in
         the original discrete quantity :math:`\boldsymbol{\phi}}` and its
         x-derivative :math:`\partial \boldsymbol{\phi}}/ \partial x` as well as a
         spy plot.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> mesh = TensorMesh([[(1, 6)], [(1, 3)]])
-            >>> fig = plt.figure(figsize=(10, 10))
-            >>> ax1 = fig.add_subplot(211)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.plot(
-            ...     mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8
-            ... )
-            >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
-            ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="g")
-            >>> ax1.plot(
-            ...     mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8
-            ... )
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="r")
-
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.set_title("Mapping of Face-X Divergence", fontsize=14, pad=15)
-            >>> ax1.legend(
-            ...     ['Mesh', '$\mathbf{\phi}$ (x-faces)', '$\partial \mathbf{phi}/\partial x$ (centers)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-            >>> ax2 = fig.add_subplot(212)
-            >>> ax2.spy(mesh.face_x_divergence)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("Cell Index", fontsize=12)
-            >>> ax2.set_xlabel("X-Face Index", fontsize=12)
-            >>> plt.show()
+        >>> mesh = TensorMesh([[(1, 6)], [(1, 3)]])
+        >>> fig = plt.figure(figsize=(10, 10))
+        >>> ax1 = fig.add_subplot(211)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.plot(
+        ...     mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8
+        ... )
+        >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
+        ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="g")
+        >>> ax1.plot(
+        ...     mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8
+        ... )
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.set_title("Mapping of Face-X Divergence", fontsize=14, pad=15)
+        >>> ax1.legend(
+        ...     ['Mesh', '$\mathbf{\phi}$ (x-faces)', '$\partial \mathbf{phi}/\partial x$ (centers)'],
+        ...     loc='upper right', fontsize=14
+        ... )
+        >>> ax2 = fig.add_subplot(212)
+        >>> ax2.spy(mesh.face_x_divergence)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("Cell Index", fontsize=12)
+        >>> ax2.set_xlabel("X-Face Index", fontsize=12)
+        >>> plt.show()
         """
         # Compute areas of cell faces & volumes
         S = self.reshape(self.face_areas, "F", "Fx", "V")
         V = self.cell_volumes
         return sdiag(1 / V) * self._face_x_divergence_stencil * sdiag(S)
 
     @property
@@ -399,71 +394,66 @@
         Construct the y-divergence operator and apply to vector
 
         >>> Dy = mesh.face_y_divergence
         >>> dphi_dy = Dy @ phi
 
         Plot original function and the y-divergence
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 6))
-            >>> ax1 = fig.add_subplot(121)
-            >>> w = np.r_[np.ones(mesh.nFx), phi]  # Need vector on all faces for image plot
-            >>> mesh.plot_image(w, ax=ax1, v_type="Fy")
-            >>> ax1.set_title("Scalar on y-faces", fontsize=14)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(dphi_dy, ax=ax2)
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Y-derivative at cell center", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 6))
+        >>> ax1 = fig.add_subplot(121)
+        >>> w = np.r_[np.ones(mesh.nFx), phi]  # Need vector on all faces for image plot
+        >>> mesh.plot_image(w, ax=ax1, v_type="Fy")
+        >>> ax1.set_title("Scalar on y-faces", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(dphi_dy, ax=ax2)
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Y-derivative at cell center", fontsize=14)
+        >>> plt.show()
 
         The discrete y-face divergence operator is a sparse matrix that maps
         from y-faces to cell centers. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements in
         the original discrete quantity :math:`\boldsymbol{\phi}` and its
         y-derivative :math:`\partial \boldsymbol{\phi}/ \partial y` as well as a
         spy plot.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> mesh = TensorMesh([[(1, 6)], [(1, 3)]])
-            >>> fig = plt.figure(figsize=(10, 10))
-            >>> ax1 = fig.add_subplot(211)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.plot(
-            ...     mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8
-            ... )
-            >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
-            ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="g")
-            >>> ax1.plot(
-            ...     mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8
-            ... )
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="r")
-
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.set_title("Mapping of Face-Y Divergence", fontsize=14, pad=15)
-            >>> ax1.legend(
-            ...     ['Mesh','$\mathbf{\phi}$ (y-faces)','$\partial_y \mathbf{\phi}/\partial y$ (centers)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-            >>> ax2 = fig.add_subplot(212)
-            >>> ax2.spy(mesh.face_y_divergence)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("Cell Index", fontsize=12)
-            >>> ax2.set_xlabel("Y-Face Index", fontsize=12)
-            >>> plt.show()
+        >>> mesh = TensorMesh([[(1, 6)], [(1, 3)]])
+        >>> fig = plt.figure(figsize=(10, 10))
+        >>> ax1 = fig.add_subplot(211)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.plot(
+        ...     mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8
+        ... )
+        >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
+        ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="g")
+        >>> ax1.plot(
+        ...     mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8
+        ... )
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0]+0.05, loc[1]+0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.set_title("Mapping of Face-Y Divergence", fontsize=14, pad=15)
+        >>> ax1.legend(
+        ...     ['Mesh','$\mathbf{\phi}$ (y-faces)','$\partial_y \mathbf{\phi}/\partial y$ (centers)'],
+        ...     loc='upper right', fontsize=14
+        ... )
+        >>> ax2 = fig.add_subplot(212)
+        >>> ax2.spy(mesh.face_y_divergence)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("Cell Index", fontsize=12)
+        >>> ax2.set_xlabel("Y-Face Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 2:
             return None
         # Compute areas of cell faces & volumes
         S = self.reshape(self.face_areas, "F", "Fy", "V")
         V = self.cell_volumes
         return sdiag(1 / V) * self._face_y_divergence_stencil * sdiag(S)
@@ -517,57 +507,52 @@
         Construct the z-divergence operator and apply to vector
 
         >>> Dz = mesh.face_z_divergence
         >>> dphi_dz = Dz @ phi
 
         Plot the original function and the z-divergence
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 6))
-            >>> ax1 = fig.add_subplot(121)
-            >>> w = np.r_[np.ones(mesh.nFx+mesh.nFz), phi]  # Need vector on all faces for image plot
-            >>> mesh.plot_slice(w, ax=ax1, v_type="Fz", normal='Y', ind=20)
-            >>> ax1.set_title("Scalar on z-faces (y-slice)", fontsize=14)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_slice(dphi_dz, ax=ax2, normal='Y', ind=20)
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Z-derivative at cell center (y-slice)", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 6))
+        >>> ax1 = fig.add_subplot(121)
+        >>> w = np.r_[np.ones(mesh.nFx+mesh.nFz), phi]  # Need vector on all faces for image plot
+        >>> mesh.plot_slice(w, ax=ax1, v_type="Fz", normal='Y', ind=20)
+        >>> ax1.set_title("Scalar on z-faces (y-slice)", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_slice(dphi_dz, ax=ax2, normal='Y', ind=20)
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Z-derivative at cell center (y-slice)", fontsize=14)
+        >>> plt.show()
 
         The discrete z-face divergence operator is a sparse matrix that maps
         from z-faces to cell centers. To demonstrate this, we construct
         a small 3D mesh. We then show the ordering of the elements in
         the original discrete quantity :math:`\boldsymbol{\phi}` and its
         z-derivative :math:`\partial \boldsymbol{\phi}/ \partial z` as well as a
         spy plot.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> mesh = TensorMesh([[(1, 3)], [(1, 2)], [(1, 2)]])
-            >>> fig = plt.figure(figsize=(9, 12))
-            >>> ax1 = fig.add_axes([0, 0.35, 1, 0.6], projection='3d', elev=10, azim=-82)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.plot(
-            ...     mesh.faces_z[:, 0], mesh.faces_z[:, 1], mesh.faces_z[:, 2], "g^", markersize=10
-            ... )
-            >>> for ii, loc in zip(range(mesh.nFz), mesh.faces_z):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.05, loc[2], "{0:d}".format(ii), color="g")
-
-            >>> ax1.plot(
-            ...    mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], mesh.cell_centers[:, 2],
-            ...    "ro", markersize=10
-            ... )
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.05, loc[2], "{0:d}".format(ii), color="r")
-            >>> ax1.legend(
-            ...     ['Mesh','$\mathbf{\phi}$ (z-faces)','$\partial \mathbf{\phi}/\partial z$ (centers)'],
-            ...     loc='upper right', fontsize=14
-            ... )
+        >>> mesh = TensorMesh([[(1, 3)], [(1, 2)], [(1, 2)]])
+        >>> fig = plt.figure(figsize=(9, 12))
+        >>> ax1 = fig.add_axes([0, 0.35, 1, 0.6], projection='3d', elev=10, azim=-82)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.plot(
+        ...     mesh.faces_z[:, 0], mesh.faces_z[:, 1], mesh.faces_z[:, 2], "g^", markersize=10
+        ... )
+        >>> for ii, loc in zip(range(mesh.nFz), mesh.faces_z):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.05, loc[2], "{0:d}".format(ii), color="g")
+        >>> ax1.plot(
+        ...    mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], mesh.cell_centers[:, 2],
+        ...    "ro", markersize=10
+        ... )
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.05, loc[2], "{0:d}".format(ii), color="r")
+        >>> ax1.legend(
+        ...     ['Mesh','$\mathbf{\phi}$ (z-faces)','$\partial \mathbf{\phi}/\partial z$ (centers)'],
+        ...     loc='upper right', fontsize=14
+        ... )
 
             Manually make axis properties invisible
 
             >>> ax1.set_xticks([])
             >>> ax1.set_yticks([])
             >>> ax1.set_zticks([])
             >>> ax1.w_xaxis.set_pane_color((1.0, 1.0, 1.0, 0.0))
@@ -675,29 +660,35 @@
             L = self.edge_lengths
             self._nodal_gradient = sdiag(1 / L) * G
         return self._nodal_gradient
 
     @property
     def _nodal_laplacian_x_stencil(self):
         """Stencil for the nodal Laplacian in the x-direction (nodes to nodes)."""
-        warnings.warn("Laplacian has not been tested rigorously.")
+        warnings.warn(
+            "Laplacian has not been tested rigorously.",
+            stacklevel=3,
+        )
 
         Dx = ddx(self.shape_cells[0])
         Lx = -Dx.T * Dx
 
         if self.dim == 2:
             Lx = sp.kron(speye(self.shape_nodes[1]), Lx)
         elif self.dim == 3:
             Lx = kron3(speye(self.shape_nodes[2]), speye(self.shape_nodes[1]), Lx)
         return Lx
 
     @property
     def _nodal_laplacian_y_stencil(self):
         """Stencil for the nodal Laplacian in the y-direction (nodes to nodes)."""
-        warnings.warn("Laplacian has not been tested rigorously.")
+        warnings.warn(
+            "Laplacian has not been tested rigorously.",
+            stacklevel=3,
+        )
 
         if self.dim == 1:
             return None
 
         Dy = ddx(self.shape_cells[1])
         Ly = -Dy.T * Dy
 
@@ -706,15 +697,18 @@
         elif self.dim == 3:
             Ly = kron3(speye(self.shape_nodes[2]), Ly, speye(self.shape_nodes[0]))
         return Ly
 
     @property
     def _nodal_laplacian_z_stencil(self):
         """Stencil for the nodal Laplacian in the z-direction (nodes to nodes)."""
-        warnings.warn("Laplacian has not been tested rigorously.")
+        warnings.warn(
+            "Laplacian has not been tested rigorously.",
+            stacklevel=3,
+        )
 
         if self.dim == 1 or self.dim == 2:
             return None
 
         Dz = ddx(self.shape_cells[2])
         Lz = -Dz.T * Dz
         return kron3(Lz, speye(self.shape_nodes[1]), speye(self.shape_nodes[0]))
@@ -750,15 +744,18 @@
         Hz = kron3(Hz, speye(self.shape_nodes[1]), speye(self.shape_nodes[0]))
         return Hz.T * self._nodal_laplacian_z_stencil * Hz
 
     @property
     def nodal_laplacian(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         if getattr(self, "_nodal_laplacian", None) is None:
-            warnings.warn("Laplacian has not been tested rigorously.")
+            warnings.warn(
+                "Laplacian has not been tested rigorously.",
+                stacklevel=2,
+            )
             # Compute divergence operator on faces
             if self.dim == 1:
                 self._nodal_laplacian = self._nodal_laplacian_x
             elif self.dim == 2:
                 self._nodal_laplacian = (
                     self._nodal_laplacian_x + self._nodal_laplacian_y
                 )
@@ -1112,68 +1109,62 @@
         >>> mesh.set_cell_gradient_BC(['neumann', 'neumann'])
         >>> Gx = mesh.stencil_cell_gradient_x
         >>> diff_phi_x = Gx @ phi
 
         Now we plot the original scalar, and the differencing taken along the
         x axes.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi, ax=ax1)
-            >>> ax1.set_title("Scalar at cell centers", fontsize=14)
-
-            >>> ax2 = fig.add_subplot(122)
-            >>> v = np.r_[diff_phi_x, np.zeros(mesh.nFy)]  # Define vector for plotting fun
-            >>> mesh.plot_image(v, ax=ax2, v_type="Fx")
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Difference (x-axis)", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi, ax=ax1)
+        >>> ax1.set_title("Scalar at cell centers", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> v = np.r_[diff_phi_x, np.zeros(mesh.nFy)]  # Define vector for plotting fun
+        >>> mesh.plot_image(v, ax=ax2, v_type="Fx")
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Difference (x-axis)", fontsize=14)
+        >>> plt.show()
 
         The x-component cell gradient stencil is a sparse differencing matrix
         that maps from cell centers to x-faces. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements
         and a spy plot.
 
         >>> mesh = TensorMesh([[(1, 3)], [(1, 4)]])
         >>> mesh.set_cell_gradient_BC('neumann')
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(12, 8))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.set_title("Mapping of Stencil", fontsize=14, pad=15)
-
-            >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
-            >>> ax1.plot(mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.legend(
-            ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{Gx^* \phi}$ (x-faces)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-            >>> ax2 = fig.add_subplot(122)
-            >>> ax2.spy(mesh.stencil_cell_gradient_x)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("X-Face Index", fontsize=12)
-            >>> ax2.set_xlabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(12, 8))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.set_title("Mapping of Stencil", fontsize=14, pad=15)
+        >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.plot(mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.legend(
+        ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{Gx^* \phi}$ (x-faces)'],
+        ...     loc='upper right', fontsize=14
+        ... )
+        >>> ax2 = fig.add_subplot(122)
+        >>> ax2.spy(mesh.stencil_cell_gradient_x)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("X-Face Index", fontsize=12)
+        >>> ax2.set_xlabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         BC = ["neumann", "neumann"]
         if self.dim == 1:
             G1 = _ddxCellGrad(self.shape_cells[0], BC)
         elif self.dim == 2:
             G1 = sp.kron(
                 speye(self.shape_cells[1]), _ddxCellGrad(self.shape_cells[0], BC)
@@ -1252,68 +1243,61 @@
         >>> mesh.set_cell_gradient_BC(['neumann', 'neumann'])
         >>> Gy = mesh.stencil_cell_gradient_y
         >>> diff_phi_y = Gy @ phi
 
         Now we plot the original scalar, and the differencing taken along the
         y-axis.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi, ax=ax1)
-            >>> ax1.set_title("Scalar at cell centers", fontsize=14)
-            >>> ax2 = fig.add_subplot(122)
-            >>> v = np.r_[np.zeros(mesh.nFx), diff_phi_y]  # Define vector for plotting fun
-            >>> mesh.plot_image(v, ax=ax2, v_type="Fy")
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Difference (y-axis)", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi, ax=ax1)
+        >>> ax1.set_title("Scalar at cell centers", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> v = np.r_[np.zeros(mesh.nFx), diff_phi_y]  # Define vector for plotting fun
+        >>> mesh.plot_image(v, ax=ax2, v_type="Fy")
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Difference (y-axis)", fontsize=14)
+        >>> plt.show()
 
         The y-component cell gradient stencil is a sparse differencing matrix
         that maps from cell centers to y-faces. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements
         and a spy plot.
 
         >>> mesh = TensorMesh([[(1, 3)], [(1, 4)]])
         >>> mesh.set_cell_gradient_BC('neumann')
-
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(12, 8))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.set_title("Mapping of Stencil", fontsize=14, pad=15)
-            >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
-            >>> ax1.plot(mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii + mesh.nFx), color="g")
-
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.legend(
-            ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{Gy^* \phi}$ (y-faces)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-
-            >>> ax2 = fig.add_subplot(122)
-            >>> ax2.spy(mesh.stencil_cell_gradient_y)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("Y-Face Index", fontsize=12)
-            >>> ax2.set_xlabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(12, 8))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.set_title("Mapping of Stencil", fontsize=14, pad=15)
+        >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.plot(mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii + mesh.nFx), color="g")
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.legend(
+        ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{Gy^* \phi}$ (y-faces)'],
+        ...     loc='upper right', fontsize=14
+        ... )
+        >>> ax2 = fig.add_subplot(122)
+        >>> ax2.spy(mesh.stencil_cell_gradient_y)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("Y-Face Index", fontsize=12)
+        >>> ax2.set_xlabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 2:
             return None
         BC = ["neumann", "neumann"]  # TODO: remove this hard-coding
         n = self.vnC
         if self.dim == 2:
             G2 = sp.kron(_ddxCellGrad(n[1], BC), speye(n[0]))
@@ -1390,39 +1374,35 @@
         >>> mesh.set_cell_gradient_BC(['neumann', 'neumann', 'neumann'])
         >>> Gz = mesh.stencil_cell_gradient_z
         >>> diff_phi_z = Gz @ phi
 
         Now we plot the original scalar, and the differencing taken along the
         z-axis for a slice at y = 0.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_slice(phi, ax=ax1, normal='Y', slice_loc=0)
-            >>> ax1.set_title("Scalar at cell centers", fontsize=14)
-            >>> ax2 = fig.add_subplot(122)
-            >>> v = np.r_[np.zeros(mesh.nFx+mesh.nFy), diff_phi_z]  # Define vector for plotting fun
-            >>> mesh.plot_slice(v, ax=ax2, v_type='Fz', normal='Y', slice_loc=0)
-            >>> ax2.set_title("Difference (z-axis)", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_slice(phi, ax=ax1, normal='Y', slice_loc=0)
+        >>> ax1.set_title("Scalar at cell centers", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> v = np.r_[np.zeros(mesh.nFx+mesh.nFy), diff_phi_z]  # Define vector for plotting fun
+        >>> mesh.plot_slice(v, ax=ax2, v_type='Fz', normal='Y', slice_loc=0)
+        >>> ax2.set_title("Difference (z-axis)", fontsize=14)
+        >>> plt.show()
 
         The z-component cell gradient stencil is a sparse differencing matrix
         that maps from cell centers to z-faces. To demonstrate this, we provide
         a spy plot
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(mesh.stencil_cell_gradient_z, ms=1)
-            >>> ax1.set_title("Spy Plot", fontsize=16, pad=5)
-            >>> ax1.set_xlabel("Cell Index", fontsize=12)
-            >>> ax1.set_ylabel("Z-Face Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(mesh.stencil_cell_gradient_z, ms=1)
+        >>> ax1.set_title("Spy Plot", fontsize=16, pad=5)
+        >>> ax1.set_xlabel("Cell Index", fontsize=12)
+        >>> ax1.set_ylabel("Z-Face Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 3:
             return None
         BC = ["neumann", "neumann"]  # TODO: remove this hard-coding
         n = self.vnC
         G3 = kron3(_ddxCellGrad(n[2], BC), speye(n[1]), speye(n[0]))
         return G3
@@ -1545,75 +1525,67 @@
         Construct the gradient operator and apply to vector
 
         >>> Gc = mesh.cell_gradient
         >>> grad_phi = Gc @ phi
 
         Plot the results
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 6))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi, ax=ax1)
-            >>> ax1.set_title("Scalar at cell centers", fontsize=14)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(
-            ...     grad_phi, ax=ax2, v_type="F", view="vec",
-            ...     stream_opts={"color": "w", "density": 1.0}
-            ... )
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Gradient at faces", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 6))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi, ax=ax1)
+        >>> ax1.set_title("Scalar at cell centers", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(
+        ...     grad_phi, ax=ax2, v_type="F", view="vec",
+        ...     stream_opts={"color": "w", "density": 1.0}
+        ... )
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Gradient at faces", fontsize=14)
+        >>> plt.show()
 
         The cell gradient operator is a sparse matrix that maps
         from cell centers to faces. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements in
         the original discrete quantity :math:`\boldsymbol{\phi}` and its
         discrete gradient as well as a spy plot.
 
         >>> mesh = TensorMesh([[(1, 3)], [(1, 6)]])
         >>> mesh.set_cell_gradient_BC('dirichlet')
-
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(12, 10))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.set_title("Mapping of Gradient Operator", fontsize=14, pad=15)
-            >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
-
-            >>> ax1.plot(mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g^", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
-            >>> ax1.plot(mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g>", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format((ii + mesh.nFx)), color="g")
-
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-
-            >>> ax1.legend(
-            ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{u}$ (faces)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-            >>> ax2 = fig.add_subplot(122)
-            >>> ax2.spy(mesh.cell_gradient)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("Face Index", fontsize=12)
-            >>> ax2.set_xlabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(12, 10))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.set_title("Mapping of Gradient Operator", fontsize=14, pad=15)
+        >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.plot(mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g^", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
+        >>> ax1.plot(mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g>", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format((ii + mesh.nFx)), color="g")
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.legend(
+        ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{u}$ (faces)'],
+        ...     loc='upper right', fontsize=14
+        ... )
+        >>> ax2 = fig.add_subplot(122)
+        >>> ax2.spy(mesh.cell_gradient)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("Face Index", fontsize=12)
+        >>> ax2.set_xlabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if getattr(self, "_cell_gradient", None) is None:
             G = self.stencil_cell_gradient
             S = self.face_areas  # Compute areas of cell faces & volumes
             V = (
                 self.aveCC2F * self.cell_volumes
             )  # Average volume between adjacent cells
@@ -1756,15 +1728,16 @@
 
         return A, b
 
     @property
     def cell_gradient_BC(self):
         """Boundary conditions matrix for the cell gradient operator (Deprecated)."""
         warnings.warn(
-            "cell_gradient_BC is deprecated and is not longer used. See cell_gradient"
+            "cell_gradient_BC is deprecated and is not longer used. See cell_gradient",
+            stacklevel=2,
         )
         if getattr(self, "_cell_gradient_BC", None) is None:
             BC = self.set_cell_gradient_BC(self._cell_gradient_BC_list)
             n = self.vnC
             if self.dim == 1:
                 G = _ddxCellGradBC(n[0], BC[0])
             elif self.dim == 2:
@@ -1839,70 +1812,62 @@
 
         >>> mesh.set_cell_gradient_BC(['neumann', 'neumann'])
         >>> Gx = mesh.stencil_cell_gradient_x
         >>> grad_phi_x = Gx @ phi
 
         Now we plot the original scalar, and the x-derivative.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi, ax=ax1)
-            >>> ax1.set_title("Scalar at cell centers", fontsize=14)
-
-            >>> ax2 = fig.add_subplot(122)
-            >>> v = np.r_[grad_phi_x, np.zeros(mesh.nFy)]  # Define vector for plotting fun
-            >>> mesh.plot_image(v, ax=ax2, v_type="Fx")
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("X-derivative at x-faces", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi, ax=ax1)
+        >>> ax1.set_title("Scalar at cell centers", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> v = np.r_[grad_phi_x, np.zeros(mesh.nFy)]  # Define vector for plotting fun
+        >>> mesh.plot_image(v, ax=ax2, v_type="Fx")
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("X-derivative at x-faces", fontsize=14)
+        >>> plt.show()
 
         The operator is a sparse x-derivative matrix
         that maps from cell centers to x-faces. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements
         and a spy plot.
 
         >>> mesh = TensorMesh([[(1, 3)], [(1, 4)]])
         >>> mesh.set_cell_gradient_BC('neumann')
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(12, 8))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.set_title("Mapping of Operator", fontsize=14, pad=15)
-            >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
-
-            >>> ax1.plot(mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
-
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.legend(
-            ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{Gx^* \phi}$ (x-faces)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-
-            >>> ax2 = fig.add_subplot(122)
-            >>> ax2.spy(mesh.cell_gradient_x)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("X-Face Index", fontsize=12)
-            >>> ax2.set_xlabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(12, 8))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.set_title("Mapping of Operator", fontsize=14, pad=15)
+        >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.plot(mesh.faces_x[:, 0], mesh.faces_x[:, 1], "g>", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nFx), mesh.faces_x):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="g")
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.legend(
+        ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{Gx^* \phi}$ (x-faces)'],
+        ...     loc='upper right', fontsize=14
+        ... )
+        >>> ax2 = fig.add_subplot(122)
+        >>> ax2.spy(mesh.cell_gradient_x)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("X-Face Index", fontsize=12)
+        >>> ax2.set_xlabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if getattr(self, "_cell_gradient_x", None) is None:
             G1 = self.stencil_cell_gradient_x
             # Compute areas of cell faces & volumes
             V = self.aveCC2F * self.cell_volumes
             L = self.reshape(self.face_areas / V, "F", "Fx", "V")
             self._cell_gradient_x = sdiag(L) * G1
@@ -1963,69 +1928,61 @@
 
         >>> mesh.set_cell_gradient_BC(['neumann', 'neumann'])
         >>> Gy = mesh.cell_gradient_y
         >>> grad_phi_y = Gy @ phi
 
         Now we plot the original scalar is y-derivative.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_image(phi, ax=ax1)
-            >>> ax1.set_title("Scalar at cell centers", fontsize=14)
-
-            >>> ax2 = fig.add_subplot(122)
-            >>> v = np.r_[np.zeros(mesh.nFx), grad_phi_y]  # Define vector for plotting fun
-            >>> mesh.plot_image(v, ax=ax2, v_type="Fy")
-            >>> ax2.set_yticks([])
-            >>> ax2.set_ylabel("")
-            >>> ax2.set_title("Y-derivative at y-faces", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_image(phi, ax=ax1)
+        >>> ax1.set_title("Scalar at cell centers", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> v = np.r_[np.zeros(mesh.nFx), grad_phi_y]  # Define vector for plotting fun
+        >>> mesh.plot_image(v, ax=ax2, v_type="Fy")
+        >>> ax2.set_yticks([])
+        >>> ax2.set_ylabel("")
+        >>> ax2.set_title("Y-derivative at y-faces", fontsize=14)
+        >>> plt.show()
 
         The operator is a sparse y-derivative matrix
         that maps from cell centers to y-faces. To demonstrate this, we construct
         a small 2D mesh. We then show the ordering of the elements
         and a spy plot.
 
         >>> mesh = TensorMesh([[(1, 3)], [(1, 4)]])
         >>> mesh.set_cell_gradient_BC('neumann')
-
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(12, 8))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_grid(ax=ax1)
-            >>> ax1.set_title("Mapping of Operator", fontsize=14, pad=15)
-            >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
-            >>> ax1.plot(mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8)
-            >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
-            ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii + mesh.nFx), color="g")
-
-            >>> ax1.set_xticks([])
-            >>> ax1.set_yticks([])
-            >>> ax1.spines['bottom'].set_color('white')
-            >>> ax1.spines['top'].set_color('white')
-            >>> ax1.spines['left'].set_color('white')
-            >>> ax1.spines['right'].set_color('white')
-            >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
-            >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
-            >>> ax1.legend(
-            ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{Gy^* \phi}$ (y-faces)'],
-            ...     loc='upper right', fontsize=14
-            ... )
-
-            >>> ax2 = fig.add_subplot(122)
-            >>> ax2.spy(mesh.stencil_cell_gradient_y)
-            >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
-            >>> ax2.set_ylabel("Y-Face Index", fontsize=12)
-            >>> ax2.set_xlabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(12, 8))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_grid(ax=ax1)
+        >>> ax1.set_title("Mapping of Operator", fontsize=14, pad=15)
+        >>> ax1.plot(mesh.cell_centers[:, 0], mesh.cell_centers[:, 1], "ro", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nC), mesh.cell_centers):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii), color="r")
+        >>> ax1.plot(mesh.faces_y[:, 0], mesh.faces_y[:, 1], "g^", markersize=8)
+        >>> for ii, loc in zip(range(mesh.nFy), mesh.faces_y):
+        ...     ax1.text(loc[0] + 0.05, loc[1] + 0.02, "{0:d}".format(ii + mesh.nFx), color="g")
+        >>> ax1.set_xticks([])
+        >>> ax1.set_yticks([])
+        >>> ax1.spines['bottom'].set_color('white')
+        >>> ax1.spines['top'].set_color('white')
+        >>> ax1.spines['left'].set_color('white')
+        >>> ax1.spines['right'].set_color('white')
+        >>> ax1.set_xlabel('X', fontsize=16, labelpad=-5)
+        >>> ax1.set_ylabel('Y', fontsize=16, labelpad=-15)
+        >>> ax1.legend(
+        ...     ['Mesh', '$\mathbf{\phi}$ (centers)', '$\mathbf{Gy^* \phi}$ (y-faces)'],
+        ...     loc='upper right', fontsize=14
+        ... )
+        >>> ax2 = fig.add_subplot(122)
+        >>> ax2.spy(mesh.stencil_cell_gradient_y)
+        >>> ax2.set_title("Spy Plot", fontsize=14, pad=5)
+        >>> ax2.set_ylabel("Y-Face Index", fontsize=12)
+        >>> ax2.set_xlabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 2:
             return None
         if getattr(self, "_cell_gradient_y", None) is None:
             G2 = self.stencil_cell_gradient_y
             # Compute areas of cell faces & volumes
             V = self.aveCC2F * self.cell_volumes
@@ -2087,40 +2044,35 @@
 
         >>> mesh.set_cell_gradient_BC(['neumann', 'neumann', 'neumann'])
         >>> Gz = mesh.cell_gradient_z
         >>> grad_phi_z = Gz @ phi
 
         Now we plot the original scalar and the z-derivative for a slice at y = 0.
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(13, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> mesh.plot_slice(phi, ax=ax1, normal='Y', slice_loc=0)
-            >>> ax1.set_title("Scalar at cell centers", fontsize=14)
-
-            >>> ax2 = fig.add_subplot(122)
-            >>> v = np.r_[np.zeros(mesh.nFx+mesh.nFy), grad_phi_z]  # Define vector for plotting fun
-            >>> mesh.plot_slice(v, ax=ax2, v_type='Fz', normal='Y', slice_loc=0)
-            >>> ax2.set_title("Z-derivative (z-faces)", fontsize=14)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(13, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> mesh.plot_slice(phi, ax=ax1, normal='Y', slice_loc=0)
+        >>> ax1.set_title("Scalar at cell centers", fontsize=14)
+        >>> ax2 = fig.add_subplot(122)
+        >>> v = np.r_[np.zeros(mesh.nFx+mesh.nFy), grad_phi_z]  # Define vector for plotting fun
+        >>> mesh.plot_slice(v, ax=ax2, v_type='Fz', normal='Y', slice_loc=0)
+        >>> ax2.set_title("Z-derivative (z-faces)", fontsize=14)
+        >>> plt.show()
 
         The z-component cell gradient is a sparse derivative matrix
         that maps from cell centers to z-faces. To demonstrate this, we provide
         a spy plot
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(mesh.cell_gradient_z, ms=1)
-            >>> ax1.set_title("Spy Plot", fontsize=16, pad=5)
-            >>> ax1.set_xlabel("Cell Index", fontsize=12)
-            >>> ax1.set_ylabel("Z-Face Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(mesh.cell_gradient_z, ms=1)
+        >>> ax1.set_title("Spy Plot", fontsize=16, pad=5)
+        >>> ax1.set_xlabel("Cell Index", fontsize=12)
+        >>> ax1.set_ylabel("Z-Face Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 3:
             return None
         if getattr(self, "_cell_gradient_z", None) is None:
             G3 = self.stencil_cell_gradient_z
             # Compute areas of cell faces & volumes
             V = self.aveCC2F * self.cell_volumes
@@ -2276,15 +2228,17 @@
         Pe = self.project_edge_to_boundary_edge
         Pf = self.project_face_to_boundary_face
         dA = self.boundary_face_outward_normals * (Pf @ self.face_areas)[:, None]
         w = Pe @ self.edge_tangents
 
         n_boundary_edges = len(w)
 
-        Av = Pf @ self.average_edge_to_face_vector @ Pe.T
+        Av = Pf @ self.average_edge_to_face @ Pe.T
+        if self.dim > 2:
+            Av *= 2
 
         w_cross_n = np.cross(-w, Av.T @ dA)
 
         if self.dim == 2:
             return Pe.T @ sp.diags(w_cross_n, format="csr")
         return Pe.T @ sp.diags(
             w_cross_n.T,
@@ -2605,37 +2559,33 @@
         the discrete scalar quantity to approximate the value at cell centers.
 
         >>> Axc = mesh.average_face_x_to_cell
         >>> phi_c = Axc @ phi_x
 
         And plot the results:
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> v = np.r_[phi_x, np.zeros(mesh.nFy)]  # create vector for plotting function
-            >>> mesh.plot_image(v, ax=ax1, v_type="Fx")
-            >>> ax1.set_title("Variable at x-faces", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> v = np.r_[phi_x, np.zeros(mesh.nFy)]  # create vector for plotting function
+        >>> mesh.plot_image(v, ax=ax1, v_type="Fx")
+        >>> ax1.set_title("Variable at x-faces", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Axc, ms=1)
-            >>> ax1.set_title("X-Face Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Axc, ms=1)
+        >>> ax1.set_title("X-Face Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if getattr(self, "_average_face_x_to_cell", None) is None:
             n = self.vnC
             if self.dim == 1:
                 self._average_face_x_to_cell = av(n[0])
             elif self.dim == 2:
                 self._average_face_x_to_cell = sp.kron(speye(n[1]), av(n[0]))
@@ -2702,37 +2652,33 @@
         the discrete scalar quantity to approximate the value at cell centers.
 
         >>> Ayc = mesh.average_face_y_to_cell
         >>> phi_c = Ayc @ phi_y
 
         And finally, plot the results:
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> v = np.r_[np.zeros(mesh.nFx), phi_y]  # create vector for plotting function
-            >>> mesh.plot_image(v, ax=ax1, v_type="Fy")
-            >>> ax1.set_title("Variable at y-faces", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> v = np.r_[np.zeros(mesh.nFx), phi_y]  # create vector for plotting function
+        >>> mesh.plot_image(v, ax=ax1, v_type="Fy")
+        >>> ax1.set_title("Variable at y-faces", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Ayc, ms=1)
-            >>> ax1.set_title("Y-Face Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Ayc, ms=1)
+        >>> ax1.set_title("Y-Face Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 2:
             return None
         if getattr(self, "_average_face_y_to_cell", None) is None:
             n = self.vnC
             if self.dim == 2:
                 self._average_face_y_to_cell = sp.kron(av(n[1]), speye(n[0]))
@@ -2801,37 +2747,33 @@
         slice at y=0.
 
         >>> Azc = mesh.average_face_z_to_cell
         >>> phi_c = Azc @ phi_z
 
         And plot the results:
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> v = np.r_[np.zeros(mesh.nFx+mesh.nFy), phi_z]  # create vector for plotting
-            >>> mesh.plot_slice(v, ax=ax1, normal='Y', slice_loc=0, v_type="Fz")
-            >>> ax1.set_title("Variable at z-faces", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, normal='Y', slice_loc=0, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> v = np.r_[np.zeros(mesh.nFx+mesh.nFy), phi_z]  # create vector for plotting
+        >>> mesh.plot_slice(v, ax=ax1, normal='Y', slice_loc=0, v_type="Fz")
+        >>> ax1.set_title("Variable at z-faces", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, normal='Y', slice_loc=0, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Azc, ms=1)
-            >>> ax1.set_title("Z-Face Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Azc, ms=1)
+        >>> ax1.set_title("Z-Face Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 3:
             return None
         if getattr(self, "_average_face_z_to_cell", None) is None:
             n = self.vnC
             if self.dim == 3:
                 self._average_face_z_to_cell = kron3(av(n[2]), speye(n[1]), speye(n[0]))
@@ -3032,37 +2974,33 @@
         the discrete scalar quantity to approximate the value at cell centers.
 
         >>> Axc = mesh.average_edge_x_to_cell
         >>> phi_c = Axc @ phi_x
 
         And plot the results,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> v = np.r_[phi_x, np.zeros(mesh.nEy)]  # create vector for plotting function
-            >>> mesh.plot_image(v, ax=ax1, v_type="Ex")
-            >>> ax1.set_title("Variable at x-edges", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> v = np.r_[phi_x, np.zeros(mesh.nEy)]  # create vector for plotting function
+        >>> mesh.plot_image(v, ax=ax1, v_type="Ex")
+        >>> ax1.set_title("Variable at x-edges", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Axc, ms=1)
-            >>> ax1.set_title("X-Edge Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Axc, ms=1)
+        >>> ax1.set_title("X-Edge Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if getattr(self, "_average_edge_x_to_cell", None) is None:
             # The number of cell centers in each direction
             n = self.vnC
             if self.dim == 1:
                 self._average_edge_x_to_cell = speye(n[0])
             elif self.dim == 2:
@@ -3129,37 +3067,33 @@
         the discrete scalar quantity to approximate the value at cell centers.
 
         >>> Ayc = mesh.average_edge_y_to_cell
         >>> phi_c = Ayc @ phi_y
 
         And plot the results,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> v = np.r_[np.zeros(mesh.nEx), phi_y]  # create vector for plotting function
-            >>> mesh.plot_image(v, ax=ax1, v_type="Ey")
-            >>> ax1.set_title("Variable at y-edges", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> v = np.r_[np.zeros(mesh.nEx), phi_y]  # create vector for plotting function
+        >>> mesh.plot_image(v, ax=ax1, v_type="Ey")
+        >>> ax1.set_title("Variable at y-edges", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Ayc, ms=1)
-            >>> ax1.set_title("Y-Edge Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Ayc, ms=1)
+        >>> ax1.set_title("Y-Edge Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 2:
             return None
         if getattr(self, "_average_edge_y_to_cell", None) is None:
             # The number of cell centers in each direction
             n = self.vnC
             if self.dim == 2:
@@ -3228,49 +3162,45 @@
         slice at y=0.
 
         >>> Azc = mesh.average_edge_z_to_cell
         >>> phi_c = Azc @ phi_z
 
         Plot the results,
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(11, 5))
-            >>> ax1 = fig.add_subplot(121)
-            >>> v = np.r_[np.zeros(mesh.nEx+mesh.nEy), phi_z]  # create vector for plotting
-            >>> mesh.plot_slice(v, ax=ax1, normal='Y', slice_loc=0, v_type="Ez")
-            >>> ax1.set_title("Variable at z-edges", fontsize=16)
-            >>> ax2 = fig.add_subplot(122)
-            >>> mesh.plot_image(phi_c, ax=ax2, normal='Y', slice_loc=0, v_type="CC")
-            >>> ax2.set_title("Averaged to cell centers", fontsize=16)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(11, 5))
+        >>> ax1 = fig.add_subplot(121)
+        >>> v = np.r_[np.zeros(mesh.nEx+mesh.nEy), phi_z]  # create vector for plotting
+        >>> mesh.plot_slice(v, ax=ax1, normal='Y', slice_loc=0, v_type="Ez")
+        >>> ax1.set_title("Variable at z-edges", fontsize=16)
+        >>> ax2 = fig.add_subplot(122)
+        >>> mesh.plot_image(phi_c, ax=ax2, normal='Y', slice_loc=0, v_type="CC")
+        >>> ax2.set_title("Averaged to cell centers", fontsize=16)
+        >>> plt.show()
 
         Below, we show a spy plot illustrating the sparsity and mapping
         of the operator
 
-        .. collapse:: Expand to show scripting for plot
-
-            >>> fig = plt.figure(figsize=(9, 9))
-            >>> ax1 = fig.add_subplot(111)
-            >>> ax1.spy(Azc, ms=1)
-            >>> ax1.set_title("Z-Edge Index", fontsize=12, pad=5)
-            >>> ax1.set_ylabel("Cell Index", fontsize=12)
-            >>> plt.show()
+        >>> fig = plt.figure(figsize=(9, 9))
+        >>> ax1 = fig.add_subplot(111)
+        >>> ax1.spy(Azc, ms=1)
+        >>> ax1.set_title("Z-Edge Index", fontsize=12, pad=5)
+        >>> ax1.set_ylabel("Cell Index", fontsize=12)
+        >>> plt.show()
         """
         if self.dim < 3:
             return None
         if getattr(self, "_average_edge_z_to_cell", None) is None:
             # The number of cell centers in each direction
             n = self.vnC
             if self.dim == 3:
                 self._average_edge_z_to_cell = kron3(speye(n[2]), av(n[1]), av(n[0]))
         return self._average_edge_z_to_cell
 
     @property
-    def average_edge_to_face_vector(self):  # NOQA D102
+    def average_edge_to_face(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         if self.dim == 1:
             return self.average_cell_to_face
         elif self.dim == 2:
             return sp.diags(
                 [1, 1],
                 [-self.n_faces_x, self.n_faces_y],
@@ -3282,15 +3212,15 @@
 
         ey_to_fx = kron3(av(n3), speye(n2), speye(n1 + 1))
         ey_to_fz = kron3(speye(n3 + 1), speye(n2), av(n1))
 
         ez_to_fx = kron3(speye(n3), av(n2), speye(n1 + 1))
         ez_to_fy = kron3(speye(n3), speye(n2 + 1), av(n1))
 
-        e_to_f = sp.bmat(
+        e_to_f = 0.5 * sp.bmat(
             [
                 [None, ey_to_fx, ez_to_fx],
                 [ex_to_fy, None, ez_to_fy],
                 [ex_to_fz, ey_to_fz, None],
             ],
             format="csr",
         )
@@ -3448,38 +3378,38 @@
     def project_face_to_boundary_face(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         # Simple matrix which projects the values of the faces onto the boundary faces
         # Can also be used to "select" the boundary faces
 
         # Create a matrix that projects all faces onto boundary faces
         # The below should work for a regular structured mesh
-        is_b = make_boundary_bool(self.shape_faces_x, dir="x")
+        is_b = make_boundary_bool(self.shape_faces_x, bdir="x")
         if self.dim > 1:
-            is_b = np.r_[is_b, make_boundary_bool(self.shape_faces_y, dir="y")]
+            is_b = np.r_[is_b, make_boundary_bool(self.shape_faces_y, bdir="y")]
         if self.dim == 3:
-            is_b = np.r_[is_b, make_boundary_bool(self.shape_faces_z, dir="z")]
+            is_b = np.r_[is_b, make_boundary_bool(self.shape_faces_z, bdir="z")]
         return sp.eye(self.n_faces, format="csr")[is_b]
 
     @property
     def project_edge_to_boundary_edge(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         # Simple matrix which projects the values of the faces onto the boundary faces
         # Can also be used to "select" the boundary faces
 
         # Create a matrix that projects all edges onto boundary edges
         # The below should work for a regular structured mesh
         if self.dim == 1:
             return None  # No edges are on the boundary in 1D
 
         is_b = np.r_[
-            make_boundary_bool(self.shape_edges_x, dir="yz"),
-            make_boundary_bool(self.shape_edges_y, dir="xz"),
+            make_boundary_bool(self.shape_edges_x, bdir="yz"),
+            make_boundary_bool(self.shape_edges_y, bdir="xz"),
         ]
         if self.dim == 3:
-            is_b = np.r_[is_b, make_boundary_bool(self.shape_edges_z, dir="xy")]
+            is_b = np.r_[is_b, make_boundary_bool(self.shape_edges_z, bdir="xy")]
         return sp.eye(self.n_edges, format="csr")[is_b]
 
     @property
     def project_node_to_boundary_node(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         # Simple matrix which projects the values of the nodes onto the boundary nodes
         # Can also be used to "select" the boundary nodes
@@ -3488,70 +3418,70 @@
         # The below should work for a regular structured mesh
 
         is_b = make_boundary_bool(self.shape_nodes)
         return sp.eye(self.n_nodes, format="csr")[is_b]
 
     # DEPRECATED
     cellGrad = deprecate_property(
-        "cell_gradient", "cellGrad", removal_version="1.0.0", future_warn=True
+        "cell_gradient", "cellGrad", removal_version="1.0.0", error=True
     )
     cellGradBC = deprecate_property(
-        "cell_gradient_BC", "cellGradBC", removal_version="1.0.0", future_warn=True
+        "cell_gradient_BC", "cellGradBC", removal_version="1.0.0", error=True
     )
     cellGradx = deprecate_property(
-        "cell_gradient_x", "cellGradx", removal_version="1.0.0", future_warn=True
+        "cell_gradient_x", "cellGradx", removal_version="1.0.0", error=True
     )
     cellGrady = deprecate_property(
-        "cell_gradient_y", "cellGrady", removal_version="1.0.0", future_warn=True
+        "cell_gradient_y", "cellGrady", removal_version="1.0.0", error=True
     )
     cellGradz = deprecate_property(
-        "cell_gradient_z", "cellGradz", removal_version="1.0.0", future_warn=True
+        "cell_gradient_z", "cellGradz", removal_version="1.0.0", error=True
     )
     faceDivx = deprecate_property(
-        "face_x_divergence", "faceDivx", removal_version="1.0.0", future_warn=True
+        "face_x_divergence", "faceDivx", removal_version="1.0.0", error=True
     )
     faceDivy = deprecate_property(
-        "face_y_divergence", "faceDivy", removal_version="1.0.0", future_warn=True
+        "face_y_divergence", "faceDivy", removal_version="1.0.0", error=True
     )
     faceDivz = deprecate_property(
-        "face_z_divergence", "faceDivz", removal_version="1.0.0", future_warn=True
+        "face_z_divergence", "faceDivz", removal_version="1.0.0", error=True
     )
     _cellGradStencil = deprecate_property(
         "stencil_cell_gradient",
         "_cellGradStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _cellGradxStencil = deprecate_property(
         "stencil_cell_gradient_x",
         "_cellGradxStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _cellGradyStencil = deprecate_property(
         "stencil_cell_gradient_y",
         "_cellGradyStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _cellGradzStencil = deprecate_property(
         "stencil_cell_gradient_z",
         "_cellGradzStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
 
     setCellGradBC = deprecate_method(
         "set_cell_gradient_BC",
         "setCellGradBC",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     getBCProjWF = deprecate_method(
-        "get_BC_projections", "getBCProjWF", removal_version="1.0.0", future_warn=True
+        "get_BC_projections", "getBCProjWF", removal_version="1.0.0", error=True
     )
     getBCProjWF_simple = deprecate_method(
         "get_BC_projections_simple",
         "getBCProjWF_simple",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
```

### Comparing `discretize-0.8.3/discretize/operators/inner_products.py` & `discretize-0.9.0/discretize/operators/inner_products.py`

 * *Files 5% similar despite different names*

```diff
@@ -11,15 +11,14 @@
     inverse_2x2_block_diagonal,
     get_subarray,
     inverse_3x3_block_diagonal,
     spzeros,
     sdinv,
 )
 import numpy as np
-import warnings
 
 
 class InnerProducts(BaseMesh):
     """Class for constructing inner product matrices.
 
     ``InnerProducts`` is a mixin class for constructing inner product matrices,
     their inverses and their derivatives with respect to model parameters.
@@ -36,32 +35,27 @@
         invert_model=False,
         invert_matrix=False,
         do_fast=True,
         **kwargs
     ):
         # Inherited documentation from discretize.base.BaseMesh
         if "invProp" in kwargs:
-            warnings.warn(
-                "The invProp keyword argument has been deprecated, please use invert_model. "
+            raise TypeError(
+                "The invProp keyword argument has been removed, please use invert_model. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_model = kwargs["invProp"]
         if "invMat" in kwargs:
-            warnings.warn(
-                "The invMat keyword argument has been deprecated, please use invert_matrix. "
+            raise TypeError(
+                "The invMat keyword argument has been removed, please use invert_matrix. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_matrix = kwargs["invMat"]
         if "doFast" in kwargs:
-            warnings.warn(
-                "The doFast keyword argument has been deprecated, please use do_fast. "
+            raise TypeError(
+                "The doFast keyword argument has been removed, please use do_fast. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
             do_fast = kwargs["doFast"]
 
         return self._getInnerProduct(
             "F",
             model=model,
             invert_model=invert_model,
@@ -75,34 +69,28 @@
         invert_model=False,
         invert_matrix=False,
         do_fast=True,
         **kwargs
     ):
         # Inherited documentation from discretize.base.BaseMesh
         if "invProp" in kwargs:
-            warnings.warn(
-                "The invProp keyword argument has been deprecated, please use invert_model. "
+            raise TypeError(
+                "The invProp keyword argument has been removed, please use invert_model. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_model = kwargs["invProp"]
         if "invMat" in kwargs:
-            warnings.warn(
-                "The invMat keyword argument has been deprecated, please use invert_matrix. "
+            raise TypeError(
+                "The invMat keyword argument has been removed, please use invert_matrix. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_matrix = kwargs["invMat"]
         if "doFast" in kwargs:
-            warnings.warn(
-                "The doFast keyword argument has been deprecated, please use do_fast. "
+            raise TypeError(
+                "The doFast keyword argument has been removed, please use do_fast. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            do_fast = kwargs["doFast"]
         return self._getInnerProduct(
             "E",
             model=model,
             invert_model=invert_model,
             invert_matrix=invert_matrix,
             do_fast=do_fast,
         )
@@ -133,34 +121,28 @@
 
         Returns
         -------
         scipy.sparse.csr_matrix
             M, the inner product matrix (nE, nE)
         """
         if "invProp" in kwargs:
-            warnings.warn(
-                "The invProp keyword argument has been deprecated, please use invert_model. "
+            raise TypeError(
+                "The invProp keyword argument has been removed, please use invert_model. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_model = kwargs["invProp"]
         if "invMat" in kwargs:
-            warnings.warn(
-                "The invMat keyword argument has been deprecated, please use invert_matrix. "
+            raise TypeError(
+                "The invMat keyword argument has been removed, please use invert_matrix. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_matrix = kwargs["invMat"]
         if "doFast" in kwargs:
-            warnings.warn(
-                "The doFast keyword argument has been deprecated, please use do_fast. "
+            raise TypeError(
+                "The doFast keyword argument has been removed, please use do_fast. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            do_fast = kwargs["doFast"]
         if projection_type not in ["F", "E"]:
             raise TypeError("projection_type must be 'F' for faces or 'E' for edges")
 
         fast = None
         if hasattr(self, "_fastInnerProduct") and do_fast:
             fast = self._fastInnerProduct(
                 projection_type,
@@ -241,67 +223,55 @@
         return [V * proj(*locs[node][d - 1]) for node in nodes]
 
     def get_face_inner_product_deriv(  # NOQA D102
         self, model, do_fast=True, invert_model=False, invert_matrix=False, **kwargs
     ):
         # Inherited documentation from discretize.base.BaseMesh
         if "invProp" in kwargs:
-            warnings.warn(
-                "The invProp keyword argument has been deprecated, please use invert_model. "
+            raise TypeError(
+                "The invProp keyword argument has been removed, please use invert_model. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_model = kwargs["invProp"]
         if "invMat" in kwargs:
-            warnings.warn(
-                "The invMat keyword argument has been deprecated, please use invert_matrix. "
+            raise TypeError(
+                "The invMat keyword argument has been removed, please use invert_matrix. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_matrix = kwargs["invMat"]
         if "doFast" in kwargs:
-            warnings.warn(
-                "The doFast keyword argument has been deprecated, please use do_fast. "
+            raise TypeError(
+                "The doFast keyword argument has been removed, please use do_fast. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            do_fast = kwargs["doFast"]
         return self._getInnerProductDeriv(
             model,
             "F",
             do_fast=do_fast,
             invert_model=invert_model,
             invert_matrix=invert_matrix,
         )
 
     def get_edge_inner_product_deriv(  # NOQA D102
         self, model, do_fast=True, invert_model=False, invert_matrix=False, **kwargs
     ):
         # Inherited documentation from discretize.base.BaseMesh
         if "invProp" in kwargs:
-            warnings.warn(
-                "The invProp keyword argument has been deprecated, please use invert_model. "
+            raise TypeError(
+                "The invProp keyword argument has been removed, please use invert_model. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_model = kwargs["invProp"]
         if "invMat" in kwargs:
-            warnings.warn(
-                "The invMat keyword argument has been deprecated, please use invert_matrix. "
+            raise TypeError(
+                "The invMat keyword argument has been removed, please use invert_matrix. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            invert_matrix = kwargs["invMat"]
         if "doFast" in kwargs:
-            warnings.warn(
-                "The doFast keyword argument has been deprecated, please use do_fast. "
+            raise TypeError(
+                "The doFast keyword argument has been removed, please use do_fast. "
                 "This will be removed in discretize 1.0.0",
-                FutureWarning,
             )
-            do_fast = kwargs["doFast"]
         return self._getInnerProductDeriv(
             model,
             "E",
             do_fast=do_fast,
             invert_model=invert_model,
             invert_matrix=invert_matrix,
         )
```

### Comparing `discretize-0.8.3/discretize/tensor_mesh.py` & `discretize-0.9.0/discretize/tensor_mesh.py`

 * *Files 2% similar despite different names*

```diff
@@ -567,36 +567,36 @@
             # Add number of cells.
             attrs[name]["nC"] = self.shape_cells[i]
 
         return attrs
 
     # DEPRECATIONS
     areaFx = deprecate_property(
-        "face_x_areas", "areaFx", removal_version="1.0.0", future_warn=True
+        "face_x_areas", "areaFx", removal_version="1.0.0", error=True
     )
     areaFy = deprecate_property(
-        "face_y_areas", "areaFy", removal_version="1.0.0", future_warn=True
+        "face_y_areas", "areaFy", removal_version="1.0.0", error=True
     )
     areaFz = deprecate_property(
-        "face_z_areas", "areaFz", removal_version="1.0.0", future_warn=True
+        "face_z_areas", "areaFz", removal_version="1.0.0", error=True
     )
     edgeEx = deprecate_property(
-        "edge_x_lengths", "edgeEx", removal_version="1.0.0", future_warn=True
+        "edge_x_lengths", "edgeEx", removal_version="1.0.0", error=True
     )
     edgeEy = deprecate_property(
-        "edge_y_lengths", "edgeEy", removal_version="1.0.0", future_warn=True
+        "edge_y_lengths", "edgeEy", removal_version="1.0.0", error=True
     )
     edgeEz = deprecate_property(
-        "edge_z_lengths", "edgeEz", removal_version="1.0.0", future_warn=True
+        "edge_z_lengths", "edgeEz", removal_version="1.0.0", error=True
     )
     faceBoundaryInd = deprecate_property(
         "face_boundary_indices",
         "faceBoundaryInd",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     cellBoundaryInd = deprecate_property(
         "cell_boundary_indices",
         "cellBoundaryInd",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
```

### Comparing `discretize-0.8.3/discretize/tests.py` & `discretize-0.9.0/discretize/tests.py`

 * *Files 9% similar despite different names*

```diff
@@ -312,15 +312,15 @@
             Number of cells along each axis.
 
         Returns
         -------
         Float
             Maximum cell width for the mesh
         """
-        mesh, max_h = setupMesh(self._meshType, nC, self.meshDimension)
+        mesh, max_h = setup_mesh(self._meshType, nC, self.meshDimension)
         self.M = mesh
         return max_h
 
     def getError(self):
         r"""Compute error defined as a norm of the residual.
 
         This method is overwritten within the test class of a particular operator.
@@ -338,14 +338,15 @@
     def orderTest(self):
         """Perform an order test.
 
         For number of cells specified in meshSizes setup mesh, call getError
         and prints mesh size, error, ratio between current and previous error,
         and estimated order of convergence.
         """
+        __tracebackhide__ = True
         if not isinstance(self.meshTypes, list):
             raise TypeError("meshTypes must be a list")
         if type(self.tolerance) is not list:
             self.tolerance = np.ones(len(self.meshTypes)) * self.tolerance
 
         # if we just provide one expected order, repeat it for each mesh type
         if type(self.expectedOrders) == float or type(self.expectedOrders) == int:
@@ -355,62 +356,156 @@
         except TypeError:
             raise TypeError("expectedOrders must be array like")
         if len(self.expectedOrders) != len(self.meshTypes):
             raise ValueError(
                 "expectedOrders must have the same length as the meshTypes"
             )
 
-        for ii_meshType, mesh_type in enumerate(self.meshTypes):
+        def test_func(n_cells):
+            max_h = self.setupMesh(n_cells)
+            err = self.getError()
+            return err, max_h
+
+        for mesh_type, order, tolerance in zip(
+            self.meshTypes, self.tolerance, self.expectedOrders
+        ):
             self._meshType = mesh_type
-            self._tolerance = self.tolerance[ii_meshType]
-            self._expectedOrder = self.expectedOrders[ii_meshType]
-
-            order = []
-            err_old = 0.0
-            max_h_old = 0.0
-            for ii, nc in enumerate(self.meshSizes):
-                # Leave these as setupMesh and getError for deprecated classes that might have extended these two methods
-                max_h = self.setupMesh(nc)
-                err = self.getError()
-                if ii == 0:
-                    print("")
-                    print(self._meshType + ":  " + self.name)
-                    print("_____________________________________________")
-                    print("   h  |    error    | e(i-1)/e(i) |  order")
-                    print("~~~~~~|~~~~~~~~~~~~~|~~~~~~~~~~~~~|~~~~~~~~~~")
-                    print("{0:4d}  |  {1:8.2e}   |".format(nc, err))
-                else:
-                    order.append(np.log(err / err_old) / np.log(max_h / max_h_old))
-                    print(
-                        "{0:4d}  |  {1:8.2e}   |   {2:6.4f}    |  {3:6.4f}".format(
-                            nc, err, err_old / err, order[-1]
-                        )
-                    )
-                err_old = err
-                max_h_old = max_h
-            print("---------------------------------------------")
-            passTest = np.mean(np.array(order)) > self._tolerance * self._expectedOrder
-            if passTest:
-                print(happiness[np.random.randint(len(happiness))])
-            else:
-                print("Failed to pass test on " + self._meshType + ".")
-                print(sadness[np.random.randint(len(sadness))])
-            print("")
-            self.assertGreater(
-                np.mean(np.array(order)), self._tolerance * self._expectedOrder
+            assert_expected_order(
+                test_func,
+                self.meshSizes,
+                expected_order=order,
+                rtol=np.abs(1 - tolerance),
+                test_type="mean_at_least",
             )
 
-    # expectedOrders = deprecate_property("expectedOrders", "expectedOrders", removal_version="1.0.0")
-    # meshSizes = deprecate_property("meshSizes", "meshSizes", removal_version="1.0.0")
-    # meshTypes = deprecate_property("meshTypes", "meshTypes", removal_version="1.0.0")
-    # meshDimension = deprecate_property("meshDimension", "meshDimension", removal_version="1.0.0")
-    # setupMesh = deprecate_method("setupMesh", "setupMesh", removal_version="1.0.0")
-    # getError = deprecate_method("getError", "getError", removal_version="1.0.0")
-    # orderTest = deprecate_method("orderTest", "orderTest", removal_version="1.0.0")
-    # _meshType = deprecate_property("_meshType", "_meshType", removal_version="1.0.0")
+
+def assert_expected_order(
+    func, n_cells, expected_order=2.0, rtol=0.15, test_type="mean"
+):
+    """Perform an order test.
+
+    For number of cells specified in `mesh_sizes` call `func`
+    and prints mesh size, error, ratio between current and previous error,
+    and estimated order of convergence.
+
+    Parameters
+    ----------
+    func : callable
+        Function which should accept an integer representing the number of
+        discretizations on the domain and return a tuple of the error and
+        the discretization widths.
+    n_cells : array_like of int
+        List of number of discretizations to pass to func.
+    expected_order : float, optional
+        The expected order of accuracy for you test
+    rtol : float, optional
+        The relative tolerance of the order test.
+    test_type : {'mean', 'min', 'last', 'all', 'mean_at_least'}
+        Which property of the list of calculated orders to test.
+
+    Returns
+    -------
+    numpy.ndarray
+        The calculated order values on success
+
+    Raises
+    ------
+    AssertionError
+
+    Notes
+    -----
+    For the different ``test_type`` arguments, different properties of the
+    order is tested:
+
+        - `mean`: the mean value of all calculated orders is tested for
+          approximate equality with the expected order.
+        - `min`: The minimimum value of calculated orders is tested for
+          approximate equality with the expected order.
+        - `last`: The last calculated order is tested for approximate equality
+          with the expected order.
+        - `all`: All calculated orders are tested for approximate equality with
+          the expected order.
+        - `mean_at_least`: The mean is tested to be at least approximately the
+          expected order. This is the default test for the previous ``OrderTest``
+          class in older versions of `discretize`.
+
+    Examples
+    --------
+    Testing the convergence order of an central difference operator
+
+    >>> from discretize.tests import assert_expected_order
+    >>> func = lambda y: np.cos(y)
+    >>> func_deriv = lambda y: -np.sin(y)
+
+    Define the function that returns the error and cell width for
+    a given number of discretizations.
+    >>> def deriv_error(n):
+    ...     # grid points
+    ...     nodes = np.linspace(0, 1, n+1)
+    ...     cc = 0.5 * (nodes[1:] + nodes[:-1])
+    ...     dh = nodes[1]-nodes[0]
+    ...     # evaluate the function on nodes
+    ...     node_eval = func(nodes)
+    ...     # calculate the numerical derivative
+    ...     num_deriv = (node_eval[1:] - node_eval[:-1]) / dh
+    ...     # calculate the true derivative
+    ...     true_deriv = func_deriv(cc)
+    ...     # compare the L-inf norm of the error vector
+    ...     err = np.linalg.norm(num_deriv - true_deriv, ord=np.inf)
+    ...     return err, dh
+
+    Then run the expected order test.
+    >>> assert_expected_order(deriv_error, [10, 20, 30, 40, 50])
+    """
+    __tracebackhide__ = True
+    n_cells = np.asarray(n_cells, dtype=int)
+    if test_type not in ["mean", "min", "last", "all", "mean_at_least"]:
+        raise ValueError
+    orders = []
+    # Do first values:
+    nc = n_cells[0]
+    err_last, h_last = func(nc)
+
+    print("_______________________________________________________")
+    print("  nc  |    h    |    error    | e(i-1)/e(i) |  order   ")
+    print("~~~~~~|~~~~~~~~~|~~~~~~~~~~~~~|~~~~~~~~~~~~~|~~~~~~~~~~")
+    print(f"{nc:^6d}|{h_last:^9.2e}|{err_last:^13.3e}|             |")
+
+    for nc in n_cells[1:]:
+        err, h = func(nc)
+        order = np.log(err / err_last) / np.log(h / h_last)
+        print(f"{nc:^6d}|{h:^9.2e}|{err:^13.3e}|{err_last / err:^13.4f}|{order:^10.4f}")
+        err_last = err
+        h_last = h
+        orders.append(order)
+
+    print("-------------------------------------------------------")
+
+    try:
+        if test_type == "mean":
+            np.testing.assert_allclose(np.mean(orders), expected_order, rtol=rtol)
+        elif test_type == "mean_at_least":
+            test = np.mean(orders) > expected_order * (1 - rtol)
+            if not test:
+                raise AssertionError(
+                    f"\nOrder mean {np.mean(orders)} is not greater than the expected order "
+                    f"{expected_order} within the tolerance {rtol}."
+                )
+        elif test_type == "min":
+            np.testing.assert_allclose(np.min(orders), expected_order, rtol=rtol)
+        elif test_type == "last":
+            np.testing.assert_allclose(orders[-1], expected_order, rtol=rtol)
+        elif test_type == "all":
+            np.testing.assert_allclose(orders, expected_order, rtol=rtol)
+        print(np.random.choice(happiness))
+    except AssertionError as err:
+        print(np.random.choice(sadness))
+        raise err
+
+    return orders
 
 
 def rosenbrock(x, return_g=True, return_H=True):
     """Evaluate the Rosenbrock function.
 
     This is mostly used for testing Gauss-Newton schemes
 
@@ -495,37 +590,38 @@
     --------
     >>> from discretize import tests, utils
     >>> import numpy as np
     >>> import matplotlib.pyplot as plt
 
     >>> def simplePass(x):
     ...     return np.sin(x), utils.sdiag(np.cos(x))
-    >>> passed = tests.checkDerivative(simplePass, np.random.randn(5))
-    ==================== checkDerivative ====================
+    >>> passed = tests.check_derivative(simplePass, np.random.randn(5))
+    ==================== check_derivative ====================
     iter    h         |ft-f0|   |ft-f0-h*J0*dx|  Order
     ---------------------------------------------------------
      0   1.00e-01    1.690e-01     8.400e-03      nan
      1   1.00e-02    1.636e-02     8.703e-05      1.985
      2   1.00e-03    1.630e-03     8.732e-07      1.999
      3   1.00e-04    1.629e-04     8.735e-09      2.000
      4   1.00e-05    1.629e-05     8.736e-11      2.000
      5   1.00e-06    1.629e-06     8.736e-13      2.000
      6   1.00e-07    1.629e-07     8.822e-15      1.996
     ========================= PASS! =========================
     Once upon a time, a happy little test passed.
     """
+    __tracebackhide__ = True
     # matplotlib is a soft dependencies for discretize,
     # lazy-loaded to decrease load time of discretize.
     try:
         import matplotlib
         import matplotlib.pyplot as plt
     except ImportError:
         matplotlib = False
 
-    print("{0!s} checkDerivative {1!s}".format("=" * 20, "=" * 20))
+    print("{0!s} check_derivative {1!s}".format("=" * 20, "=" * 20))
     print(
         "iter    h         |ft-f0|   |ft-f0-h*J0*dx|  Order\n{0!s}".format(("-" * 57))
     )
 
     f0, J0 = fctn(x0)
 
     x0 = mkvc(x0)
@@ -557,60 +653,72 @@
         order1 = np.log10(E1[:-1] / E1[1:])
         print(
             " {0:d}   {1:1.2e}    {2:1.3e}     {3:1.3e}      {4:1.3f}".format(
                 i, h[i], E0[i], E1[i], np.nan if i == 0 else order1[i - 1]
             )
         )
 
+    @requires({"matplotlib": matplotlib})
+    def _plot_it(axes, passed):
+        if axes is None:
+            axes = plt.subplot(111)
+        axes.loglog(h, E0, "b")
+        axes.loglog(h, E1, "g--")
+        axes.set_title(
+            "Check Derivative - {0!s}".format(("PASSED :)" if passed else "FAILED :("))
+        )
+        axes.set_xlabel("h")
+        axes.set_ylabel("Error")
+        leg = axes.legend(
+            [r"$\mathcal{O}(h)$", r"$\mathcal{O}(h^2)$"],
+            loc="best",
+            title=r"$f(x + h\Delta x) - f(x) - h g(x) \Delta x - \mathcal{O}(h^2) = 0$",
+            frameon=False,
+        )
+        plt.setp(leg.get_title(), fontsize=15)
+        plt.show()
+
     # Ensure we are about precision
     order0 = order0[E0[1:] > eps]
     order1 = order1[E1[1:] > eps]
-    belowTol = order1.size == 0 and order0.size >= 0
-    # Make sure we get the correct order
-    correctOrder = order1.size > 0 and np.mean(order1) > tolerance * expectedOrder
 
-    passTest = belowTol or correctOrder
-
-    if passTest:
+    # belowTol = order1.size == 0 and order0.size >= 0
+    # # Make sure we get the correct order
+    # correctOrder = order1.size > 0 and np.mean(order1) > tolerance * expectedOrder
+    #
+    # passTest = belowTol or correctOrder
+    try:
+        if order1.size == 0:
+            # This should happen if all of the 1st order taylor approximation errors
+            # were below epsilon, common if the original function was linear.
+            # Thus it has no higher order derivatives.
+            pass
+        else:
+            test = np.mean(order1) > tolerance * expectedOrder
+            if not test:
+                raise AssertionError(
+                    f"\n Order mean {np.mean(order1)} is not greater than"
+                    f" {tolerance} of the expected order {expectedOrder}."
+                )
         print("{0!s} PASS! {1!s}".format("=" * 25, "=" * 25))
-        print(happiness[np.random.randint(len(happiness))] + "\n")
-    else:
+        print(np.random.choice(happiness) + "\n")
+        if plotIt:
+            _plot_it(ax, True)
+    except AssertionError as err:
         print(
             "{0!s}\n{1!s} FAIL! {2!s}\n{3!s}".format(
                 "*" * 57, "<" * 25, ">" * 25, "*" * 57
             )
         )
-        print(sadness[np.random.randint(len(sadness))] + "\n")
-
-    @requires({"matplotlib": matplotlib})
-    def plot_it(ax):
+        print(np.random.choice(sadness) + "\n")
         if plotIt:
-            if ax is None:
-                ax = plt.subplot(111)
-            ax.loglog(h, E0, "b")
-            ax.loglog(h, E1, "g--")
-            ax.set_title(
-                "Check Derivative - {0!s}".format(
-                    ("PASSED :)" if passTest else "FAILED :(")
-                )
-            )
-            ax.set_xlabel("h")
-            ax.set_ylabel("Error")
-            leg = ax.legend(
-                [r"$\mathcal{O}(h)$", r"$\mathcal{O}(h^2)$"],
-                loc="best",
-                title=r"$f(x + h\Delta x) - f(x) - h g(x) \Delta x - \mathcal{O}(h^2) = 0$",
-                frameon=False,
-            )
-            plt.setp(leg.get_title(), fontsize=15)
-            plt.show()
-
-    plot_it(ax)
+            _plot_it(ax, False)
+        raise err
 
-    return passTest
+    return True
 
 
 def get_quadratic(A, b, c=0):
     r"""Return a function that evaluates the given quadratic.
 
     Given **A**, **b** and *c*, this returns a function that evaluates
     the quadratic for a vector **x**. Where :math:`\mathbf{A} \in \mathbb{R}^{NxN}`,
@@ -723,14 +831,15 @@
 
     Raises
     ------
     AssertionError
         If the dot product test fails (only if assert_error=True).
 
     """
+    __tracebackhide__ = True
 
     def random(size, iscomplex):
         """Create random data of size and dtype of <size>."""
         out = rng.standard_normal(size)
         if iscomplex:
             out = out + 1j * rng.standard_normal(size)
         return out
@@ -765,18 +874,18 @@
         )
 
         return passed
 
 
 # DEPRECATIONS
 setupMesh = deprecate_function(
-    setup_mesh, "setupMesh", removal_version="1.0.0", future_warn=True
+    setup_mesh, "setupMesh", removal_version="1.0.0", error=True
 )
 Rosenbrock = deprecate_function(
-    rosenbrock, "Rosenbrock", removal_version="1.0.0", future_warn=True
+    rosenbrock, "Rosenbrock", removal_version="1.0.0", error=True
 )
 checkDerivative = deprecate_function(
-    check_derivative, "checkDerivative", removal_version="1.0.0", future_warn=True
+    check_derivative, "checkDerivative", removal_version="1.0.0", error=True
 )
 getQuadratic = deprecate_function(
-    get_quadratic, "getQuadratic", removal_version="1.0.0", future_warn=True
+    get_quadratic, "getQuadratic", removal_version="1.0.0", error=True
 )
```

### Comparing `discretize-0.8.3/discretize/tree_mesh.py` & `discretize-0.9.0/discretize/tree_mesh.py`

 * *Files 3% similar despite different names*

```diff
@@ -89,15 +89,14 @@
 from discretize.base import BaseTensorMesh
 from discretize.operators import InnerProducts, DiffOperators
 from discretize.mixins import InterfaceMixins, TreeMeshIO
 from discretize.utils import as_array_n_by_dim
 from discretize._extensions.tree_ext import _TreeMesh, TreeCell  # NOQA F401
 import numpy as np
 import scipy.sparse as sp
-import warnings
 from discretize.utils.code_utils import deprecate_property
 from scipy.spatial import Delaunay
 
 
 class TreeMesh(
     _TreeMesh,
     InnerProducts,
@@ -738,14 +737,29 @@
                     triangles, h, lv, finalize=False, diagonal_balance=diagonal_balance
                 )
 
         if finalize:
             self.finalize()
 
     @property
+    def total_nodes(self):
+        """Gridded hanging and non-hanging nodes locations.
+
+        This property returns a numpy array of shape
+        ``(n_total_nodes, dim)`` containing gridded locations for
+        all hanging and non-hanging nodes in the mesh.
+
+        Returns
+        -------
+        (n_total_nodes, dim) numpy.ndarray of float
+            Gridded hanging and non-hanging node locations
+        """
+        return np.vstack((self.nodes, self.hanging_nodes))
+
+    @property
     def vntF(self):
         """Vector number of total faces along each axis.
 
         This property returns the total number of hanging and
         non-hanging faces along each axis direction. The returned
         quantity is a list of integers of the form [nFx,nFy,nFz].
 
@@ -797,15 +811,15 @@
             Pafx = sp.diags(ix)
 
             iy = np.ones(self.nFy)
             iy[i_s[2]] = 0.0
             iy[i_s[3]] = 0.0
             Pafy = sp.diags(iy)
 
-            MfI = self.get_face_inner_product(invMat=True)
+            MfI = self.get_face_inner_product(invert_matrix=True)
 
             if self.dim == 2:
                 Pi = sp.block_diag([Pafx, Pafy])
 
             elif self.dim == 3:
                 iz = np.ones(self.nFz)
                 iz[i_s[4]] = 0.0
@@ -827,15 +841,15 @@
             i_s = self.face_boundary_indices
 
             ix = np.ones(self.nFx)
             ix[i_s[0]] = 0.0
             ix[i_s[1]] = 0.0
             Pafx = sp.diags(ix)
 
-            MfI = self.get_face_inner_product(invMat=True)
+            MfI = self.get_face_inner_product(invert_matrix=True)
             MfIx = sp.diags(MfI.diagonal()[:nFx])
 
             self._cell_gradient_x = (
                 -Pafx * MfIx * self.face_x_divergence.T * sp.diags(self.cell_volumes)
             )
 
         return self._cell_gradient_x
@@ -849,15 +863,15 @@
             i_s = self.face_boundary_indices
 
             iy = np.ones(self.nFy)
             iy[i_s[2]] = 0.0
             iy[i_s[3]] = 0.0
             Pafy = sp.diags(iy)
 
-            MfI = self.get_face_inner_product(invMat=True)
+            MfI = self.get_face_inner_product(invert_matrix=True)
             MfIy = sp.diags(MfI.diagonal()[nFx : nFx + nFy])
 
             self._cell_gradient_y = (
                 -Pafy * MfIy * self.face_y_divergence.T * sp.diags(self.cell_volumes)
             )
 
         return self._cell_gradient_y
@@ -873,15 +887,15 @@
             i_s = self.face_boundary_indices
 
             iz = np.ones(self.nFz)
             iz[i_s[4]] = 0.0
             iz[i_s[5]] = 0.0
             Pafz = sp.diags(iz)
 
-            MfI = self.get_face_inner_product(invMat=True)
+            MfI = self.get_face_inner_product(invert_matrix=True)
             MfIz = sp.diags(MfI.diagonal()[nFx + nFy :])
 
             self._cell_gradient_z = (
                 -Pafz * MfIz * self.face_z_divergence.T * sp.diags(self.cell_volumes)
             )
 
         return self._cell_gradient_z
@@ -931,27 +945,23 @@
         return self._cell_levels_by_indexes(indices)
 
     def get_interpolation_matrix(  # NOQA D102
         self, locs, location_type="cell_centers", zeros_outside=False, **kwargs
     ):
         # Documentation inherited from discretize.base.BaseMesh
         if "locType" in kwargs:
-            warnings.warn(
-                "The locType keyword argument has been deprecated, please use location_type. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The locType keyword argument has been removed, please use location_type. "
+                "This will be removed in discretize 1.0.0"
             )
-            location_type = kwargs["locType"]
         if "zerosOutside" in kwargs:
-            warnings.warn(
-                "The zerosOutside keyword argument has been deprecated, please use zeros_outside. "
-                "This will be removed in discretize 1.0.0",
-                FutureWarning,
+            raise TypeError(
+                "The zerosOutside keyword argument has been removed, please use zeros_outside. "
+                "This will be removed in discretize 1.0.0"
             )
-            zeros_outside = kwargs["zerosOutside"]
         locs = as_array_n_by_dim(locs, self.dim)
         location_type = self._parse_location_type(location_type)
 
         if self.dim == 2 and "z" in location_type:
             raise NotImplementedError("Unable to interpolate from Z edges/faces in 2D")
 
         locs = np.require(np.atleast_2d(locs), dtype=np.float64, requirements="C")
@@ -1050,117 +1060,117 @@
         return False
 
     def __reduce__(self):
         """Return the necessary items to reconstruct this object's state."""
         return TreeMesh, (self.h, self.origin), self.__getstate__()
 
     cellGrad = deprecate_property(
-        "cell_gradient", "cellGrad", removal_version="1.0.0", future_warn=True
+        "cell_gradient", "cellGrad", removal_version="1.0.0", error=True
     )
     cellGradx = deprecate_property(
-        "cell_gradient_x", "cellGradx", removal_version="1.0.0", future_warn=True
+        "cell_gradient_x", "cellGradx", removal_version="1.0.0", error=True
     )
     cellGrady = deprecate_property(
-        "cell_gradient_y", "cellGrady", removal_version="1.0.0", future_warn=True
+        "cell_gradient_y", "cellGrady", removal_version="1.0.0", error=True
     )
     cellGradz = deprecate_property(
-        "cell_gradient_z", "cellGradz", removal_version="1.0.0", future_warn=True
+        "cell_gradient_z", "cellGradz", removal_version="1.0.0", error=True
     )
     cellGradStencil = deprecate_property(
         "cell_gradient_stencil",
         "cellGradStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     faceDivx = deprecate_property(
-        "face_x_divergence", "faceDivx", removal_version="1.0.0", future_warn=True
+        "face_x_divergence", "faceDivx", removal_version="1.0.0", error=True
     )
     faceDivy = deprecate_property(
-        "face_y_divergence", "faceDivy", removal_version="1.0.0", future_warn=True
+        "face_y_divergence", "faceDivy", removal_version="1.0.0", error=True
     )
     faceDivz = deprecate_property(
-        "face_z_divergence", "faceDivz", removal_version="1.0.0", future_warn=True
+        "face_z_divergence", "faceDivz", removal_version="1.0.0", error=True
     )
     maxLevel = deprecate_property(
-        "max_used_level", "maxLevel", removal_version="1.0.0", future_warn=True
+        "max_used_level", "maxLevel", removal_version="1.0.0", error=True
     )
     areaFx = deprecate_property(
-        "face_x_areas", "areaFx", removal_version="1.0.0", future_warn=True
+        "face_x_areas", "areaFx", removal_version="1.0.0", error=True
     )
     areaFy = deprecate_property(
-        "face_y_areas", "areaFy", removal_version="1.0.0", future_warn=True
+        "face_y_areas", "areaFy", removal_version="1.0.0", error=True
     )
     areaFz = deprecate_property(
-        "face_z_areas", "areaFz", removal_version="1.0.0", future_warn=True
+        "face_z_areas", "areaFz", removal_version="1.0.0", error=True
     )
     edgeEx = deprecate_property(
-        "edge_x_lengths", "edgeEx", removal_version="1.0.0", future_warn=True
+        "edge_x_lengths", "edgeEx", removal_version="1.0.0", error=True
     )
     edgeEy = deprecate_property(
-        "edge_y_lengths", "edgeEy", removal_version="1.0.0", future_warn=True
+        "edge_y_lengths", "edgeEy", removal_version="1.0.0", error=True
     )
     edgeEz = deprecate_property(
-        "edge_z_lengths", "edgeEz", removal_version="1.0.0", future_warn=True
+        "edge_z_lengths", "edgeEz", removal_version="1.0.0", error=True
     )
     permuteCC = deprecate_property(
-        "permute_cells", "permuteCC", removal_version="1.0.0", future_warn=True
+        "permute_cells", "permuteCC", removal_version="1.0.0", error=True
     )
     permuteF = deprecate_property(
-        "permute_faces", "permuteF", removal_version="1.0.0", future_warn=True
+        "permute_faces", "permuteF", removal_version="1.0.0", error=True
     )
     permuteE = deprecate_property(
-        "permute_edges", "permuteE", removal_version="1.0.0", future_warn=True
+        "permute_edges", "permuteE", removal_version="1.0.0", error=True
     )
     faceBoundaryInd = deprecate_property(
         "face_boundary_indices",
         "faceBoundaryInd",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     cellBoundaryInd = deprecate_property(
         "cell_boundary_indices",
         "cellBoundaryInd",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _aveCC2FxStencil = deprecate_property(
         "average_cell_to_total_face_x",
         "_aveCC2FxStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _aveCC2FyStencil = deprecate_property(
         "average_cell_to_total_face_y",
         "_aveCC2FyStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _aveCC2FzStencil = deprecate_property(
         "average_cell_to_total_face_z",
         "_aveCC2FzStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _cellGradStencil = deprecate_property(
         "stencil_cell_gradient",
         "_cellGradStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _cellGradxStencil = deprecate_property(
         "stencil_cell_gradient_x",
         "_cellGradxStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _cellGradyStencil = deprecate_property(
         "stencil_cell_gradient_y",
         "_cellGradyStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
     _cellGradzStencil = deprecate_property(
         "stencil_cell_gradient_z",
         "_cellGradzStencil",
         removal_version="1.0.0",
-        future_warn=True,
+        error=True,
     )
```

### Comparing `discretize-0.8.3/discretize/unstructured_mesh.py` & `discretize-0.9.0/discretize/unstructured_mesh.py`

 * *Files 3% similar despite different names*

```diff
@@ -581,14 +581,83 @@
             raise NotImplementedError(
                 "Inverted model derivatives are not supported here"
             )
         if invert_matrix:
             raise NotImplementedError("Inverted matrix derivatives are not supported")
         return self.__get_inner_product_deriv_func("E", model)
 
+    def _get_edge_surf_int_proj_mats(self, only_boundary=False, with_area=True):
+        """Return the projection operators for integrating edges on each face.
+
+        Parameters
+        ----------
+        only_boundary : bool, optional
+            Whether to only operate on the boundary faces or not.
+        with_area : bool, optional
+            Whether to include the face area.
+
+        Returns
+        -------
+        list of (3 * n_faces, n_edges) scipy.sparse.csr_matrix
+        """
+        # edges associated with each face... can just get the indices of the curl...
+        face_edges = self._face_edges
+        face_areas = self.face_areas
+        if only_boundary:
+            bf_inds = self.boundary_face_list
+            face_edges = face_edges[bf_inds]
+            face_areas = face_areas[bf_inds]
+            face_normals = self.boundary_face_outward_normals
+        else:
+            face_normals = self.face_normals
+
+        # face_edges for these are:
+        edge_inds = [[1, 2], [0, 2], [0, 1]]
+
+        n_f = face_edges.shape[0]
+
+        ones = np.ones(n_f * 2)
+        P_indptr = np.arange(2 * n_f + 1)
+
+        d = np.ones(3, dtype=int)[:, None] * np.arange(2)
+        t = np.arange(n_f)
+        T_col_inds = (d + t[:, None, None] * 2).reshape(-1)
+        T_ind_ptr = 2 * np.arange(3 * n_f + 1)
+
+        Ps = []
+
+        # translate c to fortran ordering
+        C2F_col_inds = np.arange(n_f * 3).reshape((-1, 3), order="C").reshape(-1)
+        C2F_row_inds = np.arange(n_f * 3).reshape((-1, 3), order="F").reshape(-1)
+        C2F = sp.csr_matrix(
+            (np.ones(n_f * 3), (C2F_row_inds, C2F_col_inds)), shape=(n_f * 3, n_f * 3)
+        )
+
+        for i in range(3):
+            # matrix which selects the edges associate with each of the nodes of each boundary face
+            node_edges = face_edges[:, edge_inds[i]]
+            P = sp.csr_matrix(
+                (ones, node_edges.reshape(-1), P_indptr), shape=(2 * n_f, self.n_edges)
+            )
+
+            edge_dirs = self.edge_tangents[node_edges]
+            t_for = np.concatenate((edge_dirs, face_normals[:, None, :]), axis=1)
+            t_inv = invert_blocks(t_for)
+            t_inv = t_inv[:, :, :-1] / 3  # n_edges_per_thing
+
+            if with_area:
+                t_inv *= face_areas[:, None, None]
+
+            T = C2F @ sp.csr_matrix(
+                (t_inv.reshape(-1), T_col_inds, T_ind_ptr),
+                shape=(3 * n_f, 2 * n_f),
+            )
+            Ps.append((T @ P))
+        return Ps
+
     @property
     def cell_centers_tree(self):
         """A KDTree object built from the cell centers.
 
         Returns
         -------
         scipy.spatial.KDTree
@@ -926,14 +995,31 @@
         row_ptr = np.arange(n_cells + 1) * (n_edge_per_cell)
 
         return sp.csr_matrix(
             (Aij.reshape(-1), col_inds.reshape(-1), row_ptr), shape=(n_cells, n_edges)
         )
 
     @property
+    def average_edge_to_face(self):  # NOQA D102
+        # Documentation inherited from discretize.base.BaseMesh
+        if self.dim == 2:
+            # in 2D edges are at the same location as faces
+            return sp.eye(self.n_edges, self.n_edges)
+        # in 3D there are three edges per face
+        n_faces = self.n_faces
+        n_edges = self.n_edges
+        face_edges = self._face_edges
+
+        ind_ptr = 3 * np.arange(n_faces + 1)
+        col_inds = face_edges.reshape(-1)
+        Aijs = np.full(3 * self.n_faces, 1 / 3)
+        Av = sp.csr_matrix((Aijs, col_inds, ind_ptr), shape=(n_faces, n_edges))
+        return Av
+
+    @property
     def average_cell_to_face(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         A = self.average_face_to_cell.T
         row_sum = np.asarray(A.sum(axis=-1))[:, 0]
         row_sum[row_sum == 0.0] = 1.0
         A = sp.diags(1.0 / row_sum) @ A
         return A
@@ -1051,44 +1137,45 @@
 
     @property
     def boundary_edge_vector_integral(self):  # NOQA D102
         # Documentation inherited from discretize.base.BaseMesh
         boundary_faces = self.boundary_face_list
         if self.dim == 2:
             boundary_face_edges = boundary_faces
-        else:
-            raise NotImplementedError(
-                "The 3D boundary edge integral matrix has not been implemented yet"
+            dA = (
+                self.boundary_face_outward_normals
+                * self.face_areas[boundary_faces][:, None]
             )
-            # boundary_face_edges = self._face_edges[boundary_faces]
-        dA = (
-            self.boundary_face_outward_normals
-            * self.face_areas[boundary_faces][:, None]
-        )
 
-        # projection matrices
-        # for each edge on boundary faces
-        Pe = self.project_edge_to_boundary_edge
-        n_boundary_edges, n_edges = Pe.shape
-        if self.dim == 2:
+            # projection matrices
+            # for each edge on boundary faces
+            Pe = self.project_edge_to_boundary_edge
+            n_boundary_edges, n_edges = Pe.shape
             index = boundary_face_edges
             w_cross_n = np.cross(-self.edge_tangents[index], dA)
             M_be = (
                 sp.csr_matrix((w_cross_n, (index, index)), shape=(n_edges, n_edges))
                 @ Pe.T
             )
-        # This is not quite correct for 3D...
-        # else:
-        #     Ps = [sp.csr_matrix((n_edges, n_boundary_edges)) for i in range(3)]
-        #     for i in range(3):
-        #         index = boundary_face_edges[:, i]
-        #         w_cross_n = np.cross(-self.edge_tangents[index], dA) / 3
-        #         for j in range(3):
-        #             Ps[j] = Ps[j] + sp.csr_matrix((w_cross_n[:, j], (index, index)), shape=(n_edges, n_edges)) @ Pe.T
-        #     M_be = sp.hstack(Ps)
+        else:
+            Ps = self._get_edge_surf_int_proj_mats(only_boundary=True, with_area=True)
+            # the cross product of a vector defined on each face with the face outward normal...
+            # so V cross n = -n cross V
+            cx = sp.diags(self.boundary_face_outward_normals[:, 0])
+            cy = sp.diags(self.boundary_face_outward_normals[:, 1])
+            cz = sp.diags(self.boundary_face_outward_normals[:, 2])
+            # the negative cross mat
+            cross_mat = sp.bmat([[None, cz, -cy], [-cz, None, cx], [cy, -cx, None]])
+
+            Pf = self.project_face_to_boundary_face
+            Pe = self.project_edge_to_boundary_edge
+            Av = (Pf @ self.average_edge_to_face) @ Pe.T
+            Av = cross_mat @ sp.block_diag((Av, Av, Av))
+
+            M_be = np.sum(Ps).T @ Av
         return M_be
 
     def __reduce__(self):
         """Return the class and attributes necessary to reconstruct the mesh."""
         return self.__class__, (
             self.nodes,
             self.simplices,
```

### Comparing `discretize-0.8.3/discretize/utils/__init__.py` & `discretize-0.9.0/discretize/utils/__init__.py`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/utils/code_utils.py` & `discretize-0.9.0/discretize/utils/code_utils.py`

 * *Files 20% similar despite different names*

```diff
@@ -109,222 +109,282 @@
                 print(("Not running `{}`.".format(function.__name__)))
 
             return passer
 
     return decorated_function
 
 
-def deprecate_class(removal_version=None, new_location=None, future_warn=False):
+def deprecate_class(
+    removal_version=None, new_location=None, future_warn=False, error=False
+):
     """Decorate a class as deprecated.
 
     Parameters
     ----------
     removal_version : str, optional
         Which version the class will be removed in.
     new_location : str, optional
         A new package location for the class.
     future_warn : bool, optional
         Whether to issue a FutureWarning, or a DeprecationWarning.
+    error : bool, optional
+        Throw error if deprecated class no longer implemented
     """
     if future_warn:
         warn = FutureWarning
     else:
         warn = DeprecationWarning
 
     def decorator(cls):
         my_name = cls.__name__
         parent_name = cls.__bases__[0].__name__
         message = f"{my_name} has been deprecated, please use {parent_name}."
-        if removal_version is not None:
+        if error:
+            message = f"{my_name} has been removed, please use {parent_name}."
+        elif removal_version is not None:
             message += (
                 f" It will be removed in version {removal_version} of discretize."
             )
         else:
             message += " It will be removed in a future version of discretize."
 
         # stash the original initialization of the class
         cls._old__init__ = cls.__init__
 
         def __init__(self, *args, **kwargs):
-            warnings.warn(message, warn)
+            if error:
+                raise NotImplementedError(message)
+            else:
+                warnings.warn(message, warn, stacklevel=2)
             self._old__init__(*args, **kwargs)
 
         cls.__init__ = __init__
         if new_location is not None:
             parent_name = f"{new_location}.{parent_name}"
         cls.__doc__ = f""" This class has been deprecated, see `{parent_name}` for documentation"""
         return cls
 
     return decorator
 
 
-def deprecate_module(old_name, new_name, removal_version=None, future_warn=False):
+def deprecate_module(
+    old_name, new_name, removal_version=None, future_warn=False, error=False
+):
     """Deprecate a module.
 
     Parameters
     ----------
     old_name : str
         The old name of the module.
     new_name : str
         The new name of the module.
     removal_version : str, optional
         Which version the class will be removed in.
     future_warn : bool, optional
         Whether to issue a FutureWarning, or a DeprecationWarning.
+    error : bool, default: ``False``
+        Throw error if deprecated module no longer implemented
     """
     if future_warn:
         warn = FutureWarning
     else:
         warn = DeprecationWarning
     message = f"The {old_name} module has been deprecated, please use {new_name}."
-    if removal_version is not None:
+    if error:
+        message = f"{old_name} has been removed, please use {new_name}."
+    elif removal_version is not None:
         message += f" It will be removed in version {removal_version} of discretize"
     else:
         message += " It will be removed in a future version of discretize."
     message += " Please update your code accordingly."
-    warnings.warn(message, warn)
+    if error:
+        raise NotImplementedError(message)
+    else:
+        warnings.warn(message, warn, stacklevel=2)
 
 
-def deprecate_property(new_name, old_name, removal_version=None, future_warn=False):
+def deprecate_property(
+    new_name, old_name, removal_version=None, future_warn=False, error=False
+):
     """Deprecate a class property.
 
     Parameters
     ----------
     new_name : str
         The new name of the property.
     old_name : str
         The old name of the property.
     removal_version : str, optional
         Which version the class will be removed in.
     future_warn : bool, optional
         Whether to issue a FutureWarning, or a DeprecationWarning.
+    error : bool, default: ``False``
+        Throw error if deprecated property no longer implemented
+
     """
     if future_warn:
         warn = FutureWarning
     else:
         warn = DeprecationWarning
-    if removal_version is not None:
+    if error:
+        tag = ""
+    elif removal_version is not None:
         tag = f" It will be removed in version {removal_version} of discretize."
     else:
         tag = " It will be removed in a future version of discretize."
 
     def get_dep(self):
         class_name = type(self).__name__
         message = (
             f"{class_name}.{old_name} has been deprecated, please use {class_name}.{new_name}."
             + tag
         )
-        warnings.warn(message, warn)
+        if error:
+            raise NotImplementedError(message.replace("deprecated", "removed"))
+        else:
+            warnings.warn(message, warn, stacklevel=2)
         return getattr(self, new_name)
 
     def set_dep(self, other):
         class_name = type(self).__name__
         message = (
             f"{class_name}.{old_name} has been deprecated, please use {class_name}.{new_name}."
             + tag
         )
-        warnings.warn(message, warn)
+        if error:
+            raise NotImplementedError(message.replace("deprecated", "removed"))
+        else:
+            warnings.warn(message, warn, stacklevel=2)
         setattr(self, new_name, other)
 
     doc = f"""
     `{old_name}` has been deprecated. See `{new_name}` for documentation.
 
     See Also
     --------
     {new_name}
     """
 
     return property(get_dep, set_dep, None, doc)
 
 
-def deprecate_method(new_name, old_name, removal_version=None, future_warn=False):
+def deprecate_method(
+    new_name, old_name, removal_version=None, future_warn=False, error=False
+):
     """Deprecate a class method.
 
     Parameters
     ----------
     new_name : str
         The new name of the method.
     old_name : str
         The old name of the method.
     removal_version : str, optional
         Which version the class will be removed in.
     future_warn : bool, optional
         Whether to issue a FutureWarning, or a DeprecationWarning.
+    error : bool, default: ``False``
+        Throw error if deprecated method no longer implemented
     """
     if future_warn:
         warn = FutureWarning
     else:
         warn = DeprecationWarning
-    if removal_version is not None:
+    if error:
+        tag = ""
+    elif removal_version is not None:
         tag = f" It will be removed in version {removal_version} of discretize."
     else:
         tag = " It will be removed in a future version of discretize."
 
     def new_method(self, *args, **kwargs):
         class_name = type(self).__name__
-        warnings.warn(
-            f"{class_name}.{old_name} has been deprecated, please use {class_name}.{new_name}."
-            + tag,
-            warn,
+        message = (
+            f"{class_name}.{old_name} has been deprecated, please use "
+            f"{class_name}.{new_name}.{tag}"
         )
+        if error:
+            raise NotImplementedError(message.replace("deprecated", "removed"))
+        else:
+            warnings.warn(
+                message,
+                warn,
+                stacklevel=2,
+            )
         return getattr(self, new_name)(*args, **kwargs)
 
     doc = f"""
     `{old_name}` has been deprecated. See `{new_name}` for documentation
 
     See Also
     --------
     {new_name}
     """
+    if error:
+        doc = doc.replace("deprecated", "removed")
     new_method.__doc__ = doc
     return new_method
 
 
-def deprecate_function(new_function, old_name, removal_version=None, future_warn=False):
+def deprecate_function(
+    new_function, old_name, removal_version=None, future_warn=False, error=False
+):
     """Deprecate a function.
 
     Parameters
     ----------
     new_function : callable
         The new function.
     old_name : str
         The old name of the function.
     removal_version : str, optional
         Which version the class will be removed in.
     future_warn : bool, optional
         Whether to issue a FutureWarning, or a DeprecationWarning.
+    error : bool, default: ``False``
+        Throw error if deprecated function no longer implemented
     """
     if future_warn:
         warn = FutureWarning
     else:
         warn = DeprecationWarning
     new_name = new_function.__name__
-    if removal_version is not None:
+    if error:
+        tag = ""
+    elif removal_version is not None:
         tag = f" It will be removed in version {removal_version} of discretize."
     else:
         tag = " It will be removed in a future version of discretize."
 
+    message = f"{old_name} has been deprecated, please use {new_name}." + tag
+
     def dep_function(*args, **kwargs):
-        warnings.warn(
-            f"{old_name} has been deprecated, please use {new_name}." + tag,
-            warn,
-        )
-        return new_function(*args, **kwargs)
+        if error:
+            raise NotImplementedError(message.replace("deprecated", "removed"))
+        else:
+            warnings.warn(
+                message,
+                warn,
+                stacklevel=2,
+            )
+            return new_function(*args, **kwargs)
 
     doc = f"""
     `{old_name}` has been deprecated. See `{new_name}` for documentation
 
     See Also
     --------
     {new_name}
     """
+    if error:
+        doc = doc.replace("deprecated", "removed")
     dep_function.__doc__ = doc
     return dep_function
 
 
 # DEPRECATIONS
 isScalar = deprecate_function(
-    is_scalar, "isScalar", removal_version="1.0.0", future_warn=True
+    is_scalar, "isScalar", removal_version="1.0.0", error=True
 )
 asArray_N_x_Dim = deprecate_function(
-    as_array_n_by_dim, "asArray_N_x_Dim", removal_version="1.0.0", future_warn=True
+    as_array_n_by_dim, "asArray_N_x_Dim", removal_version="1.0.0", error=True
 )
```

### Comparing `discretize-0.8.3/discretize/utils/coordinate_utils.py` & `discretize-0.9.0/discretize/utils/coordinate_utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -296,15 +296,15 @@
     return (xyz - X0).dot(R.T) + X0  # equivalent to (R*(xyz - X0)).T + X0
 
 
 rotationMatrixFromNormals = deprecate_function(
     rotation_matrix_from_normals,
     "rotationMatrixFromNormals",
     removal_version="1.0.0",
-    future_warn=True,
+    error=True,
 )
 rotatePointsFromNormals = deprecate_function(
     rotate_points_from_normals,
     "rotatePointsFromNormals",
     removal_version="1.0.0",
-    future_warn=True,
+    error=True,
 )
```

### Comparing `discretize-0.8.3/discretize/utils/curvilinear_utils.py` & `discretize-0.9.0/discretize/utils/curvilinear_utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,12 +1,11 @@
 """Functions for working with curvilinear meshes."""
 import numpy as np
 from discretize.utils.matrix_utils import mkvc, ndgrid, sub2ind
 from discretize.utils.code_utils import deprecate_function
-import warnings
 
 
 def example_curvilinear_grid(nC, exType):
     """Create the gridded node locations for a curvilinear mesh.
 
     Parameters
     ----------
@@ -139,24 +138,22 @@
     >>> vol = volume_tetrahedron(xyz, A, B, C, D)
     >>> vol = vol[0]
     >>> vol
     array([1.33333333])
 
     Plotting small mesh and tetrahedron
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> fig = plt.figure(figsize=(7, 7))
-        >>> ax = fig.gca(projection='3d')
-        >>> mesh.plot_grid(ax=ax)
-        >>> k = [0, 6, 8, 0, 24, 6, 24, 8]
-        >>> xyz_tetra = xyz[k, :]
-        >>> ax.plot(xyz_tetra[:, 0], xyz_tetra[:, 1], xyz_tetra[:, 2], 'r')
-        >>> ax.text(-0.25, 0., 3., 'Volume of the tetrahedron: {:g} $m^3$'.format(vol))
-        >>> plt.show()
+    >>> fig = plt.figure(figsize=(7, 7))
+    >>> ax = fig.gca(projection='3d')
+    >>> mesh.plot_grid(ax=ax)
+    >>> k = [0, 6, 8, 0, 24, 6, 24, 8]
+    >>> xyz_tetra = xyz[k, :]
+    >>> ax.plot(xyz_tetra[:, 0], xyz_tetra[:, 1], xyz_tetra[:, 2], 'r')
+    >>> ax.text(-0.25, 0., 3., 'Volume of the tetrahedron: {:g} $m^3$'.format(vol))
+    >>> plt.show()
     """
     AD = xyz[A, :] - xyz[D, :]
     BD = xyz[B, :] - xyz[D, :]
     CD = xyz[C, :] - xyz[D, :]
 
     V = (
         (BD[:, 0] * CD[:, 1] - BD[:, 1] * CD[:, 0]) * AD[:, 2]
@@ -242,23 +239,21 @@
 
     Get indices of 'A' and 'C' nodes for all cells.
 
     >>> A, C = index_cube('AC', [n_cells+1, n_cells+1])
 
     Plot mesh and the locations of the A and C nodes
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> fig1 = plt.figure(figsize=(5, 5))
-        >>> ax1 = fig1.add_axes([0.1, 0.1, 0.8, 0.8])
-        >>> mesh.plot_grid(ax=ax1)
-        >>> ax1.scatter(mesh.nodes[A, 0], mesh.nodes[A, 1], 100, 'r', marker='^')
-        >>> ax1.scatter(mesh.nodes[C, 0], mesh.nodes[C, 1], 100, 'g', marker='v')
-        >>> ax1.set_title('A nodes (red) and C nodes (green)')
-        >>> plt.show()
+    >>> fig1 = plt.figure(figsize=(5, 5))
+    >>> ax1 = fig1.add_axes([0.1, 0.1, 0.8, 0.8])
+    >>> mesh.plot_grid(ax=ax1)
+    >>> ax1.scatter(mesh.nodes[A, 0], mesh.nodes[A, 1], 100, 'r', marker='^')
+    >>> ax1.scatter(mesh.nodes[C, 0], mesh.nodes[C, 1], 100, 'g', marker='v')
+    >>> ax1.set_title('A nodes (red) and C nodes (green)')
+    >>> plt.show()
     """
     if not isinstance(nodes, str):
         raise TypeError("Nodes must be a str variable: e.g. 'ABCD'")
     nodes = nodes.upper()
     try:
         dim = len(grid_shape)
         if n is None:
@@ -408,27 +403,25 @@
 
     >>> nvec, area = face_info(xyz, A, B, C, D)
     >>> nvec, area
     (array([[-0.70710678,  0.70710678,  0.        ]]), array([4.24264069]))
 
     Plot surface for example 1 on mesh
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> fig = plt.figure(figsize=(7, 7))
-        >>> ax = fig.gca(projection='3d')
-        >>> mesh.plot_grid(ax=ax)
-        >>> k = [0, 4, 26, 18, 0]
-        >>> xyz_quad = xyz[k, :]
-        >>> ax.plot(xyz_quad[:, 0], xyz_quad[:, 1], xyz_quad[:, 2], 'r')
-        >>> ax.text(-0.25, 0., 3., 'Area of the surface: {:g} $m^2$'.format(area[0]))
-        >>> ax.text(-0.25, 0., 2.8, 'Normal vector: ({:.2f}, {:.2f}, {:.2f})'.format(
-        ...     nvec[0, 0], nvec[0, 1], nvec[0, 2])
-        ... )
-        >>> plt.show()
+    >>> fig = plt.figure(figsize=(7, 7))
+    >>> ax = fig.gca(projection='3d')
+    >>> mesh.plot_grid(ax=ax)
+    >>> k = [0, 4, 26, 18, 0]
+    >>> xyz_quad = xyz[k, :]
+    >>> ax.plot(xyz_quad[:, 0], xyz_quad[:, 1], xyz_quad[:, 2], 'r')
+    >>> ax.text(-0.25, 0., 3., 'Area of the surface: {:g} $m^2$'.format(area[0]))
+    >>> ax.text(-0.25, 0., 2.8, 'Normal vector: ({:.2f}, {:.2f}, {:.2f})'.format(
+    ...     nvec[0, 0], nvec[0, 1], nvec[0, 2])
+    ... )
+    >>> plt.show()
 
     In our second example, the vertices are unable to define a flat
     surface in 3D space. However, we will demonstrate the *face_info*
     returns the average normal vector and an approximate surface area.
 
     Define the face indicies
     >>> A = np.array([0])
@@ -440,35 +433,31 @@
 
     >>> nvec, area = face_info(xyz, A, B, C, D)
     >>> nvec, area
     (array([[-0.4472136 ,  0.89442719,  0.        ]]), array([2.23606798]))
 
     Plot surface for example 2 on mesh
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> fig = plt.figure(figsize=(7, 7))
-        >>> ax = fig.gca(projection='3d')
-        >>> mesh.plot_grid(ax=ax)
-        >>> k = [0, 5, 26, 18, 0]
-        >>> xyz_quad = xyz[k, :]
-        >>> ax.plot(xyz_quad[:, 0], xyz_quad[:, 1], xyz_quad[:, 2], 'g')
-        >>> ax.text(-0.25, 0., 3., 'Area of the surface: {:g} $m^2$'.format(area[0]))
-        >>> ax.text(-0.25, 0., 2.8, 'Average normal vector: ({:.2f}, {:.2f}, {:.2f})'.format(
-        ...     nvec[0, 0], nvec[0, 1], nvec[0, 2])
-        ... )
-        >>> plt.show()
+    >>> fig = plt.figure(figsize=(7, 7))
+    >>> ax = fig.gca(projection='3d')
+    >>> mesh.plot_grid(ax=ax)
+    >>> k = [0, 5, 26, 18, 0]
+    >>> xyz_quad = xyz[k, :]
+    >>> ax.plot(xyz_quad[:, 0], xyz_quad[:, 1], xyz_quad[:, 2], 'g')
+    >>> ax.text(-0.25, 0., 3., 'Area of the surface: {:g} $m^2$'.format(area[0]))
+    >>> ax.text(-0.25, 0., 2.8, 'Average normal vector: ({:.2f}, {:.2f}, {:.2f})'.format(
+    ...     nvec[0, 0], nvec[0, 1], nvec[0, 2])
+    ... )
+    >>> plt.show()
     """
     if "normalizeNormals" in kwargs:
-        warnings.warn(
-            "The normalizeNormals keyword argument has been deprecated, please use normalize_normals. "
+        raise TypeError(
+            "The normalizeNormals keyword argument has been removed, please use normalize_normals. "
             "This will be removed in discretize 1.0.0",
-            FutureWarning,
         )
-        normalize_normals = kwargs["normalizeNormals"]
     if not isinstance(average, bool):
         raise TypeError("average must be a boolean")
     if not isinstance(normalize_normals, bool):
         raise TypeError("normalize_normals must be a boolean")
 
     AB = xyz[B, :] - xyz[A, :]
     BC = xyz[C, :] - xyz[B, :]
@@ -517,18 +506,18 @@
     return N, area
 
 
 exampleLrmGrid = deprecate_function(
     example_curvilinear_grid,
     "exampleLrmGrid",
     removal_version="1.0.0",
-    future_warn=True,
+    error=True,
 )
 volTetra = deprecate_function(
-    volume_tetrahedron, "volTetra", removal_version="1.0.0", future_warn=True
+    volume_tetrahedron, "volTetra", removal_version="1.0.0", error=True
 )
 indexCube = deprecate_function(
-    index_cube, "indexCube", removal_version="1.0.0", future_warn=True
+    index_cube, "indexCube", removal_version="1.0.0", error=True
 )
 faceInfo = deprecate_function(
-    face_info, "faceInfo", removal_version="1.0.0", future_warn=True
+    face_info, "faceInfo", removal_version="1.0.0", error=True
 )
```

### Comparing `discretize-0.8.3/discretize/utils/interpolation_utils.py` & `discretize-0.9.0/discretize/utils/interpolation_utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -91,32 +91,30 @@
     >>> x = np.linspace(0, 1, 7)
     >>> dense = np.linspace(0, 1, 200)
     >>> fun = lambda x: np.cos(2*np.pi*x)
     >>> Q = interpolation_matrix(locs, x)
 
     Plot original function and interpolation
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> fig1 = plt.figure(figsize=(5, 3))
-        >>> ax = fig1.add_axes([0.1, 0.1, 0.8, 0.8])
-        >>> ax.plot(dense, fun(dense), 'k:', lw=3)
-        >>> ax.plot(x, fun(x), 'ks', markersize=8)
-        >>> ax.plot(locs, Q*fun(x), 'go', markersize=4)
-        >>> ax.plot(locs, fun(locs), 'rs', markersize=4)
-        >>> ax.legend(
-        ...     [
-        ...         'True Function',
-        ...         'True (discrete loc.)',
-        ...         'Interpolated (computed)',
-        ...         'True (interp. loc.)'
-        ...     ],
-        ...     loc='upper center'
-        ... )
-        >>> plt.show()
+    >>> fig1 = plt.figure(figsize=(5, 3))
+    >>> ax = fig1.add_axes([0.1, 0.1, 0.8, 0.8])
+    >>> ax.plot(dense, fun(dense), 'k:', lw=3)
+    >>> ax.plot(x, fun(x), 'ks', markersize=8)
+    >>> ax.plot(locs, Q*fun(x), 'go', markersize=4)
+    >>> ax.plot(locs, fun(locs), 'rs', markersize=4)
+    >>> ax.legend(
+    ...     [
+    ...         'True Function',
+    ...         'True (discrete loc.)',
+    ...         'Interpolated (computed)',
+    ...         'True (interp. loc.)'
+    ...     ],
+    ...     loc='upper center'
+    ... )
+    >>> plt.show()
 
     Here, demonstrate a similar example on a 2D mesh using a 2D Gaussian distribution.
     We interpolate the Gaussian from the nodes to cell centers and examine the relative
     error.
 
     >>> hx = np.ones(10)
     >>> hy = np.ones(10)
@@ -133,29 +131,27 @@
     >>> A = interpolation_matrix(
     ...     centers, mesh.nodes_x, mesh.nodes_y
     ... )
     >>> val_interp = A.dot(val_nodes)
 
     Plot the interpolated values, along with the true values at cell centers,
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> val_centers = fun(centers[:, 0], centers[:, 1])
-        >>> fig = plt.figure(figsize=(11,3.3))
-        >>> clim = (0., 1.)
-        >>> ax1 = fig.add_subplot(131)
-        >>> ax2 = fig.add_subplot(132)
-        >>> ax3 = fig.add_subplot(133)
-        >>> mesh.plot_image(val_centers, ax=ax1, clim=clim)
-        >>> mesh.plot_image(val_interp, ax=ax2, clim=clim)
-        >>> mesh.plot_image(val_centers-val_interp, ax=ax3, clim=clim)
-        >>> ax1.set_title('Analytic at Centers')
-        >>> ax2.set_title('Interpolated from Nodes')
-        >>> ax3.set_title('Relative Error')
-        >>> plt.show()
+    >>> val_centers = fun(centers[:, 0], centers[:, 1])
+    >>> fig = plt.figure(figsize=(11,3.3))
+    >>> clim = (0., 1.)
+    >>> ax1 = fig.add_subplot(131)
+    >>> ax2 = fig.add_subplot(132)
+    >>> ax3 = fig.add_subplot(133)
+    >>> mesh.plot_image(val_centers, ax=ax1, clim=clim)
+    >>> mesh.plot_image(val_interp, ax=ax2, clim=clim)
+    >>> mesh.plot_image(val_centers-val_interp, ax=ax3, clim=clim)
+    >>> ax1.set_title('Analytic at Centers')
+    >>> ax2.set_title('Interpolated from Nodes')
+    >>> ax3.set_title('Relative Error')
+    >>> plt.show()
     """
     npts = locs.shape[0]
     locs = locs.astype(float)
     x = x.astype(float)
     if y is None and z is None:
         shape = [x.size]
         inds, vals = _interpmat1D(mkvc(locs), x)
@@ -286,9 +282,9 @@
         elif out_type == "TREE":
             return mesh_out._vol_avg_from_tree(mesh_in, values, output)
     else:
         raise TypeError("Unsupported mesh types")
 
 
 interpmat = deprecate_function(
-    interpolation_matrix, "interpmat", removal_version="1.0.0", future_warn=True
+    interpolation_matrix, "interpmat", removal_version="1.0.0", error=True
 )
```

### Comparing `discretize-0.8.3/discretize/utils/io_utils.py` & `discretize-0.9.0/discretize/utils/io_utils.py`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/discretize/utils/matrix_utils.py` & `discretize-0.9.0/discretize/utils/matrix_utils.py`

 * *Files 0% similar despite different names*

```diff
@@ -52,20 +52,18 @@
     ...     v = mkvc(a, ii)
     ...     print('Shape of output with n_dim =', ii, ': ', v.shape)
     Shape of output with n_dim = 1 :  (6,)
     Shape of output with n_dim = 2 :  (6, 1)
     Shape of output with n_dim = 3 :  (6, 1, 1)
     """
     if "numDims" in kwargs:
-        warnings.warn(
-            "The numDims keyword argument has been deprecated, please use n_dims. "
+        raise TypeError(
+            "The numDims keyword argument has been removed, please use n_dims. "
             "This will be removed in discretize 1.0.0",
-            FutureWarning,
         )
-        n_dims = kwargs["numDims"]
     if type(x) == np.matrix:
         x = np.array(x)
 
     if hasattr(x, "tovec"):
         x = x.tovec()
 
     if isinstance(x, Zero):
@@ -442,14 +440,15 @@
     """
     old_dir = kwargs.pop("dir", None)
     if old_dir is not None:
         warnings.warn(
             "The `dir` keyword argument has been renamed to `bdir` to avoid shadowing the "
             "builtin variable `dir`. This will be removed in discretize 1.0.0",
             FutureWarning,
+            stacklevel=2,
         )
         bdir = old_dir
     is_b = np.zeros(shape, dtype=bool, order="F")
     if "x" in bdir:
         is_b[[0, -1]] = True
     if len(shape) > 1:
         if "y" in bdir:
@@ -711,14 +710,15 @@
     >>> plt.show()
     """
     if "returnMatrix" in kwargs:
         warnings.warn(
             "The returnMatrix keyword argument has been deprecated, please use return_matrix. "
             "This will be removed in discretize 1.0.0",
             FutureWarning,
+            stacklevel=2,
         )
         return_matrix = kwargs["returnMatrix"]
 
     a11 = mkvc(a11)
     a12 = mkvc(a12)
     a13 = mkvc(a13)
     a21 = mkvc(a21)
@@ -863,14 +863,15 @@
     >>> plt.show()
     """
     if "returnMatrix" in kwargs:
         warnings.warn(
             "The returnMatrix keyword argument has been deprecated, please use return_matrix. "
             "This will be removed in discretize 1.0.0",
             FutureWarning,
+            stacklevel=2,
         )
         return_matrix = kwargs["returnMatrix"]
 
     a11 = mkvc(a11)
     a12 = mkvc(a12)
     a21 = mkvc(a21)
     a22 = mkvc(a22)
@@ -1183,32 +1184,30 @@
     >>> M_scalar = make_property_tensor(mesh, sigma_scalar)
     >>> M_isotropic = make_property_tensor(mesh, sigma_isotropic)
     >>> M_anisotropic = make_property_tensor(mesh, sigma_anisotropic)
     >>> M_tensor = make_property_tensor(mesh, sigma_tensor)
 
     Plot the property tensors.
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> M_list = [M_scalar, M_isotropic, M_anisotropic, M_tensor]
-        >>> case_list = ['Scalar', 'Isotropic', 'Anisotropic', 'Full Tensor']
-        >>> ax1 = 4*[None]
-        >>> fig = plt.figure(figsize=(15, 4))
-        >>> for ii in range(0, 4):
-        ...     ax1[ii] = fig.add_axes([0.05+0.22*ii, 0.05, 0.18, 0.9])
-        ...     ax1[ii].imshow(
-        ...         M_list[ii].todense(), interpolation='none', cmap='binary', vmax=10.
-        ...     )
-        ...     ax1[ii].set_title(case_list[ii], fontsize=24)
-        >>> ax2 = fig.add_axes([0.92, 0.15, 0.01, 0.7])
-        >>> norm = mpl.colors.Normalize(vmin=0., vmax=10.)
-        >>> cbar = mpl.colorbar.ColorbarBase(
-        ...     ax2, norm=norm, orientation="vertical", cmap=mpl.cm.binary
-        ... )
-        >>> plt.show()
+    >>> M_list = [M_scalar, M_isotropic, M_anisotropic, M_tensor]
+    >>> case_list = ['Scalar', 'Isotropic', 'Anisotropic', 'Full Tensor']
+    >>> ax1 = 4*[None]
+    >>> fig = plt.figure(figsize=(15, 4))
+    >>> for ii in range(0, 4):
+    ...     ax1[ii] = fig.add_axes([0.05+0.22*ii, 0.05, 0.18, 0.9])
+    ...     ax1[ii].imshow(
+    ...         M_list[ii].todense(), interpolation='none', cmap='binary', vmax=10.
+    ...     )
+    ...     ax1[ii].set_title(case_list[ii], fontsize=24)
+    >>> ax2 = fig.add_axes([0.92, 0.15, 0.01, 0.7])
+    >>> norm = mpl.colors.Normalize(vmin=0., vmax=10.)
+    >>> cbar = mpl.colorbar.ColorbarBase(
+    ...     ax2, norm=norm, orientation="vertical", cmap=mpl.cm.binary
+    ... )
+    >>> plt.show()
     """
     if tensor is None:  # default is ones
         tensor = np.ones(mesh.nC)
 
     if is_scalar(tensor):
         tensor = tensor * np.ones(mesh.nC)
 
@@ -1344,58 +1343,55 @@
     >>> Minv_scalar = inverse_property_tensor(mesh, sigma_scalar, return_matrix=True)
     >>> Minv_isotropic = inverse_property_tensor(mesh, sigma_isotropic, return_matrix=True)
     >>> Minv_anisotropic = inverse_property_tensor(mesh, sigma_anisotropic, return_matrix=True)
     >>> Minv_tensor = inverse_property_tensor(mesh, sigma_tensor, return_matrix=True)
 
     Plot the property tensors.
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> M_list = [M_scalar, M_isotropic, M_anisotropic, M_tensor]
-        >>> Minv_list = [Minv_scalar, Minv_isotropic, Minv_anisotropic, Minv_tensor]
-        >>> case_list = ['Scalar', 'Isotropic', 'Anisotropic', 'Full Tensor']
-        >>> fig1 = plt.figure(figsize=(15, 4))
-        >>> ax1 = 4*[None]
-        >>> for ii in range(0, 4):
-        ...     ax1[ii] = fig1.add_axes([0.05+0.22*ii, 0.05, 0.18, 0.9])
-        ...     ax1[ii].imshow(
-        ...         M_list[ii].todense(), interpolation='none', cmap='binary', vmax=10.
-        ...     )
-        ...     ax1[ii].set_title('$M$ (' + case_list[ii] + ')', fontsize=24)
-        >>> cax1 = fig1.add_axes([0.92, 0.15, 0.01, 0.7])
-        >>> norm1 = mpl.colors.Normalize(vmin=0., vmax=10.)
-        >>> cbar1 = mpl.colorbar.ColorbarBase(
-        ...     cax1, norm=norm1, orientation="vertical", cmap=mpl.cm.binary
-        ... )
-        >>> plt.show()
+    >>> M_list = [M_scalar, M_isotropic, M_anisotropic, M_tensor]
+    >>> Minv_list = [Minv_scalar, Minv_isotropic, Minv_anisotropic, Minv_tensor]
+    >>> case_list = ['Scalar', 'Isotropic', 'Anisotropic', 'Full Tensor']
+    >>> fig1 = plt.figure(figsize=(15, 4))
+    >>> ax1 = 4*[None]
+    >>> for ii in range(0, 4):
+    ...     ax1[ii] = fig1.add_axes([0.05+0.22*ii, 0.05, 0.18, 0.9])
+    ...     ax1[ii].imshow(
+    ...         M_list[ii].todense(), interpolation='none', cmap='binary', vmax=10.
+    ...     )
+    ...     ax1[ii].set_title('$M$ (' + case_list[ii] + ')', fontsize=24)
+    >>> cax1 = fig1.add_axes([0.92, 0.15, 0.01, 0.7])
+    >>> norm1 = mpl.colors.Normalize(vmin=0., vmax=10.)
+    >>> cbar1 = mpl.colorbar.ColorbarBase(
+    ...     cax1, norm=norm1, orientation="vertical", cmap=mpl.cm.binary
+    ... )
+    >>> plt.show()
 
     Plot the inverse property tensors.
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> fig2 = plt.figure(figsize=(15, 4))
-        >>> ax2 = 4*[None]
-        >>> for ii in range(0, 4):
-        ...     ax2[ii] = fig2.add_axes([0.05+0.22*ii, 0.05, 0.18, 0.9])
-        ...     ax2[ii].imshow(
-        ...         Minv_list[ii].todense(), interpolation='none', cmap='binary', vmax=1.
-        ...     )
-        ...     ax2[ii].set_title('$M^{-1}$ (' + case_list[ii] + ')', fontsize=24)
-        >>> cax2 = fig2.add_axes([0.92, 0.15, 0.01, 0.7])
-        >>> norm2 = mpl.colors.Normalize(vmin=0., vmax=1.)
-        >>> cbar2 = mpl.colorbar.ColorbarBase(
-        ...     cax2, norm=norm2, orientation="vertical", cmap=mpl.cm.binary
-        ... )
-        >>> plt.show()
+    >>> fig2 = plt.figure(figsize=(15, 4))
+    >>> ax2 = 4*[None]
+    >>> for ii in range(0, 4):
+    ...     ax2[ii] = fig2.add_axes([0.05+0.22*ii, 0.05, 0.18, 0.9])
+    ...     ax2[ii].imshow(
+    ...         Minv_list[ii].todense(), interpolation='none', cmap='binary', vmax=1.
+    ...     )
+    ...     ax2[ii].set_title('$M^{-1}$ (' + case_list[ii] + ')', fontsize=24)
+    >>> cax2 = fig2.add_axes([0.92, 0.15, 0.01, 0.7])
+    >>> norm2 = mpl.colors.Normalize(vmin=0., vmax=1.)
+    >>> cbar2 = mpl.colorbar.ColorbarBase(
+    ...     cax2, norm=norm2, orientation="vertical", cmap=mpl.cm.binary
+    ... )
+    >>> plt.show()
     """
     if "returnMatrix" in kwargs:
         warnings.warn(
             "The returnMatrix keyword argument has been deprecated, please use return_matrix. "
             "This will be removed in discretize 1.0.0",
             FutureWarning,
+            stacklevel=2,
         )
         return_matrix = kwargs["returnMatrix"]
 
     propType = TensorType(mesh, tensor)
 
     if is_scalar(tensor):
         T = 1.0 / tensor
@@ -1761,40 +1757,40 @@
         return f"({self._val}, {self._val}, ...)"
 
 
 ################################################
 #             DEPRECATED FUNCTIONS
 ################################################
 
-sdInv = deprecate_function(sdinv, "sdInv", removal_version="1.0.0", future_warn=True)
+sdInv = deprecate_function(sdinv, "sdInv", removal_version="1.0.0", error=True)
 
 getSubArray = deprecate_function(
-    get_subarray, "getSubArray", removal_version="1.0.0", future_warn=True
+    get_subarray, "getSubArray", removal_version="1.0.0", error=True
 )
 
 inv3X3BlockDiagonal = deprecate_function(
     inverse_3x3_block_diagonal,
     "inv3X3BlockDiagonal",
     removal_version="1.0.0",
-    future_warn=True,
+    error=True,
 )
 
 inv2X2BlockDiagonal = deprecate_function(
     inverse_2x2_block_diagonal,
     "inv2X2BlockDiagonal",
     removal_version="1.0.0",
-    future_warn=True,
+    error=True,
 )
 
 makePropertyTensor = deprecate_function(
     make_property_tensor,
     "makePropertyTensor",
     removal_version="1.0.0",
-    future_warn=True,
+    error=True,
 )
 
 invPropertyTensor = deprecate_function(
     inverse_property_tensor,
     "invPropertyTensor",
     removal_version="1.0.0",
-    future_warn=True,
+    error=True,
 )
```

### Comparing `discretize-0.8.3/discretize/utils/mesh_utils.py` & `discretize-0.9.0/discretize/utils/mesh_utils.py`

 * *Files 1% similar despite different names*

```diff
@@ -223,25 +223,24 @@
     >>> mesh.plot_grid(ax=ax)
     >>> ax.scatter(xy_random[:, 0], xy_random[:, 1], 50, 'k')
     >>> ax.scatter(xy_centers[ind_centers, 0], xy_centers[ind_centers, 1], 50, 'r')
     >>> ax.scatter(xy_nodes[ind_nodes, 0], xy_nodes[ind_nodes, 1], 50, 'b')
     >>> plt.show()
     """
     if "gridLoc" in kwargs:
-        warnings.warn(
-            "The gridLoc keyword argument has been deprecated, please use grid_loc. "
-            "This will be removed in discretize 1.0.0",
-            FutureWarning,
+        raise TypeError(
+            "The gridLoc keyword argument has been removed, please use grid_loc. "
+            "This message will be removed in discretize 1.0.0",
         )
-        grid_loc = kwargs["gridLoc"]
     warnings.warn(
         "The closest_points_index utilty function has been moved to be a method of "
         "a class object. Please access it as mesh.closest_points_index(). This will "
         "be removed in a future version of discretize",
         DeprecationWarning,
+        stacklevel=2,
     )
     return mesh.closest_points_index(pts, grid_loc=grid_loc, discard=True)
 
 
 def extract_core_mesh(xyzlim, mesh, mesh_type="tensor"):
     """Extract the core mesh from a global mesh.
 
@@ -663,15 +662,15 @@
 
     >>> hx = [(dx, nbcx)]
     >>> hy = [(dy, nbcy)]
     >>> mesh = TreeMesh([hx, hy], x0="CC")
 
     Refine surface topography
 
-    >>> xx = mesh.vectorNx
+    >>> xx = mesh.nodes_x
     >>> yy = -3 * np.exp((xx ** 2) / 100 ** 2) + 50.0
     >>> pts = np.c_[mkvc(xx), mkvc(yy)]
     >>> mesh = refine_tree_xyz(
     ...     mesh, pts, octree_levels=[2, 4], method="surface", finalize=False
     ... )
 
     Refine mesh near points
@@ -683,17 +682,17 @@
     ...     mesh, pts, octree_levels=[4, 2], method="radial", finalize=True
     ... )
 
     Plot the mesh
 
     >>> fig = plt.figure(figsize=(6, 6))
     >>> ax = fig.add_subplot(111)
-    >>> mesh.plotGrid(ax=ax)
-    >>> ax.set_xbound(mesh.x0[0], mesh.x0[0] + np.sum(mesh.hx))
-    >>> ax.set_ybound(mesh.x0[1], mesh.x0[1] + np.sum(mesh.hy))
+    >>> mesh.plot_grid(ax=ax)
+    >>> ax.set_xbound(mesh.x0[0], mesh.x0[0] + np.sum(mesh.h[0]))
+    >>> ax.set_ybound(mesh.x0[1], mesh.x0[1] + np.sum(mesh.h[1]))
     >>> ax.set_title("QuadTree Mesh")
     >>> plt.show()
     """
     if octree_levels_padding is not None:
         if len(octree_levels_padding) != len(octree_levels):
             raise ValueError(
                 "'octree_levels_padding' must be the length %i" % len(octree_levels)
@@ -713,14 +712,15 @@
         # padding = octree_levels[non_zeros]
         # mesh.refine_points(xyz, levels, padding, finalize=finalize,)
         warnings.warn(
             "The radial option is deprecated as of `0.9.0` please update your code to "
             "use the `TreeMesh.refine_points` functionality. It will be removed in a "
             "future version of discretize.",
             DeprecationWarning,
+            stacklevel=2,
         )
 
         # Compute the outer limits of each octree level
         rMax = np.cumsum(
             mesh.h[0].min() * octree_levels * 2 ** np.arange(len(octree_levels))
         )
         rs = np.ones(xyz.shape[0])
@@ -736,14 +736,15 @@
 
     elif method.lower() == "surface":
         warnings.warn(
             "The surface option is deprecated as of `0.9.0` please update your code to "
             "use the `TreeMesh.refine_surface` functionality. It will be removed in a "
             "future version of discretize.",
             DeprecationWarning,
+            stacklevel=2,
         )
         # padding = np.zeros((len(octree_levels), mesh.dim))
         # padding[:, -1] = np.maximum(octree_levels - 1, 0)
         # padding[:, :-1] = octree_levels_padding[:, None]
         # padding = padding[non_zeros]
         # mesh.refine_surface(xyz, levels, padding, finalize=finalize, pad_down=True, pad_up=False)
 
@@ -857,14 +858,15 @@
 
     elif method.lower() == "box":
         warnings.warn(
             "The box option is deprecated as of `0.9.0` please update your code to "
             "use the `TreeMesh.refine_bounding_box` functionality. It will be removed in a "
             "future version of discretize.",
             DeprecationWarning,
+            stacklevel=2,
         )
         # padding = np.zeros((len(octree_levels), mesh.dim))
         # padding[:, -1] = np.maximum(octree_levels - 1, 0)
         # padding[:, :-1] = octree_levels_padding[:, None]
         # padding = padding[non_zeros]
         # mesh.refine_bounding_box(xyz, levels, padding, finalize=finalize)
 
@@ -965,27 +967,25 @@
     >>> topo_points = np.linspace(0, 1)
     >>> topo_vals = topo_func(topo_points)
     >>> active_cc = active_from_xyz(mesh, np.c_[topo_points, topo_vals], grid_reference='CC')
     >>> active_n = active_from_xyz(mesh, np.c_[topo_points, topo_vals], grid_reference='N')
 
     Plot visual representation
 
-    .. collapse:: Expand to show scripting for plot
-
-        >>> ax = plt.subplot(121)
-        >>> mesh.plot_image(active_cc, ax=ax)
-        >>> mesh.plot_grid(centers=True, ax=ax)
-        >>> ax.plot(np.linspace(0,1), topo_func(np.linspace(0,1)), color='C3')
-        >>> ax.set_title("CC")
-        >>> ax = plt.subplot(122)
-        >>> mesh.plot_image(active_n, ax=ax)
-        >>> mesh.plot_grid(nodes=True, ax=ax)
-        >>> ax.plot(np.linspace(0,1), topo_func(np.linspace(0,1)), color='C3')
-        >>> ax.set_title("N")
-        >>> plt.show()
+    >>> ax = plt.subplot(121)
+    >>> mesh.plot_image(active_cc, ax=ax)
+    >>> mesh.plot_grid(centers=True, ax=ax)
+    >>> ax.plot(np.linspace(0,1), topo_func(np.linspace(0,1)), color='C3')
+    >>> ax.set_title("CC")
+    >>> ax = plt.subplot(122)
+    >>> mesh.plot_image(active_n, ax=ax)
+    >>> mesh.plot_grid(nodes=True, ax=ax)
+    >>> ax.plot(np.linspace(0,1), topo_func(np.linspace(0,1)), color='C3')
+    >>> ax.set_title("N")
+    >>> plt.show()
     """
     try:
         if not mesh.is_symmetric:
             raise NotImplementedError(
                 "Unsymmetric CylindricalMesh is not yet supported"
             )
     except AttributeError:
@@ -1196,18 +1196,18 @@
             a_triangs, b_triangs, c_triangs, d_triangs, e_triangs, f_triangs
         ]
 
     return points, simplices
 
 
 meshTensor = deprecate_function(
-    unpack_widths, "meshTensor", removal_version="1.0.0", future_warn=True
+    unpack_widths, "meshTensor", removal_version="1.0.0", error=True
 )
 closestPoints = deprecate_function(
-    closest_points_index, "closestPoints", removal_version="1.0.0", future_warn=True
+    closest_points_index, "closestPoints", removal_version="1.0.0", error=True
 )
 ExtractCoreMesh = deprecate_function(
-    extract_core_mesh, "ExtractCoreMesh", removal_version="1.0.0", future_warn=True
+    extract_core_mesh, "ExtractCoreMesh", removal_version="1.0.0", error=True
 )
 closest_points = deprecate_function(
-    closest_points_index, "closest_points", removal_version="1.0.0", future_warn=True
+    closest_points_index, "closest_points", removal_version="1.0.0", error=True
 )
```

### Comparing `discretize-0.8.3/discretize.egg-info/PKG-INFO` & `discretize-0.9.0/discretize.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: discretize
-Version: 0.8.3
+Version: 0.9.0
 Summary: Discretization tools for finite volume and inverse problems
 Home-page: http://simpeg.xyz/
 Download-URL: http://github.com/simpeg/discretize
 Author: SimPEG developers
 Author-email: rowanc1@gmail.com
 License: MIT
 Keywords: finite volume,discretization,pde,ode
```

### Comparing `discretize-0.8.3/discretize.egg-info/SOURCES.txt` & `discretize-0.9.0/discretize.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `discretize-0.8.3/setup.py` & `discretize-0.9.0/setup.py`

 * *Files 14% similar despite different names*

```diff
@@ -58,27 +58,29 @@
     platforms=["Windows", "Linux", "Solaris", "Mac OS-X", "Unix"],
     use_scm_version={
         "write_to": os.path.join("discretize", "version.py"),
     },
 )
 if len(sys.argv) >= 2 and (
     "--help" in sys.argv[1:]
-    or sys.argv[1] in ("--help-commands", "egg_info", "--version", "clean")
+    or sys.argv[1]
+    in ("--help-commands", "egg_info", "install_egg_info", "--version", "clean")
 ):
     # For these actions, build_requires are not required.
     #
     # They are required to succeed without Numpy/Cython, for example when
     # pip is used to install discretize when Numpy/Cython is not yet
     # present in the system.
 
     # add cython and setuptools_scm to install requires on these commands though
     install_requires = build_requires + install_requires[1:]
     metadata["install_requires"] = install_requires
 else:
     from setuptools.extension import Extension
+    from setuptools.command.build_ext import build_ext
     from Cython.Build import cythonize
     import numpy as np
 
     ext_kwargs = {}
     if os.environ.get("DISC_COV", None) is not None:
         ext_kwargs["define_macros"] = [("CYTHON_TRACE_NOGIL", 1)]
 
@@ -99,10 +101,30 @@
             "discretize._extensions.simplex_helpers",
             ["discretize/_extensions/simplex_helpers.pyx"],
             include_dirs=[np.get_include()],
             **ext_kwargs
         ),
     ]
 
+    class build_ext_cpp_standard(build_ext):
+        # add compiler specific standard argument specifier
+        def build_extension(self, ext):
+            # This module requires c++17 standard
+            if ext.name == "discretize._extensions.tree_ext":
+                comp_type = self.compiler.compiler_type
+                if comp_type == "msvc":
+                    std_arg = "/std:c++17"
+                elif comp_type == "bcpp":
+                    raise Exception(
+                        "Must use cpp compiler that support C++17 standard."
+                    )
+                else:
+                    std_arg = "-std=c++17"
+                ext.extra_compile_args = [
+                    std_arg,
+                ]
+            super().build_extension(ext)
+
     metadata["ext_modules"] = cythonize(extensions)
+    metadata["cmdclass"] = {"build_ext": build_ext_cpp_standard}
 
 setup(**metadata)
```

